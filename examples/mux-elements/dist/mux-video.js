var Ne=Object.defineProperty;var $e=j=>Ne(j,"__esModule",{value:!0});var Ze=(j,ee)=>{$e(j);for(var W in ee)Ne(j,W,{get:ee[W],enumerable:!0})};var Ue={};Ze(Ue,{Hls:()=>yt,MimeTypes:()=>Tt,PlaybackEngine:()=>_t,default:()=>Et});var qe=Object.create,Fe=Object.defineProperty,et=Object.getOwnPropertyDescriptor,tt=Object.getOwnPropertyNames,rt=Object.getPrototypeOf,it=Object.prototype.hasOwnProperty,nt=j=>Fe(j,"__esModule",{value:!0}),Me=(j,ee)=>function(){return ee||(0,j[Object.keys(j)[0]])((ee={exports:{}}).exports,ee),ee.exports},at=(j,ee,W)=>{if(ee&&typeof ee=="object"||typeof ee=="function")for(let b of tt(ee))!it.call(j,b)&&b!=="default"&&Fe(j,b,{get:()=>ee[b],enumerable:!(W=et(ee,b))||W.enumerable});return j},Ke=j=>at(nt(Fe(j!=null?qe(rt(j)):{},"default",j&&j.__esModule&&"default"in j?{get:()=>j.default,enumerable:!0}:{value:j,enumerable:!0})),j),st=Me({"src/polyfills/window.ts"(){if(globalThis.customElements||(globalThis.customElements={get(W){},define(W,b,m){},upgrade(W){},whenDefined(W){return Promise.resolve(globalThis.HTMLElement)}}),!globalThis.CustomEvent){class W{constructor(m,I={}){this.detail=I==null?void 0:I.detail}initCustomEvent(m,I,L,D){}}globalThis.CustomEvent=W}if(!globalThis.EventTarget){class W{addEventListener(){}removeEventListener(){}dispatchEvent(m){return!0}}globalThis.EventTarget=W}if(!globalThis.HTMLElement){class W extends EventTarget{}globalThis.HTMLElement=W}var j,ee;if(!((j=globalThis.document)==null?void 0:j.createElement)){let W=(ee=globalThis.document)!=null?ee:{};W.createElement=function(m,I){return new HTMLElement},globalThis.document=W}}}),ot=Me({"../../node_modules/mux-embed/dist/mux.js"(j,ee){(function(){var W=!1;(function(b,m){typeof j=="object"&&typeof ee=="object"?ee.exports=m():typeof W=="function"&&W.amd?W("mux",[],m):typeof j=="object"?j.mux=m():b.mux=m()})(this,function(){return function(b){function m(L){if(I[L])return I[L].exports;var D=I[L]={i:L,l:!1,exports:{}};return b[L].call(D.exports,D,D.exports,m),D.l=!0,D.exports}var I={};return m.m=b,m.c=I,m.d=function(L,D,M){m.o(L,D)||Object.defineProperty(L,D,{configurable:!1,enumerable:!0,get:M})},m.n=function(L){var D=L&&L.__esModule?function(){return L.default}:function(){return L};return m.d(D,"a",D),D},m.o=function(L,D){return Object.prototype.hasOwnProperty.call(L,D)},m.p="",m(m.s=15)}([function(b,m,I){(function(L){var D;D=typeof window!="undefined"?window:L!==void 0?L:typeof self!="undefined"?self:{},b.exports=D}).call(m,I(17))},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(0),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M={};M.now=function(){var R=D.default.performance,O=R&&R.timing;return O&&typeof O.navigationStart=="number"&&typeof R.now=="function"?O.navigationStart+R.now():Date.now()},m.default=M},function(b,m){function I(F,U,w){switch(w.length){case 0:return F.call(U);case 1:return F.call(U,w[0]);case 2:return F.call(U,w[0],w[1]);case 3:return F.call(U,w[0],w[1],w[2])}return F.apply(U,w)}function L(F,U){for(var w=-1,k=Array(F);++w<F;)k[w]=U(w);return k}function D(F,U){var w=x(F)||T(F)?L(F.length,String):[],k=w.length,K=!!k;for(var N in F)!U&&!i.call(F,N)||K&&(N=="length"||u(N,k))||w.push(N);return w}function M(F,U,w){var k=F[U];i.call(F,U)&&p(k,w)&&(w!==void 0||U in F)||(F[U]=w)}function R(F){if(!E(F))return S(F);var U=[];for(var w in Object(F))i.call(F,w)&&w!="constructor"&&U.push(w);return U}function O(F,U){return U=P(U===void 0?F.length-1:U,0),function(){for(var w=arguments,k=-1,K=P(w.length-U,0),N=Array(K);++k<K;)N[k]=w[U+k];k=-1;for(var G=Array(U+1);++k<U;)G[k]=w[k];return G[U]=N,I(F,this,G)}}function A(F,U,w,k){w||(w={});for(var K=-1,N=U.length;++K<N;){var G=U[K],H=k?k(w[G],F[G],G,w,F):void 0;M(w,G,H===void 0?F[G]:H)}return w}function u(F,U){return!!(U=U==null?d:U)&&(typeof F=="number"||o.test(F))&&F>-1&&F%1==0&&F<U}function y(F,U,w){if(!a(w))return!1;var k=typeof U;return!!(k=="number"?_(w)&&u(U,w.length):k=="string"&&U in w)&&p(w[U],F)}function E(F){var U=F&&F.constructor;return F===(typeof U=="function"&&U.prototype||r)}function p(F,U){return F===U||F!==F&&U!==U}function T(F){return n(F)&&i.call(F,"callee")&&(!c.call(F,"callee")||h.call(F)==g)}function _(F){return F!=null&&t(F.length)&&!e(F)}function n(F){return f(F)&&_(F)}function e(F){var U=a(F)?h.call(F):"";return U==v||U==l}function t(F){return typeof F=="number"&&F>-1&&F%1==0&&F<=d}function a(F){var U=typeof F;return!!F&&(U=="object"||U=="function")}function f(F){return!!F&&typeof F=="object"}function s(F){return _(F)?D(F):R(F)}var d=9007199254740991,g="[object Arguments]",v="[object Function]",l="[object GeneratorFunction]",o=/^(?:0|[1-9]\d*)$/,r=Object.prototype,i=r.hasOwnProperty,h=r.toString,c=r.propertyIsEnumerable,S=function(F,U){return function(w){return F(U(w))}}(Object.keys,Object),P=Math.max,C=!c.call({valueOf:1},"valueOf"),x=Array.isArray,B=function(F){return O(function(U,w){var k=-1,K=w.length,N=K>1?w[K-1]:void 0,G=K>2?w[2]:void 0;for(N=F.length>3&&typeof N=="function"?(K--,N):void 0,G&&y(w[0],w[1],G)&&(N=K<3?void 0:N,K=1),U=Object(U);++k<K;){var H=w[k];H&&F(U,H,k,N)}return U})}(function(F,U){if(C||E(U)||_(U))return void A(U,s(U),F);for(var w in U)i.call(U,w)&&M(F,w,U[w])});b.exports=B},function(b,m,I){"use strict";function L(D,M,R){R=R===void 0?1:R,D[M]=D[M]||0,D[M]+=R}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(18),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M=D.default.methodFactory;D.default.methodFactory=function(R,O,A){var u=M(R,O,A);return function(){for(var y=["[mux]"],E=0;E<arguments.length;E++)y.push(arguments[E]);u.apply(void 0,y)}},D.default.setLevel(D.default.getLevel()),m.default=D.default},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=function(R){return M(R)[0]},D=function(R){return M(R)[1]},M=function(R){if(typeof R!="string"||R==="")return["localhost"];var O=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,A=R.match(O)||[],u=A[4],y=void 0;return u&&(y=(u.match(/[^\.]+\.[^\.]+$/)||[])[0]),[u,y]};m.extractHostnameAndDomain=M,m.extractHostname=L,m.extractDomain=D},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(M){var R=16*Math.random()|0;return(M==="x"?R:3&R|8).toString(16)})},D=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)};m.generateUUID=L,m.generateShortID=D},function(b,m,I){"use strict";function L(M){M=M||"";var R={};return M.trim().split(/[\r\n]+/).forEach(function(O){if(O){var A=O.split(": "),u=A.shift();u&&D.indexOf(u.toLowerCase())>=0&&(R[u]=A.join(": "))}}),R}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L;var D=["x-cdn","content-type"]},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0}),m.findMediaElement=m.getMuxPlayerId=void 0;var L=I(6),D=function(R){return R&&R.nodeName!==void 0?(R.muxId||(R.muxId=R.id||(0,L.generateShortID)()),R.muxId):R},M=function(R){var O=void 0;return R&&R.nodeName!==void 0?(O=R,R=D(O)):O=document.querySelector(R),[O,R,O&&O.nodeName?O.nodeName.toLowerCase():""]};m.getMuxPlayerId=D,m.findMediaElement=M},function(b,m,I){"use strict";function L(){return(M.default.doNotTrack||M.default.navigator&&(M.default.navigator.doNotTrack||M.default.navigator.msDoNotTrack))==="1"}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L;var D=I(0),M=function(R){return R&&R.__esModule?R:{default:R}}(D)},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(0),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M={};M.exists=function(){var R=D.default.performance;return(R&&R.timing)!==void 0},M.domContentLoadedEventEnd=function(){var R=D.default.performance,O=R&&R.timing;return O&&O.domContentLoadedEventEnd},M.navigationStart=function(){var R=D.default.performance,O=R&&R.timing;return O&&O.navigationStart},m.default=M},function(b,m,I){"use strict";var L=I(37),D=I(38),M=I(13);b.exports={formats:M,parse:D,stringify:L}},function(b,m,I){"use strict";var L=Object.prototype.hasOwnProperty,D=function(){for(var R=[],O=0;O<256;++O)R.push("%"+((O<16?"0":"")+O.toString(16)).toUpperCase());return R}(),M=function(R){for(var O;R.length;){var A=R.pop();if(O=A.obj[A.prop],Array.isArray(O)){for(var u=[],y=0;y<O.length;++y)O[y]!==void 0&&u.push(O[y]);A.obj[A.prop]=u}}return O};m.arrayToObject=function(R,O){for(var A=O&&O.plainObjects?Object.create(null):{},u=0;u<R.length;++u)R[u]!==void 0&&(A[u]=R[u]);return A},m.merge=function(R,O,A){if(!O)return R;if(typeof O!="object"){if(Array.isArray(R))R.push(O);else{if(typeof R!="object")return[R,O];(A.plainObjects||A.allowPrototypes||!L.call(Object.prototype,O))&&(R[O]=!0)}return R}if(typeof R!="object")return[R].concat(O);var u=R;return Array.isArray(R)&&!Array.isArray(O)&&(u=m.arrayToObject(R,A)),Array.isArray(R)&&Array.isArray(O)?(O.forEach(function(y,E){L.call(R,E)?R[E]&&typeof R[E]=="object"?R[E]=m.merge(R[E],y,A):R.push(y):R[E]=y}),R):Object.keys(O).reduce(function(y,E){var p=O[E];return L.call(y,E)?y[E]=m.merge(y[E],p,A):y[E]=p,y},u)},m.assign=function(R,O){return Object.keys(O).reduce(function(A,u){return A[u]=O[u],A},R)},m.decode=function(R){try{return decodeURIComponent(R.replace(/\+/g," "))}catch{return R}},m.encode=function(R){if(R.length===0)return R;for(var O=typeof R=="string"?R:String(R),A="",u=0;u<O.length;++u){var y=O.charCodeAt(u);y===45||y===46||y===95||y===126||y>=48&&y<=57||y>=65&&y<=90||y>=97&&y<=122?A+=O.charAt(u):y<128?A+=D[y]:y<2048?A+=D[192|y>>6]+D[128|63&y]:y<55296||y>=57344?A+=D[224|y>>12]+D[128|y>>6&63]+D[128|63&y]:(u+=1,y=65536+((1023&y)<<10|1023&O.charCodeAt(u)),A+=D[240|y>>18]+D[128|y>>12&63]+D[128|y>>6&63]+D[128|63&y])}return A},m.compact=function(R){for(var O=[{obj:{o:R},prop:"o"}],A=[],u=0;u<O.length;++u)for(var y=O[u],E=y.obj[y.prop],p=Object.keys(E),T=0;T<p.length;++T){var _=p[T],n=E[_];typeof n=="object"&&n!==null&&A.indexOf(n)===-1&&(O.push({obj:E,prop:_}),A.push(n))}return M(O)},m.isRegExp=function(R){return Object.prototype.toString.call(R)==="[object RegExp]"},m.isBuffer=function(R){return R!=null&&!!(R.constructor&&R.constructor.isBuffer&&R.constructor.isBuffer(R))}},function(b,m,I){"use strict";var L=String.prototype.replace,D=/%20/g;b.exports={default:"RFC3986",formatters:{RFC1738:function(M){return L.call(M,D,"+")},RFC3986:function(M){return M}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(b,m,I){"use strict";function L(_){return _&&_.__esModule?_:{default:_}}function D(_){var n={};for(var e in _)_.hasOwnProperty(e)&&(n[_[e]]=e);return n}function M(_){var n={},e={};return Object.keys(_).forEach(function(t){var a=!1;if(_.hasOwnProperty(t)&&_[t]!==void 0){var f=t.split("_"),s=f[0],d=E[s];d||(O.default.info("Data key word `"+f[0]+"` not expected in "+t),d=s+"_"),f.splice(1).forEach(function(g){g==="url"&&(a=!0),T[g]?d+=T[g]:Number(g)&&Math.floor(Number(g))===Number(g)?d+=g:(O.default.info("Data key word `"+g+"` not expected in "+t),d+="_"+g+"_")}),a?e[d]=_[t]:n[d]=_[t]}}),(0,u.default)(n,e)}Object.defineProperty(m,"__esModule",{value:!0}),m.default=M;var R=I(4),O=L(R),A=I(2),u=L(A),y={a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"},E=D(y),p={ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"},T=D(p)},function(b,m,I){"use strict";b.exports=I(16).default},function(b,m,I){"use strict";function L(g){return g&&g.__esModule?g:{default:g}}Object.defineProperty(m,"__esModule",{value:!0});var D=function(){function g(v,l){var o=[],r=!0,i=!1,h=void 0;try{for(var c,S=v[Symbol.iterator]();!(r=(c=S.next()).done)&&(o.push(c.value),!l||o.length!==l);r=!0);}catch(P){i=!0,h=P}finally{try{!r&&S.return&&S.return()}finally{if(i)throw h}}return o}return function(v,l){if(Array.isArray(v))return v;if(Symbol.iterator in Object(v))return g(v,l);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),M=I(0),R=L(M),O=I(8),A=I(4),u=L(A),y=I(9),E=L(y),p=I(1),T=L(p),_=I(19),n=L(_),e=I(45),t=L(e),a=I(46),f=L(a),s={},d=function g(v){var l=arguments;typeof v=="string"?g.hasOwnProperty(v)?R.default.setTimeout(function(){l=Array.prototype.splice.call(l,1),g[v].apply(null,l)},0):u.default.warn("`"+v+"` is an unknown task"):typeof v=="function"?R.default.setTimeout(function(){v(g)},0):u.default.warn("`"+v+"` is invalid.")};d.loaded=T.default.now(),d.NAME="mux-embed",d.VERSION="4.3.0",d.API_VERSION="2.1",d.PLAYER_TRACKED=!1,d.monitor=function(g,v){return(0,t.default)(d,g,v)},d.destroyMonitor=function(g){var v=(0,O.findMediaElement)(g),l=D(v,1),o=l[0];o&&o.mux&&typeof o.mux.destroy=="function"?o.mux.destroy():u.default.error("A video element monitor for `"+g+"` has not been initialized via `mux.monitor`.")},d.addHLSJS=function(g,v){var l=(0,O.getMuxPlayerId)(g);s[l]?s[l].addHLSJS(v):u.default.error("A monitor for `"+l+"` has not been initialized.")},d.addDashJS=function(g,v){var l=(0,O.getMuxPlayerId)(g);s[l]?s[l].addDashJS(v):u.default.error("A monitor for `"+l+"` has not been initialized.")},d.removeHLSJS=function(g){var v=(0,O.getMuxPlayerId)(g);s[v]?s[v].removeHLSJS():u.default.error("A monitor for `"+v+"` has not been initialized.")},d.removeDashJS=function(g){var v=(0,O.getMuxPlayerId)(g);s[v]?s[v].removeDashJS():u.default.error("A monitor for `"+v+"` has not been initialized.")},d.init=function(g,v){(0,E.default)()&&v&&v.respectDoNotTrack&&u.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var l=(0,O.getMuxPlayerId)(g);s[l]=new n.default(d,l,v)},d.emit=function(g,v,l){var o=(0,O.getMuxPlayerId)(g);s[o]?(s[o].emit(v,l),v==="destroy"&&delete s[o]):u.default.error("A monitor for `"+o+"` has not been initialized.")},R.default!==void 0&&typeof R.default.addEventListener=="function"&&R.default.addEventListener("unload",function(){d.WINDOW_UNLOADING=!0},!1),d.checkDoNotTrack=E.default,d.log=u.default,d.utils=f.default,m.default=d},function(b,m){var I;I=function(){return this}();try{I=I||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(I=window)}b.exports=I},function(b,m,I){var L,D;(function(M,R){"use strict";L=R,(D=typeof L=="function"?L.call(m,I,m,b):L)!==void 0&&(b.exports=D)})(0,function(){"use strict";function M(f,s){var d=f[s];if(typeof d.bind=="function")return d.bind(f);try{return Function.prototype.bind.call(d,f)}catch{return function(){return Function.prototype.apply.apply(d,[f,arguments])}}}function R(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function O(f){return f==="debug"&&(f="log"),typeof console!==T&&(f==="trace"&&_?R:console[f]!==void 0?M(console,f):console.log!==void 0?M(console,"log"):p)}function A(f,s){for(var d=0;d<n.length;d++){var g=n[d];this[g]=d<f?p:this.methodFactory(g,f,s)}this.log=this.debug}function u(f,s,d){return function(){typeof console!==T&&(A.call(this,s,d),this[f].apply(this,arguments))}}function y(f,s,d){return O(f)||u.apply(this,arguments)}function E(f,s,d){function g(h){var c=(n[h]||"silent").toUpperCase();if(typeof window!==T&&r){try{return void(window.localStorage[r]=c)}catch{}try{window.document.cookie=encodeURIComponent(r)+"="+c+";"}catch{}}}function v(){var h;if(typeof window!==T&&r){try{h=window.localStorage[r]}catch{}if(typeof h===T)try{var c=window.document.cookie,S=c.indexOf(encodeURIComponent(r)+"=");S!==-1&&(h=/^([^;]+)/.exec(c.slice(S))[1])}catch{}return o.levels[h]===void 0&&(h=void 0),h}}var l,o=this,r="loglevel";typeof f=="string"?r+=":"+f:typeof f=="symbol"&&(r=void 0),o.name=f,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=d||y,o.getLevel=function(){return l},o.setLevel=function(h,c){if(typeof h=="string"&&o.levels[h.toUpperCase()]!==void 0&&(h=o.levels[h.toUpperCase()]),!(typeof h=="number"&&h>=0&&h<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+h;if(l=h,c!==!1&&g(h),A.call(o,h,f),typeof console===T&&h<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(h){v()||o.setLevel(h,!1)},o.enableAll=function(h){o.setLevel(o.levels.TRACE,h)},o.disableAll=function(h){o.setLevel(o.levels.SILENT,h)};var i=v();i==null&&(i=s==null?"WARN":s),o.setLevel(i,!1)}var p=function(){},T="undefined",_=typeof window!==T&&typeof window.navigator!==T&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],e=new E,t={};e.getLogger=function(f){if(typeof f!="symbol"&&typeof f!="string"||f==="")throw new TypeError("You must supply a name when creating a logger.");var s=t[f];return s||(s=t[f]=new E(f,e.getLevel(),e.methodFactory)),s};var a=typeof window!==T?window.log:void 0;return e.noConflict=function(){return typeof window!==T&&window.log===e&&(window.log=a),e},e.getLoggers=function(){return t},e.default=e,e})},function(b,m,I){"use strict";function L(Z){return Z&&Z.__esModule?Z:{default:Z}}Object.defineProperty(m,"__esModule",{value:!0});var D=function(){function Z(Y,X){var ie=[],le=!0,oe=!1,de=void 0;try{for(var fe,se=Y[Symbol.iterator]();!(le=(fe=se.next()).done)&&(ie.push(fe.value),!X||ie.length!==X);le=!0);}catch(re){oe=!0,de=re}finally{try{!le&&se.return&&se.return()}finally{if(oe)throw de}}return ie}return function(Y,X){if(Array.isArray(Y))return Y;if(Symbol.iterator in Object(Y))return Z(Y,X);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),M=I(4),R=L(M),O=I(2),A=L(O),u=I(6),y=I(5),E=I(0),p=L(E),T=I(10),_=L(T),n=I(3),e=L(n),t=I(20),a=I(21),f=I(22),s=L(f),d=I(23),g=L(d),v=I(24),l=L(v),o=I(25),r=L(o),i=I(26),h=L(i),c=I(27),S=L(c),P=I(28),C=L(P),x=I(29),B=L(x),F=I(30),U=L(F),w=I(31),k=L(w),K=I(32),N=L(K),G=I(33),H=L(G),V=I(34),z=L(V),Q=I(35),q=L(Q),J=I(44),te=L(J),ue=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],$=function(Z,Y,X){var ie=this;this.DOM_CONTENT_LOADED_EVENT_END=_.default.domContentLoadedEventEnd(),this.NAVIGATION_START=_.default.navigationStart();var le={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(re){return re}};this.mux=Z,this.id=Y,X=(0,A.default)(le,X),X.data=X.data||{},X.data.property_key&&(X.data.env_key=X.data.property_key,delete X.data.property_key),R.default.setLevel(X.debug?"debug":"warn"),this.getPlayheadTime=X.getPlayheadTime,this.getStateData=X.getStateData||function(){},this.getAdData=X.getAdData||function(){},this.minimumRebufferDuration=X.minimumRebufferDuration,this.sustainedRebufferThreshold=X.sustainedRebufferThreshold,this.playbackHeartbeatTime=X.playbackHeartbeatTime,this.disableRebufferTracking=X.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=X.errorTranslator,this.playbackEventDispatcher=new q.default(Z,X.data.env_key,X),this.data={player_instance_id:(0,u.generateUUID)(),mux_sample_rate:X.sampleRate,beacon_domain:X.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(re,ae){ae=(0,A.default)({viewer_time:this.mux.utils.now()},ae),this.oldEmit(re,ae)};var oe=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",function(re,ae){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,A.default)(this.data,ae),this._initializeViewData(),this.one("play",oe),this.one("adbreakstart",oe)});var de=function(re){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",re)}.bind(this);this.on("videochange",function(re,ae){de(ae)}),this.on("programchange",function(re,ae){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),de((0,A.default)(ae,{view_program_changed:!0})),oe(),this.emit("play"),this.emit("playing")}),this.on("fragmentchange",function(re,ae){this.currentFragmentPDT=ae.currentFragmentPDT,this.currentFragmentStart=ae.currentFragmentStart}),this.on("destroy",this.destroy);var fe=this.destroy.bind(this);p.default!==void 0&&typeof p.default.addEventListener=="function"&&p.default.addEventListener("unload",fe,!1),this.on("destroy",function(){p.default!==void 0&&typeof p.default.removeEventListener=="function"&&p.default.removeEventListener("unload",fe)}),this.on("playerready",function(re,ae){(0,A.default)(this.data,ae)}),ue.forEach(function(re){ie.on(re,function(ae,pe){re.indexOf("ad")!==0&&this._updateStateData(),(0,A.default)(this.data,pe),this._sanitizeData()}),ie.on("after"+re,function(){(re!=="error"||this.viewErrored)&&this.send(re)})}),this.on("viewend",function(re,ae){(0,A.default)(ie.data,ae)});var se=function(re){var ae=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=ae-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time};this.one("playerready",se),l.default.apply(this),z.default.apply(this),k.default.apply(this),S.default.apply(this),g.default.apply(this),U.default.apply(this),r.default.apply(this),h.default.apply(this),N.default.apply(this),C.default.apply(this),B.default.apply(this),H.default.apply(this),te.default.apply(this),X.hlsjs&&this.addHLSJS(X),X.dashjs&&this.addDashJS(X),this.emit("viewinit",X.data)};(0,A.default)($.prototype,s.default.prototype),(0,A.default)($.prototype,S.default.prototype),(0,A.default)($.prototype,k.default.prototype),(0,A.default)($.prototype,g.default.prototype),(0,A.default)($.prototype,r.default.prototype),(0,A.default)($.prototype,h.default.prototype),(0,A.default)($.prototype,N.default.prototype),(0,A.default)($.prototype,C.default.prototype),(0,A.default)($.prototype,B.default.prototype),$.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),p.default.clearTimeout(this._heartBeatTimeout))},$.prototype.send=function(Z){var Y=(0,A.default)({},this.data);if(Y.player_error_code===1&&(delete Y.player_error_code,delete Y.player_error_message),Y.player_source_duration===1/0||Y.video_source_duration===1/0?Y.video_source_is_live=!0:(Y.player_source_duration>0||Y.video_source_duration>0)&&(Y.video_source_is_live=!1),Y.video_source_url=Y.video_source_url||Y.player_source_url,Y.video_source_url){var X=(0,y.extractHostnameAndDomain)(Y.video_source_url),ie=D(X,2),le=ie[0],oe=ie[1];Y.video_source_domain=oe,Y.video_source_hostname=le}delete Y.ad_request_id,this.playbackEventDispatcher.send(Z,Y),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},$.prototype._updateStateData=function(){(0,A.default)(this.data,this.getStateData()),this._updatePlayheadTime(),this._sanitizeData()},$.prototype._sanitizeData=function(){var Z=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(Y){var X=parseInt(Z.data[Y],10);Z.data[Y]=isNaN(X)?void 0:X}),["player_source_url","video_source_url"].forEach(function(Y){if(Z.data[Y]){var X=Z.data[Y].toLowerCase();X.indexOf("data:")!==0&&X.indexOf("blob:")!==0||(Z.data[Y]="MSE style URL")}})},$.prototype._resetVideoData=function(Z,Y){var X=this;Object.keys(this.data).forEach(function(ie){ie.indexOf("video_")===0&&delete X.data[ie]})},$.prototype._resetViewData=function(){var Z=this;Object.keys(this.data).forEach(function(Y){Y.indexOf("view_")===0&&delete Z.data[Y]}),this.data.view_sequence_number=1},$.prototype._resetErrorData=function(Z,Y){delete this.data.player_error_code,delete this.data.player_error_message},$.prototype._initializeViewData=function(){var Z=this,Y=this.data.view_id=(0,u.generateUUID)(),X=function(){Y===Z.data.view_id&&(0,e.default)(Z.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",X):X()},$.prototype._restartHeartBeat=function(){var Z=this;p.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=p.default.setTimeout(function(){Z.data.player_is_paused||Z.emit("hb")},1e4))},$.prototype.addHLSJS=function(Z){return Z.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=Z.hlsjs,void(0,t.monitorHlsJs)(this.mux,this.id,Z.hlsjs,{},Z.Hls||p.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},$.prototype.removeHLSJS=function(){this.hlsjs&&((0,t.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},$.prototype.addDashJS=function(Z){return Z.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=Z.dashjs,void(0,a.monitorDashJS)(this.mux,this.id,Z.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},$.prototype.removeDashJS=function(){this.dashjs&&((0,a.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},m.default=$},function(b,m,I){"use strict";function L(T){return T&&T.__esModule?T:{default:T}}Object.defineProperty(m,"__esModule",{value:!0}),m.stopMonitoringHlsJs=m.monitorHlsJs=void 0;var D=I(7),M=L(D),R=I(10),O=L(R),A=I(5),u=function(T){if(!T)return{};var _=O.default.navigationStart(),n=T.loading,e=n?n.start:T.trequest,t=n?n.first:T.tfirst,a=n?n.end:T.tload;return{bytesLoaded:T.total,requestStart:Math.round(_+e),responseStart:Math.round(_+t),responseEnd:Math.round(_+a)}},y=function(T){if(T&&typeof T.getAllResponseHeaders=="function")return(0,M.default)(T.getAllResponseHeaders())},E=function(T,_,n){var e=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments[4]),t=T.log,a=T.utils.secondsToMs,f=function(c){var S=parseInt(e.version),P=void 0;return S===1&&c.programDateTime!==null&&(P=c.programDateTime),S===0&&c.pdt!==null&&(P=c.pdt),P};if(!O.default.exists())return void t.warn("performance timing not supported. Not tracking HLS.js.");var s=function(c,S){return T.emit(_,c,S)},d=function(c,S){var P=S.levels,C=S.audioTracks,x=S.url,B=S.stats,F=S.networkDetails,U={},w={};P.forEach(function(V,z){U[z]={width:V.width,height:V.height,bitrate:V.bitrate,attrs:V.attrs}}),C.forEach(function(V,z){w[z]={name:V.name,language:V.lang,bitrate:V.bitrate}});var k=u(B),K=k.bytesLoaded,N=k.requestStart,G=k.responseStart,H=k.responseEnd;s("requestcompleted",{request_event_type:c,request_bytes_loaded:K,request_start:N,request_response_start:G,request_response_end:H,request_type:"manifest",request_hostname:(0,A.extractHostname)(x),request_response_headers:y(F),request_rendition_lists:{media:U,audio:w,video:{}}})};n.on(e.Events.MANIFEST_LOADED,d);var g=function(c,S){var P=S.details,C=S.level,x=S.networkDetails,B=S.stats,F=u(B),U=F.bytesLoaded,w=F.requestStart,k=F.responseStart,K=F.responseEnd,N=P.fragments[P.fragments.length-1],G=f(N)+a(N.duration);s("requestcompleted",{request_event_type:c,request_bytes_loaded:U,request_start:w,request_response_start:k,request_response_end:K,request_current_level:C,request_type:"manifest",request_hostname:(0,A.extractHostname)(P.url),request_response_headers:y(x),video_holdback:P.holdBack&&a(P.holdBack),video_part_holdback:P.partHoldBack&&a(P.partHoldBack),video_part_target_duration:P.partTarget&&a(P.partTarget),video_target_duration:P.targetduration&&a(P.targetduration),player_manifest_newest_program_time:isNaN(G)?void 0:G})};n.on(e.Events.LEVEL_LOADED,g);var v=function(c,S){var P=S.details,C=S.networkDetails,x=S.stats,B=u(x),F=B.bytesLoaded,U=B.requestStart,w=B.responseStart,k=B.responseEnd;s("requestcompleted",{request_event_type:c,request_bytes_loaded:F,request_start:U,request_response_start:w,request_response_end:k,request_type:"manifest",request_hostname:(0,A.extractHostname)(P.url),request_response_headers:y(C)})};n.on(e.Events.AUDIO_TRACK_LOADED,v);var l=function(c,S){var P=S.stats,C=S.networkDetails,x=S.frag,B=u(P),F=B.bytesLoaded,U=B.requestStart,w=B.responseStart,k=B.responseEnd,K={request_event_type:c,request_bytes_loaded:F,request_start:U,request_response_start:w,request_response_end:k,request_hostname:C?(0,A.extractHostname)(C.responseURL):void 0,request_response_headers:y(C),request_media_duration:x.duration};x.type==="main"?(K.request_type="media",K.request_current_level=x.level,K.request_video_width=(n.levels[x.level]||{}).width,K.request_video_height=(n.levels[x.level]||{}).height):K.request_type=x.type,s("requestcompleted",K)};n.on(e.Events.FRAG_LOADED,l);var o=function(c,S){var P=S.frag,C=P.start,x=f(P),B={currentFragmentPDT:x,currentFragmentStart:a(C)};s("fragmentchange",B)};n.on(e.Events.FRAG_CHANGED,o);var r=function(c,S){var P=S.details,C=S.response,x=S.context,B=S.frag;if(P===e.ErrorDetails.MANIFEST_LOAD_ERROR||P===e.ErrorDetails.MANIFEST_LOAD_TIMEOUT||P===e.ErrorDetails.FRAG_LOAD_ERROR||P===e.ErrorDetails.FRAG_LOAD_TIMEOUT||P===e.ErrorDetails.LEVEL_LOAD_ERROR||P===e.ErrorDetails.LEVEL_LOAD_TIMEOUT){var F=B&&B.url||x&&x.url||"";s("requestfailed",{request_error:P,request_url:F,request_hostname:(0,A.extractHostname)(F),request_type:P===e.ErrorDetails.FRAG_LOAD_ERROR||P===e.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:C&&C.code,request_error_text:C&&C.text})}};n.on(e.Events.ERROR,r);var i=function(c,S){var P=S.frag,C=P&&P._url||"";s("requestcanceled",{request_cancel:c,request_url:C,request_type:"media",request_hostname:(0,A.extractHostname)(C)})};n.on(e.Events.FRAG_LOAD_EMERGENCY_ABORTED,i);var h=function(c,S){var P=S.level,C=n.levels[P];if(C&&C.attrs&&C.attrs.BANDWIDTH){var x=C.attrs.BANDWIDTH;x?s("renditionchange",{video_source_bitrate:x,video_source_width:C.width,video_source_height:C.height}):t.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};n.on(e.Events.LEVEL_SWITCHED,h),n._stopMuxMonitor=function(){n.off(e.Events.MANIFEST_LOADED,d),n.off(e.Events.LEVEL_LOADED,g),n.off(e.Events.AUDIO_TRACK_LOADED,v),n.off(e.Events.FRAG_LOADED,l),n.off(e.Events.FRAG_CHANGED,o),n.off(e.Events.ERROR,r),n.off(e.Events.FRAG_LOAD_EMERGENCY_ABORTED,i),n.off(e.Events.LEVEL_SWITCHED,h),n.off(e.Events.DESTROYING,n._stopMuxMonitor),delete n._stopMuxMonitor},n.on(e.Events.DESTROYING,n._stopMuxMonitor)},p=function(T){T&&typeof T._stopMuxMonitor=="function"&&T._stopMuxMonitor()};m.monitorHlsJs=E,m.stopMonitoringHlsJs=p},function(b,m,I){"use strict";function L(T){return T&&T.__esModule?T:{default:T}}Object.defineProperty(m,"__esModule",{value:!0}),m.stopMonitoringDashJS=m.monitorDashJS=void 0;var D=I(0),M=L(D),R=I(7),O=L(R),A=I(5),u=function(T,_){if(!T||typeof T.getRequests!="function")return{};var n=T.getRequests({state:"executed"});if(n.length===0)return{};var e=n[n.length-1],t=(0,A.extractHostname)(e.url),a=e.bytesLoaded,f=new Date(e.requestStartDate).getTime(),s=new Date(e.firstByteDate).getTime(),d=new Date(e.requestEndDate).getTime(),g=isNaN(e.duration)?0:e.duration,v=typeof _.getMetricsFor=="function"?_.getMetricsFor(e.mediaType).HttpList:_.getDashMetrics().getHttpRequests(e.mediaType),l=void 0;return v.length>0&&(l=(0,O.default)(v[v.length-1]._responseHeaders||"")),{requestStart:f,requestResponseStart:s,requestResponseEnd:d,requestBytesLoaded:a,requestResponseHeaders:l,requestMediaDuration:g,requestHostname:t}},y=function(T,_){var n=_.getQualityFor(T),e=_.getCurrentTrackFor(T),t=e.bitrateList;return t?{currentLevel:n,renditionWidth:t[n].width||null,renditionHeight:t[n].height||null,renditionBitrate:t[n].bandwidth}:{}},E=function(T,_,n){var e=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],T.log);if(!n||!n.on)return void e.warn("Invalid dash.js player reference. Monitoring blocked.");var t=function(r,i){return T.emit(_,r,i)},a=function(r){var i=r.type,h=r.data,c=h||{},S=c.url;t("requestcompleted",{request_event_type:i,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,A.extractHostname)(S)})};n.on("manifestLoaded",a);var f={},s=function(r){var i=r.type,h=r.fragmentModel,c=r.chunk,S=c||{},P=S.mediaInfo,C=P||{},x=C.type,B=C.bitrateList;B=B||[];var F={};B.forEach(function(V,z){F[z]={},F[z].width=V.width,F[z].height=V.height,F[z].bitrate=V.bandwidth,F[z].attrs={}}),x==="video"?f.video=F:x==="audio"?f.audio=F:f.media=F;var U=u(h,n),w=U.requestStart,k=U.requestResponseStart,K=U.requestResponseEnd,N=U.requestResponseHeaders,G=U.requestMediaDuration,H=U.requestHostname;t("requestcompleted",{request_event_type:i,request_start:w,request_response_start:k,request_response_end:K,request_bytes_loaded:-1,request_type:x+"_init",request_response_headers:N,request_hostname:H,request_media_duration:G,request_rendition_lists:f})};n.on("initFragmentLoaded",s);var d=function(r){var i=r.type,h=r.fragmentModel,c=r.chunk,S=c||{},P=S.mediaInfo,C=S.start,x=P||{},B=x.type,F=u(h,n),U=F.requestStart,w=F.requestResponseStart,k=F.requestResponseEnd,K=F.requestBytesLoaded,N=F.requestResponseHeaders,G=F.requestMediaDuration,H=F.requestHostname,V=y(B,n),z=V.currentLevel,Q=V.renditionWidth,q=V.renditionHeight,J=V.renditionBitrate;t("requestcompleted",{request_event_type:i,request_start:U,request_response_start:w,request_response_end:k,request_bytes_loaded:K,request_type:B,request_response_headers:N,request_hostname:H,request_media_start_time:C,request_media_duration:G,request_current_level:z,request_labeled_bitrate:J,request_video_width:Q,request_video_height:q})};n.on("mediaFragmentLoaded",d);var g={video:void 0,audio:void 0,totalBitrate:void 0},v=function(){if(g.video&&typeof g.video.bitrate=="number"){if(!g.video.width||!g.video.height)return void e.warn("have bitrate info for video but missing width/height");var r=g.video.bitrate;return g.audio&&typeof g.audio.bitrate=="number"&&(r+=g.audio.bitrate),r!==g.totalBitrate?(g.totalBitrate=r,{video_source_bitrate:r,video_source_height:g.video.height,video_source_width:g.video.width}):void 0}},l=function(r,i,h){if(typeof r.newQuality!="number")return void e.warn("missing evt.newQuality in qualityChangeRendered event",r);var c=r.mediaType;if(c==="audio"||c==="video"){var S=n.getBitrateInfoListFor(c).find(function(C){return C.qualityIndex===r.newQuality});if(!S||typeof S.bitrate!="number")return void e.warn("missing bitrate info for "+c);g[c]=S;var P=v();P&&t("renditionchange",P)}};n.on("qualityChangeRendered",l);var o=function(r){var i=r.error,h=r.event;h=h||{};var c=h.request||{},S=M.default.event&&M.default.event.currentTarget||{};t("requestfailed",{request_error:i+"_"+h.id+"_"+c.type,request_url:h.url,request_hostname:(0,A.extractHostname)(h.url),request_type:c.mediaType,request_error_code:S.status,request_error_type:S.statusText})};n.on("error",o),n._stopMuxMonitor=function(){n.off("manifestLoaded",a),n.off("initFragmentLoaded",s),n.off("mediaFragmentLoaded",d),n.off("qualityChangeRendered",l),n.off("error",o),delete n._stopMuxMonitor}},p=function(T){T&&typeof T._stopMuxMonitor=="function"&&T._stopMuxMonitor()};m.monitorDashJS=E,m.stopMonitoringDashJS=p},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=function(){},D=0;L.prototype.on=function(M,R,O){return R._eventEmitterGuid=R._eventEmitterGuid||++D,this._listeners=this._listeners||{},this._listeners[M]=this._listeners[M]||[],O&&(R=R.bind(O)),this._listeners[M].push(R),R},L.prototype.off=function(M,R){var O=this._listeners&&this._listeners[M];O&&O.forEach(function(A,u){A._eventEmitterGuid===R._eventEmitterGuid&&O.splice(u,1)})},L.prototype.one=function(M,R,O){var A=this;R._eventEmitterGuid=R._eventEmitterGuid||++D;var u=function y(){A.off(M,y),R.apply(O||this,arguments)};u._eventEmitterGuid=R._eventEmitterGuid,this.on(M,u)},L.prototype.emit=function(M,R){var O=this;if(this._listeners){R=R||{};var A=this._listeners["before*"]||[],u=this._listeners[M]||[],y=this._listeners["after"+M]||[],E=function(p,T){p=p.slice(),p.forEach(function(_){_.call(O,{type:M},T)})};E(A,R),E(u,R),E(y,R)}},m.default=L},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(0),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",function(){this._playheadShouldBeProgressing=!0}),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()}),this.on("timeupdate",function(){this._playbackHeartbeatInterval!==null&&this.emit("playbackheartbeat")}),this.on("devicesleep",function(R,O){this._playbackHeartbeatInterval!==null&&(D.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:O.viewer_time}),this._playbackHeartbeatInterval=null)})};M.prototype._startPlaybackHeartbeatInterval=function(){var R=this;this._playbackHeartbeatInterval===null&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=D.default.setInterval(function(){R.emit("playbackheartbeat")},this.playbackHeartbeatTime))},M.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(D.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},m.default=M},function(b,m,I){"use strict";function L(){var D=this;this.on("viewinit",function(){D.viewErrored=!1}),this.on("error",function(){try{var M=D.errorTranslator({player_error_code:D.data.player_error_code,player_error_message:D.data.player_error_message});M?(D.data.player_error_code=M.player_error_code,D.data.player_error_message=M.player_error_message,D.viewErrored=!0):(delete D.data.player_error_code,delete D.data.player_error_message)}catch(R){D.mux.log.warn("Exception in error translator callback.",R),D.viewErrored=!0}})}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(3),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};M.prototype._updateWatchTime=function(R,O){var A=O.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=A),(0,D.default)(this.data,"view_watch_time",A-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=A},M.prototype._clearWatchTimeState=function(R,O){this._updateWatchTime(R,O),this._watchTimeTrackerLastCheckedTime=null},m.default=M},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(3),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};M.prototype._updatePlaybackTime=function(){var R=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&R>this._playbackTimeTrackerLastPlayheadPosition){var O=R-this._playbackTimeTrackerLastPlayheadPosition;O<=1e3&&(0,D.default)(this.data,"view_content_playback_time",O)}this._playbackTimeTrackerLastPlayheadPosition=R},M.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},m.default=M},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",function(){this.off("timeupdate",this._updatePlayheadTime)})};L.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=this.data.view_max_playhead_position===void 0?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},L.prototype._updatePlayheadTime=function(D,M){if(M&&M.player_playhead_time)this.data.player_playhead_time=M.player_playhead_time,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+M.player_playhead_time-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var R=this.getPlayheadTime();R!==void 0&&(this.data.player_playhead_time=R,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+R-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition())}},m.default=L},function(b,m,I){"use strict";function L(u){return u&&u.__esModule?u:{default:u}}Object.defineProperty(m,"__esModule",{value:!0});var D=I(1),M=L(D),R=I(3),O=L(R),A=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",function(){this._cleanupRebufferTracker(null,{viewer_time:M.default.now()})})};A.prototype._checkIfRebuffering=function(u,y){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(u,y);if(this._lastCheckedTime===null)return this._prepareRebufferTrackerState(y.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(u,y,!0);var E=y.viewer_time-this._lastPlayheadTimeUpdatedTime;E>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(y.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,O.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(E),this.emit("rebufferstart"))),this._lastCheckedTime=y.viewer_time}},A.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},A.prototype._prepareRebufferTrackerState=function(u){this._lastCheckedTime=u,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=u},A.prototype._cleanupRebufferTracker=function(u,y){var E=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(y.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:y.viewer_time});else{if(this._lastCheckedTime===null)return void this._updateRebufferMetrics();var p=this.data.player_playhead_time-this._lastPlayheadTime,T=y.viewer_time-this._lastPlayheadTimeUpdatedTime;p>0&&T-p>this.minimumRebufferDuration?((0,O.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(T-p),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+T-p})):this._updateRebufferMetrics()}E?this._prepareRebufferTrackerState(y.viewer_time):this._clearRebufferTrackerState()}},A.prototype._updateRebufferMetrics=function(u){u>0&&(0,O.default)(this.data,"view_rebuffer_duration",u),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},m.default=A},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(1),D=function(R){return R&&R.__esModule?R:{default:R}}(L),M=function(){this.on("viewinit",function(){var R=this.data,O=R.view_id;if(!R.view_program_changed){var A=function(u,y){var E=y.viewer_time;u.type==="playing"&&this.data.view_time_to_first_frame===void 0?this.calculateTimeToFirstFrame(E||D.default.now(),O):u.type!=="adplaying"||this.data.view_time_to_first_frame!==void 0&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(E||D.default.now(),O)};this.one("playing",A),this.one("adplaying",A),this.one("viewend",function(){this.off("playing",A),this.off("adplaying",A)})}})};M.prototype.calculateTimeToFirstFrame=function(R,O){O===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:R}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},m.default=M},function(b,m,I){"use strict";function L(){var R=this;this.on("viewinit",function(){this._lastPlayheadPosition=-1});var O=["pause","rebufferstart","seeking","error","adbreakstart","hb"],A=["playing","hb"];O.forEach(function(u){R.on(u,function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var y=this.data.player_playhead_time-this._lastPlayheadPosition;if(y<0)return void(this._lastPlayheadPosition=-1);var E=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),p=Math.max(0,E-1),T=Math.max(0,1-E);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,p),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,T),(0,M.default)(this.data,"view_total_content_playback_time",y),(0,M.default)(this.data,"view_total_upscaling",p*y),(0,M.default)(this.data,"view_total_downscaling",T*y)}this._lastPlayheadPosition=-1})}),A.forEach(function(u){R.on(u,function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height})})}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L;var D=I(3),M=function(R){return R&&R.__esModule?R:{default:R}}(D)},function(b,m,I){"use strict";function L(E){return E&&E.__esModule?E:{default:E}}function D(){this.isSeeking=!1,this.on("seeking",function(E,p){(0,y.default)(this.data,p),this._lastSeekingTime=R.default.now(),this.isSeeking===!1&&(this.isSeeking=!0,this.send("seeking"))}),this.on("seeked",function(){this.isSeeking=!1;var E=this._lastSeekingTime||R.default.now(),p=R.default.now()-E;(0,A.default)(this.data,"view_seek_count",1),(0,A.default)(this.data,"view_seek_duration",p);var T=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(T,p)}),this.on("viewend",function(){this.isSeeking=!1})}Object.defineProperty(m,"__esModule",{value:!0}),m.default=D;var M=I(1),R=L(M),O=I(3),A=L(O),u=I(2),y=L(u)},function(b,m,I){"use strict";function L(T){return T&&T.__esModule?T:{default:T}}Object.defineProperty(m,"__esModule",{value:!0});var D=function(){function T(_,n){var e=[],t=!0,a=!1,f=void 0;try{for(var s,d=_[Symbol.iterator]();!(t=(s=d.next()).done)&&(e.push(s.value),!n||e.length!==n);t=!0);}catch(g){a=!0,f=g}finally{try{!t&&d.return&&d.return()}finally{if(a)throw f}}return e}return function(_,n){if(Array.isArray(_))return _;if(Symbol.iterator in Object(_))return T(_,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),M=I(3),R=L(M),O=I(5),A=I(2),u=L(A),y=function(T,_){T.push(_),T.sort(function(n,e){return n.viewer_time-e.viewer_time})},E=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],p=function(){var T=this;this.on("viewinit",function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0}),E.forEach(function(n){return T.on(n,T._updateAdData)});var _=function(){T.isAdBreak=!1};this.on("adbreakstart",function(){this.isAdBreak=!0}),this.on("play",_),this.on("playing",_),this.on("viewend",_),this.on("adrequest",function(n,e){e=(0,u.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},e),y(this._adRequests,e),(0,R.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,R.default)(this.data,"view_preroll_request_count"))}),this.on("adresponse",function(n,e){e=(0,u.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},e),y(this._adResponses,e);var t=this.findAdRequest(e.ad_request_id);t&&(0,R.default)(this.data,"view_ad_request_time",Math.max(0,e.viewer_time-t.viewer_time))}),this.on("adplay",function(n,e){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,R.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,e.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,e.viewer_time-this.data.view_start)),this._prerollPlayTime=e.viewer_time)}),this.on("adplaying",function(n,e){this.inPrerollPosition()&&this.data.view_preroll_load_time===void 0&&this._prerollPlayTime!==void 0&&(this.data.view_preroll_load_time=e.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=e.viewer_time-this._prerollPlayTime)}),this.on("adended",function(){this._wouldBeNewAdPlay=!0}),this.on("aderror",function(){this._wouldBeNewAdPlay=!0})};p.prototype.inPrerollPosition=function(){return this.data.view_content_playback_time===void 0||this.data.view_content_playback_time<=1e3},p.prototype.findAdRequest=function(T){for(var _=0;_<this._adRequests.length;_++)if(this._adRequests[_].ad_request_id===T)return this._adRequests[_]},p.prototype._updateAdData=function(T,_){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&_.ad_tag_url){var n=(0,O.extractHostnameAndDomain)(_.ad_tag_url),e=D(n,2),t=e[0],a=e[1];this.data.view_preroll_ad_tag_domain=a,this.data.view_preroll_ad_tag_hostname=t}if(!this.data.view_preroll_ad_asset_hostname&&_.ad_asset_url){var f=(0,O.extractHostnameAndDomain)(_.ad_asset_url),s=D(f,2),d=s[0],g=s[1];this.data.view_preroll_ad_asset_domain=g,this.data.view_preroll_ad_asset_hostname=d}}},m.default=p},function(b,m,I){"use strict";function L(u){return u&&u.__esModule?u:{default:u}}function D(){var u=this,y=void 0,E=void 0,p=function(){u.disableRebufferTracking||((0,A.default)(u.data,"view_waiting_rebuffer_count",1),y=R.default.now(),E=window.setInterval(function(){if(y){var t=R.default.now();(0,A.default)(u.data,"view_waiting_rebuffer_duration",t-y),y=t}},250))},T=function(){u.disableRebufferTracking||y&&((0,A.default)(u.data,"view_waiting_rebuffer_duration",R.default.now()-y),y=!1,window.clearInterval(E))},_=!1,n=function(){_=!0},e=function(){_=!1,T()};this.on("waiting",function(){_&&p()}),this.on("playing",function(){T(),n()}),this.on("pause",e),this.on("seeking",e)}Object.defineProperty(m,"__esModule",{value:!0}),m.default=D;var M=I(1),R=L(M),O=I(3),A=L(O)},function(b,m,I){"use strict";function L(E){return E&&E.__esModule?E:{default:E}}function D(){var E=this;this.one("playbackheartbeat",u),this.on("playbackheartbeatend",function(){E.off("before*",y),E.one("playbackheartbeat",u)})}Object.defineProperty(m,"__esModule",{value:!0}),m.default=D;var M=I(2),R=L(M),O=I(1),A=L(O),u=function(){this.lastWallClockTime=A.default.now(),this.on("before*",y)},y=function(E){var p=A.default.now(),T=this.lastWallClockTime;this.lastWallClockTime=p,p-T>3e4&&(this.emit("devicesleep",{viewer_time:T}),(0,R.default)(this.data,{viewer_time:T}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:p}),(0,R.default)(this.data,{viewer_time:p}),this.send("devicewake"))}},function(b,m,I){"use strict";function L(i){return i&&i.__esModule?i:{default:i}}Object.defineProperty(m,"__esModule",{value:!0});var D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},M=I(0),R=L(M),O=I(36),A=I(4),u=L(A),y=I(40),E=L(y),p=I(9),T=L(p),_=I(41),n=L(_),e=I(14),t=L(e),a=I(42),f=L(a),s=I(2),d=L(s),g=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],v=["viewstart","error","ended","viewend"],l=function(i,h){var c=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=i,this.envKey=h,this.eventQueue=new f.default((0,E.default)(h,c.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=c.sampleRate,this.disableCookies=c.disableCookies,this.respectDoNotTrack=c.respectDoNotTrack;var S=c.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:S.name,viewer_application_version:S.version,viewer_application_engine:S.layout,viewer_device_name:S.product,viewer_device_category:"",viewer_device_manufacturer:S.manufacturer,viewer_os_family:S.os&&S.os.family,viewer_os_architecture:S.os&&S.os.architecture,viewer_os_version:S.os&&S.os.version};var P=(0,n.default)();P&&(this.pageLevelData=(0,d.default)(this.pageLevelData,{viewer_connection_type:P})),R.default!==void 0&&R.default.location&&R.default.location.href&&(this.pageLevelData.page_url=R.default.location.href),this.viewerData=this.disableCookies?{}:(0,O.getAndUpdateViewerData)()};l.prototype.send=function(i,h){if(i){if(this.respectDoNotTrack&&(0,T.default)())return u.default.info("Not sending `"+i+"` because Do Not Track is enabled");if(!h||(h===void 0?"undefined":D(h))!=="object")return u.default.error("A data object was expected in send() but was not provided");var c=this.disableCookies?{}:(0,O.getAndUpdateSessionData)(),S={};(0,d.default)(S,this.pageLevelData),(0,d.default)(S,h),(0,d.default)(S,c),(0,d.default)(S,this.viewerData),S.event=i,S.env_key=this.envKey,S.user_id&&(S.viewer_user_id=S.user_id,delete S.user_id);var P=S.mux_sample_number>=this.sampleRate,C=this._deduplicateBeaconData(i,S),x=(0,t.default)(C);if(this.lastEventTime=this.mux.utils.now(),P)return u.default.info("Not sending event due to sample rate restriction",i,S,x);if(!this.envKey)return u.default.info("Not sending event due to missing environment key",i,S,x);if(!this.rateLimited){if(u.default.info("Sending event",i,S,x),this.rateLimited=!this.eventQueue.queueEvent(i,x),this.mux.WINDOW_UNLOADING&&i==="viewend")this.eventQueue.destroy(!0);else if(v.indexOf(i)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return S.event="eventrateexceeded",x=(0,t.default)(S),this.eventQueue.queueEvent(S.event,x),u.default.error("Beaconing disabled due to rate limit.")}}},l.prototype.destroy=function(){this.eventQueue.destroy(!1)};var o=function(i,h,c,S){return!(!i||h.indexOf("request_")!==0)&&(h==="request_response_headers"||(c===void 0?"undefined":D(c))!=="object"||(S===void 0?"undefined":D(S))!=="object"||Object.keys(c||{}).length!==Object.keys(S||{}).length)},r=function(i,h){return i==="renditionchange"&&h.indexOf("video_source_")===0};l.prototype._deduplicateBeaconData=function(i,h){var c=this,S={},P=h.view_id;if(!P||i==="viewstart"||i==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)S=(0,d.default)({},h),P&&(this.previousBeaconData=S),P&&i==="viewend"&&(this.previousBeaconData=null);else{var C=i.indexOf("request")===0;Object.keys(h).forEach(function(x){var B=h[x];(B!==c.previousBeaconData[x]||g.indexOf(x)>-1||o(C,x,B,c.previousBeaconData[x])||r(i,x))&&(S[x]=B,c.previousBeaconData[x]=B)})}return S},m.default=l},function(b,m,I){"use strict";function L(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(m,"__esModule",{value:!0}),m.getAndUpdateSessionData=m.getAndUpdateViewerData=void 0;var D=I(11),M=L(D),R=I(39),O=L(R),A=I(6),u=I(1),y=L(u),E=function(){var n=void 0;try{n=M.default.parse(O.default.get("muxData")||"")}catch{n={}}return n},p=function(n){try{O.default.set("muxData",M.default.stringify(n),{expires:7300})}catch{}},T=function(){var n=E();return n.mux_viewer_id=n.mux_viewer_id||(0,A.generateUUID)(),n.msn=n.msn||Math.random(),p(n),{mux_viewer_id:n.mux_viewer_id,mux_sample_number:n.msn}},_=function(){var n=E(),e=y.default.now();return n.session_start&&(n.sst=n.session_start,delete n.session_start),n.session_id&&(n.sid=n.session_id,delete n.session_id),n.session_expires&&(n.sex=n.session_expires,delete n.session_expires),(!n.sex||n.sex<e)&&(n.sid=(0,A.generateUUID)(),n.sst=e),n.sex=e+15e5,p(n),{session_id:n.sid,session_start:n.sst,session_expires:n.sex}};m.getAndUpdateViewerData=T,m.getAndUpdateSessionData=_},function(b,m,I){"use strict";var L=I(12),D=I(13),M={brackets:function(u){return u+"[]"},indices:function(u,y){return u+"["+y+"]"},repeat:function(u){return u}},R=Date.prototype.toISOString,O={delimiter:"&",encode:!0,encoder:L.encode,encodeValuesOnly:!1,serializeDate:function(u){return R.call(u)},skipNulls:!1,strictNullHandling:!1},A=function u(y,E,p,T,_,n,e,t,a,f,s,d){var g=y;if(typeof e=="function")g=e(E,g);else if(g instanceof Date)g=f(g);else if(g===null){if(T)return n&&!d?n(E,O.encoder):E;g=""}if(typeof g=="string"||typeof g=="number"||typeof g=="boolean"||L.isBuffer(g))return n?[s(d?E:n(E,O.encoder))+"="+s(n(g,O.encoder))]:[s(E)+"="+s(String(g))];var v=[];if(g===void 0)return v;var l;if(Array.isArray(e))l=e;else{var o=Object.keys(g);l=t?o.sort(t):o}for(var r=0;r<l.length;++r){var i=l[r];_&&g[i]===null||(v=Array.isArray(g)?v.concat(u(g[i],p(E,i),p,T,_,n,e,t,a,f,s,d)):v.concat(u(g[i],E+(a?"."+i:"["+i+"]"),p,T,_,n,e,t,a,f,s,d)))}return v};b.exports=function(u,y){var E=u,p=y?L.assign({},y):{};if(p.encoder!==null&&p.encoder!==void 0&&typeof p.encoder!="function")throw new TypeError("Encoder has to be a function.");var T=p.delimiter===void 0?O.delimiter:p.delimiter,_=typeof p.strictNullHandling=="boolean"?p.strictNullHandling:O.strictNullHandling,n=typeof p.skipNulls=="boolean"?p.skipNulls:O.skipNulls,e=typeof p.encode=="boolean"?p.encode:O.encode,t=typeof p.encoder=="function"?p.encoder:O.encoder,a=typeof p.sort=="function"?p.sort:null,f=p.allowDots!==void 0&&p.allowDots,s=typeof p.serializeDate=="function"?p.serializeDate:O.serializeDate,d=typeof p.encodeValuesOnly=="boolean"?p.encodeValuesOnly:O.encodeValuesOnly;if(p.format===void 0)p.format=D.default;else if(!Object.prototype.hasOwnProperty.call(D.formatters,p.format))throw new TypeError("Unknown format option provided.");var g,v,l=D.formatters[p.format];typeof p.filter=="function"?(v=p.filter,E=v("",E)):Array.isArray(p.filter)&&(v=p.filter,g=v);var o=[];if(typeof E!="object"||E===null)return"";var r;r=p.arrayFormat in M?p.arrayFormat:"indices"in p?p.indices?"indices":"repeat":"indices";var i=M[r];g||(g=Object.keys(E)),a&&g.sort(a);for(var h=0;h<g.length;++h){var c=g[h];n&&E[c]===null||(o=o.concat(A(E[c],c,i,_,n,e?t:null,v,a,f,s,l,d)))}var S=o.join(T),P=p.addQueryPrefix===!0?"?":"";return S.length>0?P+S:""}},function(b,m,I){"use strict";var L=I(12),D=Object.prototype.hasOwnProperty,M={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:L.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},R=function(u,y){for(var E={},p=y.ignoreQueryPrefix?u.replace(/^\?/,""):u,T=y.parameterLimit===1/0?void 0:y.parameterLimit,_=p.split(y.delimiter,T),n=0;n<_.length;++n){var e,t,a=_[n],f=a.indexOf("]="),s=f===-1?a.indexOf("="):f+1;s===-1?(e=y.decoder(a,M.decoder),t=y.strictNullHandling?null:""):(e=y.decoder(a.slice(0,s),M.decoder),t=y.decoder(a.slice(s+1),M.decoder)),D.call(E,e)?E[e]=[].concat(E[e]).concat(t):E[e]=t}return E},O=function(u,y,E){for(var p=y,T=u.length-1;T>=0;--T){var _,n=u[T];if(n==="[]")_=[],_=_.concat(p);else{_=E.plainObjects?Object.create(null):{};var e=n.charAt(0)==="["&&n.charAt(n.length-1)==="]"?n.slice(1,-1):n,t=parseInt(e,10);!isNaN(t)&&n!==e&&String(t)===e&&t>=0&&E.parseArrays&&t<=E.arrayLimit?(_=[],_[t]=p):_[e]=p}p=_}return p},A=function(u,y,E){if(u){var p=E.allowDots?u.replace(/\.([^.[]+)/g,"[$1]"):u,T=/(\[[^[\]]*])/,_=/(\[[^[\]]*])/g,n=T.exec(p),e=n?p.slice(0,n.index):p,t=[];if(e){if(!E.plainObjects&&D.call(Object.prototype,e)&&!E.allowPrototypes)return;t.push(e)}for(var a=0;(n=_.exec(p))!==null&&a<E.depth;){if(a+=1,!E.plainObjects&&D.call(Object.prototype,n[1].slice(1,-1))&&!E.allowPrototypes)return;t.push(n[1])}return n&&t.push("["+p.slice(n.index)+"]"),O(t,y,E)}};b.exports=function(u,y){var E=y?L.assign({},y):{};if(E.decoder!==null&&E.decoder!==void 0&&typeof E.decoder!="function")throw new TypeError("Decoder has to be a function.");if(E.ignoreQueryPrefix=E.ignoreQueryPrefix===!0,E.delimiter=typeof E.delimiter=="string"||L.isRegExp(E.delimiter)?E.delimiter:M.delimiter,E.depth=typeof E.depth=="number"?E.depth:M.depth,E.arrayLimit=typeof E.arrayLimit=="number"?E.arrayLimit:M.arrayLimit,E.parseArrays=E.parseArrays!==!1,E.decoder=typeof E.decoder=="function"?E.decoder:M.decoder,E.allowDots=typeof E.allowDots=="boolean"?E.allowDots:M.allowDots,E.plainObjects=typeof E.plainObjects=="boolean"?E.plainObjects:M.plainObjects,E.allowPrototypes=typeof E.allowPrototypes=="boolean"?E.allowPrototypes:M.allowPrototypes,E.parameterLimit=typeof E.parameterLimit=="number"?E.parameterLimit:M.parameterLimit,E.strictNullHandling=typeof E.strictNullHandling=="boolean"?E.strictNullHandling:M.strictNullHandling,u===""||u===null||u===void 0)return E.plainObjects?Object.create(null):{};for(var p=typeof u=="string"?R(u,E):u,T=E.plainObjects?Object.create(null):{},_=Object.keys(p),n=0;n<_.length;++n){var e=_[n],t=A(e,p[e],E);T=L.merge(T,t,E)}return L.compact(T)}},function(b,m,I){"use strict";var L,D,M=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R};(function(R){var O=!1;if(L=R,(D=typeof L=="function"?L.call(m,I,m,b):L)!==void 0&&(b.exports=D),O=!0,M(m)==="object"&&(b.exports=R(),O=!0),!O){var A=window.Cookies,u=window.Cookies=R();u.noConflict=function(){return window.Cookies=A,u}}})(function(){function R(A){function u(y,E,p){var T;if(typeof document!="undefined"){if(arguments.length>1){if(p=O({path:"/"},u.defaults,p),typeof p.expires=="number"){var _=new Date;_.setMilliseconds(_.getMilliseconds()+864e5*p.expires),p.expires=_}try{T=JSON.stringify(E),/^[\{\[]/.test(T)&&(E=T)}catch{}return E=A.write?A.write(E,y):encodeURIComponent(String(E)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),y=encodeURIComponent(String(y)),y=y.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),y=y.replace(/[\(\)]/g,escape),document.cookie=[y,"=",E,p.expires?"; expires="+p.expires.toUTCString():"",p.path?"; path="+p.path:"",p.domain?"; domain="+p.domain:"",p.secure?"; secure":""].join("")}y||(T={});for(var n=document.cookie?document.cookie.split("; "):[],e=/(%[0-9A-Z]{2})+/g,t=0;t<n.length;t++){var a=n[t].split("="),f=a.slice(1).join("=");f.charAt(0)==='"'&&(f=f.slice(1,-1));try{var s=a[0].replace(e,decodeURIComponent);if(f=A.read?A.read(f,s):A(f,s)||f.replace(e,decodeURIComponent),this.json)try{f=JSON.parse(f)}catch{}if(y===s){T=f;break}y||(T[s]=f)}catch{}}return T}}return u.set=u,u.get=function(y){return u.call(u,y)},u.getJSON=function(){return u.apply({json:!0},[].slice.call(arguments))},u.defaults={},u.remove=function(y,E){u(y,"",O(E,{expires:-1}))},u.withConverter=R,u}var O=function(){for(var A=0,u={};A<arguments.length;A++){var y=arguments[A];for(var E in y)u[E]=y[E]}return u};return R(function(){})})},function(b,m,I){"use strict";function L(D,M){return D=D||"",M=M||"litix.io",D.match(/^[a-z0-9]+$/)?"https://"+D+"."+M:"https://img.litix.io/a.gif"}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L},function(b,m,I){"use strict";Object.defineProperty(m,"__esModule",{value:!0});var L=I(0),D=function(O){return O&&O.__esModule?O:{default:O}}(L),M=function(){var O=void 0;switch(R()){case"cellular":O="cellular";break;case"ethernet":O="wired";break;case"wifi":O="wifi";break;case void 0:break;default:O="other"}return O},R=function(){var O=D.default.navigator,A=O&&(O.connection||O.mozConnection||O.webkitConnection);return A&&A.type};m.default=M},function(b,m,I){"use strict";function L(f){return f&&f.__esModule?f:{default:f}}Object.defineProperty(m,"__esModule",{value:!0});var D=I(0),M=L(D),R=I(4),O=L(R),A=I(43),u=L(A),y=I(2),E=L(y),p=I(14),T=L(p),_=I(1),n=L(_),e=!!M.default.XMLHttpRequest&&"withCredentials"in new M.default.XMLHttpRequest,t={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},a=function(f,s){this._beaconUrl=f||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,E.default)({},t,s)};a.prototype.queueEvent=function(f,s){var d=(0,E.default)({},s);return e?(this._eventQueue.length<=this._options.maxQueueLength||f==="eventrateexceeded")&&(this._eventQueue.push(d),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(u.default.send(this._beaconUrl,d),!0)},a.prototype.flushEvents=function(){e&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},a.prototype.destroy=function(){var f=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,f?this._clearBeaconQueue():this.flushEvents(),M.default.clearTimeout(this._sendTimeout)},a.prototype._clearBeaconQueue=function(){var f=M.default.navigator,s=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,d=this._eventQueue.slice(s);s>0&&(0,E.default)(d[d.length-1],(0,T.default)({mux_view_message:"event queue truncated"}));var g=this._createPayload(d);if(f.sendBeacon)f.sendBeacon(this._beaconUrl,g);else if(M.default.XMLHttpRequest){var v=new M.default.XMLHttpRequest;v.open("POST",this._beaconUrl),v.setRequestHeader("Content-Type","application/json"),v.send(g)}else u.default.send(this._beaconUrl,d[d.length-1])},a.prototype._sendBeaconQueue=function(){var f=this;if(M.default.XMLHttpRequest&&!this._postInFlight){var s=new M.default.XMLHttpRequest,d=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,s.onreadystatechange=function(){s.readyState===4&&(s.status!==200?(f._eventQueue=d.concat(f._eventQueue),f._failureCount+=1,O.default.info("Error sending beacon: "+s.status),O.default.info(s.responseText)):f._failureCount=0,f._roundTripTime=n.default.now()-v,f._postInFlight=!1)},s.open("POST",this._beaconUrl),s.setRequestHeader("Content-Type","application/json");var g=this._createPayload(d),v=n.default.now();s.send(g)}},a.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var f=Math.pow(2,this._failureCount-1);return(1+(f*=Math.random()))*this._options.baseTimeBetweenBeacons},a.prototype._startBeaconSending=function(){var f=this;M.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=M.default.setTimeout(function(){f._eventQueue.length&&f._sendBeaconQueue(),f._startBeaconSending()},this._getNextBeaconTime()))},a.prototype._createPayload=function(f){var s={transmission_timestamp:Math.round(n.default.now())};return this._roundTripTime&&(s.rtt_ms=Math.round(this._roundTripTime)),JSON.stringify({metadata:s,events:f})},m.default=a},function(b,m,I){"use strict";function L(u){return u&&u.__esModule?u:{default:u}}Object.defineProperty(m,"__esModule",{value:!0});var D=I(11),M=L(D),R=I(0),O=L(R),A={};A.send=function(u,y){function E(){p.src=_+(T?"&rc="+T:"")}var p=new Image,T=0,_=u+"?"+M.default.stringify(y);return p.addEventListener("error",function(){T>3||O.default.setTimeout(function(){T++,E()},5e3*T)}),E(),p},m.default=A},function(b,m,I){"use strict";function L(){function D(_,n){var e=n.request_start,t=n.request_response_start,a=n.request_response_end,f=n.request_bytes_loaded;y++;var s=void 0,d=void 0;if(t?(s=t-e,d=a-t):d=a-e,d>0&&f>0){var g=f/d*8e3;E++,A+=f,u+=d,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,g),this.data.view_average_request_throughput=A/u*8e3,this.data.view_request_count=y,s>0&&(O+=s,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,s),this.data.view_average_request_latency=O/E)}}function M(_,n){y++,p++,this.data.view_request_count=y,this.data.view_request_failed_count=p}function R(_,n){y++,T++,this.data.view_request_count=y,this.data.view_request_canceled_count=T}var O=0,A=0,u=0,y=0,E=0,p=0,T=0;this.on("requestcompleted",D),this.on("requestfailed",M),this.on("requestcanceled",R)}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L},function(b,m,I){"use strict";function L(E,p,T){var _=(0,A.findMediaElement)(p),n=M(_,3),e=n[0],t=n[1],a=n[2],f=E.log,s=E.utils.getComputedStyle,d=E.utils.secondsToMs,g={automaticErrorTracking:!0};if(!e)return f.error("No element was found with the `"+t+"` query selector.");if(a!=="video"&&a!=="audio")return f.error("The element of `"+t+"` was not a media element.");T=(0,O.default)(g,T),T.data=(0,O.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.3.0"},T.data),T.getPlayheadTime=function(){return d(e.currentTime)},T.getStateData=function(){var l=this.hlsjs&&this.hlsjs.url,o=this.dashjs&&D(this.dashjs.getSource==="function")&&this.dashjs.getSource();return{player_is_paused:e.paused,player_playhead_time:d(e.currentTime),player_width:parseInt(s(e,"width")),player_height:parseInt(s(e,"height")),player_autoplay_on:e.autoplay,player_preload_on:e.preload,video_poster_url:e.poster,video_source_url:l||o||e.currentSrc,video_source_duration:d(e.duration),video_source_height:e.videoHeight,video_source_width:e.videoWidth}},e.mux=e.mux||{},e.mux.deleted=!1,e.mux.emit=function(l,o){E.emit(t,l,o)};var v=function(){f.error("The monitor for this video element has already been destroyed.")};e.mux.destroy=function(){Object.keys(e.mux.listeners).forEach(function(l){e.removeEventListener(l,e.mux.listeners[l],!1)}),delete e.mux.listeners,e.mux.destroy=v,e.mux.swapElement=v,e.mux.emit=v,e.mux.addHLSJS=v,e.mux.addDashJS=v,e.mux.removeHLSJS=v,e.mux.removeDashJS=v,e.mux.deleted=!0,E.emit(t,"destroy")},e.mux.swapElement=function(l){var o=(0,A.findMediaElement)(l),r=M(o,3),i=r[0],h=r[1],c=r[2];return i?c!=="video"&&c!=="audio"?E.log.error("The element of `"+h+"` was not a media element."):(i.muxId=e.muxId,delete e.muxId,i.mux=i.mux||{},i.mux.listeners=(0,O.default)({},e.mux.listeners),delete e.mux.listeners,Object.keys(i.mux.listeners).forEach(function(S){e.removeEventListener(S,i.mux.listeners[S],!1),i.addEventListener(S,i.mux.listeners[S],!1)}),i.mux.swapElement=e.mux.swapElement,i.mux.destroy=e.mux.destroy,delete e.mux,void(e=i)):E.log.error("No element was found with the `"+h+"` query selector.")},e.mux.addHLSJS=function(l){E.addHLSJS(t,l)},e.mux.addDashJS=function(l){E.addDashJS(t,l)},e.mux.removeHLSJS=function(){E.removeHLSJS(t)},e.mux.removeDashJS=function(){E.removeDashJS(t)},E.init(t,T),E.emit(t,"playerready"),e.paused||(E.emit(t,"play"),e.readyState>2&&E.emit(t,"playing")),e.mux.listeners={},u.forEach(function(l){(l!=="error"||T.automaticErrorTracking)&&(e.mux.listeners[l]=function(){var o={};if(l==="error"){if(!e.error)return;o.player_error_code=e.error.code,o.player_error_message=y[e.error.code]||e.error.message}E.emit(t,l,o)},e.addEventListener(l,e.mux.listeners[l],!1))})}Object.defineProperty(m,"__esModule",{value:!0});var D=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},M=function(){function E(p,T){var _=[],n=!0,e=!1,t=void 0;try{for(var a,f=p[Symbol.iterator]();!(n=(a=f.next()).done)&&(_.push(a.value),!T||_.length!==T);n=!0);}catch(s){e=!0,t=s}finally{try{!n&&f.return&&f.return()}finally{if(e)throw t}}return _}return function(p,T){if(Array.isArray(p))return p;if(Symbol.iterator in Object(p))return E(p,T);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();m.default=L;var R=I(2),O=function(E){return E&&E.__esModule?E:{default:E}}(R),A=I(8),u=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],y={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(b,m,I){"use strict";function L(s){return s&&s.__esModule?s:{default:s}}Object.defineProperty(m,"__esModule",{value:!0});var D=I(47),M=L(D),R=I(3),O=L(R),A=I(48),u=L(A),y=I(49),E=L(y),p=I(2),T=L(p),_=I(7),n=L(_),e=I(5),t=I(1),a=L(t),f={};f.safeCall=M.default,f.safeIncrement=O.default,f.getComputedStyle=u.default,f.secondsToMs=E.default,f.assign=T.default,f.headersStringToObject=n.default,f.extractHostnameAndDomain=e.extractHostnameAndDomain,f.extractHostname=e.extractHostname,f.now=a.default.now,m.default=f},function(b,m,I){"use strict";function L(R,O,A,u){var y=u;if(R&&typeof R[O]=="function")try{y=R[O].apply(R,A)}catch(E){M.default.info("safeCall error",E)}return y}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L;var D=I(4),M=function(R){return R&&R.__esModule?R:{default:R}}(D)},function(b,m,I){"use strict";function L(O,A){if(O&&A&&M.default&&typeof M.default.getComputedStyle=="function"){var u=void 0;return R&&R.has(O)&&(u=R.get(O)),u||(u=M.default.getComputedStyle(O,null),R&&R.set(O,u)),u.getPropertyValue(A)}}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L;var D=I(0),M=function(O){return O&&O.__esModule?O:{default:O}}(D),R=void 0;M.default&&M.default.WeakMap&&(R=new WeakMap)},function(b,m,I){"use strict";function L(D){return Math.floor(1e3*D)}Object.defineProperty(m,"__esModule",{value:!0}),m.default=L}])})})()}}),lt=Me({"../../node_modules/hls.js/dist/hls.js"(j,ee){typeof window!="undefined"&&function(b,m){typeof j=="object"&&typeof ee=="object"?ee.exports=m():typeof define=="function"&&define.amd?define([],m):typeof j=="object"?j.Hls=m():b.Hls=m()}(j,function(){return function(W){var b={};function m(I){if(b[I])return b[I].exports;var L=b[I]={i:I,l:!1,exports:{}};return W[I].call(L.exports,L,L.exports,m),L.l=!0,L.exports}return m.m=W,m.c=b,m.d=function(I,L,D){m.o(I,L)||Object.defineProperty(I,L,{enumerable:!0,get:D})},m.r=function(I){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(I,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(I,"__esModule",{value:!0})},m.t=function(I,L){if(L&1&&(I=m(I)),L&8||L&4&&typeof I=="object"&&I&&I.__esModule)return I;var D=Object.create(null);if(m.r(D),Object.defineProperty(D,"default",{enumerable:!0,value:I}),L&2&&typeof I!="string")for(var M in I)m.d(D,M,function(R){return I[R]}.bind(null,M));return D},m.n=function(I){var L=I&&I.__esModule?function(){return I.default}:function(){return I};return m.d(L,"a",L),L},m.o=function(I,L){return Object.prototype.hasOwnProperty.call(I,L)},m.p="/dist/",m(m.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(W,b,m){"use strict";var I=Object.prototype.hasOwnProperty,L="~";function D(){}Object.create&&(D.prototype=Object.create(null),new D().__proto__||(L=!1));function M(u,y,E){this.fn=u,this.context=y,this.once=E||!1}function R(u,y,E,p,T){if(typeof E!="function")throw new TypeError("The listener must be a function");var _=new M(E,p||u,T),n=L?L+y:y;return u._events[n]?u._events[n].fn?u._events[n]=[u._events[n],_]:u._events[n].push(_):(u._events[n]=_,u._eventsCount++),u}function O(u,y){--u._eventsCount==0?u._events=new D:delete u._events[y]}function A(){this._events=new D,this._eventsCount=0}A.prototype.eventNames=function(){var y=[],E,p;if(this._eventsCount===0)return y;for(p in E=this._events)I.call(E,p)&&y.push(L?p.slice(1):p);return Object.getOwnPropertySymbols?y.concat(Object.getOwnPropertySymbols(E)):y},A.prototype.listeners=function(y){var E=L?L+y:y,p=this._events[E];if(!p)return[];if(p.fn)return[p.fn];for(var T=0,_=p.length,n=new Array(_);T<_;T++)n[T]=p[T].fn;return n},A.prototype.listenerCount=function(y){var E=L?L+y:y,p=this._events[E];return p?p.fn?1:p.length:0},A.prototype.emit=function(y,E,p,T,_,n){var e=L?L+y:y;if(!this._events[e])return!1;var t=this._events[e],a=arguments.length,f,s;if(t.fn){switch(t.once&&this.removeListener(y,t.fn,void 0,!0),a){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,E),!0;case 3:return t.fn.call(t.context,E,p),!0;case 4:return t.fn.call(t.context,E,p,T),!0;case 5:return t.fn.call(t.context,E,p,T,_),!0;case 6:return t.fn.call(t.context,E,p,T,_,n),!0}for(s=1,f=new Array(a-1);s<a;s++)f[s-1]=arguments[s];t.fn.apply(t.context,f)}else{var d=t.length,g;for(s=0;s<d;s++)switch(t[s].once&&this.removeListener(y,t[s].fn,void 0,!0),a){case 1:t[s].fn.call(t[s].context);break;case 2:t[s].fn.call(t[s].context,E);break;case 3:t[s].fn.call(t[s].context,E,p);break;case 4:t[s].fn.call(t[s].context,E,p,T);break;default:if(!f)for(g=1,f=new Array(a-1);g<a;g++)f[g-1]=arguments[g];t[s].fn.apply(t[s].context,f)}}return!0},A.prototype.on=function(y,E,p){return R(this,y,E,p,!1)},A.prototype.once=function(y,E,p){return R(this,y,E,p,!0)},A.prototype.removeListener=function(y,E,p,T){var _=L?L+y:y;if(!this._events[_])return this;if(!E)return O(this,_),this;var n=this._events[_];if(n.fn)n.fn===E&&(!T||n.once)&&(!p||n.context===p)&&O(this,_);else{for(var e=0,t=[],a=n.length;e<a;e++)(n[e].fn!==E||T&&!n[e].once||p&&n[e].context!==p)&&t.push(n[e]);t.length?this._events[_]=t.length===1?t[0]:t:O(this,_)}return this},A.prototype.removeAllListeners=function(y){var E;return y?(E=L?L+y:y,this._events[E]&&O(this,E)):(this._events=new D,this._eventsCount=0),this},A.prototype.off=A.prototype.removeListener,A.prototype.addListener=A.prototype.on,A.prefixed=L,A.EventEmitter=A,W.exports=A},"./node_modules/url-toolkit/src/url-toolkit.js":function(W,b,m){(function(I){var L=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,D=/^([^\/?#]*)([^]*)$/,M=/(?:\/|^)\.(?=\/)/g,R=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,O={buildAbsoluteURL:function(A,u,y){if(y=y||{},A=A.trim(),u=u.trim(),!u){if(!y.alwaysNormalize)return A;var E=O.parseURL(A);if(!E)throw new Error("Error trying to parse base URL.");return E.path=O.normalizePath(E.path),O.buildURLFromParts(E)}var p=O.parseURL(u);if(!p)throw new Error("Error trying to parse relative URL.");if(p.scheme)return y.alwaysNormalize?(p.path=O.normalizePath(p.path),O.buildURLFromParts(p)):u;var T=O.parseURL(A);if(!T)throw new Error("Error trying to parse base URL.");if(!T.netLoc&&T.path&&T.path[0]!=="/"){var _=D.exec(T.path);T.netLoc=_[1],T.path=_[2]}T.netLoc&&!T.path&&(T.path="/");var n={scheme:T.scheme,netLoc:p.netLoc,path:null,params:p.params,query:p.query,fragment:p.fragment};if(!p.netLoc&&(n.netLoc=T.netLoc,p.path[0]!=="/"))if(!p.path)n.path=T.path,p.params||(n.params=T.params,p.query||(n.query=T.query));else{var e=T.path,t=e.substring(0,e.lastIndexOf("/")+1)+p.path;n.path=O.normalizePath(t)}return n.path===null&&(n.path=y.alwaysNormalize?O.normalizePath(p.path):p.path),O.buildURLFromParts(n)},parseURL:function(A){var u=L.exec(A);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(A){for(A=A.split("").reverse().join("").replace(M,"");A.length!==(A=A.replace(R,"")).length;);return A.split("").reverse().join("")},buildURLFromParts:function(A){return A.scheme+A.netLoc+A.path+A.params+A.query+A.fragment}};W.exports=O})(this)},"./node_modules/webworkify-webpack/index.js":function(W,b,m){function I(y){var E={};function p(_){if(E[_])return E[_].exports;var n=E[_]={i:_,l:!1,exports:{}};return y[_].call(n.exports,n,n.exports,p),n.l=!0,n.exports}p.m=y,p.c=E,p.i=function(_){return _},p.d=function(_,n,e){p.o(_,n)||Object.defineProperty(_,n,{configurable:!1,enumerable:!0,get:e})},p.r=function(_){Object.defineProperty(_,"__esModule",{value:!0})},p.n=function(_){var n=_&&_.__esModule?function(){return _.default}:function(){return _};return p.d(n,"a",n),n},p.o=function(_,n){return Object.prototype.hasOwnProperty.call(_,n)},p.p="/",p.oe=function(_){throw console.error(_),_};var T=p(p.s=ENTRY_MODULE);return T.default||T}var L="[\\.|\\-|\\+|\\w|/|@]+",D="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+L+").*?\\)";function M(y){return(y+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function R(y){return!isNaN(1*y)}function O(y,E,p){var T={};T[p]=[];var _=E.toString(),n=_.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return T;for(var e=n[1],t=new RegExp("(\\\\n|\\W)"+M(e)+D,"g"),a;a=t.exec(_);)a[3]!=="dll-reference"&&T[p].push(a[3]);for(t=new RegExp("\\("+M(e)+'\\("(dll-reference\\s('+L+'))"\\)\\)'+D,"g");a=t.exec(_);)y[a[2]]||(T[p].push(a[1]),y[a[2]]=m(a[1]).m),T[a[2]]=T[a[2]]||[],T[a[2]].push(a[4]);for(var f=Object.keys(T),s=0;s<f.length;s++)for(var d=0;d<T[f[s]].length;d++)R(T[f[s]][d])&&(T[f[s]][d]=1*T[f[s]][d]);return T}function A(y){var E=Object.keys(y);return E.reduce(function(p,T){return p||y[T].length>0},!1)}function u(y,E){for(var p={main:[E]},T={main:[]},_={main:{}};A(p);)for(var n=Object.keys(p),e=0;e<n.length;e++){var t=n[e],a=p[t],f=a.pop();if(_[t]=_[t]||{},!(_[t][f]||!y[t][f])){_[t][f]=!0,T[t]=T[t]||[],T[t].push(f);for(var s=O(y,y[t][f],t),d=Object.keys(s),g=0;g<d.length;g++)p[d[g]]=p[d[g]]||[],p[d[g]]=p[d[g]].concat(s[d[g]])}}return T}W.exports=function(y,E){E=E||{};var p={main:m.m},T=E.all?{main:Object.keys(p.main)}:u(p,y),_="";Object.keys(T).filter(function(f){return f!=="main"}).forEach(function(f){for(var s=0;T[f][s];)s++;T[f].push(s),p[f][s]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",_=_+"var "+f+" = ("+I.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+T[f].map(function(d){return""+JSON.stringify(d)+": "+p[f][d].toString()}).join(",")+`});
`}),_=_+"new (("+I.toString().replace("ENTRY_MODULE",JSON.stringify(y))+")({"+T.main.map(function(f){return""+JSON.stringify(f)+": "+p.main[f].toString()}).join(",")+"}))(self);";var n=new window.Blob([_],{type:"text/javascript"});if(E.bare)return n;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,t=e.createObjectURL(n),a=new window.Worker(t);return a.objectURL=t,a}},"./src/config.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"hlsDefaultConfig",function(){return d}),m.d(b,"mergeConfig",function(){return v}),m.d(b,"enableStreamingMode",function(){return l});var I=m("./src/controller/abr-controller.ts"),L=m("./src/controller/audio-stream-controller.ts"),D=m("./src/controller/audio-track-controller.ts"),M=m("./src/controller/subtitle-stream-controller.ts"),R=m("./src/controller/subtitle-track-controller.ts"),O=m("./src/controller/buffer-controller.ts"),A=m("./src/controller/timeline-controller.ts"),u=m("./src/controller/cap-level-controller.ts"),y=m("./src/controller/fps-controller.ts"),E=m("./src/controller/eme-controller.ts"),p=m("./src/utils/xhr-loader.ts"),T=m("./src/utils/fetch-loader.ts"),_=m("./src/utils/cues.ts"),n=m("./src/utils/mediakeys-helper.ts"),e=m("./src/utils/logger.ts");function t(){return t=Object.assign||function(o){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var h in i)Object.prototype.hasOwnProperty.call(i,h)&&(o[h]=i[h])}return o},t.apply(this,arguments)}function a(o,r){var i=Object.keys(o);if(Object.getOwnPropertySymbols){var h=Object.getOwnPropertySymbols(o);r&&(h=h.filter(function(c){return Object.getOwnPropertyDescriptor(o,c).enumerable})),i.push.apply(i,h)}return i}function f(o){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?a(Object(i),!0).forEach(function(h){s(o,h,i[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(h){Object.defineProperty(o,h,Object.getOwnPropertyDescriptor(i,h))})}return o}function s(o,r,i){return r in o?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,o}var d=f(f({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:p.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:I.default,bufferController:O.default,capLevelController:u.default,fpsController:y.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:n.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},g()),{},{subtitleStreamController:M.SubtitleStreamController,subtitleTrackController:R.default,timelineController:A.TimelineController,audioStreamController:L.default,audioTrackController:D.default,emeController:E.default});function g(){return{cueHandler:_.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function v(o,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},o,r)}function l(o){var r=o.loader;if(r!==T.default&&r!==p.default)e.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),o.progressive=!1;else{var i=Object(T.fetchSupported)();i&&(o.loader=T.default,o.progressive=!0,o.enableSoftwareAES=!0,e.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/polyfills/number.ts"),L=m("./src/utils/ewma-bandwidth-estimator.ts"),D=m("./src/events.ts"),M=m("./src/utils/buffer-helper.ts"),R=m("./src/errors.ts"),O=m("./src/types/loader.ts"),A=m("./src/utils/logger.ts");function u(p,T){for(var _=0;_<T.length;_++){var n=T[_];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(p,n.key,n)}}function y(p,T,_){return T&&u(p.prototype,T),_&&u(p,_),p}var E=function(){function p(_){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=_;var n=_.config;this.bwEstimator=new L.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var T=p.prototype;return T.registerListeners=function(){var n=this.hls;n.on(D.Events.FRAG_LOADING,this.onFragLoading,this),n.on(D.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(D.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var n=this.hls;n.off(D.Events.FRAG_LOADING,this.onFragLoading,this),n.off(D.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(D.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},T.onFragLoading=function(n,e){var t=e.frag;if(t.type===O.PlaylistLevelType.MAIN&&!this.timer){var a;this.fragCurrent=t,this.partCurrent=(a=e.part)!=null?a:null,this.timer=self.setInterval(this.onCheck,100)}},T.onLevelLoaded=function(n,e){var t=this.hls.config;e.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},T._abandonRulesCheck=function(){var n=this.fragCurrent,e=this.partCurrent,t=this.hls,a=t.autoLevelEnabled,f=t.config,s=t.media;if(!(!n||!s)){var d=e?e.stats:n.stats,g=e?e.duration:n.duration;if(d.aborted){A.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!a||s.paused||!s.playbackRate||!s.readyState)){var v=performance.now()-d.loading.start,l=Math.abs(s.playbackRate);if(!(v<=500*g/l)){var o=t.levels,r=t.minAutoLevel,i=o[n.level],h=d.total||Math.max(d.loaded,Math.round(g*i.maxBitrate/8)),c=Math.max(1,d.bwEstimate?d.bwEstimate/8:d.loaded*1e3/v),S=(h-d.loaded)/c,P=s.currentTime,C=(M.BufferHelper.bufferInfo(s,P,f.maxBufferHole).end-P)/l;if(!(C>=2*g/l||S<=C)){var x=Number.POSITIVE_INFINITY,B;for(B=n.level-1;B>r;B--){var F=o[B].maxBitrate;if(x=g*F/(8*.8*c),x<C)break}if(!(x>=S)){var U=this.bwEstimator.getEstimate();A.logger.warn("Fragment "+n.sn+(e?" part "+e.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+`
      Current BW estimate: `+(Object(I.isFiniteNumber)(U)?(U/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+S.toFixed(3)+` s
      Estimated load time for the next fragment: `+x.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),t.nextLoadLevel=B,this.bwEstimator.sample(v,d.loaded),this.clearTimer(),n.loader&&(this.fragCurrent=this.partCurrent=null,n.loader.abort()),t.trigger(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:e,stats:d})}}}}}},T.onFragLoaded=function(n,e){var t=e.frag,a=e.part;if(t.type===O.PlaylistLevelType.MAIN&&Object(I.isFiniteNumber)(t.sn)){var f=a?a.stats:t.stats,s=a?a.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var d=this.hls.levels[t.level],g=(d.loaded?d.loaded.bytes:0)+f.loaded,v=(d.loaded?d.loaded.duration:0)+s;d.loaded={bytes:g,duration:v},d.realBitrate=Math.round(8*g/v)}if(t.bitrateTest){var l={stats:f,frag:t,part:a,id:t.type};this.onFragBuffered(D.Events.FRAG_BUFFERED,l),t.bitrateTest=!1}}},T.onFragBuffered=function(n,e){var t=e.frag,a=e.part,f=a?a.stats:t.stats;if(!f.aborted&&!(t.type!==O.PlaylistLevelType.MAIN||t.sn==="initSegment")){var s=f.parsing.end-f.loading.start;this.bwEstimator.sample(s,f.loaded),f.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},T.onError=function(n,e){switch(e.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},T.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},T.getNextABRAutoLevel=function(){var n=this.fragCurrent,e=this.partCurrent,t=this.hls,a=t.maxAutoLevel,f=t.config,s=t.minAutoLevel,d=t.media,g=e?e.duration:n?n.duration:0,v=d?d.currentTime:0,l=d&&d.playbackRate!==0?Math.abs(d.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate():f.abrEwmaDefaultEstimate,r=(M.BufferHelper.bufferInfo(d,v,f.maxBufferHole).end-v)/l,i=this.findBestLevel(o,s,a,r,f.abrBandWidthFactor,f.abrBandWidthUpFactor);if(i>=0)return i;A.logger.trace((r?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var h=g?Math.min(g,f.maxStarvationDelay):f.maxStarvationDelay,c=f.abrBandWidthFactor,S=f.abrBandWidthUpFactor;if(!r){var P=this.bitrateTestDelay;if(P){var C=g?Math.min(g,f.maxLoadingDelay):f.maxLoadingDelay;h=C-P,A.logger.trace("bitrate test took "+Math.round(1e3*P)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*h)+" ms"),c=S=1}}return i=this.findBestLevel(o,s,a,r+h,c,S),Math.max(i,0)},T.findBestLevel=function(n,e,t,a,f,s){for(var d,g=this.fragCurrent,v=this.partCurrent,l=this.lastLoadedFragLevel,o=this.hls.levels,r=o[l],i=!!(r!=null&&(d=r.details)!==null&&d!==void 0&&d.live),h=r==null?void 0:r.codecSet,c=v?v.duration:g?g.duration:0,S=t;S>=e;S--){var P=o[S];if(!(!P||h&&P.codecSet!==h)){var C=P.details,x=(v?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||c,B=void 0;S<=l?B=f*n:B=s*n;var F=o[S].maxBitrate,U=F*x/B;if(A.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+S+"/"+Math.round(B)+"/"+F+"/"+x+"/"+a+"/"+U),B>F&&(!U||i&&!this.bitrateTestDelay||U<a))return S}}return-1},y(p,[{key:"nextAutoLevel",get:function(){var n=this._nextAutoLevel,e=this.bwEstimator;if(n!==-1&&(!e||!e.canEstimate()))return n;var t=this.getNextABRAutoLevel();return n!==-1&&(t=Math.min(n,t)),t},set:function(n){this._nextAutoLevel=n}}]),p}();b.default=E},"./src/controller/audio-stream-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/polyfills/number.ts"),L=m("./src/controller/base-stream-controller.ts"),D=m("./src/events.ts"),M=m("./src/utils/buffer-helper.ts"),R=m("./src/controller/fragment-tracker.ts"),O=m("./src/types/level.ts"),A=m("./src/types/loader.ts"),u=m("./src/loader/fragment.ts"),y=m("./src/demux/chunk-cache.ts"),E=m("./src/demux/transmuxer-interface.ts"),p=m("./src/types/transmuxer.ts"),T=m("./src/controller/fragment-finders.ts"),_=m("./src/utils/discontinuities.ts"),n=m("./src/errors.ts"),e=m("./src/utils/logger.ts");function t(){return t=Object.assign||function(g){for(var v=1;v<arguments.length;v++){var l=arguments[v];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(g[o]=l[o])}return g},t.apply(this,arguments)}function a(g,v){g.prototype=Object.create(v.prototype),g.prototype.constructor=g,f(g,v)}function f(g,v){return f=Object.setPrototypeOf||function(o,r){return o.__proto__=r,o},f(g,v)}var s=100,d=function(g){a(v,g);function v(o,r){var i;return i=g.call(this,o,r,"[audio-stream-controller]")||this,i.videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.audioSwitch=!1,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.bufferFlushed=!1,i._registerListeners(),i}var l=v.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var r=this.hls;r.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(D.Events.ERROR,this.onError,this),r.on(D.Events.BUFFER_RESET,this.onBufferReset,this),r.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l._unregisterListeners=function(){var r=this.hls;r.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(D.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(D.Events.ERROR,this.onError,this),r.off(D.Events.BUFFER_RESET,this.onBufferReset,this),r.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(D.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},l.onInitPtsFound=function(r,i){var h=i.frag,c=i.id,S=i.initPTS;if(c==="main"){var P=h.cc;this.initPTS[h.cc]=S,this.log("InitPTS for cc: "+P+" found from main: "+S),this.videoTrackCC=P,this.state===L.State.WAITING_INIT_PTS&&this.tick()}},l.startLoad=function(r){if(!this.levels){this.startPosition=r,this.state=L.State.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(s),this.fragLoadError=0,i>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=L.State.IDLE):(this.loadedmetadata=!1,this.state=L.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},l.doTick=function(){switch(this.state){case L.State.IDLE:this.doTickIdle();break;case L.State.WAITING_TRACK:{var r,i=this.levels,h=this.trackId,c=i==null||(r=i[h])===null||r===void 0?void 0:r.details;if(c){if(this.waitForCdnTuneIn(c))break;this.state=L.State.WAITING_INIT_PTS}break}case L.State.FRAG_LOADING_WAITING_RETRY:{var S,P=performance.now(),C=this.retryDate;(!C||P>=C||(S=this.media)!==null&&S!==void 0&&S.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=L.State.IDLE);break}case L.State.WAITING_INIT_PTS:{var x=this.waitingData;if(x){var B=x.frag,F=x.part,U=x.cache,w=x.complete;if(this.initPTS[B.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=L.State.FRAG_LOADING;var k=U.flush(),K={frag:B,part:F,payload:k,networkDetails:null};this._handleFragmentLoadProgress(K),w&&g.prototype._handleFragmentLoadComplete.call(this,K)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+B.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var N=this.getLoadPosition(),G=M.BufferHelper.bufferInfo(this.mediaBuffer,N,this.config.maxBufferHole),H=Object(T.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,B);H<0&&(e.logger.log("Waiting fragment cc ("+B.cc+") @ "+B.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=L.State.IDLE}}this.onTickEnd()},l.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=L.State.IDLE)},l.onTickEnd=function(){var r=this.media;if(!(!r||!r.readyState)){var i=this.mediaBuffer?this.mediaBuffer:r,h=i.buffered;!this.loadedmetadata&&h.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},l.doTickIdle=function(){var r,i,h=this.hls,c=this.levels,S=this.media,P=this.trackId,C=h.config;if(!(!c||!c[P])&&!(!S&&(this.startFragRequested||!C.startFragPrefetch))){var x=c[P],B=x.details;if(!B||B.live&&this.levelLastLoaded!==P||this.waitForCdnTuneIn(B)){this.state=L.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,u.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.AUDIO);if(F!==null){var U=F.len,w=this.getMaxBufferLength(),k=this.audioSwitch;if(!(U>=w&&!k)){if(!k&&this._streamEnded(F,B)){h.trigger(D.Events.BUFFER_EOS,{type:"audio"}),this.state=L.State.ENDED;return}var K=B.fragments,N=K[0].start,G=F.end;if(k){var H=this.getLoadPosition();G=H,B.PTSKnown&&H<N&&(F.end>N||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),S.currentTime=N+.05)}var V=this.getNextFragment(G,B);if(!V){this.bufferFlushed=!0;return}((r=V.decryptdata)===null||r===void 0?void 0:r.keyFormat)==="identity"&&!((i=V.decryptdata)!==null&&i!==void 0&&i.key)?this.loadKey(V,B):this.loadFragment(V,B,G)}}}},l.getMaxBufferLength=function(){var r=g.prototype.getMaxBufferLength.call(this),i=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN);return i===null?r:Math.max(r,i.len)},l.onMediaDetaching=function(){this.videoBuffer=null,g.prototype.onMediaDetaching.call(this)},l.onAudioTracksUpdated=function(r,i){var h=i.audioTracks;this.resetTransmuxer(),this.levels=h.map(function(c){return new O.Level(c)})},l.onAudioTrackSwitching=function(r,i){var h=!!i.url;this.trackId=i.id;var c=this.fragCurrent;c!=null&&c.loader&&c.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),h?this.setInterval(s):this.resetTransmuxer(),h?(this.audioSwitch=!0,this.state=L.State.IDLE):this.state=L.State.STOPPED,this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},l.onLevelLoaded=function(r,i){this.mainDetails=i.details},l.onAudioTrackLoaded=function(r,i){var h,c=this.levels,S=i.details,P=i.id;if(!c){this.warn("Audio tracks were reset while loading level "+P);return}this.log("Track "+P+" loaded ["+S.startSN+","+S.endSN+"],duration:"+S.totalduration);var C=c[P],x=0;if(S.live||(h=C.details)!==null&&h!==void 0&&h.live){var B=this.mainDetails;if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed||!B)return;!C.details&&S.hasProgramDateTime&&B.hasProgramDateTime?(Object(_.alignMediaPlaylistByPDT)(S,B),x=S.fragments[0].start):x=this.alignPlaylists(S,C.details)}C.details=S,this.levelLastLoaded=P,!this.startFragRequested&&(this.mainDetails||!S.live)&&this.setStartPosition(C.details,x),this.state===L.State.WAITING_TRACK&&!this.waitForCdnTuneIn(S)&&(this.state=L.State.IDLE),this.tick()},l._handleFragmentLoadProgress=function(r){var i,h=r.frag,c=r.part,S=r.payload,P=this.config,C=this.trackId,x=this.levels;if(!x){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered");return}var B=x[C];console.assert(B,"Audio track is defined on fragment load progress");var F=B.details;console.assert(F,"Audio track details are defined on fragment load progress");var U=P.defaultAudioCodec||B.audioCodec||"mp4a.40.2",w=this.transmuxer;w||(w=this.transmuxer=new E.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var k=this.initPTS[h.cc],K=(i=h.initSegment)===null||i===void 0?void 0:i.data;if(k!==void 0){var N=!1,G=c?c.index:-1,H=G!==-1,V=new p.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,S.byteLength,G,H);w.push(S,K,U,"",h,c,F.totalduration,N,V,k)}else{e.logger.log("Unknown video PTS for cc "+h.cc+", waiting for video PTS before demuxing audio frag "+h.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+C);var z=this.waitingData=this.waitingData||{frag:h,part:c,cache:new y.default,complete:!1},Q=z.cache;Q.push(new Uint8Array(S)),this.waitingVideoCC=this.videoTrackCC,this.state=L.State.WAITING_INIT_PTS}},l._handleFragmentLoadComplete=function(r){if(this.waitingData){this.waitingData.complete=!0;return}g.prototype._handleFragmentLoadComplete.call(this,r)},l.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},l.onBufferCreated=function(r,i){var h=i.tracks.audio;h&&(this.mediaBuffer=h.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},l.onFragBuffered=function(r,i){var h=i.frag,c=i.part;if(h.type===A.PlaylistLevelType.AUDIO){if(this.fragContextChanged(h)){this.warn("Fragment "+h.sn+(c?" p: "+c.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}h.sn!=="initSegment"&&(this.fragPrevious=h,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(h,c)}},l.onError=function(r,i){switch(i.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,i);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==L.State.ERROR&&this.state!==L.State.STOPPED&&(this.state=i.fatal?L.State.ERROR:L.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="audio"&&(this.state===L.State.PARSING||this.state===L.State.PARSED)){var h=!0,c=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);c&&c.len>.5&&(h=!this.reduceMaxBufferLength(c.len)),h&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,g.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},l.onBufferFlushed=function(r,i){var h=i.type;h===u.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},l._handleTransmuxComplete=function(r){var i,h="audio",c=this.hls,S=r.remuxResult,P=r.chunkMeta,C=this.getCurrentContext(P);if(!C){this.warn("The loading context changed while buffering fragment "+P.sn+" of level "+P.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(P.level);return}var x=C.frag,B=C.part,F=S.audio,U=S.text,w=S.id3,k=S.initSegment;if(!this.fragContextChanged(x)){if(this.state=L.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),k!=null&&k.tracks&&(this._bufferInitSegment(k.tracks,x,P),c.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:x,id:h,tracks:k.tracks})),F){var K=F.startPTS,N=F.endPTS,G=F.startDTS,H=F.endDTS;B&&(B.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:K,endPTS:N,startDTS:G,endDTS:H}),x.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,K,N,G,H),this.bufferFragmentData(F,x,B,P)}if(w!=null&&(i=w.samples)!==null&&i!==void 0&&i.length){var V=t({frag:x,id:h},w);c.trigger(D.Events.FRAG_PARSING_METADATA,V)}if(U){var z=t({frag:x,id:h},U);c.trigger(D.Events.FRAG_PARSING_USERDATA,z)}}},l._bufferInitSegment=function(r,i,h){if(this.state===L.State.PARSING){r.video&&delete r.video;var c=r.audio;if(!!c){c.levelCodec=c.codec,c.id="audio",this.log("Init audio buffer, container:"+c.container+", codecs[parsed]=["+c.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,r);var S=c.initSegment;if(S!=null&&S.byteLength){var P={type:"audio",frag:i,part:null,chunkMeta:h,parent:i.type,data:S};this.hls.trigger(D.Events.BUFFER_APPENDING,P)}this.tick()}}},l.loadFragment=function(r,i,h){var c=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||c===R.FragmentState.NOT_LOADED||c===R.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):i.live&&!Object(I.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=L.State.WAITING_INIT_PTS):(this.startFragRequested=!0,g.prototype.loadFragment.call(this,r,i,h)))},l.completeAudioSwitch=function(){var r=this.hls,i=this.media,h=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),g.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:h})},v}(L.default);b.default=d},"./src/controller/audio-track-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/events.ts"),L=m("./src/errors.ts"),D=m("./src/controller/base-playlist-controller.ts"),M=m("./src/types/loader.ts");function R(E,p){for(var T=0;T<p.length;T++){var _=p[T];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(E,_.key,_)}}function O(E,p,T){return p&&R(E.prototype,p),T&&R(E,T),E}function A(E,p){E.prototype=Object.create(p.prototype),E.prototype.constructor=E,u(E,p)}function u(E,p){return u=Object.setPrototypeOf||function(_,n){return _.__proto__=n,_},u(E,p)}var y=function(E){A(p,E);function p(_){var n;return n=E.call(this,_,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var T=p.prototype;return T.registerListeners=function(){var n=this.hls;n.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(I.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(I.Events.ERROR,this.onError,this)},T.unregisterListeners=function(){var n=this.hls;n.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(I.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(I.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(I.Events.ERROR,this.onError,this)},T.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,E.prototype.destroy.call(this)},T.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},T.onManifestParsed=function(n,e){this.tracks=e.audioTracks||[]},T.onAudioTrackLoaded=function(n,e){var t=e.id,a=e.details,f=this.tracksInGroup[t];if(!f){this.warn("Invalid audio track id "+t);return}var s=f.details;f.details=e.details,this.log("audioTrack "+t+" loaded ["+a.startSN+"-"+a.endSN+"]"),t===this.trackId&&(this.retryCount=0,this.playlistLoaded(t,e,s))},T.onLevelLoading=function(n,e){this.switchLevel(e.level)},T.onLevelSwitching=function(n,e){this.switchLevel(e.level)},T.switchLevel=function(n){var e=this.hls.levels[n];if(!!(e!=null&&e.audioGroupIds)){var t=e.audioGroupIds[e.urlId];if(this.groupId!==t){this.groupId=t;var a=this.tracks.filter(function(s){return!t||s.groupId===t});this.selectDefaultTrack&&!a.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=a;var f={audioTracks:a};this.log("Updating audio tracks, "+a.length+' track(s) found in "'+t+'" group-id'),this.hls.trigger(I.Events.AUDIO_TRACKS_UPDATED,f),this.selectInitialTrack()}}},T.onError=function(n,e){E.prototype.onError.call(this,n,e),!(e.fatal||!e.context)&&e.context.type===M.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},T.setAudioTrack=function(n){var e=this.tracksInGroup;if(n<0||n>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var t=e[this.trackId];this.log("Now switching to audio-track index "+n);var a=e[n],f=a.id,s=a.groupId,d=s===void 0?"":s,g=a.name,v=a.type,l=a.url;if(this.trackId=n,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(I.Events.AUDIO_TRACK_SWITCHING,{id:f,groupId:d,name:g,type:v,url:l}),!(a.details&&!a.details.live)){var o=this.switchParams(a.url,t==null?void 0:t.details);this.loadPlaylist(o)}},T.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,t=this.findTrackId(e)||this.findTrackId();t!==-1?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},T.findTrackId=function(n){for(var e=this.tracksInGroup,t=0;t<e.length;t++){var a=e[t];if((!this.selectDefaultTrack||a.default)&&(!n||n===a.name))return a.id}return-1},T.loadPlaylist=function(n){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var t=e.id,a=e.groupId,f=e.url;if(n)try{f=n.addDirectives(f)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+t),this.clearTimer(),this.hls.trigger(I.Events.AUDIO_TRACK_LOADING,{url:f,id:t,groupId:a,deliveryDirectives:n||null})}},O(p,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),p}(D.default);b.default=y},"./src/controller/base-playlist-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return O});var I=m("./src/polyfills/number.ts"),L=m("./src/types/level.ts"),D=m("./src/controller/level-helper.ts"),M=m("./src/utils/logger.ts"),R=m("./src/errors.ts"),O=function(){function A(y,E){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=M.logger.log.bind(M.logger,E+":"),this.warn=M.logger.warn.bind(M.logger,E+":"),this.hls=y}var u=A.prototype;return u.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},u.onError=function(E,p){p.fatal&&p.type===R.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},u.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},u.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},u.stopLoad=function(){this.canLoad=!1,this.clearTimer()},u.switchParams=function(E,p){var T=p==null?void 0:p.renditionReports;if(T)for(var _=0;_<T.length;_++){var n=T[_],e=""+n.URI;if(e===E.substr(-e.length)){var t=parseInt(n["LAST-MSN"]),a=parseInt(n["LAST-PART"]);if(p&&this.hls.config.lowLatencyMode){var f=Math.min(p.age-p.partTarget,p.targetduration);a!==void 0&&f>p.partTarget&&(a+=1)}if(Object(I.isFiniteNumber)(t))return new L.HlsUrlParameters(t,Object(I.isFiniteNumber)(a)?a:void 0,L.HlsSkip.No)}}},u.loadPlaylist=function(E){},u.shouldLoadTrack=function(E){return this.canLoad&&E&&!!E.url&&(!E.details||E.details.live)},u.playlistLoaded=function(E,p,T){var _=this,n=p.details,e=p.stats,t=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(n.advancedDateTime=Date.now()-t,n.live||T!=null&&T.live){if(n.reloaded(T),T&&this.log("live playlist "+E+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),T&&n.fragments.length>0&&Object(D.mergeDetails)(T,n),!this.canLoad||!n.live)return;var a,f=void 0,s=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var d=this.hls.config.lowLatencyMode,g=n.lastPartSn,v=n.endSN,l=n.lastPartIndex,o=l!==-1,r=g===v,i=d?0:l;o?(f=r?v+1:g,s=r?i:l+1):f=v+1;var h=n.age,c=h+n.ageHeader,S=Math.min(c-n.partTarget,n.targetduration*1.5);if(S>0){if(T&&S>T.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+T.tuneInGoal+" to: "+S+" with playlist age: "+n.age),S=0;else{var P=Math.floor(S/n.targetduration);if(f+=P,s!==void 0){var C=Math.round(S%n.targetduration/n.partTarget);s+=C}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+h.toFixed(2)+"s goal: "+S+" skip sn "+P+" to part "+s)}n.tuneInGoal=S}if(a=this.getDeliveryDirectives(n,p.deliveryDirectives,f,s),d||!r){this.loadPlaylist(a);return}}else a=this.getDeliveryDirectives(n,p.deliveryDirectives,f,s);var x=Object(D.computeReloadInterval)(n,e);f!==void 0&&n.canBlockReload&&(x-=n.partTarget||1),this.log("reload live playlist "+E+" in "+Math.round(x)+" ms"),this.timer=self.setTimeout(function(){return _.loadPlaylist(a)},x)}else this.clearTimer()},u.getDeliveryDirectives=function(E,p,T,_){var n=Object(L.getSkipValue)(E,T);return p!=null&&p.skip&&E.deltaUpdateFailed&&(T=p.msn,_=p.part,n=L.HlsSkip.No),new L.HlsUrlParameters(T,_,n)},u.retryLoadingOrFail=function(E){var p=this,T=this.hls.config,_=this.retryCount<T.levelLoadingMaxRetry;if(_){var n;if(this.retryCount++,E.details.indexOf("LoadTimeOut")>-1&&(n=E.context)!==null&&n!==void 0&&n.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+E.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*T.levelLoadingRetryDelay,T.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return p.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+E.details+'"')}}else this.warn('cannot recover from error "'+E.details+'"'),this.clearTimer(),E.fatal=!0;return _},A}()},"./src/controller/base-stream-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"State",function(){return v}),m.d(b,"default",function(){return l});var I=m("./src/polyfills/number.ts"),L=m("./src/task-loop.ts"),D=m("./src/controller/fragment-tracker.ts"),M=m("./src/utils/buffer-helper.ts"),R=m("./src/utils/logger.ts"),O=m("./src/events.ts"),A=m("./src/errors.ts"),u=m("./src/types/transmuxer.ts"),y=m("./src/utils/mp4-tools.ts"),E=m("./src/utils/discontinuities.ts"),p=m("./src/controller/fragment-finders.ts"),T=m("./src/controller/level-helper.ts"),_=m("./src/loader/fragment-loader.ts"),n=m("./src/crypt/decrypter.ts"),e=m("./src/utils/time-ranges.ts"),t=m("./src/types/loader.ts");function a(o,r){for(var i=0;i<r.length;i++){var h=r[i];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}function f(o,r,i){return r&&a(o.prototype,r),i&&a(o,i),o}function s(o){if(o===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return o}function d(o,r){o.prototype=Object.create(r.prototype),o.prototype.constructor=o,g(o,r)}function g(o,r){return g=Object.setPrototypeOf||function(h,c){return h.__proto__=c,h},g(o,r)}var v={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},l=function(o){d(r,o);function r(h,c,S){var P;return P=o.call(this)||this,P.hls=void 0,P.fragPrevious=null,P.fragCurrent=null,P.fragmentTracker=void 0,P.transmuxer=null,P._state=v.STOPPED,P.media=void 0,P.mediaBuffer=void 0,P.config=void 0,P.bitrateTest=!1,P.lastCurrentTime=0,P.nextLoadPosition=0,P.startPosition=0,P.loadedmetadata=!1,P.fragLoadError=0,P.retryDate=0,P.levels=null,P.fragmentLoader=void 0,P.levelLastLoaded=null,P.startFragRequested=!1,P.decrypter=void 0,P.initPTS=[],P.onvseeking=null,P.onvended=null,P.logPrefix="",P.log=void 0,P.warn=void 0,P.logPrefix=S,P.log=R.logger.log.bind(R.logger,S+":"),P.warn=R.logger.warn.bind(R.logger,S+":"),P.hls=h,P.fragmentLoader=new _.default(h.config),P.fragmentTracker=c,P.config=h.config,P.decrypter=new n.default(h,h.config),h.on(O.Events.KEY_LOADED,P.onKeyLoaded,s(P)),P}var i=r.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(c){},i.stopLoad=function(){this.fragmentLoader.abort();var c=this.fragCurrent;c&&this.fragmentTracker.removeFragment(c),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=v.STOPPED},i._streamEnded=function(c,S){var P=this.fragCurrent,C=this.fragmentTracker;if(!S.live&&P&&P.sn===S.endSN&&!c.nextStart){var x=C.getState(P);return x===D.FragmentState.PARTIAL||x===D.FragmentState.OK}return!1},i.onMediaAttached=function(c,S){var P=this.media=this.mediaBuffer=S.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),P.addEventListener("seeking",this.onvseeking),P.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===v.STOPPED&&this.startLoad(C.startPosition)},i.onMediaDetaching=function(){var c=this.media;c!=null&&c.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),c&&(c.removeEventListener("seeking",this.onvseeking),c.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var c=this.config,S=this.fragCurrent,P=this.media,C=this.mediaBuffer,x=this.state,B=P?P.currentTime:0,F=M.BufferHelper.bufferInfo(C||P,B,c.maxBufferHole);if(this.log("media seeking to "+(Object(I.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+x),x===v.ENDED)this.resetLoadingState();else if(S&&!F.len){var U=c.maxFragLookUpTolerance,w=S.start-U,k=S.start+S.duration+U,K=B>k;(B<w||K)&&(K&&S.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),S.loader.abort()),this.resetLoadingState())}P&&(this.lastCurrentTime=B),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onKeyLoaded=function(c,S){if(!(this.state!==v.KEY_LOADING||S.frag!==this.fragCurrent||!this.levels)){this.state=v.IDLE;var P=this.levels[S.frag.level].details;P&&this.loadFragment(S.frag,P,S.frag.start)}},i.onHandlerDestroying=function(){this.stopLoad(),o.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=v.STOPPED,this.hls.off(O.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,o.prototype.onHandlerDestroyed.call(this)},i.loadKey=function(c,S){this.log("Loading key for "+c.sn+" of ["+S.startSN+"-"+S.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level),this.state=v.KEY_LOADING,this.fragCurrent=c,this.hls.trigger(O.Events.KEY_LOADING,{frag:c})},i.loadFragment=function(c,S,P){this._loadFragForPlayback(c,S,P)},i._loadFragForPlayback=function(c,S,P){var C=this,x=function(F){if(C.fragContextChanged(c)){C.warn("Fragment "+c.sn+(F.part?" p: "+F.part.index:"")+" of level "+c.level+" was dropped during download."),C.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,C._handleFragmentLoadProgress(F)};this._doFragLoad(c,S,P,x).then(function(B){if(!!B){C.fragLoadError=0;var F=C.state;if(C.fragContextChanged(c)){(F===v.FRAG_LOADING||F===v.BACKTRACKING||!C.fragCurrent&&F===v.PARSING)&&(C.fragmentTracker.removeFragment(c),C.state=v.IDLE);return}if("payload"in B&&(C.log("Loaded fragment "+c.sn+" of level "+c.level),C.hls.trigger(O.Events.FRAG_LOADED,B),C.state===v.BACKTRACKING)){C.fragmentTracker.backtrack(c,B),C.resetFragmentLoading(c);return}C._handleFragmentLoadComplete(B)}}).catch(function(B){C.warn(B),C.resetFragmentLoading(c)})},i.flushMainBuffer=function(c,S,P){if(P===void 0&&(P=null),!!(c-S)){var C={startOffset:c,endOffset:S,type:P};this.fragLoadError=0,this.hls.trigger(O.Events.BUFFER_FLUSHING,C)}},i._loadInitSegment=function(c){var S=this;this._doFragLoad(c).then(function(P){if(!P||S.fragContextChanged(c)||!S.levels)throw new Error("init load aborted");return P}).then(function(P){var C=S.hls,x=P.payload,B=c.decryptdata;if(x&&x.byteLength>0&&B&&B.key&&B.iv&&B.method==="AES-128"){var F=self.performance.now();return S.decrypter.webCryptoDecrypt(new Uint8Array(x),B.key.buffer,B.iv.buffer).then(function(U){var w=self.performance.now();return C.trigger(O.Events.FRAG_DECRYPTED,{frag:c,payload:U,stats:{tstart:F,tdecrypt:w}}),P.payload=U,P})}return P}).then(function(P){var C=S.fragCurrent,x=S.hls,B=S.levels;if(!B)throw new Error("init load aborted, missing levels");var F=B[c.level].details;console.assert(F,"Level details are defined when init segment is loaded");var U=c.stats;S.state=v.IDLE,S.fragLoadError=0,c.data=new Uint8Array(P.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),P.frag===C&&x.trigger(O.Events.FRAG_BUFFERED,{stats:U,frag:C,part:null,id:c.type}),S.tick()}).catch(function(P){S.warn(P),S.resetFragmentLoading(c)})},i.fragContextChanged=function(c){var S=this.fragCurrent;return!c||!S||c.level!==S.level||c.sn!==S.sn||c.urlId!==S.urlId},i.fragBufferedComplete=function(c,S){var P=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+c.type+" sn: "+c.sn+(S?" part: "+S.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level+" "+e.default.toString(M.BufferHelper.getBuffered(P))),this.state=v.IDLE,this.tick()},i._handleFragmentLoadComplete=function(c){var S=this.transmuxer;if(!!S){var P=c.frag,C=c.part,x=c.partsLoaded,B=!x||x.length===0||x.some(function(U){return!U}),F=new u.ChunkMetadata(P.level,P.sn,P.stats.chunkCount+1,0,C?C.index:-1,!B);S.flush(F)}},i._handleFragmentLoadProgress=function(c){},i._doFragLoad=function(c,S,P,C){var x=this;if(P===void 0&&(P=null),!this.levels)throw new Error("frag load aborted, missing levels");if(P=Math.max(c.start,P||0),this.config.lowLatencyMode&&S){var B=S.partList;if(B&&C){P>c.end&&S.fragmentHint&&(c=S.fragmentHint);var F=this.getNextPart(B,c,P);if(F>-1){var U=B[F];return this.log("Loading part sn: "+c.sn+" p: "+U.index+" cc: "+c.cc+" of playlist ["+S.startSN+"-"+S.endSN+"] parts [0-"+F+"-"+(B.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(P.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=v.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:c,part:B[F],targetBufferTime:P}),this.doFragPartsLoad(c,B,F,C).catch(function(w){return x.handleFragLoadError(w)})}else if(!c.url||this.loadedEndOfParts(B,P))return Promise.resolve(null)}}return this.log("Loading fragment "+c.sn+" cc: "+c.cc+" "+(S?"of ["+S.startSN+"-"+S.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(P.toFixed(3))),Object(I.isFiniteNumber)(c.sn)&&!this.bitrateTest&&(this.nextLoadPosition=c.start+c.duration),this.state=v.FRAG_LOADING,this.hls.trigger(O.Events.FRAG_LOADING,{frag:c,targetBufferTime:P}),this.fragmentLoader.load(c,C).catch(function(w){return x.handleFragLoadError(w)})},i.doFragPartsLoad=function(c,S,P,C){var x=this;return new Promise(function(B,F){var U=[],w=function k(K){var N=S[K];x.fragmentLoader.loadPart(c,N,C).then(function(G){U[N.index]=G;var H=G.part;x.hls.trigger(O.Events.FRAG_LOADED,G);var V=S[K+1];if(V&&V.fragment===c)k(K+1);else return B({frag:c,part:H,partsLoaded:U})}).catch(F)};w(P)})},i.handleFragLoadError=function(c){var S=c.data;return S&&S.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(S.frag,S.part):this.hls.trigger(O.Events.ERROR,S),null},i._handleTransmuxerFlush=function(c){var S=this.getCurrentContext(c);if(!S||this.state!==v.PARSING){this.fragCurrent||(this.state=v.IDLE);return}var P=S.frag,C=S.part,x=S.level,B=self.performance.now();P.stats.parsing.end=B,C&&(C.stats.parsing.end=B),this.updateLevelTiming(P,C,x,c.partial)},i.getCurrentContext=function(c){var S=this.levels,P=c.level,C=c.sn,x=c.part;if(!S||!S[P])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+P+". The current chunk will not be buffered."),null;var B=S[P],F=x>-1?Object(T.getPartWith)(B,C,x):null,U=F?F.fragment:Object(T.getFragmentWithSN)(B,C,this.fragCurrent);return U?{frag:U,part:F,level:B}:null},i.bufferFragmentData=function(c,S,P,C){if(!(!c||this.state!==v.PARSING)){var x=c.data1,B=c.data2,F=x;if(x&&B&&(F=Object(y.appendUint8Array)(x,B)),!(!F||!F.length)){var U={type:c.type,frag:S,part:P,chunkMeta:C,parent:S.type,data:F};this.hls.trigger(O.Events.BUFFER_APPENDING,U),c.dropped&&c.independent&&!P&&this.flushBufferGap(S)}}},i.flushBufferGap=function(c){var S=this.media;if(!!S){if(!M.BufferHelper.isBuffered(S,S.currentTime)){this.flushMainBuffer(0,c.start);return}var P=S.currentTime,C=M.BufferHelper.bufferInfo(S,P,0),x=c.duration,B=Math.min(this.config.maxFragLookUpTolerance*2,x*.25),F=Math.max(Math.min(c.start-B,C.end-B),P+B);c.start-F>B&&this.flushMainBuffer(F,c.start)}},i.getFwdBufferInfo=function(c,S){var P=this.config,C=this.getLoadPosition();if(!Object(I.isFiniteNumber)(C))return null;var x=M.BufferHelper.bufferInfo(c,C,P.maxBufferHole);if(x.len===0&&x.nextStart!==void 0){var B=this.fragmentTracker.getBufferedFrag(C,S);if(B&&x.nextStart<B.end)return M.BufferHelper.bufferInfo(c,C,Math.max(x.nextStart,P.maxBufferHole))}return x},i.getMaxBufferLength=function(c){var S=this.config,P;return c?P=Math.max(8*S.maxBufferSize/c,S.maxBufferLength):P=S.maxBufferLength,Math.min(P,S.maxMaxBufferLength)},i.reduceMaxBufferLength=function(c){var S=this.config,P=c||S.maxBufferLength;return S.maxMaxBufferLength>=P?(S.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+S.maxMaxBufferLength+"s"),!0):!1},i.getNextFragment=function(c,S){var P,C,x=S.fragments,B=x.length;if(!B)return null;var F=this.config,U=x[0].start,w;if(S.live){var k=F.initialLiveManifestSize;if(B<k)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+k+")"),null;!S.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(w=this.getInitialLiveFragment(S,x),this.startPosition=w?this.hls.liveSyncPosition||w.start:c)}else c<=U&&(w=x[0]);if(!w){var K=F.lowLatencyMode?S.partEnd:S.fragmentEnd;w=this.getFragmentAtPosition(c,K,S)}return(P=w)!==null&&P!==void 0&&P.initSegment&&!((C=w)!==null&&C!==void 0&&C.initSegment.data)&&!this.bitrateTest&&(w=w.initSegment),w},i.getNextPart=function(c,S,P){for(var C=-1,x=!1,B=!0,F=0,U=c.length;F<U;F++){var w=c[F];if(B=B&&!w.independent,C>-1&&P<w.start)break;var k=w.loaded;!k&&(x||w.independent||B)&&w.fragment===S&&(C=F),x=k}return C},i.loadedEndOfParts=function(c,S){var P=c[c.length-1];return P&&S>P.start&&P.loaded},i.getInitialLiveFragment=function(c,S){var P=this.fragPrevious,C=null;if(P){if(c.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+P.programDateTime),C=Object(p.findFragmentByPDT)(S,P.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var x=P.sn+1;if(x>=c.startSN&&x<=c.endSN){var B=S[x-c.startSN];P.cc===B.cc&&(C=B,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(p.findFragWithCC)(S,P.cc),C&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(C=this.getFragmentAtPosition(F,this.bitrateTest?c.fragmentEnd:c.edge,c))}return C},i.getFragmentAtPosition=function(c,S,P){var C=this.config,x=this.fragPrevious,B=P.fragments,F=P.endSN,U=P.fragmentHint,w=C.maxFragLookUpTolerance,k=!!(C.lowLatencyMode&&P.partList&&U);k&&U&&!this.bitrateTest&&(B=B.concat(U),F=U.sn);var K;if(c<S){var N=c>S-w?0:w;K=Object(p.findFragmentByPTS)(x,B,c,N)}else K=B[B.length-1];if(K){var G=K.sn-P.startSN,H=x&&K.level===x.level,V=B[G+1],z=this.fragmentTracker.getState(K);if(z===D.FragmentState.BACKTRACKED){K=null;for(var Q=G;B[Q]&&this.fragmentTracker.getState(B[Q])===D.FragmentState.BACKTRACKED;)x?K=B[Q--]:K=B[--Q];K||(K=V)}else x&&K.sn===x.sn&&!k&&H&&(K.sn<F&&this.fragmentTracker.getState(V)!==D.FragmentState.OK?(this.log("SN "+K.sn+" just loaded, load next one: "+V.sn),K=V):K=null)}return K},i.synchronizeToLiveEdge=function(c){var S=this.config,P=this.media;if(!!P){var C=this.hls.liveSyncPosition,x=P.currentTime,B=c.fragments[0].start,F=c.edge,U=x>=B-S.maxFragLookUpTolerance&&x<=F;if(C!==null&&P.duration>C&&(x<C||!U)){var w=S.liveMaxLatencyDuration!==void 0?S.liveMaxLatencyDuration:S.liveMaxLatencyDurationCount*c.targetduration;(!U&&P.readyState<4||x<F-w)&&(this.loadedmetadata||(this.nextLoadPosition=C),P.readyState&&(this.warn("Playback: "+x.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+C.toFixed(3)),P.currentTime=C))}}},i.alignPlaylists=function(c,S){var P=this.levels,C=this.levelLastLoaded,x=this.fragPrevious,B=C!==null?P[C]:null,F=c.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var U=c.fragments[0].start,w=!S,k=c.alignedSliding&&Object(I.isFiniteNumber)(U);if(w||!k&&!U){Object(E.alignStream)(x,B,c);var K=c.fragments[0].start;return this.log("Live playlist sliding: "+K.toFixed(2)+" start-sn: "+(S?S.startSN:"na")+"->"+c.startSN+" prev-sn: "+(x?x.sn:"na")+" fragments: "+F),K}return U},i.waitForCdnTuneIn=function(c){var S=3;return c.live&&c.canBlockReload&&c.tuneInGoal>Math.max(c.partHoldBack,c.partTarget*S)},i.setStartPosition=function(c,S){var P=this.startPosition;if(P<S&&(P=-1),P===-1||this.lastCurrentTime===-1){var C=c.startTimeOffset;Object(I.isFiniteNumber)(C)?(P=S+C,C<0&&(P+=c.totalduration),P=Math.min(Math.max(S,P),S+c.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+P),this.startPosition=P):c.live?P=this.hls.liveSyncPosition||S:this.startPosition=P=0,this.lastCurrentTime=P}this.nextLoadPosition=P},i.getLoadPosition=function(){var c=this.media,S=0;return this.loadedmetadata&&c?S=c.currentTime:this.nextLoadPosition&&(S=this.nextLoadPosition),S},i.handleFragLoadAborted=function(c,S){this.transmuxer&&c.sn!=="initSegment"&&c.stats.aborted&&(this.warn("Fragment "+c.sn+(S?" part"+S.index:"")+" of level "+c.level+" was aborted"),this.resetFragmentLoading(c))},i.resetFragmentLoading=function(c){(!this.fragCurrent||!this.fragContextChanged(c))&&(this.state=v.IDLE)},i.onFragmentOrKeyLoadError=function(c,S){if(!S.fatal){var P=S.frag;if(!(!P||P.type!==c)){var C=this.fragCurrent;console.assert(C&&P.sn===C.sn&&P.level===C.level&&P.urlId===C.urlId,"Frag load error must match current frag to retry");var x=this.config;if(this.fragLoadError+1<=x.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(P.level))return;var B=Math.min(Math.pow(2,this.fragLoadError)*x.fragLoadingRetryDelay,x.fragLoadingMaxRetryTimeout);this.warn("Fragment "+P.sn+" of "+c+" "+P.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=v.FRAG_LOADING_WAITING_RETRY}else S.levelRetry?(c===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=v.IDLE):(R.logger.error(S.details+" reaches max retry, redispatch as fatal ..."),S.fatal=!0,this.hls.stopLoad(),this.state=v.ERROR)}}},i.afterBufferFlushed=function(c,S,P){if(!!c){var C=M.BufferHelper.getBuffered(c);this.fragmentTracker.detectEvictedFragments(S,C,P),this.state===v.ENDED&&this.resetLoadingState()}},i.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=v.IDLE},i.resetLiveStartWhenNotLoaded=function(c){if(!this.loadedmetadata){this.startFragRequested=!1;var S=this.levels?this.levels[c].details:null;if(S!=null&&S.live)return this.startPosition=-1,this.setStartPosition(S,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},i.updateLevelTiming=function(c,S,P,C){var x=this,B=P.details;console.assert(!!B,"level.details must be defined");var F=Object.keys(c.elementaryStreams).reduce(function(U,w){var k=c.elementaryStreams[w];if(k){var K=k.endPTS-k.startPTS;if(K<=0)return x.warn("Could not parse fragment "+c.sn+" "+w+" duration reliably ("+K+") resetting transmuxer to fallback to playlist timing"),x.resetTransmuxer(),U||!1;var N=C?0:Object(T.updateFragPTSDTS)(B,c,k.startPTS,k.endPTS,k.startDTS,k.endDTS);return x.hls.trigger(O.Events.LEVEL_PTS_UPDATED,{details:B,level:P,drift:N,type:w,frag:c,start:k.startPTS,end:k.endPTS}),!0}return U},!1);F?(this.state=v.PARSED,this.hls.trigger(O.Events.FRAG_PARSED,{frag:c,part:S})):this.resetLoadingState()},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},f(r,[{key:"state",get:function(){return this._state},set:function(c){var S=this._state;S!==c&&(this._state=c,this.log(S+"->"+c))}}]),r}(L.default)},"./src/controller/buffer-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return p});var I=m("./src/polyfills/number.ts"),L=m("./src/events.ts"),D=m("./src/utils/logger.ts"),M=m("./src/errors.ts"),R=m("./src/utils/buffer-helper.ts"),O=m("./src/utils/mediasource-helper.ts"),A=m("./src/loader/fragment.ts"),u=m("./src/controller/buffer-operation-queue.ts"),y=Object(O.getMediaSource)(),E=/([ha]vc.)(?:\.[^.,]+)+/,p=function(){function T(n){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.hls,a=e.media,f=e.mediaSource;D.logger.log("[buffer-controller]: Media source opened"),a&&(e.updateMediaElementDuration(),t.trigger(L.Events.MEDIA_ATTACHED,{media:a})),f&&f.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){D.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){D.logger.log("[buffer-controller]: Media source ended")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var _=T.prototype;return _.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},_.destroy=function(){this.unregisterListeners(),this.details=null},_.registerListeners=function(){var e=this.hls;e.on(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.Events.BUFFER_RESET,this.onBufferReset,this),e.on(L.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.Events.BUFFER_EOS,this.onBufferEos,this),e.on(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.Events.FRAG_PARSED,this.onFragParsed,this),e.on(L.Events.FRAG_CHANGED,this.onFragChanged,this)},_.unregisterListeners=function(){var e=this.hls;e.off(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.Events.BUFFER_RESET,this.onBufferReset,this),e.off(L.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.Events.BUFFER_EOS,this.onBufferEos,this),e.off(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.Events.FRAG_PARSED,this.onFragParsed,this),e.off(L.Events.FRAG_CHANGED,this.onFragChanged,this)},_._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new u.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},_.onManifestParsed=function(e,t){var a=2;(t.audio&&!t.video||!t.altAudio)&&(a=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=a,this.details=null,D.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},_.onMediaAttaching=function(e,t){var a=this.media=t.media;if(a&&y){var f=this.mediaSource=new y;f.addEventListener("sourceopen",this._onMediaSourceOpen),f.addEventListener("sourceended",this._onMediaSourceEnded),f.addEventListener("sourceclose",this._onMediaSourceClose),a.src=self.URL.createObjectURL(f),this._objectUrl=a.src}},_.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,a=this._objectUrl;if(t){if(D.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(f){D.logger.warn("[buffer-controller]: onMediaDetaching: "+f.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(a&&self.URL.revokeObjectURL(a),e.src===a?(e.removeAttribute("src"),e.load()):D.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(L.Events.MEDIA_DETACHED,void 0)},_.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var a=e.sourceBuffer[t];try{a&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(a),e.sourceBuffer[t]=void 0)}catch(f){D.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",f)}}),this._initSourceBuffer()},_.onBufferCodecs=function(e,t){var a=this,f=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(s){if(f){var d=a.tracks[s];if(d&&typeof d.buffer.changeType=="function"){var g=t[s],v=g.codec,l=g.levelCodec,o=g.container,r=(d.levelCodec||d.codec).replace(E,"$1"),i=(l||v).replace(E,"$1");if(r!==i){var h=o+";codecs="+(l||v);a.appendChangeType(s,h)}}}else a.pendingTracks[s]=t[s]}),!f&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},_.appendChangeType=function(e,t){var a=this,f=this.operationQueue,s={execute:function(){var g=a.sourceBuffer[e];g&&(D.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),g.changeType(t)),f.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(g){D.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",g)}};f.append(s,e)},_.onBufferAppending=function(e,t){var a=this,f=this.hls,s=this.operationQueue,d=this.tracks,g=t.data,v=t.type,l=t.frag,o=t.part,r=t.chunkMeta,i=r.buffering[v],h=self.performance.now();i.start=h;var c=l.stats.buffering,S=o?o.stats.buffering:null;c.start===0&&(c.start=h),S&&S.start===0&&(S.start=h);var P=d.audio,C=v==="audio"&&r.id===1&&(P==null?void 0:P.container)==="audio/mpeg",x={execute:function(){if(i.executeStart=self.performance.now(),C){var F=a.sourceBuffer[v];if(F){var U=l.start-F.timestampOffset;Math.abs(U)>=.1&&(D.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+U+") sn: "+l.sn+")"),F.timestampOffset=l.start)}}a.appendExecutor(g,v)},onStart:function(){},onComplete:function(){var F=self.performance.now();i.executeEnd=i.end=F,c.first===0&&(c.first=F),S&&S.first===0&&(S.first=F);var U=a.sourceBuffer,w={};for(var k in U)w[k]=R.BufferHelper.getBuffered(U[k]);a.appendError=0,a.hls.trigger(L.Events.BUFFER_APPENDED,{type:v,frag:l,part:o,chunkMeta:r,parent:l.type,timeRanges:w})},onError:function(F){D.logger.error("[buffer-controller]: Error encountered while trying to append to the "+v+" SourceBuffer",F);var U={type:M.ErrorTypes.MEDIA_ERROR,parent:l.type,details:M.ErrorDetails.BUFFER_APPEND_ERROR,err:F,fatal:!1};F.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=M.ErrorDetails.BUFFER_FULL_ERROR:(a.appendError++,U.details=M.ErrorDetails.BUFFER_APPEND_ERROR,a.appendError>f.config.appendErrorMaxRetry&&(D.logger.error("[buffer-controller]: Failed "+f.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0)),f.trigger(L.Events.ERROR,U)}};s.append(x,v)},_.onBufferFlushing=function(e,t){var a=this,f=this.operationQueue,s=function(g){return{execute:a.removeExecutor.bind(a,g,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){a.hls.trigger(L.Events.BUFFER_FLUSHED,{type:g})},onError:function(l){D.logger.warn("[buffer-controller]: Failed to remove from "+g+" SourceBuffer",l)}}};t.type?f.append(s(t.type),t.type):this.getSourceBufferTypes().forEach(function(d){f.append(s(d),d)})},_.onFragParsed=function(e,t){var a=this,f=t.frag,s=t.part,d=[],g=s?s.elementaryStreams:f.elementaryStreams;g[A.ElementaryStreamTypes.AUDIOVIDEO]?d.push("audiovideo"):(g[A.ElementaryStreamTypes.AUDIO]&&d.push("audio"),g[A.ElementaryStreamTypes.VIDEO]&&d.push("video"));var v=function(){var o=self.performance.now();f.stats.buffering.end=o,s&&(s.stats.buffering.end=o);var r=s?s.stats:f.stats;a.hls.trigger(L.Events.FRAG_BUFFERED,{frag:f,part:s,stats:r,id:f.type})};d.length===0&&D.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+f.type+" level: "+f.level+" sn: "+f.sn),this.blockBuffers(v,d)},_.onFragChanged=function(e,t){this.flushBackBuffer()},_.onBufferEos=function(e,t){var a=this,f=this.getSourceBufferTypes().reduce(function(s,d){var g=a.sourceBuffer[d];return(!t.type||t.type===d)&&g&&!g.ended&&(g.ended=!0,D.logger.log("[buffer-controller]: "+d+" sourceBuffer now EOS")),s&&!!(!g||g.ended)},!0);f&&this.blockBuffers(function(){var s=a.mediaSource;!s||s.readyState!=="open"||s.endOfStream()})},_.onLevelUpdated=function(e,t){var a=t.details;!a.fragments.length||(this.details=a,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},_.flushBackBuffer=function(){var e=this.hls,t=this.details,a=this.media,f=this.sourceBuffer;if(!(!a||t===null)){var s=this.getSourceBufferTypes();if(!!s.length){var d=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(I.isFiniteNumber)(d)||d<0)){var g=a.currentTime,v=t.levelTargetDuration,l=Math.max(d,v),o=Math.floor(g/v)*v-l;s.forEach(function(r){var i=f[r];if(i){var h=R.BufferHelper.getBuffered(i);h.length>0&&o>h.start(0)&&(e.trigger(L.Events.BACK_BUFFER_REACHED,{bufferEnd:o}),t.live&&e.trigger(L.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o}),e.trigger(L.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:r}))}})}}}},_.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,t=this.hls,a=this.media,f=this.mediaSource,s=e.fragments[0].start+e.totalduration,d=a.duration,g=Object(I.isFiniteNumber)(f.duration)?f.duration:0;e.live&&t.config.liveDurationInfinity?(D.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),f.duration=1/0,this.updateSeekableRange(e)):(s>g&&s>d||!Object(I.isFiniteNumber)(d))&&(D.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),f.duration=s)}},_.updateSeekableRange=function(e){var t=this.mediaSource,a=e.fragments,f=a.length;if(f&&e.live&&t!==null&&t!==void 0&&t.setLiveSeekableRange){var s=Math.max(0,a[0].start),d=Math.max(s,s+e.totalduration);t.setLiveSeekableRange(s,d)}},_.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,a=this.pendingTracks,f=Object.keys(a).length;if(f&&!e||f===2){this.createSourceBuffers(a),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(L.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(d){t.executeNext(d)})}},_.createSourceBuffers=function(e){var t=this.sourceBuffer,a=this.mediaSource;if(!a)throw Error("createSourceBuffers called when mediaSource was null");var f=0;for(var s in e)if(!t[s]){var d=e[s];if(!d)throw Error("source buffer exists for track "+s+", however track does not");var g=d.levelCodec||d.codec,v=d.container+";codecs="+g;D.logger.log("[buffer-controller]: creating sourceBuffer("+v+")");try{var l=t[s]=a.addSourceBuffer(v),o=s;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[s]={buffer:l,codec:g,container:d.container,levelCodec:d.levelCodec,id:d.id},f++}catch(r){D.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(L.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:v})}}f&&this.hls.trigger(L.Events.BUFFER_CREATED,{tracks:this.tracks})},_._onSBUpdateStart=function(e){var t=this.operationQueue,a=t.current(e);a.onStart()},_._onSBUpdateEnd=function(e){var t=this.operationQueue,a=t.current(e);a.onComplete(),t.shiftAndExecuteNext(e)},_._onSBUpdateError=function(e,t){D.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(L.Events.ERROR,{type:M.ErrorTypes.MEDIA_ERROR,details:M.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var a=this.operationQueue.current(e);a&&a.onError(t)},_.removeExecutor=function(e,t,a){var f=this.media,s=this.mediaSource,d=this.operationQueue,g=this.sourceBuffer,v=g[e];if(!f||!s||!v){D.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),d.shiftAndExecuteNext(e);return}var l=Object(I.isFiniteNumber)(f.duration)?f.duration:1/0,o=Object(I.isFiniteNumber)(s.duration)?s.duration:1/0,r=Math.max(0,t),i=Math.min(a,l,o);i>r?(D.logger.log("[buffer-controller]: Removing ["+r+","+i+"] from the "+e+" SourceBuffer"),console.assert(!v.updating,e+" sourceBuffer must not be updating"),v.remove(r,i)):d.shiftAndExecuteNext(e)},_.appendExecutor=function(e,t){var a=this.operationQueue,f=this.sourceBuffer,s=f[t];if(!s){D.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(t);return}s.ended=!1,console.assert(!s.updating,t+" sourceBuffer must not be updating"),s.appendBuffer(e)},_.blockBuffers=function(e,t){var a=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length){D.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(e);return}var f=this.operationQueue,s=t.map(function(d){return f.appendBlocker(d)});Promise.all(s).then(function(){e(),t.forEach(function(d){var g=a.sourceBuffer[d];(!g||!g.updating)&&f.shiftAndExecuteNext(d)})})},_.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},_.addBufferListener=function(e,t,a){var f=this.sourceBuffer[e];if(!!f){var s=a.bind(this,e);this.listeners[e].push({event:t,listener:s}),f.addEventListener(t,s)}},_.removeBufferListeners=function(e){var t=this.sourceBuffer[e];!t||this.listeners[e].forEach(function(a){t.removeEventListener(a.event,a.listener)})},T}()},"./src/controller/buffer-operation-queue.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return L});var I=m("./src/utils/logger.ts"),L=function(){function D(R){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=R}var M=D.prototype;return M.append=function(O,A){var u=this.queues[A];u.push(O),u.length===1&&this.buffers[A]&&this.executeNext(A)},M.insertAbort=function(O,A){var u=this.queues[A];u.unshift(O),this.executeNext(A)},M.appendBlocker=function(O){var A,u=new Promise(function(E){A=E}),y={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(y,O),u},M.executeNext=function(O){var A=this.buffers,u=this.queues,y=A[O],E=u[O];if(E.length){var p=E[0];try{p.execute()}catch(T){I.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),p.onError(T),(!y||!y.updating)&&(E.shift(),this.executeNext(O))}}},M.shiftAndExecuteNext=function(O){this.queues[O].shift(),this.executeNext(O)},M.current=function(O){return this.queues[O][0]},D}()},"./src/controller/cap-level-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/events.ts");function L(R,O){for(var A=0;A<O.length;A++){var u=O[A];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(R,u.key,u)}}function D(R,O,A){return O&&L(R.prototype,O),A&&L(R,A),R}var M=function(){function R(A){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=A,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var O=R.prototype;return O.setStreamController=function(u){this.streamController=u},O.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},O.registerListeners=function(){var u=this.hls;u.on(I.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),u.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),u.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.unregisterListener=function(){var u=this.hls;u.off(I.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),u.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(I.Events.BUFFER_CODECS,this.onBufferCodecs,this),u.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},O.onFpsDropLevelCapping=function(u,y){R.isLevelAllowed(y.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(y.droppedLevel)},O.onMediaAttaching=function(u,y){this.media=y.media instanceof HTMLVideoElement?y.media:null},O.onManifestParsed=function(u,y){var E=this.hls;this.restrictedLevels=[],this.firstLevel=y.firstLevel,E.config.capLevelToPlayerSize&&y.video&&this.startCapping()},O.onBufferCodecs=function(u,y){var E=this.hls;E.config.capLevelToPlayerSize&&y.video&&this.startCapping()},O.onMediaDetaching=function(){this.stopCapping()},O.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var u=this.hls.levels;if(u.length){var y=this.hls;y.autoLevelCapping=this.getMaxLevel(u.length-1),y.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=y.autoLevelCapping}}},O.getMaxLevel=function(u){var y=this,E=this.hls.levels;if(!E.length)return-1;var p=E.filter(function(T,_){return R.isLevelAllowed(_,y.restrictedLevels)&&_<=u});return this.clientRect=null,R.getMaxLevelByMediaSize(p,this.mediaWidth,this.mediaHeight)},O.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},O.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},O.getDimensions=function(){if(this.clientRect)return this.clientRect;var u=this.media,y={width:0,height:0};if(u){var E=u.getBoundingClientRect();y.width=E.width,y.height=E.height,!y.width&&!y.height&&(y.width=E.right-E.left||u.width||0,y.height=E.bottom-E.top||u.height||0)}return this.clientRect=y,y},R.isLevelAllowed=function(u,y){return y===void 0&&(y=[]),y.indexOf(u)===-1},R.getMaxLevelByMediaSize=function(u,y,E){if(!u||!u.length)return-1;for(var p=function(t,a){return a?t.width!==a.width||t.height!==a.height:!0},T=u.length-1,_=0;_<u.length;_+=1){var n=u[_];if((n.width>=y||n.height>=E)&&p(n,u[_+1])){T=_;break}}return T},D(R,[{key:"mediaWidth",get:function(){return this.getDimensions().width*R.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*R.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var u=1;try{u=self.devicePixelRatio}catch{}return u}}]),R}();b.default=M},"./src/controller/eme-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/events.ts"),L=m("./src/errors.ts"),D=m("./src/utils/logger.ts"),M=m("./src/utils/mediakeys-helper.ts");function R(p,T){for(var _=0;_<T.length;_++){var n=T[_];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(p,n.key,n)}}function O(p,T,_){return T&&R(p.prototype,T),_&&R(p,_),p}var A=3,u=function(T,_,n){var e={audioCapabilities:[],videoCapabilities:[]};return T.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})}),_.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})}),[e]},y=function(T,_,n,e){switch(T){case M.KeySystems.WIDEVINE:return u(_,n,e);default:throw new Error("Unknown key-system: "+T)}},E=function(){function p(_){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=_,this._config=_.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var T=p.prototype;return T.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},T._registerListeners=function(){this.hls.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(I.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T._unregisterListeners=function(){this.hls.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(I.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this)},T.getLicenseServerUrl=function(n){switch(n){case M.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},T._attemptKeySystemAccess=function(n,e,t){var a=this,f=y(n,e,t,this._drmSystemOptions);D.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(n,f);this.mediaKeysPromise=s.then(function(d){return a._onMediaKeySystemAccessObtained(n,d)}),s.catch(function(d){D.logger.error('Failed to obtain key-system "'+n+'" access:',d)})},T._onMediaKeySystemAccessObtained=function(n,e){var t=this;D.logger.log('Access for key-system "'+n+'" obtained');var a={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:n};this._mediaKeysList.push(a);var f=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(s){return a.mediaKeys=s,D.logger.log('Media-keys created for key-system "'+n+'"'),t._onMediaKeysCreated(),s});return f.catch(function(s){D.logger.error("Failed to create media-keys:",s)}),f},T._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),n._onNewMediaKeySession(e.mediaKeysSession))})},T._onNewMediaKeySession=function(n){var e=this;D.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(t){e._onKeySessionMessage(n,t.message)},!1)},T._onKeySessionMessage=function(n,e){D.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(t){D.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),n.update(t)})},T.onMediaEncrypted=function(n){var e=this;if(D.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var t=function(f){!e._media||(e._attemptSetMediaKeys(f),e._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(t).catch(t)},T._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){D.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}D.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},T._generateRequestWithPreferredKeySession=function(n,e){var t=this,a=this._mediaKeysList[0];if(!a){D.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(a.mediaKeysSessionInitialized){D.logger.warn("Key-Session already initialized but requested again");return}var f=a.mediaKeysSession;if(!f){D.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){D.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}D.logger.log('Generating key-session request for "'+n+'" init data type'),a.mediaKeysSessionInitialized=!0,f.generateRequest(n,e).then(function(){D.logger.debug("Key-session generation succeeded")}).catch(function(s){D.logger.error("Error generating key-session request:",s),t.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},T._createLicenseXhr=function(n,e,t){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,a,n,e,t);var f=this._licenseXhrSetup;if(f)try{f.call(this.hls,a,n),f=void 0}catch(s){D.logger.error(s)}try{a.readyState||a.open("POST",n,!0),f&&f.call(this.hls,a,n)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return a},T._onLicenseRequestReadyStageChange=function(n,e,t,a){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,D.logger.log("License request succeeded");var f=n.response,s=this._licenseResponseCallback;if(s)try{f=s.call(this.hls,n,e)}catch(g){D.logger.error(g)}a(f)}else{if(D.logger.error("License Request XHR failed ("+e+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>A){this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var d=A-this._requestLicenseFailureCount+1;D.logger.warn("Retrying license request, "+d+" attempts left"),this._requestLicense(t,a)}break}},T._generateLicenseRequestChallenge=function(n,e){switch(n.mediaKeySystemDomain){case M.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},T._requestLicense=function(n,e){D.logger.log("Requesting content license for key-system");var t=this._mediaKeysList[0];if(!t){D.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var a=this.getLicenseServerUrl(t.mediaKeySystemDomain),f=this._createLicenseXhr(a,n,e);D.logger.log("Sending license request to URL: "+a);var s=this._generateLicenseRequestChallenge(t,n);f.send(s)}catch(d){D.logger.error("Failure requesting DRM license: "+d),this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.KEY_SYSTEM_ERROR,details:L.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},T.onMediaAttached=function(n,e){if(!!this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},T.onMediaDetached=function(){var n=this._media,e=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},T.onManifestParsed=function(n,e){if(!!this._emeEnabled){var t=e.levels.map(function(f){return f.audioCodec}).filter(function(f){return!!f}),a=e.levels.map(function(f){return f.videoCodec}).filter(function(f){return!!f});this._attemptKeySystemAccess(M.KeySystems.WIDEVINE,t,a)}},O(p,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),p}();b.default=E},"./src/controller/fps-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/events.ts"),L=m("./src/utils/logger.ts"),D=function(){function M(O){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=O,this.registerListeners()}var R=M.prototype;return R.setStreamController=function(A){this.streamController=A},R.registerListeners=function(){this.hls.on(I.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},R.unregisterListeners=function(){this.hls.off(I.Events.MEDIA_ATTACHING,this.onMediaAttaching)},R.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},R.onMediaAttaching=function(A,u){var y=this.hls.config;if(y.capLevelOnFPSDrop){var E=u.media instanceof self.HTMLVideoElement?u.media:null;this.media=E,E&&typeof E.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),y.fpsDroppedMonitoringPeriod)}},R.checkFPS=function(A,u,y){var E=performance.now();if(u){if(this.lastTime){var p=E-this.lastTime,T=y-this.lastDroppedFrames,_=u-this.lastDecodedFrames,n=1e3*T/p,e=this.hls;if(e.trigger(I.Events.FPS_DROP,{currentDropped:T,currentDecoded:_,totalDroppedFrames:y}),n>0&&T>e.config.fpsDroppedMonitoringThreshold*_){var t=e.currentLevel;L.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=t)&&(t=t-1,e.trigger(I.Events.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:e.currentLevel}),e.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=E,this.lastDroppedFrames=y,this.lastDecodedFrames=u}},R.checkFPSInterval=function(){var A=this.media;if(A)if(this.isVideoPlaybackQualityAvailable){var u=A.getVideoPlaybackQuality();this.checkFPS(A,u.totalVideoFrames,u.droppedVideoFrames)}else this.checkFPS(A,A.webkitDecodedFrameCount,A.webkitDroppedFrameCount)},M}();b.default=D},"./src/controller/fragment-finders.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"findFragmentByPDT",function(){return D}),m.d(b,"findFragmentByPTS",function(){return M}),m.d(b,"fragmentWithinToleranceTest",function(){return R}),m.d(b,"pdtWithinToleranceTest",function(){return O}),m.d(b,"findFragWithCC",function(){return A});var I=m("./src/polyfills/number.ts"),L=m("./src/utils/binary-search.ts");function D(u,y,E){if(y===null||!Array.isArray(u)||!u.length||!Object(I.isFiniteNumber)(y))return null;var p=u[0].programDateTime;if(y<(p||0))return null;var T=u[u.length-1].endProgramDateTime;if(y>=(T||0))return null;E=E||0;for(var _=0;_<u.length;++_){var n=u[_];if(O(y,E,n))return n}return null}function M(u,y,E,p){E===void 0&&(E=0),p===void 0&&(p=0);var T=null;if(u?T=y[u.sn-y[0].sn+1]||null:E===0&&y[0].start===0&&(T=y[0]),T&&R(E,p,T)===0)return T;var _=L.default.search(y,R.bind(null,E,p));return _||T}function R(u,y,E){u===void 0&&(u=0),y===void 0&&(y=0);var p=Math.min(y,E.duration+(E.deltaPTS?E.deltaPTS:0));return E.start+E.duration-p<=u?1:E.start-p>u&&E.start?-1:0}function O(u,y,E){var p=Math.min(y,E.duration+(E.deltaPTS?E.deltaPTS:0))*1e3,T=E.endProgramDateTime||0;return T-p>u}function A(u,y){return L.default.search(u,function(E){return E.cc<y?1:E.cc>y?-1:0})}},"./src/controller/fragment-tracker.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"FragmentState",function(){return D}),m.d(b,"FragmentTracker",function(){return M});var I=m("./src/events.ts"),L=m("./src/types/loader.ts"),D;(function(A){A.NOT_LOADED="NOT_LOADED",A.BACKTRACKED="BACKTRACKED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(D||(D={}));var M=function(){function A(y){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=y,this._registerListeners()}var u=A.prototype;return u._registerListeners=function(){var E=this.hls;E.on(I.Events.BUFFER_APPENDED,this.onBufferAppended,this),E.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.on(I.Events.FRAG_LOADED,this.onFragLoaded,this)},u._unregisterListeners=function(){var E=this.hls;E.off(I.Events.BUFFER_APPENDED,this.onBufferAppended,this),E.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this),E.off(I.Events.FRAG_LOADED,this.onFragLoaded,this)},u.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},u.getAppendedFrag=function(E,p){if(p===L.PlaylistLevelType.MAIN){var T=this.activeFragment,_=this.activeParts;if(!T)return null;if(_)for(var n=_.length;n--;){var e=_[n],t=e?e.end:T.appendedPTS;if(e.start<=E&&t!==void 0&&E<=t)return n>9&&(this.activeParts=_.slice(n-9)),e}else if(T.start<=E&&T.appendedPTS!==void 0&&E<=T.appendedPTS)return T}return this.getBufferedFrag(E,p)},u.getBufferedFrag=function(E,p){for(var T=this.fragments,_=Object.keys(T),n=_.length;n--;){var e=T[_[n]];if((e==null?void 0:e.body.type)===p&&e.buffered){var t=e.body;if(t.start<=E&&E<=t.end)return t}}return null},u.detectEvictedFragments=function(E,p,T){var _=this;Object.keys(this.fragments).forEach(function(n){var e=_.fragments[n];if(!!e){if(!e.buffered){e.body.type===T&&_.removeFragment(e.body);return}var t=e.range[E];!t||t.time.some(function(a){var f=!_.isTimeBuffered(a.startPTS,a.endPTS,p);return f&&_.removeFragment(e.body),f})}})},u.detectPartialFragments=function(E){var p=this,T=this.timeRanges,_=E.frag,n=E.part;if(!(!T||_.sn==="initSegment")){var e=O(_),t=this.fragments[e];!t||(Object.keys(T).forEach(function(a){var f=_.elementaryStreams[a];if(!!f){var s=T[a],d=n!==null||f.partial===!0;t.range[a]=p.getBufferedTimes(_,n,d,s)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},u.fragBuffered=function(E){var p=O(E),T=this.fragments[p];T&&(T.backtrack=T.loaded=null,T.buffered=!0)},u.getBufferedTimes=function(E,p,T,_){for(var n={time:[],partial:T},e=p?p.start:E.start,t=p?p.end:E.end,a=E.minEndPTS||t,f=E.maxStartPTS||e,s=0;s<_.length;s++){var d=_.start(s)-this.bufferPadding,g=_.end(s)+this.bufferPadding;if(f>=d&&a<=g){n.time.push({startPTS:Math.max(e,_.start(s)),endPTS:Math.min(t,_.end(s))});break}else if(e<g&&t>d)n.partial=!0,n.time.push({startPTS:Math.max(e,_.start(s)),endPTS:Math.min(t,_.end(s))});else if(t<=d)break}return n},u.getPartialFragment=function(E){var p=null,T,_,n,e=0,t=this.bufferPadding,a=this.fragments;return Object.keys(a).forEach(function(f){var s=a[f];!s||R(s)&&(_=s.body.start-t,n=s.body.end+t,E>=_&&E<=n&&(T=Math.min(E-_,n-E),e<=T&&(p=s.body,e=T)))}),p},u.getState=function(E){var p=O(E),T=this.fragments[p];return T?T.buffered?R(T)?D.PARTIAL:D.OK:T.backtrack?D.BACKTRACKED:D.APPENDING:D.NOT_LOADED},u.backtrack=function(E,p){var T=O(E),_=this.fragments[T];if(!_||_.backtrack)return null;var n=_.backtrack=p||_.loaded;return _.loaded=null,n},u.getBacktrackData=function(E){var p=O(E),T=this.fragments[p];if(T){var _,n=T.backtrack;if(n!=null&&(_=n.payload)!==null&&_!==void 0&&_.byteLength)return n;this.removeFragment(E)}return null},u.isTimeBuffered=function(E,p,T){for(var _,n,e=0;e<T.length;e++){if(_=T.start(e)-this.bufferPadding,n=T.end(e)+this.bufferPadding,E>=_&&p<=n)return!0;if(p<=_)return!1}return!1},u.onFragLoaded=function(E,p){var T=p.frag,_=p.part;if(!(T.sn==="initSegment"||T.bitrateTest||_)){var n=O(T);this.fragments[n]={body:T,loaded:p,backtrack:null,buffered:!1,range:Object.create(null)}}},u.onBufferAppended=function(E,p){var T=this,_=p.frag,n=p.part,e=p.timeRanges;if(_.type===L.PlaylistLevelType.MAIN)if(this.activeFragment=_,n){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(n)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(a){var f=e[a];if(T.detectEvictedFragments(a,f),!n)for(var s=0;s<f.length;s++)_.appendedPTS=Math.max(f.end(s),_.appendedPTS||0)})},u.onFragBuffered=function(E,p){this.detectPartialFragments(p)},u.hasFragment=function(E){var p=O(E);return!!this.fragments[p]},u.removeFragmentsInRange=function(E,p,T){var _=this;Object.keys(this.fragments).forEach(function(n){var e=_.fragments[n];if(!!e&&e.buffered){var t=e.body;t.type===T&&t.start<p&&t.end>E&&_.removeFragment(t)}})},u.removeFragment=function(E){var p=O(E);E.stats.loaded=0,E.clearElementaryStreamInfo(),delete this.fragments[p]},u.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function R(A){var u,y;return A.buffered&&(((u=A.range.video)===null||u===void 0?void 0:u.partial)||((y=A.range.audio)===null||y===void 0?void 0:y.partial))}function O(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"STALL_MINIMUM_DURATION_MS",function(){return R}),m.d(b,"MAX_START_GAP_JUMP",function(){return O}),m.d(b,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return A}),m.d(b,"SKIP_BUFFER_RANGE_START",function(){return u}),m.d(b,"default",function(){return y});var I=m("./src/utils/buffer-helper.ts"),L=m("./src/errors.ts"),D=m("./src/events.ts"),M=m("./src/utils/logger.ts"),R=250,O=2,A=.1,u=.05,y=function(){function E(T,_,n,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=T,this.media=_,this.fragmentTracker=n,this.hls=e}var p=E.prototype;return p.destroy=function(){this.hls=this.fragmentTracker=this.media=null},p.poll=function(_){var n=this.config,e=this.media,t=this.stalled,a=e.currentTime,f=e.seeking,s=this.seeking&&!f,d=!this.seeking&&f;if(this.seeking=f,a!==_){if(this.moved=!0,t!==null){if(this.stallReported){var g=self.performance.now()-t;M.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(g)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((d||s)&&(this.stalled=null),!(e.paused||e.ended||e.playbackRate===0||!I.BufferHelper.getBuffered(e).length)){var v=I.BufferHelper.bufferInfo(e,a,0),l=v.len>0,o=v.nextStart||0;if(!(!l&&!o)){if(f){var r=v.len>O,i=!o||o-a>O&&!this.fragmentTracker.getPartialFragment(a);if(r||i)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var h,c=Math.max(o,v.start||0)-a,S=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,P=S==null||(h=S.details)===null||h===void 0?void 0:h.live,C=P?S.details.targetduration*2:O;if(c>0&&c<=C){this._trySkipBufferHole(null);return}}var x=self.performance.now();if(t===null){this.stalled=x;return}var B=x-t;!f&&B>=R&&this._reportStall(v.len);var F=I.BufferHelper.bufferInfo(e,a,n.maxBufferHole);this._tryFixBufferStall(F,B)}}},p._tryFixBufferStall=function(_,n){var e=this.config,t=this.fragmentTracker,a=this.media,f=a.currentTime,s=t.getPartialFragment(f);if(s){var d=this._trySkipBufferHole(s);if(d)return}_.len>e.maxBufferHole&&n>e.highBufferWatchdogPeriod*1e3&&(M.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},p._reportStall=function(_){var n=this.hls,e=this.media,t=this.stallReported;t||(this.stallReported=!0,M.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+_+")"),n.trigger(D.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:_}))},p._trySkipBufferHole=function(_){for(var n=this.config,e=this.hls,t=this.media,a=t.currentTime,f=0,s=I.BufferHelper.getBuffered(t),d=0;d<s.length;d++){var g=s.start(d);if(a+n.maxBufferHole>=f&&a<g){var v=Math.max(g+u,t.currentTime+A);return M.logger.warn("skipping hole, adjusting currentTime from "+a+" to "+v),this.moved=!0,this.stalled=null,t.currentTime=v,_&&e.trigger(D.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+v,frag:_}),v}f=s.end(d)}return 0},p._tryNudgeBuffer=function(){var _=this.config,n=this.hls,e=this.media,t=e.currentTime,a=(this.nudgeRetry||0)+1;if(this.nudgeRetry=a,a<_.nudgeMaxRetry){var f=t+a*_.nudgeOffset;M.logger.warn("Nudging 'currentTime' from "+t+" to "+f),e.currentTime=f,n.trigger(D.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else M.logger.error("Playhead still not moving while enough data buffered @"+t+" after "+_.nudgeMaxRetry+" nudges"),n.trigger(D.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},E}()},"./src/controller/id3-track-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/events.ts"),L=m("./src/utils/texttrack-utils.ts"),D=m("./src/demux/id3.ts"),M=.25,R=function(){function O(u){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=u,this._registerListeners()}var A=O.prototype;return A.destroy=function(){this._unregisterListeners()},A._registerListeners=function(){var y=this.hls;y.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.on(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),y.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A._unregisterListeners=function(){var y=this.hls;y.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.off(I.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),y.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},A.onMediaAttached=function(y,E){this.media=E.media},A.onMediaDetaching=function(){!this.id3Track||(Object(L.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},A.getID3Track=function(y){if(!!this.media){for(var E=0;E<y.length;E++){var p=y[E];if(p.kind==="metadata"&&p.label==="id3")return Object(L.sendAddTrackEvent)(p,this.media),p}return this.media.addTextTrack("metadata","id3")}},A.onFragParsingMetadata=function(y,E){if(!!this.media){var p=E.frag,T=E.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var _=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,n=0;n<T.length;n++){var e=D.getID3Frames(T[n].data);if(e){var t=T[n].pts,a=n<T.length-1?T[n+1].pts:p.end,f=a-t;f<=0&&(a=t+M);for(var s=0;s<e.length;s++){var d=e[s];if(!D.isTimeStampFrame(d)){var g=new _(t,a,"");g.value=d,this.id3Track.addCue(g)}}}}}},A.onBufferFlushing=function(y,E){var p=E.startOffset,T=E.endOffset,_=E.type;if(!_||_==="audio"){var n=this.id3Track;n&&Object(L.removeCuesInRange)(n,p,T)}},O}();b.default=R},"./src/controller/latency-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return O});var I=m("./src/errors.ts"),L=m("./src/events.ts"),D=m("./src/utils/logger.ts");function M(A,u){for(var y=0;y<u.length;y++){var E=u[y];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(A,E.key,E)}}function R(A,u,y){return u&&M(A.prototype,u),y&&M(A,y),A}var O=function(){function A(y){var E=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return E.timeupdate()},this.hls=y,this.config=y.config,this.registerListeners()}var u=A.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},u.registerListeners=function(){this.hls.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(L.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){this.hls.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(L.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(L.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(L.Events.ERROR,this.onError)},u.onMediaAttached=function(E,p){this.media=p.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},u.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},u.onLevelUpdated=function(E,p){var T=p.details;this.levelDetails=T,T.advanced&&this.timeupdate(),!T.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},u.onError=function(E,p){p.details===I.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,D.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},u.timeupdate=function(){var E=this.media,p=this.levelDetails;if(!(!E||!p)){this.currentTime=E.currentTime;var T=this.computeLatency();if(T!==null){this._latency=T;var _=this.config,n=_.lowLatencyMode,e=_.maxLiveSyncPlaybackRate;if(!(!n||e===1)){var t=this.targetLatency;if(t!==null){var a=T-t,f=Math.min(this.maxLatency,t+p.targetduration),s=a<f;if(p.live&&s&&a>.05&&this.forwardBufferLength>1){var d=Math.min(2,Math.max(1,e)),g=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;E.playbackRate=Math.min(d,Math.max(1,g))}else E.playbackRate!==1&&E.playbackRate!==0&&(E.playbackRate=1)}}}}},u.estimateLiveEdge=function(){var E=this.levelDetails;return E===null?null:E.edge+E.age},u.computeLatency=function(){var E=this.estimateLiveEdge();return E===null?null:E-this.currentTime},R(A,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var E=this.config,p=this.levelDetails;return E.liveMaxLatencyDuration!==void 0?E.liveMaxLatencyDuration:p?E.liveMaxLatencyDurationCount*p.targetduration:0}},{key:"targetLatency",get:function(){var E=this.levelDetails;if(E===null)return null;var p=E.holdBack,T=E.partHoldBack,_=E.targetduration,n=this.config,e=n.liveSyncDuration,t=n.liveSyncDurationCount,a=n.lowLatencyMode,f=this.hls.userConfig,s=a&&T||p;(f.liveSyncDuration||f.liveSyncDurationCount||s===0)&&(s=e!==void 0?e:t*_);var d=_,g=1;return s+Math.min(this.stallCount*g,d)}},{key:"liveSyncPosition",get:function(){var E=this.estimateLiveEdge(),p=this.targetLatency,T=this.levelDetails;if(E===null||p===null||T===null)return null;var _=T.edge,n=E-p-this.edgeStalled,e=_-T.totalduration,t=_-(this.config.lowLatencyMode&&T.partTarget||T.targetduration);return Math.min(Math.max(e,n),t)}},{key:"drift",get:function(){var E=this.levelDetails;return E===null?1:E.drift}},{key:"edgeStalled",get:function(){var E=this.levelDetails;if(E===null)return 0;var p=(this.config.lowLatencyMode&&E.partTarget||E.targetduration)*3;return Math.max(E.age-p,0)}},{key:"forwardBufferLength",get:function(){var E=this.media,p=this.levelDetails;if(!E||!p)return 0;var T=E.buffered.length;return T?E.buffered.end(T-1):p.edge-this.currentTime}}]),A}()},"./src/controller/level-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return n});var I=m("./src/types/level.ts"),L=m("./src/events.ts"),D=m("./src/errors.ts"),M=m("./src/utils/codecs.ts"),R=m("./src/controller/level-helper.ts"),O=m("./src/controller/base-playlist-controller.ts"),A=m("./src/types/loader.ts");function u(){return u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var f in a)Object.prototype.hasOwnProperty.call(a,f)&&(e[f]=a[f])}return e},u.apply(this,arguments)}function y(e,t){for(var a=0;a<t.length;a++){var f=t[a];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(e,f.key,f)}}function E(e,t,a){return t&&y(e.prototype,t),a&&y(e,a),e}function p(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,T(e,t)}function T(e,t){return T=Object.setPrototypeOf||function(f,s){return f.__proto__=s,f},T(e,t)}var _=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(e){p(t,e);function t(f){var s;return s=e.call(this,f,"[level-controller]")||this,s._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}var a=t.prototype;return a._registerListeners=function(){var s=this.hls;s.on(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(L.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(L.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var s=this.hls;s.off(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(L.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(L.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},a.startLoad=function(){var s=this._levels;s.forEach(function(d){d.loadError=0}),e.prototype.startLoad.call(this)},a.onManifestLoaded=function(s,d){var g=[],v=[],l=[],o,r={},i,h=!1,c=!1,S=!1;if(d.levels.forEach(function(B){var F=B.attrs;h=h||!!(B.width&&B.height),c=c||!!B.videoCodec,S=S||!!B.audioCodec,_&&B.audioCodec&&B.audioCodec.indexOf("mp4a.40.34")!==-1&&(B.audioCodec=void 0);var U=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;i=r[U],i?i.url.push(B.url):(i=new I.Level(B),r[U]=i,g.push(i)),F&&(F.AUDIO&&Object(R.addGroupId)(i,"audio",F.AUDIO),F.SUBTITLES&&Object(R.addGroupId)(i,"text",F.SUBTITLES))}),(h||c)&&S&&(g=g.filter(function(B){var F=B.videoCodec,U=B.width,w=B.height;return!!F||!!(U&&w)})),g=g.filter(function(B){var F=B.audioCodec,U=B.videoCodec;return(!F||Object(M.isCodecSupportedInMp4)(F,"audio"))&&(!U||Object(M.isCodecSupportedInMp4)(U,"video"))}),d.audioTracks&&(v=d.audioTracks.filter(function(B){return!B.audioCodec||Object(M.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(R.assignTrackIdsByGroup)(v)),d.subtitles&&(l=d.subtitles,Object(R.assignTrackIdsByGroup)(l)),g.length>0){o=g[0].bitrate,g.sort(function(B,F){return B.bitrate-F.bitrate}),this._levels=g;for(var P=0;P<g.length;P++)if(g[P].bitrate===o){this._firstLevel=P,this.log("manifest loaded, "+g.length+" level(s) found, first bitrate: "+o);break}var C=S&&!c,x={levels:g,audioTracks:v,subtitleTracks:l,firstLevel:this._firstLevel,stats:d.stats,audio:S,video:c,altAudio:!C&&v.some(function(B){return!!B.url})};this.hls.trigger(L.Events.MANIFEST_PARSED,x),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(L.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:d.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(s,d){if(e.prototype.onError.call(this,s,d),!d.fatal){var g=d.context,v=this._levels[this.currentLevelIndex];if(g&&(g.type===A.PlaylistContextType.AUDIO_TRACK&&v.audioGroupIds&&g.groupId===v.audioGroupIds[v.urlId]||g.type===A.PlaylistContextType.SUBTITLE_TRACK&&v.textGroupIds&&g.groupId===v.textGroupIds[v.urlId])){this.redundantFailover(this.currentLevelIndex);return}var l=!1,o=!0,r;switch(d.details){case D.ErrorDetails.FRAG_LOAD_ERROR:case D.ErrorDetails.FRAG_LOAD_TIMEOUT:case D.ErrorDetails.KEY_LOAD_ERROR:case D.ErrorDetails.KEY_LOAD_TIMEOUT:if(d.frag){var i=this._levels[d.frag.level];i?(i.fragmentError++,i.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=d.frag.level)):r=d.frag.level}break;case D.ErrorDetails.LEVEL_LOAD_ERROR:case D.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(o=!1),r=g.level),l=!0;break;case D.ErrorDetails.REMUX_ALLOC_ERROR:r=d.level,l=!0;break}r!==void 0&&this.recoverLevel(d,r,l,o)}},a.recoverLevel=function(s,d,g,v){var l=s.details,o=this._levels[d];if(o.loadError++,g){var r=this.retryLoadingOrFail(s);if(r)s.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(v){var i=o.url.length;if(i>1&&o.loadError<i)s.levelRetry=!0,this.redundantFailover(d);else if(this.manualLevelIndex===-1){var h=d===0?this._levels.length-1:d-1;this.currentLevelIndex!==h&&this._levels[h].loadError===0&&(this.warn(l+": switch to "+h),s.levelRetry=!0,this.hls.nextAutoLevel=h)}}},a.redundantFailover=function(s){var d=this._levels[s],g=d.url.length;if(g>1){var v=(d.urlId+1)%g;this.warn("Switching to redundant URL-id "+v),this._levels.forEach(function(l){l.urlId=v}),this.level=s}},a.onFragLoaded=function(s,d){var g=d.frag;if(g!==void 0&&g.type===A.PlaylistLevelType.MAIN){var v=this._levels[g.level];v!==void 0&&(v.fragmentError=0,v.loadError=0)}},a.onLevelLoaded=function(s,d){var g,v=d.level,l=d.details,o=this._levels[v];if(!o){var r;this.warn("Invalid level index "+v),(r=d.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(l.deltaUpdateFailed=!0);return}v===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0,this.retryCount=0),this.playlistLoaded(v,d,o.details)):(g=d.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(l.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(s,d){var g=this.hls.levels[this.currentLevelIndex];if(!!g&&g.audioGroupIds){for(var v=-1,l=this.hls.audioTracks[d.id].groupId,o=0;o<g.audioGroupIds.length;o++)if(g.audioGroupIds[o]===l){v=o;break}v!==g.urlId&&(g.urlId=v,this.startLoad())}},a.loadPlaylist=function(s){var d=this.currentLevelIndex,g=this._levels[d];if(this.canLoad&&g&&g.url.length>0){var v=g.urlId,l=g.url[v];if(s)try{l=s.addDirectives(l)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Attempt loading level index "+d+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+v+" "+l),this.clearTimer(),this.hls.trigger(L.Events.LEVEL_LOADING,{url:l,level:d,id:v,deliveryDirectives:s||null})}},a.removeLevel=function(s,d){var g=function(o,r){return r!==d},v=this._levels.filter(function(l,o){return o!==s?!0:l.url.length>1&&d!==void 0?(l.url=l.url.filter(g),l.audioGroupIds&&(l.audioGroupIds=l.audioGroupIds.filter(g)),l.textGroupIds&&(l.textGroupIds=l.textGroupIds.filter(g)),l.urlId=0,!0):!1}).map(function(l,o){var r=l.details;return r!=null&&r.fragments&&r.fragments.forEach(function(i){i.level=o}),l});this._levels=v,this.hls.trigger(L.Events.LEVELS_UPDATED,{levels:v})},E(t,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var d,g=this._levels;if(g.length!==0&&!(this.currentLevelIndex===s&&(d=g[s])!==null&&d!==void 0&&d.details)){if(s<0||s>=g.length){var v=s<0;if(this.hls.trigger(L.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:v,reason:"invalid level idx"}),v)return;s=Math.min(s,g.length-1)}this.clearTimer();var l=this.currentLevelIndex,o=g[l],r=g[s];this.log("switching to level "+s+" from "+l),this.currentLevelIndex=s;var i=u({},r,{level:s,maxBitrate:r.maxBitrate,uri:r.uri,urlId:r.urlId});delete i._urlId,this.hls.trigger(L.Events.LEVEL_SWITCHING,i);var h=r.details;if(!h||h.live){var c=this.switchParams(r.uri,o==null?void 0:o.details);this.loadPlaylist(c)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}else return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),t}(O.default)},"./src/controller/level-helper.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"addGroupId",function(){return D}),m.d(b,"assignTrackIdsByGroup",function(){return M}),m.d(b,"updatePTS",function(){return R}),m.d(b,"updateFragPTSDTS",function(){return A}),m.d(b,"mergeDetails",function(){return u}),m.d(b,"mapPartIntersection",function(){return y}),m.d(b,"mapFragmentIntersection",function(){return E}),m.d(b,"adjustSliding",function(){return p}),m.d(b,"addSliding",function(){return T}),m.d(b,"computeReloadInterval",function(){return _}),m.d(b,"getFragmentWithSN",function(){return n}),m.d(b,"getPartWith",function(){return e});var I=m("./src/polyfills/number.ts"),L=m("./src/utils/logger.ts");function D(t,a,f){switch(a){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(f);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(f);break}}function M(t){var a={};t.forEach(function(f){var s=f.groupId||"";f.id=a[s]=a[s]||0,a[s]++})}function R(t,a,f){var s=t[a],d=t[f];O(s,d)}function O(t,a){var f=a.startPTS;if(Object(I.isFiniteNumber)(f)){var s=0,d;a.sn>t.sn?(s=f-t.start,d=t):(s=t.start-f,d=a),d.duration!==s&&(d.duration=s)}else if(a.sn>t.sn){var g=t.cc===a.cc;g&&t.minEndPTS?a.start=t.start+(t.minEndPTS-t.start):a.start=t.start+t.duration}else a.start=Math.max(t.start-a.duration,0)}function A(t,a,f,s,d,g){var v=s-f;v<=0&&(L.logger.warn("Fragment should have a positive duration",a),s=f+a.duration,g=d+a.duration);var l=f,o=s,r=a.startPTS,i=a.endPTS;if(Object(I.isFiniteNumber)(r)){var h=Math.abs(r-f);Object(I.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(h,a.deltaPTS):a.deltaPTS=h,l=Math.max(f,r),f=Math.min(f,r),d=Math.min(d,a.startDTS),o=Math.min(s,i),s=Math.max(s,i),g=Math.max(g,a.endDTS)}a.duration=s-f;var c=f-a.start;a.appendedPTS=s,a.start=a.startPTS=f,a.maxStartPTS=l,a.startDTS=d,a.endPTS=s,a.minEndPTS=o,a.endDTS=g;var S=a.sn;if(!t||S<t.startSN||S>t.endSN)return 0;var P,C=S-t.startSN,x=t.fragments;for(x[C]=a,P=C;P>0;P--)O(x[P],x[P-1]);for(P=C;P<x.length-1;P++)O(x[P],x[P+1]);return t.fragmentHint&&O(x[x.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,c}function u(t,a){for(var f=null,s=t.fragments,d=s.length-1;d>=0;d--){var g=s[d].initSegment;if(g){f=g;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var v=0,l;if(E(t,a,function(S,P){var C;S.relurl&&(v=S.cc-P.cc),Object(I.isFiniteNumber)(S.startPTS)&&Object(I.isFiniteNumber)(S.endPTS)&&(P.start=P.startPTS=S.startPTS,P.startDTS=S.startDTS,P.appendedPTS=S.appendedPTS,P.maxStartPTS=S.maxStartPTS,P.endPTS=S.endPTS,P.endDTS=S.endDTS,P.minEndPTS=S.minEndPTS,P.duration=S.endPTS-S.startPTS,P.duration&&(l=P),a.PTSKnown=a.alignedSliding=!0),P.elementaryStreams=S.elementaryStreams,P.loader=S.loader,P.stats=S.stats,P.urlId=S.urlId,S.initSegment?(P.initSegment=S.initSegment,f=S.initSegment):(!P.initSegment||P.initSegment.relurl==((C=f)===null||C===void 0?void 0:C.relurl))&&(P.initSegment=f)}),a.skippedSegments&&(a.deltaUpdateFailed=a.fragments.some(function(S){return!S}),a.deltaUpdateFailed)){L.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var o=a.skippedSegments;o--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}var r=a.fragments;if(v){L.logger.warn("discontinuity sliding from playlist, take drift into account");for(var i=0;i<r.length;i++)r[i].cc+=v}a.skippedSegments&&(a.startCC=a.fragments[0].cc),y(t.partList,a.partList,function(S,P){P.elementaryStreams=S.elementaryStreams,P.stats=S.stats}),l?A(a,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):p(t,a),r.length&&(a.totalduration=a.edge-r[0].start),a.driftStartTime=t.driftStartTime,a.driftStart=t.driftStart;var h=a.advancedDateTime;if(a.advanced&&h){var c=a.edge;a.driftStart||(a.driftStartTime=h,a.driftStart=c),a.driftEndTime=h,a.driftEnd=c}else a.driftEndTime=t.driftEndTime,a.driftEnd=t.driftEnd,a.advancedDateTime=t.advancedDateTime}function y(t,a,f){if(t&&a)for(var s=0,d=0,g=t.length;d<=g;d++){var v=t[d],l=a[d+s];v&&l&&v.index===l.index&&v.fragment.sn===l.fragment.sn?f(v,l):s--}}function E(t,a,f){for(var s=a.skippedSegments,d=Math.max(t.startSN,a.startSN)-a.startSN,g=(t.fragmentHint?1:0)+(s?a.endSN:Math.min(t.endSN,a.endSN))-a.startSN,v=a.startSN-t.startSN,l=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,r=d;r<=g;r++){var i=o[v+r],h=l[r];s&&!h&&r<s&&(h=a.fragments[r]=i),i&&h&&f(i,h)}}function p(t,a){var f=a.startSN+a.skippedSegments-t.startSN,s=t.fragments;f<0||f>=s.length||T(a,s[f].start)}function T(t,a){if(a){for(var f=t.fragments,s=t.skippedSegments;s<f.length;s++)f[s].start+=a;t.fragmentHint&&(t.fragmentHint.start+=a)}}function _(t,a){var f=1e3*t.levelTargetDuration,s=f/2,d=t.age,g=d>0&&d<f*3,v=a.loading.end-a.loading.start,l,o=t.availabilityDelay;if(t.updated===!1)if(g){var r=333*t.misses;l=Math.max(Math.min(s,v*2),r),t.availabilityDelay=(t.availabilityDelay||0)+l}else l=s;else g?(o=Math.min(o||f/2,d),t.availabilityDelay=o,l=o+f-d):l=f-v;return Math.round(l)}function n(t,a,f){if(!t||!t.details)return null;var s=t.details,d=s.fragments[a-s.startSN];return d||(d=s.fragmentHint,d&&d.sn===a)?d:a<s.startSN&&f&&f.sn===a?f:null}function e(t,a,f){if(!t||!t.details)return null;var s=t.details.partList;if(s)for(var d=s.length;d--;){var g=s[d];if(g.index===f&&g.fragment.sn===a)return g}return null}},"./src/controller/stream-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return s});var I=m("./src/polyfills/number.ts"),L=m("./src/controller/base-stream-controller.ts"),D=m("./src/is-supported.ts"),M=m("./src/events.ts"),R=m("./src/utils/buffer-helper.ts"),O=m("./src/controller/fragment-tracker.ts"),A=m("./src/types/loader.ts"),u=m("./src/loader/fragment.ts"),y=m("./src/demux/transmuxer-interface.ts"),E=m("./src/types/transmuxer.ts"),p=m("./src/controller/gap-controller.ts"),T=m("./src/errors.ts"),_=m("./src/utils/logger.ts");function n(d,g){for(var v=0;v<g.length;v++){var l=g[v];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,l.key,l)}}function e(d,g,v){return g&&n(d.prototype,g),v&&n(d,v),d}function t(d,g){d.prototype=Object.create(g.prototype),d.prototype.constructor=d,a(d,g)}function a(d,g){return a=Object.setPrototypeOf||function(l,o){return l.__proto__=o,l},a(d,g)}var f=100,s=function(d){t(g,d);function g(l,o){var r;return r=d.call(this,l,o,"[stream-controller]")||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.stalled=!1,r.couldBacktrack=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}var v=g.prototype;return v._registerListeners=function(){var o=this.hls;o.on(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(M.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(M.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.on(M.Events.ERROR,this.onError,this),o.on(M.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.on(M.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(M.Events.BUFFER_CREATED,this.onBufferCreated,this),o.on(M.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.on(M.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.on(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v._unregisterListeners=function(){var o=this.hls;o.off(M.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(M.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(M.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(M.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(M.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(M.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.off(M.Events.ERROR,this.onError,this),o.off(M.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.off(M.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(M.Events.BUFFER_CREATED,this.onBufferCreated,this),o.off(M.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.off(M.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.off(M.Events.FRAG_BUFFERED,this.onFragBuffered,this)},v.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},v.startLoad=function(o){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(f),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=i.startLevel;h===-1&&(i.config.testBandwidth?(h=0,this.bitrateTest=!0):h=i.nextAutoLevel),this.level=i.nextLoadLevel=h,this.loadedmetadata=!1}r>0&&o===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),o=r),this.state=L.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=o,this.tick()}else this._forceStartLoad=!0,this.state=L.State.STOPPED},v.stopLoad=function(){this._forceStartLoad=!1,d.prototype.stopLoad.call(this)},v.doTick=function(){switch(this.state){case L.State.IDLE:this.doTickIdle();break;case L.State.WAITING_LEVEL:{var o,r=this.levels,i=this.level,h=r==null||(o=r[i])===null||o===void 0?void 0:o.details;if(h&&(!h.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(h))break;this.state=L.State.IDLE;break}break}case L.State.FRAG_LOADING_WAITING_RETRY:{var c,S=self.performance.now(),P=this.retryDate;(!P||S>=P||(c=this.media)!==null&&c!==void 0&&c.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=L.State.IDLE)}break;default:break}this.onTickEnd()},v.onTickEnd=function(){d.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},v.doTickIdle=function(){var o,r,i=this.hls,h=this.levelLastLoaded,c=this.levels,S=this.media,P=i.config,C=i.nextLoadLevel;if(!(h===null||!S&&(this.startFragRequested||!P.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!c||!c[C])){var x=c[C];this.level=i.nextLoadLevel=C;var B=x.details;if(!B||this.state===L.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==C){this.state=L.State.WAITING_LEVEL;return}var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:S,A.PlaylistLevelType.MAIN);if(F!==null){var U=F.len,w=this.getMaxBufferLength(x.maxBitrate);if(!(U>=w)){if(this._streamEnded(F,B)){var k={};this.altAudio&&(k.type="video"),this.hls.trigger(M.Events.BUFFER_EOS,k),this.state=L.State.ENDED;return}var K=F.end,N=this.getNextFragment(K,B);if(this.couldBacktrack&&!this.fragPrevious&&N&&N.sn!=="initSegment"){var G=N.sn-B.startSN;G>1&&(N=B.fragments[G-1],this.fragmentTracker.removeFragment(N))}if(N&&this.fragmentTracker.getState(N)===O.FragmentState.OK&&this.nextLoadPosition>K){var H=this.audioOnly&&!this.altAudio?u.ElementaryStreamTypes.AUDIO:u.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(S,H,A.PlaylistLevelType.MAIN),N=this.getNextFragment(this.nextLoadPosition,B)}!N||(N.initSegment&&!N.initSegment.data&&!this.bitrateTest&&(N=N.initSegment),((o=N.decryptdata)===null||o===void 0?void 0:o.keyFormat)==="identity"&&!((r=N.decryptdata)!==null&&r!==void 0&&r.key)?this.loadKey(N,B):this.loadFragment(N,B,K))}}}},v.loadFragment=function(o,r,i){var h,c=this.fragmentTracker.getState(o);if(this.fragCurrent=o,c===O.FragmentState.BACKTRACKED){var S=this.fragmentTracker.getBacktrackData(o);if(S){this._handleFragmentLoadProgress(S),this._handleFragmentLoadComplete(S);return}else c=O.FragmentState.NOT_LOADED}c===O.FragmentState.NOT_LOADED||c===O.FragmentState.PARTIAL?o.sn==="initSegment"?this._loadInitSegment(o):this.bitrateTest?(o.bitrateTest=!0,this.log("Fragment "+o.sn+" of level "+o.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(o)):(this.startFragRequested=!0,d.prototype.loadFragment.call(this,o,r,i)):c===O.FragmentState.APPENDING?this.reduceMaxBufferLength(o.duration)&&this.fragmentTracker.removeFragment(o):((h=this.media)===null||h===void 0?void 0:h.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},v.getAppendedFrag=function(o){var r=this.fragmentTracker.getAppendedFrag(o,A.PlaylistLevelType.MAIN);return r&&"fragment"in r?r.fragment:r},v.getBufferedFrag=function(o){return this.fragmentTracker.getBufferedFrag(o,A.PlaylistLevelType.MAIN)},v.followingBufferedFrag=function(o){return o?this.getBufferedFrag(o.end+.5):null},v.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},v.nextLevelSwitch=function(){var o=this.levels,r=this.media;if(r!=null&&r.readyState){var i,h=this.getAppendedFrag(r.currentTime);if(h&&h.start>1&&this.flushMainBuffer(0,h.start-1),!r.paused&&o){var c=this.hls.nextLoadLevel,S=o[c],P=this.fragLastKbps;P&&this.fragCurrent?i=this.fragCurrent.duration*S.maxBitrate/(1e3*P)+1:i=0}else i=0;var C=this.getBufferedFrag(r.currentTime+i);if(C){var x=this.followingBufferedFrag(C);if(x){this.abortCurrentFrag();var B=x.maxStartPTS?x.maxStartPTS:x.start,F=x.duration,U=Math.max(C.end,B+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(U,Number.POSITIVE_INFINITY)}}}},v.abortCurrentFrag=function(){var o=this.fragCurrent;this.fragCurrent=null,o!=null&&o.loader&&o.loader.abort(),this.state===L.State.KEY_LOADING&&(this.state=L.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},v.flushMainBuffer=function(o,r){d.prototype.flushMainBuffer.call(this,o,r,this.altAudio?"video":null)},v.onMediaAttached=function(o,r){d.prototype.onMediaAttached.call(this,o,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new p.default(this.config,i,this.fragmentTracker,this.hls)},v.onMediaDetaching=function(){var o=this.media;o&&(o.removeEventListener("playing",this.onvplaying),o.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),d.prototype.onMediaDetaching.call(this)},v.onMediaPlaying=function(){this.tick()},v.onMediaSeeked=function(){var o=this.media,r=o?o.currentTime:null;Object(I.isFiniteNumber)(r)&&this.log("Media seeked to "+r.toFixed(3)),this.tick()},v.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(M.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},v.onManifestParsed=function(o,r){var i=!1,h=!1,c;r.levels.forEach(function(S){c=S.audioCodec,c&&(c.indexOf("mp4a.40.2")!==-1&&(i=!0),c.indexOf("mp4a.40.5")!==-1&&(h=!0))}),this.audioCodecSwitch=i&&h&&!Object(D.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},v.onLevelLoading=function(o,r){var i=this.levels;if(!(!i||this.state!==L.State.IDLE)){var h=i[r.level];(!h.details||h.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(h.details))&&(this.state=L.State.WAITING_LEVEL)}},v.onLevelLoaded=function(o,r){var i,h=this.levels,c=r.level,S=r.details,P=S.totalduration;if(!h){this.warn("Levels were reset while loading level "+c);return}this.log("Level "+c+" loaded ["+S.startSN+","+S.endSN+"], cc ["+S.startCC+", "+S.endCC+"] duration:"+P);var C=this.fragCurrent;C&&(this.state===L.State.FRAG_LOADING||this.state===L.State.FRAG_LOADING_WAITING_RETRY)&&C.level!==r.level&&C.loader&&(this.state=L.State.IDLE,C.loader.abort());var x=h[c],B=0;if(S.live||(i=x.details)!==null&&i!==void 0&&i.live){if(S.fragments[0]||(S.deltaUpdateFailed=!0),S.deltaUpdateFailed)return;B=this.alignPlaylists(S,x.details)}if(x.details=S,this.levelLastLoaded=c,this.hls.trigger(M.Events.LEVEL_UPDATED,{details:S,level:c}),this.state===L.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(S))return;this.state=L.State.IDLE}this.startFragRequested?S.live&&this.synchronizeToLiveEdge(S):this.setStartPosition(S,B),this.tick()},v._handleFragmentLoadProgress=function(o){var r,i=o.frag,h=o.part,c=o.payload,S=this.levels;if(!S){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var P=S[i.level],C=P.details;if(!C){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset");return}var x=P.videoCodec,B=C.PTSKnown||!C.live,F=(r=i.initSegment)===null||r===void 0?void 0:r.data,U=this._getAudioCodec(P),w=this.transmuxer=this.transmuxer||new y.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),k=h?h.index:-1,K=k!==-1,N=new E.ChunkMetadata(i.level,i.sn,i.stats.chunkCount,c.byteLength,k,K),G=this.initPTS[i.cc];w.push(c,F,U,x,i,h,C.totalduration,B,N,G)},v.onAudioTrackSwitching=function(o,r){var i=this.altAudio,h=!!r.url,c=r.id;if(!h){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var S=this.fragCurrent;S!=null&&S.loader&&(this.log("Switching to main audio track, cancel main fragment load"),S.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var P=this.hls;i&&P.trigger(M.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),P.trigger(M.Events.AUDIO_TRACK_SWITCHED,{id:c})}},v.onAudioTrackSwitched=function(o,r){var i=r.id,h=!!this.hls.audioTracks[i].url;if(h){var c=this.videoBuffer;c&&this.mediaBuffer!==c&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=c)}this.altAudio=h,this.tick()},v.onBufferCreated=function(o,r){var i=r.tracks,h,c,S=!1;for(var P in i){var C=i[P];if(C.id==="main"){if(c=P,h=C,P==="video"){var x=i[P];x&&(this.videoBuffer=x.buffer)}}else S=!0}S&&h?(this.log("Alternate track found, use "+c+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},v.onFragBuffered=function(o,r){var i=r.frag,h=r.part;if(!(i&&i.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(h?" p: "+h.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),this.state===L.State.PARSED&&(this.state=L.State.IDLE);return}var c=h?h.stats:i.stats;this.fragLastKbps=Math.round(8*c.total/(c.buffering.end-c.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,h)}},v.onError=function(o,r){switch(r.details){case T.ErrorDetails.FRAG_LOAD_ERROR:case T.ErrorDetails.FRAG_LOAD_TIMEOUT:case T.ErrorDetails.KEY_LOAD_ERROR:case T.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,r);break;case T.ErrorDetails.LEVEL_LOAD_ERROR:case T.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==L.State.ERROR&&(r.fatal?(this.warn(""+r.details),this.state=L.State.ERROR):!r.levelRetry&&this.state===L.State.WAITING_LEVEL&&(this.state=L.State.IDLE));break;case T.ErrorDetails.BUFFER_FULL_ERROR:if(r.parent==="main"&&(this.state===L.State.PARSING||this.state===L.State.PARSED)){var i=!0,h=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);h&&h.len>.5&&(i=!this.reduceMaxBufferLength(h.len)),i&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},v.checkBuffer=function(){var o=this.media,r=this.gapController;if(!(!o||!r||!o.readyState)){var i=R.BufferHelper.getBuffered(o);!this.loadedmetadata&&i.length?(this.loadedmetadata=!0,this.seekToStartPos()):r.poll(this.lastCurrentTime),this.lastCurrentTime=o.currentTime}},v.onFragLoadEmergencyAborted=function(){this.state=L.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},v.onBufferFlushed=function(o,r){var i=r.type;if(i!==u.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var h=(i===u.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(h,i,A.PlaylistLevelType.MAIN)}},v.onLevelsUpdated=function(o,r){this.levels=r.levels},v.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},v.seekToStartPos=function(){var o=this.media,r=o.currentTime,i=this.startPosition;if(i>=0&&r<i){if(o.seeking){_.logger.log("could not seek to "+i+", already seeking at "+r);return}var h=R.BufferHelper.getBuffered(o),c=h.length?h.start(0):0,S=c-i;S>0&&(S<this.config.maxBufferHole||S<this.config.maxFragLookUpTolerance)&&(_.logger.log("adjusting start position by "+S+" to match buffer start"),i+=S,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),o.currentTime=i}},v._getAudioCodec=function(o){var r=this.config.defaultAudioCodec||o.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r.indexOf("mp4a.40.5")!==-1?r="mp4a.40.2":r="mp4a.40.5"),r},v._loadBitrateTestFrag=function(o){var r=this;this._doFragLoad(o).then(function(i){var h=r.hls;if(!(!i||h.nextLoadLevel||r.fragContextChanged(o))){r.fragLoadError=0,r.state=L.State.IDLE,r.startFragRequested=!1,r.bitrateTest=!1;var c=o.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),h.trigger(M.Events.FRAG_LOADED,i)}})},v._handleTransmuxComplete=function(o){var r,i="main",h=this.hls,c=o.remuxResult,S=o.chunkMeta,P=this.getCurrentContext(S);if(!P){this.warn("The loading context changed while buffering fragment "+S.sn+" of level "+S.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(S.level);return}var C=P.frag,x=P.part,B=P.level,F=c.video,U=c.text,w=c.id3,k=c.initSegment,K=this.altAudio?void 0:c.audio;if(!this.fragContextChanged(C)){if(this.state=L.State.PARSING,k){k.tracks&&(this._bufferInitSegment(B,k.tracks,C,S),h.trigger(M.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:i,tracks:k.tracks}));var N=k.initPTS,G=k.timescale;Object(I.isFiniteNumber)(N)&&(this.initPTS[C.cc]=N,h.trigger(M.Events.INIT_PTS_FOUND,{frag:C,id:i,initPTS:N,timescale:G}))}if(F&&c.independent!==!1){if(B.details){var H=F.startPTS,V=F.endPTS,z=F.startDTS,Q=F.endDTS;if(x)x.elementaryStreams[F.type]={startPTS:H,endPTS:V,startDTS:z,endDTS:Q};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var q=this.getLoadPosition()+this.config.maxBufferHole;if(q<H){this.backtrack(C);return}C.setElementaryStreamInfo(F.type,C.start,V,C.start,Q,!0)}C.setElementaryStreamInfo(F.type,H,V,z,Q),this.bufferFragmentData(F,C,x,S)}}else if(c.independent===!1){this.backtrack(C);return}if(K){var J=K.startPTS,te=K.endPTS,ue=K.startDTS,$=K.endDTS;x&&(x.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:J,endPTS:te,startDTS:ue,endDTS:$}),C.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,J,te,ue,$),this.bufferFragmentData(K,C,x,S)}if(w!=null&&(r=w.samples)!==null&&r!==void 0&&r.length){var Z={frag:C,id:i,samples:w.samples};h.trigger(M.Events.FRAG_PARSING_METADATA,Z)}if(U){var Y={frag:C,id:i,samples:U.samples};h.trigger(M.Events.FRAG_PARSING_USERDATA,Y)}}},v._bufferInitSegment=function(o,r,i,h){var c=this;if(this.state===L.State.PARSING){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var S=r.audio,P=r.video,C=r.audiovideo;if(S){var x=o.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(x&&(x.indexOf("mp4a.40.5")!==-1?x="mp4a.40.2":x="mp4a.40.5"),S.metadata.channelCount!==1&&B.indexOf("firefox")===-1&&(x="mp4a.40.5")),B.indexOf("android")!==-1&&S.container!=="audio/mpeg"&&(x="mp4a.40.2",this.log("Android: force audio codec to "+x)),o.audioCodec&&o.audioCodec!==x&&this.log('Swapping manifest audio codec "'+o.audioCodec+'" for "'+x+'"'),S.levelCodec=x,S.id="main",this.log("Init audio buffer, container:"+S.container+", codecs[selected/level/parsed]=["+(x||"")+"/"+(o.audioCodec||"")+"/"+S.codec+"]")}P&&(P.levelCodec=o.videoCodec,P.id="main",this.log("Init video buffer, container:"+P.container+", codecs[level/parsed]=["+(o.videoCodec||"")+"/"+P.codec+"]")),C&&this.log("Init audiovideo buffer, container:"+C.container+", codecs[level/parsed]=["+(o.attrs.CODECS||"")+"/"+C.codec+"]"),this.hls.trigger(M.Events.BUFFER_CODECS,r),Object.keys(r).forEach(function(F){var U=r[F],w=U.initSegment;w!=null&&w.byteLength&&c.hls.trigger(M.Events.BUFFER_APPENDING,{type:F,data:w,frag:i,part:null,chunkMeta:h,parent:i.type})}),this.tick()}},v.backtrack=function(o){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(o);var r=this.fragmentTracker.backtrack(o);this.fragPrevious=null,this.nextLoadPosition=o.start,r?this.resetFragmentLoading(o):this.state=L.State.BACKTRACKING},v.checkFragmentChanged=function(){var o=this.media,r=null;if(o&&o.readyState>1&&o.seeking===!1){var i=o.currentTime;if(R.BufferHelper.isBuffered(o,i)?r=this.getAppendedFrag(i):R.BufferHelper.isBuffered(o,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){var h=this.fragPlaying,c=r.level;(!h||r.sn!==h.sn||h.level!==c||r.urlId!==h.urlId)&&(this.hls.trigger(M.Events.FRAG_CHANGED,{frag:r}),(!h||h.level!==c)&&this.hls.trigger(M.Events.LEVEL_SWITCHED,{level:c}),this.fragPlaying=r)}}},e(g,[{key:"nextLevel",get:function(){var o=this.nextBufferedFrag;return o?o.level:-1}},{key:"currentLevel",get:function(){var o=this.media;if(o){var r=this.getAppendedFrag(o.currentTime);if(r)return r.level}return-1}},{key:"nextBufferedFrag",get:function(){var o=this.media;if(o){var r=this.getAppendedFrag(o.currentTime);return this.followingBufferedFrag(r)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),g}(L.default)},"./src/controller/subtitle-stream-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"SubtitleStreamController",function(){return t});var I=m("./src/events.ts"),L=m("./src/utils/logger.ts"),D=m("./src/utils/buffer-helper.ts"),M=m("./src/controller/fragment-finders.ts"),R=m("./src/utils/discontinuities.ts"),O=m("./src/controller/level-helper.ts"),A=m("./src/controller/fragment-tracker.ts"),u=m("./src/controller/base-stream-controller.ts"),y=m("./src/types/loader.ts"),E=m("./src/types/level.ts");function p(a,f){for(var s=0;s<f.length;s++){var d=f[s];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}function T(a,f,s){return f&&p(a.prototype,f),s&&p(a,s),a}function _(a,f){a.prototype=Object.create(f.prototype),a.prototype.constructor=a,n(a,f)}function n(a,f){return n=Object.setPrototypeOf||function(d,g){return d.__proto__=g,d},n(a,f)}var e=500,t=function(a){_(f,a);function f(d,g){var v;return v=a.call(this,d,g,"[subtitle-stream-controller]")||this,v.levels=[],v.currentTrackId=-1,v.tracksBuffered=[],v.mainDetails=null,v._registerListeners(),v}var s=f.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var g=this.hls;g.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(I.Events.ERROR,this.onError,this),g.on(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.on(I.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),g.on(I.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.on(I.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),g.on(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s._unregisterListeners=function(){var g=this.hls;g.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(I.Events.ERROR,this.onError,this),g.off(I.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.off(I.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),g.off(I.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.off(I.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),g.off(I.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},s.startLoad=function(){this.stopLoad(),this.state=u.State.IDLE,this.setInterval(e),this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},s.onLevelLoaded=function(g,v){this.mainDetails=v.details},s.onSubtitleFragProcessed=function(g,v){var l=v.frag,o=v.success;if(this.fragPrevious=l,this.state=u.State.IDLE,!!o){var r=this.tracksBuffered[this.currentTrackId];if(!!r){for(var i,h=l.start,c=0;c<r.length;c++)if(h>=r[c].start&&h<=r[c].end){i=r[c];break}var S=l.start+l.duration;i?i.end=S:(i={start:h,end:S},r.push(i)),this.fragmentTracker.fragBuffered(l)}}},s.onBufferFlushing=function(g,v){var l=v.startOffset,o=v.endOffset;if(l===0&&o!==Number.POSITIVE_INFINITY){var r=this.currentTrackId,i=this.levels;if(!i.length||!i[r]||!i[r].details)return;var h=i[r].details,c=h.targetduration,S=o-c;if(S<=0)return;v.endOffsetSubtitles=Math.max(0,S),this.tracksBuffered.forEach(function(P){for(var C=0;C<P.length;){if(P[C].end<=S){P.shift();continue}else if(P[C].start<S)P[C].start=S;else break;C++}}),this.fragmentTracker.removeFragmentsInRange(l,S,y.PlaylistLevelType.SUBTITLE)}},s.onError=function(g,v){var l,o=v.frag;!o||o.type!==y.PlaylistLevelType.SUBTITLE||((l=this.fragCurrent)!==null&&l!==void 0&&l.loader&&this.fragCurrent.loader.abort(),this.state=u.State.IDLE)},s.onSubtitleTracksUpdated=function(g,v){var l=this,o=v.subtitleTracks;this.tracksBuffered=[],this.levels=o.map(function(r){return new E.Level(r)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(r){l.tracksBuffered[r.id]=[]}),this.mediaBuffer=null},s.onSubtitleTrackSwitch=function(g,v){if(this.currentTrackId=v.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var l=this.levels[this.currentTrackId];l!=null&&l.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(e)):this.mediaBuffer=null},s.onSubtitleTrackLoaded=function(g,v){var l,o=v.details,r=v.id,i=this.currentTrackId,h=this.levels;if(!!h.length){var c=h[i];if(!(r>=h.length||r!==i||!c)){if(this.mediaBuffer=this.mediaBufferTimeRanges,o.live||(l=c.details)!==null&&l!==void 0&&l.live){var S=this.mainDetails;if(o.deltaUpdateFailed||!S)return;var P=S.fragments[0];if(!c.details)o.hasProgramDateTime&&S.hasProgramDateTime?Object(R.alignMediaPlaylistByPDT)(o,S):P&&Object(O.addSliding)(o,P.start);else{var C=this.alignPlaylists(o,c.details);C===0&&P&&Object(O.addSliding)(o,P.start)}}if(c.details=o,this.levelLastLoaded=r,this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===u.State.IDLE){var x=Object(M.findFragmentByPTS)(null,o.fragments,this.media.currentTime,0);x||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)}}}},s._handleFragmentLoadComplete=function(g){var v=g.frag,l=g.payload,o=v.decryptdata,r=this.hls;if(!this.fragContextChanged(v)&&l&&l.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var i=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(l),o.key.buffer,o.iv.buffer).then(function(h){var c=performance.now();r.trigger(I.Events.FRAG_DECRYPTED,{frag:v,payload:h,stats:{tstart:i,tdecrypt:c}})})}},s.doTick=function(){if(!this.media){this.state=u.State.IDLE;return}if(this.state===u.State.IDLE){var g,v=this.currentTrackId,l=this.levels;if(!l.length||!l[v]||!l[v].details)return;var o=l[v].details,r=o.targetduration,i=this.config,h=this.media,c=D.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,h.currentTime-r,i.maxBufferHole),S=c.end,P=c.len,C=this.getMaxBufferLength()+r;if(P>C)return;console.assert(o,"Subtitle track details are defined on idle subtitle stream controller tick");var x=o.fragments,B=x.length,F=o.edge,U,w=this.fragPrevious;if(S<F){var k=i.maxFragLookUpTolerance;w&&o.hasProgramDateTime&&(U=Object(M.findFragmentByPDT)(x,w.endProgramDateTime,k)),U||(U=Object(M.findFragmentByPTS)(w,x,S,k),!U&&w&&w.start<x[0].start&&(U=x[0]))}else U=x[B-1];(g=U)!==null&&g!==void 0&&g.encrypted?(L.logger.log("Loading key for "+U.sn),this.state=u.State.KEY_LOADING,this.hls.trigger(I.Events.KEY_LOADING,{frag:U})):U&&this.fragmentTracker.getState(U)===A.FragmentState.NOT_LOADED&&this.loadFragment(U,o,S)}},s.loadFragment=function(g,v,l){this.fragCurrent=g,a.prototype.loadFragment.call(this,g,v,l)},T(f,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),f}(u.default)},"./src/controller/subtitle-track-controller.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/events.ts"),L=m("./src/utils/texttrack-utils.ts"),D=m("./src/controller/base-playlist-controller.ts"),M=m("./src/types/loader.ts");function R(p,T){for(var _=0;_<T.length;_++){var n=T[_];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(p,n.key,n)}}function O(p,T,_){return T&&R(p.prototype,T),_&&R(p,_),p}function A(p,T){p.prototype=Object.create(T.prototype),p.prototype.constructor=p,u(p,T)}function u(p,T){return u=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n},u(p,T)}var y=function(p){A(T,p);function T(n){var e;return e=p.call(this,n,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}var _=T.prototype;return _.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,p.prototype.destroy.call(this)},_.registerListeners=function(){var e=this.hls;e.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(I.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(I.Events.ERROR,this.onError,this)},_.unregisterListeners=function(){var e=this.hls;e.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(I.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(I.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(I.Events.ERROR,this.onError,this)},_.onMediaAttached=function(e,t){this.media=t.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},_.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},_.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=E(this.media.textTracks);e.forEach(function(t){Object(L.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null}},_.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},_.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},_.onSubtitleTrackLoaded=function(e,t){var a=t.id,f=t.details,s=this.trackId,d=this.tracksInGroup[s];if(!d){this.warn("Invalid subtitle track id "+a);return}var g=d.details;d.details=t.details,this.log("subtitle track "+a+" loaded ["+f.startSN+"-"+f.endSN+"]"),a===this.trackId&&(this.retryCount=0,this.playlistLoaded(a,t,g))},_.onLevelLoading=function(e,t){this.switchLevel(t.level)},_.onLevelSwitching=function(e,t){this.switchLevel(t.level)},_.switchLevel=function(e){var t=this.hls.levels[e];if(!!(t!=null&&t.textGroupIds)){var a=t.textGroupIds[t.urlId];if(this.groupId!==a){var f=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(v){return!a||v.groupId===a});this.tracksInGroup=s;var d=this.findTrackId(f==null?void 0:f.name)||this.findTrackId();this.groupId=a;var g={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+a+'" group-id'),this.hls.trigger(I.Events.SUBTITLE_TRACKS_UPDATED,g),d!==-1&&this.setSubtitleTrack(d,f)}}},_.findTrackId=function(e){for(var t=this.tracksInGroup,a=0;a<t.length;a++){var f=t[a];if((!this.selectDefaultTrack||f.default)&&(!e||e===f.name))return f.id}return-1},_.onError=function(e,t){p.prototype.onError.call(this,e,t),!(t.fatal||!t.context)&&t.context.type===M.PlaylistContextType.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},_.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var a=t.id,f=t.groupId,s=t.url;if(e)try{s=e.addDirectives(s)}catch(d){this.warn("Could not construct new URL with HLS Delivery Directives: "+d)}this.log("Loading subtitle playlist for id "+a),this.hls.trigger(I.Events.SUBTITLE_TRACK_LOADING,{url:s,id:a,groupId:f,deliveryDirectives:e||null})}},_.toggleTrackModes=function(e){var t=this,a=this.media,f=this.subtitleDisplay,s=this.trackId;if(!!a){var d=E(a.textTracks),g=d.filter(function(o){return o.groupId===t.groupId});if(e===-1)[].slice.call(d).forEach(function(o){o.mode="disabled"});else{var v=g[s];v&&(v.mode="disabled")}var l=g[e];l&&(l.mode=f?"showing":"hidden")}},_.setSubtitleTrack=function(e,t){var a,f=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(a=f[e])!==null&&a!==void 0&&a.details)||e<-1||e>=f.length)){this.clearTimer();var s=f[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,s){var d=s.id,g=s.groupId,v=g===void 0?"":g,l=s.name,o=s.type,r=s.url;this.hls.trigger(I.Events.SUBTITLE_TRACK_SWITCH,{id:d,groupId:v,name:l,type:o,url:r});var i=this.switchParams(s.url,t==null?void 0:t.details);this.loadPlaylist(i)}else this.hls.trigger(I.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},_.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=E(this.media.textTracks),a=0;a<t.length;a++)if(t[a].mode==="hidden")e=a;else if(t[a].mode==="showing"){e=a;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},O(T,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}]),T}(D.default);function E(p){for(var T=[],_=0;_<p.length;_++){var n=p[_];n.kind==="subtitles"&&n.label&&T.push(p[_])}return T}b.default=y},"./src/controller/timeline-controller.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"TimelineController",function(){return E});var I=m("./src/polyfills/number.ts"),L=m("./src/events.ts"),D=m("./src/utils/cea-608-parser.ts"),M=m("./src/utils/output-filter.ts"),R=m("./src/utils/webvtt-parser.ts"),O=m("./src/utils/texttrack-utils.ts"),A=m("./src/utils/imsc1-ttml-parser.ts"),u=m("./src/types/loader.ts"),y=m("./src/utils/logger.ts"),E=function(){function n(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=_(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var a=new M.default(this,"textTrack1"),f=new M.default(this,"textTrack2"),s=new M.default(this,"textTrack3"),d=new M.default(this,"textTrack4");this.cea608Parser1=new D.default(1,a,f),this.cea608Parser2=new D.default(3,s,d)}t.on(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(L.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(L.Events.FRAG_LOADING,this.onFragLoading,this),t.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(L.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(L.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(L.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=n.prototype;return e.destroy=function(){var a=this.hls;a.off(L.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(L.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(L.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(L.Events.FRAG_LOADING,this.onFragLoading,this),a.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(L.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.off(L.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(L.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.off(L.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(a,f,s,d,g){for(var v=!1,l=g.length;l--;){var o=g[l],r=T(o[0],o[1],f,s);if(r>=0&&(o[0]=Math.min(o[0],f),o[1]=Math.max(o[1],s),v=!0,r/(s-f)>.5))return}if(v||g.push([f,s]),this.config.renderTextTracksNatively){var i=this.captionsTracks[a];this.Cues.newCue(i,f,s,d)}else{var h=this.Cues.newCue(null,f,s,d);this.hls.trigger(L.Events.CUES_PARSED,{type:"captions",cues:h,track:a})}},e.onInitPtsFound=function(a,f){var s=this,d=f.frag,g=f.id,v=f.initPTS,l=f.timescale,o=this.unparsedVttFrags;g==="main"&&(this.initPTS[d.cc]=v,this.timescale[d.cc]=l),o.length&&(this.unparsedVttFrags=[],o.forEach(function(r){s.onFragLoaded(L.Events.FRAG_LOADED,r)}))},e.getExistingTrack=function(a){var f=this.media;if(f)for(var s=0;s<f.textTracks.length;s++){var d=f.textTracks[s];if(d[a])return d}return null},e.createCaptionsTrack=function(a){this.config.renderTextTracksNatively?this.createNativeTrack(a):this.createNonNativeTrack(a)},e.createNativeTrack=function(a){if(!this.captionsTracks[a]){var f=this.captionsProperties,s=this.captionsTracks,d=this.media,g=f[a],v=g.label,l=g.languageCode,o=this.getExistingTrack(a);if(o)s[a]=o,Object(O.clearCurrentCues)(s[a]),Object(O.sendAddTrackEvent)(s[a],d);else{var r=this.createTextTrack("captions",v,l);r&&(r[a]=!0,s[a]=r)}}},e.createNonNativeTrack=function(a){if(!this.nonNativeCaptionsTracks[a]){var f=this.captionsProperties[a];if(!!f){var s=f.label,d={_id:a,label:s,kind:"captions",default:f.media?!!f.media.default:!1,closedCaptions:f.media};this.nonNativeCaptionsTracks[a]=d,this.hls.trigger(L.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[d]})}}},e.createTextTrack=function(a,f,s){var d=this.media;if(!!d)return d.addTextTrack(a,f,s)},e.onMediaAttaching=function(a,f){this.media=f.media,this._cleanTracks()},e.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(f){Object(O.clearCurrentCues)(a[f]),delete a[f]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=_(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var a=this.media;if(!!a){var f=a.textTracks;if(f)for(var s=0;s<f.length;s++)Object(O.clearCurrentCues)(f[s])}},e.onSubtitleTracksUpdated=function(a,f){var s=this;this.textTracks=[];var d=f.subtitleTracks||[],g=d.some(function(r){return r.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||g&&this.config.enableIMSC1){var v=this.tracks&&d&&this.tracks.length===d.length;if(this.tracks=d||[],this.config.renderTextTracksNatively){var l=this.media?this.media.textTracks:[];this.tracks.forEach(function(r,i){var h;if(i<l.length){for(var c=null,S=0;S<l.length;S++)if(p(l[S],r)){c=l[S];break}c&&(h=c)}h?Object(O.clearCurrentCues)(h):(h=s.createTextTrack("subtitles",r.name,r.lang),h&&(h.mode="disabled")),h&&(h.groupId=r.groupId,s.textTracks.push(h))})}else if(!v&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(r){return{label:r.name,kind:r.type.toLowerCase(),default:r.default,subtitleTrack:r}});this.hls.trigger(L.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}},e.onManifestLoaded=function(a,f){var s=this;this.config.enableCEA708Captions&&f.captions&&f.captions.forEach(function(d){var g=/(?:CC|SERVICE)([1-4])/.exec(d.instreamId);if(!!g){var v="textTrack"+g[1],l=s.captionsProperties[v];!l||(l.label=d.name,d.lang&&(l.languageCode=d.lang),l.media=d)}})},e.onFragLoading=function(a,f){var s=this.cea608Parser1,d=this.cea608Parser2,g=this.lastSn;if(!(!this.enabled||!(s&&d))&&f.frag.type===u.PlaylistLevelType.MAIN){var v=f.frag.sn;v!==g+1&&(s.reset(),d.reset()),this.lastSn=v}},e.onFragLoaded=function(a,f){var s=f.frag,d=f.payload,g=this.initPTS,v=this.unparsedVttFrags;if(s.type===u.PlaylistLevelType.SUBTITLE)if(d.byteLength){if(!Object(I.isFiniteNumber)(g[s.cc])){v.push(f),g.length&&this.hls.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Missing initial subtitle PTS")});return}var l=s.decryptdata;if(l==null||l.key==null||l.method!=="AES-128"){var o=this.tracks[s.level],r=this.vttCCs;r[s.cc]||(r[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),o&&o.textCodec===A.IMSC1_CODEC?this._parseIMSC1(s,d):this._parseVTTs(s,d,r)}}else this.hls.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(a,f){var s=this,d=this.hls;Object(A.parseIMSC1)(f,this.initPTS[a.cc],this.timescale[a.cc],function(g){s._appendCues(g,a.level),d.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(g){y.logger.log("Failed to parse IMSC1: "+g),d.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:g})})},e._parseVTTs=function(a,f,s){var d=this,g=this.hls;Object(R.parseWebVTT)(f,this.initPTS[a.cc],this.timescale[a.cc],s,a.cc,a.start,function(v){d._appendCues(v,a.level),g.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(v){d._fallbackToIMSC1(a,f),y.logger.log("Failed to parse VTT cue: "+v),g.trigger(L.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:v})})},e._fallbackToIMSC1=function(a,f){var s=this,d=this.tracks[a.level];d.textCodec||Object(A.parseIMSC1)(f,this.initPTS[a.cc],this.timescale[a.cc],function(){d.textCodec=A.IMSC1_CODEC,s._parseIMSC1(a,f)},function(){d.textCodec="wvtt"})},e._appendCues=function(a,f){var s=this.hls;if(this.config.renderTextTracksNatively){var d=this.textTracks[f];if(d.mode==="disabled")return;a.forEach(function(l){return Object(O.addCueToTrack)(d,l)})}else{var g=this.tracks[f],v=g.default?"default":"subtitles"+f;s.trigger(L.Events.CUES_PARSED,{type:"subtitles",cues:a,track:v})}},e.onFragDecrypted=function(a,f){var s=f.frag;if(s.type===u.PlaylistLevelType.SUBTITLE){if(!Object(I.isFiniteNumber)(this.initPTS[s.cc])){this.unparsedVttFrags.push(f);return}this.onFragLoaded(L.Events.FRAG_LOADED,f)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(a,f){var s=this.cea608Parser1,d=this.cea608Parser2;if(!(!this.enabled||!(s&&d)))for(var g=0;g<f.samples.length;g++){var v=f.samples[g].bytes;if(v){var l=this.extractCea608Data(v);s.addData(f.samples[g].pts,l[0]),d.addData(f.samples[g].pts,l[1])}}},e.onBufferFlushing=function(a,f){var s=f.startOffset,d=f.endOffset,g=f.endOffsetSubtitles,v=f.type,l=this.media;if(!(!l||l.currentTime<d)){if(!v||v==="video"){var o=this.captionsTracks;Object.keys(o).forEach(function(i){return Object(O.removeCuesInRange)(o[i],s,d)})}if(this.config.renderTextTracksNatively&&s===0&&g!==void 0){var r=this.textTracks;Object.keys(r).forEach(function(i){return Object(O.removeCuesInRange)(r[i],s,g)})}}},e.extractCea608Data=function(a){for(var f=a[0]&31,s=2,d=[[],[]],g=0;g<f;g++){var v=a[s++],l=127&a[s++],o=127&a[s++],r=(4&v)!=0,i=3&v;l===0&&o===0||r&&(i===0||i===1)&&(d[i].push(l),d[i].push(o))}return d},n}();function p(n,e){return n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function T(n,e,t,a){return Math.min(e,a)-Math.max(n,t)}function _(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return I});var I=function(){function L(M,R){this.subtle=void 0,this.aesIV=void 0,this.subtle=M,this.aesIV=R}var D=L.prototype;return D.decrypt=function(R,O){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},O,R)},L}()},"./src/crypt/aes-decryptor.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"removePadding",function(){return L}),m.d(b,"default",function(){return D});var I=m("./src/utils/typed-array.ts");function L(M){var R=M.byteLength,O=R&&new DataView(M.buffer).getUint8(R-1);return O?Object(I.sliceUint8)(M,0,R-O):M}var D=function(){function M(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var R=M.prototype;return R.uint8ArrayToUint32Array_=function(A){for(var u=new DataView(A),y=new Uint32Array(4),E=0;E<4;E++)y[E]=u.getUint32(E*4);return y},R.initTable=function(){var A=this.sBox,u=this.invSBox,y=this.subMix,E=y[0],p=y[1],T=y[2],_=y[3],n=this.invSubMix,e=n[0],t=n[1],a=n[2],f=n[3],s=new Uint32Array(256),d=0,g=0,v=0;for(v=0;v<256;v++)v<128?s[v]=v<<1:s[v]=v<<1^283;for(v=0;v<256;v++){var l=g^g<<1^g<<2^g<<3^g<<4;l=l>>>8^l&255^99,A[d]=l,u[l]=d;var o=s[d],r=s[o],i=s[r],h=s[l]*257^l*16843008;E[d]=h<<24|h>>>8,p[d]=h<<16|h>>>16,T[d]=h<<8|h>>>24,_[d]=h,h=i*16843009^r*65537^o*257^d*16843008,e[l]=h<<24|h>>>8,t[l]=h<<16|h>>>16,a[l]=h<<8|h>>>24,f[l]=h,d?(d=o^s[s[s[i^o]]],g^=s[s[g]]):d=g=1}},R.expandKey=function(A){for(var u=this.uint8ArrayToUint32Array_(A),y=!0,E=0;E<u.length&&y;)y=u[E]===this.key[E],E++;if(!y){this.key=u;var p=this.keySize=u.length;if(p!==4&&p!==6&&p!==8)throw new Error("Invalid aes key size="+p);var T=this.ksRows=(p+6+1)*4,_,n,e=this.keySchedule=new Uint32Array(T),t=this.invKeySchedule=new Uint32Array(T),a=this.sBox,f=this.rcon,s=this.invSubMix,d=s[0],g=s[1],v=s[2],l=s[3],o,r;for(_=0;_<T;_++){if(_<p){o=e[_]=u[_];continue}r=o,_%p==0?(r=r<<8|r>>>24,r=a[r>>>24]<<24|a[r>>>16&255]<<16|a[r>>>8&255]<<8|a[r&255],r^=f[_/p|0]<<24):p>6&&_%p==4&&(r=a[r>>>24]<<24|a[r>>>16&255]<<16|a[r>>>8&255]<<8|a[r&255]),e[_]=o=(e[_-p]^r)>>>0}for(n=0;n<T;n++)_=T-n,n&3?r=e[_]:r=e[_-4],n<4||_<=4?t[n]=r:t[n]=d[a[r>>>24]]^g[a[r>>>16&255]]^v[a[r>>>8&255]]^l[a[r&255]],t[n]=t[n]>>>0}},R.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},R.decrypt=function(A,u,y){for(var E=this.keySize+6,p=this.invKeySchedule,T=this.invSBox,_=this.invSubMix,n=_[0],e=_[1],t=_[2],a=_[3],f=this.uint8ArrayToUint32Array_(y),s=f[0],d=f[1],g=f[2],v=f[3],l=new Int32Array(A),o=new Int32Array(l.length),r,i,h,c,S,P,C,x,B,F,U,w,k,K,N=this.networkToHostOrderSwap;u<l.length;){for(B=N(l[u]),F=N(l[u+1]),U=N(l[u+2]),w=N(l[u+3]),S=B^p[0],P=w^p[1],C=U^p[2],x=F^p[3],k=4,K=1;K<E;K++)r=n[S>>>24]^e[P>>16&255]^t[C>>8&255]^a[x&255]^p[k],i=n[P>>>24]^e[C>>16&255]^t[x>>8&255]^a[S&255]^p[k+1],h=n[C>>>24]^e[x>>16&255]^t[S>>8&255]^a[P&255]^p[k+2],c=n[x>>>24]^e[S>>16&255]^t[P>>8&255]^a[C&255]^p[k+3],S=r,P=i,C=h,x=c,k=k+4;r=T[S>>>24]<<24^T[P>>16&255]<<16^T[C>>8&255]<<8^T[x&255]^p[k],i=T[P>>>24]<<24^T[C>>16&255]<<16^T[x>>8&255]<<8^T[S&255]^p[k+1],h=T[C>>>24]<<24^T[x>>16&255]<<16^T[S>>8&255]<<8^T[P&255]^p[k+2],c=T[x>>>24]<<24^T[S>>16&255]<<16^T[P>>8&255]<<8^T[C&255]^p[k+3],o[u]=N(r^s),o[u+1]=N(c^d),o[u+2]=N(h^g),o[u+3]=N(i^v),s=B,d=F,g=U,v=w,u=u+4}return o.buffer},M}()},"./src/crypt/decrypter.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return u});var I=m("./src/crypt/aes-crypto.ts"),L=m("./src/crypt/fast-aes-key.ts"),D=m("./src/crypt/aes-decryptor.ts"),M=m("./src/utils/logger.ts"),R=m("./src/utils/mp4-tools.ts"),O=m("./src/utils/typed-array.ts"),A=16,u=function(){function y(p,T,_){var n=_===void 0?{}:_,e=n.removePKCS7Padding,t=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=p,this.config=T,this.removePKCS7Padding=t,t)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var E=y.prototype;return E.destroy=function(){this.observer=null},E.isSync=function(){return this.config.enableSoftwareAES},E.flush=function(){var T=this.currentResult;if(!T){this.reset();return}var _=new Uint8Array(T);return this.reset(),this.removePKCS7Padding?Object(D.removePadding)(_):_},E.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},E.decrypt=function(T,_,n,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(T),_,n);var t=this.flush();t&&e(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(T),_,n).then(e)},E.softwareDecrypt=function(T,_,n){var e=this.currentIV,t=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(T=Object(R.appendUint8Array)(a,T),this.remainderData=null);var f=this.getValidChunk(T);if(!f.length)return null;e&&(n=e);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new D.default),s.expandKey(_);var d=t;return this.currentResult=s.decrypt(f.buffer,0,n),this.currentIV=Object(O.sliceUint8)(f,-16).buffer,d||null},E.webCryptoDecrypt=function(T,_,n){var e=this,t=this.subtle;return(this.key!==_||!this.fastAesKey)&&(this.key=_,this.fastAesKey=new L.default(t,_)),this.fastAesKey.expandKey().then(function(a){if(!t)return Promise.reject(new Error("web crypto not initialized"));var f=new I.default(t,n);return f.decrypt(T.buffer,a)}).catch(function(a){return e.onWebCryptoError(a,T,_,n)})},E.onWebCryptoError=function(T,_,n,e){return M.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",T),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(_,n,e)},E.getValidChunk=function(T){var _=T,n=T.length-T.length%A;return n!==T.length&&(_=Object(O.sliceUint8)(T,0,n),this.remainderData=Object(O.sliceUint8)(T,n)),_},E.logOnce=function(T){!this.logEnabled||(M.logger.log("[decrypter.ts]: "+T),this.logEnabled=!1)},y}()},"./src/crypt/fast-aes-key.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return I});var I=function(){function L(M,R){this.subtle=void 0,this.key=void 0,this.subtle=M,this.key=R}var D=L.prototype;return D.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},L}()},"./src/demux/aacdemuxer.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/demux/base-audio-demuxer.ts"),L=m("./src/demux/adts.ts"),D=m("./src/utils/logger.ts"),M=m("./src/demux/id3.ts");function R(u,y){u.prototype=Object.create(y.prototype),u.prototype.constructor=u,O(u,y)}function O(u,y){return O=Object.setPrototypeOf||function(p,T){return p.__proto__=T,p},O(u,y)}var A=function(u){R(y,u);function y(p,T){var _;return _=u.call(this)||this,_.observer=void 0,_.config=void 0,_.observer=p,_.config=T,_}var E=y.prototype;return E.resetInitSegment=function(T,_,n){u.prototype.resetInitSegment.call(this,T,_,n),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:T,duration:n,inputTimeScale:9e4,dropped:0}},y.probe=function(T){if(!T)return!1;for(var _=M.getID3Data(T,0)||[],n=_.length,e=T.length;n<e;n++)if(L.probe(T,n))return D.logger.log("ADTS sync word found !"),!0;return!1},E.canParse=function(T,_){return L.canParse(T,_)},E.appendFrame=function(T,_,n){L.initTrackConfig(T,this.observer,_,n,T.manifestCodec);var e=L.appendFrame(T,_,n,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},y}(I.default);A.minProbeByteLength=9,b.default=A},"./src/demux/adts.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"getAudioConfig",function(){return M}),m.d(b,"isHeaderPattern",function(){return R}),m.d(b,"getHeaderLength",function(){return O}),m.d(b,"getFullFrameLength",function(){return A}),m.d(b,"canGetFrameLength",function(){return u}),m.d(b,"isHeader",function(){return y}),m.d(b,"canParse",function(){return E}),m.d(b,"probe",function(){return p}),m.d(b,"initTrackConfig",function(){return T}),m.d(b,"getFrameDuration",function(){return _}),m.d(b,"parseFrameHeader",function(){return n}),m.d(b,"appendFrame",function(){return e});var I=m("./src/utils/logger.ts"),L=m("./src/errors.ts"),D=m("./src/events.ts");function M(t,a,f,s){var d,g,v,l,o=navigator.userAgent.toLowerCase(),r=s,i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];d=((a[f+2]&192)>>>6)+1;var h=(a[f+2]&60)>>>2;if(h>i.length-1){t.trigger(D.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h});return}return v=(a[f+2]&1)<<2,v|=(a[f+3]&192)>>>6,I.logger.log("manifest codec:"+s+", ADTS type:"+d+", samplingIndex:"+h),/firefox/i.test(o)?h>=6?(d=5,l=new Array(4),g=h-3):(d=2,l=new Array(2),g=h):o.indexOf("android")!==-1?(d=2,l=new Array(2),g=h):(d=5,l=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&h>=6?g=h-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(h>=6&&v===1||/vivaldi/i.test(o))||!s&&v===1)&&(d=2,l=new Array(2)),g=h)),l[0]=d<<3,l[0]|=(h&14)>>1,l[1]|=(h&1)<<7,l[1]|=v<<3,d===5&&(l[1]|=(g&14)>>1,l[2]=(g&1)<<7,l[2]|=2<<2,l[3]=0),{config:l,samplerate:i[h],channelCount:v,codec:"mp4a.40."+d,manifestCodec:r}}function R(t,a){return t[a]===255&&(t[a+1]&246)==240}function O(t,a){return t[a+1]&1?7:9}function A(t,a){return(t[a+3]&3)<<11|t[a+4]<<3|(t[a+5]&224)>>>5}function u(t,a){return a+5<t.length}function y(t,a){return a+1<t.length&&R(t,a)}function E(t,a){return u(t,a)&&R(t,a)&&A(t,a)<=t.length-a}function p(t,a){if(y(t,a)){var f=O(t,a);if(a+f>=t.length)return!1;var s=A(t,a);if(s<=f)return!1;var d=a+s;return d===t.length||y(t,d)}return!1}function T(t,a,f,s,d){if(!t.samplerate){var g=M(a,f,s,d);if(!g)return;t.config=g.config,t.samplerate=g.samplerate,t.channelCount=g.channelCount,t.codec=g.codec,t.manifestCodec=g.manifestCodec,I.logger.log("parsed codec:"+t.codec+", rate:"+g.samplerate+", channels:"+g.channelCount)}}function _(t){return 1024*9e4/t}function n(t,a,f,s,d){var g=O(t,a),v=A(t,a);if(v-=g,v>0){var l=f+s*d;return{headerLength:g,frameLength:v,stamp:l}}}function e(t,a,f,s,d){var g=_(t.samplerate),v=n(a,f,s,d,g);if(v){var l=v.frameLength,o=v.headerLength,r=v.stamp,i=o+l,h=Math.max(0,f+i-a.length),c;h?(c=new Uint8Array(i-o),c.set(a.subarray(f+o,a.length),0)):c=a.subarray(f+o,f+i);var S={unit:c,pts:r};return h||t.samples.push(S),{sample:S,length:i,missing:h}}}},"./src/demux/base-audio-demuxer.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"initPTSFn",function(){return A});var I=m("./src/polyfills/number.ts"),L=m("./src/demux/id3.ts"),D=m("./src/demux/dummy-demuxed-track.ts"),M=m("./src/utils/mp4-tools.ts"),R=m("./src/utils/typed-array.ts"),O=function(){function u(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var y=u.prototype;return y.resetInitSegment=function(p,T,_){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},y.resetTimeStamp=function(){},y.resetContiguity=function(){},y.canParse=function(p,T){return!1},y.appendFrame=function(p,T,_){},y.demux=function(p,T){this.cachedData&&(p=Object(M.appendUint8Array)(this.cachedData,p),this.cachedData=null);var _=L.getID3Data(p,0),n=_?_.length:0,e,t,a=this._audioTrack,f=this._id3Track,s=_?L.getTimeStamp(_):void 0,d=p.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=A(s,T)),_&&_.length>0&&f.samples.push({pts:this.initPTS,dts:this.initPTS,data:_}),t=this.initPTS;n<d;){if(this.canParse(p,n)){var g=this.appendFrame(a,p,n);g?(this.frameIndex++,t=g.sample.pts,n+=g.length,e=n):n=d}else L.canParse(p,n)?(_=L.getID3Data(p,n),f.samples.push({pts:t,dts:t,data:_}),n+=_.length,e=n):n++;if(n===d&&e!==d){var v=Object(R.sliceUint8)(p,e);this.cachedData?this.cachedData=Object(M.appendUint8Array)(this.cachedData,v):this.cachedData=v}}return{audioTrack:a,avcTrack:Object(D.dummyTrack)(),id3Track:f,textTrack:Object(D.dummyTrack)()}},y.demuxSampleAes=function(p,T,_){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},y.flush=function(p){var T=this.cachedData;return T&&(this.cachedData=null,this.demux(T,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(D.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(D.dummyTrack)()}},y.destroy=function(){},u}(),A=function(y,E){return Object(I.isFiniteNumber)(y)?y*90:E*9e4};b.default=O},"./src/demux/chunk-cache.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return I});var I=function(){function D(){this.chunks=[],this.dataLength=0}var M=D.prototype;return M.push=function(O){this.chunks.push(O),this.dataLength+=O.length},M.flush=function(){var O=this.chunks,A=this.dataLength,u;if(O.length)O.length===1?u=O[0]:u=L(O,A);else return new Uint8Array(0);return this.reset(),u},M.reset=function(){this.chunks.length=0,this.dataLength=0},D}();function L(D,M){for(var R=new Uint8Array(M),O=0,A=0;A<D.length;A++){var u=D[A];R.set(u,O),O+=u.length}return R}},"./src/demux/dummy-demuxed-track.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"dummyTrack",function(){return I});function I(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/utils/logger.ts"),L=function(){function D(R){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=R,this.bytesAvailable=R.byteLength,this.word=0,this.bitsAvailable=0}var M=D.prototype;return M.loadWord=function(){var O=this.data,A=this.bytesAvailable,u=O.byteLength-A,y=new Uint8Array(4),E=Math.min(4,A);if(E===0)throw new Error("no bytes available");y.set(O.subarray(u,u+E)),this.word=new DataView(y.buffer).getUint32(0),this.bitsAvailable=E*8,this.bytesAvailable-=E},M.skipBits=function(O){var A;this.bitsAvailable>O?(this.word<<=O,this.bitsAvailable-=O):(O-=this.bitsAvailable,A=O>>3,O-=A>>3,this.bytesAvailable-=A,this.loadWord(),this.word<<=O,this.bitsAvailable-=O)},M.readBits=function(O){var A=Math.min(this.bitsAvailable,O),u=this.word>>>32-A;return O>32&&I.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=A,this.bitsAvailable>0?this.word<<=A:this.bytesAvailable>0&&this.loadWord(),A=O-A,A>0&&this.bitsAvailable?u<<A|this.readBits(A):u},M.skipLZ=function(){var O;for(O=0;O<this.bitsAvailable;++O)if((this.word&2147483648>>>O)!=0)return this.word<<=O,this.bitsAvailable-=O,O;return this.loadWord(),O+this.skipLZ()},M.skipUEG=function(){this.skipBits(1+this.skipLZ())},M.skipEG=function(){this.skipBits(1+this.skipLZ())},M.readUEG=function(){var O=this.skipLZ();return this.readBits(O+1)-1},M.readEG=function(){var O=this.readUEG();return 1&O?1+O>>>1:-1*(O>>>1)},M.readBoolean=function(){return this.readBits(1)===1},M.readUByte=function(){return this.readBits(8)},M.readUShort=function(){return this.readBits(16)},M.readUInt=function(){return this.readBits(32)},M.skipScalingList=function(O){for(var A=8,u=8,y,E=0;E<O;E++)u!==0&&(y=this.readEG(),u=(A+y+256)%256),A=u===0?A:u},M.readSPS=function(){var O=0,A=0,u=0,y=0,E,p,T,_=this.readUByte.bind(this),n=this.readBits.bind(this),e=this.readUEG.bind(this),t=this.readBoolean.bind(this),a=this.skipBits.bind(this),f=this.skipEG.bind(this),s=this.skipUEG.bind(this),d=this.skipScalingList.bind(this);_();var g=_();if(n(5),a(3),_(),s(),g===100||g===110||g===122||g===244||g===44||g===83||g===86||g===118||g===128){var v=e();if(v===3&&a(1),s(),s(),a(1),t())for(p=v!==3?8:12,T=0;T<p;T++)t()&&(T<6?d(16):d(64))}s();var l=e();if(l===0)e();else if(l===1)for(a(1),f(),f(),E=e(),T=0;T<E;T++)f();s(),a(1);var o=e(),r=e(),i=n(1);i===0&&a(1),a(1),t()&&(O=e(),A=e(),u=e(),y=e());var h=[1,1];if(t()&&t()){var c=_();switch(c){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:{h=[_()<<8|_(),_()<<8|_()];break}}}return{width:Math.ceil((o+1)*16-O*2-A*2),height:(2-i)*(r+1)*16-(i?2:4)*(u+y),pixelRatio:h}},M.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},D}();b.default=L},"./src/demux/id3.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"isHeader",function(){return I}),m.d(b,"isFooter",function(){return L}),m.d(b,"getID3Data",function(){return D}),m.d(b,"canParse",function(){return R}),m.d(b,"getTimeStamp",function(){return O}),m.d(b,"isTimeStampFrame",function(){return A}),m.d(b,"getID3Frames",function(){return y}),m.d(b,"decodeFrame",function(){return E}),m.d(b,"utf8ArrayToStr",function(){return e}),m.d(b,"testables",function(){return t});var I=function(d,g){return g+10<=d.length&&d[g]===73&&d[g+1]===68&&d[g+2]===51&&d[g+3]<255&&d[g+4]<255&&d[g+6]<128&&d[g+7]<128&&d[g+8]<128&&d[g+9]<128},L=function(d,g){return g+10<=d.length&&d[g]===51&&d[g+1]===68&&d[g+2]===73&&d[g+3]<255&&d[g+4]<255&&d[g+6]<128&&d[g+7]<128&&d[g+8]<128&&d[g+9]<128},D=function(d,g){for(var v=g,l=0;I(d,g);){l+=10;var o=M(d,g+6);l+=o,L(d,g+10)&&(l+=10),g+=l}if(l>0)return d.subarray(v,v+l)},M=function(d,g){var v=0;return v=(d[g]&127)<<21,v|=(d[g+1]&127)<<14,v|=(d[g+2]&127)<<7,v|=d[g+3]&127,v},R=function(d,g){return I(d,g)&&M(d,g+6)+10<=d.length-g},O=function(d){for(var g=y(d),v=0;v<g.length;v++){var l=g[v];if(A(l))return n(l)}},A=function(d){return d&&d.key==="PRIV"&&d.info==="com.apple.streaming.transportStreamTimestamp"},u=function(d){var g=String.fromCharCode(d[0],d[1],d[2],d[3]),v=M(d,4),l=10;return{type:g,size:v,data:d.subarray(l,l+v)}},y=function(d){for(var g=0,v=[];I(d,g);){var l=M(d,g+6);g+=10;for(var o=g+l;g+8<o;){var r=u(d.subarray(g)),i=E(r);i&&v.push(i),g+=r.size+10}L(d,g)&&(g+=10)}return v},E=function(d){return d.type==="PRIV"?p(d):d.type[0]==="W"?_(d):T(d)},p=function(d){if(!(d.size<2)){var g=e(d.data,!0),v=new Uint8Array(d.data.subarray(g.length+1));return{key:d.type,info:g,data:v.buffer}}},T=function(d){if(!(d.size<2)){if(d.type==="TXXX"){var g=1,v=e(d.data.subarray(g),!0);g+=v.length+1;var l=e(d.data.subarray(g));return{key:d.type,info:v,data:l}}var o=e(d.data.subarray(1));return{key:d.type,data:o}}},_=function(d){if(d.type==="WXXX"){if(d.size<2)return;var g=1,v=e(d.data.subarray(g),!0);g+=v.length+1;var l=e(d.data.subarray(g));return{key:d.type,info:v,data:l}}var o=e(d.data);return{key:d.type,data:o}},n=function(d){if(d.data.byteLength===8){var g=new Uint8Array(d.data),v=g[3]&1,l=(g[4]<<23)+(g[5]<<15)+(g[6]<<7)+g[7];return l/=45,v&&(l+=4772185884e-2),Math.round(l)}},e=function(d,g){g===void 0&&(g=!1);var v=f();if(v){var l=v.decode(d);if(g){var o=l.indexOf("\0");return o!==-1?l.substring(0,o):l}return l.replace(/\0/g,"")}for(var r=d.length,i,h,c,S="",P=0;P<r;){if(i=d[P++],i===0&&g)return S;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:S+=String.fromCharCode(i);break;case 12:case 13:h=d[P++],S+=String.fromCharCode((i&31)<<6|h&63);break;case 14:h=d[P++],c=d[P++],S+=String.fromCharCode((i&15)<<12|(h&63)<<6|(c&63)<<0);break;default:}}return S},t={decodeTextFrame:T},a;function f(){return!a&&typeof self.TextDecoder!="undefined"&&(a=new self.TextDecoder("utf-8")),a}},"./src/demux/mp3demuxer.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/demux/base-audio-demuxer.ts"),L=m("./src/demux/id3.ts"),D=m("./src/utils/logger.ts"),M=m("./src/demux/mpegaudio.ts");function R(u,y){u.prototype=Object.create(y.prototype),u.prototype.constructor=u,O(u,y)}function O(u,y){return O=Object.setPrototypeOf||function(p,T){return p.__proto__=T,p},O(u,y)}var A=function(u){R(y,u);function y(){return u.apply(this,arguments)||this}var E=y.prototype;return E.resetInitSegment=function(T,_,n){u.prototype.resetInitSegment.call(this,T,_,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:T,duration:n,inputTimeScale:9e4,dropped:0}},y.probe=function(T){if(!T)return!1;for(var _=L.getID3Data(T,0)||[],n=_.length,e=T.length;n<e;n++)if(M.probe(T,n))return D.logger.log("MPEG Audio sync word found !"),!0;return!1},E.canParse=function(T,_){return M.canParse(T,_)},E.appendFrame=function(T,_,n){if(this.initPTS!==null)return M.appendFrame(T,_,n,this.initPTS,this.frameIndex)},y}(I.default);A.minProbeByteLength=4,b.default=A},"./src/demux/mp4demuxer.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/utils/mp4-tools.ts"),L=m("./src/demux/dummy-demuxed-track.ts"),D=function(){function M(O,A){this.remainderData=null,this.config=void 0,this.config=A}var R=M.prototype;return R.resetTimeStamp=function(){},R.resetInitSegment=function(){},R.resetContiguity=function(){},M.probe=function(A){return Object(I.findBox)({data:A,start:0,end:Math.min(A.length,16384)},["moof"]).length>0},R.demux=function(A){var u=A,y=Object(L.dummyTrack)();if(this.config.progressive){this.remainderData&&(u=Object(I.appendUint8Array)(this.remainderData,A));var E=Object(I.segmentValidRange)(u);this.remainderData=E.remainder,y.samples=E.valid||new Uint8Array}else y.samples=u;return{audioTrack:Object(L.dummyTrack)(),avcTrack:y,id3Track:Object(L.dummyTrack)(),textTrack:Object(L.dummyTrack)()}},R.flush=function(){var A=Object(L.dummyTrack)();return A.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(L.dummyTrack)(),avcTrack:A,id3Track:Object(L.dummyTrack)(),textTrack:Object(L.dummyTrack)()}},R.demuxSampleAes=function(A,u,y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},R.destroy=function(){},M}();D.minProbeByteLength=1024,b.default=D},"./src/demux/mpegaudio.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"appendFrame",function(){return O}),m.d(b,"parseHeader",function(){return A}),m.d(b,"isHeaderPattern",function(){return u}),m.d(b,"isHeader",function(){return y}),m.d(b,"canParse",function(){return E}),m.d(b,"probe",function(){return p});var I=null,L=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],D=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],M=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],R=[0,1,1,4];function O(T,_,n,e,t){if(!(n+24>_.length)){var a=A(_,n);if(a&&n+a.frameLength<=_.length){var f=a.samplesPerFrame*9e4/a.sampleRate,s=e+t*f,d={unit:_.subarray(n,n+a.frameLength),pts:s,dts:s};return T.config=[],T.channelCount=a.channelCount,T.samplerate=a.sampleRate,T.samples.push(d),{sample:d,length:a.frameLength,missing:0}}}}function A(T,_){var n=T[_+1]>>3&3,e=T[_+1]>>1&3,t=T[_+2]>>4&15,a=T[_+2]>>2&3;if(n!==1&&t!==0&&t!==15&&a!==3){var f=T[_+2]>>1&1,s=T[_+3]>>6,d=n===3?3-e:e===3?3:4,g=L[d*14+t-1]*1e3,v=n===3?0:n===2?1:2,l=D[v*3+a],o=s===3?1:2,r=M[n][e],i=R[e],h=r*8*i,c=Math.floor(r*g/l+f)*i;if(I===null){var S=navigator.userAgent||"",P=S.match(/Chrome\/(\d+)/i);I=P?parseInt(P[1]):0}var C=!!I&&I<=87;return C&&e===2&&g>=224e3&&s===0&&(T[_+3]=T[_+3]|128),{sampleRate:l,channelCount:o,frameLength:c,samplesPerFrame:h}}}function u(T,_){return T[_]===255&&(T[_+1]&224)==224&&(T[_+1]&6)!=0}function y(T,_){return _+1<T.length&&u(T,_)}function E(T,_){var n=4;return u(T,_)&&n<=T.length-_}function p(T,_){if(_+1<T.length&&u(T,_)){var n=4,e=A(T,_),t=n;e!=null&&e.frameLength&&(t=e.frameLength);var a=_+t;return a===T.length||y(T,a)}return!1}},"./src/demux/sample-aes.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/crypt/decrypter.ts"),L=m("./src/demux/tsdemuxer.ts"),D=function(){function M(O,A,u){this.keyData=void 0,this.decrypter=void 0,this.keyData=u,this.decrypter=new I.default(O,A,{removePKCS7Padding:!1})}var R=M.prototype;return R.decryptBuffer=function(A,u){this.decrypter.decrypt(A,this.keyData.key.buffer,this.keyData.iv.buffer,u)},R.decryptAacSample=function(A,u,y,E){var p=A[u].unit,T=p.subarray(16,p.length-p.length%16),_=T.buffer.slice(T.byteOffset,T.byteOffset+T.length),n=this;this.decryptBuffer(_,function(e){var t=new Uint8Array(e);p.set(t,16),E||n.decryptAacSamples(A,u+1,y)})},R.decryptAacSamples=function(A,u,y){for(;;u++){if(u>=A.length){y();return}if(!(A[u].unit.length<32)){var E=this.decrypter.isSync();if(this.decryptAacSample(A,u,y,E),!E)return}}},R.getAvcEncryptedData=function(A){for(var u=Math.floor((A.length-48)/160)*16+16,y=new Int8Array(u),E=0,p=32;p<=A.length-16;p+=160,E+=16)y.set(A.subarray(p,p+16),E);return y},R.getAvcDecryptedUnit=function(A,u){for(var y=new Uint8Array(u),E=0,p=32;p<=A.length-16;p+=160,E+=16)A.set(y.subarray(E,E+16),p);return A},R.decryptAvcSample=function(A,u,y,E,p,T){var _=Object(L.discardEPB)(p.data),n=this.getAvcEncryptedData(_),e=this;this.decryptBuffer(n.buffer,function(t){p.data=e.getAvcDecryptedUnit(_,t),T||e.decryptAvcSamples(A,u,y+1,E)})},R.decryptAvcSamples=function(A,u,y,E){if(A instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;u++,y=0){if(u>=A.length){E();return}for(var p=A[u].units;!(y>=p.length);y++){var T=p[y];if(!(T.data.length<=48||T.type!==1&&T.type!==5)){var _=this.decrypter.isSync();if(this.decryptAvcSample(A,u,y,E,T,_),!_)return}}}},M}();b.default=D},"./src/demux/transmuxer-interface.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return p});var I=m("./node_modules/webworkify-webpack/index.js"),L=m.n(I),D=m("./src/events.ts"),M=m("./src/demux/transmuxer.ts"),R=m("./src/utils/logger.ts"),O=m("./src/errors.ts"),A=m("./src/utils/mediasource-helper.ts"),u=m("./node_modules/eventemitter3/index.js"),y=m.n(u),E=Object(A.getMediaSource)()||{isTypeSupported:function(){return!1}},p=function(){function T(n,e,t,a){var f=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=n,this.id=e,this.onTransmuxComplete=t,this.onFlush=a;var s=n.config,d=function(r,i){i=i||{},i.frag=f.frag,i.id=f.id,n.trigger(r,i)};this.observer=new u.EventEmitter,this.observer.on(D.Events.FRAG_DECRYPTED,d),this.observer.on(D.Events.ERROR,d);var g={mp4:E.isTypeSupported("video/mp4"),mpeg:E.isTypeSupported("audio/mpeg"),mp3:E.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(s.enableWorker&&typeof Worker!="undefined"){R.logger.log("demuxing in webworker");var l;try{l=this.worker=I("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),l.addEventListener("message",this.onwmsg),l.onerror=function(o){n.trigger(D.Events.ERROR,{type:O.ErrorTypes.OTHER_ERROR,details:O.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(o.message+"  ("+o.filename+":"+o.lineno+")")})},l.postMessage({cmd:"init",typeSupported:g,vendor:v,id:e,config:JSON.stringify(s)})}catch(o){R.logger.warn("Error in worker:",o),R.logger.error("Error while initializing DemuxerWorker, fallback to inline"),l&&self.URL.revokeObjectURL(l.objectURL),this.transmuxer=new M.default(this.observer,g,s,v,e),this.worker=null}}else this.transmuxer=new M.default(this.observer,g,s,v,e)}var _=T.prototype;return _.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var a=this.observer;a&&a.removeAllListeners(),this.observer=null},_.push=function(e,t,a,f,s,d,g,v,l,o){var r=this;l.transmuxing.start=self.performance.now();var i=this.transmuxer,h=this.worker,c=d?d.start:s.start,S=s.decryptdata,P=this.frag,C=!(P&&s.cc===P.cc),x=!(P&&l.level===P.level),B=P?l.sn-P.sn:-1,F=this.part?l.part-this.part.index:1,U=!x&&(B===1||B===0&&F===1),w=self.performance.now();(x||B||s.stats.parsing.start===0)&&(s.stats.parsing.start=w),d&&(F||!U)&&(d.stats.parsing.start=w);var k=new M.TransmuxState(C,U,v,x,c);if(!U||C){R.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+`
        discontinuity: `+C+`
        trackSwitch: `+x+`
        contiguous: `+U+`
        accurateTimeOffset: `+v+`
        timeOffset: `+c);var K=new M.TransmuxConfig(a,f,t,g,o);this.configureTransmuxer(K)}if(this.frag=s,this.part=d,h)h.postMessage({cmd:"demux",data:e,decryptdata:S,chunkMeta:l,state:k},e instanceof ArrayBuffer?[e]:[]);else if(i){var N=i.push(e,S,l,k);Object(M.isPromise)(N)?N.then(function(G){r.handleTransmuxComplete(G)}):this.handleTransmuxComplete(N)}},_.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var a=this.transmuxer,f=this.worker;if(f)f.postMessage({cmd:"flush",chunkMeta:e});else if(a){var s=a.flush(e);Object(M.isPromise)(s)?s.then(function(d){t.handleFlushResult(d,e)}):this.handleFlushResult(s,e)}},_.handleFlushResult=function(e,t){var a=this;e.forEach(function(f){a.handleTransmuxComplete(f)}),this.onFlush(t)},_.onWorkerMessage=function(e){var t=e.data,a=this.hls;switch(t.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,a.trigger(t.event,t.data);break}}},_.configureTransmuxer=function(e){var t=this.worker,a=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):a&&a.configure(e)},_.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},T}()},"./src/demux/transmuxer-worker.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return O});var I=m("./src/demux/transmuxer.ts"),L=m("./src/events.ts"),D=m("./src/utils/logger.ts"),M=m("./node_modules/eventemitter3/index.js"),R=m.n(M);function O(p){var T=new M.EventEmitter,_=function(e,t){p.postMessage({event:e,data:t})};T.on(L.Events.FRAG_DECRYPTED,_),T.on(L.Events.ERROR,_),p.addEventListener("message",function(n){var e=n.data;switch(e.cmd){case"init":{var t=JSON.parse(e.config);p.transmuxer=new I.default(T,e.typeSupported,t,e.vendor,e.id),Object(D.enableLogs)(t.debug),_("init",null);break}case"configure":{p.transmuxer.configure(e.config);break}case"demux":{var a=p.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(I.isPromise)(a)?a.then(function(d){A(p,d)}):A(p,a);break}case"flush":{var f=e.chunkMeta,s=p.transmuxer.flush(f);Object(I.isPromise)(s)?s.then(function(d){y(p,d,f)}):y(p,s,f);break}default:break}})}function A(p,T){if(!E(T.remuxResult)){var _=[],n=T.remuxResult,e=n.audio,t=n.video;e&&u(_,e),t&&u(_,t),p.postMessage({event:"transmuxComplete",data:T},_)}}function u(p,T){T.data1&&p.push(T.data1.buffer),T.data2&&p.push(T.data2.buffer)}function y(p,T,_){T.forEach(function(n){A(p,n)}),p.postMessage({event:"flush",data:_})}function E(p){return!p.audio&&!p.video&&!p.text&&!p.id3&&!p.initSegment}},"./src/demux/transmuxer.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return t}),m.d(b,"isPromise",function(){return s}),m.d(b,"TransmuxConfig",function(){return d}),m.d(b,"TransmuxState",function(){return g});var I=m("./src/events.ts"),L=m("./src/errors.ts"),D=m("./src/crypt/decrypter.ts"),M=m("./src/demux/aacdemuxer.ts"),R=m("./src/demux/mp4demuxer.ts"),O=m("./src/demux/tsdemuxer.ts"),A=m("./src/demux/mp3demuxer.ts"),u=m("./src/remux/mp4-remuxer.ts"),y=m("./src/remux/passthrough-remuxer.ts"),E=m("./src/demux/chunk-cache.ts"),p=m("./src/utils/mp4-tools.ts"),T=m("./src/utils/logger.ts"),_;try{_=self.performance.now.bind(self.performance)}catch{T.logger.debug("Unable to use Performance API on this environment"),_=self.Date.now}var n=[{demux:O.default,remux:u.default},{demux:R.default,remux:y.default},{demux:M.default,remux:u.default},{demux:A.default,remux:u.default}],e=1024;n.forEach(function(v){var l=v.demux;e=Math.max(e,l.minProbeByteLength)});var t=function(){function v(o,r,i,h,c){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new E.default,this.observer=o,this.typeSupported=r,this.config=i,this.vendor=h,this.id=c}var l=v.prototype;return l.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},l.push=function(r,i,h,c){var S=this,P=h.transmuxing;P.executeStart=_();var C=new Uint8Array(r),x=this.cache,B=this.config,F=this.currentTransmuxState,U=this.transmuxConfig;c&&(this.currentTransmuxState=c);var w=a(C,i);if(w&&w.method==="AES-128"){var k=this.getDecrypter();if(B.enableSoftwareAES){var K=k.softwareDecrypt(C,w.key.buffer,w.iv.buffer);if(!K)return P.executeEnd=_(),f(h);C=new Uint8Array(K)}else return this.decryptionPromise=k.webCryptoDecrypt(C,w.key.buffer,w.iv.buffer).then(function(ie){var le=S.push(ie,null,h);return S.decryptionPromise=null,le}),this.decryptionPromise}var N=c||F,G=N.contiguous,H=N.discontinuity,V=N.trackSwitch,z=N.accurateTimeOffset,Q=N.timeOffset,q=U.audioCodec,J=U.videoCodec,te=U.defaultInitPts,ue=U.duration,$=U.initSegmentData;if((H||V)&&this.resetInitSegment($,q,J,ue),H&&this.resetInitialTimestamp(te),G||this.resetContiguity(),this.needsProbing(C,H,V)){if(x.dataLength){var Z=x.flush();C=Object(p.appendUint8Array)(Z,C)}this.configureTransmuxer(C,U)}var Y=this.transmux(C,w,Q,z,h),X=this.currentTransmuxState;return X.contiguous=!0,X.discontinuity=!1,X.trackSwitch=!1,P.executeEnd=_(),Y},l.flush=function(r){var i=this,h=r.transmuxing;h.executeStart=_();var c=this.decrypter,S=this.cache,P=this.currentTransmuxState,C=this.decryptionPromise;if(C)return C.then(function(){return i.flush(r)});var x=[],B=P.timeOffset;if(c){var F=c.flush();F&&x.push(this.push(F,null,r))}var U=S.dataLength;S.reset();var w=this.demuxer,k=this.remuxer;if(!w||!k)return U>=e&&this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),h.executeEnd=_(),[f(r)];var K=w.flush(B);return s(K)?K.then(function(N){return i.flushRemux(x,N,r),x}):(this.flushRemux(x,K,r),x)},l.flushRemux=function(r,i,h){var c=i.audioTrack,S=i.avcTrack,P=i.id3Track,C=i.textTrack,x=this.currentTransmuxState,B=x.accurateTimeOffset,F=x.timeOffset;T.logger.log("[transmuxer.ts]: Flushed fragment "+h.sn+(h.part>-1?" p: "+h.part:"")+" of level "+h.level);var U=this.remuxer.remux(c,S,P,C,F,B,!0,this.id);r.push({remuxResult:U,chunkMeta:h}),h.transmuxing.executeEnd=_()},l.resetInitialTimestamp=function(r){var i=this.demuxer,h=this.remuxer;!i||!h||(i.resetTimeStamp(r),h.resetTimeStamp(r))},l.resetContiguity=function(){var r=this.demuxer,i=this.remuxer;!r||!i||(r.resetContiguity(),i.resetNextTimestamp())},l.resetInitSegment=function(r,i,h,c){var S=this.demuxer,P=this.remuxer;!S||!P||(S.resetInitSegment(i,h,c),P.resetInitSegment(r,i,h))},l.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},l.transmux=function(r,i,h,c,S){var P;return i&&i.method==="SAMPLE-AES"?P=this.transmuxSampleAes(r,i,h,c,S):P=this.transmuxUnencrypted(r,h,c,S),P},l.transmuxUnencrypted=function(r,i,h,c){var S=this.demuxer.demux(r,i,!1,!this.config.progressive),P=S.audioTrack,C=S.avcTrack,x=S.id3Track,B=S.textTrack,F=this.remuxer.remux(P,C,x,B,i,h,!1,this.id);return{remuxResult:F,chunkMeta:c}},l.transmuxSampleAes=function(r,i,h,c,S){var P=this;return this.demuxer.demuxSampleAes(r,i,h).then(function(C){var x=P.remuxer.remux(C.audioTrack,C.avcTrack,C.id3Track,C.textTrack,h,c,!1,P.id);return{remuxResult:x,chunkMeta:S}})},l.configureTransmuxer=function(r,i){for(var h=this.config,c=this.observer,S=this.typeSupported,P=this.vendor,C=i.audioCodec,x=i.defaultInitPts,B=i.duration,F=i.initSegmentData,U=i.videoCodec,w,k=0,K=n.length;k<K;k++)if(n[k].demux.probe(r)){w=n[k];break}w||(T.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),w={demux:R.default,remux:y.default});var N=this.demuxer,G=this.remuxer,H=w.remux,V=w.demux;(!G||!(G instanceof H))&&(this.remuxer=new H(c,h,S,P)),(!N||!(N instanceof V))&&(this.demuxer=new V(c,h,S),this.probe=V.probe),this.resetInitSegment(F,C,U,B),this.resetInitialTimestamp(x)},l.needsProbing=function(r,i,h){return!this.demuxer||!this.remuxer||i||h},l.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new D.default(this.observer,this.config)),r},v}();function a(v,l){var o=null;return v.byteLength>0&&l!=null&&l.key!=null&&l.iv!==null&&l.method!=null&&(o=l),o}var f=function(l){return{remuxResult:{},chunkMeta:l}};function s(v){return"then"in v&&v.then instanceof Function}var d=function(l,o,r,i,h){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=l,this.videoCodec=o,this.initSegmentData=r,this.duration=i,this.defaultInitPts=h},g=function(l,o,r,i,h){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=l,this.contiguous=o,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=h}},"./src/demux/tsdemuxer.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"discardEPB",function(){return f});var I=m("./src/demux/adts.ts"),L=m("./src/demux/mpegaudio.ts"),D=m("./src/demux/exp-golomb.ts"),M=m("./src/demux/id3.ts"),R=m("./src/demux/sample-aes.ts"),O=m("./src/events.ts"),A=m("./src/utils/mp4-tools.ts"),u=m("./src/utils/logger.ts"),y=m("./src/errors.ts"),E={video:1,audio:2,id3:3,text:4},p=function(){function s(g,v,l){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=g,this.config=v,this.typeSupported=l}s.probe=function(v){var l=s.syncOffset(v);return l<0?!1:(l&&u.logger.warn("MPEG2-TS detected but first sync word found @ offset "+l+", junk ahead ?"),!0)},s.syncOffset=function(v){for(var l=Math.min(1e3,v.length-3*188),o=0;o<l;){if(v[o]===71&&v[o+188]===71&&v[o+2*188]===71)return o;o++}return-1},s.createTrack=function(v,l){return{container:v==="video"||v==="audio"?"video/mp2t":void 0,type:v,id:E[v],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:v==="audio"?l:void 0}};var d=s.prototype;return d.resetInitSegment=function(v,l,o){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=s.createTrack("video",o),this._audioTrack=s.createTrack("audio",o),this._id3Track=s.createTrack("id3",o),this._txtTrack=s.createTrack("text",o),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=v,this.videoCodec=l,this._duration=o},d.resetTimeStamp=function(){},d.resetContiguity=function(){var v=this._audioTrack,l=this._avcTrack,o=this._id3Track;v&&(v.pesData=null),l&&(l.pesData=null),o&&(o.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},d.demux=function(v,l,o,r){o===void 0&&(o=!1),r===void 0&&(r=!1),o||(this.sampleAes=null);var i,h=this._avcTrack,c=this._audioTrack,S=this._id3Track,P=h.pid,C=h.pesData,x=c.pid,B=S.pid,F=c.pesData,U=S.pesData,w=!1,k=this.pmtParsed,K=this._pmtId,N=v.length;if(this.remainderData&&(v=Object(A.appendUint8Array)(this.remainderData,v),N=v.length,this.remainderData=null),N<188&&!r)return this.remainderData=v,{audioTrack:c,avcTrack:h,id3Track:S,textTrack:this._txtTrack};var G=Math.max(0,s.syncOffset(v));N-=(N+G)%188,N<v.byteLength&&!r&&(this.remainderData=new Uint8Array(v.buffer,N,v.buffer.byteLength-N));for(var H=G;H<N;H+=188)if(v[H]===71){var V=!!(v[H+1]&64),z=((v[H+1]&31)<<8)+v[H+2],Q=(v[H+3]&48)>>4,q=void 0;if(Q>1){if(q=H+5+v[H+4],q===H+188)continue}else q=H+4;switch(z){case P:V&&(C&&(i=e(C))&&this.parseAVCPES(i,!1),C={data:[],size:0}),C&&(C.data.push(v.subarray(q,H+188)),C.size+=H+188-q);break;case x:V&&(F&&(i=e(F))&&(c.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),F={data:[],size:0}),F&&(F.data.push(v.subarray(q,H+188)),F.size+=H+188-q);break;case B:V&&(U&&(i=e(U))&&this.parseID3PES(i),U={data:[],size:0}),U&&(U.data.push(v.subarray(q,H+188)),U.size+=H+188-q);break;case 0:V&&(q+=v[q]+1),K=this._pmtId=_(v,q);break;case K:{V&&(q+=v[q]+1);var J=n(v,q,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,o);P=J.avc,P>0&&(h.pid=P),x=J.audio,x>0&&(c.pid=x,c.isAAC=J.isAAC),B=J.id3,B>0&&(S.pid=B),w&&!k&&(u.logger.log("reparse from beginning"),w=!1,H=G-188),k=this.pmtParsed=!0;break}case 17:case 8191:break;default:w=!0;break}}else this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});h.pesData=C,c.pesData=F,S.pesData=U;var te={audioTrack:c,avcTrack:h,id3Track:S,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(te),te},d.flush=function(){var v=this.remainderData;this.remainderData=null;var l;return v?l=this.demux(v,-1,!1,!0):l={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(l),this.sampleAes?this.decrypt(l,this.sampleAes):l},d.extractRemainingSamples=function(v){var l=v.audioTrack,o=v.avcTrack,r=v.id3Track,i=o.pesData,h=l.pesData,c=r.pesData,S;i&&(S=e(i))?(this.parseAVCPES(S,!0),o.pesData=null):o.pesData=i,h&&(S=e(h))?(l.isAAC?this.parseAACPES(S):this.parseMPEGPES(S),l.pesData=null):(h!=null&&h.size&&u.logger.log("last AAC PES packet truncated,might overlap between fragments"),l.pesData=h),c&&(S=e(c))?(this.parseID3PES(S),r.pesData=null):r.pesData=c},d.demuxSampleAes=function(v,l,o){var r=this.demux(v,o,!0,!this.config.progressive),i=this.sampleAes=new R.default(this.observer,this.config,l);return this.decrypt(r,i)},d.decrypt=function(v,l){return new Promise(function(o){var r=v.audioTrack,i=v.avcTrack;r.samples&&r.isAAC?l.decryptAacSamples(r.samples,0,function(){i.samples?l.decryptAvcSamples(i.samples,0,0,function(){o(v)}):o(v)}):i.samples&&l.decryptAvcSamples(i.samples,0,0,function(){o(v)})})},d.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},d.parseAVCPES=function(v,l){var o=this,r=this._avcTrack,i=this.parseAVCNALu(v.data),h=!1,c=this.avcSample,S,P=!1;v.data=null,c&&i.length&&!r.audFound&&(t(c,r),c=this.avcSample=T(!1,v.pts,v.dts,"")),i.forEach(function(C){switch(C.type){case 1:{S=!0,c||(c=o.avcSample=T(!0,v.pts,v.dts,"")),h&&(c.debug+="NDR "),c.frame=!0;var x=C.data;if(P&&x.length>4){var B=new D.default(x).readSliceType();(B===2||B===4||B===7||B===9)&&(c.key=!0)}break}case 5:S=!0,c||(c=o.avcSample=T(!0,v.pts,v.dts,"")),h&&(c.debug+="IDR "),c.key=!0,c.frame=!0;break;case 6:{S=!0,h&&c&&(c.debug+="SEI ");var F=new D.default(f(C.data));F.readUByte();for(var U=0,w=0,k=!1,K=0;!k&&F.bytesAvailable>1;){U=0;do K=F.readUByte(),U+=K;while(K===255);w=0;do K=F.readUByte(),w+=K;while(K===255);if(U===4&&F.bytesAvailable!==0){k=!0;var N=F.readUByte();if(N===181){var G=F.readUShort();if(G===49){var H=F.readUInt();if(H===1195456820){var V=F.readUByte();if(V===3){for(var z=F.readUByte(),Q=F.readUByte(),q=31&z,J=[z,Q],te=0;te<q;te++)J.push(F.readUByte()),J.push(F.readUByte()),J.push(F.readUByte());a(o._txtTrack.samples,{type:3,pts:v.pts,bytes:J})}}}}}else if(U===5&&F.bytesAvailable!==0){if(k=!0,w>16){for(var ue=[],$=0;$<16;$++)ue.push(F.readUByte().toString(16)),($===3||$===5||$===7||$===9)&&ue.push("-");for(var Z=w-16,Y=new Uint8Array(Z),X=0;X<Z;X++)Y[X]=F.readUByte();a(o._txtTrack.samples,{pts:v.pts,payloadType:U,uuid:ue.join(""),userData:Object(M.utf8ArrayToStr)(Y),userDataBytes:Y})}}else if(w<F.bytesAvailable)for(var ie=0;ie<w;ie++)F.readUByte()}break}case 7:if(S=!0,P=!0,h&&c&&(c.debug+="SPS "),!r.sps){var le=new D.default(C.data),oe=le.readSPS();r.width=oe.width,r.height=oe.height,r.pixelRatio=oe.pixelRatio,r.sps=[C.data],r.duration=o._duration;for(var de=C.data.subarray(1,4),fe="avc1.",se=0;se<3;se++){var re=de[se].toString(16);re.length<2&&(re="0"+re),fe+=re}r.codec=fe}break;case 8:S=!0,h&&c&&(c.debug+="PPS "),r.pps||(r.pps=[C.data]);break;case 9:S=!1,r.audFound=!0,c&&t(c,r),c=o.avcSample=T(!1,v.pts,v.dts,h?"AUD ":"");break;case 12:S=!1;break;default:S=!1,c&&(c.debug+="unknown NAL "+C.type+" ");break}if(c&&S){var ae=c.units;ae.push(C)}}),l&&c&&(t(c,r),this.avcSample=null)},d.getLastNalUnit=function(){var v,l=this.avcSample,o;if(!l||l.units.length===0){var r=this._avcTrack.samples;l=r[r.length-1]}if((v=l)!==null&&v!==void 0&&v.units){var i=l.units;o=i[i.length-1]}return o},d.parseAVCNALu=function(v){var l=v.byteLength,o=this._avcTrack,r=o.naluState||0,i=r,h=[],c=0,S,P,C,x=-1,B=0;for(r===-1&&(x=0,B=v[0]&31,r=0,c=1);c<l;){if(S=v[c++],!r){r=S?0:1;continue}if(r===1){r=S?0:2;continue}if(!S)r=3;else if(S===1){if(x>=0){var F={data:v.subarray(x,c-r-1),type:B};h.push(F)}else{var U=this.getLastNalUnit();if(U&&(i&&c<=4-i&&U.state&&(U.data=U.data.subarray(0,U.data.byteLength-i)),P=c-r-1,P>0)){var w=new Uint8Array(U.data.byteLength+P);w.set(U.data,0),w.set(v.subarray(0,P),U.data.byteLength),U.data=w}}c<l?(C=v[c]&31,x=c,B=C,r=0):r=-1}else r=0}if(x>=0&&r>=0){var k={data:v.subarray(x,l),type:B,state:r};h.push(k)}if(h.length===0){var K=this.getLastNalUnit();if(K){var N=new Uint8Array(K.data.byteLength+v.byteLength);N.set(K.data,0),N.set(v,K.data.byteLength),K.data=N}}return o.naluState=r,h},d.parseAACPES=function(v){var l=0,o=this._audioTrack,r=this.aacOverFlow,i=v.data;if(r){this.aacOverFlow=null;var h=r.sample.unit.byteLength,c=Math.min(r.missing,h),S=h-c;r.sample.unit.set(i.subarray(0,c),S),o.samples.push(r.sample),l=r.missing}var P,C;for(P=l,C=i.length;P<C-1&&!I.isHeader(i,P);P++);if(P!==l){var x,B;if(P<C-1?(x="AAC PES did not start with ADTS header,offset:"+P,B=!1):(x="no ADTS header found in AAC PES",B=!0),u.logger.warn("parsing error:"+x),this.observer.emit(O.Events.ERROR,O.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:x}),B)return}I.initTrackConfig(o,this.observer,i,P,this.audioCodec);var F;if(v.pts!==void 0)F=v.pts;else if(r){var U=I.getFrameDuration(o.samplerate);F=r.sample.pts+U}else{u.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var w=0;P<C;)if(I.isHeader(i,P)){if(P+5<C){var k=I.appendFrame(o,i,P,F,w);if(k)if(k.missing)this.aacOverFlow=k;else{P+=k.length,w++;continue}}break}else P++},d.parseMPEGPES=function(v){var l=v.data,o=l.length,r=0,i=0,h=v.pts;if(h===void 0){u.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;i<o;)if(L.isHeader(l,i)){var c=L.appendFrame(this._audioTrack,l,i,h,r);if(c)i+=c.length,r++;else break}else i++},d.parseID3PES=function(v){if(v.pts===void 0){u.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(v)},s}();p.minProbeByteLength=188;function T(s,d,g,v){return{key:s,frame:!1,pts:d,dts:g,units:[],debug:v,length:0}}function _(s,d){return(s[d+10]&31)<<8|s[d+11]}function n(s,d,g,v){var l={audio:-1,avc:-1,id3:-1,isAAC:!0},o=(s[d+1]&15)<<8|s[d+2],r=d+3+o-4,i=(s[d+10]&15)<<8|s[d+11];for(d+=12+i;d<r;){var h=(s[d+1]&31)<<8|s[d+2];switch(s[d]){case 207:if(!v){u.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:l.audio===-1&&(l.audio=h);break;case 21:l.id3===-1&&(l.id3=h);break;case 219:if(!v){u.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:l.avc===-1&&(l.avc=h);break;case 3:case 4:g?l.audio===-1&&(l.audio=h,l.isAAC=!1):u.logger.log("MPEG audio found, not supported in this browser");break;case 36:u.logger.warn("Unsupported HEVC stream type found");break;default:break}d+=((s[d+3]&15)<<8|s[d+4])+5}return l}function e(s){var d=0,g,v,l,o,r,i=s.data;if(!s||s.size===0)return null;for(;i[0].length<19&&i.length>1;){var h=new Uint8Array(i[0].length+i[1].length);h.set(i[0]),h.set(i[1],i[0].length),i[0]=h,i.splice(1,1)}g=i[0];var c=(g[0]<<16)+(g[1]<<8)+g[2];if(c===1){if(v=(g[4]<<8)+g[5],v&&v>s.size-6)return null;var S=g[7];S&192&&(o=(g[9]&14)*536870912+(g[10]&255)*4194304+(g[11]&254)*16384+(g[12]&255)*128+(g[13]&254)/2,S&64?(r=(g[14]&14)*536870912+(g[15]&255)*4194304+(g[16]&254)*16384+(g[17]&255)*128+(g[18]&254)/2,o-r>60*9e4&&(u.logger.warn(Math.round((o-r)/9e4)+"s delta between PTS and DTS, align them"),o=r)):r=o),l=g[8];var P=l+9;if(s.size<=P)return null;s.size-=P;for(var C=new Uint8Array(s.size),x=0,B=i.length;x<B;x++){g=i[x];var F=g.byteLength;if(P)if(P>F){P-=F;continue}else g=g.subarray(P),F-=P,P=0;C.set(g,d),d+=F}return v&&(v-=l+3),{data:C,pts:o,dts:r,len:v}}return null}function t(s,d){if(s.units.length&&s.frame){if(s.pts===void 0){var g=d.samples,v=g.length;if(v){var l=g[v-1];s.pts=l.pts,s.dts=l.dts}else{d.dropped++;return}}d.samples.push(s)}s.debug.length&&u.logger.log(s.pts+"/"+s.dts+":"+s.debug)}function a(s,d){var g=s.length;if(g>0){if(d.pts>=s[g-1].pts)s.push(d);else for(var v=g-1;v>=0;v--)if(d.pts<s[v].pts){s.splice(v,0,d);break}}else s.push(d)}function f(s){for(var d=s.byteLength,g=[],v=1;v<d-2;)s[v]===0&&s[v+1]===0&&s[v+2]===3?(g.push(v+2),v+=2):v++;if(g.length===0)return s;var l=d-g.length,o=new Uint8Array(l),r=0;for(v=0;v<l;r++,v++)r===g[0]&&(r++,g.shift()),o[v]=s[r];return o}b.default=p},"./src/errors.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"ErrorTypes",function(){return I}),m.d(b,"ErrorDetails",function(){return L});var I;(function(D){D.NETWORK_ERROR="networkError",D.MEDIA_ERROR="mediaError",D.KEY_SYSTEM_ERROR="keySystemError",D.MUX_ERROR="muxError",D.OTHER_ERROR="otherError"})(I||(I={}));var L;(function(D){D.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",D.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",D.KEY_SYSTEM_NO_SESSION="keySystemNoSession",D.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",D.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",D.MANIFEST_LOAD_ERROR="manifestLoadError",D.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",D.MANIFEST_PARSING_ERROR="manifestParsingError",D.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",D.LEVEL_EMPTY_ERROR="levelEmptyError",D.LEVEL_LOAD_ERROR="levelLoadError",D.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",D.LEVEL_SWITCH_ERROR="levelSwitchError",D.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",D.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",D.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",D.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",D.FRAG_LOAD_ERROR="fragLoadError",D.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",D.FRAG_DECRYPT_ERROR="fragDecryptError",D.FRAG_PARSING_ERROR="fragParsingError",D.REMUX_ALLOC_ERROR="remuxAllocError",D.KEY_LOAD_ERROR="keyLoadError",D.KEY_LOAD_TIMEOUT="keyLoadTimeOut",D.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",D.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",D.BUFFER_APPEND_ERROR="bufferAppendError",D.BUFFER_APPENDING_ERROR="bufferAppendingError",D.BUFFER_STALLED_ERROR="bufferStalledError",D.BUFFER_FULL_ERROR="bufferFullError",D.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",D.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",D.INTERNAL_EXCEPTION="internalException",D.INTERNAL_ABORTED="aborted",D.UNKNOWN="unknown"})(L||(L={}))},"./src/events.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"Events",function(){return I});var I;(function(L){L.MEDIA_ATTACHING="hlsMediaAttaching",L.MEDIA_ATTACHED="hlsMediaAttached",L.MEDIA_DETACHING="hlsMediaDetaching",L.MEDIA_DETACHED="hlsMediaDetached",L.BUFFER_RESET="hlsBufferReset",L.BUFFER_CODECS="hlsBufferCodecs",L.BUFFER_CREATED="hlsBufferCreated",L.BUFFER_APPENDING="hlsBufferAppending",L.BUFFER_APPENDED="hlsBufferAppended",L.BUFFER_EOS="hlsBufferEos",L.BUFFER_FLUSHING="hlsBufferFlushing",L.BUFFER_FLUSHED="hlsBufferFlushed",L.MANIFEST_LOADING="hlsManifestLoading",L.MANIFEST_LOADED="hlsManifestLoaded",L.MANIFEST_PARSED="hlsManifestParsed",L.LEVEL_SWITCHING="hlsLevelSwitching",L.LEVEL_SWITCHED="hlsLevelSwitched",L.LEVEL_LOADING="hlsLevelLoading",L.LEVEL_LOADED="hlsLevelLoaded",L.LEVEL_UPDATED="hlsLevelUpdated",L.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",L.LEVELS_UPDATED="hlsLevelsUpdated",L.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",L.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",L.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",L.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",L.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",L.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",L.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",L.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",L.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",L.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",L.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",L.CUES_PARSED="hlsCuesParsed",L.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",L.INIT_PTS_FOUND="hlsInitPtsFound",L.FRAG_LOADING="hlsFragLoading",L.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",L.FRAG_LOADED="hlsFragLoaded",L.FRAG_DECRYPTED="hlsFragDecrypted",L.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",L.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",L.FRAG_PARSING_METADATA="hlsFragParsingMetadata",L.FRAG_PARSED="hlsFragParsed",L.FRAG_BUFFERED="hlsFragBuffered",L.FRAG_CHANGED="hlsFragChanged",L.FPS_DROP="hlsFpsDrop",L.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",L.ERROR="hlsError",L.DESTROYING="hlsDestroying",L.KEY_LOADING="hlsKeyLoading",L.KEY_LOADED="hlsKeyLoaded",L.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",L.BACK_BUFFER_REACHED="hlsBackBufferReached"})(I||(I={}))},"./src/hls.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return s});var I=m("./node_modules/url-toolkit/src/url-toolkit.js"),L=m.n(I),D=m("./src/loader/playlist-loader.ts"),M=m("./src/loader/key-loader.ts"),R=m("./src/controller/id3-track-controller.ts"),O=m("./src/controller/latency-controller.ts"),A=m("./src/controller/level-controller.ts"),u=m("./src/controller/fragment-tracker.ts"),y=m("./src/controller/stream-controller.ts"),E=m("./src/is-supported.ts"),p=m("./src/utils/logger.ts"),T=m("./src/config.ts"),_=m("./node_modules/eventemitter3/index.js"),n=m.n(_),e=m("./src/events.ts"),t=m("./src/errors.ts");function a(d,g){for(var v=0;v<g.length;v++){var l=g[v];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(d,l.key,l)}}function f(d,g,v){return g&&a(d.prototype,g),v&&a(d,v),d}var s=function(){d.isSupported=function(){return Object(E.isSupported)()};function d(v){v===void 0&&(v={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new _.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var l=this.config=Object(T.mergeConfig)(d.DefaultConfig,v);this.userConfig=v,Object(p.enableLogs)(l.debug),this._autoLevelCapping=-1,l.progressive&&Object(T.enableStreamingMode)(l);var o=l.abrController,r=l.bufferController,i=l.capLevelController,h=l.fpsController,c=this.abrController=new o(this),S=this.bufferController=new r(this),P=this.capLevelController=new i(this),C=new h(this),x=new D.default(this),B=new M.default(this),F=new R.default(this),U=this.levelController=new A.default(this),w=new u.FragmentTracker(this),k=this.streamController=new y.default(this,w);P.setStreamController(k),C.setStreamController(k);var K=[U,k];this.networkControllers=K;var N=[x,B,c,S,P,C,F,w];this.audioTrackController=this.createController(l.audioTrackController,null,K),this.createController(l.audioStreamController,w,K),this.subtitleTrackController=this.createController(l.subtitleTrackController,null,K),this.createController(l.subtitleStreamController,w,K),this.createController(l.timelineController,null,N),this.emeController=this.createController(l.emeController,null,N),this.latencyController=this.createController(O.default,null,N),this.coreComponents=N}var g=d.prototype;return g.createController=function(l,o,r){if(l){var i=o?new l(this,o):new l(this);return r&&r.push(i),i}return null},g.on=function(l,o,r){r===void 0&&(r=this),this._emitter.on(l,o,r)},g.once=function(l,o,r){r===void 0&&(r=this),this._emitter.once(l,o,r)},g.removeAllListeners=function(l){this._emitter.removeAllListeners(l)},g.off=function(l,o,r,i){r===void 0&&(r=this),this._emitter.off(l,o,r,i)},g.listeners=function(l){return this._emitter.listeners(l)},g.emit=function(l,o,r){return this._emitter.emit(l,o,r)},g.trigger=function(l,o){if(this.config.debug)return this.emit(l,l,o);try{return this.emit(l,l,o)}catch(r){p.logger.error("An internal error happened while handling event "+l+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(e.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:l,error:r})}return!1},g.listenerCount=function(l){return this._emitter.listenerCount(l)},g.destroy=function(){p.logger.log("destroy"),this.trigger(e.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(l){return l.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(l){return l.destroy()}),this.coreComponents.length=0},g.attachMedia=function(l){p.logger.log("attachMedia"),this._media=l,this.trigger(e.Events.MEDIA_ATTACHING,{media:l})},g.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(e.Events.MEDIA_DETACHING,void 0),this._media=null},g.loadSource=function(l){this.stopLoad();var o=this.media,r=this.url,i=this.url=I.buildAbsoluteURL(self.location.href,l,{alwaysNormalize:!0});p.logger.log("loadSource:"+i),o&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(o)),this.trigger(e.Events.MANIFEST_LOADING,{url:l})},g.startLoad=function(l){l===void 0&&(l=-1),p.logger.log("startLoad("+l+")"),this.networkControllers.forEach(function(o){o.startLoad(l)})},g.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(l){l.stopLoad()})},g.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},g.recoverMediaError=function(){p.logger.log("recoverMediaError");var l=this._media;this.detachMedia(),l&&this.attachMedia(l)},g.removeLevel=function(l,o){o===void 0&&(o=0),this.levelController.removeLevel(l,o)},f(d,[{key:"levels",get:function(){var l=this.levelController.levels;return l||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(l){p.logger.log("set currentLevel:"+l),this.loadLevel=l,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(l){p.logger.log("set nextLevel:"+l),this.levelController.manualLevel=l,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(l){p.logger.log("set loadLevel:"+l),this.levelController.manualLevel=l}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(l){this.levelController.nextLoadLevel=l}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(l){p.logger.log("set firstLevel:"+l),this.levelController.firstLevel=l}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(l){p.logger.log("set startLevel:"+l),l!==-1&&(l=Math.max(l,this.minAutoLevel)),this.levelController.startLevel=l}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(l){var o=!!l;o!==this.config.capLevelToPlayerSize&&(o?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=o)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(l){this._autoLevelCapping!==l&&(p.logger.log("set autoLevelCapping:"+l),this._autoLevelCapping=l)}},{key:"bandwidthEstimate",get:function(){var l=this.abrController.bwEstimator;return l?l.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var l=this.levels,o=this.config.minAutoBitrate;if(!l)return 0;for(var r=l.length,i=0;i<r;i++)if(l[i].maxBitrate>o)return i;return 0}},{key:"maxAutoLevel",get:function(){var l=this.levels,o=this.autoLevelCapping,r;return o===-1&&l&&l.length?r=l.length-1:r=o,r}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(l){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,l)}},{key:"audioTracks",get:function(){var l=this.audioTrackController;return l?l.audioTracks:[]}},{key:"audioTrack",get:function(){var l=this.audioTrackController;return l?l.audioTrack:-1},set:function(l){var o=this.audioTrackController;o&&(o.audioTrack=l)}},{key:"subtitleTracks",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var l=this.subtitleTrackController;return l?l.subtitleTrack:-1},set:function(l){var o=this.subtitleTrackController;o&&(o.subtitleTrack=l)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var l=this.subtitleTrackController;return l?l.subtitleDisplay:!1},set:function(l){var o=this.subtitleTrackController;o&&(o.subtitleDisplay=l)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(l){this.config.lowLatencyMode=l}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.11"}},{key:"Events",get:function(){return e.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:T.hlsDefaultConfig},set:function(l){d.defaultConfig=l}}]),d}();s.defaultConfig=void 0},"./src/is-supported.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"isSupported",function(){return D}),m.d(b,"changeTypeSupported",function(){return M});var I=m("./src/utils/mediasource-helper.ts");function L(){return self.SourceBuffer||self.WebKitSourceBuffer}function D(){var R=Object(I.getMediaSource)();if(!R)return!1;var O=L(),A=R&&typeof R.isTypeSupported=="function"&&R.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),u=!O||O.prototype&&typeof O.prototype.appendBuffer=="function"&&typeof O.prototype.remove=="function";return!!A&&!!u}function M(){var R,O=L();return typeof(O==null||(R=O.prototype)===null||R===void 0?void 0:R.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return p}),m.d(b,"LoadError",function(){return _});var I=m("./src/polyfills/number.ts"),L=m("./src/errors.ts");function D(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,u(n,e)}function M(n){var e=typeof Map=="function"?new Map:void 0;return M=function(a){if(a===null||!A(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(a))return e.get(a);e.set(a,f)}function f(){return R(a,arguments,y(this).constructor)}return f.prototype=Object.create(a.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),u(f,a)},M(n)}function R(n,e,t){return O()?R=Reflect.construct:R=function(f,s,d){var g=[null];g.push.apply(g,s);var v=Function.bind.apply(f,g),l=new v;return d&&u(l,d.prototype),l},R.apply(null,arguments)}function O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function u(n,e){return u=Object.setPrototypeOf||function(a,f){return a.__proto__=f,a},u(n,e)}function y(n){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},y(n)}var E=Math.pow(2,17),p=function(){function n(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=n.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(a,f){var s=this,d=a.url;if(!d)return Promise.reject(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(d?"part list":"url")));this.abort();var g=this.config,v=g.fLoader,l=g.loader;return new Promise(function(o,r){s.loader&&s.loader.destroy();var i=s.loader=a.loader=v?new v(g):new l(g),h=T(a),c={timeout:g.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:g.fragLoadingMaxRetryTimeout,highWaterMark:E};a.stats=i.stats,i.load(h,c,{onSuccess:function(P,C,x,B){s.resetLoader(a,i),o({frag:a,part:null,payload:P.data,networkDetails:B})},onError:function(P,C,x){s.resetLoader(a,i),r(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:P,networkDetails:x}))},onAbort:function(P,C,x){s.resetLoader(a,i),r(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:x}))},onTimeout:function(P,C,x){s.resetLoader(a,i),r(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:x}))},onProgress:function(P,C,x,B){f&&f({frag:a,part:null,payload:x,networkDetails:B})}})})},e.loadPart=function(a,f,s){var d=this;this.abort();var g=this.config,v=g.fLoader,l=g.loader;return new Promise(function(o,r){d.loader&&d.loader.destroy();var i=d.loader=a.loader=v?new v(g):new l(g),h=T(a,f),c={timeout:g.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:g.fragLoadingMaxRetryTimeout,highWaterMark:E};f.stats=i.stats,i.load(h,c,{onSuccess:function(P,C,x,B){d.resetLoader(a,i),d.updateStatsFromPart(a,f);var F={frag:a,part:f,payload:P.data,networkDetails:B};s(F),o(F)},onError:function(P,C,x){d.resetLoader(a,i),r(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:f,response:P,networkDetails:x}))},onAbort:function(P,C,x){a.stats.aborted=f.stats.aborted,d.resetLoader(a,i),r(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:f,networkDetails:x}))},onTimeout:function(P,C,x){d.resetLoader(a,i),r(new _({type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:f,networkDetails:x}))}})})},e.updateStatsFromPart=function(a,f){var s=a.stats,d=f.stats,g=d.total;if(s.loaded+=d.loaded,g){var v=Math.round(a.duration/f.duration),l=Math.min(Math.round(s.loaded/g),v),o=v-l,r=o*Math.round(s.loaded/l);s.total=s.loaded+r}else s.total=Math.max(s.loaded,s.total);var i=s.loading,h=d.loading;i.start?i.first+=h.first-h.start:(i.start=h.start,i.first=h.first),i.end=h.end},e.resetLoader=function(a,f){a.loader=null,this.loader===f&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),f.destroy()},n}();function T(n,e){e===void 0&&(e=null);var t=e||n,a={frag:n,part:e,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},f=t.byteRangeStartOffset,s=t.byteRangeEndOffset;return Object(I.isFiniteNumber)(f)&&Object(I.isFiniteNumber)(s)&&(a.rangeStart=f,a.rangeEnd=s),a}var _=function(n){D(e,n);function e(t){for(var a,f=arguments.length,s=new Array(f>1?f-1:0),d=1;d<f;d++)s[d-1]=arguments[d];return a=n.call.apply(n,[this].concat(s))||this,a.data=void 0,a.data=t,a}return e}(M(Error))},"./src/loader/fragment.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"ElementaryStreamTypes",function(){return p}),m.d(b,"BaseSegment",function(){return T}),m.d(b,"Fragment",function(){return _}),m.d(b,"Part",function(){return n});var I=m("./src/polyfills/number.ts"),L=m("./node_modules/url-toolkit/src/url-toolkit.js"),D=m.n(L),M=m("./src/utils/logger.ts"),R=m("./src/loader/level-key.ts"),O=m("./src/loader/load-stats.ts");function A(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}function u(e,t){return u=Object.setPrototypeOf||function(f,s){return f.__proto__=s,f},u(e,t)}function y(e,t){for(var a=0;a<t.length;a++){var f=t[a];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(e,f.key,f)}}function E(e,t,a){return t&&y(e.prototype,t),a&&y(e,a),e}var p;(function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"})(p||(p={}));var T=function(){function e(a){var f;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(f={},f[p.AUDIO]=null,f[p.VIDEO]=null,f[p.AUDIOVIDEO]=null,f),this.baseurl=a}var t=e.prototype;return t.setByteRange=function(f,s){var d=f.split("@",2),g=[];d.length===1?g[0]=s?s.byteRangeEndOffset:0:g[0]=parseInt(d[1]),g[1]=parseInt(d[0])+g[0],this._byteRange=g},E(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(L.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(f){this._url=f}}]),e}(),_=function(e){A(t,e);function t(f,s){var d;return d=e.call(this,s)||this,d._decryptdata=null,d.rawProgramDateTime=null,d.programDateTime=null,d.tagList=[],d.duration=0,d.sn=0,d.levelkey=void 0,d.type=void 0,d.loader=null,d.level=-1,d.cc=0,d.startPTS=void 0,d.endPTS=void 0,d.appendedPTS=void 0,d.startDTS=void 0,d.endDTS=void 0,d.start=0,d.deltaPTS=void 0,d.maxStartPTS=void 0,d.minEndPTS=void 0,d.stats=new O.LoadStats,d.urlId=0,d.data=void 0,d.bitrateTest=!1,d.title=null,d.initSegment=null,d.type=f,d}var a=t.prototype;return a.createInitializationVector=function(s){for(var d=new Uint8Array(16),g=12;g<16;g++)d[g]=s>>8*(15-g)&255;return d},a.setDecryptDataFromLevelKey=function(s,d){var g=s;return(s==null?void 0:s.method)==="AES-128"&&s.uri&&!s.iv&&(g=R.LevelKey.fromURI(s.uri),g.method=s.method,g.iv=this.createInitializationVector(d),g.keyFormat="identity"),g},a.setElementaryStreamInfo=function(s,d,g,v,l,o){o===void 0&&(o=!1);var r=this.elementaryStreams,i=r[s];if(!i){r[s]={startPTS:d,endPTS:g,startDTS:v,endDTS:l,partial:o};return}i.startPTS=Math.min(i.startPTS,d),i.endPTS=Math.max(i.endPTS,g),i.startDTS=Math.min(i.startDTS,v),i.endDTS=Math.max(i.endDTS,l)},a.clearElementaryStreamInfo=function(){var s=this.elementaryStreams;s[p.AUDIO]=null,s[p.VIDEO]=null,s[p.AUDIOVIDEO]=null},E(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var s=this.sn;typeof s!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&M.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),s=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,s)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(I.isFiniteNumber)(this.programDateTime))return null;var s=Object(I.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+s*1e3}},{key:"encrypted",get:function(){var s;return!!((s=this.decryptdata)!==null&&s!==void 0&&s.keyFormat&&this.decryptdata.uri)}}]),t}(T),n=function(e){A(t,e);function t(a,f,s,d,g){var v;v=e.call(this,s)||this,v.fragOffset=0,v.duration=0,v.gap=!1,v.independent=!1,v.relurl=void 0,v.fragment=void 0,v.index=void 0,v.stats=new O.LoadStats,v.duration=a.decimalFloatingPoint("DURATION"),v.gap=a.bool("GAP"),v.independent=a.bool("INDEPENDENT"),v.relurl=a.enumeratedString("URI"),v.fragment=f,v.index=d;var l=a.enumeratedString("BYTERANGE");return l&&v.setByteRange(l,g),g&&(v.fragOffset=g.fragOffset+g.duration),v}return E(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var f=this.elementaryStreams;return!!(f.audio||f.video||f.audiovideo)}}]),t}(T)},"./src/loader/key-loader.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return M});var I=m("./src/events.ts"),L=m("./src/errors.ts"),D=m("./src/utils/logger.ts"),M=function(){function R(A){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=A,this._registerListeners()}var O=R.prototype;return O._registerListeners=function(){this.hls.on(I.Events.KEY_LOADING,this.onKeyLoading,this)},O._unregisterListeners=function(){this.hls.off(I.Events.KEY_LOADING,this.onKeyLoading)},O.destroy=function(){this._unregisterListeners();for(var u in this.loaders){var y=this.loaders[u];y&&y.destroy()}this.loaders={}},O.onKeyLoading=function(u,y){var E=y.frag,p=E.type,T=this.loaders[p];if(!E.decryptdata){D.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var _=E.decryptdata.uri;if(_!==this.decrypturl||this.decryptkey===null){var n=this.hls.config;if(T&&(D.logger.warn("abort previous key loader for type:"+p),T.abort()),!_){D.logger.warn("key uri is falsy");return}var e=n.loader,t=E.loader=this.loaders[p]=new e(n);this.decrypturl=_,this.decryptkey=null;var a={url:_,frag:E,responseType:"arraybuffer"},f={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.load(a,f,s)}else this.decryptkey&&(E.decryptdata.key=this.decryptkey,this.hls.trigger(I.Events.KEY_LOADED,{frag:E}))},O.loadsuccess=function(u,y,E){var p=E.frag;if(!p.decryptdata){D.logger.error("after key load, decryptdata unset");return}this.decryptkey=p.decryptdata.key=new Uint8Array(u.data),p.loader=null,delete this.loaders[p.type],this.hls.trigger(I.Events.KEY_LOADED,{frag:p})},O.loaderror=function(u,y){var E=y.frag,p=E.loader;p&&p.abort(),delete this.loaders[E.type],this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:E,response:u})},O.loadtimeout=function(u,y){var E=y.frag,p=E.loader;p&&p.abort(),delete this.loaders[E.type],this.hls.trigger(I.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:E})},R}()},"./src/loader/level-details.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"LevelDetails",function(){return R});var I=m("./src/polyfills/number.ts");function L(O,A){for(var u=0;u<A.length;u++){var y=A[u];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(O,y.key,y)}}function D(O,A,u){return A&&L(O.prototype,A),u&&L(O,u),O}var M=10,R=function(){function O(u){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=u}var A=O.prototype;return A.reloaded=function(y){if(!y){this.advanced=!0,this.updated=!0;return}var E=this.lastPartSn-y.lastPartSn,p=this.lastPartIndex-y.lastPartIndex;this.updated=this.endSN!==y.endSN||!!p||!!E,this.advanced=this.endSN>y.endSN||E>0||E===0&&p>0,this.updated||this.advanced?this.misses=Math.floor(y.misses*.6):this.misses=y.misses+1,this.availabilityDelay=y.availabilityDelay},D(O,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(I.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||M}},{key:"drift",get:function(){var y=this.driftEndTime-this.driftStartTime;if(y>0){var E=this.driftEnd-this.driftStart;return E*1e3/y}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var y;return(y=this.fragments)!==null&&y!==void 0&&y.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var y;return(y=this.partList)!==null&&y!==void 0&&y.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),O}()},"./src/loader/level-key.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"LevelKey",function(){return R});var I=m("./node_modules/url-toolkit/src/url-toolkit.js"),L=m.n(I);function D(O,A){for(var u=0;u<A.length;u++){var y=A[u];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(O,y.key,y)}}function M(O,A,u){return A&&D(O.prototype,A),u&&D(O,u),O}var R=function(){O.fromURL=function(u,y){return new O(u,y)},O.fromURI=function(u){return new O(u)};function O(A,u){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,u?this._uri=Object(I.buildAbsoluteURL)(A,u,{alwaysNormalize:!0}):this._uri=A}return M(O,[{key:"uri",get:function(){return this._uri}}]),O}()},"./src/loader/load-stats.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"LoadStats",function(){return I});var I=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return t});var I=m("./src/polyfills/number.ts"),L=m("./node_modules/url-toolkit/src/url-toolkit.js"),D=m.n(L),M=m("./src/loader/fragment.ts"),R=m("./src/loader/level-details.ts"),O=m("./src/loader/level-key.ts"),A=m("./src/utils/attr-list.ts"),u=m("./src/utils/logger.ts"),y=m("./src/utils/codecs.ts"),E=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,p=/#EXT-X-MEDIA:(.*)/g,T=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),_=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),n=/\.(mp4|m4s|m4v|m4a)$/i;function e(g){var v,l;return n.test((v=(l=L.parseURL(g))===null||l===void 0?void 0:l.path)!=null?v:"")}var t=function(){function g(){}return g.findGroup=function(l,o){for(var r=0;r<l.length;r++){var i=l[r];if(i.id===o)return i}},g.convertAVC1ToAVCOTI=function(l){var o=l.split(".");if(o.length>2){var r=o.shift()+".";return r+=parseInt(o.shift()).toString(16),r+=("000"+parseInt(o.shift()).toString(16)).substr(-4),r}return l},g.resolve=function(l,o){return L.buildAbsoluteURL(o,l,{alwaysNormalize:!0})},g.parseMasterPlaylist=function(l,o){var r=[],i={},h=!1;E.lastIndex=0;for(var c;(c=E.exec(l))!=null;)if(c[1]){var S=new A.AttrList(c[1]),P={attrs:S,bitrate:S.decimalInteger("AVERAGE-BANDWIDTH")||S.decimalInteger("BANDWIDTH"),name:S.NAME,url:g.resolve(c[2],o)},C=S.decimalResolution("RESOLUTION");C&&(P.width=C.width,P.height=C.height),a((S.CODECS||"").split(/[ ,]+/).filter(function(B){return B}),P),P.videoCodec&&P.videoCodec.indexOf("avc1")!==-1&&(P.videoCodec=g.convertAVC1ToAVCOTI(P.videoCodec)),r.push(P)}else if(c[3]){var x=new A.AttrList(c[3]);x["DATA-ID"]&&(h=!0,i[x["DATA-ID"]]=x)}return{levels:r,sessionData:h?i:null}},g.parseMasterPlaylistMedia=function(l,o,r,i){i===void 0&&(i=[]);var h,c=[],S=0;for(p.lastIndex=0;(h=p.exec(l))!==null;){var P=new A.AttrList(h[1]);if(P.TYPE===r){var C={attrs:P,bitrate:0,id:S++,groupId:P["GROUP-ID"],instreamId:P["INSTREAM-ID"],name:P.NAME||P.LANGUAGE||"",type:r,default:P.bool("DEFAULT"),autoselect:P.bool("AUTOSELECT"),forced:P.bool("FORCED"),lang:P.LANGUAGE,url:P.URI?g.resolve(P.URI,o):""};if(i.length){var x=g.findGroup(i,C.groupId)||i[0];f(C,x,"audioCodec"),f(C,x,"textCodec")}c.push(C)}}return c},g.parseLevelPlaylist=function(l,o,r,i,h){var c=new R.LevelDetails(o),S=c.fragments,P=null,C=0,x=0,B=0,F=0,U=null,w=new M.Fragment(i,o),k,K,N,G=-1,H=!1;for(T.lastIndex=0,c.m3u8=l;(k=T.exec(l))!==null;){H&&(H=!1,w=new M.Fragment(i,o),w.start=B,w.sn=C,w.cc=F,w.level=r,P&&(w.initSegment=P,w.rawProgramDateTime=P.rawProgramDateTime));var V=k[1];if(V){w.duration=parseFloat(V);var z=(" "+k[2]).slice(1);w.title=z||null,w.tagList.push(z?["INF",V,z]:["INF",V])}else if(k[3])Object(I.isFiniteNumber)(w.duration)&&(w.start=B,N&&(w.levelkey=N),w.sn=C,w.level=r,w.cc=F,w.urlId=h,S.push(w),w.relurl=(" "+k[3]).slice(1),d(w,U),U=w,B+=w.duration,C++,x=0,H=!0);else if(k[4]){var Q=(" "+k[4]).slice(1);U?w.setByteRange(Q,U):w.setByteRange(Q)}else if(k[5])w.rawProgramDateTime=(" "+k[5]).slice(1),w.tagList.push(["PROGRAM-DATE-TIME",w.rawProgramDateTime]),G===-1&&(G=S.length);else{if(k=k[0].match(_),!k){u.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<k.length&&typeof k[K]=="undefined";K++);var q=(" "+k[K]).slice(1),J=(" "+k[K+1]).slice(1),te=k[K+2]?(" "+k[K+2]).slice(1):"";switch(q){case"PLAYLIST-TYPE":c.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":C=c.startSN=parseInt(J);break;case"SKIP":{var ue=new A.AttrList(J),$=ue.decimalInteger("SKIPPED-SEGMENTS");if(Object(I.isFiniteNumber)($)){c.skippedSegments=$;for(var Z=$;Z--;)S.unshift(null);C+=$}var Y=ue.enumeratedString("RECENTLY-REMOVED-DATERANGES");Y&&(c.recentlyRemovedDateranges=Y.split("	"));break}case"TARGETDURATION":c.targetduration=parseFloat(J);break;case"VERSION":c.version=parseInt(J);break;case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(J||te)&&w.tagList.push(te?[J,te]:[J]);break;case"DIS":F++;case"GAP":w.tagList.push([q]);break;case"BITRATE":w.tagList.push([q,J]);break;case"DISCONTINUITY-SEQ":F=parseInt(J);break;case"KEY":{var X,ie=new A.AttrList(J),le=ie.enumeratedString("METHOD"),oe=ie.URI,de=ie.hexadecimalInteger("IV"),fe=ie.enumeratedString("KEYFORMATVERSIONS"),se=ie.enumeratedString("KEYID"),re=(X=ie.enumeratedString("KEYFORMAT"))!=null?X:"identity",ae=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(ae.indexOf(re)>-1){u.logger.warn("Keyformat "+re+" is not supported from the manifest");continue}else if(re!=="identity")continue;le&&(N=O.LevelKey.fromURL(o,oe),oe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(le)>=0&&(N.method=le,N.keyFormat=re,se&&(N.keyID=se),fe&&(N.keyFormatVersions=fe),N.iv=de));break}case"START":{var pe=new A.AttrList(J),ge=pe.decimalFloatingPoint("TIME-OFFSET");Object(I.isFiniteNumber)(ge)&&(c.startTimeOffset=ge);break}case"MAP":{var Ee=new A.AttrList(J);w.relurl=Ee.URI,Ee.BYTERANGE&&w.setByteRange(Ee.BYTERANGE),w.level=r,w.sn="initSegment",N&&(w.levelkey=N),w.initSegment=null,P=w,H=!0;break}case"SERVER-CONTROL":{var ce=new A.AttrList(J);c.canBlockReload=ce.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=ce.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&ce.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=ce.optionalFloat("PART-HOLD-BACK",0),c.holdBack=ce.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Se=new A.AttrList(J);c.partTarget=Se.decimalFloatingPoint("PART-TARGET");break}case"PART":{var he=c.partList;he||(he=c.partList=[]);var me=x>0?he[he.length-1]:void 0,De=x++,ye=new M.Part(new A.AttrList(J),w,o,De,me);he.push(ye),w.duration+=ye.duration;break}case"PRELOAD-HINT":{var Te=new A.AttrList(J);c.preloadHint=Te;break}case"RENDITION-REPORT":{var Re=new A.AttrList(J);c.renditionReports=c.renditionReports||[],c.renditionReports.push(Re);break}default:u.logger.warn("line parsed but not handled: "+k);break}}}U&&!U.relurl?(S.pop(),B-=U.duration,c.partList&&(c.fragmentHint=U)):c.partList&&(d(w,U),w.cc=F,c.fragmentHint=w);var _e=S.length,ve=S[0],Ae=S[_e-1];if(B+=c.skippedSegments*c.targetduration,B>0&&_e&&Ae){c.averagetargetduration=B/_e;var Pe=Ae.sn;c.endSN=Pe!=="initSegment"?Pe:0,ve&&(c.startCC=ve.cc,ve.initSegment||c.fragments.every(function(Le){return Le.relurl&&e(Le.relurl)})&&(u.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),w=new M.Fragment(i,o),w.relurl=Ae.relurl,w.level=r,w.sn="initSegment",ve.initSegment=w,c.needSidxRanges=!0))}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(B+=c.fragmentHint.duration),c.totalduration=B,c.endCC=F,G>0&&s(S,G),c},g}();function a(g,v){["video","audio","text"].forEach(function(l){var o=g.filter(function(i){return Object(y.isCodecType)(i,l)});if(o.length){var r=o.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});v[l+"Codec"]=r.length>0?r[0]:o[0],g=g.filter(function(i){return o.indexOf(i)===-1})}}),v.unknownCodecs=g}function f(g,v,l){var o=v[l];o&&(g[l]=o)}function s(g,v){for(var l=g[v],o=v;o--;){var r=g[o];if(!r)return;r.programDateTime=l.programDateTime-r.duration*1e3,l=r}}function d(g,v){g.rawProgramDateTime?g.programDateTime=Date.parse(g.rawProgramDateTime):v!=null&&v.programDateTime&&(g.programDateTime=v.endProgramDateTime),Object(I.isFiniteNumber)(g.programDateTime)||(g.programDateTime=null,g.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/polyfills/number.ts"),L=m("./src/events.ts"),D=m("./src/errors.ts"),M=m("./src/utils/logger.ts"),R=m("./src/utils/mp4-tools.ts"),O=m("./src/loader/m3u8-parser.ts"),A=m("./src/types/loader.ts"),u=m("./src/utils/attr-list.ts");function y(T){var _=T.type;switch(_){case A.PlaylistContextType.AUDIO_TRACK:return A.PlaylistLevelType.AUDIO;case A.PlaylistContextType.SUBTITLE_TRACK:return A.PlaylistLevelType.SUBTITLE;default:return A.PlaylistLevelType.MAIN}}function E(T,_){var n=T.url;return(n===void 0||n.indexOf("data:")===0)&&(n=_.url),n}var p=function(){function T(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var _=T.prototype;return _.registerListeners=function(){var e=this.hls;e.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},_.unregisterListeners=function(){var e=this.hls;e.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},_.createInternalLoader=function(e){var t=this.hls.config,a=t.pLoader,f=t.loader,s=a||f,d=new s(t);return e.loader=d,this.loaders[e.type]=d,d},_.getInternalLoader=function(e){return this.loaders[e.type]},_.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},_.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},_.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},_.onManifestLoading=function(e,t){var a=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:A.PlaylistContextType.MANIFEST,url:a,deliveryDirectives:null})},_.onLevelLoading=function(e,t){var a=t.id,f=t.level,s=t.url,d=t.deliveryDirectives;this.load({id:a,groupId:null,level:f,responseType:"text",type:A.PlaylistContextType.LEVEL,url:s,deliveryDirectives:d})},_.onAudioTrackLoading=function(e,t){var a=t.id,f=t.groupId,s=t.url,d=t.deliveryDirectives;this.load({id:a,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:d})},_.onSubtitleTrackLoading=function(e,t){var a=t.id,f=t.groupId,s=t.url,d=t.deliveryDirectives;this.load({id:a,groupId:f,level:null,responseType:"text",type:A.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:d})},_.load=function(e){var t,a=this.hls.config,f=this.getInternalLoader(e);if(f){var s=f.context;if(s&&s.url===e.url){M.logger.trace("[playlist-loader]: playlist request ongoing");return}M.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),f.abort()}var d,g,v,l;switch(e.type){case A.PlaylistContextType.MANIFEST:d=a.manifestLoadingMaxRetry,g=a.manifestLoadingTimeOut,v=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout;break;case A.PlaylistContextType.LEVEL:case A.PlaylistContextType.AUDIO_TRACK:case A.PlaylistContextType.SUBTITLE_TRACK:d=0,g=a.levelLoadingTimeOut;break;default:d=a.levelLoadingMaxRetry,g=a.levelLoadingTimeOut,v=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout;break}if(f=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part){var o;if(e.type===A.PlaylistContextType.LEVEL&&e.level!==null?o=this.hls.levels[e.level].details:e.type===A.PlaylistContextType.AUDIO_TRACK&&e.id!==null?o=this.hls.audioTracks[e.id].details:e.type===A.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(o=this.hls.subtitleTracks[e.id].details),o){var r=o.partTarget,i=o.targetduration;r&&i&&(g=Math.min(Math.max(r*3,i*.8)*1e3,g))}}var h={timeout:g,maxRetry:d,retryDelay:v,maxRetryDelay:l,highWaterMark:0},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};f.load(e,h,c)},_.loadsuccess=function(e,t,a,f){if(f===void 0&&(f=null),a.isSidxRequest){this.handleSidxRequest(e,a),this.handlePlaylistLoaded(e,t,a,f);return}this.resetInternalLoader(a.type);var s=e.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,a,"no EXTM3U delimiter",f);return}t.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,a,f):this.handleMasterPlaylist(e,t,a,f)},_.loaderror=function(e,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!1,e)},_.loadtimeout=function(e,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!0)},_.handleMasterPlaylist=function(e,t,a,f){var s=this.hls,d=e.data,g=E(e,a),v=O.default.parseMasterPlaylist(d,g),l=v.levels,o=v.sessionData;if(!l.length){this.handleManifestParsingError(e,a,"no level found in manifest",f);return}var r=l.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),i=l.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),h=O.default.parseMasterPlaylistMedia(d,g,"AUDIO",r),c=O.default.parseMasterPlaylistMedia(d,g,"SUBTITLES",i),S=O.default.parseMasterPlaylistMedia(d,g,"CLOSED-CAPTIONS");if(h.length){var P=h.some(function(C){return!C.url});!P&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(M.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new u.AttrList({}),bitrate:0,url:""}))}s.trigger(L.Events.MANIFEST_LOADED,{levels:l,audioTracks:h,subtitles:c,captions:S,url:g,stats:t,networkDetails:f,sessionData:o})},_.handleTrackOrLevelPlaylist=function(e,t,a,f){var s=this.hls,d=a.id,g=a.level,v=a.type,l=E(e,a),o=Object(I.isFiniteNumber)(d)?d:0,r=Object(I.isFiniteNumber)(g)?g:o,i=y(a),h=O.default.parseLevelPlaylist(e.data,l,r,i,o);if(!h.fragments.length){s.trigger(L.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:l,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0});return}if(v===A.PlaylistContextType.MANIFEST){var c={attrs:new u.AttrList({}),bitrate:0,details:h,name:"",url:l};s.trigger(L.Events.MANIFEST_LOADED,{levels:[c],audioTracks:[],url:l,stats:t,networkDetails:f,sessionData:null})}if(t.parsing.end=performance.now(),h.needSidxRanges){var S,P=(S=h.fragments[0].initSegment)===null||S===void 0?void 0:S.url;this.load({url:P,isSidxRequest:!0,type:v,level:g,levelDetails:h,id:d,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}a.levelDetails=h,this.handlePlaylistLoaded(e,t,a,f)},_.handleSidxRequest=function(e,t){var a=Object(R.parseSegmentIndex)(new Uint8Array(e.data));if(!!a){var f=a.references,s=t.levelDetails;f.forEach(function(d,g){var v=d.info,l=s.fragments[g];l.byteRange.length===0&&l.setByteRange(String(1+v.end-v.start)+"@"+String(v.start)),l.initSegment&&l.initSegment.setByteRange(String(a.moovEndOffset)+"@0")})}},_.handleManifestParsingError=function(e,t,a,f){this.hls.trigger(L.Events.ERROR,{type:D.ErrorTypes.NETWORK_ERROR,details:D.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===A.PlaylistContextType.MANIFEST,url:e.url,reason:a,response:e,context:t,networkDetails:f})},_.handleNetworkError=function(e,t,a,f){a===void 0&&(a=!1),M.logger.warn("[playlist-loader]: A network "+(a?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=D.ErrorDetails.UNKNOWN,d=!1,g=this.getInternalLoader(e);switch(e.type){case A.PlaylistContextType.MANIFEST:s=a?D.ErrorDetails.MANIFEST_LOAD_TIMEOUT:D.ErrorDetails.MANIFEST_LOAD_ERROR,d=!0;break;case A.PlaylistContextType.LEVEL:s=a?D.ErrorDetails.LEVEL_LOAD_TIMEOUT:D.ErrorDetails.LEVEL_LOAD_ERROR,d=!1;break;case A.PlaylistContextType.AUDIO_TRACK:s=a?D.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:D.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,d=!1;break;case A.PlaylistContextType.SUBTITLE_TRACK:s=a?D.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:D.ErrorDetails.SUBTITLE_LOAD_ERROR,d=!1;break}g&&this.resetInternalLoader(e.type);var v={type:D.ErrorTypes.NETWORK_ERROR,details:s,fatal:d,url:e.url,loader:g,context:e,networkDetails:t};f&&(v.response=f),this.hls.trigger(L.Events.ERROR,v)},_.handlePlaylistLoaded=function(e,t,a,f){var s=a.type,d=a.level,g=a.id,v=a.groupId,l=a.loader,o=a.levelDetails,r=a.deliveryDirectives;if(!(o!=null&&o.targetduration)){this.handleManifestParsingError(e,a,"invalid target duration",f);return}if(!!l)switch(o.live&&(l.getCacheAge&&(o.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(o.ageHeader))&&(o.ageHeader=0)),s){case A.PlaylistContextType.MANIFEST:case A.PlaylistContextType.LEVEL:this.hls.trigger(L.Events.LEVEL_LOADED,{details:o,level:d||0,id:g||0,stats:t,networkDetails:f,deliveryDirectives:r});break;case A.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(L.Events.AUDIO_TRACK_LOADED,{details:o,id:g||0,groupId:v||"",stats:t,networkDetails:f,deliveryDirectives:r});break;case A.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(L.Events.SUBTITLE_TRACK_LOADED,{details:o,id:g||0,groupId:v||"",stats:t,networkDetails:f,deliveryDirectives:r});break}},T}();b.default=p},"./src/polyfills/number.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"isFiniteNumber",function(){return I}),m.d(b,"MAX_SAFE_INTEGER",function(){return L});var I=Number.isFinite||function(D){return typeof D=="number"&&isFinite(D)},L=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(W,b,m){"use strict";m.r(b);var I=function(){function L(){}return L.getSilentFrame=function(M,R){switch(M){case"mp4a.40.2":if(R===1)return new Uint8Array([0,200,0,128,35,128]);if(R===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(R===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(R===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(R===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(R===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(R===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(R===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},L}();b.default=I},"./src/remux/mp4-generator.ts":function(W,b,m){"use strict";m.r(b);var I=Math.pow(2,32)-1,L=function(){function D(){}return D.init=function(){D.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var R;for(R in D.types)D.types.hasOwnProperty(R)&&(D.types[R]=[R.charCodeAt(0),R.charCodeAt(1),R.charCodeAt(2),R.charCodeAt(3)]);var O=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),A=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:O,audio:A};var u=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),y=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=y,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var E=new Uint8Array([105,115,111,109]),p=new Uint8Array([97,118,99,49]),T=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,E,T,E,p),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,u))},D.box=function(R){for(var O=8,A=arguments.length,u=new Array(A>1?A-1:0),y=1;y<A;y++)u[y-1]=arguments[y];for(var E=u.length,p=E;E--;)O+=u[E].byteLength;var T=new Uint8Array(O);for(T[0]=O>>24&255,T[1]=O>>16&255,T[2]=O>>8&255,T[3]=O&255,T.set(R,4),E=0,O=8;E<p;E++)T.set(u[E],O),O+=u[E].byteLength;return T},D.hdlr=function(R){return D.box(D.types.hdlr,D.HDLR_TYPES[R])},D.mdat=function(R){return D.box(D.types.mdat,R)},D.mdhd=function(R,O){O*=R;var A=Math.floor(O/(I+1)),u=Math.floor(O%(I+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,u>>24,u>>16&255,u>>8&255,u&255,85,196,0,0]))},D.mdia=function(R){return D.box(D.types.mdia,D.mdhd(R.timescale,R.duration),D.hdlr(R.type),D.minf(R))},D.mfhd=function(R){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255]))},D.minf=function(R){return R.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(R)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(R))},D.moof=function(R,O,A){return D.box(D.types.moof,D.mfhd(R),D.traf(A,O))},D.moov=function(R){for(var O=R.length,A=[];O--;)A[O]=D.trak(R[O]);return D.box.apply(null,[D.types.moov,D.mvhd(R[0].timescale,R[0].duration)].concat(A).concat(D.mvex(R)))},D.mvex=function(R){for(var O=R.length,A=[];O--;)A[O]=D.trex(R[O]);return D.box.apply(null,[D.types.mvex].concat(A))},D.mvhd=function(R,O){O*=R;var A=Math.floor(O/(I+1)),u=Math.floor(O%(I+1)),y=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,A>>24,A>>16&255,A>>8&255,A&255,u>>24,u>>16&255,u>>8&255,u&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,y)},D.sdtp=function(R){var O=R.samples||[],A=new Uint8Array(4+O.length),u,y;for(u=0;u<O.length;u++)y=O[u].flags,A[u+4]=y.dependsOn<<4|y.isDependedOn<<2|y.hasRedundancy;return D.box(D.types.sdtp,A)},D.stbl=function(R){return D.box(D.types.stbl,D.stsd(R),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))},D.avc1=function(R){var O=[],A=[],u,y,E;for(u=0;u<R.sps.length;u++)y=R.sps[u],E=y.byteLength,O.push(E>>>8&255),O.push(E&255),O=O.concat(Array.prototype.slice.call(y));for(u=0;u<R.pps.length;u++)y=R.pps[u],E=y.byteLength,A.push(E>>>8&255),A.push(E&255),A=A.concat(Array.prototype.slice.call(y));var p=D.box(D.types.avcC,new Uint8Array([1,O[3],O[4],O[5],252|3,224|R.sps.length].concat(O).concat([R.pps.length]).concat(A))),T=R.width,_=R.height,n=R.pixelRatio[0],e=R.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,T>>8&255,T&255,_>>8&255,_&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),p,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255])))},D.esds=function(R){var O=R.config.length;return new Uint8Array([0,0,0,0,3,23+O,0,1,0,4,15+O,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([O]).concat(R.config).concat([6,1,2]))},D.mp4a=function(R){var O=R.samplerate;return D.box(D.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]),D.box(D.types.esds,D.esds(R)))},D.mp3=function(R){var O=R.samplerate;return D.box(D.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,R.channelCount,0,16,0,0,0,0,O>>8&255,O&255,0,0]))},D.stsd=function(R){return R.type==="audio"?!R.isAAC&&R.codec==="mp3"?D.box(D.types.stsd,D.STSD,D.mp3(R)):D.box(D.types.stsd,D.STSD,D.mp4a(R)):D.box(D.types.stsd,D.STSD,D.avc1(R))},D.tkhd=function(R){var O=R.id,A=R.duration*R.timescale,u=R.width,y=R.height,E=Math.floor(A/(I+1)),p=Math.floor(A%(I+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,O>>24&255,O>>16&255,O>>8&255,O&255,0,0,0,0,E>>24,E>>16&255,E>>8&255,E&255,p>>24,p>>16&255,p>>8&255,p&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,u>>8&255,u&255,0,0,y>>8&255,y&255,0,0]))},D.traf=function(R,O){var A=D.sdtp(R),u=R.id,y=Math.floor(O/(I+1)),E=Math.floor(O%(I+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,u>>24,u>>16&255,u>>8&255,u&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,E>>24,E>>16&255,E>>8&255,E&255])),D.trun(R,A.length+16+20+8+16+8+8),A)},D.trak=function(R){return R.duration=R.duration||4294967295,D.box(D.types.trak,D.tkhd(R),D.mdia(R))},D.trex=function(R){var O=R.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,O>>24,O>>16&255,O>>8&255,O&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},D.trun=function(R,O){var A=R.samples||[],u=A.length,y=12+16*u,E=new Uint8Array(y),p,T,_,n,e,t;for(O+=8+y,E.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,u&255,O>>>24&255,O>>>16&255,O>>>8&255,O&255],0),p=0;p<u;p++)T=A[p],_=T.duration,n=T.size,e=T.flags,t=T.cts,E.set([_>>>24&255,_>>>16&255,_>>>8&255,_&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,t>>>24&255,t>>>16&255,t>>>8&255,t&255],12+16*p);return D.box(D.types.trun,E)},D.initSegment=function(R){D.types||D.init();var O=D.moov(R),A=new Uint8Array(D.FTYP.byteLength+O.byteLength);return A.set(D.FTYP),A.set(O,D.FTYP.byteLength),A},D}();L.types=void 0,L.HDLR_TYPES=void 0,L.STTS=void 0,L.STSC=void 0,L.STCO=void 0,L.STSZ=void 0,L.VMHD=void 0,L.SMHD=void 0,L.STSD=void 0,L.FTYP=void 0,L.DINF=void 0,b.default=L},"./src/remux/mp4-remuxer.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return t}),m.d(b,"normalizePts",function(){return a});var I=m("./src/polyfills/number.ts"),L=m("./src/remux/aac-helper.ts"),D=m("./src/remux/mp4-generator.ts"),M=m("./src/events.ts"),R=m("./src/errors.ts"),O=m("./src/utils/logger.ts"),A=m("./src/types/loader.ts"),u=m("./src/utils/timescale-conversion.ts");function y(){return y=Object.assign||function(g){for(var v=1;v<arguments.length;v++){var l=arguments[v];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(g[o]=l[o])}return g},y.apply(this,arguments)}var E=10*1e3,p=1024,T=1152,_=null,n=null,e=!1,t=function(){function g(l,o,r,i){if(i===void 0&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=l,this.config=o,this.typeSupported=r,this.ISGenerated=!1,_===null){var h=navigator.userAgent||"",c=h.match(/Chrome\/(\d+)/i);_=c?parseInt(c[1]):0}if(n===null){var S=navigator.userAgent.match(/Safari\/(\d+)/i);n=S?parseInt(S[1]):0}e=!!_&&_<75||!!n&&n<600}var v=g.prototype;return v.destroy=function(){},v.resetTimeStamp=function(o){O.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=o},v.resetNextTimestamp=function(){O.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},v.resetInitSegment=function(){O.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},v.getVideoStartPts=function(o){var r=!1,i=o.reduce(function(h,c){var S=c.pts-h;return S<-4294967296?(r=!0,a(h,c.pts)):S>0?h:c.pts},o[0].pts);return r&&O.logger.debug("PTS rollover detected"),i},v.remux=function(o,r,i,h,c,S,P,C){var x,B,F,U,w,k,K=c,N=c,G=o.pid>-1,H=r.pid>-1,V=r.samples.length,z=o.samples.length>0,Q=V>1,q=(!G||z)&&(!H||Q)||this.ISGenerated||P;if(q){this.ISGenerated||(F=this.generateIS(o,r,c));var J=this.isVideoContiguous,te=-1;if(Q&&(te=f(r.samples),!J&&this.config.forceKeyFrameOnDiscontinuity))if(k=!0,te>0){O.logger.warn("[mp4-remuxer]: Dropped "+te+" out of "+V+" video samples due to a missing keyframe");var ue=this.getVideoStartPts(r.samples);r.samples=r.samples.slice(te),r.dropped+=te,N+=(r.samples[0].pts-ue)/(r.timescale||9e4)}else te===-1&&(O.logger.warn("[mp4-remuxer]: No keyframe found out of "+V+" video samples"),k=!1);if(this.ISGenerated){if(z&&Q){var $=this.getVideoStartPts(r.samples),Z=a(o.samples[0].pts,$)-$,Y=Z/r.inputTimeScale;K+=Math.max(0,Y),N+=Math.max(0,-Y)}if(z){if(o.samplerate||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),F=this.generateIS(o,r,c)),B=this.remuxAudio(o,K,this.isAudioContiguous,S,H||Q||C===A.PlaylistLevelType.AUDIO?N:void 0),Q){var X=B?B.endPTS-B.startPTS:0;r.inputTimeScale||(O.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),F=this.generateIS(o,r,c)),x=this.remuxVideo(r,N,J,X)}}else Q&&(x=this.remuxVideo(r,N,J,0));x&&(x.firstKeyFrame=te,x.independent=te!==-1)}}return this.ISGenerated&&(i.samples.length&&(w=this.remuxID3(i,c)),h.samples.length&&(U=this.remuxText(h,c))),{audio:B,video:x,initSegment:F,independent:k,text:U,id3:w}},v.generateIS=function(o,r,i){var h=o.samples,c=r.samples,S=this.typeSupported,P={},C=!Object(I.isFiniteNumber)(this._initPTS),x="audio/mp4",B,F,U;if(C&&(B=F=1/0),o.config&&h.length&&(o.timescale=o.samplerate,o.isAAC||(S.mpeg?(x="audio/mpeg",o.codec=""):S.mp3&&(o.codec="mp3")),P.audio={id:"audio",container:x,codec:o.codec,initSegment:!o.isAAC&&S.mpeg?new Uint8Array(0):D.default.initSegment([o]),metadata:{channelCount:o.channelCount}},C&&(U=o.inputTimeScale,B=F=h[0].pts-Math.round(U*i))),r.sps&&r.pps&&c.length&&(r.timescale=r.inputTimeScale,P.video={id:"main",container:"video/mp4",codec:r.codec,initSegment:D.default.initSegment([r]),metadata:{width:r.width,height:r.height}},C)){U=r.inputTimeScale;var w=this.getVideoStartPts(c),k=Math.round(U*i);F=Math.min(F,a(c[0].dts,w)-k),B=Math.min(B,w-k)}if(Object.keys(P).length)return this.ISGenerated=!0,C&&(this._initPTS=B,this._initDTS=F),{tracks:P,initPTS:B,timescale:U}},v.remuxVideo=function(o,r,i,h){var c=o.inputTimeScale,S=o.samples,P=[],C=S.length,x=this._initPTS,B=this.nextAvcDts,F=8,U,w,k,K=Number.POSITIVE_INFINITY,N=Number.NEGATIVE_INFINITY,G=0,H=!1;if(!i||B===null){var V=r*c,z=S[0].pts-a(S[0].dts,S[0].pts);B=V-z}for(var Q=0;Q<C;Q++){var q=S[Q];if(q.pts=a(q.pts-x,B),q.dts=a(q.dts-x,B),q.dts>q.pts){var J=9e4*.2;G=Math.max(Math.min(G,q.pts-q.dts),-1*J)}q.dts<S[Q>0?Q-1:Q].dts&&(H=!0)}H&&S.sort(function(xe,ke){var Qe=xe.dts-ke.dts,Je=xe.pts-ke.pts;return Qe||Je}),w=S[0].dts,k=S[S.length-1].dts;var te=Math.round((k-w)/(C-1));if(G<0){if(G<te*-2){O.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(u.toMsFromMpegTsClock)(-te,!0)+" ms");for(var ue=G,$=0;$<C;$++)S[$].dts=ue=Math.max(ue,S[$].pts-te),S[$].pts=Math.max(ue,S[$].pts)}else{O.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(u.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var Z=0;Z<C;Z++)S[Z].dts=S[Z].dts+G}w=S[0].dts}if(i){var Y=w-B,X=Y>te,ie=Y<-1;if(X||ie){X?O.logger.warn("AVC: "+Object(u.toMsFromMpegTsClock)(Y,!0)+" ms ("+Y+"dts) hole between fragments detected, filling it"):O.logger.warn("AVC: "+Object(u.toMsFromMpegTsClock)(-Y,!0)+" ms ("+Y+"dts) overlapping between fragments detected"),w=B;var le=S[0].pts-Y;S[0].dts=w,S[0].pts=le,O.logger.log("Video: First PTS/DTS adjusted: "+Object(u.toMsFromMpegTsClock)(le,!0)+"/"+Object(u.toMsFromMpegTsClock)(w,!0)+", delta: "+Object(u.toMsFromMpegTsClock)(Y,!0)+" ms")}}e&&(w=Math.max(0,w));for(var oe=0,de=0,fe=0;fe<C;fe++){for(var se=S[fe],re=se.units,ae=re.length,pe=0,ge=0;ge<ae;ge++)pe+=re[ge].data.length;de+=pe,oe+=ae,se.length=pe,se.dts=Math.max(se.dts,w),se.pts=Math.max(se.pts,se.dts,0),K=Math.min(se.pts,K),N=Math.max(se.pts,N)}k=S[C-1].dts;var Ee=de+4*oe+8,ce;try{ce=new Uint8Array(Ee)}catch{this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ee,reason:"fail allocating video mdat "+Ee});return}var Se=new DataView(ce.buffer);Se.setUint32(0,Ee),ce.set(D.default.types.mdat,4);for(var he=0;he<C;he++){for(var me=S[he],De=me.units,ye=0,Te=0,Re=De.length;Te<Re;Te++){var _e=De[Te],ve=_e.data,Ae=_e.data.byteLength;Se.setUint32(F,Ae),F+=4,ce.set(ve,F),F+=Ae,ye+=4+Ae}if(he<C-1)U=S[he+1].dts-me.dts;else{var Pe=this.config,Le=me.dts-S[he>0?he-1:he].dts;if(Pe.stretchShortVideoTrack&&this.nextAudioPts!==null){var He=Math.floor(Pe.maxBufferHole*c),Ce=(h?K+h*c:this.nextAudioPts)-me.pts;Ce>He?(U=Ce-Le,U<0&&(U=Le),O.logger.log("[mp4-remuxer]: It is approximately "+Ce/90+" ms to the next segment; using duration "+U/90+" ms for the last video frame.")):U=Le}else U=Le}var Ve=Math.round(me.pts-me.dts);P.push(new s(me.key,U,ye,Ve))}if(P.length&&_&&_<70){var we=P[0].flags;we.dependsOn=2,we.isNonSync=0}console.assert(U!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=B=k+U,this.isVideoContiguous=!0;var Ye=D.default.moof(o.sequenceNumber++,w,y({},o,{samples:P})),Xe="video",ze={data1:Ye,data2:ce,startPTS:K/c,endPTS:(N+U)/c,startDTS:w/c,endDTS:B/c,type:Xe,hasAudio:!1,hasVideo:!0,nb:P.length,dropped:o.dropped};return o.samples=[],o.dropped=0,console.assert(ce.length,"MDAT length must not be zero"),ze},v.remuxAudio=function(o,r,i,h,c){var S=o.inputTimeScale,P=o.samplerate?o.samplerate:S,C=S/P,x=o.isAAC?p:T,B=x*C,F=this._initPTS,U=!o.isAAC&&this.typeSupported.mpeg,w=[],k=o.samples,K=U?0:8,N=this.nextAudioPts||-1,G=r*S;if(this.isAudioContiguous=i=i||k.length&&N>0&&(h&&Math.abs(G-N)<9e3||Math.abs(a(k[0].pts-F,G)-N)<20*B),k.forEach(function(ve){ve.pts=a(ve.pts-F,G)}),!i||N<0){if(k=k.filter(function(ve){return ve.pts>=0}),!k.length)return;c===0?N=0:h?N=Math.max(0,G):N=k[0].pts}if(o.isAAC)for(var H=c!==void 0,V=this.config.maxAudioFramesDrift,z=0,Q=N;z<k.length;z++){var q=k[z],J=q.pts,te=J-Q,ue=Math.abs(1e3*te/S);if(te<=-V*B&&H)z===0&&(O.logger.warn("Audio frame @ "+(J/S).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*te/S)+" ms."),this.nextAudioPts=N=Q=J);else if(te>=V*B&&ue<E&&H){var $=Math.round(te/B);Q=J-$*B,Q<0&&($--,Q+=B),z===0&&(this.nextAudioPts=N=Q),O.logger.warn("[mp4-remuxer]: Injecting "+$+" audio frame @ "+(Q/S).toFixed(3)+"s due to "+Math.round(1e3*te/S)+" ms gap.");for(var Z=0;Z<$;Z++){var Y=Math.max(Q,0),X=L.default.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);X||(O.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),X=q.unit.subarray()),k.splice(z,0,{unit:X,pts:Y}),Q+=B,z++}}q.pts=Q,Q+=B}for(var ie=null,le=null,oe,de=0,fe=k.length;fe--;)de+=k[fe].unit.byteLength;for(var se=0,re=k.length;se<re;se++){var ae=k[se],pe=ae.unit,ge=ae.pts;if(le!==null){var Ee=w[se-1];Ee.duration=Math.round((ge-le)/C)}else if(i&&o.isAAC&&(ge=N),ie=ge,de>0){de+=K;try{oe=new Uint8Array(de)}catch{this.observer.emit(M.Events.ERROR,M.Events.ERROR,{type:R.ErrorTypes.MUX_ERROR,details:R.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:de,reason:"fail allocating audio mdat "+de});return}if(!U){var ce=new DataView(oe.buffer);ce.setUint32(0,de),oe.set(D.default.types.mdat,4)}}else return;oe.set(pe,K);var Se=pe.byteLength;K+=Se,w.push(new s(!0,x,Se,0)),le=ge}var he=w.length;if(!!he){var me=w[w.length-1];this.nextAudioPts=N=le+C*me.duration;var De=U?new Uint8Array(0):D.default.moof(o.sequenceNumber++,ie/C,y({},o,{samples:w}));o.samples=[];var ye=ie/S,Te=N/S,Re="audio",_e={data1:De,data2:oe,startPTS:ye,endPTS:Te,startDTS:ye,endDTS:Te,type:Re,hasAudio:!0,hasVideo:!1,nb:he};return this.isAudioContiguous=!0,console.assert(oe.length,"MDAT length must not be zero"),_e}},v.remuxEmptyAudio=function(o,r,i,h){var c=o.inputTimeScale,S=o.samplerate?o.samplerate:c,P=c/S,C=this.nextAudioPts,x=(C!==null?C:h.startDTS*c)+this._initDTS,B=h.endDTS*c+this._initDTS,F=P*p,U=Math.ceil((B-x)/F),w=L.default.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);if(O.logger.warn("[mp4-remuxer]: remux empty Audio"),!w){O.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var k=[],K=0;K<U;K++){var N=x+K*F;k.push({unit:w,pts:N,dts:N})}return o.samples=k,this.remuxAudio(o,r,i,!1)},v.remuxID3=function(o,r){var i=o.samples.length;if(!!i){for(var h=o.inputTimeScale,c=this._initPTS,S=this._initDTS,P=0;P<i;P++){var C=o.samples[P];C.pts=a(C.pts-c,r*h)/h,C.dts=a(C.dts-S,r*h)/h}var x=o.samples;return o.samples=[],{samples:x}}},v.remuxText=function(o,r){var i=o.samples.length;if(!!i){for(var h=o.inputTimeScale,c=this._initPTS,S=0;S<i;S++){var P=o.samples[S];P.pts=a(P.pts-c,r*h)/h}o.samples.sort(function(x,B){return x.pts-B.pts});var C=o.samples;return o.samples=[],{samples:C}}},g}();function a(g,v){var l;if(v===null)return g;for(v<g?l=-8589934592:l=8589934592;Math.abs(g-v)>4294967296;)g+=l;return g}function f(g){for(var v=0;v<g.length;v++)if(g[v].key)return v;return-1}var s=function(v,l,o,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=l,this.size=o,this.cts=r,this.flags=new d(v)},d=function(v){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=v?2:1,this.isNonSync=v?0:1}},"./src/remux/passthrough-remuxer.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/polyfills/number.ts"),L=m("./src/utils/mp4-tools.ts"),D=m("./src/loader/fragment.ts"),M=m("./src/utils/logger.ts"),R=function(){function u(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var y=u.prototype;return y.destroy=function(){},y.resetTimeStamp=function(p){this.initPTS=p,this.lastEndDTS=null},y.resetNextTimestamp=function(){this.lastEndDTS=null},y.resetInitSegment=function(p,T,_){this.audioCodec=T,this.videoCodec=_,this.generateInitSegment(p),this.emitInitSegment=!0},y.generateInitSegment=function(p){var T=this.audioCodec,_=this.videoCodec;if(!p||!p.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=Object(L.parseInitSegment)(p);T||(T=A(n.audio,D.ElementaryStreamTypes.AUDIO)),_||(_=A(n.video,D.ElementaryStreamTypes.VIDEO));var e={};n.audio&&n.video?e.audiovideo={container:"video/mp4",codec:T+","+_,initSegment:p,id:"main"}:n.audio?e.audio={container:"audio/mp4",codec:T,initSegment:p,id:"audio"}:n.video?e.video={container:"video/mp4",codec:_,initSegment:p,id:"main"}:M.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},y.remux=function(p,T,_,n,e){var t=this.initPTS,a=this.lastEndDTS,f={audio:void 0,video:void 0,text:n,id3:_,initSegment:void 0};Object(I.isFiniteNumber)(a)||(a=this.lastEndDTS=e||0);var s=T.samples;if(!s||!s.length)return f;var d={initPTS:void 0,timescale:1},g=this.initData;if((!g||!g.length)&&(this.generateInitSegment(s),g=this.initData),!g||!g.length)return M.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),f;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1),Object(I.isFiniteNumber)(t)||(this.initPTS=d.initPTS=t=O(g,s,a));var v=Object(L.getDuration)(s,g),l=a,o=v+l;Object(L.offsetStartDTS)(g,s,t),v>0?this.lastEndDTS=o:(M.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!g.audio,i=!!g.video,h="";r&&(h+="audio"),i&&(h+="video");var c={data1:s,startPTS:l,startDTS:l,endPTS:o,endDTS:o,type:h,hasAudio:r,hasVideo:i,nb:1,dropped:0};return f.audio=c.type==="audio"?c:void 0,f.video=c.type!=="audio"?c:void 0,f.text=n,f.id3=_,f.initSegment=d,f},u}(),O=function(y,E,p){return Object(L.getStartDTS)(y,E)-p};function A(u,y){var E=u==null?void 0:u.codec;return E&&E.length>4?E:E==="hvc1"?"hvc1.1.c.L120.90":E==="av01"?"av01.0.04M.08":E==="avc1"||y===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}b.default=R},"./src/task-loop.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return I});var I=function(){function L(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var D=L.prototype;return D.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},D.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},D.onHandlerDestroyed=function(){},D.hasInterval=function(){return!!this._tickInterval},D.hasNextTick=function(){return!!this._tickTimer},D.setInterval=function(R){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,R),!0)},D.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},D.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},D.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},D.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},D.doTick=function(){},L}()},"./src/types/level.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"HlsSkip",function(){return D}),m.d(b,"getSkipValue",function(){return M}),m.d(b,"HlsUrlParameters",function(){return R}),m.d(b,"Level",function(){return O});function I(A,u){for(var y=0;y<u.length;y++){var E=u[y];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(A,E.key,E)}}function L(A,u,y){return u&&I(A.prototype,u),y&&I(A,y),A}var D;(function(A){A.No="",A.Yes="YES",A.v2="v2"})(D||(D={}));function M(A,u){var y=A.canSkipUntil,E=A.canSkipDateRanges,p=A.endSN,T=u!==void 0?u-p:0;return y&&T<y?E?D.v2:D.Yes:D.No}var R=function(){function A(y,E,p){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=y,this.part=E,this.skip=p}var u=A.prototype;return u.addDirectives=function(E){var p=new self.URL(E);return this.msn!==void 0&&p.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&p.searchParams.set("_HLS_part",this.part.toString()),this.skip&&p.searchParams.set("_HLS_skip",this.skip),p.toString()},A}(),O=function(){function A(u){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[u.url],this.attrs=u.attrs,this.bitrate=u.bitrate,u.details&&(this.details=u.details),this.id=u.id||0,this.name=u.name,this.width=u.width||0,this.height=u.height||0,this.audioCodec=u.audioCodec,this.videoCodec=u.videoCodec,this.unknownCodecs=u.unknownCodecs,this.codecSet=[u.videoCodec,u.audioCodec].filter(function(y){return y}).join(",").replace(/\.[^.,]+/g,"")}return L(A,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(y){var E=y%this.url.length;this._urlId!==E&&(this.details=void 0,this._urlId=E)}}]),A}()},"./src/types/loader.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"PlaylistContextType",function(){return I}),m.d(b,"PlaylistLevelType",function(){return L});var I;(function(D){D.MANIFEST="manifest",D.LEVEL="level",D.AUDIO_TRACK="audioTrack",D.SUBTITLE_TRACK="subtitleTrack"})(I||(I={}));var L;(function(D){D.MAIN="main",D.AUDIO="audio",D.SUBTITLE="subtitle"})(L||(L={}))},"./src/types/transmuxer.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"ChunkMetadata",function(){return I});var I=function(M,R,O,A,u,y){A===void 0&&(A=0),u===void 0&&(u=-1),y===void 0&&(y=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=L(),this.buffering={audio:L(),video:L(),audiovideo:L()},this.level=M,this.sn=R,this.id=O,this.size=A,this.part=u,this.partial=y};function L(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"AttrList",function(){return D});var I=/^(\d+)x(\d+)$/,L=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,D=function(){function M(O){typeof O=="string"&&(O=M.parseAttrList(O));for(var A in O)O.hasOwnProperty(A)&&(this[A]=O[A])}var R=M.prototype;return R.decimalInteger=function(A){var u=parseInt(this[A],10);return u>Number.MAX_SAFE_INTEGER?1/0:u},R.hexadecimalInteger=function(A){if(this[A]){var u=(this[A]||"0x").slice(2);u=(u.length&1?"0":"")+u;for(var y=new Uint8Array(u.length/2),E=0;E<u.length/2;E++)y[E]=parseInt(u.slice(E*2,E*2+2),16);return y}else return null},R.hexadecimalIntegerAsNumber=function(A){var u=parseInt(this[A],16);return u>Number.MAX_SAFE_INTEGER?1/0:u},R.decimalFloatingPoint=function(A){return parseFloat(this[A])},R.optionalFloat=function(A,u){var y=this[A];return y?parseFloat(y):u},R.enumeratedString=function(A){return this[A]},R.bool=function(A){return this[A]==="YES"},R.decimalResolution=function(A){var u=I.exec(this[A]);if(u!==null)return{width:parseInt(u[1],10),height:parseInt(u[2],10)}},M.parseAttrList=function(A){var u,y={},E='"';for(L.lastIndex=0;(u=L.exec(A))!==null;){var p=u[2];p.indexOf(E)===0&&p.lastIndexOf(E)===p.length-1&&(p=p.slice(1,-1)),y[u[1]]=p}return y},M}()},"./src/utils/binary-search.ts":function(W,b,m){"use strict";m.r(b);var I={search:function(D,M){for(var R=0,O=D.length-1,A=null,u=null;R<=O;){A=(R+O)/2|0,u=D[A];var y=M(u);if(y>0)R=A+1;else if(y<0)O=A-1;else return u}return null}};b.default=I},"./src/utils/buffer-helper.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"BufferHelper",function(){return D});var I=m("./src/utils/logger.ts"),L={length:0,start:function(){return 0},end:function(){return 0}},D=function(){function M(){}return M.isBuffered=function(O,A){try{if(O){for(var u=M.getBuffered(O),y=0;y<u.length;y++)if(A>=u.start(y)&&A<=u.end(y))return!0}}catch{}return!1},M.bufferInfo=function(O,A,u){try{if(O){var y=M.getBuffered(O),E=[],p;for(p=0;p<y.length;p++)E.push({start:y.start(p),end:y.end(p)});return this.bufferedInfo(E,A,u)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},M.bufferedInfo=function(O,A,u){A=Math.max(0,A),O.sort(function(d,g){var v=d.start-g.start;return v||g.end-d.end});var y=[];if(u)for(var E=0;E<O.length;E++){var p=y.length;if(p){var T=y[p-1].end;O[E].start-T<u?O[E].end>T&&(y[p-1].end=O[E].end):y.push(O[E])}else y.push(O[E])}else y=O;for(var _=0,n,e=A,t=A,a=0;a<y.length;a++){var f=y[a].start,s=y[a].end;if(A+u>=f&&A<s)e=f,t=s,_=t-A;else if(A+u<f){n=f;break}}return{len:_,start:e||0,end:t||0,nextStart:n}},M.getBuffered=function(O){try{return O.buffered}catch(A){return I.logger.log("failed to get media.buffered",A),L}},M}()},"./src/utils/cea-608-parser.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"Row",function(){return t}),m.d(b,"CaptionScreen",function(){return a});var I=m("./src/utils/logger.ts"),L={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},D=function(o){var r=o;return L.hasOwnProperty(o)&&(r=L[o]),String.fromCharCode(r)},M=15,R=100,O={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},u={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},y={25:2,26:4,29:6,30:8,31:10,27:13,28:15},E=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],p;(function(l){l[l.ERROR=0]="ERROR",l[l.TEXT=1]="TEXT",l[l.WARNING=2]="WARNING",l[l.INFO=2]="INFO",l[l.DEBUG=3]="DEBUG",l[l.DATA=3]="DATA"})(p||(p={}));var T=function(){function l(){this.time=null,this.verboseLevel=p.ERROR}var o=l.prototype;return o.log=function(i,h){this.verboseLevel>=i&&I.logger.log(this.time+" ["+i+"] "+h)},l}(),_=function(o){for(var r=[],i=0;i<o.length;i++)r.push(o[i].toString(16));return r},n=function(){function l(r,i,h,c,S){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=r||"white",this.underline=i||!1,this.italics=h||!1,this.background=c||"black",this.flash=S||!1}var o=l.prototype;return o.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},o.setStyles=function(i){for(var h=["foreground","underline","italics","background","flash"],c=0;c<h.length;c++){var S=h[c];i.hasOwnProperty(S)&&(this[S]=i[S])}},o.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},o.equals=function(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash},o.copy=function(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash},o.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},l}(),e=function(){function l(r,i,h,c,S,P){this.uchar=void 0,this.penState=void 0,this.uchar=r||" ",this.penState=new n(i,h,c,S,P)}var o=l.prototype;return o.reset=function(){this.uchar=" ",this.penState.reset()},o.setChar=function(i,h){this.uchar=i,this.penState.copy(h)},o.setPenState=function(i){this.penState.copy(i)},o.equals=function(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)},o.copy=function(i){this.uchar=i.uchar,this.penState.copy(i.penState)},o.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},l}(),t=function(){function l(r){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var i=0;i<R;i++)this.chars.push(new e);this.logger=r,this.pos=0,this.currPenState=new n}var o=l.prototype;return o.equals=function(i){for(var h=!0,c=0;c<R;c++)if(!this.chars[c].equals(i.chars[c])){h=!1;break}return h},o.copy=function(i){for(var h=0;h<R;h++)this.chars[h].copy(i.chars[h])},o.isEmpty=function(){for(var i=!0,h=0;h<R;h++)if(!this.chars[h].isEmpty()){i=!1;break}return i},o.setCursor=function(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(p.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>R&&(this.logger.log(p.DEBUG,"Too large cursor position "+this.pos),this.pos=R)},o.moveCursor=function(i){var h=this.pos+i;if(i>1)for(var c=this.pos+1;c<h+1;c++)this.chars[c].setPenState(this.currPenState);this.setCursor(h)},o.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},o.insertChar=function(i){i>=144&&this.backSpace();var h=D(i);if(this.pos>=R){this.logger.log(p.ERROR,"Cannot insert "+i.toString(16)+" ("+h+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(h,this.currPenState),this.moveCursor(1)},o.clearFromPos=function(i){var h;for(h=i;h<R;h++)this.chars[h].reset()},o.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},o.clearToEndOfRow=function(){this.clearFromPos(this.pos)},o.getTextString=function(){for(var i=[],h=!0,c=0;c<R;c++){var S=this.chars[c].uchar;S!==" "&&(h=!1),i.push(S)}return h?"":i.join("")},o.setPenStyles=function(i){this.currPenState.setStyles(i);var h=this.chars[this.pos];h.setPenState(this.currPenState)},l}(),a=function(){function l(r){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var i=0;i<M;i++)this.rows.push(new t(r));this.logger=r,this.currRow=M-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var o=l.prototype;return o.reset=function(){for(var i=0;i<M;i++)this.rows[i].clear();this.currRow=M-1},o.equals=function(i){for(var h=!0,c=0;c<M;c++)if(!this.rows[c].equals(i.rows[c])){h=!1;break}return h},o.copy=function(i){for(var h=0;h<M;h++)this.rows[h].copy(i.rows[h])},o.isEmpty=function(){for(var i=!0,h=0;h<M;h++)if(!this.rows[h].isEmpty()){i=!1;break}return i},o.backSpace=function(){var i=this.rows[this.currRow];i.backSpace()},o.clearToEndOfRow=function(){var i=this.rows[this.currRow];i.clearToEndOfRow()},o.insertChar=function(i){var h=this.rows[this.currRow];h.insertChar(i)},o.setPen=function(i){var h=this.rows[this.currRow];h.setPenStyles(i)},o.moveCursor=function(i){var h=this.rows[this.currRow];h.moveCursor(i)},o.setCursor=function(i){this.logger.log(p.INFO,"setCursor: "+i);var h=this.rows[this.currRow];h.setCursor(i)},o.setPAC=function(i){this.logger.log(p.INFO,"pacData = "+JSON.stringify(i));var h=i.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var c=0;c<M;c++)this.rows[c].clear();var S=this.currRow+1-this.nrRollUpRows,P=this.lastOutputScreen;if(P){var C=P.rows[S].cueStartTime,x=this.logger.time;if(C&&x!==null&&C<x)for(var B=0;B<this.nrRollUpRows;B++)this.rows[h-this.nrRollUpRows+B+1].copy(P.rows[S+B])}}this.currRow=h;var F=this.rows[this.currRow];if(i.indent!==null){var U=i.indent,w=Math.max(U-1,0);F.setCursor(i.indent),i.color=F.chars[w].penState.foreground}var k={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(k)},o.setBkgData=function(i){this.logger.log(p.INFO,"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)},o.setRollUpRows=function(i){this.nrRollUpRows=i},o.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(p.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(p.TEXT,this.getDisplayText());var i=this.currRow+1-this.nrRollUpRows,h=this.rows.splice(i,1)[0];h.clear(),this.rows.splice(this.currRow,0,h),this.logger.log(p.INFO,"Rolling up")},o.getDisplayText=function(i){i=i||!1;for(var h=[],c="",S=-1,P=0;P<M;P++){var C=this.rows[P].getTextString();C&&(S=P+1,i?h.push("Row "+S+": '"+C+"'"):h.push(C.trim()))}return h.length>0&&(i?c="["+h.join(" | ")+"]":c=h.join(`
`)),c},o.getTextAndFormat=function(){return this.rows},l}(),f=function(){function l(r,i,h){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new a(h),this.nonDisplayedMemory=new a(h),this.lastOutputScreen=new a(h),this.currRollUpRow=this.displayedMemory.rows[M-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=h}var o=l.prototype;return o.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[M-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},o.getHandler=function(){return this.outputFilter},o.setHandler=function(i){this.outputFilter=i},o.setPAC=function(i){this.writeScreen.setPAC(i)},o.setBkgData=function(i){this.writeScreen.setBkgData(i)},o.setMode=function(i){i!==this.mode&&(this.mode=i,this.logger.log(p.INFO,"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)},o.insertChars=function(i){for(var h=0;h<i.length;h++)this.writeScreen.insertChar(i[h]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(p.INFO,c+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(p.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},o.ccRCL=function(){this.logger.log(p.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},o.ccBS=function(){this.logger.log(p.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},o.ccAOF=function(){},o.ccAON=function(){},o.ccDER=function(){this.logger.log(p.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},o.ccRU=function(i){this.logger.log(p.INFO,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)},o.ccFON=function(){this.logger.log(p.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},o.ccRDC=function(){this.logger.log(p.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},o.ccTR=function(){this.logger.log(p.INFO,"TR"),this.setMode("MODE_TEXT")},o.ccRTD=function(){this.logger.log(p.INFO,"RTD"),this.setMode("MODE_TEXT")},o.ccEDM=function(){this.logger.log(p.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},o.ccCR=function(){this.logger.log(p.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},o.ccENM=function(){this.logger.log(p.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},o.ccEOC=function(){if(this.logger.log(p.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(p.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},o.ccTO=function(i){this.logger.log(p.INFO,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)},o.ccMIDROW=function(i){var h={flash:!1};if(h.underline=i%2==1,h.italics=i>=46,h.italics)h.foreground="white";else{var c=Math.floor(i/2)-16,S=["white","green","blue","cyan","red","yellow","magenta"];h.foreground=S[c]}this.logger.log(p.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},o.outputDataUpdate=function(i){i===void 0&&(i=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=h:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h),this.lastOutputScreen.copy(this.displayedMemory))},o.cueSplitAtTime=function(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))},l}(),s=function(){function l(r,i,h){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var c=new T;this.channels=[null,new f(r,i,c),new f(r+1,h,c)],this.cmdHistory=v(),this.logger=c}var o=l.prototype;return o.getHandler=function(i){return this.channels[i].getHandler()},o.setHandler=function(i,h){this.channels[i].setHandler(h)},o.addData=function(i,h){var c,S,P,C=!1;this.logger.time=i;for(var x=0;x<h.length;x+=2)if(S=h[x]&127,P=h[x+1]&127,!(S===0&&P===0)){if(this.logger.log(p.DATA,"["+_([h[x],h[x+1]])+"] -> ("+_([S,P])+")"),c=this.parseCmd(S,P),c||(c=this.parseMidrow(S,P)),c||(c=this.parsePAC(S,P)),c||(c=this.parseBackgroundAttributes(S,P)),!c&&(C=this.parseChars(S,P),C)){var B=this.currentChannel;if(B&&B>0){var F=this.channels[B];F.insertChars(C)}else this.logger.log(p.WARNING,"No channel found yet. TEXT-MODE?")}!c&&!C&&this.logger.log(p.WARNING,"Couldn't parse cleaned data "+_([S,P])+" orig: "+_([h[x],h[x+1]]))}},o.parseCmd=function(i,h){var c=this.cmdHistory,S=(i===20||i===28||i===21||i===29)&&h>=32&&h<=47,P=(i===23||i===31)&&h>=33&&h<=35;if(!(S||P))return!1;if(g(i,h,c))return d(null,null,c),this.logger.log(p.DEBUG,"Repeated command ("+_([i,h])+") is dropped"),!0;var C=i===20||i===21||i===23?1:2,x=this.channels[C];return i===20||i===21||i===28||i===29?h===32?x.ccRCL():h===33?x.ccBS():h===34?x.ccAOF():h===35?x.ccAON():h===36?x.ccDER():h===37?x.ccRU(2):h===38?x.ccRU(3):h===39?x.ccRU(4):h===40?x.ccFON():h===41?x.ccRDC():h===42?x.ccTR():h===43?x.ccRTD():h===44?x.ccEDM():h===45?x.ccCR():h===46?x.ccENM():h===47&&x.ccEOC():x.ccTO(h-32),d(i,h,c),this.currentChannel=C,!0},o.parseMidrow=function(i,h){var c=0;if((i===17||i===25)&&h>=32&&h<=47){if(i===17?c=1:c=2,c!==this.currentChannel)return this.logger.log(p.ERROR,"Mismatch channel in midrow parsing"),!1;var S=this.channels[c];return S?(S.ccMIDROW(h),this.logger.log(p.DEBUG,"MIDROW ("+_([i,h])+")"),!0):!1}return!1},o.parsePAC=function(i,h){var c,S=this.cmdHistory,P=(i>=17&&i<=23||i>=25&&i<=31)&&h>=64&&h<=127,C=(i===16||i===24)&&h>=64&&h<=95;if(!(P||C))return!1;if(g(i,h,S))return d(null,null,S),!0;var x=i<=23?1:2;h>=64&&h<=95?c=x===1?O[i]:u[i]:c=x===1?A[i]:y[i];var B=this.channels[x];return B?(B.setPAC(this.interpretPAC(c,h)),d(i,h,S),this.currentChannel=x,!0):!1},o.interpretPAC=function(i,h){var c,S={color:null,italics:!1,indent:null,underline:!1,row:i};return h>95?c=h-96:c=h-64,S.underline=(c&1)==1,c<=13?S.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(c/2)]:c<=15?(S.italics=!0,S.color="white"):S.indent=Math.floor((c-16)/2)*4,S},o.parseChars=function(i,h){var c,S=null,P=null;if(i>=25?(c=2,P=i-8):(c=1,P=i),P>=17&&P<=19){var C;P===17?C=h+80:P===18?C=h+112:C=h+144,this.logger.log(p.INFO,"Special char '"+D(C)+"' in channel "+c),S=[C]}else i>=32&&i<=127&&(S=h===0?[i]:[i,h]);if(S){var x=_(S);this.logger.log(p.DEBUG,"Char codes =  "+x.join(",")),d(i,h,this.cmdHistory)}return S},o.parseBackgroundAttributes=function(i,h){var c=(i===16||i===24)&&h>=32&&h<=47,S=(i===23||i===31)&&h>=45&&h<=47;if(!(c||S))return!1;var P,C={};i===16||i===24?(P=Math.floor((h-32)/2),C.background=E[P],h%2==1&&(C.background=C.background+"_semi")):h===45?C.background="transparent":(C.foreground="black",h===47&&(C.underline=!0));var x=i<=23?1:2,B=this.channels[x];return B.setBkgData(C),d(i,h,this.cmdHistory),!0},o.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var h=this.channels[i];h&&h.reset()}this.cmdHistory=v()},o.cueSplitAtTime=function(i){for(var h=0;h<this.channels.length;h++){var c=this.channels[h];c&&c.cueSplitAtTime(i)}},l}();function d(l,o,r){r.a=l,r.b=o}function g(l,o,r){return r.a===l&&r.b===o}function v(){return{a:null,b:null}}b.default=s},"./src/utils/codecs.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"isCodecType",function(){return L}),m.d(b,"isCodecSupportedInMp4",function(){return D});var I={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function L(M,R){var O=I[R];return!!O&&O[M.slice(0,4)]===!0}function D(M,R){return MediaSource.isTypeSupported((R||"video")+'/mp4;codecs="'+M+'"')}},"./src/utils/cues.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/utils/vttparser.ts"),L=m("./src/utils/webvtt-parser.ts"),D=m("./src/utils/texttrack-utils.ts"),M=/\s/,R={newCue:function(A,u,y,E){for(var p=[],T,_,n,e,t,a=self.VTTCue||self.TextTrackCue,f=0;f<E.rows.length;f++)if(T=E.rows[f],n=!0,e=0,t="",!T.isEmpty()){for(var s=0;s<T.chars.length;s++)M.test(T.chars[s].uchar)&&n?e++:(t+=T.chars[s].uchar,n=!1);T.cueStartTime=u,u===y&&(y+=1e-4),e>=16?e--:e++;var d=Object(I.fixLineBreaks)(t.trim()),g=Object(L.generateCueId)(u,y,d);(!A||!A.cues||!A.cues.getCueById(g))&&(_=new a(u,y,d),_.id=g,_.line=f+1,_.align="left",_.position=10+Math.min(80,Math.floor(e*8/32)*10),p.push(_))}return A&&p.length&&(p.sort(function(v,l){return v.line==="auto"||l.line==="auto"?0:v.line>8&&l.line>8?l.line-v.line:v.line-l.line}),p.forEach(function(v){return Object(D.addCueToTrack)(A,v)})),p}};b.default=R},"./src/utils/discontinuities.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"findFirstFragWithCC",function(){return M}),m.d(b,"shouldAlignOnDiscontinuities",function(){return R}),m.d(b,"findDiscontinuousReferenceFrag",function(){return O}),m.d(b,"adjustSlidingStart",function(){return u}),m.d(b,"alignStream",function(){return y}),m.d(b,"alignPDT",function(){return p}),m.d(b,"alignFragmentByPDTDelta",function(){return T}),m.d(b,"alignMediaPlaylistByPDT",function(){return _});var I=m("./src/polyfills/number.ts"),L=m("./src/utils/logger.ts"),D=m("./src/controller/level-helper.ts");function M(n,e){for(var t=null,a=0,f=n.length;a<f;a++){var s=n[a];if(s&&s.cc===e){t=s;break}}return t}function R(n,e,t){return!!(e.details&&(t.endCC>t.startCC||n&&n.cc<t.startCC))}function O(n,e){var t=n.fragments,a=e.fragments;if(!a.length||!t.length){L.logger.log("No fragments to align");return}var f=M(t,a[0].cc);if(!f||f&&!f.startPTS){L.logger.log("No frag in previous level to align on");return}return f}function A(n,e){if(n){var t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function u(n,e){for(var t=e.fragments,a=0,f=t.length;a<f;a++)A(t[a],n);e.fragmentHint&&A(e.fragmentHint,n),e.alignedSliding=!0}function y(n,e,t){!e||(E(n,t,e),!t.alignedSliding&&e.details&&p(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&Object(D.adjustSliding)(e.details,t))}function E(n,e,t){if(R(n,t,e)){var a=O(t.details,e);a&&Object(I.isFiniteNumber)(a.start)&&(L.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),u(a.start,e))}}function p(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var t=e.fragments[0].programDateTime,a=n.fragments[0].programDateTime,f=(a-t)/1e3+e.fragments[0].start;f&&Object(I.isFiniteNumber)(f)&&(L.logger.log("Adjusting PTS using programDateTime delta "+(a-t)+"ms, sliding:"+f.toFixed(3)+" "+n.url+" "),u(f,n))}}function T(n,e){var t=n.programDateTime;if(!!t){var a=(t-e)/1e3;n.start=n.startPTS=a,n.endPTS=a+n.duration}}function _(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var t=e.fragments[0].programDateTime,a=e.fragments[0].start,f=t-a*1e3;n.fragments.forEach(function(s){T(s,f)}),n.fragmentHint&&T(n.fragmentHint,f),n.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/utils/ewma.ts"),L=function(){function D(R,O,A){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=A,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new I.default(R),this.fast_=new I.default(O)}var M=D.prototype;return M.update=function(O,A){var u=this.slow_,y=this.fast_;this.slow_.halfLife!==O&&(this.slow_=new I.default(O,u.getEstimate(),u.getTotalWeight())),this.fast_.halfLife!==A&&(this.fast_=new I.default(A,y.getEstimate(),y.getTotalWeight()))},M.sample=function(O,A){O=Math.max(O,this.minDelayMs_);var u=8*A,y=O/1e3,E=u/y;this.fast_.sample(y,E),this.slow_.sample(y,E)},M.canEstimate=function(){var O=this.fast_;return O&&O.getTotalWeight()>=this.minWeight_},M.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},M.destroy=function(){},D}();b.default=L},"./src/utils/ewma.ts":function(W,b,m){"use strict";m.r(b);var I=function(){function L(M,R,O){R===void 0&&(R=0),O===void 0&&(O=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=M,this.alpha_=M?Math.exp(Math.log(.5)/M):0,this.estimate_=R,this.totalWeight_=O}var D=L.prototype;return D.sample=function(R,O){var A=Math.pow(this.alpha_,R);this.estimate_=O*(1-A)+A*this.estimate_,this.totalWeight_+=R},D.getTotalWeight=function(){return this.totalWeight_},D.getEstimate=function(){if(this.alpha_){var R=1-Math.pow(this.alpha_,this.totalWeight_);if(R)return this.estimate_/R}return this.estimate_},L}();b.default=I},"./src/utils/fetch-loader.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"fetchSupported",function(){return p});var I=m("./src/polyfills/number.ts"),L=m("./src/loader/load-stats.ts"),D=m("./src/demux/chunk-cache.ts");function M(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,y(t,a)}function R(t){var a=typeof Map=="function"?new Map:void 0;return R=function(s){if(s===null||!u(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(s))return a.get(s);a.set(s,d)}function d(){return O(s,arguments,E(this).constructor)}return d.prototype=Object.create(s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),y(d,s)},R(t)}function O(t,a,f){return A()?O=Reflect.construct:O=function(d,g,v){var l=[null];l.push.apply(l,g);var o=Function.bind.apply(d,l),r=new o;return v&&y(r,v.prototype),r},O.apply(null,arguments)}function A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function u(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function y(t,a){return y=Object.setPrototypeOf||function(s,d){return s.__proto__=d,s},y(t,a)}function E(t){return E=Object.setPrototypeOf?Object.getPrototypeOf:function(f){return f.__proto__||Object.getPrototypeOf(f)},E(t)}function p(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var T=function(){function t(f){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=f.fetchSetup||n,this.controller=new self.AbortController,this.stats=new L.LoadStats}var a=t.prototype;return a.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},a.abortInternal=function(){var s=this.response;(!s||!s.ok)&&(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var s;this.abortInternal(),(s=this.callbacks)!==null&&s!==void 0&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(s,d,g){var v=this,l=this.stats;if(l.loading.start)throw new Error("Loader can only be used once.");l.loading.start=self.performance.now();var o=_(s,this.controller.signal),r=g.onProgress,i=s.responseType==="arraybuffer",h=i?"byteLength":"length";this.context=s,this.config=d,this.callbacks=g,this.request=this.fetchSetup(s,o),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){v.abortInternal(),g.onTimeout(l,s,v.response)},d.timeout),self.fetch(this.request).then(function(c){if(v.response=v.loader=c,!c.ok){var S=c.status,P=c.statusText;throw new e(P||"fetch, bad network response",S,c)}return l.loading.first=Math.max(self.performance.now(),l.loading.start),l.total=parseInt(c.headers.get("Content-Length")||"0"),r&&Object(I.isFiniteNumber)(d.highWaterMark)?v.loadProgressively(c,l,s,d.highWaterMark,r):i?c.arrayBuffer():c.text()}).then(function(c){var S=v.response;self.clearTimeout(v.requestTimeout),l.loading.end=Math.max(self.performance.now(),l.loading.first),l.loaded=l.total=c[h];var P={url:S.url,data:c};r&&!Object(I.isFiniteNumber)(d.highWaterMark)&&r(l,s,c,S),g.onSuccess(P,l,s,S)}).catch(function(c){if(self.clearTimeout(v.requestTimeout),!l.aborted){var S=c.code||0;g.onError({code:S,text:c.message},s,c.details)}})},a.getCacheAge=function(){var s=null;if(this.response){var d=this.response.headers.get("age");s=d?parseFloat(d):null}return s},a.loadProgressively=function(s,d,g,v,l){v===void 0&&(v=0);var o=new D.default,r=s.body.getReader(),i=function h(){return r.read().then(function(c){if(c.done)return o.dataLength&&l(d,g,o.flush(),s),Promise.resolve(new ArrayBuffer(0));var S=c.value,P=S.length;return d.loaded+=P,P<v||o.dataLength?(o.push(S),o.dataLength>=v&&l(d,g,o.flush(),s)):l(d,g,S,s),h()}).catch(function(){return Promise.reject()})};return i()},t}();function _(t,a){var f={method:"GET",mode:"cors",credentials:"same-origin",signal:a};return t.rangeEnd&&(f.headers=new self.Headers({Range:"bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)})),f}function n(t,a){return new self.Request(t.url,a)}var e=function(t){M(a,t);function a(f,s,d){var g;return g=t.call(this,f)||this,g.code=void 0,g.details=void 0,g.code=s,g.details=d,g}return a}(R(Error));b.default=T},"./src/utils/imsc1-ttml-parser.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"IMSC1_CODEC",function(){return u}),m.d(b,"parseIMSC1",function(){return T});var I=m("./src/utils/mp4-tools.ts"),L=m("./src/utils/vttparser.ts"),D=m("./src/utils/vttcue.ts"),M=m("./src/demux/id3.ts"),R=m("./src/utils/timescale-conversion.ts"),O=m("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign||function(l){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(l[i]=r[i])}return l},A.apply(this,arguments)}var u="stpp.ttml.im1t",y=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,E=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,p={left:"start",center:"center",right:"end",start:"start",end:"end"};function T(l,o,r,i,h){var c=Object(I.findBox)(new Uint8Array(l),["mdat"]);if(c.length===0){h(new Error("Could not parse IMSC1 mdat"));return}var S=c[0],P=Object(M.utf8ArrayToStr)(new Uint8Array(l,S.start,S.end-S.start)),C=Object(R.toTimescaleFromScale)(o,1,r);try{i(_(P,C))}catch(x){h(x)}}function _(l,o){var r=new DOMParser,i=r.parseFromString(l,"text/xml"),h=i.getElementsByTagName("tt")[0];if(!h)throw new Error("Invalid ttml");var c={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},S=Object.keys(c).reduce(function(F,U){return F[U]=h.getAttribute("ttp:"+U)||c[U],F},{}),P=h.getAttribute("xml:space")!=="preserve",C=e(n(h,"styling","style")),x=e(n(h,"layout","region")),B=n(h,"body","[begin]");return[].map.call(B,function(F){var U=t(F,P);if(!U||!F.hasAttribute("begin"))return null;var w=d(F.getAttribute("begin"),S),k=d(F.getAttribute("dur"),S),K=d(F.getAttribute("end"),S);if(w===null)throw s(F);if(K===null){if(k===null)throw s(F);K=w+k}var N=new D.default(w-o,K-o,U);N.id=Object(O.generateCueId)(N.startTime,N.endTime,N.text);var G=x[F.getAttribute("region")],H=C[F.getAttribute("style")];N.position=10,N.size=80;var V=a(G,H),z=V.textAlign;if(z){var Q=p[z];Q&&(N.lineAlign=Q),N.align=z}return A(N,V),N}).filter(function(F){return F!==null})}function n(l,o,r){var i=l.getElementsByTagName(o)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function e(l){return l.reduce(function(o,r){var i=r.getAttribute("xml:id");return i&&(o[i]=r),o},{})}function t(l,o){return[].slice.call(l.childNodes).reduce(function(r,i,h){var c;return i.nodeName==="br"&&h?r+`
`:(c=i.childNodes)!==null&&c!==void 0&&c.length?t(i,o):o?r+i.textContent.trim().replace(/\s+/g," "):r+i.textContent},"")}function a(l,o){var r="http://www.w3.org/ns/ttml#styling",i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return i.reduce(function(h,c){var S=f(o,r,c)||f(l,r,c);return S&&(h[c]=S),h},{})}function f(l,o,r){return l.hasAttributeNS(o,r)?l.getAttributeNS(o,r):null}function s(l){return new Error("Could not parse ttml timestamp "+l)}function d(l,o){if(!l)return null;var r=Object(L.parseTimeStamp)(l);return r===null&&(y.test(l)?r=g(l,o):E.test(l)&&(r=v(l,o))),r}function g(l,o){var r=y.exec(l),i=(r[4]|0)+(r[5]|0)/o.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+i/o.frameRate}function v(l,o){var r=E.exec(l),i=Number(r[1]),h=r[2];switch(h){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/o.frameRate;case"t":return i/o.tickRate}return i}},"./src/utils/logger.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"enableLogs",function(){return O}),m.d(b,"logger",function(){return A});var I=function(){},L={trace:I,debug:I,log:I,warn:I,info:I,error:I},D=L;function M(u){var y=self.console[u];return y?y.bind(self.console,"["+u+"] >"):I}function R(u){for(var y=arguments.length,E=new Array(y>1?y-1:0),p=1;p<y;p++)E[p-1]=arguments[p];E.forEach(function(T){D[T]=u[T]?u[T].bind(u):M(T)})}function O(u){if(self.console&&u===!0||typeof u=="object"){R(u,"debug","log","info","warn","error");try{D.log()}catch{D=L}}else D=L}var A=D},"./src/utils/mediakeys-helper.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"KeySystems",function(){return I}),m.d(b,"requestMediaKeySystemAccess",function(){return L});var I;(function(D){D.WIDEVINE="com.widevine.alpha",D.PLAYREADY="com.microsoft.playready"})(I||(I={}));var L=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"getMediaSource",function(){return I});function I(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"bin2str",function(){return R}),m.d(b,"readUint16",function(){return O}),m.d(b,"readUint32",function(){return A}),m.d(b,"writeUint32",function(){return u}),m.d(b,"findBox",function(){return y}),m.d(b,"parseSegmentIndex",function(){return E}),m.d(b,"parseInitSegment",function(){return p}),m.d(b,"getStartDTS",function(){return T}),m.d(b,"getDuration",function(){return _}),m.d(b,"computeRawDurationFromSamples",function(){return n}),m.d(b,"offsetStartDTS",function(){return e}),m.d(b,"segmentValidRange",function(){return t}),m.d(b,"appendUint8Array",function(){return a});var I=m("./src/utils/typed-array.ts"),L=m("./src/loader/fragment.ts"),D=Math.pow(2,32)-1,M=[].push;function R(f){return String.fromCharCode.apply(null,f)}function O(f,s){"data"in f&&(s+=f.start,f=f.data);var d=f[s]<<8|f[s+1];return d<0?65536+d:d}function A(f,s){"data"in f&&(s+=f.start,f=f.data);var d=f[s]<<24|f[s+1]<<16|f[s+2]<<8|f[s+3];return d<0?4294967296+d:d}function u(f,s,d){"data"in f&&(s+=f.start,f=f.data),f[s]=d>>24,f[s+1]=d>>16&255,f[s+2]=d>>8&255,f[s+3]=d&255}function y(f,s){var d=[];if(!s.length)return d;var g,v,l;"data"in f?(g=f.data,v=f.start,l=f.end):(g=f,v=0,l=g.byteLength);for(var o=v;o<l;){var r=A(g,o),i=R(g.subarray(o+4,o+8)),h=r>1?o+r:l;if(i===s[0])if(s.length===1)d.push({data:g,start:o+8,end:h});else{var c=y({data:g,start:o+8,end:h},s.slice(1));c.length&&M.apply(d,c)}o=h}return d}function E(f){var s=y(f,["moov"]),d=s[0],g=d?d.end:null,v=y(f,["sidx"]);if(!v||!v[0])return null;var l=[],o=v[0],r=o.data[0],i=r===0?8:16,h=A(o,i);i+=4;var c=0,S=0;r===0?i+=8:i+=16,i+=2;var P=o.end+S,C=O(o,i);i+=2;for(var x=0;x<C;x++){var B=i,F=A(o,B);B+=4;var U=F&2147483647,w=(F&2147483648)>>>31;if(w===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var k=A(o,B);B+=4,l.push({referenceSize:U,subsegmentDuration:k,info:{duration:k/h,start:P,end:P+U-1}}),P+=U,B+=4,i=B}return{earliestPresentationTime:c,timescale:h,version:r,referencesCount:C,references:l,moovEndOffset:g}}function p(f){for(var s=[],d=y(f,["moov","trak"]),g=0;g<d.length;g++){var v=d[g],l=y(v,["tkhd"])[0];if(l){var o=l.data[l.start],r=o===0?12:20,i=A(l,r),h=y(v,["mdia","mdhd"])[0];if(h){o=h.data[h.start],r=o===0?12:20;var c=A(h,r),S=y(v,["mdia","hdlr"])[0];if(S){var P=R(S.data.subarray(S.start+8,S.start+12)),C={soun:L.ElementaryStreamTypes.AUDIO,vide:L.ElementaryStreamTypes.VIDEO}[P];if(C){var x=y(v,["mdia","minf","stbl","stsd"])[0],B=void 0;x&&(B=R(x.data.subarray(x.start+12,x.start+16))),s[i]={timescale:c,type:C},s[C]={timescale:c,id:i,codec:B}}}}}}var F=y(f,["moov","mvex","trex"]);return F.forEach(function(U){var w=A(U,4),k=s[w];k&&(k.default={duration:A(U,12),flags:A(U,20)})}),s}function T(f,s){return y(s,["moof","traf"]).reduce(function(d,g){var v=y(g,["tfdt"])[0],l=v.data[v.start],o=y(g,["tfhd"]).reduce(function(r,i){var h=A(i,4),c=f[h];if(c){var S=A(v,4);l===1&&(S*=Math.pow(2,32),S+=A(v,8));var P=c.timescale||9e4,C=S/P;if(isFinite(C)&&(r===null||C<r))return C}return r},null);return o!==null&&isFinite(o)&&(d===null||o<d)?o:d},null)||0}function _(f,s){for(var d=0,g=0,v=0,l=y(f,["moof","traf"]),o=0;o<l.length;o++){var r=l[o],i=y(r,["tfhd"])[0],h=A(i,4),c=s[h];if(!!c){var S=c.default,P=A(i,0)|(S==null?void 0:S.flags),C=S==null?void 0:S.duration;P&8&&(P&2?C=A(i,12):C=A(i,8));for(var x=c.timescale||9e4,B=y(r,["trun"]),F=0;F<B.length;F++){if(C){var U=A(B[F],4);d=C*U}else d=n(B[F]);c.type===L.ElementaryStreamTypes.VIDEO?g+=d/x:c.type===L.ElementaryStreamTypes.AUDIO&&(v+=d/x)}}}if(g===0&&v===0){var w=E(f);if(w!=null&&w.references)return w.references.reduce(function(k,K){return k+K.info.duration||0},0)}return g||v}function n(f){var s=A(f,0),d=8;s&1&&(d+=4),s&4&&(d+=4);for(var g=0,v=A(f,4),l=0;l<v;l++){if(s&256){var o=A(f,d);g+=o,d+=4}s&512&&(d+=4),s&1024&&(d+=4),s&2048&&(d+=4)}return g}function e(f,s,d){y(s,["moof","traf"]).forEach(function(g){y(g,["tfhd"]).forEach(function(v){var l=A(v,4),o=f[l];if(!!o){var r=o.timescale||9e4;y(g,["tfdt"]).forEach(function(i){var h=i.data[i.start],c=A(i,4);if(h===0)u(i,4,c-d*r);else{c*=Math.pow(2,32),c+=A(i,8),c-=d*r,c=Math.max(c,0);var S=Math.floor(c/(D+1)),P=Math.floor(c%(D+1));u(i,4,S),u(i,8,P)}})}})})}function t(f){var s={valid:null,remainder:null},d=y(f,["moof"]);if(d){if(d.length<2)return s.remainder=f,s}else return s;var g=d[d.length-1];return s.valid=Object(I.sliceUint8)(f,0,g.start-8),s.remainder=Object(I.sliceUint8)(f,g.start-8),s}function a(f,s){var d=new Uint8Array(f.length+s.length);return d.set(f),d.set(s,f.length),d}},"./src/utils/output-filter.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"default",function(){return I});var I=function(){function L(M,R){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=M,this.trackName=R}var D=L.prototype;return D.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},D.newCue=function(R,O,A){(this.startTime===null||this.startTime>R)&&(this.startTime=R),this.endTime=O,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},D.reset=function(){this.cueRanges=[]},L}()},"./src/utils/texttrack-utils.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"sendAddTrackEvent",function(){return L}),m.d(b,"addCueToTrack",function(){return D}),m.d(b,"clearCurrentCues",function(){return M}),m.d(b,"removeCuesInRange",function(){return R}),m.d(b,"getCuesInRange",function(){return A});var I=m("./src/utils/logger.ts");function L(u,y){var E;try{E=new Event("addtrack")}catch{E=document.createEvent("Event"),E.initEvent("addtrack",!1,!1)}E.track=u,y.dispatchEvent(E)}function D(u,y){var E=u.mode;if(E==="disabled"&&(u.mode="hidden"),u.cues&&!u.cues.getCueById(y.id))try{if(u.addCue(y),!u.cues.getCueById(y.id))throw new Error("addCue is failed for: "+y)}catch(T){I.logger.debug("[texttrack-utils]: "+T);var p=new self.TextTrackCue(y.startTime,y.endTime,y.text);p.id=y.id,u.addCue(p)}E==="disabled"&&(u.mode=E)}function M(u){var y=u.mode;if(y==="disabled"&&(u.mode="hidden"),u.cues)for(var E=u.cues.length;E--;)u.removeCue(u.cues[E]);y==="disabled"&&(u.mode=y)}function R(u,y,E){var p=u.mode;if(p==="disabled"&&(u.mode="hidden"),u.cues&&u.cues.length>0)for(var T=A(u.cues,y,E),_=0;_<T.length;_++)u.removeCue(T[_]);p==="disabled"&&(u.mode=p)}function O(u,y){if(y<u[0].startTime)return 0;var E=u.length-1;if(y>u[E].endTime)return-1;for(var p=0,T=E;p<=T;){var _=Math.floor((T+p)/2);if(y<u[_].startTime)T=_-1;else if(y>u[_].startTime&&p<E)p=_+1;else return _}return u[p].startTime-y<y-u[T].startTime?p:T}function A(u,y,E){var p=[],T=O(u,y);if(T>-1)for(var _=T,n=u.length;_<n;_++){var e=u[_];if(e.startTime>=y&&e.endTime<=E)p.push(e);else if(e.startTime>E)return p}return p}},"./src/utils/time-ranges.ts":function(W,b,m){"use strict";m.r(b);var I={toString:function(D){for(var M="",R=D.length,O=0;O<R;O++)M+="["+D.start(O).toFixed(3)+","+D.end(O).toFixed(3)+"]";return M}};b.default=I},"./src/utils/timescale-conversion.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"toTimescaleFromBase",function(){return L}),m.d(b,"toTimescaleFromScale",function(){return D}),m.d(b,"toMsFromMpegTsClock",function(){return M}),m.d(b,"toMpegTsClockFromTimescale",function(){return R});var I=9e4;function L(O,A,u,y){u===void 0&&(u=1),y===void 0&&(y=!1);var E=O*A*u;return y?Math.round(E):E}function D(O,A,u,y){return u===void 0&&(u=1),y===void 0&&(y=!1),L(O,A,1/u,y)}function M(O,A){return A===void 0&&(A=!1),L(O,1e3,1/I,A)}function R(O,A){return A===void 0&&(A=1),L(O,I,1/A)}},"./src/utils/typed-array.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"sliceUint8",function(){return I});function I(L,D,M){return Uint8Array.prototype.slice?L.slice(D,M):new Uint8Array(Array.prototype.slice.call(L,D,M))}},"./src/utils/vttcue.ts":function(W,b,m){"use strict";m.r(b),b.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var I=["","lr","rl"],L=["start","middle","end","left","right"];function D(u,y){if(typeof y!="string"||!Array.isArray(u))return!1;var E=y.toLowerCase();return~u.indexOf(E)?E:!1}function M(u){return D(I,u)}function R(u){return D(L,u)}function O(u){for(var y=arguments.length,E=new Array(y>1?y-1:0),p=1;p<y;p++)E[p-1]=arguments[p];for(var T=1;T<arguments.length;T++){var _=arguments[T];for(var n in _)u[n]=_[n]}return u}function A(u,y,E){var p=this,T={enumerable:!0};p.hasBeenReset=!1;var _="",n=!1,e=u,t=y,a=E,f=null,s="",d=!0,g="auto",v="start",l=50,o="middle",r=50,i="middle";Object.defineProperty(p,"id",O({},T,{get:function(){return _},set:function(c){_=""+c}})),Object.defineProperty(p,"pauseOnExit",O({},T,{get:function(){return n},set:function(c){n=!!c}})),Object.defineProperty(p,"startTime",O({},T,{get:function(){return e},set:function(c){if(typeof c!="number")throw new TypeError("Start time must be set to a number.");e=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"endTime",O({},T,{get:function(){return t},set:function(c){if(typeof c!="number")throw new TypeError("End time must be set to a number.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"text",O({},T,{get:function(){return a},set:function(c){a=""+c,this.hasBeenReset=!0}})),Object.defineProperty(p,"region",O({},T,{get:function(){return f},set:function(c){f=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"vertical",O({},T,{get:function(){return s},set:function(c){var S=M(c);if(S===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=S,this.hasBeenReset=!0}})),Object.defineProperty(p,"snapToLines",O({},T,{get:function(){return d},set:function(c){d=!!c,this.hasBeenReset=!0}})),Object.defineProperty(p,"line",O({},T,{get:function(){return g},set:function(c){if(typeof c!="number"&&c!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");g=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"lineAlign",O({},T,{get:function(){return v},set:function(c){var S=R(c);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");v=S,this.hasBeenReset=!0}})),Object.defineProperty(p,"position",O({},T,{get:function(){return l},set:function(c){if(c<0||c>100)throw new Error("Position must be between 0 and 100.");l=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"positionAlign",O({},T,{get:function(){return o},set:function(c){var S=R(c);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");o=S,this.hasBeenReset=!0}})),Object.defineProperty(p,"size",O({},T,{get:function(){return r},set:function(c){if(c<0||c>100)throw new Error("Size must be between 0 and 100.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(p,"align",O({},T,{get:function(){return i},set:function(c){var S=R(c);if(!S)throw new SyntaxError("An invalid or illegal string was specified.");i=S,this.hasBeenReset=!0}})),p.displayState=void 0}return A.prototype.getCueAsHTML=function(){var u=self.WebVTT;return u.convertCueToDOMTree(self,this.text)},A}()},"./src/utils/vttparser.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"parseTimeStamp",function(){return D}),m.d(b,"fixLineBreaks",function(){return y}),m.d(b,"VTTParser",function(){return E});var I=m("./src/utils/vttcue.ts"),L=function(){function p(){}var T=p.prototype;return T.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},p}();function D(p){function T(n,e,t,a){return(n|0)*3600+(e|0)*60+(t|0)+parseFloat(a||0)}var _=p.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return _?parseFloat(_[2])>59?T(_[2],_[3],0,_[4]):T(_[1],_[2],_[3],_[4]):null}var M=function(){function p(){this.values=Object.create(null)}var T=p.prototype;return T.set=function(n,e){!this.get(n)&&e!==""&&(this.values[n]=e)},T.get=function(n,e,t){return t?this.has(n)?this.values[n]:e[t]:this.has(n)?this.values[n]:e},T.has=function(n){return n in this.values},T.alt=function(n,e,t){for(var a=0;a<t.length;++a)if(e===t[a]){this.set(n,e);break}},T.integer=function(n,e){/^-?\d+$/.test(e)&&this.set(n,parseInt(e,10))},T.percent=function(n,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var t=parseFloat(e);if(t>=0&&t<=100)return this.set(n,t),!0}return!1},p}();function R(p,T,_,n){var e=n?p.split(n):[p];for(var t in e)if(typeof e[t]=="string"){var a=e[t].split(_);if(a.length===2){var f=a[0],s=a[1];T(f,s)}}}var O=new I.default(0,0,""),A=O.align==="middle"?"middle":"center";function u(p,T,_){var n=p;function e(){var f=D(p);if(f===null)throw new Error("Malformed timestamp: "+n);return p=p.replace(/^[^\sa-zA-Z-]+/,""),f}function t(f,s){var d=new M;R(f,function(l,o){var r;switch(l){case"region":for(var i=_.length-1;i>=0;i--)if(_[i].id===o){d.set(l,_[i].region);break}break;case"vertical":d.alt(l,o,["rl","lr"]);break;case"line":r=o.split(","),d.integer(l,r[0]),d.percent(l,r[0])&&d.set("snapToLines",!1),d.alt(l,r[0],["auto"]),r.length===2&&d.alt("lineAlign",r[1],["start",A,"end"]);break;case"position":r=o.split(","),d.percent(l,r[0]),r.length===2&&d.alt("positionAlign",r[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":d.percent(l,o);break;case"align":d.alt(l,o,["start",A,"end","left","right"]);break}},/:/,/\s/),s.region=d.get("region",null),s.vertical=d.get("vertical","");var g=d.get("line","auto");g==="auto"&&O.line===-1&&(g=-1),s.line=g,s.lineAlign=d.get("lineAlign","start"),s.snapToLines=d.get("snapToLines",!0),s.size=d.get("size",100),s.align=d.get("align",A);var v=d.get("position","auto");v==="auto"&&O.position===50&&(v=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=v}function a(){p=p.replace(/^\s+/,"")}if(a(),T.startTime=e(),a(),p.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);p=p.substr(3),a(),T.endTime=e(),a(),t(p,T)}function y(p){return p.replace(/<br(?: \/)?>/gi,`
`)}var E=function(){function p(){this.state="INITIAL",this.buffer="",this.decoder=new L,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var T=p.prototype;return T.parse=function(n){var e=this;n&&(e.buffer+=e.decoder.decode(n,{stream:!0}));function t(){var v=e.buffer,l=0;for(v=y(v);l<v.length&&v[l]!=="\r"&&v[l]!==`
`;)++l;var o=v.substr(0,l);return v[l]==="\r"&&++l,v[l]===`
`&&++l,e.buffer=v.substr(l),o}function a(v){R(v,function(l,o){},/:/)}try{var f="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;f=t();var s=f.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var d=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(d?d=!1:f=t(),e.state){case"HEADER":/:/.test(f)?a(f):f||(e.state="ID");continue;case"NOTE":f||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(f)){e.state="NOTE";break}if(!f)continue;if(e.cue=new I.default(0,0,""),e.state="CUE",f.indexOf("-->")===-1){e.cue.id=f;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{u(f,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var g=f.indexOf("-->")!==-1;if(!f||g&&(d=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=f}continue;case"BADCUE":f||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},T.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){n.onparsingerror&&n.onparsingerror(e)}return n.onflush&&n.onflush(),this},p}()},"./src/utils/webvtt-parser.ts":function(W,b,m){"use strict";m.r(b),m.d(b,"generateCueId",function(){return E}),m.d(b,"parseWebVTT",function(){return T});var I=m("./src/polyfills/number.ts"),L=m("./src/utils/vttparser.ts"),D=m("./src/demux/id3.ts"),M=m("./src/utils/timescale-conversion.ts"),R=m("./src/remux/mp4-remuxer.ts"),O=/\r\n|\n\r|\n|\r/g,A=function(n,e,t){return t===void 0&&(t=0),n.substr(t,e.length)===e},u=function(n){var e=parseInt(n.substr(-3)),t=parseInt(n.substr(-6,2)),a=parseInt(n.substr(-9,2)),f=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(I.isFiniteNumber)(e)||!Object(I.isFiniteNumber)(t)||!Object(I.isFiniteNumber)(a)||!Object(I.isFiniteNumber)(f))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return e+=1e3*t,e+=60*1e3*a,e+=60*60*1e3*f,e},y=function(n){for(var e=5381,t=n.length;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()};function E(_,n,e){return y(_.toString())+y(n.toString())+y(e)}var p=function(n,e,t){var a=n[e],f=n[a.prevCC];if(!f||!f.new&&a.new){n.ccOffset=n.presentationOffset=a.start,a.new=!1;return}for(;(s=f)!==null&&s!==void 0&&s.new;){var s;n.ccOffset+=a.start-f.start,a.new=!1,a=f,f=n[a.prevCC]}n.presentationOffset=t};function T(_,n,e,t,a,f,s,d){var g=new L.VTTParser,v=Object(D.utf8ArrayToStr)(new Uint8Array(_)).trim().replace(O,`
`).split(`
`),l=[],o=Object(M.toMpegTsClockFromTimescale)(n,e),r="00:00.000",i=0,h=0,c,S=!0,P=!1;g.oncue=function(C){var x=t[a],B=t.ccOffset,F=(i-o)/9e4;if(x!=null&&x.new&&(h!==void 0?B=t.ccOffset=x.start:p(t,a,F)),F&&(B=F-t.presentationOffset),P){var U=C.endTime-C.startTime,w=Object(R.normalizePts)((C.startTime+B-h)*9e4,f*9e4)/9e4;C.startTime=w,C.endTime=w+U}var k=C.text.trim();C.text=decodeURIComponent(encodeURIComponent(k)),C.id||(C.id=E(C.startTime,C.endTime,k)),C.endTime>0&&l.push(C)},g.onparsingerror=function(C){c=C},g.onflush=function(){if(c){d(c);return}s(l)},v.forEach(function(C){if(S)if(A(C,"X-TIMESTAMP-MAP=")){S=!1,P=!0,C.substr(16).split(",").forEach(function(x){A(x,"LOCAL:")?r=x.substr(6):A(x,"MPEGTS:")&&(i=parseInt(x.substr(7)))});try{h=u(r)/1e3}catch(x){P=!1,c=x}return}else C===""&&(S=!1);g.parse(C+`
`)}),g.flush()}},"./src/utils/xhr-loader.ts":function(W,b,m){"use strict";m.r(b);var I=m("./src/utils/logger.ts"),L=m("./src/loader/load-stats.ts"),D=/^age:\s*[\d.]+\s*$/m,M=function(){function R(A){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=A?A.xhrSetup:null,this.stats=new L.LoadStats,this.retryDelay=0}var O=R.prototype;return O.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},O.abortInternal=function(){var u=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),u&&(u.onreadystatechange=null,u.onprogress=null,u.readyState!==4&&(this.stats.aborted=!0,u.abort()))},O.abort=function(){var u;this.abortInternal(),(u=this.callbacks)!==null&&u!==void 0&&u.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},O.load=function(u,y,E){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=u,this.config=y,this.callbacks=E,this.retryDelay=y.retryDelay,this.loadInternal()},O.loadInternal=function(){var u=this.config,y=this.context;if(!!u){var E=this.loader=new self.XMLHttpRequest,p=this.stats;p.loading.first=0,p.loaded=0;var T=this.xhrSetup;try{if(T)try{T(E,y.url)}catch{E.open("GET",y.url,!0),T(E,y.url)}E.readyState||E.open("GET",y.url,!0)}catch(_){this.callbacks.onError({code:E.status,text:_.message},y,E);return}y.rangeEnd&&E.setRequestHeader("Range","bytes="+y.rangeStart+"-"+(y.rangeEnd-1)),E.onreadystatechange=this.readystatechange.bind(this),E.onprogress=this.loadprogress.bind(this),E.responseType=y.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),u.timeout),E.send()}},O.readystatechange=function(){var u=this.context,y=this.loader,E=this.stats;if(!(!u||!y)){var p=y.readyState,T=this.config;if(!E.aborted&&p>=2)if(self.clearTimeout(this.requestTimeout),E.loading.first===0&&(E.loading.first=Math.max(self.performance.now(),E.loading.start)),p===4){y.onreadystatechange=null,y.onprogress=null;var _=y.status;if(_>=200&&_<300){E.loading.end=Math.max(self.performance.now(),E.loading.first);var n,e;if(u.responseType==="arraybuffer"?(n=y.response,e=n.byteLength):(n=y.responseText,e=n.length),E.loaded=E.total=e,!this.callbacks)return;var t=this.callbacks.onProgress;if(t&&t(E,u,n,y),!this.callbacks)return;var a={url:y.responseURL,data:n};this.callbacks.onSuccess(a,E,u,y)}else E.retry>=T.maxRetry||_>=400&&_<499?(I.logger.error(_+" while loading "+u.url),this.callbacks.onError({code:_,text:y.statusText},u,y)):(I.logger.warn(_+" while loading "+u.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,T.maxRetryDelay),E.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),T.timeout)}},O.loadtimeout=function(){I.logger.warn("timeout while loading "+this.context.url);var u=this.callbacks;u&&(this.abortInternal(),u.onTimeout(this.stats,this.context,this.loader))},O.loadprogress=function(u){var y=this.stats;y.loaded=u.loaded,u.lengthComputable&&(y.total=u.total)},O.getCacheAge=function(){var u=null;if(this.loader&&D.test(this.loader.getAllResponseHeaders())){var y=this.loader.getResponseHeader("age");u=y?parseFloat(y):null}return u},R}();b.default=M}}).default})}}),ut=Me({"../playback-core/dist/index.js"(j){var ee=Object.create,W=Object.defineProperty,b=Object.getOwnPropertyDescriptor,m=Object.getOwnPropertyNames,I=Object.getPrototypeOf,L=Object.prototype.hasOwnProperty,D=r=>W(r,"__esModule",{value:!0}),M=(r,i)=>{D(r);for(var h in i)W(r,h,{get:i[h],enumerable:!0})},R=(r,i,h)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of m(i))!L.call(r,c)&&c!=="default"&&W(r,c,{get:()=>i[c],enumerable:!(h=b(i,c))||h.enumerable});return r},O=r=>R(D(W(r!=null?ee(I(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);M(j,{ExtensionMimeTypeMap:()=>p,Hls:()=>u.default,MimeTypeShorthandMap:()=>T,StreamTypes:()=>E,allMediaTypes:()=>n,getStreamTypeConfig:()=>s,getType:()=>f,inferMimeTypeFromURL:()=>a,initialize:()=>o,loadMedia:()=>l,mux:()=>A.default,setupHls:()=>g,setupMux:()=>v,shorthandKeys:()=>_,teardown:()=>d,toMuxVideoURL:()=>t,toPlaybackIdParts:()=>e});var A=O(ot()),u=O(lt()),y=(r,i)=>r in i,E={VOD:"on-demand",LIVE:"live",LL_LIVE:"ll-live"},p={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},T={HLS:p.M3U8},_=Object.keys(T),n=[...Object.values(p),..._,..._.map(r=>r.toUpperCase()),..._.map(r=>r.toLowerCase())],e=r=>{let i=r.indexOf("?");if(i<0)return[r];let h=r.slice(0,i),c=r.slice(i);return[h,c]},t=r=>{if(!r)return;let[i,h=""]=e(r);return`https://stream.mux.com/${i}.m3u8${h}`},a=r=>{let i="";try{i=new URL(r).pathname}catch{console.error("invalid url")}let h=i.lastIndexOf(".");if(h<0)return"";let S=i.slice(h+1).toUpperCase();return y(S,p)?p[S]:""},f=r=>{let i=r.type;if(i){let c=i.toUpperCase();return y(c,T)?T[c]:i}let{src:h}=r;return h?a(h):""},s=r=>r===E.LL_LIVE?{maxFragLookUpTolerance:.001}:{},d=(r,i)=>{i&&(i.detachMedia(),i.destroy()),(r==null?void 0:r.mux)&&(r.mux.destroy(),r.mux)},g=(r,i)=>{var h,c,S;let{debug:P,preferMse:C,streamType:x,startTime:B=-1}=r,F=f(r),U=F===p.M3U8,w=!F||((h=i==null?void 0:i.canPlayType(F))!=null?h:!0),k=u.default.isSupported(),G=((S=(c=window==null?void 0:window.navigator)==null?void 0:c.userAgent)!=null?S:"").toLowerCase().indexOf("android")!==-1&&x===E.LL_LIVE;if(U&&!(!U||w&&!((C||G)&&k))&&k){let V=s(x);return new u.default({debug:P,startPosition:B,...V})}},v=(r,i,h)=>{let{envKey:c}=r;if(c&&i){let{playerInitTime:S,playerSoftwareName:P,playerSoftwareVersion:C,beaconDomain:x,metadata:B,debug:F}=r;A.default.monitor(i,{debug:F,beaconDomain:x,hlsjs:h,Hls:h?u.default:void 0,data:{env_key:c,player_software_name:P,player_software_version:C,player_init_time:S,...B}})}},l=(r,i,h)=>{var c,S,P;if(!i){console.warn("attempting to load media before mediaEl exists");return}let{preferMse:C,streamType:x}=r,B=f(r),F=B===p.M3U8,U=!B||((c=i==null?void 0:i.canPlayType(B))!=null?c:!0),w=u.default.isSupported(),N=((P=(S=window==null?void 0:window.navigator)==null?void 0:S.userAgent)!=null?P:"").toLowerCase().indexOf("android")!==-1&&x===E.LL_LIVE,G=!F||U&&!((C||N)&&w),{src:H}=r;if(i&&U&&G)if(typeof H=="string"){let{startTime:V}=r;if(i.setAttribute("src",H),V){let z=({target:Q})=>{Q.currentTime=V,Q.removeEventListener("loadedmetadata",z)};i.addEventListener("loadedmetadata",z)}}else i.removeAttribute("src");else if(h&&H){h.on(u.default.Events.ERROR,(z,Q)=>{if(Q.fatal)switch(Q.type){case u.default.ErrorTypes.NETWORK_ERROR:console.error("fatal network error encountered, try to recover"),h.startLoad();break;case u.default.ErrorTypes.MEDIA_ERROR:console.error("fatal media error encountered, try to recover"),h.recoverMediaError();break;default:console.error("unrecoverable fatal error encountered, cannot recover (check logs for more info)"),h.destroy();break}});let V=()=>{Array.from(i.textTracks).forEach(z=>{var Q,q;if(!["subtitles","caption"].includes(z.kind)&&z.label==="thumbnails"){if(!((Q=z.cues)==null?void 0:Q.length)){let J=i.querySelector('track[label="thumbnails"]'),te=(q=J==null?void 0:J.getAttribute("src"))!=null?q:"";J==null||J.removeAttribute("src"),setTimeout(()=>{J==null||J.setAttribute("src",te)},0)}z.mode!=="hidden"&&(z.mode="hidden")}})};h.on(u.default.Events.MANIFEST_LOADED,V),h.on(u.default.Events.MEDIA_ATTACHED,V),h.loadSource(H),h.attachMedia(i)}else console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")},o=(r,i,h)=>{d(i,h);let c=g(r,i);return v(r,i,c),l(r,i,c),c}}}),At=Ke(st()),We=document.createElement("template");We.innerHTML=`
<style>
  :host {
    /* Supposed to reset styles. Need to understand the specific effects more */
    all: initial;

    /* display:inline (like the native el) makes it so you can't fill
      the container with the native el */
    display: inline-block;
    box-sizing: border-box;

    width: auto;
    height: auto;
  }

  video {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

</style>

<video crossorigin></video>
`;var Ie=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(We.content.cloneNode(!0));let j=this.nativeEl=this.shadowRoot.querySelector("video");Array.prototype.forEach.call(this.attributes,b=>{this.attributeChangedCallback(b.name,null,b.value)}),j.defaultMuted&&(j.muted=!0),this.querySelectorAll(":scope > track").forEach(b=>{this.nativeEl.appendChild(b.cloneNode())});let ee=(b,m)=>{for(let I of b)I.type==="childList"&&(I.removedNodes.forEach(L=>{this.nativeEl.removeChild(this.nativeEl.querySelector(`track[src="${L.src}"]`))}),I.addedNodes.forEach(L=>{this.nativeEl.appendChild(L.cloneNode())}))};new MutationObserver(ee).observe(this,{childList:!0,subtree:!0})}static get observedAttributes(){let j=[];Object.getOwnPropertyNames(this.prototype).forEach(W=>{let b=!1;try{typeof this.prototype[W]=="function"&&(b=!0)}catch{}!b&&W!==W.toUpperCase()&&j.push(W.toLowerCase())});let ee=Object.getPrototypeOf(this).observedAttributes;return ee&&(j=j.concat(ee)),j}attributeChangedCallback(j,ee,W){let b=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),m=ft(b,j),I=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;m&&!I?typeof this[m]=="boolean"?W===null?this[m]=!1:this[m]=!0:this[m]=W:W===null?this.nativeEl.removeAttribute(j):["id","class"].indexOf(j)===-1&&this.nativeEl.setAttribute(j,W)}connectedCallback(){}},be=[],je=document.createElement("video"),dt=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let j=Object.getPrototypeOf(je);j&&j!==HTMLElement.prototype;j=Object.getPrototypeOf(j))Object.keys(j).forEach(ee=>{dt.indexOf(ee)===-1&&be.push(ee)});be=be.concat(Object.keys(EventTarget.prototype));be.forEach(j=>{if(typeof je[j]=="function")Ie.prototype[j]=function(){return this.nativeEl[j].apply(this.nativeEl,arguments)};else{let W={get(){return this.nativeEl[j]}};j!==j.toUpperCase()&&(W.set=function(b){this.nativeEl[j]=b}),Object.defineProperty(Ie.prototype,j,W)}});function ft(j,ee){let W=null;return j.forEach(b=>{b.toLowerCase()==ee.toLowerCase()&&(W=b)}),W}globalThis.customElements.get("custom-video")||(globalThis.customElements.define("custom-video",Ie),globalThis.CustomVideoElement=Ie);var Ge=Ie,Oe=Ke(ut()),ht=()=>{try{return"0.2.2"}catch{}return"UNKNOWN"},ct=ht(),vt=()=>ct,ne={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_MSE:"prefer-mse",METADATA_VIDEO_ID:"metadata-video-id",METADATA_VIDEO_TITLE:"metadata-video-title",METADATA_VIEWER_USER_ID:"metadata-viewer-user-id",BEACON_DOMAIN:"beacon-domain",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},gt=Object.values(ne),mt=vt(),pt="mux-video",Be=class extends Ge{constructor(){super();this.__metadata={},this.__muxPlayerInitTime=Date.now()}static get observedAttributes(){var j;return[...gt,...(j=Ge.observedAttributes)!=null?j:[]]}get playerSoftwareName(){return pt}get playerSoftwareVersion(){return mt}get hls(){return this.__hls}get mux(){return this.nativeEl.mux}get src(){return this.getAttribute("src")}set src(j){j!==this.src&&(j==null?this.removeAttribute("src"):this.setAttribute("src",j))}get type(){var j;return(j=this.getAttribute(ne.TYPE))!=null?j:void 0}set type(j){j!==this.type&&(j?this.setAttribute(ne.TYPE,j):this.removeAttribute(ne.TYPE))}get debug(){return this.getAttribute(ne.DEBUG)!=null}set debug(j){j!==this.debug&&(j?this.setAttribute(ne.DEBUG,""):this.removeAttribute(ne.DEBUG))}get startTime(){let j=this.getAttribute(ne.START_TIME);if(j==null)return;let ee=+j;return Number.isNaN(ee)?void 0:ee}set startTime(j){j!==this.startTime&&(j==null?this.removeAttribute(ne.START_TIME):this.setAttribute(ne.START_TIME,`${j}`))}get playbackId(){var j;return(j=this.getAttribute(ne.PLAYBACK_ID))!=null?j:void 0}set playbackId(j){j!==this.playbackId&&(j?this.setAttribute(ne.PLAYBACK_ID,j):this.removeAttribute(ne.PLAYBACK_ID))}get envKey(){var j;return(j=this.getAttribute(ne.ENV_KEY))!=null?j:void 0}set envKey(j){j!==this.envKey&&(j?this.setAttribute(ne.ENV_KEY,j):this.removeAttribute(ne.ENV_KEY))}get beaconDomain(){var j;return(j=this.getAttribute(ne.BEACON_DOMAIN))!=null?j:void 0}set beaconDomain(j){j!==this.beaconDomain&&(j?this.setAttribute(ne.BEACON_DOMAIN,j):this.removeAttribute(ne.BEACON_DOMAIN))}get streamType(){var j;return(j=this.getAttribute(ne.STREAM_TYPE))!=null?j:void 0}set streamType(j){j!==this.streamType&&(j?this.setAttribute(ne.STREAM_TYPE,j):this.removeAttribute(ne.STREAM_TYPE))}get preferMSE(){return this.getAttribute(ne.PREFER_MSE)!=null}set preferMSE(j){j?this.setAttribute(ne.PREFER_MSE,""):this.removeAttribute(ne.PREFER_MSE)}get metadata(){let j=this.getAttribute(ne.METADATA_VIDEO_ID),ee=this.getAttribute(ne.METADATA_VIDEO_TITLE),W=this.getAttribute(ne.METADATA_VIEWER_USER_ID);return{...this.__metadata,...j!=null?{video_id:j}:{},...ee!=null?{video_title:ee}:{},...W!=null?{viewer_user_id:W}:{}}}set metadata(j){this.__metadata=j!=null?j:{},this.mux&&this.mux.emit("hb",this.__metadata)}load(){let j=(0,Oe.initialize)(this,this.nativeEl,this.__hls);this.__hls=j}unload(){(0,Oe.teardown)(this.nativeEl,this.__hls),this.__hls=void 0}attributeChangedCallback(j,ee,W){switch(j){case"src":let b=!!ee,m=!!W;!b&&m?this.load():b&&!m?this.unload():b&&m&&(this.unload(),this.load());break;case ne.PLAYBACK_ID:this.src=(0,Oe.toMuxVideoURL)(W!=null?W:void 0);break;case ne.DEBUG:let I=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this.hls&&(this.hls.config.debug=I);break;case ne.METADATA_URL:W&&fetch(W).then(L=>L.json()).then(L=>this.metadata=L).catch(L=>console.error(`Unable to load or parse metadata JSON from metadata-url ${W}!`));break;default:break}super.attributeChangedCallback(j,ee,W)}disconnectedCallback(){this.unload()}connectedCallback(){this.src&&this.load()}};globalThis.customElements.get("mux-video")||(globalThis.customElements.define("mux-video",Be),globalThis.MuxVideoElement=Be);var Et=Be,yt=Oe.PlaybackEngine,Tt=Oe.ExtensionMimeTypeMap,_t=Oe.PlaybackEngine;export{Ue as MuxVideo};
