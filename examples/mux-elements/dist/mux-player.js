var Mn=Object.defineProperty;var On=rt=>Mn(rt,"__esModule",{value:!0});var wt={};On(wt);(()=>{var rt=Object.defineProperty,Zr=v=>rt(v,"__esModule",{value:!0}),It=(v,M)=>{Zr(v);for(var O in M)rt(v,O,{get:M[O],enumerable:!0})},ei={};It(ei,{MediaUIAttributes:()=>K,MediaUIEvents:()=>ne,ReadyStates:()=>ti,TextTrackKinds:()=>He,TextTrackModes:()=>Ne});var ne={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_CAPTIONS_REQUEST:"mediashowcaptionsrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_CAPTIONS_REQUEST:"mediadisablecaptionsrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},K={MEDIA_PAUSED:"media-paused",MEDIA_MUTED:"media-muted",MEDIA_VOLUME_LEVEL:"media-volume-level",MEDIA_VOLUME:"media-volume",MEDIA_IS_PIP:"media-is-pip",MEDIA_CAPTIONS_LIST:"media-captions-list",MEDIA_SUBTITLES_LIST:"media-subtitles-list",MEDIA_CAPTIONS_SHOWING:"media-captions-showing",MEDIA_SUBTITLES_SHOWING:"media-subtitles-showing",MEDIA_IS_FULLSCREEN:"media-is-fullscreen",MEDIA_PLAYBACK_RATE:"media-playback-rate",MEDIA_CURRENT_TIME:"media-current-time",MEDIA_DURATION:"media-duration",MEDIA_PREVIEW_IMAGE:"media-preview-image",MEDIA_PREVIEW_COORDS:"media-preview-coords",MEDIA_CHROME_ATTRIBUTES:"media-chrome-attributes",MEDIA_CONTROLLER:"media-controller",MEDIA_LOADING:"media-loading"},He={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},Ne={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"},ti={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},xe={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:v=1}={})=>`current playback rate ${v}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},Le={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:v=30}={})=>`seek forward ${v} seconds`,SEEK_BACK_N_SECS:({seekOffset:v=30}={})=>`seek back ${v} seconds`},Pn={...xe,...Le},ri={};It(ri,{formatAsTimePhrase:()=>Ge,formatTime:()=>je});var ii=v=>typeof v=="number"&&!Number.isNaN(v)&&Number.isFinite(v),xt=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],ai=(v,M)=>{let O=v===1?xt[M].singular:xt[M].plural;return`${v} ${O}`},Ge=v=>{if(!ii(v))return"";let M=Math.abs(v),O=M!==v,w=new Date(0,0,0,0,0,M,0);return`${[w.getHours(),w.getMinutes(),w.getSeconds()].map((a,D)=>a&&ai(a,D)).filter(a=>a).join(", ")}${O?" remaining":""}`};function je(v,M){let O=!1;v<0&&(O=!0,v=0-v),v=v<0?0:v;let w=Math.floor(v%60),a=Math.floor(v/60%60),D=Math.floor(v/3600),y=Math.floor(M/60%60),b=Math.floor(M/3600);return(isNaN(v)||v===1/0)&&(D=a=w="-"),D=D>0||b>0?D+":":"",a=((D||y>=10)&&a<10?"0"+a:a)+":",w=w<10?"0"+w:w,(O?"-":"")+D+a+w}var Ct={HTMLElement:function(){this.addEventListener=()=>{},this.removeEventListener=()=>{},this.dispatchEvent=()=>{}},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){}},ni={createElement:function(){return new Ct.HTMLElement}},Mt=typeof window=="undefined"||typeof window.customElements=="undefined",ee=Mt?Ct:window,J=Mt?ni:window.document;function ce(v,M){ee.customElements.get(v)||(ee.customElements.define(v,M),ee[M.name]=M)}var Ot=J.createElement("template");Ot.innerHTML=`
<style>
  :host {
    display: inline-block;
    width: auto;
    height: auto;
    vertical-align: middle;
    box-sizing: border-box;
    background: var(--media-control-background, rgba(20,20,30, 0.7));

    padding: 10px;

    /* Vertically center any text */
    font-size: 14px;
    font-weight: bold;
    color: #ffffff;
    text-align: center;

    transition: background 0.15s linear;

    pointer-events: auto;
    cursor: pointer;
    font-family: Arial, sans-serif;
    vertical-align: middle;
  }

  /*
    Only show outline when keyboard focusing.
    https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo
  */
  :host-context([media-keyboard-control]):host(:focus),
  :host-context([media-keyboard-control]):host(:focus-within) {
    box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50,50,70, 0.7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width, 24px);
    height: var(--media-button-icon-height);
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, #eee);
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

  ::slotted(div), ::slotted(span) {
    height: 24px;
  }
</style>
`;var Pt=["Enter"," "],Nt=class extends ee.HTMLElement{static get observedAttributes(){return[K.MEDIA_CONTROLLER]}constructor(v={}){super();let M=this.attachShadow({mode:"open"}),O=Ot.content.cloneNode(!0);this.nativeEl=O;let w=v.slotTemplate;w||(w=J.createElement("template"),w.innerHTML=`<slot>${v.defaultContent||""}</slot>`),this.nativeEl.appendChild(w.content.cloneNode(!0)),M.appendChild(O),this.addEventListener("click",D=>{this.handleClick(D)});let a=D=>{let{key:y}=D;if(!Pt.includes(y)){this.removeEventListener("keyup",a);return}this.handleClick(D)};this.addEventListener("keydown",D=>{let{metaKey:y,altKey:b,key:I}=D;if(y||b||!Pt.includes(I)){this.removeEventListener("keyup",a);return}this.addEventListener("keyup",a)})}attributeChangedCallback(v,M,O){var w,a;if(v===K.MEDIA_CONTROLLER){if(M){let D=J.getElementById(M);(w=D==null?void 0:D.unassociateElement)==null||w.call(D,this)}if(O){let D=J.getElementById(O);(a=D==null?void 0:D.associateElement)==null||a.call(D,this)}}}connectedCallback(){var v;this.setAttribute("role","button"),this.setAttribute("tabindex",0);let M=this.getAttribute(K.MEDIA_CONTROLLER);if(M){let O=J.getElementById(M);(v=O==null?void 0:O.associateElement)==null||v.call(O,this)}}disconnectedCallback(){var v;if(this.getAttribute(K.MEDIA_CONTROLLER)){let M=J.getElementById(mediaControllerId);(v=M==null?void 0:M.unassociateElement)==null||v.call(M,this)}}handleClick(){}};ce("media-chrome-button",Nt);var Ce=Nt,si='<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 18"><defs><style>.cls-1{fill:var(--media-icon-color, #eee);}</style></defs><title>Mux Player SVG Icons_v2</title><path class="cls-1" d="M10.19,11.22a.25.25,0,0,0-.38,0L4.35,17.59a.25.25,0,0,0,.19.41H15.46a.25.25,0,0,0,.19-.41Z"/><path class="cls-1" d="M19,0H1A1,1,0,0,0,0,1V14a1,1,0,0,0,1,1H3.94L5,13.75H1.25V1.25h17.5v12.5H15L16.06,15H19a1,1,0,0,0,1-1V1A1,1,0,0,0,19,0Z"/></svg>',Ft=J.createElement("template");Ft.innerHTML=`
  <style>
  </style>

  <slot name="airplay">${si}</slot>
`;var oi=class extends Ce{static get observedAttributes(){return[...super.observedAttributes]}constructor(v={}){super({slotTemplate:Ft,...v})}connectedCallback(){this.setAttribute("aria-label",Le.AIRPLAY()),super.connectedCallback()}handleClick(v){let M=new ee.CustomEvent(ne.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(M)}};ce("media-airplay-button",oi);var Ut=J.createElement("template");Ut.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      background-color: #000;
    }

    :host(:not([audio])) *[part~=layer] {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    :host(:not([audio])) :is([part~=gestures-layer],[part~=media-layer]) {
      pointer-events: auto;
    }
    
    :host(:not([audio])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    .spacer {
      pointer-events: none;
      background: none;
    }

    /* Position the media element to fill the container */
    ::slotted([slot=media]) {
      width: 100%;
      height: 100%;
    }

    /* Video specific styles */
    :host(:not([audio])) {
      aspect-ratio: var(--media-aspect-ratio, auto 3 / 2);
      width: 720px;
    }

    :host(:not([audio])) .spacer {
      flex-grow: 1;
    }

    @supports not (aspect-ratio: 1 / 1) {
      :host(:not([audio])) {
        height: 480px;
      }
    }

    /* Safari needs this to actually make the element fill the window */
    :host(:-webkit-full-screen) {
      /* Needs to use !important otherwise easy to break */
      width: 100% !important;
      height: 100% !important;
    }

    ::slotted(:not([slot=media])) {
      pointer-events: auto;
    }

    /* Only add these if auto hide is not disabled */
    ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    /* Hide controls when inactive, not paused, not audio and auto hide not disabled */
    :host([user-inactive]:not([${K.MEDIA_PAUSED}]):not([audio])) ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }
  </style>

  <span part="layer media-layer">
    <slot name="media"></slot>
  </span>
  <span part="layer gesture-layer">
    <slot name="gestures-chrome"></slot>
  </span>
  <span part="layer vertical-layer">
    <slot name="top-chrome"></slot>
    <span class="spacer"><slot name="middle-chrome"></slot></span>
    <!-- default, effectively "bottom-chrome" -->
    <slot></slot>
  </span>
  <span part="layer centered-layer">
    <slot name="centered-chrome"></slot>
  </span>
`;var li=Object.values(K),Bt=class extends ee.HTMLElement{constructor(){super();let v=this.attachShadow({mode:"open"});this.shadowRoot.appendChild(Ut.content.cloneNode(!0));let M=(O,w)=>{let a=this.media;for(let D of O)D.type==="childList"&&(D.removedNodes.forEach(y=>{if(y.slot=="media"&&D.target==this){let b=D.previousSibling&&D.previousSibling.previousElementSibling;if(!b||!a)this.mediaUnsetCallback(y);else{let I=b.slot!=="media";for(;(b=b.previousSibling)!==null;)b.slot=="media"&&(I=!1);I&&this.mediaUnsetCallback(y)}}}),a&&D.addedNodes.forEach(y=>{y==a&&this.handleMediaUpdated(a).then(b=>this.mediaSetCallback(b))}))};new MutationObserver(M).observe(this,{childList:!0,subtree:!0})}static get observedAttributes(){return["autohide"].concat(li)}attributeChangedCallback(v,M,O){v.toLowerCase()=="autohide"&&(this.autohide=O)}get media(){let v=this.querySelector(":scope > [slot=media]");return(v==null?void 0:v.nodeName)=="SLOT"&&(v=v.assignedElements({flatten:!0})[0]),v}mediaSetCallback(v){this._mediaClickPlayToggle=M=>{let O=v.paused?ne.MEDIA_PLAY_REQUEST:ne.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ee.CustomEvent(O,{composed:!0,bubbles:!0}))}}handleMediaUpdated(v){let M=a=>Promise.resolve(a),O=a=>(console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',a),Promise.reject(a));if(!v)return O(v);let w=v.nodeName.toLowerCase();return w.includes("-")?ee.customElements.whenDefined(w).then(()=>M(v)):M(v)}mediaUnsetCallback(v){}connectedCallback(){let v=this.getAttribute("audio")!=null?xe.AUDIO_PLAYER():xe.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",v),this.media&&this.handleMediaUpdated(this.media).then(O=>this.mediaSetCallback(O));let M=()=>{this.removeAttribute("user-inactive"),ee.clearTimeout(this.inactiveTimeout),!(this.autohide<0)&&(this.inactiveTimeout=ee.setTimeout(()=>{this.setAttribute("user-inactive","user-inactive")},this.autohide*1e3))};this.addEventListener("keyup",O=>{M()}),this.addEventListener("keyup",O=>{this.setAttribute("media-keyboard-control","media-keyboard-control")}),this.addEventListener("mouseup",O=>{this.removeAttribute("media-keyboard-control")}),this.addEventListener("mousemove",O=>{O.target!==this&&(this.removeAttribute("user-inactive"),ee.clearTimeout(this.inactiveTimeout),O.target===this.media&&M())}),this.addEventListener("mouseout",O=>{this.autohide>-1&&this.setAttribute("user-inactive","user-inactive")})}set autohide(v){v=Number(v),this._autohide=isNaN(v)?0:v}get autohide(){return this._autohide===void 0?2:this._autohide}};ce("media-container-temp",Bt);var ui=Bt,Ee={enter:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange",element:"fullscreenElement",error:"fullscreenerror"};J.fullscreenElement===void 0&&(Ee.enter="webkitRequestFullScreen",Ee.exit=J.webkitExitFullscreen!=null?"webkitExitFullscreen":"webkitCancelFullScreen",Ee.event="webkitfullscreenchange",Ee.element="webkitFullscreenElement",Ee.error="webkitfullscreenerror");function vt(v,M=!1){return v.split("_").map(function(O,w){return(w||M?O[0].toUpperCase():O[0].toLowerCase())+O.slice(1).toLowerCase()}).join("")}var Ht=(v,M,O=".value")=>{let w=v.querySelector(O);!w||(w.textContent=M)},di=(v,M)=>{let O=`slot[name="${M}"]`,w=v.shadowRoot.querySelector(O);return w?w.children:[]},Gt=(v,M)=>di(v,M)[0],jt=(v,M)=>!v||!M?!1:v.contains(M)?!0:[v,...v.querySelectorAll("*")].some(O=>jt(O.shadowRoot,M)),pt=(v="")=>v.split(/\s+/),Kt=(v="")=>{let[M,O]=v.split(":"),w=O?decodeURIComponent(O):void 0;return{language:M,label:w}},ci=(v="",M={})=>pt(v).map(O=>{let w=Kt(O);return{...M,...w}}),hi=v=>Array.isArray(v)?v.map(M=>typeof M=="string"?Kt(M):M):typeof v=="string"?ci(v):[v],fi=({label:v,language:M}={})=>v?`${M}:${encodeURIComponent(v)}`:M,we=(v=[])=>Array.prototype.map.call(v,fi).join(" "),vi=(v,M)=>O=>O[v]===M,Vt=v=>{let M=Object.entries(v).map(([O,w])=>vi(O,w));return O=>M.every(w=>w(O))},it=(v,M=[],O=[])=>{let w=hi(O).map(Vt),a=D=>w.some(y=>y(D));Array.from(M).filter(a).forEach(D=>{D.mode=v})},Qe=(v,M=()=>!0)=>{if(!(v==null?void 0:v.textTracks))return[];let O=typeof M=="function"?M:Vt(M);return Array.from(v.textTracks).filter(O)},{MEDIA_PLAY_REQUEST:pi,MEDIA_PAUSE_REQUEST:gi,MEDIA_MUTE_REQUEST:mi,MEDIA_UNMUTE_REQUEST:yi,MEDIA_VOLUME_REQUEST:Ei,MEDIA_ENTER_FULLSCREEN_REQUEST:bi,MEDIA_EXIT_FULLSCREEN_REQUEST:_i,MEDIA_SEEK_REQUEST:Ti,MEDIA_PREVIEW_REQUEST:Ai,MEDIA_ENTER_PIP_REQUEST:Si,MEDIA_EXIT_PIP_REQUEST:Li,MEDIA_PLAYBACK_RATE_REQUEST:ki}=ne,qt=class extends ui{constructor(){super();this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associatedElements=[],this.associateElement(this);let v={MEDIA_PLAY_REQUEST:()=>this.media.play(),MEDIA_PAUSE_REQUEST:()=>this.media.pause(),MEDIA_MUTE_REQUEST:()=>this.media.muted=!0,MEDIA_UNMUTE_REQUEST:()=>{let M=this.media;M.muted=!1,M.volume===0&&(M.volume=.25)},MEDIA_VOLUME_REQUEST:M=>{let O=this.media,w=M.detail;O.volume=w,w>0&&O.muted&&(O.muted=!1);try{ee.localStorage.setItem("media-chrome-pref-volume",w.toString())}catch{}},MEDIA_ENTER_FULLSCREEN_REQUEST:()=>{let M=this.media;J.pictureInPictureElement&&J.exitPictureInPicture(),super[Ee.enter]?super[Ee.enter]():M.webkitEnterFullscreen?M.webkitEnterFullscreen():M.requestFullscreen?M.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{J[Ee.exit]()},MEDIA_ENTER_PIP_REQUEST:()=>{let M=this.media;!J.pictureInPictureEnabled||(J[Ee.element]&&J[Ee.exit](),M.requestPictureInPicture())},MEDIA_EXIT_PIP_REQUEST:()=>{J.pictureInPictureElement&&J.exitPictureInPicture()},MEDIA_SEEK_REQUEST:M=>{let O=this.media,w=M.detail;(O.readyState>0||O.readyState===void 0)&&(O.currentTime=w)},MEDIA_PLAYBACK_RATE_REQUEST:M=>{this.media.playbackRate=M.detail},MEDIA_PREVIEW_REQUEST:M=>{let O=this.media;if(!O)return;let[w]=Qe(O,{kind:He.METADATA,label:"thumbnails"});if(!(w&&w.cues))return;let a=M.detail,D=Array.prototype.find.call(w.cues,I=>I.startTime>=a);if(!D)return;let y=new URL(D.text),b=new URLSearchParams(y.hash).get("#xywh");this.propagateMediaState(K.MEDIA_PREVIEW_IMAGE,y.href),this.propagateMediaState(K.MEDIA_PREVIEW_COORDS,b.split(",").join(" "))},MEDIA_SHOW_CAPTIONS_REQUEST:M=>{let O=this.captionTracks,{detail:w=[]}=M;it(Ne.SHOWING,O,w)},MEDIA_DISABLE_CAPTIONS_REQUEST:M=>{let O=this.captionTracks,{detail:w=[]}=M;it(Ne.DISABLED,O,w)},MEDIA_SHOW_SUBTITLES_REQUEST:M=>{let O=this.subtitleTracks,{detail:w=[]}=M;it(Ne.SHOWING,O,w)},MEDIA_DISABLE_SUBTITLES_REQUEST:M=>{let O=this.subtitleTracks,{detail:w=[]}=M;it(Ne.DISABLED,O,w)},MEDIA_AIRPLAY_REQUEST:M=>{let{media:O}=this;if(O){if(!(O.webkitShowPlaybackTargetPicker&&ee.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}O.webkitShowPlaybackTargetPicker()}}};Object.keys(v).forEach(M=>{let O=`_handle${vt(M,!0)}`;this[O]=w=>{if(w.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}v[M](w,this.media)},this.addEventListener(ne[M],this[O])}),this._mediaStatePropagators={"play,pause":()=>{this.propagateMediaState(K.MEDIA_PAUSED,this.paused)},volumechange:()=>{this.propagateMediaState(K.MEDIA_MUTED,this.muted),this.propagateMediaState(K.MEDIA_VOLUME,this.volume),this.propagateMediaState(K.MEDIA_VOLUME_LEVEL,this.volumeLevel)},[Ee.event]:()=>{var M;let O=J[Ee.element];this.propagateMediaState(K.MEDIA_IS_FULLSCREEN,O===((M=this.getRootNode().host)!=null?M:this))},"enterpictureinpicture,leavepictureinpicture":M=>{let O;M?O=M.type=="enterpictureinpicture":O=this.isPip,this.propagateMediaState(K.MEDIA_IS_PIP,O)},"timeupdate,loadedmetadata":()=>{this.propagateMediaState(K.MEDIA_CURRENT_TIME,this.currentTime)},"durationchange,loadedmetadata":()=>{this.propagateMediaState(K.MEDIA_DURATION,this.duration)},ratechange:()=>{this.propagateMediaState(K.MEDIA_PLAYBACK_RATE,this.playbackRate)},"waiting,playing":()=>{var M;let O=((M=this.media)==null?void 0:M.readyState)<3;this.propagateMediaState(K.MEDIA_LOADING,O)}},this._textTrackMediaStatePropagators={"addtrack,removetrack":()=>{this.propagateMediaState(K.MEDIA_CAPTIONS_LIST,we(this.captionTracks)||void 0),this.propagateMediaState(K.MEDIA_SUBTITLES_LIST,we(this.subtitleTracks)||void 0),this.propagateMediaState(K.MEDIA_CAPTIONS_SHOWING,we(this.showingCaptionTracks)||void 0),this.propagateMediaState(K.MEDIA_SUBTITLES_SHOWING,we(this.showingSubtitleTracks)||void 0)},change:()=>{this.propagateMediaState(K.MEDIA_CAPTIONS_SHOWING,we(this.showingCaptionTracks)||void 0),this.propagateMediaState(K.MEDIA_SUBTITLES_SHOWING,we(this.showingSubtitleTracks)||void 0)}}}mediaSetCallback(v){super.mediaSetCallback(v),Object.keys(this._mediaStatePropagators).forEach(M=>{let O=M.split(","),w=this._mediaStatePropagators[M];O.forEach(a=>{(a==Ee.event?this.getRootNode():v).addEventListener(a,w)}),w()}),Object.entries(this._textTrackMediaStatePropagators).forEach(([M,O])=>{M.split(",").forEach(w=>{v.textTracks&&v.textTracks.addEventListener(w,O)}),O()});try{let M=ee.localStorage.getItem("media-chrome-pref-volume");M!==null&&(v.volume=M)}catch(M){console.debug("Error getting volume pref",M)}}mediaUnsetCallback(v){super.mediaUnsetCallback(v),Object.keys(this._mediaStatePropagators).forEach(M=>{let O=M.split(","),w=this._mediaStatePropagators[M];O.forEach(a=>{(a==Ee.event?this.getRootNode():v).removeEventListener(a,w)})}),Object.entries(this._textTrackMediaStatePropagators).forEach(([M,O])=>{M.split(",").forEach(w=>{v.textTracks&&v.textTracks.removeEventListener(w,O)}),O()}),this.propagateMediaState(K.MEDIA_PAUSED,!0)}propagateMediaState(v,M){ke(this.mediaStateReceivers,v,M)}associateElement(v){if(!v)return;let{associatedElementSubscriptions:M}=this;if(M.has(v))return;let O=this.registerMediaStateReceiver.bind(this),w=this.unregisterMediaStateReceiver.bind(this),a=Ii(v,O,w);Object.keys(ne).forEach(D=>{v.addEventListener(ne[D],this[`_handle${vt(D,!0)}`])}),M.set(v,a)}unassociateElement(v){if(!v)return;let{associatedElementSubscriptions:M}=this;!M.has(v)||(M.get(v)(),M.delete(v),Object.keys(ne).forEach(O=>{v.removeEventListener(ne[O],this[`_handle${vt(O,!0)}`])}))}registerMediaStateReceiver(v){if(!v)return;let M=this.mediaStateReceivers;M.indexOf(v)>-1||(M.push(v),this.media&&(ke([v],K.MEDIA_CAPTIONS_LIST,we(this.captionTracks)||void 0),ke([v],K.MEDIA_SUBTITLES_LIST,we(this.subtitleTracks)||void 0),ke([v],K.MEDIA_CAPTIONS_SHOWING,we(this.showingCaptionTracks)||void 0),ke([v],K.MEDIA_SUBTITLES_SHOWING,we(this.showingSubtitleTracks)||void 0),ke([v],K.MEDIA_PAUSED,this.paused),ke([v],K.MEDIA_MUTED,this.muted),ke([v],K.MEDIA_VOLUME,this.volume),ke([v],K.MEDIA_VOLUME_LEVEL,this.volumeLevel),ke([v],K.MEDIA_CURRENT_TIME,this.currentTime),ke([v],K.MEDIA_DURATION,this.duration),ke([v],K.MEDIA_PLAYBACK_RATE,this.playbackRate)))}unregisterMediaStateReceiver(v){let M=this.mediaStateReceivers,O=M.indexOf(v);O<0||M.splice(O,1)}play(){this.dispatchEvent(new ee.CustomEvent(pi))}pause(){this.dispatchEvent(new ee.CustomEvent(gi))}get paused(){return this.media?this.media.paused:!0}get muted(){return!!(this.media&&this.media.muted)}set muted(v){let M=v?mi:yi;this.dispatchEvent(new ee.CustomEvent(M))}get volume(){let v=this.media;return v?v.volume:1}set volume(v){this.dispatchEvent(new ee.CustomEvent(Ei,{detail:v}))}get volumeLevel(){let v="high";if(!this.media)return v;let{muted:M,volume:O}=this.media;return O===0||M?v="off":O<.5?v="low":O<.75&&(v="medium"),v}requestFullscreen(){this.dispatchEvent(new ee.CustomEvent(bi))}exitFullscreen(){this.dispatchEvent(new ee.CustomEvent(_i))}get currentTime(){let v=this.media;return v?v.currentTime:0}set currentTime(v){this.dispatchEvent(new ee.CustomEvent(Ti,{detail:v}))}get duration(){let v=this.media;return v?v.duration:NaN}get playbackRate(){let v=this.media;return v?v.playbackRate:1}set playbackRate(v){this.dispatchEvent(new ee.CustomEvent(ki,{detail:v}))}get subtitleTracks(){return Qe(this.media,{kind:He.SUBTITLES})}get captionTracks(){return Qe(this.media,{kind:He.CAPTIONS})}get showingSubtitleTracks(){return Qe(this.media,{kind:He.SUBTITLES,mode:Ne.SHOWING})}get showingCaptionTracks(){return Qe(this.media,{kind:He.CAPTIONS,mode:Ne.SHOWING})}get isPip(){var v;let M=(v=this.getRootNode().pictureInPictureElement)!=null?v:J.pictureInPictureElement;return this.media&&jt(this.media,M)}requestPictureInPicture(){this.dispatchEvent(new ee.CustomEvent(Si))}exitPictureInPicture(){this.dispatchEvent(new ee.CustomEvent(Li))}requestPreview(v){this.dispatchEvent(new ee.CustomEvent(Ai,{detail:v}))}},Ri=Object.values(K),Wt=v=>{var M,O,w;let{constructor:{observedAttributes:a}}=v,D=(w=(O=(M=v==null?void 0:v.getAttribute)==null?void 0:M.call(v,K.MEDIA_CHROME_ATTRIBUTES))==null?void 0:O.split)==null?void 0:w.call(O,/\s+/);return Array.isArray(a||D)?(a||D).filter(y=>Ri.includes(y)):[]},gt=v=>!!Wt(v).length,Di=(v,M,O)=>O==null?v.removeAttribute(M):typeof O=="boolean"?O?v.setAttribute(M,""):v.removeAttribute(M):Number.isNaN(O)?v.removeAttribute(M):v.setAttribute(M,O),wi=v=>{var M;return!!((M=v.closest)==null?void 0:M.call(v,'*[slot="media"]'))},Xe=(v,M)=>{if(wi(v))return;let O=(a,D)=>{var y,b;gt(a)&&D(a);let{children:I=[]}=a!=null?a:{},L=(b=(y=a==null?void 0:a.shadowRoot)==null?void 0:y.children)!=null?b:[];[...I,...L].forEach(R=>Xe(R,D))},w=v==null?void 0:v.nodeName.toLowerCase();if(w.includes("-")&&!gt(v)){ee.customElements.whenDefined(w).then(()=>{O(v,M)});return}O(v,M)},ke=(v,M,O)=>{v.forEach(w=>{!Wt(w).includes(M)||Di(w,M,O)})},Ii=(v,M,O)=>{Xe(v,M);let w=b=>{var I;let L=(I=b==null?void 0:b.composedPath()[0])!=null?I:b.target;M(L)},a=b=>{var I;let L=(I=b==null?void 0:b.composedPath()[0])!=null?I:b.target;O(L)};v.addEventListener(ne.REGISTER_MEDIA_STATE_RECEIVER,w),v.addEventListener(ne.UNREGISTER_MEDIA_STATE_RECEIVER,a);let D=(b,I)=>{b.forEach(L=>{let{addedNodes:R=[],removedNodes:_=[],type:u,target:m,attributeName:S}=L;u==="childList"?(Array.prototype.forEach.call(R,E=>Xe(E,M)),Array.prototype.forEach.call(_,E=>Xe(E,O))):u==="attributes"&&S===K.MEDIA_CHROME_ATTRIBUTES&&(gt(m)?M(m):O(m))})},y=new MutationObserver(D);return y.observe(v,{childList:!0,attributes:!0,subtree:!0}),()=>{Xe(v,O),y.disconnect(),v.removeEventListener(ne.REGISTER_MEDIA_STATE_RECEIVER,w),v.removeEventListener(ne.UNREGISTER_MEDIA_STATE_RECEIVER,a)}};ce("media-controller",qt);var $t=qt,Yt=J.createElement("template"),zt=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, #fff);
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,mt=`
  width: var(--media-range-track-width, 100%);
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  border-radius: var(--media-range-track-border-radius, 0);
  background: var(--media-range-track-background-internal, var(--media-range-track-background-color, #eee));

  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  cursor: pointer;
`;Yt.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);

      position: relative;
      display: inline-block;
      vertical-align: middle;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
      transition: background 0.15s linear;
      height: 44px;
      width: 100px;
      padding: 0 10px;

      pointer-events: auto;
    }

    /*
      Only show outline when keyboard focusing.
      https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo
    */
    :host-context([media-keyboard-control]):host(:focus),
    :host-context([media-keyboard-control]):host(:focus-within) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgba(50,50,60, 0.7));
    }

    input[type=range] {
      /* Reset */
      -webkit-appearance: none; /* Hides the slider so that custom slider can be made */
      background: transparent; /* Otherwise white in Chrome */

      /* Fill host with the range */
      min-height: 100%;
      width: var(--media-range-track-width, 100%); /* Specific width is required for Firefox. */

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    /* Special styling for WebKit/Blink */
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${zt}
      /* You need to specify a margin in Chrome, but in Firefox and IE it is automatic */
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }
    input[type=range]::-moz-range-thumb { ${zt} }

    input[type=range]::-webkit-slider-runnable-track { ${mt} }
    input[type=range]::-moz-range-track { ${mt} }
    input[type=range]::-ms-track {
      /* Reset */
      width: 100%;
      cursor: pointer;
      /* Hides the slider so custom styles can be added */
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${mt}
    }

    /* Eventually want to move towards different styles for focus-visible
       https://github.com/WICG/focus-visible/blob/master/src/focus-visible.js
       Youtube appears to do this by de-focusing a button after a button click */
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }

  </style>
  <input id="range" type="range" min="0" max="1000" step="1" value="0">
`;var Qt=class extends ee.HTMLElement{static get observedAttributes(){return[K.MEDIA_CONTROLLER]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Yt.content.cloneNode(!0)),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this))}attributeChangedCallback(v,M,O){var w,a;if(v===K.MEDIA_CONTROLLER){if(M){let D=J.getElementById(M);(w=D==null?void 0:D.unassociateElement)==null||w.call(D,this)}if(O){let D=J.getElementById(O);(a=D==null?void 0:D.associateElement)==null||a.call(D,this)}}}connectedCallback(){var v;let M=this.getAttribute(K.MEDIA_CONTROLLER);if(M){let O=J.getElementById(M);(v=O==null?void 0:O.associateElement)==null||v.call(O,this)}this.updateBar()}disconnectedCallback(){var v;if(this.getAttribute(K.MEDIA_CONTROLLER)){let M=J.getElementById(mediaControllerId);(v=M==null?void 0:M.unassociateElement)==null||v.call(M,this)}}updateBar(){let v=this.getBarColors(),M="linear-gradient(to right, ",O=0;v.forEach(w=>{w[1]<O||(M=M+`${w[0]} ${O}%, ${w[0]} ${w[1]}%,`,O=w[1])}),M=M.slice(0,M.length-1)+")",this.style.setProperty("--media-range-track-background-internal",M)}getBarColors(){let v=this.range,M=v.value/v.max*100;return[["var(--media-range-bar-color, #fff)",M],["var(--media-range-track-background-color, #333)",100]]}};ce("media-chrome-range",Qt);var Xt=Qt,Jt=J.createElement("template");Jt.innerHTML=`
  <style>
    :host {
      /* Need position to display above video for some reason */
      box-sizing: border-box;
      display: inline-flex;

      color: var(--media-icon-color, #eee);
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-progress-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }
  </style>

  <slot></slot>
`;var xi=class extends ee.HTMLElement{static get observedAttributes(){return[K.MEDIA_CONTROLLER]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Jt.content.cloneNode(!0))}attributeChangedCallback(v,M,O){var w,a;if(v===K.MEDIA_CONTROLLER){if(M){let D=J.getElementById(M);(w=D==null?void 0:D.unassociateElement)==null||w.call(D,this)}if(O){let D=J.getElementById(O);(a=D==null?void 0:D.associateElement)==null||a.call(D,this)}}}connectedCallback(){var v;let M=this.getAttribute(K.MEDIA_CONTROLLER);if(M){let O=J.getElementById(M);(v=O==null?void 0:O.associateElement)==null||v.call(O,this)}}disconnectedCallback(){var v;if(this.getAttribute(K.MEDIA_CONTROLLER)){let M=J.getElementById(mediaControllerId);(v=M==null?void 0:M.unassociateElement)==null||v.call(M,this)}}};ce("media-control-bar",xi);var Zt=J.createElement("template");Zt.innerHTML=`
  <style>
    :host {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
  
      padding: 10px;

      font-size: 14px;
      line-height: 24px;
      font-family: Arial, sans-serif;
      text-align: center;
      color: #ffffff;
      pointer-events: auto;
    }

    #container {
      /* NOTE: We don't currently have more generic sizing vars */
      height: var(--media-text-content-height, auto);
    }
  </style>
  <span id="container">
  <slot></slot>
  </span>
`;var er=class extends ee.HTMLElement{static get observedAttributes(){return[K.MEDIA_CONTROLLER]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Zt.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container")}attributeChangedCallback(v,M,O){var w,a;if(v===K.MEDIA_CONTROLLER){if(M){let D=J.getElementById(M);(w=D==null?void 0:D.unassociateElement)==null||w.call(D,this)}if(O){let D=J.getElementById(O);(a=D==null?void 0:D.associateElement)==null||a.call(D,this)}}}connectedCallback(){var v;let M=this.getAttribute(K.MEDIA_CONTROLLER);if(M){let O=J.getElementById(M);(v=O==null?void 0:O.associateElement)==null||v.call(O,this)}}disconnectedCallback(){var v;if(this.getAttribute(K.MEDIA_CONTROLLER)){let M=J.getElementById(mediaControllerId);(v=M==null?void 0:M.unassociateElement)==null||v.call(M,this)}}};ce("media-text-display",er);var yt=er,Ci=class extends yt{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_CURRENT_TIME]}attributeChangedCallback(v,M,O){v===K.MEDIA_CURRENT_TIME&&(this.container.innerHTML=je(O)),super.attributeChangedCallback(v,M,O)}};ce("media-current-time-display",Ci);var Mi=class extends yt{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_DURATION]}attributeChangedCallback(v,M,O){v===K.MEDIA_DURATION&&(this.container.innerHTML=je(O)),super.attributeChangedCallback(v,M,O)}};ce("media-duration-display",Mi);var Oi=" / ",Pi=(v,{timesSep:M=Oi}={})=>{let O=v.getAttribute("remaining")!=null,w=v.getAttribute("show-duration")!=null,a=+v.getAttribute(K.MEDIA_CURRENT_TIME),D=+v.getAttribute(K.MEDIA_DURATION),y=je(O?0-(D-a):a);return w?`${y}${M}${je(D)}`:y},Ni="video not loaded, unknown time.",Fi=v=>{if(!(v.hasAttribute(K.MEDIA_CURRENT_TIME)&&v.hasAttribute(K.MEDIA_DURATION))){v.setAttribute("aria-valuetext",Ni);return}let M=v.getAttribute("remaining")!=null,O=v.getAttribute("show-duration")!=null,w=+v.getAttribute(K.MEDIA_CURRENT_TIME),a=+v.getAttribute(K.MEDIA_DURATION),D=Ge(M?0-(a-w):w);if(!O){v.setAttribute("aria-valuetext",D);return}let y=Ge(a),b=`${D} of ${y}`;v.setAttribute("aria-valuetext",b)},Ui=class extends yt{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_CURRENT_TIME,K.MEDIA_DURATION,"remaining","show-duration"]}connectedCallback(){this.setAttribute("role","progressbar"),this.setAttribute("aria-label",xe.PLAYBACK_TIME()),this.setAttribute("tabindex",0),super.connectedCallback()}attributeChangedCallback(v,M,O){if([K.MEDIA_CURRENT_TIME,K.MEDIA_DURATION,"remaining","show-duration"].includes(v)){let w=Pi(this);Fi(this),this.container.innerHTML=w}super.attributeChangedCallback(v,M,O)}};ce("media-time-display",Ui);var Bi=`
<svg
   aria-hidden="true"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.0"
   viewbox="0 0 153 125.71389"
   width="auto"
   height="24">
  <g
     transform="scale(6.3080558,6.3080558)"
     id="g12">
    <path
       class="icon" 
       d="M 21.9806,9.0135 C 21.9505,5.8358 21.8299,4.4502 21.077,3.4712 C 20.9415,3.2605 20.6854,3.14 20.4746,2.9895 C 19.7366,2.4472 16.2577,2.2515 12.2215,2.2515 C 8.1853,2.2515 4.54077,2.4472 3.81787,2.9895 C 3.59192,3.14 3.33581,3.2605 3.1853,3.4712 C 2.44726,4.4502 2.34192,5.8358 2.29675,9.0135 C 2.34192,12.1914 2.44726,13.5769 3.1853,14.5558 C 3.33581,14.7817 3.59192,14.8871 3.81787,15.0377 C 4.54077,15.595 8.1853,15.7757 12.2215,15.8058 C 16.2577,15.7757 19.7366,15.595 20.4746,15.0377 C 20.6854,14.8871 20.9415,14.7817 21.077,14.5558 C 21.8299,13.5769 21.9505,12.1914 21.9806,9.0135 z "
       style="fill-rule:evenodd;stroke:none"
       id="path16" />
    <path
       class="icon" 
       d="M 11.6896,8.1906 C 11.4853,5.704 10.1628,4.239 7.79723,4.239 C 5.63596,4.239 3.93706,6.1879 3.93706,9.31964 C 3.93706,12.4648 5.48544,14.4271 8.04452,14.4271 C 10.0875,14.4271 11.5176,12.9218 11.7434,10.4217 L 9.30256,10.4217 C 9.20579,11.3492 8.81871,12.0616 8.00151,12.0616 C 6.71121,12.0616 6.47467,10.7847 6.47467,9.42716 C 6.47467,7.5588 7.0123,6.6046 7.90474,6.6046 C 8.70045,6.6046 9.20579,7.1825 9.28106,8.1906 L 11.6896,8.1906 z "
       style="fill:#000000;fill-rule:evenodd;stroke:none"
       id="path20" />
    <path
      class="icon" 
      d="M 20.1199,8.1906 C 19.9156,5.704 18.5931,4.239 16.2275,4.239 C 14.0662,4.239 12.3674,6.1879 12.3674,9.31964 C 12.3674,12.4648 13.9157,14.4271 16.4748,14.4271 C 18.5178,14.4271 19.9479,12.9218 20.1736,10.4217 L 17.7328,10.4217 C 17.6361,11.3492 17.249,12.0616 16.4318,12.0616 C 15.1415,12.0616 14.9049,10.7847 14.9049,9.42716 C 14.9049,7.5588 15.4426,6.6046 16.335,6.6046 C 17.1307,6.6046 17.6361,7.1825 17.7113,8.1906 L 20.1199,8.1906 z "
      style="fill:#000000;fill-rule:evenodd;stroke:none"
      id="path22" />
    <path class="icon" d="M 2,20 L 22,20" stroke-width="4" stroke="var(--media-icon-color, #eee)" id="path24"/>
  </g>
</svg>
`,Hi=`
<svg
   aria-hidden="true"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.0"
   viewbox="0 0 153 125.71389"
   width="auto"
   height="24">
  <g
     transform="scale(6.3080558,6.3080558)"
     id="g12">
    <path
       class="icon" 
       d="M 21.9806,9.0135 C 21.9505,5.8358 21.8299,4.4502 21.077,3.4712 C 20.9415,3.2605 20.6854,3.14 20.4746,2.9895 C 19.7366,2.4472 16.2577,2.2515 12.2215,2.2515 C 8.1853,2.2515 4.54077,2.4472 3.81787,2.9895 C 3.59192,3.14 3.33581,3.2605 3.1853,3.4712 C 2.44726,4.4502 2.34192,5.8358 2.29675,9.0135 C 2.34192,12.1914 2.44726,13.5769 3.1853,14.5558 C 3.33581,14.7817 3.59192,14.8871 3.81787,15.0377 C 4.54077,15.595 8.1853,15.7757 12.2215,15.8058 C 16.2577,15.7757 19.7366,15.595 20.4746,15.0377 C 20.6854,14.8871 20.9415,14.7817 21.077,14.5558 C 21.8299,13.5769 21.9505,12.1914 21.9806,9.0135 z "
       style="fill-rule:evenodd;stroke:none"
       id="path16" />
    <path
       class="icon" 
       d="M 11.6896,8.1906 C 11.4853,5.704 10.1628,4.239 7.79723,4.239 C 5.63596,4.239 3.93706,6.1879 3.93706,9.31964 C 3.93706,12.4648 5.48544,14.4271 8.04452,14.4271 C 10.0875,14.4271 11.5176,12.9218 11.7434,10.4217 L 9.30256,10.4217 C 9.20579,11.3492 8.81871,12.0616 8.00151,12.0616 C 6.71121,12.0616 6.47467,10.7847 6.47467,9.42716 C 6.47467,7.5588 7.0123,6.6046 7.90474,6.6046 C 8.70045,6.6046 9.20579,7.1825 9.28106,8.1906 L 11.6896,8.1906 z "
       style="fill:#000000;fill-rule:evenodd;stroke:none"
       id="path20" />
    <path
      class="icon" 
      d="M 20.1199,8.1906 C 19.9156,5.704 18.5931,4.239 16.2275,4.239 C 14.0662,4.239 12.3674,6.1879 12.3674,9.31964 C 12.3674,12.4648 13.9157,14.4271 16.4748,14.4271 C 18.5178,14.4271 19.9479,12.9218 20.1736,10.4217 L 17.7328,10.4217 C 17.6361,11.3492 17.249,12.0616 16.4318,12.0616 C 15.1415,12.0616 14.9049,10.7847 14.9049,9.42716 C 14.9049,7.5588 15.4426,6.6046 16.335,6.6046 C 17.1307,6.6046 17.6361,7.1825 17.7113,8.1906 L 20.1199,8.1906 z "
      style="fill:#000000;fill-rule:evenodd;stroke:none"
      id="path22" />
  </g>
</svg>
`,tr=J.createElement("template");tr.innerHTML=`
  <style>
  :host([aria-checked="true"]) slot:not([name=on]) > *, 
  :host([aria-checked="true"]) ::slotted(:not([slot=on])) {
    display: none;
  }

  /* Double negative, but safer if display doesn't equal 'block' */
  :host(:not([aria-checked="true"])) slot:not([name=off]) > *, 
  :host(:not([aria-checked="true"])) ::slotted(:not([slot=off])) {
    display: none;
  }
  </style>

  <slot name="on">${Bi}</slot>
  <slot name="off">${Hi}</slot>
`;var rr=v=>{v.setAttribute("aria-checked",ir(v))},ir=v=>{let M=!!v.getAttribute(K.MEDIA_CAPTIONS_SHOWING),O=!v.hasAttribute("no-subtitles-fallback")&&!!v.getAttribute(K.MEDIA_SUBTITLES_SHOWING);return M||O},Gi=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,"no-subtitles-fallback","default-showing",K.MEDIA_CAPTIONS_LIST,K.MEDIA_CAPTIONS_SHOWING,K.MEDIA_SUBTITLES_LIST,K.MEDIA_SUBTITLES_SHOWING]}constructor(v={}){super({slotTemplate:tr,...v});this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",xe.CLOSED_CAPTIONS()),rr(this)}attributeChangedCallback(v,M,O){if([K.MEDIA_CAPTIONS_SHOWING,K.MEDIA_SUBTITLES_SHOWING].includes(v)&&rr(this),this.hasAttribute("default-showing")&&this.getAttribute("aria-checked")!=="true"){let w=!this.hasAttribute("no-subtitles-fallback");if((w?[K.MEDIA_CAPTIONS_LIST,K.MEDIA_SUBTITLES_LIST]:[K.MEDIA_CAPTIONS_LIST]).includes(v)){let a=!!this.getAttribute(K.MEDIA_CAPTIONS_LIST)||!!(w&&this.getAttribute(K.MEDIA_SUBTITLES_LIST));this._captionsReady!==a&&(this._captionsReady=a,this._captionsReady&&this.handleClick())}}super.attributeChangedCallback(v,M,O)}handleClick(v){var M,O,w,a;if(ir(this)){let D=this.getAttribute(K.MEDIA_CAPTIONS_SHOWING);if(D){let b=new ee.CustomEvent(ne.MEDIA_DISABLE_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:D});this.dispatchEvent(b)}let y=this.getAttribute(K.MEDIA_SUBTITLES_SHOWING);if(y&&!this.hasAttribute("no-subtitles-fallback")){let b=new ee.CustomEvent(ne.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:y});this.dispatchEvent(b)}}else{let[D]=(O=pt((M=this.getAttribute(K.MEDIA_CAPTIONS_LIST))!=null?M:""))!=null?O:[];if(D){let y=new ee.CustomEvent(ne.MEDIA_SHOW_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:D});this.dispatchEvent(y)}else if(this.hasAttribute("no-subtitles-fallback"))console.error("Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.");else{let[y]=(a=pt((w=this.getAttribute(K.MEDIA_SUBTITLES_LIST))!=null?w:""))!=null?a:[];if(y){let b=new ee.CustomEvent(ne.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:y});this.dispatchEvent(b)}}}}};ce("media-captions-button",Gi);var Et=30,ji=`<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="-3 -3 24 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(7.4 17.6)">${Et}</text><path d="M8.52,3V0l5.61,4-5.61,4V5A5.54,5.54,0,0,0,6.6,15.48V17.6A7.5,7.5,0,0,1,8.52,3Z"/></svg>`,ar=J.createElement("template");ar.innerHTML=`  
  <slot name="forward">${ji}</slot>
`;var Ki=0,Vi=v=>{let M=Math.abs(+v.getAttribute("seek-offset")),O=Le.SEEK_FORWARD_N_SECS({seekOffset:M});v.setAttribute("aria-label",O)},nr=v=>{let M=Gt(v,"forward"),O=v.getAttribute("seek-offset");Ht(M,O)},qi=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_CURRENT_TIME,"seek-offset"]}constructor(v={}){super({slotTemplate:ar,...v})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Et),Vi(this),nr(this),super.connectedCallback()}attributeChangedCallback(v,M,O){v==="seek-offset"&&(O==null&&this.setAttribute("seek-offset",Et),nr(this))}handleClick(){let v=this.getAttribute(K.MEDIA_CURRENT_TIME),M=+this.getAttribute("seek-offset"),O=(v&&!Number.isNaN(+v)?+v:Ki)+M,w=new ee.CustomEvent(ne.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:O});this.dispatchEvent(w)}};ce("media-seek-forward-button",qi);var Wi=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path class="icon" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
</svg>`,$i=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path class="icon" d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
</svg>`,sr=J.createElement("template");sr.innerHTML=`
  <style>
  :host([${K.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]) > *, 
  :host([${K.MEDIA_IS_FULLSCREEN}]) ::slotted(:not([slot=exit])) {
    display: none;
  }

  /* Double negative, but safer if display doesn't equal 'block' */
  :host(:not([${K.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]) > *, 
  :host(:not([${K.MEDIA_IS_FULLSCREEN}])) ::slotted(:not([slot=enter])) {
    display: none;
  }
  </style>

  <slot name="enter">${Wi}</slot>
  <slot name="exit">${$i}</slot>
`;var or=v=>{let M=v.getAttribute(K.MEDIA_IS_FULLSCREEN)!=null?Le.EXIT_FULLSCREEN():Le.ENTER_FULLSCREEN();v.setAttribute("aria-label",M)},Yi=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_IS_FULLSCREEN]}constructor(v={}){super({slotTemplate:sr,...v})}connectedCallback(){or(this),super.connectedCallback()}attributeChangedCallback(v,M,O){v===K.MEDIA_IS_FULLSCREEN&&or(this),super.attributeChangedCallback(v,M,O)}handleClick(v){let M=this.getAttribute(K.MEDIA_IS_FULLSCREEN)!=null?ne.MEDIA_EXIT_FULLSCREEN_REQUEST:ne.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new ee.CustomEvent(M,{composed:!0,bubbles:!0}))}};ce("media-fullscreen-button",Yi);var zi='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',lr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',Qi='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',ur=J.createElement("template");ur.innerHTML=`
  <style>
  /* Default to High slot/icon. */
  :host(:not([${K.MEDIA_VOLUME_LEVEL}])) slot:not([name=high]) > *, 
  :host(:not([${K.MEDIA_VOLUME_LEVEL}])) ::slotted(:not([slot=high])),
  :host([${K.MEDIA_VOLUME_LEVEL}=high]) slot:not([name=high]) > *, 
  :host([${K.MEDIA_VOLUME_LEVEL}=high]) ::slotted(:not([slot=high])) {
    display: none;
  }

  :host([${K.MEDIA_VOLUME_LEVEL}=off]) slot:not([name=off]) > *, 
  :host([${K.MEDIA_VOLUME_LEVEL}=off]) ::slotted(:not([slot=off])) {
    display: none;
  }

  :host([${K.MEDIA_VOLUME_LEVEL}=low]) slot:not([name=low]) > *, 
  :host([${K.MEDIA_VOLUME_LEVEL}=low]) ::slotted(:not([slot=low])) {
    display: none;
  }

  :host([${K.MEDIA_VOLUME_LEVEL}=medium]) slot:not([name=medium]) > *, 
  :host([${K.MEDIA_VOLUME_LEVEL}=medium]) ::slotted(:not([slot=medium])) {
    display: none;
  }
  </style>

  <slot name="off">${zi}</slot>
  <slot name="low">${lr}</slot>
  <slot name="medium">${lr}</slot>
  <slot name="high">${Qi}</slot>
`;var dr=v=>{let M=v.getAttribute(K.MEDIA_VOLUME_LEVEL)==="off"?Le.UNMUTE():Le.MUTE();v.setAttribute("aria-label",M)},Xi=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_VOLUME_LEVEL]}constructor(v={}){super({slotTemplate:ur,...v})}connectedCallback(){dr(this),super.connectedCallback()}attributeChangedCallback(v,M,O){v===K.MEDIA_VOLUME_LEVEL&&dr(this),super.attributeChangedCallback(v,M,O)}handleClick(v){let M=this.getAttribute(K.MEDIA_VOLUME_LEVEL)==="off"?ne.MEDIA_UNMUTE_REQUEST:ne.MEDIA_MUTE_REQUEST;this.dispatchEvent(new ee.CustomEvent(M,{composed:!0,bubbles:!0}))}};ce("media-mute-button",Xi);var cr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',hr=J.createElement("template");hr.innerHTML=`
  <style>
  :host([${K.MEDIA_IS_PIP}]) slot:not([name=exit]) > *, 
  :host([${K.MEDIA_IS_PIP}]) ::slotted(:not([slot=exit])) {
    display: none;
  }

  /* Double negative, but safer if display doesn't equal 'block' */
  :host(:not([${K.MEDIA_IS_PIP}])) slot:not([name=enter]) > *, 
  :host(:not([${K.MEDIA_IS_PIP}])) ::slotted(:not([slot=enter])) {
    display: none;
  }
  </style>

  <slot name="enter">${cr}</slot>
  <slot name="exit">${cr}</slot>
`;var fr=v=>{let M=v.getAttribute(K.MEDIA_IS_PIP)!=null?Le.EXIT_PIP():Le.ENTER_PIP();v.setAttribute("aria-label",M)},Ji=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_IS_PIP]}constructor(v={}){super({slotTemplate:hr,...v})}connectedCallback(){fr(this),super.connectedCallback()}attributeChangedCallback(v,M,O){v===K.MEDIA_IS_PIP&&fr(this),super.attributeChangedCallback(v,M,O)}handleClick(v){let M=this.getAttribute(K.MEDIA_IS_PIP)!=null?ne.MEDIA_EXIT_PIP_REQUEST:ne.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new ee.CustomEvent(M,{composed:!0,bubbles:!0}))}};ce("media-pip-button",Ji);var Zi='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M8 5v14l11-7z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',ea='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',vr=J.createElement("template");vr.innerHTML=`
  <style>
  :host([${K.MEDIA_PAUSED}]) slot[name=pause] > *, 
  :host([${K.MEDIA_PAUSED}]) ::slotted([slot=pause]) {
    display: none;
  }

  :host(:not([${K.MEDIA_PAUSED}])) slot[name=play] > *, 
  :host(:not([${K.MEDIA_PAUSED}])) ::slotted([slot=play]) {
    display: none;
  }
  </style>

  <slot name="play">${Zi}</slot>
  <slot name="pause">${ea}</slot>
`;var pr=v=>{let M=v.getAttribute(K.MEDIA_PAUSED)!=null?Le.PLAY():Le.PAUSE();v.setAttribute("aria-label",M)},ta=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_PAUSED]}constructor(v={}){super({slotTemplate:vr,...v})}connectedCallback(){pr(this),super.connectedCallback()}attributeChangedCallback(v,M,O){v===K.MEDIA_PAUSED&&pr(this),super.attributeChangedCallback(v,M,O)}handleClick(v){let M=this.getAttribute(K.MEDIA_PAUSED)!=null?ne.MEDIA_PLAY_REQUEST:ne.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new ee.CustomEvent(M,{composed:!0,bubbles:!0}))}};ce("media-play-button",ta);var gr=[1,1.25,1.5,1.75,2],at=1,mr=J.createElement("template");mr.innerHTML=`
  <style>
  :host {
    font-size: 14px;
    line-height: 24px;
    font-weight: bold;
  }

  #container {
    height: var(--media-text-content-height, 24px);
  }
  </style>

  <span id="container"></span>
`;var ra=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_PLAYBACK_RATE,"rates"]}constructor(v={}){super({slotTemplate:mr,...v});this._rates=gr,this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML=`${at}x`}attributeChangedCallback(v,M,O){if(v==="rates"){let w=(O!=null?O:"").trim().split(/\s*,?\s+/).map(a=>Number(a)).filter(a=>!Number.isNaN(a)).sort((a,D)=>a-D);this._rates=w.length?w:gr;return}if(v===K.MEDIA_PLAYBACK_RATE){let w=O?+O:Number.NaN,a=Number.isNaN(w)?at:w;this.container.innerHTML=`${a}x`,this.setAttribute("aria-label",xe.PLAYBACK_RATE({playbackRate:a}));return}super.attributeChangedCallback(v,M,O)}handleClick(v){var M,O;let w=+this.getAttribute(K.MEDIA_PLAYBACK_RATE)||at,a=(O=(M=this._rates.find(y=>y>w))!=null?M:this._rates[0])!=null?O:at,D=new ee.CustomEvent(ne.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:a});this.dispatchEvent(D)}};ce("media-playback-rate-button",ra);var ia="video not loaded, unknown time.",yr=v=>{let M=v.range,O=Ge(+M.value),w=Ge(+M.max),a=O&&w?`${O} of ${w}`:ia;M.setAttribute("aria-valuetext",a)},Er=J.createElement("template");Er.innerHTML=`
  <style>
    #thumbnailContainer {
      display: none;
      position: absolute;
      top: 0;
    }

    media-thumbnail-preview {
      position: absolute;
      bottom: 10px;
      border: 2px solid #fff;
      border-radius: 2px;
      background-color: #000;
      width: 160px;
      height: 90px;

      /* Negative offset of half to center on the handle */
      margin-left: -80px;
    }

    /* Can't get this working. Trying a downward triangle. */
    /* media-thumbnail-preview::after {
      content: "";
      display: block;
      width: 300px;
      height: 300px;
      margin: 100px;
      background-color: #ff0;
    } */

    :host([${K.MEDIA_PREVIEW_IMAGE}]:hover) #thumbnailContainer {
      display: block;
      animation: fadeIn ease 0.5s;
    }

    @keyframes fadeIn {
      0% {
        /* transform-origin: bottom center; */
        /* transform: scale(0.7); */
        margin-top: 10px;
        opacity: 0;
      }
      100% {
        /* transform-origin: bottom center; */
        /* transform: scale(1); */
        margin-top: 0;
        opacity: 1;
      }
    }
  </style>
  <div id="thumbnailContainer">
    <media-thumbnail-preview></media-thumbnail-preview>
  </div>
`;var br=class extends Xt{static get observedAttributes(){return[...super.observedAttributes,"thumbnails",K.MEDIA_DURATION,K.MEDIA_CURRENT_TIME,K.MEDIA_PREVIEW_IMAGE]}constructor(){super();this.shadowRoot.appendChild(Er.content.cloneNode(!0)),this.range.addEventListener("input",()=>{let v=this.range.value,M=new ee.CustomEvent(ne.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:v});this.dispatchEvent(M)}),this.enableThumbnails()}connectedCallback(){this.range.setAttribute("aria-label",xe.SEEK()),super.connectedCallback()}attributeChangedCallback(v,M,O){v===K.MEDIA_CURRENT_TIME&&(this.range.value=+O,yr(this),this.updateBar()),v===K.MEDIA_DURATION&&(this.range.max=Math.floor(+O),yr(this),this.updateBar()),super.attributeChangedCallback(v,M,O)}getBarColors(){let v=super.getBarColors();if(!this.mediaBuffered||!this.mediaBuffered.length||this.mediaDuration<=0)return v;let M=this.mediaBuffered,O=M[M.length-1][1]/this.mediaDuration*100;return v.splice(1,0,["var(--media-time-buffered-color, #777)",O]),v}enableThumbnails(){this.thumbnailPreview=this.shadowRoot.querySelector("media-thumbnail-preview"),this.shadowRoot.querySelector("#thumbnailContainer").classList.add("enabled");let v,M=()=>{v=D=>{let y=+this.getAttribute(K.MEDIA_DURATION);if(!y)return;let b=this.range.getBoundingClientRect(),I=(D.clientX-b.left)/b.width;I=Math.max(0,Math.min(1,I));let L=b.left-this.getBoundingClientRect().left+I*b.width;this.thumbnailPreview.style.left=`${L}px`;let R=I*y,_=new ee.CustomEvent(ne.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:R});this.dispatchEvent(_)},ee.addEventListener("mousemove",v,!1)},O=()=>{ee.removeEventListener("mousemove",v)},w=!1,a=D=>{let y=this.getAttribute(K.MEDIA_DURATION);if(!w&&y){w=!0,M();let b=I=>{I.target!=this&&!this.contains(I.target)&&(ee.removeEventListener("mousemove",b),w=!1,O())};ee.addEventListener("mousemove",b,!1)}};this.addEventListener("mousemove",a,!1)}};ce("media-time-range",br);var aa=br,na=class extends aa{constructor(){super();console.warn("MediaChrome: <media-progress-range> is deprecated. Use <media-time-range> instead.")}};ce("media-progress-range",na);var nt=30,sa=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="-3 -3 24 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(1.68 17.6)">${nt}</text><path d="M9.48,3V0L3.87,4l5.61,4V5a5.54,5.54,0,0,1,1.92,10.5V17.6A7.5,7.5,0,0,0,9.48,3Z"/></svg>`,_r=J.createElement("template");_r.innerHTML=`  
  <slot name="backward">${sa}</slot>
`;var oa=0,la=v=>{let M=Math.abs(nt),O=Le.SEEK_BACK_N_SECS({seekOffset:M});v.setAttribute("aria-label",O)},Tr=v=>{let M=Gt(v,"backward"),O=v.getAttribute("seek-offset");Ht(M,O)},ua=class extends Ce{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_CURRENT_TIME]}constructor(v={}){super({slotTemplate:_r,...v})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",nt),la(this),Tr(this),super.connectedCallback()}attributeChangedCallback(v,M,O){v==="seek-offset"&&(O==null&&this.setAttribute("seek-offset",nt),Tr(this))}handleClick(){let v=this.getAttribute(K.MEDIA_CURRENT_TIME),M=+this.getAttribute("seek-offset"),O=v&&!Number.isNaN(+v)?+v:oa,w=Math.max(O-M,0),a=new ee.CustomEvent(ne.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:w});this.dispatchEvent(a)}};ce("media-seek-backward-button",ua);var Ar=J.createElement("template");Ar.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      background-color: #000;
      width: 284px;
      height: 160px;
      overflow: hidden;
    }

    img {
      position: absolute;
      left: 0;
      top: 0;
    }
  </style>
  <img crossorigin loading="eager" decoding="async" />
`;var da=class extends ee.HTMLElement{static get observedAttributes(){return[K.MEDIA_CONTROLLER,"time",K.MEDIA_PREVIEW_IMAGE,K.MEDIA_PREVIEW_COORDS]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Ar.content.cloneNode(!0))}connectedCallback(){var v;let M=this.getAttribute(K.MEDIA_CONTROLLER);if(M){let O=J.getElementById(M);(v=O==null?void 0:O.associateElement)==null||v.call(O,this)}}disconnectedCallback(){var v;if(this.getAttribute(K.MEDIA_CONTROLLER)){let M=J.getElementById(mediaControllerId);(v=M==null?void 0:M.unassociateElement)==null||v.call(M,this)}}attributeChangedCallback(v,M,O){var w,a;if(["time",K.MEDIA_PREVIEW_IMAGE,K.MEDIA_PREVIEW_COORDS].includes(v)&&this.update(),v===K.MEDIA_CONTROLLER){if(M){let D=J.getElementById(M);(w=D==null?void 0:D.unassociateElement)==null||w.call(D,this)}if(O){let D=J.getElementById(O);(a=D==null?void 0:D.associateElement)==null||a.call(D,this)}}}update(){let v=this.getAttribute(K.MEDIA_PREVIEW_COORDS),M=this.getAttribute(K.MEDIA_PREVIEW_IMAGE);if(!(v&&M))return;let O=this.offsetWidth,w=this.shadowRoot.querySelector("img"),[a,D,y,b]=v.split(/\s+/).map(_=>+_),I=M,L=O/y||1,R=()=>{w.style.width=`${L*w.naturalWidth}px`,w.style.height=`${L*w.naturalHeight}px`};w.src!==I&&(w.onload=R,w.src=I,R()),R(),w.style.left=`-${L*a}px`,w.style.top=`-${L*D}px`}};ce("media-thumbnail-preview",da);var Sr=J.createElement("template"),ca=`
<svg viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;Sr.innerHTML=`
<style>
:host {
  display: inline-block;
  vertical-align: middle;
  box-sizing: border-box;
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=loading] > *,
:host ::slotted([slot=loading]) {
  opacity: 1;
  transition: opacity 0.15s;
}

:host(:not([is-loading])) slot[name=loading] > *, 
:host(:not([is-loading])) ::slotted([slot=loading]) {
  opacity: 0;
}

:host(:not([is-loading])) #status {
  display: none;
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-icon-width, 44px);
  height: var(--media-loading-icon-height);
  fill: var(--media-icon-color, #fff);
  vertical-align: middle;
}
</style>

<slot name="loading">${ca}</slot>
<div id="status" role="status" aria-live="polite">${xe.MEDIA_LOADING()}</div>
`;var ha=500,fa=class extends ee.HTMLElement{static get observedAttributes(){return[K.MEDIA_CONTROLLER,K.MEDIA_PAUSED,K.MEDIA_LOADING,"loading-delay"]}constructor(){super();let v=this.attachShadow({mode:"open"}),M=Sr.content.cloneNode(!0);v.appendChild(M)}attributeChangedCallback(v,M,O){var w,a,D;if(v===K.MEDIA_LOADING||v===K.MEDIA_PAUSED){let y=this.getAttribute(K.MEDIA_PAUSED)!=null,b=this.getAttribute(K.MEDIA_LOADING)!=null,I=!y&&b;if(!I)this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.removeAttribute("is-loading");else if(!this.loadingDelayHandle&&I){let L=+((w=this.getAttribute("loading-delay"))!=null?w:ha);this.loadingDelayHandle=setTimeout(()=>{this.setAttribute("is-loading",""),this.loadingDelayHandle=void 0},L)}}else if(v===K.MEDIA_CONTROLLER){if(M){let y=J.getElementById(M);(a=y==null?void 0:y.unassociateElement)==null||a.call(y,this)}if(O){let y=J.getElementById(O);(D=y==null?void 0:y.associateElement)==null||D.call(y,this)}}}connectedCallback(){var v;let M=this.getAttribute(K.MEDIA_CONTROLLER);if(M){let O=J.getElementById(M);(v=O==null?void 0:O.associateElement)==null||v.call(O,this)}}disconnectedCallback(){var v;if(this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.getAttribute(K.MEDIA_CONTROLLER)){let M=J.getElementById(mediaControllerId);(v=M==null?void 0:M.unassociateElement)==null||v.call(M,this)}}};ce("media-loading-indicator",fa);var Lr=J.createElement("template");Lr.innerHTML=`
  <style>
    :host {

    }
  </style>

  <slot></slot>
`;var va=class extends ee.HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Lr.content.cloneNode(!0))}};ce("media-title-bar",va);var pa=100,ga=v=>{var M;if(v.getAttribute(K.MEDIA_MUTED)!=null)return 0;let O=+((M=v.getAttribute(K.MEDIA_VOLUME))!=null?M:1);return Math.round(O*v.range.max)},ma=({value:v,max:M})=>`${Math.round(v/M*100)}%`,ya=class extends Xt{static get observedAttributes(){return[...super.observedAttributes,K.MEDIA_VOLUME,K.MEDIA_MUTED]}constructor(){super();this.range.max=pa,this.range.addEventListener("input",()=>{let v=this.range.value/this.range.max,M=new ee.CustomEvent(ne.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:v});this.dispatchEvent(M)})}connectedCallback(){this.range.setAttribute("aria-label",xe.VOLUME()),super.connectedCallback()}attributeChangedCallback(v,M,O){if(v===K.MEDIA_VOLUME||v===K.MEDIA_MUTED){let w=ga(this);this.range.value=w,this.range.setAttribute("aria-valuetext",ma(this.range)),this.updateBar()}super.attributeChangedCallback(v,M,O)}};ce("media-volume-range",ya);var Ea=class extends $t{};ee.customElements.get("media-chrome")||ee.customElements.define("media-chrome",Ea);var ba=class extends $t{constructor(){super();console.warn("MediaChrome: <media-container> is deprecated. Use <media-controller>.")}};ee.customElements.get("media-container")||ee.customElements.define("media-container",ba);var _a=Object.create,bt=Object.defineProperty,Ta=Object.getOwnPropertyDescriptor,Aa=Object.getOwnPropertyNames,Sa=Object.getPrototypeOf,La=Object.prototype.hasOwnProperty,ka=v=>bt(v,"__esModule",{value:!0}),st=(v,M)=>()=>(M||v((M={exports:{}}).exports,M),M.exports),Ra=(v,M,O)=>{if(M&&typeof M=="object"||typeof M=="function")for(let w of Aa(M))!La.call(v,w)&&w!=="default"&&bt(v,w,{get:()=>M[w],enumerable:!(O=Ta(M,w))||O.enumerable});return v},kr=v=>Ra(ka(bt(v!=null?_a(Sa(v)):{},"default",v&&v.__esModule&&"default"in v?{get:()=>v.default,enumerable:!0}:{value:v,enumerable:!0})),v),Da=st(()=>{if(globalThis.customElements||(globalThis.customElements={get(O){},define(O,w,a){},upgrade(O){},whenDefined(O){return Promise.resolve(globalThis.HTMLElement)}}),!globalThis.CustomEvent){class O{constructor(a,D={}){this.detail=D==null?void 0:D.detail}initCustomEvent(a,D,y,b){}}globalThis.CustomEvent=O}if(!globalThis.EventTarget){class O{addEventListener(){}removeEventListener(){}dispatchEvent(a){return!0}}globalThis.EventTarget=O}if(!globalThis.HTMLElement){class O extends EventTarget{}globalThis.HTMLElement=O}var v,M;if(!((v=globalThis.document)==null?void 0:v.createElement)){let O=(M=globalThis.document)!=null?M:{};O.createElement=function(w,a){return new HTMLElement},globalThis.document=O}}),wa=st((v,M)=>{(function(){var O=!1;(function(w,a){typeof v=="object"&&typeof M=="object"?M.exports=a():typeof O=="function"&&O.amd?O("mux",[],a):typeof v=="object"?v.mux=a():w.mux=a()})(this,function(){return function(w){function a(y){if(D[y])return D[y].exports;var b=D[y]={i:y,l:!1,exports:{}};return w[y].call(b.exports,b,b.exports,a),b.l=!0,b.exports}var D={};return a.m=w,a.c=D,a.d=function(y,b,I){a.o(y,b)||Object.defineProperty(y,b,{configurable:!1,enumerable:!0,get:I})},a.n=function(y){var b=y&&y.__esModule?function(){return y.default}:function(){return y};return a.d(b,"a",b),b},a.o=function(y,b){return Object.prototype.hasOwnProperty.call(y,b)},a.p="",a(a.s=15)}([function(w,a,D){(function(y){var b;b=typeof window!="undefined"?window:y!==void 0?y:typeof self!="undefined"?self:{},w.exports=b}).call(a,D(17))},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(0),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I={};I.now=function(){var L=b.default.performance,R=L&&L.timing;return R&&typeof R.navigationStart=="number"&&typeof L.now=="function"?R.navigationStart+L.now():Date.now()},a.default=I},function(w,a){function D(F,U,H){switch(H.length){case 0:return F.call(U);case 1:return F.call(U,H[0]);case 2:return F.call(U,H[0],H[1]);case 3:return F.call(U,H[0],H[1],H[2])}return F.apply(U,H)}function y(F,U){for(var H=-1,G=Array(F);++H<F;)G[H]=U(H);return G}function b(F,U){var H=N(F)||A(F)?y(F.length,String):[],G=H.length,j=!!G;for(var V in F)!U&&!c.call(F,V)||j&&(V=="length"||u(V,G))||H.push(V);return H}function I(F,U,H){var G=F[U];c.call(F,U)&&E(G,H)&&(H!==void 0||U in F)||(F[U]=H)}function L(F){if(!S(F))return x(F);var U=[];for(var H in Object(F))c.call(F,H)&&H!="constructor"&&U.push(H);return U}function R(F,U){return U=C(U===void 0?F.length-1:U,0),function(){for(var H=arguments,G=-1,j=C(H.length-U,0),V=Array(j);++G<j;)V[G]=H[U+G];G=-1;for(var q=Array(U+1);++G<U;)q[G]=H[G];return q[U]=V,D(F,this,q)}}function _(F,U,H,G){H||(H={});for(var j=-1,V=U.length;++j<V;){var q=U[j],W=G?G(H[q],F[q],q,H,F):void 0;I(H,q,W===void 0?F[q]:W)}return H}function u(F,U){return!!(U=U==null?g:U)&&(typeof F=="number"||s.test(F))&&F>-1&&F%1==0&&F<U}function m(F,U,H){if(!h(H))return!1;var G=typeof U;return!!(G=="number"?d(H)&&u(U,H.length):G=="string"&&U in H)&&E(H[U],F)}function S(F){var U=F&&F.constructor;return F===(typeof U=="function"&&U.prototype||r)}function E(F,U){return F===U||F!==F&&U!==U}function A(F){return e(F)&&c.call(F,"callee")&&(!k.call(F,"callee")||l.call(F)==T)}function d(F){return F!=null&&i(F.length)&&!t(F)}function e(F){return n(F)&&d(F)}function t(F){var U=h(F)?l.call(F):"";return U==p||U==o}function i(F){return typeof F=="number"&&F>-1&&F%1==0&&F<=g}function h(F){var U=typeof F;return!!F&&(U=="object"||U=="function")}function n(F){return!!F&&typeof F=="object"}function f(F){return d(F)?b(F):L(F)}var g=9007199254740991,T="[object Arguments]",p="[object Function]",o="[object GeneratorFunction]",s=/^(?:0|[1-9]\d*)$/,r=Object.prototype,c=r.hasOwnProperty,l=r.toString,k=r.propertyIsEnumerable,x=function(F,U){return function(H){return F(U(H))}}(Object.keys,Object),C=Math.max,P=!k.call({valueOf:1},"valueOf"),N=Array.isArray,B=function(F){return R(function(U,H){var G=-1,j=H.length,V=j>1?H[j-1]:void 0,q=j>2?H[2]:void 0;for(V=F.length>3&&typeof V=="function"?(j--,V):void 0,q&&m(H[0],H[1],q)&&(V=j<3?void 0:V,j=1),U=Object(U);++G<j;){var W=H[G];W&&F(U,W,G,V)}return U})}(function(F,U){if(P||S(U)||d(U))return void _(U,f(U),F);for(var H in U)c.call(U,H)&&I(F,H,U[H])});w.exports=B},function(w,a,D){"use strict";function y(b,I,L){L=L===void 0?1:L,b[I]=b[I]||0,b[I]+=L}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(18),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I=b.default.methodFactory;b.default.methodFactory=function(L,R,_){var u=I(L,R,_);return function(){for(var m=["[mux]"],S=0;S<arguments.length;S++)m.push(arguments[S]);u.apply(void 0,m)}},b.default.setLevel(b.default.getLevel()),a.default=b.default},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=function(L){return I(L)[0]},b=function(L){return I(L)[1]},I=function(L){if(typeof L!="string"||L==="")return["localhost"];var R=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,_=L.match(R)||[],u=_[4],m=void 0;return u&&(m=(u.match(/[^\.]+\.[^\.]+$/)||[])[0]),[u,m]};a.extractHostnameAndDomain=I,a.extractHostname=y,a.extractDomain=b},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(I){var L=16*Math.random()|0;return(I==="x"?L:3&L|8).toString(16)})},b=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)};a.generateUUID=y,a.generateShortID=b},function(w,a,D){"use strict";function y(I){I=I||"";var L={};return I.trim().split(/[\r\n]+/).forEach(function(R){if(R){var _=R.split(": "),u=_.shift();u&&b.indexOf(u.toLowerCase())>=0&&(L[u]=_.join(": "))}}),L}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y;var b=["x-cdn","content-type"]},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.findMediaElement=a.getMuxPlayerId=void 0;var y=D(6),b=function(L){return L&&L.nodeName!==void 0?(L.muxId||(L.muxId=L.id||(0,y.generateShortID)()),L.muxId):L},I=function(L){var R=void 0;return L&&L.nodeName!==void 0?(R=L,L=b(R)):R=document.querySelector(L),[R,L,R&&R.nodeName?R.nodeName.toLowerCase():""]};a.getMuxPlayerId=b,a.findMediaElement=I},function(w,a,D){"use strict";function y(){return(I.default.doNotTrack||I.default.navigator&&(I.default.navigator.doNotTrack||I.default.navigator.msDoNotTrack))==="1"}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y;var b=D(0),I=function(L){return L&&L.__esModule?L:{default:L}}(b)},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(0),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I={};I.exists=function(){var L=b.default.performance;return(L&&L.timing)!==void 0},I.domContentLoadedEventEnd=function(){var L=b.default.performance,R=L&&L.timing;return R&&R.domContentLoadedEventEnd},I.navigationStart=function(){var L=b.default.performance,R=L&&L.timing;return R&&R.navigationStart},a.default=I},function(w,a,D){"use strict";var y=D(37),b=D(38),I=D(13);w.exports={formats:I,parse:b,stringify:y}},function(w,a,D){"use strict";var y=Object.prototype.hasOwnProperty,b=function(){for(var L=[],R=0;R<256;++R)L.push("%"+((R<16?"0":"")+R.toString(16)).toUpperCase());return L}(),I=function(L){for(var R;L.length;){var _=L.pop();if(R=_.obj[_.prop],Array.isArray(R)){for(var u=[],m=0;m<R.length;++m)R[m]!==void 0&&u.push(R[m]);_.obj[_.prop]=u}}return R};a.arrayToObject=function(L,R){for(var _=R&&R.plainObjects?Object.create(null):{},u=0;u<L.length;++u)L[u]!==void 0&&(_[u]=L[u]);return _},a.merge=function(L,R,_){if(!R)return L;if(typeof R!="object"){if(Array.isArray(L))L.push(R);else{if(typeof L!="object")return[L,R];(_.plainObjects||_.allowPrototypes||!y.call(Object.prototype,R))&&(L[R]=!0)}return L}if(typeof L!="object")return[L].concat(R);var u=L;return Array.isArray(L)&&!Array.isArray(R)&&(u=a.arrayToObject(L,_)),Array.isArray(L)&&Array.isArray(R)?(R.forEach(function(m,S){y.call(L,S)?L[S]&&typeof L[S]=="object"?L[S]=a.merge(L[S],m,_):L.push(m):L[S]=m}),L):Object.keys(R).reduce(function(m,S){var E=R[S];return y.call(m,S)?m[S]=a.merge(m[S],E,_):m[S]=E,m},u)},a.assign=function(L,R){return Object.keys(R).reduce(function(_,u){return _[u]=R[u],_},L)},a.decode=function(L){try{return decodeURIComponent(L.replace(/\+/g," "))}catch{return L}},a.encode=function(L){if(L.length===0)return L;for(var R=typeof L=="string"?L:String(L),_="",u=0;u<R.length;++u){var m=R.charCodeAt(u);m===45||m===46||m===95||m===126||m>=48&&m<=57||m>=65&&m<=90||m>=97&&m<=122?_+=R.charAt(u):m<128?_+=b[m]:m<2048?_+=b[192|m>>6]+b[128|63&m]:m<55296||m>=57344?_+=b[224|m>>12]+b[128|m>>6&63]+b[128|63&m]:(u+=1,m=65536+((1023&m)<<10|1023&R.charCodeAt(u)),_+=b[240|m>>18]+b[128|m>>12&63]+b[128|m>>6&63]+b[128|63&m])}return _},a.compact=function(L){for(var R=[{obj:{o:L},prop:"o"}],_=[],u=0;u<R.length;++u)for(var m=R[u],S=m.obj[m.prop],E=Object.keys(S),A=0;A<E.length;++A){var d=E[A],e=S[d];typeof e=="object"&&e!==null&&_.indexOf(e)===-1&&(R.push({obj:S,prop:d}),_.push(e))}return I(R)},a.isRegExp=function(L){return Object.prototype.toString.call(L)==="[object RegExp]"},a.isBuffer=function(L){return L!=null&&!!(L.constructor&&L.constructor.isBuffer&&L.constructor.isBuffer(L))}},function(w,a,D){"use strict";var y=String.prototype.replace,b=/%20/g;w.exports={default:"RFC3986",formatters:{RFC1738:function(I){return y.call(I,b,"+")},RFC3986:function(I){return I}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(w,a,D){"use strict";function y(d){return d&&d.__esModule?d:{default:d}}function b(d){var e={};for(var t in d)d.hasOwnProperty(t)&&(e[d[t]]=t);return e}function I(d){var e={},t={};return Object.keys(d).forEach(function(i){var h=!1;if(d.hasOwnProperty(i)&&d[i]!==void 0){var n=i.split("_"),f=n[0],g=S[f];g||(R.default.info("Data key word `"+n[0]+"` not expected in "+i),g=f+"_"),n.splice(1).forEach(function(T){T==="url"&&(h=!0),A[T]?g+=A[T]:Number(T)&&Math.floor(Number(T))===Number(T)?g+=T:(R.default.info("Data key word `"+T+"` not expected in "+i),g+="_"+T+"_")}),h?t[g]=d[i]:e[g]=d[i]}}),(0,u.default)(e,t)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=I;var L=D(4),R=y(L),_=D(2),u=y(_),m={a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"},S=b(m),E={ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"},A=b(E)},function(w,a,D){"use strict";w.exports=D(16).default},function(w,a,D){"use strict";function y(T){return T&&T.__esModule?T:{default:T}}Object.defineProperty(a,"__esModule",{value:!0});var b=function(){function T(p,o){var s=[],r=!0,c=!1,l=void 0;try{for(var k,x=p[Symbol.iterator]();!(r=(k=x.next()).done)&&(s.push(k.value),!o||s.length!==o);r=!0);}catch(C){c=!0,l=C}finally{try{!r&&x.return&&x.return()}finally{if(c)throw l}}return s}return function(p,o){if(Array.isArray(p))return p;if(Symbol.iterator in Object(p))return T(p,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),I=D(0),L=y(I),R=D(8),_=D(4),u=y(_),m=D(9),S=y(m),E=D(1),A=y(E),d=D(19),e=y(d),t=D(45),i=y(t),h=D(46),n=y(h),f={},g=function T(p){var o=arguments;typeof p=="string"?T.hasOwnProperty(p)?L.default.setTimeout(function(){o=Array.prototype.splice.call(o,1),T[p].apply(null,o)},0):u.default.warn("`"+p+"` is an unknown task"):typeof p=="function"?L.default.setTimeout(function(){p(T)},0):u.default.warn("`"+p+"` is invalid.")};g.loaded=A.default.now(),g.NAME="mux-embed",g.VERSION="4.3.0",g.API_VERSION="2.1",g.PLAYER_TRACKED=!1,g.monitor=function(T,p){return(0,i.default)(g,T,p)},g.destroyMonitor=function(T){var p=(0,R.findMediaElement)(T),o=b(p,1),s=o[0];s&&s.mux&&typeof s.mux.destroy=="function"?s.mux.destroy():u.default.error("A video element monitor for `"+T+"` has not been initialized via `mux.monitor`.")},g.addHLSJS=function(T,p){var o=(0,R.getMuxPlayerId)(T);f[o]?f[o].addHLSJS(p):u.default.error("A monitor for `"+o+"` has not been initialized.")},g.addDashJS=function(T,p){var o=(0,R.getMuxPlayerId)(T);f[o]?f[o].addDashJS(p):u.default.error("A monitor for `"+o+"` has not been initialized.")},g.removeHLSJS=function(T){var p=(0,R.getMuxPlayerId)(T);f[p]?f[p].removeHLSJS():u.default.error("A monitor for `"+p+"` has not been initialized.")},g.removeDashJS=function(T){var p=(0,R.getMuxPlayerId)(T);f[p]?f[p].removeDashJS():u.default.error("A monitor for `"+p+"` has not been initialized.")},g.init=function(T,p){(0,S.default)()&&p&&p.respectDoNotTrack&&u.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var o=(0,R.getMuxPlayerId)(T);f[o]=new e.default(g,o,p)},g.emit=function(T,p,o){var s=(0,R.getMuxPlayerId)(T);f[s]?(f[s].emit(p,o),p==="destroy"&&delete f[s]):u.default.error("A monitor for `"+s+"` has not been initialized.")},L.default!==void 0&&typeof L.default.addEventListener=="function"&&L.default.addEventListener("unload",function(){g.WINDOW_UNLOADING=!0},!1),g.checkDoNotTrack=S.default,g.log=u.default,g.utils=n.default,a.default=g},function(w,a){var D;D=function(){return this}();try{D=D||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(D=window)}w.exports=D},function(w,a,D){var y,b;(function(I,L){"use strict";y=L,(b=typeof y=="function"?y.call(a,D,a,w):y)!==void 0&&(w.exports=b)})(0,function(){"use strict";function I(n,f){var g=n[f];if(typeof g.bind=="function")return g.bind(n);try{return Function.prototype.bind.call(g,n)}catch{return function(){return Function.prototype.apply.apply(g,[n,arguments])}}}function L(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function R(n){return n==="debug"&&(n="log"),typeof console!==A&&(n==="trace"&&d?L:console[n]!==void 0?I(console,n):console.log!==void 0?I(console,"log"):E)}function _(n,f){for(var g=0;g<e.length;g++){var T=e[g];this[T]=g<n?E:this.methodFactory(T,n,f)}this.log=this.debug}function u(n,f,g){return function(){typeof console!==A&&(_.call(this,f,g),this[n].apply(this,arguments))}}function m(n,f,g){return R(n)||u.apply(this,arguments)}function S(n,f,g){function T(l){var k=(e[l]||"silent").toUpperCase();if(typeof window!==A&&r){try{return void(window.localStorage[r]=k)}catch{}try{window.document.cookie=encodeURIComponent(r)+"="+k+";"}catch{}}}function p(){var l;if(typeof window!==A&&r){try{l=window.localStorage[r]}catch{}if(typeof l===A)try{var k=window.document.cookie,x=k.indexOf(encodeURIComponent(r)+"=");x!==-1&&(l=/^([^;]+)/.exec(k.slice(x))[1])}catch{}return s.levels[l]===void 0&&(l=void 0),l}}var o,s=this,r="loglevel";typeof n=="string"?r+=":"+n:typeof n=="symbol"&&(r=void 0),s.name=n,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=g||m,s.getLevel=function(){return o},s.setLevel=function(l,k){if(typeof l=="string"&&s.levels[l.toUpperCase()]!==void 0&&(l=s.levels[l.toUpperCase()]),!(typeof l=="number"&&l>=0&&l<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+l;if(o=l,k!==!1&&T(l),_.call(s,l,n),typeof console===A&&l<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(l){p()||s.setLevel(l,!1)},s.enableAll=function(l){s.setLevel(s.levels.TRACE,l)},s.disableAll=function(l){s.setLevel(s.levels.SILENT,l)};var c=p();c==null&&(c=f==null?"WARN":f),s.setLevel(c,!1)}var E=function(){},A="undefined",d=typeof window!==A&&typeof window.navigator!==A&&/Trident\/|MSIE /.test(window.navigator.userAgent),e=["trace","debug","info","warn","error"],t=new S,i={};t.getLogger=function(n){if(typeof n!="symbol"&&typeof n!="string"||n==="")throw new TypeError("You must supply a name when creating a logger.");var f=i[n];return f||(f=i[n]=new S(n,t.getLevel(),t.methodFactory)),f};var h=typeof window!==A?window.log:void 0;return t.noConflict=function(){return typeof window!==A&&window.log===t&&(window.log=h),t},t.getLoggers=function(){return i},t.default=t,t})},function(w,a,D){"use strict";function y(Q){return Q&&Q.__esModule?Q:{default:Q}}Object.defineProperty(a,"__esModule",{value:!0});var b=function(){function Q(X,z){var oe=[],he=!0,fe=!1,ge=void 0;try{for(var de,pe=X[Symbol.iterator]();!(he=(de=pe.next()).done)&&(oe.push(de.value),!z||oe.length!==z);he=!0);}catch(se){fe=!0,ge=se}finally{try{!he&&pe.return&&pe.return()}finally{if(fe)throw ge}}return oe}return function(X,z){if(Array.isArray(X))return X;if(Symbol.iterator in Object(X))return Q(X,z);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),I=D(4),L=y(I),R=D(2),_=y(R),u=D(6),m=D(5),S=D(0),E=y(S),A=D(10),d=y(A),e=D(3),t=y(e),i=D(20),h=D(21),n=D(22),f=y(n),g=D(23),T=y(g),p=D(24),o=y(p),s=D(25),r=y(s),c=D(26),l=y(c),k=D(27),x=y(k),C=D(28),P=y(C),N=D(29),B=y(N),F=D(30),U=y(F),H=D(31),G=y(H),j=D(32),V=y(j),q=D(33),W=y(q),Y=D(34),$=y(Y),Z=D(35),te=y(Z),ie=D(44),ve=y(ie),ae=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],re=function(Q,X,z){var oe=this;this.DOM_CONTENT_LOADED_EVENT_END=d.default.domContentLoadedEventEnd(),this.NAVIGATION_START=d.default.navigationStart();var he={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(se){return se}};this.mux=Q,this.id=X,z=(0,_.default)(he,z),z.data=z.data||{},z.data.property_key&&(z.data.env_key=z.data.property_key,delete z.data.property_key),L.default.setLevel(z.debug?"debug":"warn"),this.getPlayheadTime=z.getPlayheadTime,this.getStateData=z.getStateData||function(){},this.getAdData=z.getAdData||function(){},this.minimumRebufferDuration=z.minimumRebufferDuration,this.sustainedRebufferThreshold=z.sustainedRebufferThreshold,this.playbackHeartbeatTime=z.playbackHeartbeatTime,this.disableRebufferTracking=z.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=z.errorTranslator,this.playbackEventDispatcher=new te.default(Q,z.data.env_key,z),this.data={player_instance_id:(0,u.generateUUID)(),mux_sample_rate:z.sampleRate,beacon_domain:z.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(se,ue){ue=(0,_.default)({viewer_time:this.mux.utils.now()},ue),this.oldEmit(se,ue)};var fe=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",function(se,ue){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,_.default)(this.data,ue),this._initializeViewData(),this.one("play",fe),this.one("adbreakstart",fe)});var ge=function(se){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",se)}.bind(this);this.on("videochange",function(se,ue){ge(ue)}),this.on("programchange",function(se,ue){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),ge((0,_.default)(ue,{view_program_changed:!0})),fe(),this.emit("play"),this.emit("playing")}),this.on("fragmentchange",function(se,ue){this.currentFragmentPDT=ue.currentFragmentPDT,this.currentFragmentStart=ue.currentFragmentStart}),this.on("destroy",this.destroy);var de=this.destroy.bind(this);E.default!==void 0&&typeof E.default.addEventListener=="function"&&E.default.addEventListener("unload",de,!1),this.on("destroy",function(){E.default!==void 0&&typeof E.default.removeEventListener=="function"&&E.default.removeEventListener("unload",de)}),this.on("playerready",function(se,ue){(0,_.default)(this.data,ue)}),ae.forEach(function(se){oe.on(se,function(ue,Se){se.indexOf("ad")!==0&&this._updateStateData(),(0,_.default)(this.data,Se),this._sanitizeData()}),oe.on("after"+se,function(){(se!=="error"||this.viewErrored)&&this.send(se)})}),this.on("viewend",function(se,ue){(0,_.default)(oe.data,ue)});var pe=function(se){var ue=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=ue-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time};this.one("playerready",pe),o.default.apply(this),$.default.apply(this),G.default.apply(this),x.default.apply(this),T.default.apply(this),U.default.apply(this),r.default.apply(this),l.default.apply(this),V.default.apply(this),P.default.apply(this),B.default.apply(this),W.default.apply(this),ve.default.apply(this),z.hlsjs&&this.addHLSJS(z),z.dashjs&&this.addDashJS(z),this.emit("viewinit",z.data)};(0,_.default)(re.prototype,f.default.prototype),(0,_.default)(re.prototype,x.default.prototype),(0,_.default)(re.prototype,G.default.prototype),(0,_.default)(re.prototype,T.default.prototype),(0,_.default)(re.prototype,r.default.prototype),(0,_.default)(re.prototype,l.default.prototype),(0,_.default)(re.prototype,V.default.prototype),(0,_.default)(re.prototype,P.default.prototype),(0,_.default)(re.prototype,B.default.prototype),re.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),E.default.clearTimeout(this._heartBeatTimeout))},re.prototype.send=function(Q){var X=(0,_.default)({},this.data);if(X.player_error_code===1&&(delete X.player_error_code,delete X.player_error_message),X.player_source_duration===1/0||X.video_source_duration===1/0?X.video_source_is_live=!0:(X.player_source_duration>0||X.video_source_duration>0)&&(X.video_source_is_live=!1),X.video_source_url=X.video_source_url||X.player_source_url,X.video_source_url){var z=(0,m.extractHostnameAndDomain)(X.video_source_url),oe=b(z,2),he=oe[0],fe=oe[1];X.video_source_domain=fe,X.video_source_hostname=he}delete X.ad_request_id,this.playbackEventDispatcher.send(Q,X),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},re.prototype._updateStateData=function(){(0,_.default)(this.data,this.getStateData()),this._updatePlayheadTime(),this._sanitizeData()},re.prototype._sanitizeData=function(){var Q=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(X){var z=parseInt(Q.data[X],10);Q.data[X]=isNaN(z)?void 0:z}),["player_source_url","video_source_url"].forEach(function(X){if(Q.data[X]){var z=Q.data[X].toLowerCase();z.indexOf("data:")!==0&&z.indexOf("blob:")!==0||(Q.data[X]="MSE style URL")}})},re.prototype._resetVideoData=function(Q,X){var z=this;Object.keys(this.data).forEach(function(oe){oe.indexOf("video_")===0&&delete z.data[oe]})},re.prototype._resetViewData=function(){var Q=this;Object.keys(this.data).forEach(function(X){X.indexOf("view_")===0&&delete Q.data[X]}),this.data.view_sequence_number=1},re.prototype._resetErrorData=function(Q,X){delete this.data.player_error_code,delete this.data.player_error_message},re.prototype._initializeViewData=function(){var Q=this,X=this.data.view_id=(0,u.generateUUID)(),z=function(){X===Q.data.view_id&&(0,t.default)(Q.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",z):z()},re.prototype._restartHeartBeat=function(){var Q=this;E.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=E.default.setTimeout(function(){Q.data.player_is_paused||Q.emit("hb")},1e4))},re.prototype.addHLSJS=function(Q){return Q.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=Q.hlsjs,void(0,i.monitorHlsJs)(this.mux,this.id,Q.hlsjs,{},Q.Hls||E.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},re.prototype.removeHLSJS=function(){this.hlsjs&&((0,i.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},re.prototype.addDashJS=function(Q){return Q.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=Q.dashjs,void(0,h.monitorDashJS)(this.mux,this.id,Q.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},re.prototype.removeDashJS=function(){this.dashjs&&((0,h.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},a.default=re},function(w,a,D){"use strict";function y(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(a,"__esModule",{value:!0}),a.stopMonitoringHlsJs=a.monitorHlsJs=void 0;var b=D(7),I=y(b),L=D(10),R=y(L),_=D(5),u=function(A){if(!A)return{};var d=R.default.navigationStart(),e=A.loading,t=e?e.start:A.trequest,i=e?e.first:A.tfirst,h=e?e.end:A.tload;return{bytesLoaded:A.total,requestStart:Math.round(d+t),responseStart:Math.round(d+i),responseEnd:Math.round(d+h)}},m=function(A){if(A&&typeof A.getAllResponseHeaders=="function")return(0,I.default)(A.getAllResponseHeaders())},S=function(A,d,e){var t=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments[4]),i=A.log,h=A.utils.secondsToMs,n=function(k){var x=parseInt(t.version),C=void 0;return x===1&&k.programDateTime!==null&&(C=k.programDateTime),x===0&&k.pdt!==null&&(C=k.pdt),C};if(!R.default.exists())return void i.warn("performance timing not supported. Not tracking HLS.js.");var f=function(k,x){return A.emit(d,k,x)},g=function(k,x){var C=x.levels,P=x.audioTracks,N=x.url,B=x.stats,F=x.networkDetails,U={},H={};C.forEach(function(Y,$){U[$]={width:Y.width,height:Y.height,bitrate:Y.bitrate,attrs:Y.attrs}}),P.forEach(function(Y,$){H[$]={name:Y.name,language:Y.lang,bitrate:Y.bitrate}});var G=u(B),j=G.bytesLoaded,V=G.requestStart,q=G.responseStart,W=G.responseEnd;f("requestcompleted",{request_event_type:k,request_bytes_loaded:j,request_start:V,request_response_start:q,request_response_end:W,request_type:"manifest",request_hostname:(0,_.extractHostname)(N),request_response_headers:m(F),request_rendition_lists:{media:U,audio:H,video:{}}})};e.on(t.Events.MANIFEST_LOADED,g);var T=function(k,x){var C=x.details,P=x.level,N=x.networkDetails,B=x.stats,F=u(B),U=F.bytesLoaded,H=F.requestStart,G=F.responseStart,j=F.responseEnd,V=C.fragments[C.fragments.length-1],q=n(V)+h(V.duration);f("requestcompleted",{request_event_type:k,request_bytes_loaded:U,request_start:H,request_response_start:G,request_response_end:j,request_current_level:P,request_type:"manifest",request_hostname:(0,_.extractHostname)(C.url),request_response_headers:m(N),video_holdback:C.holdBack&&h(C.holdBack),video_part_holdback:C.partHoldBack&&h(C.partHoldBack),video_part_target_duration:C.partTarget&&h(C.partTarget),video_target_duration:C.targetduration&&h(C.targetduration),player_manifest_newest_program_time:isNaN(q)?void 0:q})};e.on(t.Events.LEVEL_LOADED,T);var p=function(k,x){var C=x.details,P=x.networkDetails,N=x.stats,B=u(N),F=B.bytesLoaded,U=B.requestStart,H=B.responseStart,G=B.responseEnd;f("requestcompleted",{request_event_type:k,request_bytes_loaded:F,request_start:U,request_response_start:H,request_response_end:G,request_type:"manifest",request_hostname:(0,_.extractHostname)(C.url),request_response_headers:m(P)})};e.on(t.Events.AUDIO_TRACK_LOADED,p);var o=function(k,x){var C=x.stats,P=x.networkDetails,N=x.frag,B=u(C),F=B.bytesLoaded,U=B.requestStart,H=B.responseStart,G=B.responseEnd,j={request_event_type:k,request_bytes_loaded:F,request_start:U,request_response_start:H,request_response_end:G,request_hostname:P?(0,_.extractHostname)(P.responseURL):void 0,request_response_headers:m(P),request_media_duration:N.duration};N.type==="main"?(j.request_type="media",j.request_current_level=N.level,j.request_video_width=(e.levels[N.level]||{}).width,j.request_video_height=(e.levels[N.level]||{}).height):j.request_type=N.type,f("requestcompleted",j)};e.on(t.Events.FRAG_LOADED,o);var s=function(k,x){var C=x.frag,P=C.start,N=n(C),B={currentFragmentPDT:N,currentFragmentStart:h(P)};f("fragmentchange",B)};e.on(t.Events.FRAG_CHANGED,s);var r=function(k,x){var C=x.details,P=x.response,N=x.context,B=x.frag;if(C===t.ErrorDetails.MANIFEST_LOAD_ERROR||C===t.ErrorDetails.MANIFEST_LOAD_TIMEOUT||C===t.ErrorDetails.FRAG_LOAD_ERROR||C===t.ErrorDetails.FRAG_LOAD_TIMEOUT||C===t.ErrorDetails.LEVEL_LOAD_ERROR||C===t.ErrorDetails.LEVEL_LOAD_TIMEOUT){var F=B&&B.url||N&&N.url||"";f("requestfailed",{request_error:C,request_url:F,request_hostname:(0,_.extractHostname)(F),request_type:C===t.ErrorDetails.FRAG_LOAD_ERROR||C===t.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:P&&P.code,request_error_text:P&&P.text})}};e.on(t.Events.ERROR,r);var c=function(k,x){var C=x.frag,P=C&&C._url||"";f("requestcanceled",{request_cancel:k,request_url:P,request_type:"media",request_hostname:(0,_.extractHostname)(P)})};e.on(t.Events.FRAG_LOAD_EMERGENCY_ABORTED,c);var l=function(k,x){var C=x.level,P=e.levels[C];if(P&&P.attrs&&P.attrs.BANDWIDTH){var N=P.attrs.BANDWIDTH;N?f("renditionchange",{video_source_bitrate:N,video_source_width:P.width,video_source_height:P.height}):i.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};e.on(t.Events.LEVEL_SWITCHED,l),e._stopMuxMonitor=function(){e.off(t.Events.MANIFEST_LOADED,g),e.off(t.Events.LEVEL_LOADED,T),e.off(t.Events.AUDIO_TRACK_LOADED,p),e.off(t.Events.FRAG_LOADED,o),e.off(t.Events.FRAG_CHANGED,s),e.off(t.Events.ERROR,r),e.off(t.Events.FRAG_LOAD_EMERGENCY_ABORTED,c),e.off(t.Events.LEVEL_SWITCHED,l),e.off(t.Events.DESTROYING,e._stopMuxMonitor),delete e._stopMuxMonitor},e.on(t.Events.DESTROYING,e._stopMuxMonitor)},E=function(A){A&&typeof A._stopMuxMonitor=="function"&&A._stopMuxMonitor()};a.monitorHlsJs=S,a.stopMonitoringHlsJs=E},function(w,a,D){"use strict";function y(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(a,"__esModule",{value:!0}),a.stopMonitoringDashJS=a.monitorDashJS=void 0;var b=D(0),I=y(b),L=D(7),R=y(L),_=D(5),u=function(A,d){if(!A||typeof A.getRequests!="function")return{};var e=A.getRequests({state:"executed"});if(e.length===0)return{};var t=e[e.length-1],i=(0,_.extractHostname)(t.url),h=t.bytesLoaded,n=new Date(t.requestStartDate).getTime(),f=new Date(t.firstByteDate).getTime(),g=new Date(t.requestEndDate).getTime(),T=isNaN(t.duration)?0:t.duration,p=typeof d.getMetricsFor=="function"?d.getMetricsFor(t.mediaType).HttpList:d.getDashMetrics().getHttpRequests(t.mediaType),o=void 0;return p.length>0&&(o=(0,R.default)(p[p.length-1]._responseHeaders||"")),{requestStart:n,requestResponseStart:f,requestResponseEnd:g,requestBytesLoaded:h,requestResponseHeaders:o,requestMediaDuration:T,requestHostname:i}},m=function(A,d){var e=d.getQualityFor(A),t=d.getCurrentTrackFor(A),i=t.bitrateList;return i?{currentLevel:e,renditionWidth:i[e].width||null,renditionHeight:i[e].height||null,renditionBitrate:i[e].bandwidth}:{}},S=function(A,d,e){var t=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],A.log);if(!e||!e.on)return void t.warn("Invalid dash.js player reference. Monitoring blocked.");var i=function(r,c){return A.emit(d,r,c)},h=function(r){var c=r.type,l=r.data,k=l||{},x=k.url;i("requestcompleted",{request_event_type:c,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,_.extractHostname)(x)})};e.on("manifestLoaded",h);var n={},f=function(r){var c=r.type,l=r.fragmentModel,k=r.chunk,x=k||{},C=x.mediaInfo,P=C||{},N=P.type,B=P.bitrateList;B=B||[];var F={};B.forEach(function(Y,$){F[$]={},F[$].width=Y.width,F[$].height=Y.height,F[$].bitrate=Y.bandwidth,F[$].attrs={}}),N==="video"?n.video=F:N==="audio"?n.audio=F:n.media=F;var U=u(l,e),H=U.requestStart,G=U.requestResponseStart,j=U.requestResponseEnd,V=U.requestResponseHeaders,q=U.requestMediaDuration,W=U.requestHostname;i("requestcompleted",{request_event_type:c,request_start:H,request_response_start:G,request_response_end:j,request_bytes_loaded:-1,request_type:N+"_init",request_response_headers:V,request_hostname:W,request_media_duration:q,request_rendition_lists:n})};e.on("initFragmentLoaded",f);var g=function(r){var c=r.type,l=r.fragmentModel,k=r.chunk,x=k||{},C=x.mediaInfo,P=x.start,N=C||{},B=N.type,F=u(l,e),U=F.requestStart,H=F.requestResponseStart,G=F.requestResponseEnd,j=F.requestBytesLoaded,V=F.requestResponseHeaders,q=F.requestMediaDuration,W=F.requestHostname,Y=m(B,e),$=Y.currentLevel,Z=Y.renditionWidth,te=Y.renditionHeight,ie=Y.renditionBitrate;i("requestcompleted",{request_event_type:c,request_start:U,request_response_start:H,request_response_end:G,request_bytes_loaded:j,request_type:B,request_response_headers:V,request_hostname:W,request_media_start_time:P,request_media_duration:q,request_current_level:$,request_labeled_bitrate:ie,request_video_width:Z,request_video_height:te})};e.on("mediaFragmentLoaded",g);var T={video:void 0,audio:void 0,totalBitrate:void 0},p=function(){if(T.video&&typeof T.video.bitrate=="number"){if(!T.video.width||!T.video.height)return void t.warn("have bitrate info for video but missing width/height");var r=T.video.bitrate;return T.audio&&typeof T.audio.bitrate=="number"&&(r+=T.audio.bitrate),r!==T.totalBitrate?(T.totalBitrate=r,{video_source_bitrate:r,video_source_height:T.video.height,video_source_width:T.video.width}):void 0}},o=function(r,c,l){if(typeof r.newQuality!="number")return void t.warn("missing evt.newQuality in qualityChangeRendered event",r);var k=r.mediaType;if(k==="audio"||k==="video"){var x=e.getBitrateInfoListFor(k).find(function(P){return P.qualityIndex===r.newQuality});if(!x||typeof x.bitrate!="number")return void t.warn("missing bitrate info for "+k);T[k]=x;var C=p();C&&i("renditionchange",C)}};e.on("qualityChangeRendered",o);var s=function(r){var c=r.error,l=r.event;l=l||{};var k=l.request||{},x=I.default.event&&I.default.event.currentTarget||{};i("requestfailed",{request_error:c+"_"+l.id+"_"+k.type,request_url:l.url,request_hostname:(0,_.extractHostname)(l.url),request_type:k.mediaType,request_error_code:x.status,request_error_type:x.statusText})};e.on("error",s),e._stopMuxMonitor=function(){e.off("manifestLoaded",h),e.off("initFragmentLoaded",f),e.off("mediaFragmentLoaded",g),e.off("qualityChangeRendered",o),e.off("error",s),delete e._stopMuxMonitor}},E=function(A){A&&typeof A._stopMuxMonitor=="function"&&A._stopMuxMonitor()};a.monitorDashJS=S,a.stopMonitoringDashJS=E},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=function(){},b=0;y.prototype.on=function(I,L,R){return L._eventEmitterGuid=L._eventEmitterGuid||++b,this._listeners=this._listeners||{},this._listeners[I]=this._listeners[I]||[],R&&(L=L.bind(R)),this._listeners[I].push(L),L},y.prototype.off=function(I,L){var R=this._listeners&&this._listeners[I];R&&R.forEach(function(_,u){_._eventEmitterGuid===L._eventEmitterGuid&&R.splice(u,1)})},y.prototype.one=function(I,L,R){var _=this;L._eventEmitterGuid=L._eventEmitterGuid||++b;var u=function m(){_.off(I,m),L.apply(R||this,arguments)};u._eventEmitterGuid=L._eventEmitterGuid,this.on(I,u)},y.prototype.emit=function(I,L){var R=this;if(this._listeners){L=L||{};var _=this._listeners["before*"]||[],u=this._listeners[I]||[],m=this._listeners["after"+I]||[],S=function(E,A){E=E.slice(),E.forEach(function(d){d.call(R,{type:I},A)})};S(_,L),S(u,L),S(m,L)}},a.default=y},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(0),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",function(){this._playheadShouldBeProgressing=!0}),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()}),this.on("timeupdate",function(){this._playbackHeartbeatInterval!==null&&this.emit("playbackheartbeat")}),this.on("devicesleep",function(L,R){this._playbackHeartbeatInterval!==null&&(b.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:R.viewer_time}),this._playbackHeartbeatInterval=null)})};I.prototype._startPlaybackHeartbeatInterval=function(){var L=this;this._playbackHeartbeatInterval===null&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=b.default.setInterval(function(){L.emit("playbackheartbeat")},this.playbackHeartbeatTime))},I.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(b.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},a.default=I},function(w,a,D){"use strict";function y(){var b=this;this.on("viewinit",function(){b.viewErrored=!1}),this.on("error",function(){try{var I=b.errorTranslator({player_error_code:b.data.player_error_code,player_error_message:b.data.player_error_message});I?(b.data.player_error_code=I.player_error_code,b.data.player_error_message=I.player_error_message,b.viewErrored=!0):(delete b.data.player_error_code,delete b.data.player_error_message)}catch(L){b.mux.log.warn("Exception in error translator callback.",L),b.viewErrored=!0}})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(3),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};I.prototype._updateWatchTime=function(L,R){var _=R.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=_),(0,b.default)(this.data,"view_watch_time",_-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=_},I.prototype._clearWatchTimeState=function(L,R){this._updateWatchTime(L,R),this._watchTimeTrackerLastCheckedTime=null},a.default=I},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(3),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};I.prototype._updatePlaybackTime=function(){var L=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&L>this._playbackTimeTrackerLastPlayheadPosition){var R=L-this._playbackTimeTrackerLastPlayheadPosition;R<=1e3&&(0,b.default)(this.data,"view_content_playback_time",R)}this._playbackTimeTrackerLastPlayheadPosition=L},I.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},a.default=I},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",function(){this.off("timeupdate",this._updatePlayheadTime)})};y.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=this.data.view_max_playhead_position===void 0?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},y.prototype._updatePlayheadTime=function(b,I){if(I&&I.player_playhead_time)this.data.player_playhead_time=I.player_playhead_time,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+I.player_playhead_time-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var L=this.getPlayheadTime();L!==void 0&&(this.data.player_playhead_time=L,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+L-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition())}},a.default=y},function(w,a,D){"use strict";function y(u){return u&&u.__esModule?u:{default:u}}Object.defineProperty(a,"__esModule",{value:!0});var b=D(1),I=y(b),L=D(3),R=y(L),_=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",function(){this._cleanupRebufferTracker(null,{viewer_time:I.default.now()})})};_.prototype._checkIfRebuffering=function(u,m){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(u,m);if(this._lastCheckedTime===null)return this._prepareRebufferTrackerState(m.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(u,m,!0);var S=m.viewer_time-this._lastPlayheadTimeUpdatedTime;S>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(m.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,R.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(S),this.emit("rebufferstart"))),this._lastCheckedTime=m.viewer_time}},_.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},_.prototype._prepareRebufferTrackerState=function(u){this._lastCheckedTime=u,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=u},_.prototype._cleanupRebufferTracker=function(u,m){var S=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(m.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:m.viewer_time});else{if(this._lastCheckedTime===null)return void this._updateRebufferMetrics();var E=this.data.player_playhead_time-this._lastPlayheadTime,A=m.viewer_time-this._lastPlayheadTimeUpdatedTime;E>0&&A-E>this.minimumRebufferDuration?((0,R.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(A-E),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+A-E})):this._updateRebufferMetrics()}S?this._prepareRebufferTrackerState(m.viewer_time):this._clearRebufferTrackerState()}},_.prototype._updateRebufferMetrics=function(u){u>0&&(0,R.default)(this.data,"view_rebuffer_duration",u),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},a.default=_},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(1),b=function(L){return L&&L.__esModule?L:{default:L}}(y),I=function(){this.on("viewinit",function(){var L=this.data,R=L.view_id;if(!L.view_program_changed){var _=function(u,m){var S=m.viewer_time;u.type==="playing"&&this.data.view_time_to_first_frame===void 0?this.calculateTimeToFirstFrame(S||b.default.now(),R):u.type!=="adplaying"||this.data.view_time_to_first_frame!==void 0&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(S||b.default.now(),R)};this.one("playing",_),this.one("adplaying",_),this.one("viewend",function(){this.off("playing",_),this.off("adplaying",_)})}})};I.prototype.calculateTimeToFirstFrame=function(L,R){R===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:L}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},a.default=I},function(w,a,D){"use strict";function y(){var L=this;this.on("viewinit",function(){this._lastPlayheadPosition=-1});var R=["pause","rebufferstart","seeking","error","adbreakstart","hb"],_=["playing","hb"];R.forEach(function(u){L.on(u,function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var m=this.data.player_playhead_time-this._lastPlayheadPosition;if(m<0)return void(this._lastPlayheadPosition=-1);var S=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),E=Math.max(0,S-1),A=Math.max(0,1-S);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,E),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,A),(0,I.default)(this.data,"view_total_content_playback_time",m),(0,I.default)(this.data,"view_total_upscaling",E*m),(0,I.default)(this.data,"view_total_downscaling",A*m)}this._lastPlayheadPosition=-1})}),_.forEach(function(u){L.on(u,function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height})})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y;var b=D(3),I=function(L){return L&&L.__esModule?L:{default:L}}(b)},function(w,a,D){"use strict";function y(S){return S&&S.__esModule?S:{default:S}}function b(){this.isSeeking=!1,this.on("seeking",function(S,E){(0,m.default)(this.data,E),this._lastSeekingTime=L.default.now(),this.isSeeking===!1&&(this.isSeeking=!0,this.send("seeking"))}),this.on("seeked",function(){this.isSeeking=!1;var S=this._lastSeekingTime||L.default.now(),E=L.default.now()-S;(0,_.default)(this.data,"view_seek_count",1),(0,_.default)(this.data,"view_seek_duration",E);var A=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(A,E)}),this.on("viewend",function(){this.isSeeking=!1})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=b;var I=D(1),L=y(I),R=D(3),_=y(R),u=D(2),m=y(u)},function(w,a,D){"use strict";function y(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(a,"__esModule",{value:!0});var b=function(){function A(d,e){var t=[],i=!0,h=!1,n=void 0;try{for(var f,g=d[Symbol.iterator]();!(i=(f=g.next()).done)&&(t.push(f.value),!e||t.length!==e);i=!0);}catch(T){h=!0,n=T}finally{try{!i&&g.return&&g.return()}finally{if(h)throw n}}return t}return function(d,e){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return A(d,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),I=D(3),L=y(I),R=D(5),_=D(2),u=y(_),m=function(A,d){A.push(d),A.sort(function(e,t){return e.viewer_time-t.viewer_time})},S=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],E=function(){var A=this;this.on("viewinit",function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0}),S.forEach(function(e){return A.on(e,A._updateAdData)});var d=function(){A.isAdBreak=!1};this.on("adbreakstart",function(){this.isAdBreak=!0}),this.on("play",d),this.on("playing",d),this.on("viewend",d),this.on("adrequest",function(e,t){t=(0,u.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},t),m(this._adRequests,t),(0,L.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,L.default)(this.data,"view_preroll_request_count"))}),this.on("adresponse",function(e,t){t=(0,u.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},t),m(this._adResponses,t);var i=this.findAdRequest(t.ad_request_id);i&&(0,L.default)(this.data,"view_ad_request_time",Math.max(0,t.viewer_time-i.viewer_time))}),this.on("adplay",function(e,t){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,L.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,t.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,t.viewer_time-this.data.view_start)),this._prerollPlayTime=t.viewer_time)}),this.on("adplaying",function(e,t){this.inPrerollPosition()&&this.data.view_preroll_load_time===void 0&&this._prerollPlayTime!==void 0&&(this.data.view_preroll_load_time=t.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=t.viewer_time-this._prerollPlayTime)}),this.on("adended",function(){this._wouldBeNewAdPlay=!0}),this.on("aderror",function(){this._wouldBeNewAdPlay=!0})};E.prototype.inPrerollPosition=function(){return this.data.view_content_playback_time===void 0||this.data.view_content_playback_time<=1e3},E.prototype.findAdRequest=function(A){for(var d=0;d<this._adRequests.length;d++)if(this._adRequests[d].ad_request_id===A)return this._adRequests[d]},E.prototype._updateAdData=function(A,d){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&d.ad_tag_url){var e=(0,R.extractHostnameAndDomain)(d.ad_tag_url),t=b(e,2),i=t[0],h=t[1];this.data.view_preroll_ad_tag_domain=h,this.data.view_preroll_ad_tag_hostname=i}if(!this.data.view_preroll_ad_asset_hostname&&d.ad_asset_url){var n=(0,R.extractHostnameAndDomain)(d.ad_asset_url),f=b(n,2),g=f[0],T=f[1];this.data.view_preroll_ad_asset_domain=T,this.data.view_preroll_ad_asset_hostname=g}}},a.default=E},function(w,a,D){"use strict";function y(u){return u&&u.__esModule?u:{default:u}}function b(){var u=this,m=void 0,S=void 0,E=function(){u.disableRebufferTracking||((0,_.default)(u.data,"view_waiting_rebuffer_count",1),m=L.default.now(),S=window.setInterval(function(){if(m){var i=L.default.now();(0,_.default)(u.data,"view_waiting_rebuffer_duration",i-m),m=i}},250))},A=function(){u.disableRebufferTracking||m&&((0,_.default)(u.data,"view_waiting_rebuffer_duration",L.default.now()-m),m=!1,window.clearInterval(S))},d=!1,e=function(){d=!0},t=function(){d=!1,A()};this.on("waiting",function(){d&&E()}),this.on("playing",function(){A(),e()}),this.on("pause",t),this.on("seeking",t)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=b;var I=D(1),L=y(I),R=D(3),_=y(R)},function(w,a,D){"use strict";function y(S){return S&&S.__esModule?S:{default:S}}function b(){var S=this;this.one("playbackheartbeat",u),this.on("playbackheartbeatend",function(){S.off("before*",m),S.one("playbackheartbeat",u)})}Object.defineProperty(a,"__esModule",{value:!0}),a.default=b;var I=D(2),L=y(I),R=D(1),_=y(R),u=function(){this.lastWallClockTime=_.default.now(),this.on("before*",m)},m=function(S){var E=_.default.now(),A=this.lastWallClockTime;this.lastWallClockTime=E,E-A>3e4&&(this.emit("devicesleep",{viewer_time:A}),(0,L.default)(this.data,{viewer_time:A}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:E}),(0,L.default)(this.data,{viewer_time:E}),this.send("devicewake"))}},function(w,a,D){"use strict";function y(c){return c&&c.__esModule?c:{default:c}}Object.defineProperty(a,"__esModule",{value:!0});var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(c){return typeof c}:function(c){return c&&typeof Symbol=="function"&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c},I=D(0),L=y(I),R=D(36),_=D(4),u=y(_),m=D(40),S=y(m),E=D(9),A=y(E),d=D(41),e=y(d),t=D(14),i=y(t),h=D(42),n=y(h),f=D(2),g=y(f),T=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],p=["viewstart","error","ended","viewend"],o=function(c,l){var k=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=c,this.envKey=l,this.eventQueue=new n.default((0,S.default)(l,k.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=k.sampleRate,this.disableCookies=k.disableCookies,this.respectDoNotTrack=k.respectDoNotTrack;var x=k.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:x.name,viewer_application_version:x.version,viewer_application_engine:x.layout,viewer_device_name:x.product,viewer_device_category:"",viewer_device_manufacturer:x.manufacturer,viewer_os_family:x.os&&x.os.family,viewer_os_architecture:x.os&&x.os.architecture,viewer_os_version:x.os&&x.os.version};var C=(0,e.default)();C&&(this.pageLevelData=(0,g.default)(this.pageLevelData,{viewer_connection_type:C})),L.default!==void 0&&L.default.location&&L.default.location.href&&(this.pageLevelData.page_url=L.default.location.href),this.viewerData=this.disableCookies?{}:(0,R.getAndUpdateViewerData)()};o.prototype.send=function(c,l){if(c){if(this.respectDoNotTrack&&(0,A.default)())return u.default.info("Not sending `"+c+"` because Do Not Track is enabled");if(!l||(l===void 0?"undefined":b(l))!=="object")return u.default.error("A data object was expected in send() but was not provided");var k=this.disableCookies?{}:(0,R.getAndUpdateSessionData)(),x={};(0,g.default)(x,this.pageLevelData),(0,g.default)(x,l),(0,g.default)(x,k),(0,g.default)(x,this.viewerData),x.event=c,x.env_key=this.envKey,x.user_id&&(x.viewer_user_id=x.user_id,delete x.user_id);var C=x.mux_sample_number>=this.sampleRate,P=this._deduplicateBeaconData(c,x),N=(0,i.default)(P);if(this.lastEventTime=this.mux.utils.now(),C)return u.default.info("Not sending event due to sample rate restriction",c,x,N);if(!this.envKey)return u.default.info("Not sending event due to missing environment key",c,x,N);if(!this.rateLimited){if(u.default.info("Sending event",c,x,N),this.rateLimited=!this.eventQueue.queueEvent(c,N),this.mux.WINDOW_UNLOADING&&c==="viewend")this.eventQueue.destroy(!0);else if(p.indexOf(c)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return x.event="eventrateexceeded",N=(0,i.default)(x),this.eventQueue.queueEvent(x.event,N),u.default.error("Beaconing disabled due to rate limit.")}}},o.prototype.destroy=function(){this.eventQueue.destroy(!1)};var s=function(c,l,k,x){return!(!c||l.indexOf("request_")!==0)&&(l==="request_response_headers"||(k===void 0?"undefined":b(k))!=="object"||(x===void 0?"undefined":b(x))!=="object"||Object.keys(k||{}).length!==Object.keys(x||{}).length)},r=function(c,l){return c==="renditionchange"&&l.indexOf("video_source_")===0};o.prototype._deduplicateBeaconData=function(c,l){var k=this,x={},C=l.view_id;if(!C||c==="viewstart"||c==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)x=(0,g.default)({},l),C&&(this.previousBeaconData=x),C&&c==="viewend"&&(this.previousBeaconData=null);else{var P=c.indexOf("request")===0;Object.keys(l).forEach(function(N){var B=l[N];(B!==k.previousBeaconData[N]||T.indexOf(N)>-1||s(P,N,B,k.previousBeaconData[N])||r(c,N))&&(x[N]=B,k.previousBeaconData[N]=B)})}return x},a.default=o},function(w,a,D){"use strict";function y(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0}),a.getAndUpdateSessionData=a.getAndUpdateViewerData=void 0;var b=D(11),I=y(b),L=D(39),R=y(L),_=D(6),u=D(1),m=y(u),S=function(){var e=void 0;try{e=I.default.parse(R.default.get("muxData")||"")}catch{e={}}return e},E=function(e){try{R.default.set("muxData",I.default.stringify(e),{expires:7300})}catch{}},A=function(){var e=S();return e.mux_viewer_id=e.mux_viewer_id||(0,_.generateUUID)(),e.msn=e.msn||Math.random(),E(e),{mux_viewer_id:e.mux_viewer_id,mux_sample_number:e.msn}},d=function(){var e=S(),t=m.default.now();return e.session_start&&(e.sst=e.session_start,delete e.session_start),e.session_id&&(e.sid=e.session_id,delete e.session_id),e.session_expires&&(e.sex=e.session_expires,delete e.session_expires),(!e.sex||e.sex<t)&&(e.sid=(0,_.generateUUID)(),e.sst=t),e.sex=t+15e5,E(e),{session_id:e.sid,session_start:e.sst,session_expires:e.sex}};a.getAndUpdateViewerData=A,a.getAndUpdateSessionData=d},function(w,a,D){"use strict";var y=D(12),b=D(13),I={brackets:function(u){return u+"[]"},indices:function(u,m){return u+"["+m+"]"},repeat:function(u){return u}},L=Date.prototype.toISOString,R={delimiter:"&",encode:!0,encoder:y.encode,encodeValuesOnly:!1,serializeDate:function(u){return L.call(u)},skipNulls:!1,strictNullHandling:!1},_=function u(m,S,E,A,d,e,t,i,h,n,f,g){var T=m;if(typeof t=="function")T=t(S,T);else if(T instanceof Date)T=n(T);else if(T===null){if(A)return e&&!g?e(S,R.encoder):S;T=""}if(typeof T=="string"||typeof T=="number"||typeof T=="boolean"||y.isBuffer(T))return e?[f(g?S:e(S,R.encoder))+"="+f(e(T,R.encoder))]:[f(S)+"="+f(String(T))];var p=[];if(T===void 0)return p;var o;if(Array.isArray(t))o=t;else{var s=Object.keys(T);o=i?s.sort(i):s}for(var r=0;r<o.length;++r){var c=o[r];d&&T[c]===null||(p=Array.isArray(T)?p.concat(u(T[c],E(S,c),E,A,d,e,t,i,h,n,f,g)):p.concat(u(T[c],S+(h?"."+c:"["+c+"]"),E,A,d,e,t,i,h,n,f,g)))}return p};w.exports=function(u,m){var S=u,E=m?y.assign({},m):{};if(E.encoder!==null&&E.encoder!==void 0&&typeof E.encoder!="function")throw new TypeError("Encoder has to be a function.");var A=E.delimiter===void 0?R.delimiter:E.delimiter,d=typeof E.strictNullHandling=="boolean"?E.strictNullHandling:R.strictNullHandling,e=typeof E.skipNulls=="boolean"?E.skipNulls:R.skipNulls,t=typeof E.encode=="boolean"?E.encode:R.encode,i=typeof E.encoder=="function"?E.encoder:R.encoder,h=typeof E.sort=="function"?E.sort:null,n=E.allowDots!==void 0&&E.allowDots,f=typeof E.serializeDate=="function"?E.serializeDate:R.serializeDate,g=typeof E.encodeValuesOnly=="boolean"?E.encodeValuesOnly:R.encodeValuesOnly;if(E.format===void 0)E.format=b.default;else if(!Object.prototype.hasOwnProperty.call(b.formatters,E.format))throw new TypeError("Unknown format option provided.");var T,p,o=b.formatters[E.format];typeof E.filter=="function"?(p=E.filter,S=p("",S)):Array.isArray(E.filter)&&(p=E.filter,T=p);var s=[];if(typeof S!="object"||S===null)return"";var r;r=E.arrayFormat in I?E.arrayFormat:"indices"in E?E.indices?"indices":"repeat":"indices";var c=I[r];T||(T=Object.keys(S)),h&&T.sort(h);for(var l=0;l<T.length;++l){var k=T[l];e&&S[k]===null||(s=s.concat(_(S[k],k,c,d,e,t?i:null,p,h,n,f,o,g)))}var x=s.join(A),C=E.addQueryPrefix===!0?"?":"";return x.length>0?C+x:""}},function(w,a,D){"use strict";var y=D(12),b=Object.prototype.hasOwnProperty,I={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:y.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},L=function(u,m){for(var S={},E=m.ignoreQueryPrefix?u.replace(/^\?/,""):u,A=m.parameterLimit===1/0?void 0:m.parameterLimit,d=E.split(m.delimiter,A),e=0;e<d.length;++e){var t,i,h=d[e],n=h.indexOf("]="),f=n===-1?h.indexOf("="):n+1;f===-1?(t=m.decoder(h,I.decoder),i=m.strictNullHandling?null:""):(t=m.decoder(h.slice(0,f),I.decoder),i=m.decoder(h.slice(f+1),I.decoder)),b.call(S,t)?S[t]=[].concat(S[t]).concat(i):S[t]=i}return S},R=function(u,m,S){for(var E=m,A=u.length-1;A>=0;--A){var d,e=u[A];if(e==="[]")d=[],d=d.concat(E);else{d=S.plainObjects?Object.create(null):{};var t=e.charAt(0)==="["&&e.charAt(e.length-1)==="]"?e.slice(1,-1):e,i=parseInt(t,10);!isNaN(i)&&e!==t&&String(i)===t&&i>=0&&S.parseArrays&&i<=S.arrayLimit?(d=[],d[i]=E):d[t]=E}E=d}return E},_=function(u,m,S){if(u){var E=S.allowDots?u.replace(/\.([^.[]+)/g,"[$1]"):u,A=/(\[[^[\]]*])/,d=/(\[[^[\]]*])/g,e=A.exec(E),t=e?E.slice(0,e.index):E,i=[];if(t){if(!S.plainObjects&&b.call(Object.prototype,t)&&!S.allowPrototypes)return;i.push(t)}for(var h=0;(e=d.exec(E))!==null&&h<S.depth;){if(h+=1,!S.plainObjects&&b.call(Object.prototype,e[1].slice(1,-1))&&!S.allowPrototypes)return;i.push(e[1])}return e&&i.push("["+E.slice(e.index)+"]"),R(i,m,S)}};w.exports=function(u,m){var S=m?y.assign({},m):{};if(S.decoder!==null&&S.decoder!==void 0&&typeof S.decoder!="function")throw new TypeError("Decoder has to be a function.");if(S.ignoreQueryPrefix=S.ignoreQueryPrefix===!0,S.delimiter=typeof S.delimiter=="string"||y.isRegExp(S.delimiter)?S.delimiter:I.delimiter,S.depth=typeof S.depth=="number"?S.depth:I.depth,S.arrayLimit=typeof S.arrayLimit=="number"?S.arrayLimit:I.arrayLimit,S.parseArrays=S.parseArrays!==!1,S.decoder=typeof S.decoder=="function"?S.decoder:I.decoder,S.allowDots=typeof S.allowDots=="boolean"?S.allowDots:I.allowDots,S.plainObjects=typeof S.plainObjects=="boolean"?S.plainObjects:I.plainObjects,S.allowPrototypes=typeof S.allowPrototypes=="boolean"?S.allowPrototypes:I.allowPrototypes,S.parameterLimit=typeof S.parameterLimit=="number"?S.parameterLimit:I.parameterLimit,S.strictNullHandling=typeof S.strictNullHandling=="boolean"?S.strictNullHandling:I.strictNullHandling,u===""||u===null||u===void 0)return S.plainObjects?Object.create(null):{};for(var E=typeof u=="string"?L(u,S):u,A=S.plainObjects?Object.create(null):{},d=Object.keys(E),e=0;e<d.length;++e){var t=d[e],i=_(t,E[t],S);A=y.merge(A,i,S)}return y.compact(A)}},function(w,a,D){"use strict";var y,b,I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(L){return typeof L}:function(L){return L&&typeof Symbol=="function"&&L.constructor===Symbol&&L!==Symbol.prototype?"symbol":typeof L};(function(L){var R=!1;if(y=L,(b=typeof y=="function"?y.call(a,D,a,w):y)!==void 0&&(w.exports=b),R=!0,I(a)==="object"&&(w.exports=L(),R=!0),!R){var _=window.Cookies,u=window.Cookies=L();u.noConflict=function(){return window.Cookies=_,u}}})(function(){function L(_){function u(m,S,E){var A;if(typeof document!="undefined"){if(arguments.length>1){if(E=R({path:"/"},u.defaults,E),typeof E.expires=="number"){var d=new Date;d.setMilliseconds(d.getMilliseconds()+864e5*E.expires),E.expires=d}try{A=JSON.stringify(S),/^[\{\[]/.test(A)&&(S=A)}catch{}return S=_.write?_.write(S,m):encodeURIComponent(String(S)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),m=encodeURIComponent(String(m)),m=m.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),m=m.replace(/[\(\)]/g,escape),document.cookie=[m,"=",S,E.expires?"; expires="+E.expires.toUTCString():"",E.path?"; path="+E.path:"",E.domain?"; domain="+E.domain:"",E.secure?"; secure":""].join("")}m||(A={});for(var e=document.cookie?document.cookie.split("; "):[],t=/(%[0-9A-Z]{2})+/g,i=0;i<e.length;i++){var h=e[i].split("="),n=h.slice(1).join("=");n.charAt(0)==='"'&&(n=n.slice(1,-1));try{var f=h[0].replace(t,decodeURIComponent);if(n=_.read?_.read(n,f):_(n,f)||n.replace(t,decodeURIComponent),this.json)try{n=JSON.parse(n)}catch{}if(m===f){A=n;break}m||(A[f]=n)}catch{}}return A}}return u.set=u,u.get=function(m){return u.call(u,m)},u.getJSON=function(){return u.apply({json:!0},[].slice.call(arguments))},u.defaults={},u.remove=function(m,S){u(m,"",R(S,{expires:-1}))},u.withConverter=L,u}var R=function(){for(var _=0,u={};_<arguments.length;_++){var m=arguments[_];for(var S in m)u[S]=m[S]}return u};return L(function(){})})},function(w,a,D){"use strict";function y(b,I){return b=b||"",I=I||"litix.io",b.match(/^[a-z0-9]+$/)?"https://"+b+"."+I:"https://img.litix.io/a.gif"}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y},function(w,a,D){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var y=D(0),b=function(R){return R&&R.__esModule?R:{default:R}}(y),I=function(){var R=void 0;switch(L()){case"cellular":R="cellular";break;case"ethernet":R="wired";break;case"wifi":R="wifi";break;case void 0:break;default:R="other"}return R},L=function(){var R=b.default.navigator,_=R&&(R.connection||R.mozConnection||R.webkitConnection);return _&&_.type};a.default=I},function(w,a,D){"use strict";function y(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(a,"__esModule",{value:!0});var b=D(0),I=y(b),L=D(4),R=y(L),_=D(43),u=y(_),m=D(2),S=y(m),E=D(14),A=y(E),d=D(1),e=y(d),t=!!I.default.XMLHttpRequest&&"withCredentials"in new I.default.XMLHttpRequest,i={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},h=function(n,f){this._beaconUrl=n||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,S.default)({},i,f)};h.prototype.queueEvent=function(n,f){var g=(0,S.default)({},f);return t?(this._eventQueue.length<=this._options.maxQueueLength||n==="eventrateexceeded")&&(this._eventQueue.push(g),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(u.default.send(this._beaconUrl,g),!0)},h.prototype.flushEvents=function(){t&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},h.prototype.destroy=function(){var n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,n?this._clearBeaconQueue():this.flushEvents(),I.default.clearTimeout(this._sendTimeout)},h.prototype._clearBeaconQueue=function(){var n=I.default.navigator,f=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,g=this._eventQueue.slice(f);f>0&&(0,S.default)(g[g.length-1],(0,A.default)({mux_view_message:"event queue truncated"}));var T=this._createPayload(g);if(n.sendBeacon)n.sendBeacon(this._beaconUrl,T);else if(I.default.XMLHttpRequest){var p=new I.default.XMLHttpRequest;p.open("POST",this._beaconUrl),p.setRequestHeader("Content-Type","application/json"),p.send(T)}else u.default.send(this._beaconUrl,g[g.length-1])},h.prototype._sendBeaconQueue=function(){var n=this;if(I.default.XMLHttpRequest&&!this._postInFlight){var f=new I.default.XMLHttpRequest,g=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,f.onreadystatechange=function(){f.readyState===4&&(f.status!==200?(n._eventQueue=g.concat(n._eventQueue),n._failureCount+=1,R.default.info("Error sending beacon: "+f.status),R.default.info(f.responseText)):n._failureCount=0,n._roundTripTime=e.default.now()-p,n._postInFlight=!1)},f.open("POST",this._beaconUrl),f.setRequestHeader("Content-Type","application/json");var T=this._createPayload(g),p=e.default.now();f.send(T)}},h.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var n=Math.pow(2,this._failureCount-1);return(1+(n*=Math.random()))*this._options.baseTimeBetweenBeacons},h.prototype._startBeaconSending=function(){var n=this;I.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=I.default.setTimeout(function(){n._eventQueue.length&&n._sendBeaconQueue(),n._startBeaconSending()},this._getNextBeaconTime()))},h.prototype._createPayload=function(n){var f={transmission_timestamp:Math.round(e.default.now())};return this._roundTripTime&&(f.rtt_ms=Math.round(this._roundTripTime)),JSON.stringify({metadata:f,events:n})},a.default=h},function(w,a,D){"use strict";function y(u){return u&&u.__esModule?u:{default:u}}Object.defineProperty(a,"__esModule",{value:!0});var b=D(11),I=y(b),L=D(0),R=y(L),_={};_.send=function(u,m){function S(){E.src=d+(A?"&rc="+A:"")}var E=new Image,A=0,d=u+"?"+I.default.stringify(m);return E.addEventListener("error",function(){A>3||R.default.setTimeout(function(){A++,S()},5e3*A)}),S(),E},a.default=_},function(w,a,D){"use strict";function y(){function b(d,e){var t=e.request_start,i=e.request_response_start,h=e.request_response_end,n=e.request_bytes_loaded;m++;var f=void 0,g=void 0;if(i?(f=i-t,g=h-i):g=h-t,g>0&&n>0){var T=n/g*8e3;S++,_+=n,u+=g,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,T),this.data.view_average_request_throughput=_/u*8e3,this.data.view_request_count=m,f>0&&(R+=f,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,f),this.data.view_average_request_latency=R/S)}}function I(d,e){m++,E++,this.data.view_request_count=m,this.data.view_request_failed_count=E}function L(d,e){m++,A++,this.data.view_request_count=m,this.data.view_request_canceled_count=A}var R=0,_=0,u=0,m=0,S=0,E=0,A=0;this.on("requestcompleted",b),this.on("requestfailed",I),this.on("requestcanceled",L)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y},function(w,a,D){"use strict";function y(S,E,A){var d=(0,_.findMediaElement)(E),e=I(d,3),t=e[0],i=e[1],h=e[2],n=S.log,f=S.utils.getComputedStyle,g=S.utils.secondsToMs,T={automaticErrorTracking:!0};if(!t)return n.error("No element was found with the `"+i+"` query selector.");if(h!=="video"&&h!=="audio")return n.error("The element of `"+i+"` was not a media element.");A=(0,R.default)(T,A),A.data=(0,R.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.3.0"},A.data),A.getPlayheadTime=function(){return g(t.currentTime)},A.getStateData=function(){var o=this.hlsjs&&this.hlsjs.url,s=this.dashjs&&b(this.dashjs.getSource==="function")&&this.dashjs.getSource();return{player_is_paused:t.paused,player_playhead_time:g(t.currentTime),player_width:parseInt(f(t,"width")),player_height:parseInt(f(t,"height")),player_autoplay_on:t.autoplay,player_preload_on:t.preload,video_poster_url:t.poster,video_source_url:o||s||t.currentSrc,video_source_duration:g(t.duration),video_source_height:t.videoHeight,video_source_width:t.videoWidth}},t.mux=t.mux||{},t.mux.deleted=!1,t.mux.emit=function(o,s){S.emit(i,o,s)};var p=function(){n.error("The monitor for this video element has already been destroyed.")};t.mux.destroy=function(){Object.keys(t.mux.listeners).forEach(function(o){t.removeEventListener(o,t.mux.listeners[o],!1)}),delete t.mux.listeners,t.mux.destroy=p,t.mux.swapElement=p,t.mux.emit=p,t.mux.addHLSJS=p,t.mux.addDashJS=p,t.mux.removeHLSJS=p,t.mux.removeDashJS=p,t.mux.deleted=!0,S.emit(i,"destroy")},t.mux.swapElement=function(o){var s=(0,_.findMediaElement)(o),r=I(s,3),c=r[0],l=r[1],k=r[2];return c?k!=="video"&&k!=="audio"?S.log.error("The element of `"+l+"` was not a media element."):(c.muxId=t.muxId,delete t.muxId,c.mux=c.mux||{},c.mux.listeners=(0,R.default)({},t.mux.listeners),delete t.mux.listeners,Object.keys(c.mux.listeners).forEach(function(x){t.removeEventListener(x,c.mux.listeners[x],!1),c.addEventListener(x,c.mux.listeners[x],!1)}),c.mux.swapElement=t.mux.swapElement,c.mux.destroy=t.mux.destroy,delete t.mux,void(t=c)):S.log.error("No element was found with the `"+l+"` query selector.")},t.mux.addHLSJS=function(o){S.addHLSJS(i,o)},t.mux.addDashJS=function(o){S.addDashJS(i,o)},t.mux.removeHLSJS=function(){S.removeHLSJS(i)},t.mux.removeDashJS=function(){S.removeDashJS(i)},S.init(i,A),S.emit(i,"playerready"),t.paused||(S.emit(i,"play"),t.readyState>2&&S.emit(i,"playing")),t.mux.listeners={},u.forEach(function(o){(o!=="error"||A.automaticErrorTracking)&&(t.mux.listeners[o]=function(){var s={};if(o==="error"){if(!t.error)return;s.player_error_code=t.error.code,s.player_error_message=m[t.error.code]||t.error.message}S.emit(i,o,s)},t.addEventListener(o,t.mux.listeners[o],!1))})}Object.defineProperty(a,"__esModule",{value:!0});var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(S){return typeof S}:function(S){return S&&typeof Symbol=="function"&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":typeof S},I=function(){function S(E,A){var d=[],e=!0,t=!1,i=void 0;try{for(var h,n=E[Symbol.iterator]();!(e=(h=n.next()).done)&&(d.push(h.value),!A||d.length!==A);e=!0);}catch(f){t=!0,i=f}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}return d}return function(E,A){if(Array.isArray(E))return E;if(Symbol.iterator in Object(E))return S(E,A);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();a.default=y;var L=D(2),R=function(S){return S&&S.__esModule?S:{default:S}}(L),_=D(8),u=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],m={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(w,a,D){"use strict";function y(f){return f&&f.__esModule?f:{default:f}}Object.defineProperty(a,"__esModule",{value:!0});var b=D(47),I=y(b),L=D(3),R=y(L),_=D(48),u=y(_),m=D(49),S=y(m),E=D(2),A=y(E),d=D(7),e=y(d),t=D(5),i=D(1),h=y(i),n={};n.safeCall=I.default,n.safeIncrement=R.default,n.getComputedStyle=u.default,n.secondsToMs=S.default,n.assign=A.default,n.headersStringToObject=e.default,n.extractHostnameAndDomain=t.extractHostnameAndDomain,n.extractHostname=t.extractHostname,n.now=h.default.now,a.default=n},function(w,a,D){"use strict";function y(L,R,_,u){var m=u;if(L&&typeof L[R]=="function")try{m=L[R].apply(L,_)}catch(S){I.default.info("safeCall error",S)}return m}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y;var b=D(4),I=function(L){return L&&L.__esModule?L:{default:L}}(b)},function(w,a,D){"use strict";function y(R,_){if(R&&_&&I.default&&typeof I.default.getComputedStyle=="function"){var u=void 0;return L&&L.has(R)&&(u=L.get(R)),u||(u=I.default.getComputedStyle(R,null),L&&L.set(R,u)),u.getPropertyValue(_)}}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y;var b=D(0),I=function(R){return R&&R.__esModule?R:{default:R}}(b),L=void 0;I.default&&I.default.WeakMap&&(L=new WeakMap)},function(w,a,D){"use strict";function y(b){return Math.floor(1e3*b)}Object.defineProperty(a,"__esModule",{value:!0}),a.default=y}])})})()}),Ia=st((v,M)=>{typeof window!="undefined"&&function(O,w){typeof v=="object"&&typeof M=="object"?M.exports=w():typeof define=="function"&&define.amd?define([],w):typeof v=="object"?v.Hls=w():O.Hls=w()}(v,function(){return function(O){var w={};function a(D){if(w[D])return w[D].exports;var y=w[D]={i:D,l:!1,exports:{}};return O[D].call(y.exports,y,y.exports,a),y.l=!0,y.exports}return a.m=O,a.c=w,a.d=function(D,y,b){a.o(D,y)||Object.defineProperty(D,y,{enumerable:!0,get:b})},a.r=function(D){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(D,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(D,"__esModule",{value:!0})},a.t=function(D,y){if(y&1&&(D=a(D)),y&8||y&4&&typeof D=="object"&&D&&D.__esModule)return D;var b=Object.create(null);if(a.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:D}),y&2&&typeof D!="string")for(var I in D)a.d(b,I,function(L){return D[L]}.bind(null,I));return b},a.n=function(D){var y=D&&D.__esModule?function(){return D.default}:function(){return D};return a.d(y,"a",y),y},a.o=function(D,y){return Object.prototype.hasOwnProperty.call(D,y)},a.p="/dist/",a(a.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(O,w,a){"use strict";var D=Object.prototype.hasOwnProperty,y="~";function b(){}Object.create&&(b.prototype=Object.create(null),new b().__proto__||(y=!1));function I(u,m,S){this.fn=u,this.context=m,this.once=S||!1}function L(u,m,S,E,A){if(typeof S!="function")throw new TypeError("The listener must be a function");var d=new I(S,E||u,A),e=y?y+m:m;return u._events[e]?u._events[e].fn?u._events[e]=[u._events[e],d]:u._events[e].push(d):(u._events[e]=d,u._eventsCount++),u}function R(u,m){--u._eventsCount==0?u._events=new b:delete u._events[m]}function _(){this._events=new b,this._eventsCount=0}_.prototype.eventNames=function(){var u=[],m,S;if(this._eventsCount===0)return u;for(S in m=this._events)D.call(m,S)&&u.push(y?S.slice(1):S);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(m)):u},_.prototype.listeners=function(u){var m=y?y+u:u,S=this._events[m];if(!S)return[];if(S.fn)return[S.fn];for(var E=0,A=S.length,d=new Array(A);E<A;E++)d[E]=S[E].fn;return d},_.prototype.listenerCount=function(u){var m=y?y+u:u,S=this._events[m];return S?S.fn?1:S.length:0},_.prototype.emit=function(u,m,S,E,A,d){var e=y?y+u:u;if(!this._events[e])return!1;var t=this._events[e],i=arguments.length,h,n;if(t.fn){switch(t.once&&this.removeListener(u,t.fn,void 0,!0),i){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,m),!0;case 3:return t.fn.call(t.context,m,S),!0;case 4:return t.fn.call(t.context,m,S,E),!0;case 5:return t.fn.call(t.context,m,S,E,A),!0;case 6:return t.fn.call(t.context,m,S,E,A,d),!0}for(n=1,h=new Array(i-1);n<i;n++)h[n-1]=arguments[n];t.fn.apply(t.context,h)}else{var f=t.length,g;for(n=0;n<f;n++)switch(t[n].once&&this.removeListener(u,t[n].fn,void 0,!0),i){case 1:t[n].fn.call(t[n].context);break;case 2:t[n].fn.call(t[n].context,m);break;case 3:t[n].fn.call(t[n].context,m,S);break;case 4:t[n].fn.call(t[n].context,m,S,E);break;default:if(!h)for(g=1,h=new Array(i-1);g<i;g++)h[g-1]=arguments[g];t[n].fn.apply(t[n].context,h)}}return!0},_.prototype.on=function(u,m,S){return L(this,u,m,S,!1)},_.prototype.once=function(u,m,S){return L(this,u,m,S,!0)},_.prototype.removeListener=function(u,m,S,E){var A=y?y+u:u;if(!this._events[A])return this;if(!m)return R(this,A),this;var d=this._events[A];if(d.fn)d.fn===m&&(!E||d.once)&&(!S||d.context===S)&&R(this,A);else{for(var e=0,t=[],i=d.length;e<i;e++)(d[e].fn!==m||E&&!d[e].once||S&&d[e].context!==S)&&t.push(d[e]);t.length?this._events[A]=t.length===1?t[0]:t:R(this,A)}return this},_.prototype.removeAllListeners=function(u){var m;return u?(m=y?y+u:u,this._events[m]&&R(this,m)):(this._events=new b,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=y,_.EventEmitter=_,O.exports=_},"./node_modules/url-toolkit/src/url-toolkit.js":function(O,w,a){(function(D){var y=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,b=/^([^\/?#]*)([^]*)$/,I=/(?:\/|^)\.(?=\/)/g,L=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(_,u,m){if(m=m||{},_=_.trim(),u=u.trim(),!u){if(!m.alwaysNormalize)return _;var S=R.parseURL(_);if(!S)throw new Error("Error trying to parse base URL.");return S.path=R.normalizePath(S.path),R.buildURLFromParts(S)}var E=R.parseURL(u);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return m.alwaysNormalize?(E.path=R.normalizePath(E.path),R.buildURLFromParts(E)):u;var A=R.parseURL(_);if(!A)throw new Error("Error trying to parse base URL.");if(!A.netLoc&&A.path&&A.path[0]!=="/"){var d=b.exec(A.path);A.netLoc=d[1],A.path=d[2]}A.netLoc&&!A.path&&(A.path="/");var e={scheme:A.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(e.netLoc=A.netLoc,E.path[0]!=="/"))if(!E.path)e.path=A.path,E.params||(e.params=A.params,E.query||(e.query=A.query));else{var t=A.path,i=t.substring(0,t.lastIndexOf("/")+1)+E.path;e.path=R.normalizePath(i)}return e.path===null&&(e.path=m.alwaysNormalize?R.normalizePath(E.path):E.path),R.buildURLFromParts(e)},parseURL:function(_){var u=y.exec(_);return u?{scheme:u[1]||"",netLoc:u[2]||"",path:u[3]||"",params:u[4]||"",query:u[5]||"",fragment:u[6]||""}:null},normalizePath:function(_){for(_=_.split("").reverse().join("").replace(I,"");_.length!==(_=_.replace(L,"")).length;);return _.split("").reverse().join("")},buildURLFromParts:function(_){return _.scheme+_.netLoc+_.path+_.params+_.query+_.fragment}};O.exports=R})(this)},"./node_modules/webworkify-webpack/index.js":function(O,w,a){function D(m){var S={};function E(d){if(S[d])return S[d].exports;var e=S[d]={i:d,l:!1,exports:{}};return m[d].call(e.exports,e,e.exports,E),e.l=!0,e.exports}E.m=m,E.c=S,E.i=function(d){return d},E.d=function(d,e,t){E.o(d,e)||Object.defineProperty(d,e,{configurable:!1,enumerable:!0,get:t})},E.r=function(d){Object.defineProperty(d,"__esModule",{value:!0})},E.n=function(d){var e=d&&d.__esModule?function(){return d.default}:function(){return d};return E.d(e,"a",e),e},E.o=function(d,e){return Object.prototype.hasOwnProperty.call(d,e)},E.p="/",E.oe=function(d){throw console.error(d),d};var A=E(E.s=ENTRY_MODULE);return A.default||A}var y="[\\.|\\-|\\+|\\w|/|@]+",b="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+y+").*?\\)";function I(m){return(m+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function L(m){return!isNaN(1*m)}function R(m,S,E){var A={};A[E]=[];var d=S.toString(),e=d.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!e)return A;for(var t=e[1],i=new RegExp("(\\\\n|\\W)"+I(t)+b,"g"),h;h=i.exec(d);)h[3]!=="dll-reference"&&A[E].push(h[3]);for(i=new RegExp("\\("+I(t)+'\\("(dll-reference\\s('+y+'))"\\)\\)'+b,"g");h=i.exec(d);)m[h[2]]||(A[E].push(h[1]),m[h[2]]=a(h[1]).m),A[h[2]]=A[h[2]]||[],A[h[2]].push(h[4]);for(var n=Object.keys(A),f=0;f<n.length;f++)for(var g=0;g<A[n[f]].length;g++)L(A[n[f]][g])&&(A[n[f]][g]=1*A[n[f]][g]);return A}function _(m){var S=Object.keys(m);return S.reduce(function(E,A){return E||m[A].length>0},!1)}function u(m,S){for(var E={main:[S]},A={main:[]},d={main:{}};_(E);)for(var e=Object.keys(E),t=0;t<e.length;t++){var i=e[t],h=E[i],n=h.pop();if(d[i]=d[i]||{},!(d[i][n]||!m[i][n])){d[i][n]=!0,A[i]=A[i]||[],A[i].push(n);for(var f=R(m,m[i][n],i),g=Object.keys(f),T=0;T<g.length;T++)E[g[T]]=E[g[T]]||[],E[g[T]]=E[g[T]].concat(f[g[T]])}}return A}O.exports=function(m,S){S=S||{};var E={main:a.m},A=S.all?{main:Object.keys(E.main)}:u(E,m),d="";Object.keys(A).filter(function(n){return n!=="main"}).forEach(function(n){for(var f=0;A[n][f];)f++;A[n].push(f),E[n][f]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",d=d+"var "+n+" = ("+D.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+A[n].map(function(g){return""+JSON.stringify(g)+": "+E[n][g].toString()}).join(",")+`});
`}),d=d+"new (("+D.toString().replace("ENTRY_MODULE",JSON.stringify(m))+")({"+A.main.map(function(n){return""+JSON.stringify(n)+": "+E.main[n].toString()}).join(",")+"}))(self);";var e=new window.Blob([d],{type:"text/javascript"});if(S.bare)return e;var t=window.URL||window.webkitURL||window.mozURL||window.msURL,i=t.createObjectURL(e),h=new window.Worker(i);return h.objectURL=i,h}},"./src/config.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"hlsDefaultConfig",function(){return g}),a.d(w,"mergeConfig",function(){return p}),a.d(w,"enableStreamingMode",function(){return o});var D=a("./src/controller/abr-controller.ts"),y=a("./src/controller/audio-stream-controller.ts"),b=a("./src/controller/audio-track-controller.ts"),I=a("./src/controller/subtitle-stream-controller.ts"),L=a("./src/controller/subtitle-track-controller.ts"),R=a("./src/controller/buffer-controller.ts"),_=a("./src/controller/timeline-controller.ts"),u=a("./src/controller/cap-level-controller.ts"),m=a("./src/controller/fps-controller.ts"),S=a("./src/controller/eme-controller.ts"),E=a("./src/utils/xhr-loader.ts"),A=a("./src/utils/fetch-loader.ts"),d=a("./src/utils/cues.ts"),e=a("./src/utils/mediakeys-helper.ts"),t=a("./src/utils/logger.ts");function i(){return i=Object.assign||function(s){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var l in c)Object.prototype.hasOwnProperty.call(c,l)&&(s[l]=c[l])}return s},i.apply(this,arguments)}function h(s,r){var c=Object.keys(s);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(s);r&&(l=l.filter(function(k){return Object.getOwnPropertyDescriptor(s,k).enumerable})),c.push.apply(c,l)}return c}function n(s){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?h(Object(c),!0).forEach(function(l){f(s,l,c[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(c)):h(Object(c)).forEach(function(l){Object.defineProperty(s,l,Object.getOwnPropertyDescriptor(c,l))})}return s}function f(s,r,c){return r in s?Object.defineProperty(s,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):s[r]=c,s}var g=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:E.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:D.default,bufferController:R.default,capLevelController:u.default,fpsController:m.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},T()),{},{subtitleStreamController:I.SubtitleStreamController,subtitleTrackController:L.default,timelineController:_.TimelineController,audioStreamController:y.default,audioTrackController:b.default,emeController:S.default});function T(){return{cueHandler:d.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function p(s,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return i({},s,r)}function o(s){var r=s.loader;if(r!==A.default&&r!==E.default)t.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),s.progressive=!1;else{var c=Object(A.fetchSupported)();c&&(s.loader=A.default,s.progressive=!0,s.enableSoftwareAES=!0,t.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/polyfills/number.ts"),y=a("./src/utils/ewma-bandwidth-estimator.ts"),b=a("./src/events.ts"),I=a("./src/utils/buffer-helper.ts"),L=a("./src/errors.ts"),R=a("./src/types/loader.ts"),_=a("./src/utils/logger.ts");function u(E,A){for(var d=0;d<A.length;d++){var e=A[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(E,e.key,e)}}function m(E,A,d){return A&&u(E.prototype,A),d&&u(E,d),E}var S=function(){function E(d){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=d;var e=d.config;this.bwEstimator=new y.default(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}var A=E.prototype;return A.registerListeners=function(){var d=this.hls;d.on(b.Events.FRAG_LOADING,this.onFragLoading,this),d.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),d.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.on(b.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){var d=this.hls;d.off(b.Events.FRAG_LOADING,this.onFragLoading,this),d.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),d.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),d.off(b.Events.ERROR,this.onError,this)},A.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},A.onFragLoading=function(d,e){var t=e.frag;if(t.type===R.PlaylistLevelType.MAIN&&!this.timer){var i;this.fragCurrent=t,this.partCurrent=(i=e.part)!=null?i:null,this.timer=self.setInterval(this.onCheck,100)}},A.onLevelLoaded=function(d,e){var t=this.hls.config;e.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},A._abandonRulesCheck=function(){var d=this.fragCurrent,e=this.partCurrent,t=this.hls,i=t.autoLevelEnabled,h=t.config,n=t.media;if(!(!d||!n)){var f=e?e.stats:d.stats,g=e?e.duration:d.duration;if(f.aborted){_.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!i||n.paused||!n.playbackRate||!n.readyState)){var T=performance.now()-f.loading.start,p=Math.abs(n.playbackRate);if(!(T<=500*g/p)){var o=t.levels,s=t.minAutoLevel,r=o[d.level],c=f.total||Math.max(f.loaded,Math.round(g*r.maxBitrate/8)),l=Math.max(1,f.bwEstimate?f.bwEstimate/8:f.loaded*1e3/T),k=(c-f.loaded)/l,x=n.currentTime,C=(I.BufferHelper.bufferInfo(n,x,h.maxBufferHole).end-x)/p;if(!(C>=2*g/p||k<=C)){var P=Number.POSITIVE_INFINITY,N;for(N=d.level-1;N>s;N--){var B=o[N].maxBitrate;if(P=g*B/(8*.8*l),P<C)break}if(!(P>=k)){var F=this.bwEstimator.getEstimate();_.logger.warn("Fragment "+d.sn+(e?" part "+e.index:"")+" of level "+d.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+N+`
      Current BW estimate: `+(Object(D.isFiniteNumber)(F)?(F/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+k.toFixed(3)+` s
      Estimated load time for the next fragment: `+P.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),t.nextLoadLevel=N,this.bwEstimator.sample(T,f.loaded),this.clearTimer(),d.loader&&(this.fragCurrent=this.partCurrent=null,d.loader.abort()),t.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:d,part:e,stats:f})}}}}}},A.onFragLoaded=function(d,e){var t=e.frag,i=e.part;if(t.type===R.PlaylistLevelType.MAIN&&Object(D.isFiniteNumber)(t.sn)){var h=i?i.stats:t.stats,n=i?i.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var f=this.hls.levels[t.level],g=(f.loaded?f.loaded.bytes:0)+h.loaded,T=(f.loaded?f.loaded.duration:0)+n;f.loaded={bytes:g,duration:T},f.realBitrate=Math.round(8*g/T)}if(t.bitrateTest){var p={stats:h,frag:t,part:i,id:t.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,p),t.bitrateTest=!1}}},A.onFragBuffered=function(d,e){var t=e.frag,i=e.part,h=i?i.stats:t.stats;if(!h.aborted&&!(t.type!==R.PlaylistLevelType.MAIN||t.sn==="initSegment")){var n=h.parsing.end-h.loading.start;this.bwEstimator.sample(n,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},A.onError=function(d,e){switch(e.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},A.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},A.getNextABRAutoLevel=function(){var d=this.fragCurrent,e=this.partCurrent,t=this.hls,i=t.maxAutoLevel,h=t.config,n=t.minAutoLevel,f=t.media,g=e?e.duration:d?d.duration:0,T=f?f.currentTime:0,p=f&&f.playbackRate!==0?Math.abs(f.playbackRate):1,o=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,s=(I.BufferHelper.bufferInfo(f,T,h.maxBufferHole).end-T)/p,r=this.findBestLevel(o,n,i,s,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(r>=0)return r;_.logger.trace((s?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var c=g?Math.min(g,h.maxStarvationDelay):h.maxStarvationDelay,l=h.abrBandWidthFactor,k=h.abrBandWidthUpFactor;if(!s){var x=this.bitrateTestDelay;if(x){var C=g?Math.min(g,h.maxLoadingDelay):h.maxLoadingDelay;c=C-x,_.logger.trace("bitrate test took "+Math.round(1e3*x)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*c)+" ms"),l=k=1}}return r=this.findBestLevel(o,n,i,s+c,l,k),Math.max(r,0)},A.findBestLevel=function(d,e,t,i,h,n){for(var f,g=this.fragCurrent,T=this.partCurrent,p=this.lastLoadedFragLevel,o=this.hls.levels,s=o[p],r=!!(s!=null&&(f=s.details)!==null&&f!==void 0&&f.live),c=s==null?void 0:s.codecSet,l=T?T.duration:g?g.duration:0,k=t;k>=e;k--){var x=o[k];if(!(!x||c&&x.codecSet!==c)){var C=x.details,P=(T?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||l,N=void 0;k<=p?N=h*d:N=n*d;var B=o[k].maxBitrate,F=B*P/N;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+k+"/"+Math.round(N)+"/"+B+"/"+P+"/"+i+"/"+F),N>B&&(!F||r&&!this.bitrateTestDelay||F<i))return k}}return-1},m(E,[{key:"nextAutoLevel",get:function(){var d=this._nextAutoLevel,e=this.bwEstimator;if(d!==-1&&(!e||!e.canEstimate()))return d;var t=this.getNextABRAutoLevel();return d!==-1&&(t=Math.min(d,t)),t},set:function(d){this._nextAutoLevel=d}}]),E}();w.default=S},"./src/controller/audio-stream-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/polyfills/number.ts"),y=a("./src/controller/base-stream-controller.ts"),b=a("./src/events.ts"),I=a("./src/utils/buffer-helper.ts"),L=a("./src/controller/fragment-tracker.ts"),R=a("./src/types/level.ts"),_=a("./src/types/loader.ts"),u=a("./src/loader/fragment.ts"),m=a("./src/demux/chunk-cache.ts"),S=a("./src/demux/transmuxer-interface.ts"),E=a("./src/types/transmuxer.ts"),A=a("./src/controller/fragment-finders.ts"),d=a("./src/utils/discontinuities.ts"),e=a("./src/errors.ts"),t=a("./src/utils/logger.ts");function i(){return i=Object.assign||function(T){for(var p=1;p<arguments.length;p++){var o=arguments[p];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(T[s]=o[s])}return T},i.apply(this,arguments)}function h(T,p){T.prototype=Object.create(p.prototype),T.prototype.constructor=T,n(T,p)}function n(T,p){return n=Object.setPrototypeOf||function(o,s){return o.__proto__=s,o},n(T,p)}var f=100,g=function(T){h(p,T);function p(s,r){var c;return c=T.call(this,s,r,"[audio-stream-controller]")||this,c.videoBuffer=null,c.videoTrackCC=-1,c.waitingVideoCC=-1,c.audioSwitch=!1,c.trackId=-1,c.waitingData=null,c.mainDetails=null,c.bufferFlushed=!1,c._registerListeners(),c}var o=p.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var s=this.hls;s.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(b.Events.ERROR,this.onError,this),s.on(b.Events.BUFFER_RESET,this.onBufferReset,this),s.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o._unregisterListeners=function(){var s=this.hls;s.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),s.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(b.Events.ERROR,this.onError,this),s.off(b.Events.BUFFER_RESET,this.onBufferReset,this),s.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},o.onInitPtsFound=function(s,r){var c=r.frag,l=r.id,k=r.initPTS;if(l==="main"){var x=c.cc;this.initPTS[c.cc]=k,this.log("InitPTS for cc: "+x+" found from main: "+k),this.videoTrackCC=x,this.state===y.State.WAITING_INIT_PTS&&this.tick()}},o.startLoad=function(s){if(!this.levels){this.startPosition=s,this.state=y.State.STOPPED;return}var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(f),this.fragLoadError=0,r>0&&s===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),this.state=y.State.IDLE):(this.loadedmetadata=!1,this.state=y.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()},o.doTick=function(){switch(this.state){case y.State.IDLE:this.doTickIdle();break;case y.State.WAITING_TRACK:{var s,r=this.levels,c=this.trackId,l=r==null||(s=r[c])===null||s===void 0?void 0:s.details;if(l){if(this.waitForCdnTuneIn(l))break;this.state=y.State.WAITING_INIT_PTS}break}case y.State.FRAG_LOADING_WAITING_RETRY:{var k,x=performance.now(),C=this.retryDate;(!C||x>=C||(k=this.media)!==null&&k!==void 0&&k.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=y.State.IDLE);break}case y.State.WAITING_INIT_PTS:{var P=this.waitingData;if(P){var N=P.frag,B=P.part,F=P.cache,U=P.complete;if(this.initPTS[N.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=y.State.FRAG_LOADING;var H=F.flush(),G={frag:N,part:B,payload:H,networkDetails:null};this._handleFragmentLoadProgress(G),U&&T.prototype._handleFragmentLoadComplete.call(this,G)}else if(this.videoTrackCC!==this.waitingVideoCC)t.logger.log("Waiting fragment cc ("+N.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),V=I.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),q=Object(A.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,N);q<0&&(t.logger.log("Waiting fragment cc ("+N.cc+") @ "+N.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=y.State.IDLE}}this.onTickEnd()},o.clearWaitingFragment=function(){var s=this.waitingData;s&&(this.fragmentTracker.removeFragment(s.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=y.State.IDLE)},o.onTickEnd=function(){var s=this.media;if(!(!s||!s.readyState)){var r=this.mediaBuffer?this.mediaBuffer:s,c=r.buffered;!this.loadedmetadata&&c.length&&(this.loadedmetadata=!0),this.lastCurrentTime=s.currentTime}},o.doTickIdle=function(){var s,r,c=this.hls,l=this.levels,k=this.media,x=this.trackId,C=c.config;if(!(!l||!l[x])&&!(!k&&(this.startFragRequested||!C.startFragPrefetch))){var P=l[x],N=P.details;if(!N||N.live&&this.levelLastLoaded!==x||this.waitForCdnTuneIn(N)){this.state=y.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,u.ElementaryStreamTypes.AUDIO,_.PlaylistLevelType.AUDIO));var B=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,_.PlaylistLevelType.AUDIO);if(B!==null){var F=B.len,U=this.getMaxBufferLength(),H=this.audioSwitch;if(!(F>=U&&!H)){if(!H&&this._streamEnded(B,N)){c.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=y.State.ENDED;return}var G=N.fragments,j=G[0].start,V=B.end;if(H){var q=this.getLoadPosition();V=q,N.PTSKnown&&q<j&&(B.end>j||B.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),k.currentTime=j+.05)}var W=this.getNextFragment(V,N);if(!W){this.bufferFlushed=!0;return}((s=W.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((r=W.decryptdata)!==null&&r!==void 0&&r.key)?this.loadKey(W,N):this.loadFragment(W,N,V)}}}},o.getMaxBufferLength=function(){var s=T.prototype.getMaxBufferLength.call(this),r=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,_.PlaylistLevelType.MAIN);return r===null?s:Math.max(s,r.len)},o.onMediaDetaching=function(){this.videoBuffer=null,T.prototype.onMediaDetaching.call(this)},o.onAudioTracksUpdated=function(s,r){var c=r.audioTracks;this.resetTransmuxer(),this.levels=c.map(function(l){return new R.Level(l)})},o.onAudioTrackSwitching=function(s,r){var c=!!r.url;this.trackId=r.id;var l=this.fragCurrent;l!=null&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),c?this.setInterval(f):this.resetTransmuxer(),c?(this.audioSwitch=!0,this.state=y.State.IDLE):this.state=y.State.STOPPED,this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},o.onLevelLoaded=function(s,r){this.mainDetails=r.details},o.onAudioTrackLoaded=function(s,r){var c,l=this.levels,k=r.details,x=r.id;if(!l){this.warn("Audio tracks were reset while loading level "+x);return}this.log("Track "+x+" loaded ["+k.startSN+","+k.endSN+"],duration:"+k.totalduration);var C=l[x],P=0;if(k.live||(c=C.details)!==null&&c!==void 0&&c.live){var N=this.mainDetails;if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed||!N)return;!C.details&&k.hasProgramDateTime&&N.hasProgramDateTime?(Object(d.alignMediaPlaylistByPDT)(k,N),P=k.fragments[0].start):P=this.alignPlaylists(k,C.details)}C.details=k,this.levelLastLoaded=x,!this.startFragRequested&&(this.mainDetails||!k.live)&&this.setStartPosition(C.details,P),this.state===y.State.WAITING_TRACK&&!this.waitForCdnTuneIn(k)&&(this.state=y.State.IDLE),this.tick()},o._handleFragmentLoadProgress=function(s){var r,c=s.frag,l=s.part,k=s.payload,x=this.config,C=this.trackId,P=this.levels;if(!P){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+c.sn+" of level "+c.level+" will not be buffered");return}var N=P[C];console.assert(N,"Audio track is defined on fragment load progress");var B=N.details;console.assert(B,"Audio track details are defined on fragment load progress");var F=x.defaultAudioCodec||N.audioCodec||"mp4a.40.2",U=this.transmuxer;U||(U=this.transmuxer=new S.default(this.hls,_.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var H=this.initPTS[c.cc],G=(r=c.initSegment)===null||r===void 0?void 0:r.data;if(H!==void 0){var j=!1,V=l?l.index:-1,q=V!==-1,W=new E.ChunkMetadata(c.level,c.sn,c.stats.chunkCount,k.byteLength,V,q);U.push(k,G,F,"",c,l,B.totalduration,j,W,H)}else{t.logger.log("Unknown video PTS for cc "+c.cc+", waiting for video PTS before demuxing audio frag "+c.sn+" of ["+B.startSN+" ,"+B.endSN+"],track "+C);var Y=this.waitingData=this.waitingData||{frag:c,part:l,cache:new m.default,complete:!1},$=Y.cache;$.push(new Uint8Array(k)),this.waitingVideoCC=this.videoTrackCC,this.state=y.State.WAITING_INIT_PTS}},o._handleFragmentLoadComplete=function(s){if(this.waitingData){this.waitingData.complete=!0;return}T.prototype._handleFragmentLoadComplete.call(this,s)},o.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},o.onBufferCreated=function(s,r){var c=r.tracks.audio;c&&(this.mediaBuffer=c.buffer),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer)},o.onFragBuffered=function(s,r){var c=r.frag,l=r.part;if(c.type===_.PlaylistLevelType.AUDIO){if(this.fragContextChanged(c)){this.warn("Fragment "+c.sn+(l?" p: "+l.index:"")+" of level "+c.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}c.sn!=="initSegment"&&(this.fragPrevious=c,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(c,l)}},o.onError=function(s,r){switch(r.details){case e.ErrorDetails.FRAG_LOAD_ERROR:case e.ErrorDetails.FRAG_LOAD_TIMEOUT:case e.ErrorDetails.KEY_LOAD_ERROR:case e.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.AUDIO,r);break;case e.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case e.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==y.State.ERROR&&this.state!==y.State.STOPPED&&(this.state=r.fatal?y.State.ERROR:y.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case e.ErrorDetails.BUFFER_FULL_ERROR:if(r.parent==="audio"&&(this.state===y.State.PARSING||this.state===y.State.PARSED)){var c=!0,l=this.getFwdBufferInfo(this.mediaBuffer,_.PlaylistLevelType.AUDIO);l&&l.len>.5&&(c=!this.reduceMaxBufferLength(l.len)),c&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,T.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},o.onBufferFlushed=function(s,r){var c=r.type;c===u.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},o._handleTransmuxComplete=function(s){var r,c="audio",l=this.hls,k=s.remuxResult,x=s.chunkMeta,C=this.getCurrentContext(x);if(!C){this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(x.level);return}var P=C.frag,N=C.part,B=k.audio,F=k.text,U=k.id3,H=k.initSegment;if(!this.fragContextChanged(P)){if(this.state=y.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),H!=null&&H.tracks&&(this._bufferInitSegment(H.tracks,P,x),l.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:P,id:c,tracks:H.tracks})),B){var G=B.startPTS,j=B.endPTS,V=B.startDTS,q=B.endDTS;N&&(N.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:G,endPTS:j,startDTS:V,endDTS:q}),P.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,G,j,V,q),this.bufferFragmentData(B,P,N,x)}if(U!=null&&(r=U.samples)!==null&&r!==void 0&&r.length){var W=i({frag:P,id:c},U);l.trigger(b.Events.FRAG_PARSING_METADATA,W)}if(F){var Y=i({frag:P,id:c},F);l.trigger(b.Events.FRAG_PARSING_USERDATA,Y)}}},o._bufferInitSegment=function(s,r,c){if(this.state===y.State.PARSING){s.video&&delete s.video;var l=s.audio;if(l){l.levelCodec=l.codec,l.id="audio",this.log("Init audio buffer, container:"+l.container+", codecs[parsed]=["+l.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,s);var k=l.initSegment;if(k!=null&&k.byteLength){var x={type:"audio",frag:r,part:null,chunkMeta:c,parent:r.type,data:k};this.hls.trigger(b.Events.BUFFER_APPENDING,x)}this.tick()}}},o.loadFragment=function(s,r,c){var l=this.fragmentTracker.getState(s);this.fragCurrent=s,(this.audioSwitch||l===L.FragmentState.NOT_LOADED||l===L.FragmentState.PARTIAL)&&(s.sn==="initSegment"?this._loadInitSegment(s):r.live&&!Object(D.isFiniteNumber)(this.initPTS[s.cc])?(this.log("Waiting for video PTS in continuity counter "+s.cc+" of live stream before loading audio fragment "+s.sn+" of level "+this.trackId),this.state=y.State.WAITING_INIT_PTS):(this.startFragRequested=!0,T.prototype.loadFragment.call(this,s,r,c)))},o.completeAudioSwitch=function(){var s=this.hls,r=this.media,c=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),T.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,s.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:c})},p}(y.default);w.default=g},"./src/controller/audio-track-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/events.ts"),y=a("./src/errors.ts"),b=a("./src/controller/base-playlist-controller.ts"),I=a("./src/types/loader.ts");function L(S,E){for(var A=0;A<E.length;A++){var d=E[A];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(S,d.key,d)}}function R(S,E,A){return E&&L(S.prototype,E),A&&L(S,A),S}function _(S,E){S.prototype=Object.create(E.prototype),S.prototype.constructor=S,u(S,E)}function u(S,E){return u=Object.setPrototypeOf||function(A,d){return A.__proto__=d,A},u(S,E)}var m=function(S){_(E,S);function E(d){var e;return e=S.call(this,d,"[audio-track-controller]")||this,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.trackName="",e.selectDefaultTrack=!0,e.registerListeners(),e}var A=E.prototype;return A.registerListeners=function(){var d=this.hls;d.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),d.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.on(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.on(D.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){var d=this.hls;d.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),d.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),d.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),d.off(D.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),d.off(D.Events.ERROR,this.onError,this)},A.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,S.prototype.destroy.call(this)},A.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},A.onManifestParsed=function(d,e){this.tracks=e.audioTracks||[]},A.onAudioTrackLoaded=function(d,e){var t=e.id,i=e.details,h=this.tracksInGroup[t];if(!h){this.warn("Invalid audio track id "+t);return}var n=h.details;h.details=e.details,this.log("audioTrack "+t+" loaded ["+i.startSN+"-"+i.endSN+"]"),t===this.trackId&&(this.retryCount=0,this.playlistLoaded(t,e,n))},A.onLevelLoading=function(d,e){this.switchLevel(e.level)},A.onLevelSwitching=function(d,e){this.switchLevel(e.level)},A.switchLevel=function(d){var e=this.hls.levels[d];if(e!=null&&e.audioGroupIds){var t=e.audioGroupIds[e.urlId];if(this.groupId!==t){this.groupId=t;var i=this.tracks.filter(function(n){return!t||n.groupId===t});this.selectDefaultTrack&&!i.some(function(n){return n.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var h={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+t+'" group-id'),this.hls.trigger(D.Events.AUDIO_TRACKS_UPDATED,h),this.selectInitialTrack()}}},A.onError=function(d,e){S.prototype.onError.call(this,d,e),!(e.fatal||!e.context)&&e.context.type===I.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},A.setAudioTrack=function(d){var e=this.tracksInGroup;if(d<0||d>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var t=e[this.trackId];this.log("Now switching to audio-track index "+d);var i=e[d],h=i.id,n=i.groupId,f=n===void 0?"":n,g=i.name,T=i.type,p=i.url;if(this.trackId=d,this.trackName=g,this.selectDefaultTrack=!1,this.hls.trigger(D.Events.AUDIO_TRACK_SWITCHING,{id:h,groupId:f,name:g,type:T,url:p}),!(i.details&&!i.details.live)){var o=this.switchParams(i.url,t==null?void 0:t.details);this.loadPlaylist(o)}},A.selectInitialTrack=function(){var d=this.tracksInGroup;console.assert(d.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,t=this.findTrackId(e)||this.findTrackId();t!==-1?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},A.findTrackId=function(d){for(var e=this.tracksInGroup,t=0;t<e.length;t++){var i=e[t];if((!this.selectDefaultTrack||i.default)&&(!d||d===i.name))return i.id}return-1},A.loadPlaylist=function(d){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var t=e.id,i=e.groupId,h=e.url;if(d)try{h=d.addDirectives(h)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("loading audio-track playlist for id: "+t),this.clearTimer(),this.hls.trigger(D.Events.AUDIO_TRACK_LOADING,{url:h,id:t,groupId:i,deliveryDirectives:d||null})}},R(E,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(d){this.selectDefaultTrack=!1,this.setAudioTrack(d)}}]),E}(b.default);w.default=m},"./src/controller/base-playlist-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return R});var D=a("./src/polyfills/number.ts"),y=a("./src/types/level.ts"),b=a("./src/controller/level-helper.ts"),I=a("./src/utils/logger.ts"),L=a("./src/errors.ts"),R=function(){function _(m,S){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=I.logger.log.bind(I.logger,S+":"),this.warn=I.logger.warn.bind(I.logger,S+":"),this.hls=m}var u=_.prototype;return u.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},u.onError=function(m,S){S.fatal&&S.type===L.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},u.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},u.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},u.stopLoad=function(){this.canLoad=!1,this.clearTimer()},u.switchParams=function(m,S){var E=S==null?void 0:S.renditionReports;if(E)for(var A=0;A<E.length;A++){var d=E[A],e=""+d.URI;if(e===m.substr(-e.length)){var t=parseInt(d["LAST-MSN"]),i=parseInt(d["LAST-PART"]);if(S&&this.hls.config.lowLatencyMode){var h=Math.min(S.age-S.partTarget,S.targetduration);i!==void 0&&h>S.partTarget&&(i+=1)}if(Object(D.isFiniteNumber)(t))return new y.HlsUrlParameters(t,Object(D.isFiniteNumber)(i)?i:void 0,y.HlsSkip.No)}}},u.loadPlaylist=function(m){},u.shouldLoadTrack=function(m){return this.canLoad&&m&&!!m.url&&(!m.details||m.details.live)},u.playlistLoaded=function(m,S,E){var A=this,d=S.details,e=S.stats,t=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(d.advancedDateTime=Date.now()-t,d.live||E!=null&&E.live){if(d.reloaded(E),E&&this.log("live playlist "+m+" "+(d.advanced?"REFRESHED "+d.lastPartSn+"-"+d.lastPartIndex:"MISSED")),E&&d.fragments.length>0&&Object(b.mergeDetails)(E,d),!this.canLoad||!d.live)return;var i,h=void 0,n=void 0;if(d.canBlockReload&&d.endSN&&d.advanced){var f=this.hls.config.lowLatencyMode,g=d.lastPartSn,T=d.endSN,p=d.lastPartIndex,o=p!==-1,s=g===T,r=f?0:p;o?(h=s?T+1:g,n=s?r:p+1):h=T+1;var c=d.age,l=c+d.ageHeader,k=Math.min(l-d.partTarget,d.targetduration*1.5);if(k>0){if(E&&k>E.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+E.tuneInGoal+" to: "+k+" with playlist age: "+d.age),k=0;else{var x=Math.floor(k/d.targetduration);if(h+=x,n!==void 0){var C=Math.round(k%d.targetduration/d.partTarget);n+=C}this.log("CDN Tune-in age: "+d.ageHeader+"s last advanced "+c.toFixed(2)+"s goal: "+k+" skip sn "+x+" to part "+n)}d.tuneInGoal=k}if(i=this.getDeliveryDirectives(d,S.deliveryDirectives,h,n),f||!s){this.loadPlaylist(i);return}}else i=this.getDeliveryDirectives(d,S.deliveryDirectives,h,n);var P=Object(b.computeReloadInterval)(d,e);h!==void 0&&d.canBlockReload&&(P-=d.partTarget||1),this.log("reload live playlist "+m+" in "+Math.round(P)+" ms"),this.timer=self.setTimeout(function(){return A.loadPlaylist(i)},P)}else this.clearTimer()},u.getDeliveryDirectives=function(m,S,E,A){var d=Object(y.getSkipValue)(m,E);return S!=null&&S.skip&&m.deltaUpdateFailed&&(E=S.msn,A=S.part,d=y.HlsSkip.No),new y.HlsUrlParameters(E,A,d)},u.retryLoadingOrFail=function(m){var S=this,E=this.hls.config,A=this.retryCount<E.levelLoadingMaxRetry;if(A){var d;if(this.retryCount++,m.details.indexOf("LoadTimeOut")>-1&&(d=m.context)!==null&&d!==void 0&&d.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+m.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*E.levelLoadingRetryDelay,E.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return S.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+m.details+'"')}}else this.warn('cannot recover from error "'+m.details+'"'),this.clearTimer(),m.fatal=!0;return A},_}()},"./src/controller/base-stream-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"State",function(){return p}),a.d(w,"default",function(){return o});var D=a("./src/polyfills/number.ts"),y=a("./src/task-loop.ts"),b=a("./src/controller/fragment-tracker.ts"),I=a("./src/utils/buffer-helper.ts"),L=a("./src/utils/logger.ts"),R=a("./src/events.ts"),_=a("./src/errors.ts"),u=a("./src/types/transmuxer.ts"),m=a("./src/utils/mp4-tools.ts"),S=a("./src/utils/discontinuities.ts"),E=a("./src/controller/fragment-finders.ts"),A=a("./src/controller/level-helper.ts"),d=a("./src/loader/fragment-loader.ts"),e=a("./src/crypt/decrypter.ts"),t=a("./src/utils/time-ranges.ts"),i=a("./src/types/loader.ts");function h(s,r){for(var c=0;c<r.length;c++){var l=r[c];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(s,l.key,l)}}function n(s,r,c){return r&&h(s.prototype,r),c&&h(s,c),s}function f(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function g(s,r){s.prototype=Object.create(r.prototype),s.prototype.constructor=s,T(s,r)}function T(s,r){return T=Object.setPrototypeOf||function(c,l){return c.__proto__=l,c},T(s,r)}var p={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},o=function(s){g(r,s);function r(l,k,x){var C;return C=s.call(this)||this,C.hls=void 0,C.fragPrevious=null,C.fragCurrent=null,C.fragmentTracker=void 0,C.transmuxer=null,C._state=p.STOPPED,C.media=void 0,C.mediaBuffer=void 0,C.config=void 0,C.bitrateTest=!1,C.lastCurrentTime=0,C.nextLoadPosition=0,C.startPosition=0,C.loadedmetadata=!1,C.fragLoadError=0,C.retryDate=0,C.levels=null,C.fragmentLoader=void 0,C.levelLastLoaded=null,C.startFragRequested=!1,C.decrypter=void 0,C.initPTS=[],C.onvseeking=null,C.onvended=null,C.logPrefix="",C.log=void 0,C.warn=void 0,C.logPrefix=x,C.log=L.logger.log.bind(L.logger,x+":"),C.warn=L.logger.warn.bind(L.logger,x+":"),C.hls=l,C.fragmentLoader=new d.default(l.config),C.fragmentTracker=k,C.config=l.config,C.decrypter=new e.default(l,l.config),l.on(R.Events.KEY_LOADED,C.onKeyLoaded,f(C)),C}var c=r.prototype;return c.doTick=function(){this.onTickEnd()},c.onTickEnd=function(){},c.startLoad=function(l){},c.stopLoad=function(){this.fragmentLoader.abort();var l=this.fragCurrent;l&&this.fragmentTracker.removeFragment(l),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=p.STOPPED},c._streamEnded=function(l,k){var x=this.fragCurrent,C=this.fragmentTracker;if(!k.live&&x&&x.sn===k.endSN&&!l.nextStart){var P=C.getState(x);return P===b.FragmentState.PARTIAL||P===b.FragmentState.OK}return!1},c.onMediaAttached=function(l,k){var x=this.media=this.mediaBuffer=k.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),x.addEventListener("seeking",this.onvseeking),x.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===p.STOPPED&&this.startLoad(C.startPosition)},c.onMediaDetaching=function(){var l=this.media;l!=null&&l.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),l&&(l.removeEventListener("seeking",this.onvseeking),l.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},c.onMediaSeeking=function(){var l=this.config,k=this.fragCurrent,x=this.media,C=this.mediaBuffer,P=this.state,N=x?x.currentTime:0,B=I.BufferHelper.bufferInfo(C||x,N,l.maxBufferHole);if(this.log("media seeking to "+(Object(D.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+P),P===p.ENDED)this.resetLoadingState();else if(k&&!B.len){var F=l.maxFragLookUpTolerance,U=k.start-F,H=k.start+k.duration+F,G=N>H;(N<U||G)&&(G&&k.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),k.loader.abort()),this.resetLoadingState())}x&&(this.lastCurrentTime=N),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},c.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},c.onKeyLoaded=function(l,k){if(!(this.state!==p.KEY_LOADING||k.frag!==this.fragCurrent||!this.levels)){this.state=p.IDLE;var x=this.levels[k.frag.level].details;x&&this.loadFragment(k.frag,x,k.frag.start)}},c.onHandlerDestroying=function(){this.stopLoad(),s.prototype.onHandlerDestroying.call(this)},c.onHandlerDestroyed=function(){this.state=p.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,s.prototype.onHandlerDestroyed.call(this)},c.loadKey=function(l,k){this.log("Loading key for "+l.sn+" of ["+k.startSN+"-"+k.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+l.level),this.state=p.KEY_LOADING,this.fragCurrent=l,this.hls.trigger(R.Events.KEY_LOADING,{frag:l})},c.loadFragment=function(l,k,x){this._loadFragForPlayback(l,k,x)},c._loadFragForPlayback=function(l,k,x){var C=this,P=function(N){if(C.fragContextChanged(l)){C.warn("Fragment "+l.sn+(N.part?" p: "+N.part.index:"")+" of level "+l.level+" was dropped during download."),C.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,C._handleFragmentLoadProgress(N)};this._doFragLoad(l,k,x,P).then(function(N){if(N){C.fragLoadError=0;var B=C.state;if(C.fragContextChanged(l)){(B===p.FRAG_LOADING||B===p.BACKTRACKING||!C.fragCurrent&&B===p.PARSING)&&(C.fragmentTracker.removeFragment(l),C.state=p.IDLE);return}if("payload"in N&&(C.log("Loaded fragment "+l.sn+" of level "+l.level),C.hls.trigger(R.Events.FRAG_LOADED,N),C.state===p.BACKTRACKING)){C.fragmentTracker.backtrack(l,N),C.resetFragmentLoading(l);return}C._handleFragmentLoadComplete(N)}}).catch(function(N){C.warn(N),C.resetFragmentLoading(l)})},c.flushMainBuffer=function(l,k,x){if(x===void 0&&(x=null),!!(l-k)){var C={startOffset:l,endOffset:k,type:x};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,C)}},c._loadInitSegment=function(l){var k=this;this._doFragLoad(l).then(function(x){if(!x||k.fragContextChanged(l)||!k.levels)throw new Error("init load aborted");return x}).then(function(x){var C=k.hls,P=x.payload,N=l.decryptdata;if(P&&P.byteLength>0&&N&&N.key&&N.iv&&N.method==="AES-128"){var B=self.performance.now();return k.decrypter.webCryptoDecrypt(new Uint8Array(P),N.key.buffer,N.iv.buffer).then(function(F){var U=self.performance.now();return C.trigger(R.Events.FRAG_DECRYPTED,{frag:l,payload:F,stats:{tstart:B,tdecrypt:U}}),x.payload=F,x})}return x}).then(function(x){var C=k.fragCurrent,P=k.hls,N=k.levels;if(!N)throw new Error("init load aborted, missing levels");var B=N[l.level].details;console.assert(B,"Level details are defined when init segment is loaded");var F=l.stats;k.state=p.IDLE,k.fragLoadError=0,l.data=new Uint8Array(x.payload),F.parsing.start=F.buffering.start=self.performance.now(),F.parsing.end=F.buffering.end=self.performance.now(),x.frag===C&&P.trigger(R.Events.FRAG_BUFFERED,{stats:F,frag:C,part:null,id:l.type}),k.tick()}).catch(function(x){k.warn(x),k.resetFragmentLoading(l)})},c.fragContextChanged=function(l){var k=this.fragCurrent;return!l||!k||l.level!==k.level||l.sn!==k.sn||l.urlId!==k.urlId},c.fragBufferedComplete=function(l,k){var x=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+l.type+" sn: "+l.sn+(k?" part: "+k.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+l.level+" "+t.default.toString(I.BufferHelper.getBuffered(x))),this.state=p.IDLE,this.tick()},c._handleFragmentLoadComplete=function(l){var k=this.transmuxer;if(k){var x=l.frag,C=l.part,P=l.partsLoaded,N=!P||P.length===0||P.some(function(F){return!F}),B=new u.ChunkMetadata(x.level,x.sn,x.stats.chunkCount+1,0,C?C.index:-1,!N);k.flush(B)}},c._handleFragmentLoadProgress=function(l){},c._doFragLoad=function(l,k,x,C){var P=this;if(x===void 0&&(x=null),!this.levels)throw new Error("frag load aborted, missing levels");if(x=Math.max(l.start,x||0),this.config.lowLatencyMode&&k){var N=k.partList;if(N&&C){x>l.end&&k.fragmentHint&&(l=k.fragmentHint);var B=this.getNextPart(N,l,x);if(B>-1){var F=N[B];return this.log("Loading part sn: "+l.sn+" p: "+F.index+" cc: "+l.cc+" of playlist ["+k.startSN+"-"+k.endSN+"] parts [0-"+B+"-"+(N.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+l.level+", target: "+parseFloat(x.toFixed(3))),this.nextLoadPosition=F.start+F.duration,this.state=p.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:l,part:N[B],targetBufferTime:x}),this.doFragPartsLoad(l,N,B,C).catch(function(U){return P.handleFragLoadError(U)})}else if(!l.url||this.loadedEndOfParts(N,x))return Promise.resolve(null)}}return this.log("Loading fragment "+l.sn+" cc: "+l.cc+" "+(k?"of ["+k.startSN+"-"+k.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+l.level+", target: "+parseFloat(x.toFixed(3))),Object(D.isFiniteNumber)(l.sn)&&!this.bitrateTest&&(this.nextLoadPosition=l.start+l.duration),this.state=p.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:l,targetBufferTime:x}),this.fragmentLoader.load(l,C).catch(function(U){return P.handleFragLoadError(U)})},c.doFragPartsLoad=function(l,k,x,C){var P=this;return new Promise(function(N,B){var F=[],U=function H(G){var j=k[G];P.fragmentLoader.loadPart(l,j,C).then(function(V){F[j.index]=V;var q=V.part;P.hls.trigger(R.Events.FRAG_LOADED,V);var W=k[G+1];if(W&&W.fragment===l)H(G+1);else return N({frag:l,part:q,partsLoaded:F})}).catch(B)};U(x)})},c.handleFragLoadError=function(l){var k=l.data;return k&&k.details===_.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(k.frag,k.part):this.hls.trigger(R.Events.ERROR,k),null},c._handleTransmuxerFlush=function(l){var k=this.getCurrentContext(l);if(!k||this.state!==p.PARSING){this.fragCurrent||(this.state=p.IDLE);return}var x=k.frag,C=k.part,P=k.level,N=self.performance.now();x.stats.parsing.end=N,C&&(C.stats.parsing.end=N),this.updateLevelTiming(x,C,P,l.partial)},c.getCurrentContext=function(l){var k=this.levels,x=l.level,C=l.sn,P=l.part;if(!k||!k[x])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+x+". The current chunk will not be buffered."),null;var N=k[x],B=P>-1?Object(A.getPartWith)(N,C,P):null,F=B?B.fragment:Object(A.getFragmentWithSN)(N,C,this.fragCurrent);return F?{frag:F,part:B,level:N}:null},c.bufferFragmentData=function(l,k,x,C){if(!(!l||this.state!==p.PARSING)){var P=l.data1,N=l.data2,B=P;if(P&&N&&(B=Object(m.appendUint8Array)(P,N)),!(!B||!B.length)){var F={type:l.type,frag:k,part:x,chunkMeta:C,parent:k.type,data:B};this.hls.trigger(R.Events.BUFFER_APPENDING,F),l.dropped&&l.independent&&!x&&this.flushBufferGap(k)}}},c.flushBufferGap=function(l){var k=this.media;if(k){if(!I.BufferHelper.isBuffered(k,k.currentTime)){this.flushMainBuffer(0,l.start);return}var x=k.currentTime,C=I.BufferHelper.bufferInfo(k,x,0),P=l.duration,N=Math.min(this.config.maxFragLookUpTolerance*2,P*.25),B=Math.max(Math.min(l.start-N,C.end-N),x+N);l.start-B>N&&this.flushMainBuffer(B,l.start)}},c.getFwdBufferInfo=function(l,k){var x=this.config,C=this.getLoadPosition();if(!Object(D.isFiniteNumber)(C))return null;var P=I.BufferHelper.bufferInfo(l,C,x.maxBufferHole);if(P.len===0&&P.nextStart!==void 0){var N=this.fragmentTracker.getBufferedFrag(C,k);if(N&&P.nextStart<N.end)return I.BufferHelper.bufferInfo(l,C,Math.max(P.nextStart,x.maxBufferHole))}return P},c.getMaxBufferLength=function(l){var k=this.config,x;return l?x=Math.max(8*k.maxBufferSize/l,k.maxBufferLength):x=k.maxBufferLength,Math.min(x,k.maxMaxBufferLength)},c.reduceMaxBufferLength=function(l){var k=this.config,x=l||k.maxBufferLength;return k.maxMaxBufferLength>=x?(k.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+k.maxMaxBufferLength+"s"),!0):!1},c.getNextFragment=function(l,k){var x,C,P=k.fragments,N=P.length;if(!N)return null;var B=this.config,F=P[0].start,U;if(k.live){var H=B.initialLiveManifestSize;if(N<H)return this.warn("Not enough fragments to start playback (have: "+N+", need: "+H+")"),null;!k.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(U=this.getInitialLiveFragment(k,P),this.startPosition=U?this.hls.liveSyncPosition||U.start:l)}else l<=F&&(U=P[0]);if(!U){var G=B.lowLatencyMode?k.partEnd:k.fragmentEnd;U=this.getFragmentAtPosition(l,G,k)}return(x=U)!==null&&x!==void 0&&x.initSegment&&!((C=U)!==null&&C!==void 0&&C.initSegment.data)&&!this.bitrateTest&&(U=U.initSegment),U},c.getNextPart=function(l,k,x){for(var C=-1,P=!1,N=!0,B=0,F=l.length;B<F;B++){var U=l[B];if(N=N&&!U.independent,C>-1&&x<U.start)break;var H=U.loaded;!H&&(P||U.independent||N)&&U.fragment===k&&(C=B),P=H}return C},c.loadedEndOfParts=function(l,k){var x=l[l.length-1];return x&&k>x.start&&x.loaded},c.getInitialLiveFragment=function(l,k){var x=this.fragPrevious,C=null;if(x){if(l.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+x.programDateTime),C=Object(E.findFragmentByPDT)(k,x.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var P=x.sn+1;if(P>=l.startSN&&P<=l.endSN){var N=k[P-l.startSN];x.cc===N.cc&&(C=N,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(E.findFragWithCC)(k,x.cc),C&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(C=this.getFragmentAtPosition(B,this.bitrateTest?l.fragmentEnd:l.edge,l))}return C},c.getFragmentAtPosition=function(l,k,x){var C=this.config,P=this.fragPrevious,N=x.fragments,B=x.endSN,F=x.fragmentHint,U=C.maxFragLookUpTolerance,H=!!(C.lowLatencyMode&&x.partList&&F);H&&F&&!this.bitrateTest&&(N=N.concat(F),B=F.sn);var G;if(l<k){var j=l>k-U?0:U;G=Object(E.findFragmentByPTS)(P,N,l,j)}else G=N[N.length-1];if(G){var V=G.sn-x.startSN,q=P&&G.level===P.level,W=N[V+1],Y=this.fragmentTracker.getState(G);if(Y===b.FragmentState.BACKTRACKED){G=null;for(var $=V;N[$]&&this.fragmentTracker.getState(N[$])===b.FragmentState.BACKTRACKED;)P?G=N[$--]:G=N[--$];G||(G=W)}else P&&G.sn===P.sn&&!H&&q&&(G.sn<B&&this.fragmentTracker.getState(W)!==b.FragmentState.OK?(this.log("SN "+G.sn+" just loaded, load next one: "+W.sn),G=W):G=null)}return G},c.synchronizeToLiveEdge=function(l){var k=this.config,x=this.media;if(x){var C=this.hls.liveSyncPosition,P=x.currentTime,N=l.fragments[0].start,B=l.edge,F=P>=N-k.maxFragLookUpTolerance&&P<=B;if(C!==null&&x.duration>C&&(P<C||!F)){var U=k.liveMaxLatencyDuration!==void 0?k.liveMaxLatencyDuration:k.liveMaxLatencyDurationCount*l.targetduration;(!F&&x.readyState<4||P<B-U)&&(this.loadedmetadata||(this.nextLoadPosition=C),x.readyState&&(this.warn("Playback: "+P.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+C.toFixed(3)),x.currentTime=C))}}},c.alignPlaylists=function(l,k){var x=this.levels,C=this.levelLastLoaded,P=this.fragPrevious,N=C!==null?x[C]:null,B=l.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var F=l.fragments[0].start,U=!k,H=l.alignedSliding&&Object(D.isFiniteNumber)(F);if(U||!H&&!F){Object(S.alignStream)(P,N,l);var G=l.fragments[0].start;return this.log("Live playlist sliding: "+G.toFixed(2)+" start-sn: "+(k?k.startSN:"na")+"->"+l.startSN+" prev-sn: "+(P?P.sn:"na")+" fragments: "+B),G}return F},c.waitForCdnTuneIn=function(l){var k=3;return l.live&&l.canBlockReload&&l.tuneInGoal>Math.max(l.partHoldBack,l.partTarget*k)},c.setStartPosition=function(l,k){var x=this.startPosition;if(x<k&&(x=-1),x===-1||this.lastCurrentTime===-1){var C=l.startTimeOffset;Object(D.isFiniteNumber)(C)?(x=k+C,C<0&&(x+=l.totalduration),x=Math.min(Math.max(k,x),k+l.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+x),this.startPosition=x):l.live?x=this.hls.liveSyncPosition||k:this.startPosition=x=0,this.lastCurrentTime=x}this.nextLoadPosition=x},c.getLoadPosition=function(){var l=this.media,k=0;return this.loadedmetadata&&l?k=l.currentTime:this.nextLoadPosition&&(k=this.nextLoadPosition),k},c.handleFragLoadAborted=function(l,k){this.transmuxer&&l.sn!=="initSegment"&&l.stats.aborted&&(this.warn("Fragment "+l.sn+(k?" part"+k.index:"")+" of level "+l.level+" was aborted"),this.resetFragmentLoading(l))},c.resetFragmentLoading=function(l){(!this.fragCurrent||!this.fragContextChanged(l))&&(this.state=p.IDLE)},c.onFragmentOrKeyLoadError=function(l,k){if(!k.fatal){var x=k.frag;if(!(!x||x.type!==l)){var C=this.fragCurrent;console.assert(C&&x.sn===C.sn&&x.level===C.level&&x.urlId===C.urlId,"Frag load error must match current frag to retry");var P=this.config;if(this.fragLoadError+1<=P.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(x.level))return;var N=Math.min(Math.pow(2,this.fragLoadError)*P.fragLoadingRetryDelay,P.fragLoadingMaxRetryTimeout);this.warn("Fragment "+x.sn+" of "+l+" "+x.level+" failed to load, retrying in "+N+"ms"),this.retryDate=self.performance.now()+N,this.fragLoadError++,this.state=p.FRAG_LOADING_WAITING_RETRY}else k.levelRetry?(l===i.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=p.IDLE):(L.logger.error(k.details+" reaches max retry, redispatch as fatal ..."),k.fatal=!0,this.hls.stopLoad(),this.state=p.ERROR)}}},c.afterBufferFlushed=function(l,k,x){if(l){var C=I.BufferHelper.getBuffered(l);this.fragmentTracker.detectEvictedFragments(k,C,x),this.state===p.ENDED&&this.resetLoadingState()}},c.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=p.IDLE},c.resetLiveStartWhenNotLoaded=function(l){if(!this.loadedmetadata){this.startFragRequested=!1;var k=this.levels?this.levels[l].details:null;if(k!=null&&k.live)return this.startPosition=-1,this.setStartPosition(k,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},c.updateLevelTiming=function(l,k,x,C){var P=this,N=x.details;console.assert(!!N,"level.details must be defined");var B=Object.keys(l.elementaryStreams).reduce(function(F,U){var H=l.elementaryStreams[U];if(H){var G=H.endPTS-H.startPTS;if(G<=0)return P.warn("Could not parse fragment "+l.sn+" "+U+" duration reliably ("+G+") resetting transmuxer to fallback to playlist timing"),P.resetTransmuxer(),F||!1;var j=C?0:Object(A.updateFragPTSDTS)(N,l,H.startPTS,H.endPTS,H.startDTS,H.endDTS);return P.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:N,level:x,drift:j,type:U,frag:l,start:H.startPTS,end:H.endPTS}),!0}return F},!1);B?(this.state=p.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:l,part:k})):this.resetLoadingState()},c.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},n(r,[{key:"state",get:function(){return this._state},set:function(l){var k=this._state;k!==l&&(this._state=l,this.log(k+"->"+l))}}]),r}(y.default)},"./src/controller/buffer-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return E});var D=a("./src/polyfills/number.ts"),y=a("./src/events.ts"),b=a("./src/utils/logger.ts"),I=a("./src/errors.ts"),L=a("./src/utils/buffer-helper.ts"),R=a("./src/utils/mediasource-helper.ts"),_=a("./src/loader/fragment.ts"),u=a("./src/controller/buffer-operation-queue.ts"),m=Object(R.getMediaSource)(),S=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function A(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=t.hls,h=t.media,n=t.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),h&&(t.updateMediaElementDuration(),i.trigger(y.Events.MEDIA_ATTACHED,{media:h})),n&&n.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var d=A.prototype;return d.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},d.destroy=function(){this.unregisterListeners(),this.details=null},d.registerListeners=function(){var e=this.hls;e.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.Events.BUFFER_RESET,this.onBufferReset,this),e.on(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.Events.BUFFER_EOS,this.onBufferEos,this),e.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.Events.FRAG_PARSED,this.onFragParsed,this),e.on(y.Events.FRAG_CHANGED,this.onFragChanged,this)},d.unregisterListeners=function(){var e=this.hls;e.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.Events.BUFFER_RESET,this.onBufferReset,this),e.off(y.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.Events.BUFFER_EOS,this.onBufferEos,this),e.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.Events.FRAG_PARSED,this.onFragParsed,this),e.off(y.Events.FRAG_CHANGED,this.onFragChanged,this)},d._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new u.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},d.onManifestParsed=function(e,t){var i=2;(t.audio&&!t.video||!t.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},d.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&m){var h=this.mediaSource=new m;h.addEventListener("sourceopen",this._onMediaSourceOpen),h.addEventListener("sourceended",this._onMediaSourceEnded),h.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(h),this._objectUrl=i.src}},d.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(b.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(h){b.logger.warn("[buffer-controller]: onMediaDetaching: "+h.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(y.Events.MEDIA_DETACHED,void 0)},d.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(h){b.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",h)}}),this._initSourceBuffer()},d.onBufferCodecs=function(e,t){var i=this,h=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(n){if(h){var f=i.tracks[n];if(f&&typeof f.buffer.changeType=="function"){var g=t[n],T=g.codec,p=g.levelCodec,o=g.container,s=(f.levelCodec||f.codec).replace(S,"$1"),r=(p||T).replace(S,"$1");if(s!==r){var c=o+";codecs="+(p||T);i.appendChangeType(n,c)}}}else i.pendingTracks[n]=t[n]}),!h&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},d.appendChangeType=function(e,t){var i=this,h=this.operationQueue,n={execute:function(){var f=i.sourceBuffer[e];f&&(b.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),f.changeType(t)),h.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(f){b.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",f)}};h.append(n,e)},d.onBufferAppending=function(e,t){var i=this,h=this.hls,n=this.operationQueue,f=this.tracks,g=t.data,T=t.type,p=t.frag,o=t.part,s=t.chunkMeta,r=s.buffering[T],c=self.performance.now();r.start=c;var l=p.stats.buffering,k=o?o.stats.buffering:null;l.start===0&&(l.start=c),k&&k.start===0&&(k.start=c);var x=f.audio,C=T==="audio"&&s.id===1&&(x==null?void 0:x.container)==="audio/mpeg",P={execute:function(){if(r.executeStart=self.performance.now(),C){var N=i.sourceBuffer[T];if(N){var B=p.start-N.timestampOffset;Math.abs(B)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+p.start+" (delta: "+B+") sn: "+p.sn+")"),N.timestampOffset=p.start)}}i.appendExecutor(g,T)},onStart:function(){},onComplete:function(){var N=self.performance.now();r.executeEnd=r.end=N,l.first===0&&(l.first=N),k&&k.first===0&&(k.first=N);var B=i.sourceBuffer,F={};for(var U in B)F[U]=L.BufferHelper.getBuffered(B[U]);i.appendError=0,i.hls.trigger(y.Events.BUFFER_APPENDED,{type:T,frag:p,part:o,chunkMeta:s,parent:p.type,timeRanges:F})},onError:function(N){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+T+" SourceBuffer",N);var B={type:I.ErrorTypes.MEDIA_ERROR,parent:p.type,details:I.ErrorDetails.BUFFER_APPEND_ERROR,err:N,fatal:!1};N.code===DOMException.QUOTA_EXCEEDED_ERR?B.details=I.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,B.details=I.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>h.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+h.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),B.fatal=!0)),h.trigger(y.Events.ERROR,B)}};n.append(P,T)},d.onBufferFlushing=function(e,t){var i=this,h=this.operationQueue,n=function(f){return{execute:i.removeExecutor.bind(i,f,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(y.Events.BUFFER_FLUSHED,{type:f})},onError:function(g){b.logger.warn("[buffer-controller]: Failed to remove from "+f+" SourceBuffer",g)}}};t.type?h.append(n(t.type),t.type):this.getSourceBufferTypes().forEach(function(f){h.append(n(f),f)})},d.onFragParsed=function(e,t){var i=this,h=t.frag,n=t.part,f=[],g=n?n.elementaryStreams:h.elementaryStreams;g[_.ElementaryStreamTypes.AUDIOVIDEO]?f.push("audiovideo"):(g[_.ElementaryStreamTypes.AUDIO]&&f.push("audio"),g[_.ElementaryStreamTypes.VIDEO]&&f.push("video"));var T=function(){var p=self.performance.now();h.stats.buffering.end=p,n&&(n.stats.buffering.end=p);var o=n?n.stats:h.stats;i.hls.trigger(y.Events.FRAG_BUFFERED,{frag:h,part:n,stats:o,id:h.type})};f.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+h.type+" level: "+h.level+" sn: "+h.sn),this.blockBuffers(T,f)},d.onFragChanged=function(e,t){this.flushBackBuffer()},d.onBufferEos=function(e,t){var i=this,h=this.getSourceBufferTypes().reduce(function(n,f){var g=i.sourceBuffer[f];return(!t.type||t.type===f)&&g&&!g.ended&&(g.ended=!0,b.logger.log("[buffer-controller]: "+f+" sourceBuffer now EOS")),n&&!!(!g||g.ended)},!0);h&&this.blockBuffers(function(){var n=i.mediaSource;!n||n.readyState!=="open"||n.endOfStream()})},d.onLevelUpdated=function(e,t){var i=t.details;!i.fragments.length||(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},d.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,h=this.sourceBuffer;if(!(!i||t===null)){var n=this.getSourceBufferTypes();if(n.length){var f=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(D.isFiniteNumber)(f)||f<0)){var g=i.currentTime,T=t.levelTargetDuration,p=Math.max(f,T),o=Math.floor(g/T)*T-p;n.forEach(function(s){var r=h[s];if(r){var c=L.BufferHelper.getBuffered(r);c.length>0&&o>c.start(0)&&(e.trigger(y.Events.BACK_BUFFER_REACHED,{bufferEnd:o}),t.live&&e.trigger(y.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o}),e.trigger(y.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:s}))}})}}}},d.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,t=this.hls,i=this.media,h=this.mediaSource,n=e.fragments[0].start+e.totalduration,f=i.duration,g=Object(D.isFiniteNumber)(h.duration)?h.duration:0;e.live&&t.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),h.duration=1/0,this.updateSeekableRange(e)):(n>g&&n>f||!Object(D.isFiniteNumber)(f))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),h.duration=n)}},d.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments,h=i.length;if(h&&e.live&&t!==null&&t!==void 0&&t.setLiveSeekableRange){var n=Math.max(0,i[0].start),f=Math.max(n,n+e.totalduration);t.setLiveSeekableRange(n,f)}},d.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,h=Object.keys(i).length;if(h&&!e||h===2){this.createSourceBuffers(i),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length===0){this.hls.trigger(y.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}n.forEach(function(f){t.executeNext(f)})}},d.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var h=0;for(var n in e)if(!t[n]){var f=e[n];if(!f)throw Error("source buffer exists for track "+n+", however track does not");var g=f.levelCodec||f.codec,T=f.container+";codecs="+g;b.logger.log("[buffer-controller]: creating sourceBuffer("+T+")");try{var p=t[n]=i.addSourceBuffer(T),o=n;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[n]={buffer:p,codec:g,container:f.container,levelCodec:f.levelCodec,id:f.id},h++}catch(s){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+s.message),this.hls.trigger(y.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:s,mimeType:T})}}h&&this.hls.trigger(y.Events.BUFFER_CREATED,{tracks:this.tracks})},d._onSBUpdateStart=function(e){var t=this.operationQueue,i=t.current(e);i.onStart()},d._onSBUpdateEnd=function(e){var t=this.operationQueue,i=t.current(e);i.onComplete(),t.shiftAndExecuteNext(e)},d._onSBUpdateError=function(e,t){b.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(y.Events.ERROR,{type:I.ErrorTypes.MEDIA_ERROR,details:I.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(e);i&&i.onError(t)},d.removeExecutor=function(e,t,i){var h=this.media,n=this.mediaSource,f=this.operationQueue,g=this.sourceBuffer,T=g[e];if(!h||!n||!T){b.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),f.shiftAndExecuteNext(e);return}var p=Object(D.isFiniteNumber)(h.duration)?h.duration:1/0,o=Object(D.isFiniteNumber)(n.duration)?n.duration:1/0,s=Math.max(0,t),r=Math.min(i,p,o);r>s?(b.logger.log("[buffer-controller]: Removing ["+s+","+r+"] from the "+e+" SourceBuffer"),console.assert(!T.updating,e+" sourceBuffer must not be updating"),T.remove(s,r)):f.shiftAndExecuteNext(e)},d.appendExecutor=function(e,t){var i=this.operationQueue,h=this.sourceBuffer,n=h[t];if(!n){b.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(t);return}n.ended=!1,console.assert(!n.updating,t+" sourceBuffer must not be updating"),n.appendBuffer(e)},d.blockBuffers=function(e,t){var i=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(e);return}var h=this.operationQueue,n=t.map(function(f){return h.appendBlocker(f)});Promise.all(n).then(function(){e(),t.forEach(function(f){var g=i.sourceBuffer[f];(!g||!g.updating)&&h.shiftAndExecuteNext(f)})})},d.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},d.addBufferListener=function(e,t,i){var h=this.sourceBuffer[e];if(h){var n=i.bind(this,e);this.listeners[e].push({event:t,listener:n}),h.addEventListener(t,n)}},d.removeBufferListeners=function(e){var t=this.sourceBuffer[e];!t||this.listeners[e].forEach(function(i){t.removeEventListener(i.event,i.listener)})},A}()},"./src/controller/buffer-operation-queue.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return y});var D=a("./src/utils/logger.ts"),y=function(){function b(L){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=L}var I=b.prototype;return I.append=function(L,R){var _=this.queues[R];_.push(L),_.length===1&&this.buffers[R]&&this.executeNext(R)},I.insertAbort=function(L,R){var _=this.queues[R];_.unshift(L),this.executeNext(R)},I.appendBlocker=function(L){var R,_=new Promise(function(m){R=m}),u={execute:R,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(u,L),_},I.executeNext=function(L){var R=this.buffers,_=this.queues,u=R[L],m=_[L];if(m.length){var S=m[0];try{S.execute()}catch(E){D.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),S.onError(E),(!u||!u.updating)&&(m.shift(),this.executeNext(L))}}},I.shiftAndExecuteNext=function(L){this.queues[L].shift(),this.executeNext(L)},I.current=function(L){return this.queues[L][0]},b}()},"./src/controller/cap-level-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/events.ts");function y(L,R){for(var _=0;_<R.length;_++){var u=R[_];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(L,u.key,u)}}function b(L,R,_){return R&&y(L.prototype,R),_&&y(L,_),L}var I=function(){function L(_){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=_,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=L.prototype;return R.setStreamController=function(_){this.streamController=_},R.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function(){var _=this.hls;_.on(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),_.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.on(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),_.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function(){var _=this.hls;_.off(D.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),_.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.off(D.Events.BUFFER_CODECS,this.onBufferCodecs,this),_.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function(_,u){L.isLevelAllowed(u.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(u.droppedLevel)},R.onMediaAttaching=function(_,u){this.media=u.media instanceof HTMLVideoElement?u.media:null},R.onManifestParsed=function(_,u){var m=this.hls;this.restrictedLevels=[],this.firstLevel=u.firstLevel,m.config.capLevelToPlayerSize&&u.video&&this.startCapping()},R.onBufferCodecs=function(_,u){var m=this.hls;m.config.capLevelToPlayerSize&&u.video&&this.startCapping()},R.onMediaDetaching=function(){this.stopCapping()},R.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var _=this.hls.levels;if(_.length){var u=this.hls;u.autoLevelCapping=this.getMaxLevel(_.length-1),u.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=u.autoLevelCapping}}},R.getMaxLevel=function(_){var u=this,m=this.hls.levels;if(!m.length)return-1;var S=m.filter(function(E,A){return L.isLevelAllowed(A,u.restrictedLevels)&&A<=_});return this.clientRect=null,L.getMaxLevelByMediaSize(S,this.mediaWidth,this.mediaHeight)},R.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function(){if(this.clientRect)return this.clientRect;var _=this.media,u={width:0,height:0};if(_){var m=_.getBoundingClientRect();u.width=m.width,u.height=m.height,!u.width&&!u.height&&(u.width=m.right-m.left||_.width||0,u.height=m.bottom-m.top||_.height||0)}return this.clientRect=u,u},L.isLevelAllowed=function(_,u){return u===void 0&&(u=[]),u.indexOf(_)===-1},L.getMaxLevelByMediaSize=function(_,u,m){if(!_||!_.length)return-1;for(var S=function(e,t){return t?e.width!==t.width||e.height!==t.height:!0},E=_.length-1,A=0;A<_.length;A+=1){var d=_[A];if((d.width>=u||d.height>=m)&&S(d,_[A+1])){E=A;break}}return E},b(L,[{key:"mediaWidth",get:function(){return this.getDimensions().width*L.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*L.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var _=1;try{_=self.devicePixelRatio}catch{}return _}}]),L}();w.default=I},"./src/controller/eme-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/events.ts"),y=a("./src/errors.ts"),b=a("./src/utils/logger.ts"),I=a("./src/utils/mediakeys-helper.ts");function L(E,A){for(var d=0;d<A.length;d++){var e=A[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(E,e.key,e)}}function R(E,A,d){return A&&L(E.prototype,A),d&&L(E,d),E}var _=3,u=function(E,A,d){var e={audioCapabilities:[],videoCapabilities:[]};return E.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:d.audioRobustness||""})}),A.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:d.videoRobustness||""})}),[e]},m=function(E,A,d,e){switch(E){case I.KeySystems.WIDEVINE:return u(A,d,e);default:throw new Error("Unknown key-system: "+E)}},S=function(){function E(d){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=d,this._config=d.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var A=E.prototype;return A.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},A._registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},A._unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(D.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this)},A.getLicenseServerUrl=function(d){switch(d){case I.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+d+'"')},A._attemptKeySystemAccess=function(d,e,t){var i=this,h=m(d,e,t,this._drmSystemOptions);b.logger.log("Requesting encrypted media key-system access");var n=this.requestMediaKeySystemAccess(d,h);this.mediaKeysPromise=n.then(function(f){return i._onMediaKeySystemAccessObtained(d,f)}),n.catch(function(f){b.logger.error('Failed to obtain key-system "'+d+'" access:',f)})},A._onMediaKeySystemAccessObtained=function(d,e){var t=this;b.logger.log('Access for key-system "'+d+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:d};this._mediaKeysList.push(i);var h=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(n){return i.mediaKeys=n,b.logger.log('Media-keys created for key-system "'+d+'"'),t._onMediaKeysCreated(),n});return h.catch(function(n){b.logger.error("Failed to create media-keys:",n)}),h},A._onMediaKeysCreated=function(){var d=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),d._onNewMediaKeySession(e.mediaKeysSession))})},A._onNewMediaKeySession=function(d){var e=this;b.logger.log("New key-system session "+d.sessionId),d.addEventListener("message",function(t){e._onKeySessionMessage(d,t.message)},!1)},A._onKeySessionMessage=function(d,e){b.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(t){b.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),d.update(t)})},A.onMediaEncrypted=function(d){var e=this;if(b.logger.log('Media is encrypted using "'+d.initDataType+'" init data type'),!this.mediaKeysPromise){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var t=function(i){!e._media||(e._attemptSetMediaKeys(i),e._generateRequestWithPreferredKeySession(d.initDataType,d.initData))};this.mediaKeysPromise.then(t).catch(t)},A._attemptSetMediaKeys=function(d){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}b.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},A._generateRequestWithPreferredKeySession=function(d,e){var t=this,i=this._mediaKeysList[0];if(!i){b.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(i.mediaKeysSessionInitialized){b.logger.warn("Key-Session already initialized but requested again");return}var h=i.mediaKeysSession;if(!h){b.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){b.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}b.logger.log('Generating key-session request for "'+d+'" init data type'),i.mediaKeysSessionInitialized=!0,h.generateRequest(d,e).then(function(){b.logger.debug("Key-session generation succeeded")}).catch(function(n){b.logger.error("Error generating key-session request:",n),t.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},A._createLicenseXhr=function(d,e,t){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,d,e,t);var h=this._licenseXhrSetup;if(h)try{h.call(this.hls,i,d),h=void 0}catch(n){b.logger.error(n)}try{i.readyState||i.open("POST",d,!0),h&&h.call(this.hls,i,d)}catch(n){throw new Error("issue setting up KeySystem license XHR "+n)}return i},A._onLicenseRequestReadyStageChange=function(d,e,t,i){switch(d.readyState){case 4:if(d.status===200){this._requestLicenseFailureCount=0,b.logger.log("License request succeeded");var h=d.response,n=this._licenseResponseCallback;if(n)try{h=n.call(this.hls,d,e)}catch(g){b.logger.error(g)}i(h)}else{if(b.logger.error("License Request XHR failed ("+e+"). Status: "+d.status+" ("+d.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>_){this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var f=_-this._requestLicenseFailureCount+1;b.logger.warn("Retrying license request, "+f+" attempts left"),this._requestLicense(t,i)}break}},A._generateLicenseRequestChallenge=function(d,e){switch(d.mediaKeySystemDomain){case I.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+d.mediaKeySystemDomain)},A._requestLicense=function(d,e){b.logger.log("Requesting content license for key-system");var t=this._mediaKeysList[0];if(!t){b.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var i=this.getLicenseServerUrl(t.mediaKeySystemDomain),h=this._createLicenseXhr(i,d,e);b.logger.log("Sending license request to URL: "+i);var n=this._generateLicenseRequestChallenge(t,d);h.send(n)}catch(f){b.logger.error("Failure requesting DRM license: "+f),this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.KEY_SYSTEM_ERROR,details:y.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},A.onMediaAttached=function(d,e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},A.onMediaDetached=function(){var d=this._media,e=this._mediaKeysList;!d||(d.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch(function(){})})).then(function(){return d.setMediaKeys(null)}).catch(function(){}))},A.onManifestParsed=function(d,e){if(this._emeEnabled){var t=e.levels.map(function(h){return h.audioCodec}).filter(function(h){return!!h}),i=e.levels.map(function(h){return h.videoCodec}).filter(function(h){return!!h});this._attemptKeySystemAccess(I.KeySystems.WIDEVINE,t,i)}},R(E,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),E}();w.default=S},"./src/controller/fps-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/events.ts"),y=a("./src/utils/logger.ts"),b=function(){function I(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var L=I.prototype;return L.setStreamController=function(R){this.streamController=R},L.registerListeners=function(){this.hls.on(D.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},L.unregisterListeners=function(){this.hls.off(D.Events.MEDIA_ATTACHING,this.onMediaAttaching)},L.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},L.onMediaAttaching=function(R,_){var u=this.hls.config;if(u.capLevelOnFPSDrop){var m=_.media instanceof self.HTMLVideoElement?_.media:null;this.media=m,m&&typeof m.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),u.fpsDroppedMonitoringPeriod)}},L.checkFPS=function(R,_,u){var m=performance.now();if(_){if(this.lastTime){var S=m-this.lastTime,E=u-this.lastDroppedFrames,A=_-this.lastDecodedFrames,d=1e3*E/S,e=this.hls;if(e.trigger(D.Events.FPS_DROP,{currentDropped:E,currentDecoded:A,totalDroppedFrames:u}),d>0&&E>e.config.fpsDroppedMonitoringThreshold*A){var t=e.currentLevel;y.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=t)&&(t=t-1,e.trigger(D.Events.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:e.currentLevel}),e.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=m,this.lastDroppedFrames=u,this.lastDecodedFrames=_}},L.checkFPSInterval=function(){var R=this.media;if(R)if(this.isVideoPlaybackQualityAvailable){var _=R.getVideoPlaybackQuality();this.checkFPS(R,_.totalVideoFrames,_.droppedVideoFrames)}else this.checkFPS(R,R.webkitDecodedFrameCount,R.webkitDroppedFrameCount)},I}();w.default=b},"./src/controller/fragment-finders.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"findFragmentByPDT",function(){return b}),a.d(w,"findFragmentByPTS",function(){return I}),a.d(w,"fragmentWithinToleranceTest",function(){return L}),a.d(w,"pdtWithinToleranceTest",function(){return R}),a.d(w,"findFragWithCC",function(){return _});var D=a("./src/polyfills/number.ts"),y=a("./src/utils/binary-search.ts");function b(u,m,S){if(m===null||!Array.isArray(u)||!u.length||!Object(D.isFiniteNumber)(m))return null;var E=u[0].programDateTime;if(m<(E||0))return null;var A=u[u.length-1].endProgramDateTime;if(m>=(A||0))return null;S=S||0;for(var d=0;d<u.length;++d){var e=u[d];if(R(m,S,e))return e}return null}function I(u,m,S,E){S===void 0&&(S=0),E===void 0&&(E=0);var A=null;if(u?A=m[u.sn-m[0].sn+1]||null:S===0&&m[0].start===0&&(A=m[0]),A&&L(S,E,A)===0)return A;var d=y.default.search(m,L.bind(null,S,E));return d||A}function L(u,m,S){u===void 0&&(u=0),m===void 0&&(m=0);var E=Math.min(m,S.duration+(S.deltaPTS?S.deltaPTS:0));return S.start+S.duration-E<=u?1:S.start-E>u&&S.start?-1:0}function R(u,m,S){var E=Math.min(m,S.duration+(S.deltaPTS?S.deltaPTS:0))*1e3,A=S.endProgramDateTime||0;return A-E>u}function _(u,m){return y.default.search(u,function(S){return S.cc<m?1:S.cc>m?-1:0})}},"./src/controller/fragment-tracker.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"FragmentState",function(){return b}),a.d(w,"FragmentTracker",function(){return I});var D=a("./src/events.ts"),y=a("./src/types/loader.ts"),b;(function(_){_.NOT_LOADED="NOT_LOADED",_.BACKTRACKED="BACKTRACKED",_.APPENDING="APPENDING",_.PARTIAL="PARTIAL",_.OK="OK"})(b||(b={}));var I=function(){function _(m){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=m,this._registerListeners()}var u=_.prototype;return u._registerListeners=function(){var m=this.hls;m.on(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),m.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),m.on(D.Events.FRAG_LOADED,this.onFragLoaded,this)},u._unregisterListeners=function(){var m=this.hls;m.off(D.Events.BUFFER_APPENDED,this.onBufferAppended,this),m.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this),m.off(D.Events.FRAG_LOADED,this.onFragLoaded,this)},u.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},u.getAppendedFrag=function(m,S){if(S===y.PlaylistLevelType.MAIN){var E=this.activeFragment,A=this.activeParts;if(!E)return null;if(A)for(var d=A.length;d--;){var e=A[d],t=e?e.end:E.appendedPTS;if(e.start<=m&&t!==void 0&&m<=t)return d>9&&(this.activeParts=A.slice(d-9)),e}else if(E.start<=m&&E.appendedPTS!==void 0&&m<=E.appendedPTS)return E}return this.getBufferedFrag(m,S)},u.getBufferedFrag=function(m,S){for(var E=this.fragments,A=Object.keys(E),d=A.length;d--;){var e=E[A[d]];if((e==null?void 0:e.body.type)===S&&e.buffered){var t=e.body;if(t.start<=m&&m<=t.end)return t}}return null},u.detectEvictedFragments=function(m,S,E){var A=this;Object.keys(this.fragments).forEach(function(d){var e=A.fragments[d];if(e){if(!e.buffered){e.body.type===E&&A.removeFragment(e.body);return}var t=e.range[m];!t||t.time.some(function(i){var h=!A.isTimeBuffered(i.startPTS,i.endPTS,S);return h&&A.removeFragment(e.body),h})}})},u.detectPartialFragments=function(m){var S=this,E=this.timeRanges,A=m.frag,d=m.part;if(!(!E||A.sn==="initSegment")){var e=R(A),t=this.fragments[e];!t||(Object.keys(E).forEach(function(i){var h=A.elementaryStreams[i];if(h){var n=E[i],f=d!==null||h.partial===!0;t.range[i]=S.getBufferedTimes(A,d,f,n)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},u.fragBuffered=function(m){var S=R(m),E=this.fragments[S];E&&(E.backtrack=E.loaded=null,E.buffered=!0)},u.getBufferedTimes=function(m,S,E,A){for(var d={time:[],partial:E},e=S?S.start:m.start,t=S?S.end:m.end,i=m.minEndPTS||t,h=m.maxStartPTS||e,n=0;n<A.length;n++){var f=A.start(n)-this.bufferPadding,g=A.end(n)+this.bufferPadding;if(h>=f&&i<=g){d.time.push({startPTS:Math.max(e,A.start(n)),endPTS:Math.min(t,A.end(n))});break}else if(e<g&&t>f)d.partial=!0,d.time.push({startPTS:Math.max(e,A.start(n)),endPTS:Math.min(t,A.end(n))});else if(t<=f)break}return d},u.getPartialFragment=function(m){var S=null,E,A,d,e=0,t=this.bufferPadding,i=this.fragments;return Object.keys(i).forEach(function(h){var n=i[h];!n||L(n)&&(A=n.body.start-t,d=n.body.end+t,m>=A&&m<=d&&(E=Math.min(m-A,d-m),e<=E&&(S=n.body,e=E)))}),S},u.getState=function(m){var S=R(m),E=this.fragments[S];return E?E.buffered?L(E)?b.PARTIAL:b.OK:E.backtrack?b.BACKTRACKED:b.APPENDING:b.NOT_LOADED},u.backtrack=function(m,S){var E=R(m),A=this.fragments[E];if(!A||A.backtrack)return null;var d=A.backtrack=S||A.loaded;return A.loaded=null,d},u.getBacktrackData=function(m){var S=R(m),E=this.fragments[S];if(E){var A,d=E.backtrack;if(d!=null&&(A=d.payload)!==null&&A!==void 0&&A.byteLength)return d;this.removeFragment(m)}return null},u.isTimeBuffered=function(m,S,E){for(var A,d,e=0;e<E.length;e++){if(A=E.start(e)-this.bufferPadding,d=E.end(e)+this.bufferPadding,m>=A&&S<=d)return!0;if(S<=A)return!1}return!1},u.onFragLoaded=function(m,S){var E=S.frag,A=S.part;if(!(E.sn==="initSegment"||E.bitrateTest||A)){var d=R(E);this.fragments[d]={body:E,loaded:S,backtrack:null,buffered:!1,range:Object.create(null)}}},u.onBufferAppended=function(m,S){var E=this,A=S.frag,d=S.part,e=S.timeRanges;if(A.type===y.PlaylistLevelType.MAIN)if(this.activeFragment=A,d){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(d)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(i){var h=e[i];if(E.detectEvictedFragments(i,h),!d)for(var n=0;n<h.length;n++)A.appendedPTS=Math.max(h.end(n),A.appendedPTS||0)})},u.onFragBuffered=function(m,S){this.detectPartialFragments(S)},u.hasFragment=function(m){var S=R(m);return!!this.fragments[S]},u.removeFragmentsInRange=function(m,S,E){var A=this;Object.keys(this.fragments).forEach(function(d){var e=A.fragments[d];if(!!e&&e.buffered){var t=e.body;t.type===E&&t.start<S&&t.end>m&&A.removeFragment(t)}})},u.removeFragment=function(m){var S=R(m);m.stats.loaded=0,m.clearElementaryStreamInfo(),delete this.fragments[S]},u.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},_}();function L(_){var u,m;return _.buffered&&(((u=_.range.video)===null||u===void 0?void 0:u.partial)||((m=_.range.audio)===null||m===void 0?void 0:m.partial))}function R(_){return _.type+"_"+_.level+"_"+_.urlId+"_"+_.sn}},"./src/controller/gap-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"STALL_MINIMUM_DURATION_MS",function(){return L}),a.d(w,"MAX_START_GAP_JUMP",function(){return R}),a.d(w,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return _}),a.d(w,"SKIP_BUFFER_RANGE_START",function(){return u}),a.d(w,"default",function(){return m});var D=a("./src/utils/buffer-helper.ts"),y=a("./src/errors.ts"),b=a("./src/events.ts"),I=a("./src/utils/logger.ts"),L=250,R=2,_=.1,u=.05,m=function(){function S(A,d,e,t){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=A,this.media=d,this.fragmentTracker=e,this.hls=t}var E=S.prototype;return E.destroy=function(){this.hls=this.fragmentTracker=this.media=null},E.poll=function(A){var d=this.config,e=this.media,t=this.stalled,i=e.currentTime,h=e.seeking,n=this.seeking&&!h,f=!this.seeking&&h;if(this.seeking=h,i!==A){if(this.moved=!0,t!==null){if(this.stallReported){var g=self.performance.now()-t;I.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(g)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((f||n)&&(this.stalled=null),!(e.paused||e.ended||e.playbackRate===0||!D.BufferHelper.getBuffered(e).length)){var T=D.BufferHelper.bufferInfo(e,i,0),p=T.len>0,o=T.nextStart||0;if(!(!p&&!o)){if(h){var s=T.len>R,r=!o||o-i>R&&!this.fragmentTracker.getPartialFragment(i);if(s||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var c,l=Math.max(o,T.start||0)-i,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,x=k==null||(c=k.details)===null||c===void 0?void 0:c.live,C=x?k.details.targetduration*2:R;if(l>0&&l<=C){this._trySkipBufferHole(null);return}}var P=self.performance.now();if(t===null){this.stalled=P;return}var N=P-t;!h&&N>=L&&this._reportStall(T.len);var B=D.BufferHelper.bufferInfo(e,i,d.maxBufferHole);this._tryFixBufferStall(B,N)}}},E._tryFixBufferStall=function(A,d){var e=this.config,t=this.fragmentTracker,i=this.media,h=i.currentTime,n=t.getPartialFragment(h);if(n){var f=this._trySkipBufferHole(n);if(f)return}A.len>e.maxBufferHole&&d>e.highBufferWatchdogPeriod*1e3&&(I.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},E._reportStall=function(A){var d=this.hls,e=this.media,t=this.stallReported;t||(this.stallReported=!0,I.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+A+")"),d.trigger(b.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:A}))},E._trySkipBufferHole=function(A){for(var d=this.config,e=this.hls,t=this.media,i=t.currentTime,h=0,n=D.BufferHelper.getBuffered(t),f=0;f<n.length;f++){var g=n.start(f);if(i+d.maxBufferHole>=h&&i<g){var T=Math.max(g+u,t.currentTime+_);return I.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+T),this.moved=!0,this.stalled=null,t.currentTime=T,A&&e.trigger(b.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+T,frag:A}),T}h=n.end(f)}return 0},E._tryNudgeBuffer=function(){var A=this.config,d=this.hls,e=this.media,t=e.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<A.nudgeMaxRetry){var h=t+i*A.nudgeOffset;I.logger.warn("Nudging 'currentTime' from "+t+" to "+h),e.currentTime=h,d.trigger(b.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else I.logger.error("Playhead still not moving while enough data buffered @"+t+" after "+A.nudgeMaxRetry+" nudges"),d.trigger(b.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},S}()},"./src/controller/id3-track-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/events.ts"),y=a("./src/utils/texttrack-utils.ts"),b=a("./src/demux/id3.ts"),I=.25,L=function(){function R(u){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=u,this._registerListeners()}var _=R.prototype;return _.destroy=function(){this._unregisterListeners()},_._registerListeners=function(){var u=this.hls;u.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),u.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_._unregisterListeners=function(){var u=this.hls;u.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(D.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),u.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_.onMediaAttached=function(u,m){this.media=m.media},_.onMediaDetaching=function(){!this.id3Track||(Object(y.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},_.getID3Track=function(u){if(this.media){for(var m=0;m<u.length;m++){var S=u[m];if(S.kind==="metadata"&&S.label==="id3")return Object(y.sendAddTrackEvent)(S,this.media),S}return this.media.addTextTrack("metadata","id3")}},_.onFragParsingMetadata=function(u,m){if(this.media){var S=m.frag,E=m.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var A=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,d=0;d<E.length;d++){var e=b.getID3Frames(E[d].data);if(e){var t=E[d].pts,i=d<E.length-1?E[d+1].pts:S.end,h=i-t;h<=0&&(i=t+I);for(var n=0;n<e.length;n++){var f=e[n];if(!b.isTimeStampFrame(f)){var g=new A(t,i,"");g.value=f,this.id3Track.addCue(g)}}}}}},_.onBufferFlushing=function(u,m){var S=m.startOffset,E=m.endOffset,A=m.type;if(!A||A==="audio"){var d=this.id3Track;d&&Object(y.removeCuesInRange)(d,S,E)}},R}();w.default=L},"./src/controller/latency-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return R});var D=a("./src/errors.ts"),y=a("./src/events.ts"),b=a("./src/utils/logger.ts");function I(_,u){for(var m=0;m<u.length;m++){var S=u[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(_,S.key,S)}}function L(_,u,m){return u&&I(_.prototype,u),m&&I(_,m),_}var R=function(){function _(m){var S=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return S.timeupdate()},this.hls=m,this.config=m.config,this.registerListeners()}var u=_.prototype;return u.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},u.registerListeners=function(){this.hls.on(y.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(y.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){this.hls.off(y.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(y.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(y.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(y.Events.ERROR,this.onError)},u.onMediaAttached=function(m,S){this.media=S.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},u.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},u.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},u.onLevelUpdated=function(m,S){var E=S.details;this.levelDetails=E,E.advanced&&this.timeupdate(),!E.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},u.onError=function(m,S){S.details===D.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},u.timeupdate=function(){var m=this.media,S=this.levelDetails;if(!(!m||!S)){this.currentTime=m.currentTime;var E=this.computeLatency();if(E!==null){this._latency=E;var A=this.config,d=A.lowLatencyMode,e=A.maxLiveSyncPlaybackRate;if(!(!d||e===1)){var t=this.targetLatency;if(t!==null){var i=E-t,h=Math.min(this.maxLatency,t+S.targetduration),n=i<h;if(S.live&&n&&i>.05&&this.forwardBufferLength>1){var f=Math.min(2,Math.max(1,e)),g=Math.round(2/(1+Math.exp(-.75*i-this.edgeStalled))*20)/20;m.playbackRate=Math.min(f,Math.max(1,g))}else m.playbackRate!==1&&m.playbackRate!==0&&(m.playbackRate=1)}}}}},u.estimateLiveEdge=function(){var m=this.levelDetails;return m===null?null:m.edge+m.age},u.computeLatency=function(){var m=this.estimateLiveEdge();return m===null?null:m-this.currentTime},L(_,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var m=this.config,S=this.levelDetails;return m.liveMaxLatencyDuration!==void 0?m.liveMaxLatencyDuration:S?m.liveMaxLatencyDurationCount*S.targetduration:0}},{key:"targetLatency",get:function(){var m=this.levelDetails;if(m===null)return null;var S=m.holdBack,E=m.partHoldBack,A=m.targetduration,d=this.config,e=d.liveSyncDuration,t=d.liveSyncDurationCount,i=d.lowLatencyMode,h=this.hls.userConfig,n=i&&E||S;(h.liveSyncDuration||h.liveSyncDurationCount||n===0)&&(n=e!==void 0?e:t*A);var f=A,g=1;return n+Math.min(this.stallCount*g,f)}},{key:"liveSyncPosition",get:function(){var m=this.estimateLiveEdge(),S=this.targetLatency,E=this.levelDetails;if(m===null||S===null||E===null)return null;var A=E.edge,d=m-S-this.edgeStalled,e=A-E.totalduration,t=A-(this.config.lowLatencyMode&&E.partTarget||E.targetduration);return Math.min(Math.max(e,d),t)}},{key:"drift",get:function(){var m=this.levelDetails;return m===null?1:m.drift}},{key:"edgeStalled",get:function(){var m=this.levelDetails;if(m===null)return 0;var S=(this.config.lowLatencyMode&&m.partTarget||m.targetduration)*3;return Math.max(m.age-S,0)}},{key:"forwardBufferLength",get:function(){var m=this.media,S=this.levelDetails;if(!m||!S)return 0;var E=m.buffered.length;return E?m.buffered.end(E-1):S.edge-this.currentTime}}]),_}()},"./src/controller/level-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return e});var D=a("./src/types/level.ts"),y=a("./src/events.ts"),b=a("./src/errors.ts"),I=a("./src/utils/codecs.ts"),L=a("./src/controller/level-helper.ts"),R=a("./src/controller/base-playlist-controller.ts"),_=a("./src/types/loader.ts");function u(){return u=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var h=arguments[i];for(var n in h)Object.prototype.hasOwnProperty.call(h,n)&&(t[n]=h[n])}return t},u.apply(this,arguments)}function m(t,i){for(var h=0;h<i.length;h++){var n=i[h];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,i,h){return i&&m(t.prototype,i),h&&m(t,h),t}function E(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,A(t,i)}function A(t,i){return A=Object.setPrototypeOf||function(h,n){return h.__proto__=n,h},A(t,i)}var d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),e=function(t){E(i,t);function i(n){var f;return f=t.call(this,n,"[level-controller]")||this,f._levels=[],f._firstLevel=-1,f._startLevel=void 0,f.currentLevelIndex=-1,f.manualLevelIndex=-1,f.onParsedComplete=void 0,f._registerListeners(),f}var h=i.prototype;return h._registerListeners=function(){var n=this.hls;n.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(y.Events.ERROR,this.onError,this)},h._unregisterListeners=function(){var n=this.hls;n.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(y.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(y.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(y.Events.ERROR,this.onError,this)},h.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},h.startLoad=function(){var n=this._levels;n.forEach(function(f){f.loadError=0}),t.prototype.startLoad.call(this)},h.onManifestLoaded=function(n,f){var g=[],T=[],p=[],o,s={},r,c=!1,l=!1,k=!1;if(f.levels.forEach(function(N){var B=N.attrs;c=c||!!(N.width&&N.height),l=l||!!N.videoCodec,k=k||!!N.audioCodec,d&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0);var F=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;r=s[F],r?r.url.push(N.url):(r=new D.Level(N),s[F]=r,g.push(r)),B&&(B.AUDIO&&Object(L.addGroupId)(r,"audio",B.AUDIO),B.SUBTITLES&&Object(L.addGroupId)(r,"text",B.SUBTITLES))}),(c||l)&&k&&(g=g.filter(function(N){var B=N.videoCodec,F=N.width,U=N.height;return!!B||!!(F&&U)})),g=g.filter(function(N){var B=N.audioCodec,F=N.videoCodec;return(!B||Object(I.isCodecSupportedInMp4)(B,"audio"))&&(!F||Object(I.isCodecSupportedInMp4)(F,"video"))}),f.audioTracks&&(T=f.audioTracks.filter(function(N){return!N.audioCodec||Object(I.isCodecSupportedInMp4)(N.audioCodec,"audio")}),Object(L.assignTrackIdsByGroup)(T)),f.subtitles&&(p=f.subtitles,Object(L.assignTrackIdsByGroup)(p)),g.length>0){o=g[0].bitrate,g.sort(function(N,B){return N.bitrate-B.bitrate}),this._levels=g;for(var x=0;x<g.length;x++)if(g[x].bitrate===o){this._firstLevel=x,this.log("manifest loaded, "+g.length+" level(s) found, first bitrate: "+o);break}var C=k&&!l,P={levels:g,audioTracks:T,subtitleTracks:p,firstLevel:this._firstLevel,stats:f.stats,audio:k,video:l,altAudio:!C&&T.some(function(N){return!!N.url})};this.hls.trigger(y.Events.MANIFEST_PARSED,P),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(y.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:f.url,reason:"no level with compatible codecs found in manifest"})},h.onError=function(n,f){if(t.prototype.onError.call(this,n,f),!f.fatal){var g=f.context,T=this._levels[this.currentLevelIndex];if(g&&(g.type===_.PlaylistContextType.AUDIO_TRACK&&T.audioGroupIds&&g.groupId===T.audioGroupIds[T.urlId]||g.type===_.PlaylistContextType.SUBTITLE_TRACK&&T.textGroupIds&&g.groupId===T.textGroupIds[T.urlId])){this.redundantFailover(this.currentLevelIndex);return}var p=!1,o=!0,s;switch(f.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(f.frag){var r=this._levels[f.frag.level];r?(r.fragmentError++,r.fragmentError>this.hls.config.fragLoadingMaxRetry&&(s=f.frag.level)):s=f.frag.level}break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:g&&(g.deliveryDirectives&&(o=!1),s=g.level),p=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:s=f.level,p=!0;break}s!==void 0&&this.recoverLevel(f,s,p,o)}},h.recoverLevel=function(n,f,g,T){var p=n.details,o=this._levels[f];if(o.loadError++,g){var s=this.retryLoadingOrFail(n);if(s)n.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(T){var r=o.url.length;if(r>1&&o.loadError<r)n.levelRetry=!0,this.redundantFailover(f);else if(this.manualLevelIndex===-1){var c=f===0?this._levels.length-1:f-1;this.currentLevelIndex!==c&&this._levels[c].loadError===0&&(this.warn(p+": switch to "+c),n.levelRetry=!0,this.hls.nextAutoLevel=c)}}},h.redundantFailover=function(n){var f=this._levels[n],g=f.url.length;if(g>1){var T=(f.urlId+1)%g;this.warn("Switching to redundant URL-id "+T),this._levels.forEach(function(p){p.urlId=T}),this.level=n}},h.onFragLoaded=function(n,f){var g=f.frag;if(g!==void 0&&g.type===_.PlaylistLevelType.MAIN){var T=this._levels[g.level];T!==void 0&&(T.fragmentError=0,T.loadError=0)}},h.onLevelLoaded=function(n,f){var g,T=f.level,p=f.details,o=this._levels[T];if(!o){var s;this.warn("Invalid level index "+T),(s=f.deliveryDirectives)!==null&&s!==void 0&&s.skip&&(p.deltaUpdateFailed=!0);return}T===this.currentLevelIndex?(o.fragmentError===0&&(o.loadError=0,this.retryCount=0),this.playlistLoaded(T,f,o.details)):(g=f.deliveryDirectives)!==null&&g!==void 0&&g.skip&&(p.deltaUpdateFailed=!0)},h.onAudioTrackSwitched=function(n,f){var g=this.hls.levels[this.currentLevelIndex];if(!!g&&g.audioGroupIds){for(var T=-1,p=this.hls.audioTracks[f.id].groupId,o=0;o<g.audioGroupIds.length;o++)if(g.audioGroupIds[o]===p){T=o;break}T!==g.urlId&&(g.urlId=T,this.startLoad())}},h.loadPlaylist=function(n){var f=this.currentLevelIndex,g=this._levels[f];if(this.canLoad&&g&&g.url.length>0){var T=g.urlId,p=g.url[T];if(n)try{p=n.addDirectives(p)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Attempt loading level index "+f+(n?" at sn "+n.msn+" part "+n.part:"")+" with URL-id "+T+" "+p),this.clearTimer(),this.hls.trigger(y.Events.LEVEL_LOADING,{url:p,level:f,id:T,deliveryDirectives:n||null})}},h.removeLevel=function(n,f){var g=function(p,o){return o!==f},T=this._levels.filter(function(p,o){return o!==n?!0:p.url.length>1&&f!==void 0?(p.url=p.url.filter(g),p.audioGroupIds&&(p.audioGroupIds=p.audioGroupIds.filter(g)),p.textGroupIds&&(p.textGroupIds=p.textGroupIds.filter(g)),p.urlId=0,!0):!1}).map(function(p,o){var s=p.details;return s!=null&&s.fragments&&s.fragments.forEach(function(r){r.level=o}),p});this._levels=T,this.hls.trigger(y.Events.LEVELS_UPDATED,{levels:T})},S(i,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(n){var f,g=this._levels;if(g.length!==0&&!(this.currentLevelIndex===n&&(f=g[n])!==null&&f!==void 0&&f.details)){if(n<0||n>=g.length){var T=n<0;if(this.hls.trigger(y.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:n,fatal:T,reason:"invalid level idx"}),T)return;n=Math.min(n,g.length-1)}this.clearTimer();var p=this.currentLevelIndex,o=g[p],s=g[n];this.log("switching to level "+n+" from "+p),this.currentLevelIndex=n;var r=u({},s,{level:n,maxBitrate:s.maxBitrate,uri:s.uri,urlId:s.urlId});delete r._urlId,this.hls.trigger(y.Events.LEVEL_SWITCHING,r);var c=s.details;if(!c||c.live){var l=this.switchParams(s.uri,o==null?void 0:o.details);this.loadPlaylist(l)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(n){this.manualLevelIndex=n,this._startLevel===void 0&&(this._startLevel=n),n!==-1&&(this.level=n)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(n){this._firstLevel=n}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var n=this.hls.config.startLevel;return n!==void 0?n:this._firstLevel}else return this._startLevel},set:function(n){this._startLevel=n}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(n){this.level=n,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=n)}}]),i}(R.default)},"./src/controller/level-helper.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"addGroupId",function(){return b}),a.d(w,"assignTrackIdsByGroup",function(){return I}),a.d(w,"updatePTS",function(){return L}),a.d(w,"updateFragPTSDTS",function(){return _}),a.d(w,"mergeDetails",function(){return u}),a.d(w,"mapPartIntersection",function(){return m}),a.d(w,"mapFragmentIntersection",function(){return S}),a.d(w,"adjustSliding",function(){return E}),a.d(w,"addSliding",function(){return A}),a.d(w,"computeReloadInterval",function(){return d}),a.d(w,"getFragmentWithSN",function(){return e}),a.d(w,"getPartWith",function(){return t});var D=a("./src/polyfills/number.ts"),y=a("./src/utils/logger.ts");function b(i,h,n){switch(h){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(n);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(n);break}}function I(i){var h={};i.forEach(function(n){var f=n.groupId||"";n.id=h[f]=h[f]||0,h[f]++})}function L(i,h,n){var f=i[h],g=i[n];R(f,g)}function R(i,h){var n=h.startPTS;if(Object(D.isFiniteNumber)(n)){var f=0,g;h.sn>i.sn?(f=n-i.start,g=i):(f=i.start-n,g=h),g.duration!==f&&(g.duration=f)}else if(h.sn>i.sn){var T=i.cc===h.cc;T&&i.minEndPTS?h.start=i.start+(i.minEndPTS-i.start):h.start=i.start+i.duration}else h.start=Math.max(i.start-h.duration,0)}function _(i,h,n,f,g,T){var p=f-n;p<=0&&(y.logger.warn("Fragment should have a positive duration",h),f=n+h.duration,T=g+h.duration);var o=n,s=f,r=h.startPTS,c=h.endPTS;if(Object(D.isFiniteNumber)(r)){var l=Math.abs(r-n);Object(D.isFiniteNumber)(h.deltaPTS)?h.deltaPTS=Math.max(l,h.deltaPTS):h.deltaPTS=l,o=Math.max(n,r),n=Math.min(n,r),g=Math.min(g,h.startDTS),s=Math.min(f,c),f=Math.max(f,c),T=Math.max(T,h.endDTS)}h.duration=f-n;var k=n-h.start;h.appendedPTS=f,h.start=h.startPTS=n,h.maxStartPTS=o,h.startDTS=g,h.endPTS=f,h.minEndPTS=s,h.endDTS=T;var x=h.sn;if(!i||x<i.startSN||x>i.endSN)return 0;var C,P=x-i.startSN,N=i.fragments;for(N[P]=h,C=P;C>0;C--)R(N[C],N[C-1]);for(C=P;C<N.length-1;C++)R(N[C],N[C+1]);return i.fragmentHint&&R(N[N.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,k}function u(i,h){for(var n=null,f=i.fragments,g=f.length-1;g>=0;g--){var T=f[g].initSegment;if(T){n=T;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var p=0,o;if(S(i,h,function(x,C){var P;x.relurl&&(p=x.cc-C.cc),Object(D.isFiniteNumber)(x.startPTS)&&Object(D.isFiniteNumber)(x.endPTS)&&(C.start=C.startPTS=x.startPTS,C.startDTS=x.startDTS,C.appendedPTS=x.appendedPTS,C.maxStartPTS=x.maxStartPTS,C.endPTS=x.endPTS,C.endDTS=x.endDTS,C.minEndPTS=x.minEndPTS,C.duration=x.endPTS-x.startPTS,C.duration&&(o=C),h.PTSKnown=h.alignedSliding=!0),C.elementaryStreams=x.elementaryStreams,C.loader=x.loader,C.stats=x.stats,C.urlId=x.urlId,x.initSegment?(C.initSegment=x.initSegment,n=x.initSegment):(!C.initSegment||C.initSegment.relurl==((P=n)===null||P===void 0?void 0:P.relurl))&&(C.initSegment=n)}),h.skippedSegments&&(h.deltaUpdateFailed=h.fragments.some(function(x){return!x}),h.deltaUpdateFailed)){y.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var s=h.skippedSegments;s--;)h.fragments.shift();h.startSN=h.fragments[0].sn,h.startCC=h.fragments[0].cc}var r=h.fragments;if(p){y.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<r.length;c++)r[c].cc+=p}h.skippedSegments&&(h.startCC=h.fragments[0].cc),m(i.partList,h.partList,function(x,C){C.elementaryStreams=x.elementaryStreams,C.stats=x.stats}),o?_(h,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):E(i,h),r.length&&(h.totalduration=h.edge-r[0].start),h.driftStartTime=i.driftStartTime,h.driftStart=i.driftStart;var l=h.advancedDateTime;if(h.advanced&&l){var k=h.edge;h.driftStart||(h.driftStartTime=l,h.driftStart=k),h.driftEndTime=l,h.driftEnd=k}else h.driftEndTime=i.driftEndTime,h.driftEnd=i.driftEnd,h.advancedDateTime=i.advancedDateTime}function m(i,h,n){if(i&&h)for(var f=0,g=0,T=i.length;g<=T;g++){var p=i[g],o=h[g+f];p&&o&&p.index===o.index&&p.fragment.sn===o.fragment.sn?n(p,o):f--}}function S(i,h,n){for(var f=h.skippedSegments,g=Math.max(i.startSN,h.startSN)-h.startSN,T=(i.fragmentHint?1:0)+(f?h.endSN:Math.min(i.endSN,h.endSN))-h.startSN,p=h.startSN-i.startSN,o=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments,s=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,r=g;r<=T;r++){var c=s[p+r],l=o[r];f&&!l&&r<f&&(l=h.fragments[r]=c),c&&l&&n(c,l)}}function E(i,h){var n=h.startSN+h.skippedSegments-i.startSN,f=i.fragments;n<0||n>=f.length||A(h,f[n].start)}function A(i,h){if(h){for(var n=i.fragments,f=i.skippedSegments;f<n.length;f++)n[f].start+=h;i.fragmentHint&&(i.fragmentHint.start+=h)}}function d(i,h){var n=1e3*i.levelTargetDuration,f=n/2,g=i.age,T=g>0&&g<n*3,p=h.loading.end-h.loading.start,o,s=i.availabilityDelay;if(i.updated===!1)if(T){var r=333*i.misses;o=Math.max(Math.min(f,p*2),r),i.availabilityDelay=(i.availabilityDelay||0)+o}else o=f;else T?(s=Math.min(s||n/2,g),i.availabilityDelay=s,o=s+n-g):o=n-p;return Math.round(o)}function e(i,h,n){if(!i||!i.details)return null;var f=i.details,g=f.fragments[h-f.startSN];return g||(g=f.fragmentHint,g&&g.sn===h)?g:h<f.startSN&&n&&n.sn===h?n:null}function t(i,h,n){if(!i||!i.details)return null;var f=i.details.partList;if(f)for(var g=f.length;g--;){var T=f[g];if(T.index===n&&T.fragment.sn===h)return T}return null}},"./src/controller/stream-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return f});var D=a("./src/polyfills/number.ts"),y=a("./src/controller/base-stream-controller.ts"),b=a("./src/is-supported.ts"),I=a("./src/events.ts"),L=a("./src/utils/buffer-helper.ts"),R=a("./src/controller/fragment-tracker.ts"),_=a("./src/types/loader.ts"),u=a("./src/loader/fragment.ts"),m=a("./src/demux/transmuxer-interface.ts"),S=a("./src/types/transmuxer.ts"),E=a("./src/controller/gap-controller.ts"),A=a("./src/errors.ts"),d=a("./src/utils/logger.ts");function e(g,T){for(var p=0;p<T.length;p++){var o=T[p];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(g,o.key,o)}}function t(g,T,p){return T&&e(g.prototype,T),p&&e(g,p),g}function i(g,T){g.prototype=Object.create(T.prototype),g.prototype.constructor=g,h(g,T)}function h(g,T){return h=Object.setPrototypeOf||function(p,o){return p.__proto__=o,p},h(g,T)}var n=100,f=function(g){i(T,g);function T(o,s){var r;return r=g.call(this,o,s,"[stream-controller]")||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.stalled=!1,r.couldBacktrack=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}var p=T.prototype;return p._registerListeners=function(){var o=this.hls;o.on(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.on(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.on(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.on(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.on(I.Events.LEVEL_LOADING,this.onLevelLoading,this),o.on(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.on(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.on(I.Events.ERROR,this.onError,this),o.on(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.on(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.on(I.Events.BUFFER_CREATED,this.onBufferCreated,this),o.on(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.on(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.on(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var o=this.hls;o.off(I.Events.MEDIA_ATTACHED,this.onMediaAttached,this),o.off(I.Events.MEDIA_DETACHING,this.onMediaDetaching,this),o.off(I.Events.MANIFEST_LOADING,this.onManifestLoading,this),o.off(I.Events.MANIFEST_PARSED,this.onManifestParsed,this),o.off(I.Events.LEVEL_LOADED,this.onLevelLoaded,this),o.off(I.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),o.off(I.Events.ERROR,this.onError,this),o.off(I.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),o.off(I.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),o.off(I.Events.BUFFER_CREATED,this.onBufferCreated,this),o.off(I.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),o.off(I.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),o.off(I.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},p.startLoad=function(o){if(this.levels){var s=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(n),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var c=r.startLevel;c===-1&&(r.config.testBandwidth?(c=0,this.bitrateTest=!0):c=r.nextAutoLevel),this.level=r.nextLoadLevel=c,this.loadedmetadata=!1}s>0&&o===-1&&(this.log("Override startPosition with lastCurrentTime @"+s.toFixed(3)),o=s),this.state=y.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=o,this.tick()}else this._forceStartLoad=!0,this.state=y.State.STOPPED},p.stopLoad=function(){this._forceStartLoad=!1,g.prototype.stopLoad.call(this)},p.doTick=function(){switch(this.state){case y.State.IDLE:this.doTickIdle();break;case y.State.WAITING_LEVEL:{var o,s=this.levels,r=this.level,c=s==null||(o=s[r])===null||o===void 0?void 0:o.details;if(c&&(!c.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(c))break;this.state=y.State.IDLE;break}break}case y.State.FRAG_LOADING_WAITING_RETRY:{var l,k=self.performance.now(),x=this.retryDate;(!x||k>=x||(l=this.media)!==null&&l!==void 0&&l.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=y.State.IDLE)}break;default:break}this.onTickEnd()},p.onTickEnd=function(){g.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},p.doTickIdle=function(){var o,s,r=this.hls,c=this.levelLastLoaded,l=this.levels,k=this.media,x=r.config,C=r.nextLoadLevel;if(!(c===null||!k&&(this.startFragRequested||!x.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!l||!l[C])){var P=l[C];this.level=r.nextLoadLevel=C;var N=P.details;if(!N||this.state===y.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==C){this.state=y.State.WAITING_LEVEL;return}var B=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:k,_.PlaylistLevelType.MAIN);if(B!==null){var F=B.len,U=this.getMaxBufferLength(P.maxBitrate);if(!(F>=U)){if(this._streamEnded(B,N)){var H={};this.altAudio&&(H.type="video"),this.hls.trigger(I.Events.BUFFER_EOS,H),this.state=y.State.ENDED;return}var G=B.end,j=this.getNextFragment(G,N);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"){var V=j.sn-N.startSN;V>1&&(j=N.fragments[V-1],this.fragmentTracker.removeFragment(j))}if(j&&this.fragmentTracker.getState(j)===R.FragmentState.OK&&this.nextLoadPosition>G){var q=this.audioOnly&&!this.altAudio?u.ElementaryStreamTypes.AUDIO:u.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(k,q,_.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,N)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((o=j.decryptdata)===null||o===void 0?void 0:o.keyFormat)==="identity"&&!((s=j.decryptdata)!==null&&s!==void 0&&s.key)?this.loadKey(j,N):this.loadFragment(j,N,G))}}}},p.loadFragment=function(o,s,r){var c,l=this.fragmentTracker.getState(o);if(this.fragCurrent=o,l===R.FragmentState.BACKTRACKED){var k=this.fragmentTracker.getBacktrackData(o);if(k){this._handleFragmentLoadProgress(k),this._handleFragmentLoadComplete(k);return}else l=R.FragmentState.NOT_LOADED}l===R.FragmentState.NOT_LOADED||l===R.FragmentState.PARTIAL?o.sn==="initSegment"?this._loadInitSegment(o):this.bitrateTest?(o.bitrateTest=!0,this.log("Fragment "+o.sn+" of level "+o.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(o)):(this.startFragRequested=!0,g.prototype.loadFragment.call(this,o,s,r)):l===R.FragmentState.APPENDING?this.reduceMaxBufferLength(o.duration)&&this.fragmentTracker.removeFragment(o):((c=this.media)===null||c===void 0?void 0:c.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},p.getAppendedFrag=function(o){var s=this.fragmentTracker.getAppendedFrag(o,_.PlaylistLevelType.MAIN);return s&&"fragment"in s?s.fragment:s},p.getBufferedFrag=function(o){return this.fragmentTracker.getBufferedFrag(o,_.PlaylistLevelType.MAIN)},p.followingBufferedFrag=function(o){return o?this.getBufferedFrag(o.end+.5):null},p.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},p.nextLevelSwitch=function(){var o=this.levels,s=this.media;if(s!=null&&s.readyState){var r,c=this.getAppendedFrag(s.currentTime);if(c&&c.start>1&&this.flushMainBuffer(0,c.start-1),!s.paused&&o){var l=this.hls.nextLoadLevel,k=o[l],x=this.fragLastKbps;x&&this.fragCurrent?r=this.fragCurrent.duration*k.maxBitrate/(1e3*x)+1:r=0}else r=0;var C=this.getBufferedFrag(s.currentTime+r);if(C){var P=this.followingBufferedFrag(C);if(P){this.abortCurrentFrag();var N=P.maxStartPTS?P.maxStartPTS:P.start,B=P.duration,F=Math.max(C.end,N+Math.min(Math.max(B-this.config.maxFragLookUpTolerance,B*.5),B*.75));this.flushMainBuffer(F,Number.POSITIVE_INFINITY)}}}},p.abortCurrentFrag=function(){var o=this.fragCurrent;this.fragCurrent=null,o!=null&&o.loader&&o.loader.abort(),this.state===y.State.KEY_LOADING&&(this.state=y.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},p.flushMainBuffer=function(o,s){g.prototype.flushMainBuffer.call(this,o,s,this.altAudio?"video":null)},p.onMediaAttached=function(o,s){g.prototype.onMediaAttached.call(this,o,s);var r=s.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,r,this.fragmentTracker,this.hls)},p.onMediaDetaching=function(){var o=this.media;o&&(o.removeEventListener("playing",this.onvplaying),o.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),g.prototype.onMediaDetaching.call(this)},p.onMediaPlaying=function(){this.tick()},p.onMediaSeeked=function(){var o=this.media,s=o?o.currentTime:null;Object(D.isFiniteNumber)(s)&&this.log("Media seeked to "+s.toFixed(3)),this.tick()},p.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(I.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},p.onManifestParsed=function(o,s){var r=!1,c=!1,l;s.levels.forEach(function(k){l=k.audioCodec,l&&(l.indexOf("mp4a.40.2")!==-1&&(r=!0),l.indexOf("mp4a.40.5")!==-1&&(c=!0))}),this.audioCodecSwitch=r&&c&&!Object(b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=s.levels,this.startFragRequested=!1},p.onLevelLoading=function(o,s){var r=this.levels;if(!(!r||this.state!==y.State.IDLE)){var c=r[s.level];(!c.details||c.details.live&&this.levelLastLoaded!==s.level||this.waitForCdnTuneIn(c.details))&&(this.state=y.State.WAITING_LEVEL)}},p.onLevelLoaded=function(o,s){var r,c=this.levels,l=s.level,k=s.details,x=k.totalduration;if(!c){this.warn("Levels were reset while loading level "+l);return}this.log("Level "+l+" loaded ["+k.startSN+","+k.endSN+"], cc ["+k.startCC+", "+k.endCC+"] duration:"+x);var C=this.fragCurrent;C&&(this.state===y.State.FRAG_LOADING||this.state===y.State.FRAG_LOADING_WAITING_RETRY)&&C.level!==s.level&&C.loader&&(this.state=y.State.IDLE,C.loader.abort());var P=c[l],N=0;if(k.live||(r=P.details)!==null&&r!==void 0&&r.live){if(k.fragments[0]||(k.deltaUpdateFailed=!0),k.deltaUpdateFailed)return;N=this.alignPlaylists(k,P.details)}if(P.details=k,this.levelLastLoaded=l,this.hls.trigger(I.Events.LEVEL_UPDATED,{details:k,level:l}),this.state===y.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(k))return;this.state=y.State.IDLE}this.startFragRequested?k.live&&this.synchronizeToLiveEdge(k):this.setStartPosition(k,N),this.tick()},p._handleFragmentLoadProgress=function(o){var s,r=o.frag,c=o.part,l=o.payload,k=this.levels;if(!k){this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered");return}var x=k[r.level],C=x.details;if(!C){this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset");return}var P=x.videoCodec,N=C.PTSKnown||!C.live,B=(s=r.initSegment)===null||s===void 0?void 0:s.data,F=this._getAudioCodec(x),U=this.transmuxer=this.transmuxer||new m.default(this.hls,_.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=c?c.index:-1,G=H!==-1,j=new S.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,l.byteLength,H,G),V=this.initPTS[r.cc];U.push(l,B,F,P,r,c,C.totalduration,N,j,V)},p.onAudioTrackSwitching=function(o,s){var r=this.altAudio,c=!!s.url,l=s.id;if(!c){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var k=this.fragCurrent;k!=null&&k.loader&&(this.log("Switching to main audio track, cancel main fragment load"),k.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var x=this.hls;r&&x.trigger(I.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),x.trigger(I.Events.AUDIO_TRACK_SWITCHED,{id:l})}},p.onAudioTrackSwitched=function(o,s){var r=s.id,c=!!this.hls.audioTracks[r].url;if(c){var l=this.videoBuffer;l&&this.mediaBuffer!==l&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=l)}this.altAudio=c,this.tick()},p.onBufferCreated=function(o,s){var r=s.tracks,c,l,k=!1;for(var x in r){var C=r[x];if(C.id==="main"){if(l=x,c=C,x==="video"){var P=r[x];P&&(this.videoBuffer=P.buffer)}}else k=!0}k&&c?(this.log("Alternate track found, use "+l+".buffered to schedule main fragment loading"),this.mediaBuffer=c.buffer):this.mediaBuffer=this.media},p.onFragBuffered=function(o,s){var r=s.frag,c=s.part;if(!(r&&r.type!==_.PlaylistLevelType.MAIN)){if(this.fragContextChanged(r)){this.warn("Fragment "+r.sn+(c?" p: "+c.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),this.state===y.State.PARSED&&(this.state=y.State.IDLE);return}var l=c?c.stats:r.stats;this.fragLastKbps=Math.round(8*l.total/(l.buffering.end-l.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,c)}},p.onError=function(o,s){switch(s.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.MAIN,s);break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==y.State.ERROR&&(s.fatal?(this.warn(""+s.details),this.state=y.State.ERROR):!s.levelRetry&&this.state===y.State.WAITING_LEVEL&&(this.state=y.State.IDLE));break;case A.ErrorDetails.BUFFER_FULL_ERROR:if(s.parent==="main"&&(this.state===y.State.PARSING||this.state===y.State.PARSED)){var r=!0,c=this.getFwdBufferInfo(this.media,_.PlaylistLevelType.MAIN);c&&c.len>.5&&(r=!this.reduceMaxBufferLength(c.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},p.checkBuffer=function(){var o=this.media,s=this.gapController;if(!(!o||!s||!o.readyState)){var r=L.BufferHelper.getBuffered(o);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):s.poll(this.lastCurrentTime),this.lastCurrentTime=o.currentTime}},p.onFragLoadEmergencyAborted=function(){this.state=y.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},p.onBufferFlushed=function(o,s){var r=s.type;if(r!==u.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var c=(r===u.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(c,r,_.PlaylistLevelType.MAIN)}},p.onLevelsUpdated=function(o,s){this.levels=s.levels},p.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},p.seekToStartPos=function(){var o=this.media,s=o.currentTime,r=this.startPosition;if(r>=0&&s<r){if(o.seeking){d.logger.log("could not seek to "+r+", already seeking at "+s);return}var c=L.BufferHelper.getBuffered(o),l=c.length?c.start(0):0,k=l-r;k>0&&(k<this.config.maxBufferHole||k<this.config.maxFragLookUpTolerance)&&(d.logger.log("adjusting start position by "+k+" to match buffer start"),r+=k,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+s),o.currentTime=r}},p._getAudioCodec=function(o){var s=this.config.defaultAudioCodec||o.audioCodec;return this.audioCodecSwap&&s&&(this.log("Swapping audio codec"),s.indexOf("mp4a.40.5")!==-1?s="mp4a.40.2":s="mp4a.40.5"),s},p._loadBitrateTestFrag=function(o){var s=this;this._doFragLoad(o).then(function(r){var c=s.hls;if(!(!r||c.nextLoadLevel||s.fragContextChanged(o))){s.fragLoadError=0,s.state=y.State.IDLE,s.startFragRequested=!1,s.bitrateTest=!1;var l=o.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),c.trigger(I.Events.FRAG_LOADED,r)}})},p._handleTransmuxComplete=function(o){var s,r="main",c=this.hls,l=o.remuxResult,k=o.chunkMeta,x=this.getCurrentContext(k);if(!x){this.warn("The loading context changed while buffering fragment "+k.sn+" of level "+k.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(k.level);return}var C=x.frag,P=x.part,N=x.level,B=l.video,F=l.text,U=l.id3,H=l.initSegment,G=this.altAudio?void 0:l.audio;if(!this.fragContextChanged(C)){if(this.state=y.State.PARSING,H){H.tracks&&(this._bufferInitSegment(N,H.tracks,C,k),c.trigger(I.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:r,tracks:H.tracks}));var j=H.initPTS,V=H.timescale;Object(D.isFiniteNumber)(j)&&(this.initPTS[C.cc]=j,c.trigger(I.Events.INIT_PTS_FOUND,{frag:C,id:r,initPTS:j,timescale:V}))}if(B&&l.independent!==!1){if(N.details){var q=B.startPTS,W=B.endPTS,Y=B.startDTS,$=B.endDTS;if(P)P.elementaryStreams[B.type]={startPTS:q,endPTS:W,startDTS:Y,endDTS:$};else if(B.firstKeyFrame&&B.independent&&(this.couldBacktrack=!0),B.dropped&&B.independent){var Z=this.getLoadPosition()+this.config.maxBufferHole;if(Z<q){this.backtrack(C);return}C.setElementaryStreamInfo(B.type,C.start,W,C.start,$,!0)}C.setElementaryStreamInfo(B.type,q,W,Y,$),this.bufferFragmentData(B,C,P,k)}}else if(l.independent===!1){this.backtrack(C);return}if(G){var te=G.startPTS,ie=G.endPTS,ve=G.startDTS,ae=G.endDTS;P&&(P.elementaryStreams[u.ElementaryStreamTypes.AUDIO]={startPTS:te,endPTS:ie,startDTS:ve,endDTS:ae}),C.setElementaryStreamInfo(u.ElementaryStreamTypes.AUDIO,te,ie,ve,ae),this.bufferFragmentData(G,C,P,k)}if(U!=null&&(s=U.samples)!==null&&s!==void 0&&s.length){var re={frag:C,id:r,samples:U.samples};c.trigger(I.Events.FRAG_PARSING_METADATA,re)}if(F){var Q={frag:C,id:r,samples:F.samples};c.trigger(I.Events.FRAG_PARSING_USERDATA,Q)}}},p._bufferInitSegment=function(o,s,r,c){var l=this;if(this.state===y.State.PARSING){this.audioOnly=!!s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio;var k=s.audio,x=s.video,C=s.audiovideo;if(k){var P=o.audioCodec,N=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(P&&(P.indexOf("mp4a.40.5")!==-1?P="mp4a.40.2":P="mp4a.40.5"),k.metadata.channelCount!==1&&N.indexOf("firefox")===-1&&(P="mp4a.40.5")),N.indexOf("android")!==-1&&k.container!=="audio/mpeg"&&(P="mp4a.40.2",this.log("Android: force audio codec to "+P)),o.audioCodec&&o.audioCodec!==P&&this.log('Swapping manifest audio codec "'+o.audioCodec+'" for "'+P+'"'),k.levelCodec=P,k.id="main",this.log("Init audio buffer, container:"+k.container+", codecs[selected/level/parsed]=["+(P||"")+"/"+(o.audioCodec||"")+"/"+k.codec+"]")}x&&(x.levelCodec=o.videoCodec,x.id="main",this.log("Init video buffer, container:"+x.container+", codecs[level/parsed]=["+(o.videoCodec||"")+"/"+x.codec+"]")),C&&this.log("Init audiovideo buffer, container:"+C.container+", codecs[level/parsed]=["+(o.attrs.CODECS||"")+"/"+C.codec+"]"),this.hls.trigger(I.Events.BUFFER_CODECS,s),Object.keys(s).forEach(function(B){var F=s[B],U=F.initSegment;U!=null&&U.byteLength&&l.hls.trigger(I.Events.BUFFER_APPENDING,{type:B,data:U,frag:r,part:null,chunkMeta:c,parent:r.type})}),this.tick()}},p.backtrack=function(o){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(o);var s=this.fragmentTracker.backtrack(o);this.fragPrevious=null,this.nextLoadPosition=o.start,s?this.resetFragmentLoading(o):this.state=y.State.BACKTRACKING},p.checkFragmentChanged=function(){var o=this.media,s=null;if(o&&o.readyState>1&&o.seeking===!1){var r=o.currentTime;if(L.BufferHelper.isBuffered(o,r)?s=this.getAppendedFrag(r):L.BufferHelper.isBuffered(o,r+.1)&&(s=this.getAppendedFrag(r+.1)),s){var c=this.fragPlaying,l=s.level;(!c||s.sn!==c.sn||c.level!==l||s.urlId!==c.urlId)&&(this.hls.trigger(I.Events.FRAG_CHANGED,{frag:s}),(!c||c.level!==l)&&this.hls.trigger(I.Events.LEVEL_SWITCHED,{level:l}),this.fragPlaying=s)}}},t(T,[{key:"nextLevel",get:function(){var o=this.nextBufferedFrag;return o?o.level:-1}},{key:"currentLevel",get:function(){var o=this.media;if(o){var s=this.getAppendedFrag(o.currentTime);if(s)return s.level}return-1}},{key:"nextBufferedFrag",get:function(){var o=this.media;if(o){var s=this.getAppendedFrag(o.currentTime);return this.followingBufferedFrag(s)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),T}(y.default)},"./src/controller/subtitle-stream-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"SubtitleStreamController",function(){return i});var D=a("./src/events.ts"),y=a("./src/utils/logger.ts"),b=a("./src/utils/buffer-helper.ts"),I=a("./src/controller/fragment-finders.ts"),L=a("./src/utils/discontinuities.ts"),R=a("./src/controller/level-helper.ts"),_=a("./src/controller/fragment-tracker.ts"),u=a("./src/controller/base-stream-controller.ts"),m=a("./src/types/loader.ts"),S=a("./src/types/level.ts");function E(h,n){for(var f=0;f<n.length;f++){var g=n[f];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(h,g.key,g)}}function A(h,n,f){return n&&E(h.prototype,n),f&&E(h,f),h}function d(h,n){h.prototype=Object.create(n.prototype),h.prototype.constructor=h,e(h,n)}function e(h,n){return e=Object.setPrototypeOf||function(f,g){return f.__proto__=g,f},e(h,n)}var t=500,i=function(h){d(n,h);function n(g,T){var p;return p=h.call(this,g,T,"[subtitle-stream-controller]")||this,p.levels=[],p.currentTrackId=-1,p.tracksBuffered=[],p.mainDetails=null,p._registerListeners(),p}var f=n.prototype;return f.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},f._registerListeners=function(){var g=this.hls;g.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.on(D.Events.ERROR,this.onError,this),g.on(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.on(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),g.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.on(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),g.on(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f._unregisterListeners=function(){var g=this.hls;g.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),g.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),g.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),g.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),g.off(D.Events.ERROR,this.onError,this),g.off(D.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),g.off(D.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),g.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),g.off(D.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),g.off(D.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},f.startLoad=function(){this.stopLoad(),this.state=u.State.IDLE,this.setInterval(t),this.tick()},f.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},f.onLevelLoaded=function(g,T){this.mainDetails=T.details},f.onSubtitleFragProcessed=function(g,T){var p=T.frag,o=T.success;if(this.fragPrevious=p,this.state=u.State.IDLE,!!o){var s=this.tracksBuffered[this.currentTrackId];if(s){for(var r,c=p.start,l=0;l<s.length;l++)if(c>=s[l].start&&c<=s[l].end){r=s[l];break}var k=p.start+p.duration;r?r.end=k:(r={start:c,end:k},s.push(r)),this.fragmentTracker.fragBuffered(p)}}},f.onBufferFlushing=function(g,T){var p=T.startOffset,o=T.endOffset;if(p===0&&o!==Number.POSITIVE_INFINITY){var s=this.currentTrackId,r=this.levels;if(!r.length||!r[s]||!r[s].details)return;var c=r[s].details,l=c.targetduration,k=o-l;if(k<=0)return;T.endOffsetSubtitles=Math.max(0,k),this.tracksBuffered.forEach(function(x){for(var C=0;C<x.length;){if(x[C].end<=k){x.shift();continue}else if(x[C].start<k)x[C].start=k;else break;C++}}),this.fragmentTracker.removeFragmentsInRange(p,k,m.PlaylistLevelType.SUBTITLE)}},f.onError=function(g,T){var p,o=T.frag;!o||o.type!==m.PlaylistLevelType.SUBTITLE||((p=this.fragCurrent)!==null&&p!==void 0&&p.loader&&this.fragCurrent.loader.abort(),this.state=u.State.IDLE)},f.onSubtitleTracksUpdated=function(g,T){var p=this,o=T.subtitleTracks;this.tracksBuffered=[],this.levels=o.map(function(s){return new S.Level(s)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(s){p.tracksBuffered[s.id]=[]}),this.mediaBuffer=null},f.onSubtitleTrackSwitch=function(g,T){if(this.currentTrackId=T.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var p=this.levels[this.currentTrackId];p!=null&&p.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(t)):this.mediaBuffer=null},f.onSubtitleTrackLoaded=function(g,T){var p,o=T.details,s=T.id,r=this.currentTrackId,c=this.levels;if(c.length){var l=c[r];if(!(s>=c.length||s!==r||!l)){if(this.mediaBuffer=this.mediaBufferTimeRanges,o.live||(p=l.details)!==null&&p!==void 0&&p.live){var k=this.mainDetails;if(o.deltaUpdateFailed||!k)return;var x=k.fragments[0];if(!l.details)o.hasProgramDateTime&&k.hasProgramDateTime?Object(L.alignMediaPlaylistByPDT)(o,k):x&&Object(R.addSliding)(o,x.start);else{var C=this.alignPlaylists(o,l.details);C===0&&x&&Object(R.addSliding)(o,x.start)}}if(l.details=o,this.levelLastLoaded=s,this.tick(),o.live&&!this.fragCurrent&&this.media&&this.state===u.State.IDLE){var P=Object(I.findFragmentByPTS)(null,o.fragments,this.media.currentTime,0);P||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)}}}},f._handleFragmentLoadComplete=function(g){var T=g.frag,p=g.payload,o=T.decryptdata,s=this.hls;if(!this.fragContextChanged(T)&&p&&p.byteLength>0&&o&&o.key&&o.iv&&o.method==="AES-128"){var r=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(p),o.key.buffer,o.iv.buffer).then(function(c){var l=performance.now();s.trigger(D.Events.FRAG_DECRYPTED,{frag:T,payload:c,stats:{tstart:r,tdecrypt:l}})})}},f.doTick=function(){if(!this.media){this.state=u.State.IDLE;return}if(this.state===u.State.IDLE){var g,T=this.currentTrackId,p=this.levels;if(!p.length||!p[T]||!p[T].details)return;var o=p[T].details,s=o.targetduration,r=this.config,c=this.media,l=b.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,c.currentTime-s,r.maxBufferHole),k=l.end,x=l.len,C=this.getMaxBufferLength()+s;if(x>C)return;console.assert(o,"Subtitle track details are defined on idle subtitle stream controller tick");var P=o.fragments,N=P.length,B=o.edge,F,U=this.fragPrevious;if(k<B){var H=r.maxFragLookUpTolerance;U&&o.hasProgramDateTime&&(F=Object(I.findFragmentByPDT)(P,U.endProgramDateTime,H)),F||(F=Object(I.findFragmentByPTS)(U,P,k,H),!F&&U&&U.start<P[0].start&&(F=P[0]))}else F=P[N-1];(g=F)!==null&&g!==void 0&&g.encrypted?(y.logger.log("Loading key for "+F.sn),this.state=u.State.KEY_LOADING,this.hls.trigger(D.Events.KEY_LOADING,{frag:F})):F&&this.fragmentTracker.getState(F)===_.FragmentState.NOT_LOADED&&this.loadFragment(F,o,k)}},f.loadFragment=function(g,T,p){this.fragCurrent=g,h.prototype.loadFragment.call(this,g,T,p)},A(n,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),n}(u.default)},"./src/controller/subtitle-track-controller.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/events.ts"),y=a("./src/utils/texttrack-utils.ts"),b=a("./src/controller/base-playlist-controller.ts"),I=a("./src/types/loader.ts");function L(E,A){for(var d=0;d<A.length;d++){var e=A[d];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(E,e.key,e)}}function R(E,A,d){return A&&L(E.prototype,A),d&&L(E,d),E}function _(E,A){E.prototype=Object.create(A.prototype),E.prototype.constructor=E,u(E,A)}function u(E,A){return u=Object.setPrototypeOf||function(d,e){return d.__proto__=e,d},u(E,A)}var m=function(E){_(A,E);function A(e){var t;return t=E.call(this,e,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t.subtitleDisplay=!0,t.registerListeners(),t}var d=A.prototype;return d.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,E.prototype.destroy.call(this)},d.registerListeners=function(){var e=this.hls;e.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(D.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){var e=this.hls;e.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(D.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(D.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(D.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(D.Events.ERROR,this.onError,this)},d.onMediaAttached=function(e,t){this.media=t.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},d.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},d.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=S(this.media.textTracks);e.forEach(function(t){Object(y.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null}},d.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},d.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},d.onSubtitleTrackLoaded=function(e,t){var i=t.id,h=t.details,n=this.trackId,f=this.tracksInGroup[n];if(!f){this.warn("Invalid subtitle track id "+i);return}var g=f.details;f.details=t.details,this.log("subtitle track "+i+" loaded ["+h.startSN+"-"+h.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,t,g))},d.onLevelLoading=function(e,t){this.switchLevel(t.level)},d.onLevelSwitching=function(e,t){this.switchLevel(t.level)},d.switchLevel=function(e){var t=this.hls.levels[e];if(t!=null&&t.textGroupIds){var i=t.textGroupIds[t.urlId];if(this.groupId!==i){var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,n=this.tracks.filter(function(T){return!i||T.groupId===i});this.tracksInGroup=n;var f=this.findTrackId(h==null?void 0:h.name)||this.findTrackId();this.groupId=i;var g={subtitleTracks:n};this.log("Updating subtitle tracks, "+n.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(D.Events.SUBTITLE_TRACKS_UPDATED,g),f!==-1&&this.setSubtitleTrack(f,h)}}},d.findTrackId=function(e){for(var t=this.tracksInGroup,i=0;i<t.length;i++){var h=t[i];if((!this.selectDefaultTrack||h.default)&&(!e||e===h.name))return h.id}return-1},d.onError=function(e,t){E.prototype.onError.call(this,e,t),!(t.fatal||!t.context)&&t.context.type===I.PlaylistContextType.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},d.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var i=t.id,h=t.groupId,n=t.url;if(e)try{n=e.addDirectives(n)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(D.Events.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:h,deliveryDirectives:e||null})}},d.toggleTrackModes=function(e){var t=this,i=this.media,h=this.subtitleDisplay,n=this.trackId;if(i){var f=S(i.textTracks),g=f.filter(function(o){return o.groupId===t.groupId});if(e===-1)[].slice.call(f).forEach(function(o){o.mode="disabled"});else{var T=g[n];T&&(T.mode="disabled")}var p=g[e];p&&(p.mode=h?"showing":"hidden")}},d.setSubtitleTrack=function(e,t){var i,h=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(i=h[e])!==null&&i!==void 0&&i.details)||e<-1||e>=h.length)){this.clearTimer();var n=h[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,n){var f=n.id,g=n.groupId,T=g===void 0?"":g,p=n.name,o=n.type,s=n.url;this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:f,groupId:T,name:p,type:o,url:s});var r=this.switchParams(n.url,t==null?void 0:t.details);this.loadPlaylist(r)}else this.hls.trigger(D.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},d.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=S(this.media.textTracks),i=0;i<t.length;i++)if(t[i].mode==="hidden")e=i;else if(t[i].mode==="showing"){e=i;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},R(A,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}]),A}(b.default);function S(E){for(var A=[],d=0;d<E.length;d++){var e=E[d];e.kind==="subtitles"&&e.label&&A.push(E[d])}return A}w.default=m},"./src/controller/timeline-controller.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"TimelineController",function(){return S});var D=a("./src/polyfills/number.ts"),y=a("./src/events.ts"),b=a("./src/utils/cea-608-parser.ts"),I=a("./src/utils/output-filter.ts"),L=a("./src/utils/webvtt-parser.ts"),R=a("./src/utils/texttrack-utils.ts"),_=a("./src/utils/imsc1-ttml-parser.ts"),u=a("./src/types/loader.ts"),m=a("./src/utils/logger.ts"),S=function(){function e(i){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=d(),this.captionsProperties=void 0,this.hls=i,this.config=i.config,this.Cues=i.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var h=new I.default(this,"textTrack1"),n=new I.default(this,"textTrack2"),f=new I.default(this,"textTrack3"),g=new I.default(this,"textTrack4");this.cea608Parser1=new b.default(1,h,n),this.cea608Parser2=new b.default(3,f,g)}i.on(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(y.Events.FRAG_LOADING,this.onFragLoading,this),i.on(y.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.on(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.on(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.on(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var t=e.prototype;return t.destroy=function(){var i=this.hls;i.off(y.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(y.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(y.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(y.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(y.Events.FRAG_LOADING,this.onFragLoading,this),i.off(y.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(y.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.off(y.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.off(y.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.off(y.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.off(y.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},t.addCues=function(i,h,n,f,g){for(var T=!1,p=g.length;p--;){var o=g[p],s=A(o[0],o[1],h,n);if(s>=0&&(o[0]=Math.min(o[0],h),o[1]=Math.max(o[1],n),T=!0,s/(n-h)>.5))return}if(T||g.push([h,n]),this.config.renderTextTracksNatively){var r=this.captionsTracks[i];this.Cues.newCue(r,h,n,f)}else{var c=this.Cues.newCue(null,h,n,f);this.hls.trigger(y.Events.CUES_PARSED,{type:"captions",cues:c,track:i})}},t.onInitPtsFound=function(i,h){var n=this,f=h.frag,g=h.id,T=h.initPTS,p=h.timescale,o=this.unparsedVttFrags;g==="main"&&(this.initPTS[f.cc]=T,this.timescale[f.cc]=p),o.length&&(this.unparsedVttFrags=[],o.forEach(function(s){n.onFragLoaded(y.Events.FRAG_LOADED,s)}))},t.getExistingTrack=function(i){var h=this.media;if(h)for(var n=0;n<h.textTracks.length;n++){var f=h.textTracks[n];if(f[i])return f}return null},t.createCaptionsTrack=function(i){this.config.renderTextTracksNatively?this.createNativeTrack(i):this.createNonNativeTrack(i)},t.createNativeTrack=function(i){if(!this.captionsTracks[i]){var h=this.captionsProperties,n=this.captionsTracks,f=this.media,g=h[i],T=g.label,p=g.languageCode,o=this.getExistingTrack(i);if(o)n[i]=o,Object(R.clearCurrentCues)(n[i]),Object(R.sendAddTrackEvent)(n[i],f);else{var s=this.createTextTrack("captions",T,p);s&&(s[i]=!0,n[i]=s)}}},t.createNonNativeTrack=function(i){if(!this.nonNativeCaptionsTracks[i]){var h=this.captionsProperties[i];if(h){var n=h.label,f={_id:i,label:n,kind:"captions",default:h.media?!!h.media.default:!1,closedCaptions:h.media};this.nonNativeCaptionsTracks[i]=f,this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[f]})}}},t.createTextTrack=function(i,h,n){var f=this.media;if(f)return f.addTextTrack(i,h,n)},t.onMediaAttaching=function(i,h){this.media=h.media,this._cleanTracks()},t.onMediaDetaching=function(){var i=this.captionsTracks;Object.keys(i).forEach(function(h){Object(R.clearCurrentCues)(i[h]),delete i[h]}),this.nonNativeCaptionsTracks={}},t.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=d(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},t._cleanTracks=function(){var i=this.media;if(i){var h=i.textTracks;if(h)for(var n=0;n<h.length;n++)Object(R.clearCurrentCues)(h[n])}},t.onSubtitleTracksUpdated=function(i,h){var n=this;this.textTracks=[];var f=h.subtitleTracks||[],g=f.some(function(s){return s.textCodec===_.IMSC1_CODEC});if(this.config.enableWebVTT||g&&this.config.enableIMSC1){var T=this.tracks&&f&&this.tracks.length===f.length;if(this.tracks=f||[],this.config.renderTextTracksNatively){var p=this.media?this.media.textTracks:[];this.tracks.forEach(function(s,r){var c;if(r<p.length){for(var l=null,k=0;k<p.length;k++)if(E(p[k],s)){l=p[k];break}l&&(c=l)}c?Object(R.clearCurrentCues)(c):(c=n.createTextTrack("subtitles",s.name,s.lang),c&&(c.mode="disabled")),c&&(c.groupId=s.groupId,n.textTracks.push(c))})}else if(!T&&this.tracks&&this.tracks.length){var o=this.tracks.map(function(s){return{label:s.name,kind:s.type.toLowerCase(),default:s.default,subtitleTrack:s}});this.hls.trigger(y.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}},t.onManifestLoaded=function(i,h){var n=this;this.config.enableCEA708Captions&&h.captions&&h.captions.forEach(function(f){var g=/(?:CC|SERVICE)([1-4])/.exec(f.instreamId);if(g){var T="textTrack"+g[1],p=n.captionsProperties[T];!p||(p.label=f.name,f.lang&&(p.languageCode=f.lang),p.media=f)}})},t.onFragLoading=function(i,h){var n=this.cea608Parser1,f=this.cea608Parser2,g=this.lastSn;if(!(!this.enabled||!(n&&f))&&h.frag.type===u.PlaylistLevelType.MAIN){var T=h.frag.sn;T!==g+1&&(n.reset(),f.reset()),this.lastSn=T}},t.onFragLoaded=function(i,h){var n=h.frag,f=h.payload,g=this.initPTS,T=this.unparsedVttFrags;if(n.type===u.PlaylistLevelType.SUBTITLE)if(f.byteLength){if(!Object(D.isFiniteNumber)(g[n.cc])){T.push(h),g.length&&this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")});return}var p=n.decryptdata;if(p==null||p.key==null||p.method!=="AES-128"){var o=this.tracks[n.level],s=this.vttCCs;s[n.cc]||(s[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),o&&o.textCodec===_.IMSC1_CODEC?this._parseIMSC1(n,f):this._parseVTTs(n,f,s)}}else this.hls.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},t._parseIMSC1=function(i,h){var n=this,f=this.hls;Object(_.parseIMSC1)(h,this.initPTS[i.cc],this.timescale[i.cc],function(g){n._appendCues(g,i.level),f.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(g){m.logger.log("Failed to parse IMSC1: "+g),f.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:g})})},t._parseVTTs=function(i,h,n){var f=this,g=this.hls;Object(L.parseWebVTT)(h,this.initPTS[i.cc],this.timescale[i.cc],n,i.cc,i.start,function(T){f._appendCues(T,i.level),g.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(T){f._fallbackToIMSC1(i,h),m.logger.log("Failed to parse VTT cue: "+T),g.trigger(y.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:T})})},t._fallbackToIMSC1=function(i,h){var n=this,f=this.tracks[i.level];f.textCodec||Object(_.parseIMSC1)(h,this.initPTS[i.cc],this.timescale[i.cc],function(){f.textCodec=_.IMSC1_CODEC,n._parseIMSC1(i,h)},function(){f.textCodec="wvtt"})},t._appendCues=function(i,h){var n=this.hls;if(this.config.renderTextTracksNatively){var f=this.textTracks[h];if(f.mode==="disabled")return;i.forEach(function(p){return Object(R.addCueToTrack)(f,p)})}else{var g=this.tracks[h],T=g.default?"default":"subtitles"+h;n.trigger(y.Events.CUES_PARSED,{type:"subtitles",cues:i,track:T})}},t.onFragDecrypted=function(i,h){var n=h.frag;if(n.type===u.PlaylistLevelType.SUBTITLE){if(!Object(D.isFiniteNumber)(this.initPTS[n.cc])){this.unparsedVttFrags.push(h);return}this.onFragLoaded(y.Events.FRAG_LOADED,h)}},t.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},t.onFragParsingUserdata=function(i,h){var n=this.cea608Parser1,f=this.cea608Parser2;if(!(!this.enabled||!(n&&f)))for(var g=0;g<h.samples.length;g++){var T=h.samples[g].bytes;if(T){var p=this.extractCea608Data(T);n.addData(h.samples[g].pts,p[0]),f.addData(h.samples[g].pts,p[1])}}},t.onBufferFlushing=function(i,h){var n=h.startOffset,f=h.endOffset,g=h.endOffsetSubtitles,T=h.type,p=this.media;if(!(!p||p.currentTime<f)){if(!T||T==="video"){var o=this.captionsTracks;Object.keys(o).forEach(function(r){return Object(R.removeCuesInRange)(o[r],n,f)})}if(this.config.renderTextTracksNatively&&n===0&&g!==void 0){var s=this.textTracks;Object.keys(s).forEach(function(r){return Object(R.removeCuesInRange)(s[r],n,g)})}}},t.extractCea608Data=function(i){for(var h=i[0]&31,n=2,f=[[],[]],g=0;g<h;g++){var T=i[n++],p=127&i[n++],o=127&i[n++],s=(4&T)!=0,r=3&T;p===0&&o===0||s&&(r===0||r===1)&&(f[r].push(p),f[r].push(o))}return f},e}();function E(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function A(e,t,i,h){return Math.min(t,h)-Math.max(e,i)}function d(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return D});var D=function(){function y(I,L){this.subtle=void 0,this.aesIV=void 0,this.subtle=I,this.aesIV=L}var b=y.prototype;return b.decrypt=function(I,L){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},L,I)},y}()},"./src/crypt/aes-decryptor.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"removePadding",function(){return y}),a.d(w,"default",function(){return b});var D=a("./src/utils/typed-array.ts");function y(I){var L=I.byteLength,R=L&&new DataView(I.buffer).getUint8(L-1);return R?Object(D.sliceUint8)(I,0,L-R):I}var b=function(){function I(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var L=I.prototype;return L.uint8ArrayToUint32Array_=function(R){for(var _=new DataView(R),u=new Uint32Array(4),m=0;m<4;m++)u[m]=_.getUint32(m*4);return u},L.initTable=function(){var R=this.sBox,_=this.invSBox,u=this.subMix,m=u[0],S=u[1],E=u[2],A=u[3],d=this.invSubMix,e=d[0],t=d[1],i=d[2],h=d[3],n=new Uint32Array(256),f=0,g=0,T=0;for(T=0;T<256;T++)T<128?n[T]=T<<1:n[T]=T<<1^283;for(T=0;T<256;T++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^p&255^99,R[f]=p,_[p]=f;var o=n[f],s=n[o],r=n[s],c=n[p]*257^p*16843008;m[f]=c<<24|c>>>8,S[f]=c<<16|c>>>16,E[f]=c<<8|c>>>24,A[f]=c,c=r*16843009^s*65537^o*257^f*16843008,e[p]=c<<24|c>>>8,t[p]=c<<16|c>>>16,i[p]=c<<8|c>>>24,h[p]=c,f?(f=o^n[n[n[r^o]]],g^=n[n[g]]):f=g=1}},L.expandKey=function(R){for(var _=this.uint8ArrayToUint32Array_(R),u=!0,m=0;m<_.length&&u;)u=_[m]===this.key[m],m++;if(!u){this.key=_;var S=this.keySize=_.length;if(S!==4&&S!==6&&S!==8)throw new Error("Invalid aes key size="+S);var E=this.ksRows=(S+6+1)*4,A,d,e=this.keySchedule=new Uint32Array(E),t=this.invKeySchedule=new Uint32Array(E),i=this.sBox,h=this.rcon,n=this.invSubMix,f=n[0],g=n[1],T=n[2],p=n[3],o,s;for(A=0;A<E;A++){if(A<S){o=e[A]=_[A];continue}s=o,A%S==0?(s=s<<8|s>>>24,s=i[s>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[s&255],s^=h[A/S|0]<<24):S>6&&A%S==4&&(s=i[s>>>24]<<24|i[s>>>16&255]<<16|i[s>>>8&255]<<8|i[s&255]),e[A]=o=(e[A-S]^s)>>>0}for(d=0;d<E;d++)A=E-d,d&3?s=e[A]:s=e[A-4],d<4||A<=4?t[d]=s:t[d]=f[i[s>>>24]]^g[i[s>>>16&255]]^T[i[s>>>8&255]]^p[i[s&255]],t[d]=t[d]>>>0}},L.networkToHostOrderSwap=function(R){return R<<24|(R&65280)<<8|(R&16711680)>>8|R>>>24},L.decrypt=function(R,_,u){for(var m=this.keySize+6,S=this.invKeySchedule,E=this.invSBox,A=this.invSubMix,d=A[0],e=A[1],t=A[2],i=A[3],h=this.uint8ArrayToUint32Array_(u),n=h[0],f=h[1],g=h[2],T=h[3],p=new Int32Array(R),o=new Int32Array(p.length),s,r,c,l,k,x,C,P,N,B,F,U,H,G,j=this.networkToHostOrderSwap;_<p.length;){for(N=j(p[_]),B=j(p[_+1]),F=j(p[_+2]),U=j(p[_+3]),k=N^S[0],x=U^S[1],C=F^S[2],P=B^S[3],H=4,G=1;G<m;G++)s=d[k>>>24]^e[x>>16&255]^t[C>>8&255]^i[P&255]^S[H],r=d[x>>>24]^e[C>>16&255]^t[P>>8&255]^i[k&255]^S[H+1],c=d[C>>>24]^e[P>>16&255]^t[k>>8&255]^i[x&255]^S[H+2],l=d[P>>>24]^e[k>>16&255]^t[x>>8&255]^i[C&255]^S[H+3],k=s,x=r,C=c,P=l,H=H+4;s=E[k>>>24]<<24^E[x>>16&255]<<16^E[C>>8&255]<<8^E[P&255]^S[H],r=E[x>>>24]<<24^E[C>>16&255]<<16^E[P>>8&255]<<8^E[k&255]^S[H+1],c=E[C>>>24]<<24^E[P>>16&255]<<16^E[k>>8&255]<<8^E[x&255]^S[H+2],l=E[P>>>24]<<24^E[k>>16&255]<<16^E[x>>8&255]<<8^E[C&255]^S[H+3],o[_]=j(s^n),o[_+1]=j(l^f),o[_+2]=j(c^g),o[_+3]=j(r^T),n=N,f=B,g=F,T=U,_=_+4}return o.buffer},I}()},"./src/crypt/decrypter.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return u});var D=a("./src/crypt/aes-crypto.ts"),y=a("./src/crypt/fast-aes-key.ts"),b=a("./src/crypt/aes-decryptor.ts"),I=a("./src/utils/logger.ts"),L=a("./src/utils/mp4-tools.ts"),R=a("./src/utils/typed-array.ts"),_=16,u=function(){function m(E,A,d){var e=d===void 0?{}:d,t=e.removePKCS7Padding,i=t===void 0?!0:t;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=A,this.removePKCS7Padding=i,i)try{var h=self.crypto;h&&(this.subtle=h.subtle||h.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var S=m.prototype;return S.destroy=function(){this.observer=null},S.isSync=function(){return this.config.enableSoftwareAES},S.flush=function(){var E=this.currentResult;if(!E){this.reset();return}var A=new Uint8Array(E);return this.reset(),this.removePKCS7Padding?Object(b.removePadding)(A):A},S.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},S.decrypt=function(E,A,d,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(E),A,d);var t=this.flush();t&&e(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(E),A,d).then(e)},S.softwareDecrypt=function(E,A,d){var e=this.currentIV,t=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(E=Object(L.appendUint8Array)(i,E),this.remainderData=null);var h=this.getValidChunk(E);if(!h.length)return null;e&&(d=e);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new b.default),n.expandKey(A);var f=t;return this.currentResult=n.decrypt(h.buffer,0,d),this.currentIV=Object(R.sliceUint8)(h,-16).buffer,f||null},S.webCryptoDecrypt=function(E,A,d){var e=this,t=this.subtle;return(this.key!==A||!this.fastAesKey)&&(this.key=A,this.fastAesKey=new y.default(t,A)),this.fastAesKey.expandKey().then(function(i){if(!t)return Promise.reject(new Error("web crypto not initialized"));var h=new D.default(t,d);return h.decrypt(E.buffer,i)}).catch(function(i){return e.onWebCryptoError(i,E,A,d)})},S.onWebCryptoError=function(E,A,d,e){return I.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",E),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(A,d,e)},S.getValidChunk=function(E){var A=E,d=E.length-E.length%_;return d!==E.length&&(A=Object(R.sliceUint8)(E,0,d),this.remainderData=Object(R.sliceUint8)(E,d)),A},S.logOnce=function(E){!this.logEnabled||(I.logger.log("[decrypter.ts]: "+E),this.logEnabled=!1)},m}()},"./src/crypt/fast-aes-key.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return D});var D=function(){function y(I,L){this.subtle=void 0,this.key=void 0,this.subtle=I,this.key=L}var b=y.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},y}()},"./src/demux/aacdemuxer.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/demux/base-audio-demuxer.ts"),y=a("./src/demux/adts.ts"),b=a("./src/utils/logger.ts"),I=a("./src/demux/id3.ts");function L(u,m){u.prototype=Object.create(m.prototype),u.prototype.constructor=u,R(u,m)}function R(u,m){return R=Object.setPrototypeOf||function(S,E){return S.__proto__=E,S},R(u,m)}var _=function(u){L(m,u);function m(E,A){var d;return d=u.call(this)||this,d.observer=void 0,d.config=void 0,d.observer=E,d.config=A,d}var S=m.prototype;return S.resetInitSegment=function(E,A,d){u.prototype.resetInitSegment.call(this,E,A,d),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:E,duration:d,inputTimeScale:9e4,dropped:0}},m.probe=function(E){if(!E)return!1;for(var A=I.getID3Data(E,0)||[],d=A.length,e=E.length;d<e;d++)if(y.probe(E,d))return b.logger.log("ADTS sync word found !"),!0;return!1},S.canParse=function(E,A){return y.canParse(E,A)},S.appendFrame=function(E,A,d){y.initTrackConfig(E,this.observer,A,d,E.manifestCodec);var e=y.appendFrame(E,A,d,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},m}(D.default);_.minProbeByteLength=9,w.default=_},"./src/demux/adts.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"getAudioConfig",function(){return I}),a.d(w,"isHeaderPattern",function(){return L}),a.d(w,"getHeaderLength",function(){return R}),a.d(w,"getFullFrameLength",function(){return _}),a.d(w,"canGetFrameLength",function(){return u}),a.d(w,"isHeader",function(){return m}),a.d(w,"canParse",function(){return S}),a.d(w,"probe",function(){return E}),a.d(w,"initTrackConfig",function(){return A}),a.d(w,"getFrameDuration",function(){return d}),a.d(w,"parseFrameHeader",function(){return e}),a.d(w,"appendFrame",function(){return t});var D=a("./src/utils/logger.ts"),y=a("./src/errors.ts"),b=a("./src/events.ts");function I(i,h,n,f){var g,T,p,o,s=navigator.userAgent.toLowerCase(),r=f,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];g=((h[n+2]&192)>>>6)+1;var l=(h[n+2]&60)>>>2;if(l>c.length-1){i.trigger(b.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l});return}return p=(h[n+2]&1)<<2,p|=(h[n+3]&192)>>>6,D.logger.log("manifest codec:"+f+", ADTS type:"+g+", samplingIndex:"+l),/firefox/i.test(s)?l>=6?(g=5,o=new Array(4),T=l-3):(g=2,o=new Array(2),T=l):s.indexOf("android")!==-1?(g=2,o=new Array(2),T=l):(g=5,o=new Array(4),f&&(f.indexOf("mp4a.40.29")!==-1||f.indexOf("mp4a.40.5")!==-1)||!f&&l>=6?T=l-3:((f&&f.indexOf("mp4a.40.2")!==-1&&(l>=6&&p===1||/vivaldi/i.test(s))||!f&&p===1)&&(g=2,o=new Array(2)),T=l)),o[0]=g<<3,o[0]|=(l&14)>>1,o[1]|=(l&1)<<7,o[1]|=p<<3,g===5&&(o[1]|=(T&14)>>1,o[2]=(T&1)<<7,o[2]|=2<<2,o[3]=0),{config:o,samplerate:c[l],channelCount:p,codec:"mp4a.40."+g,manifestCodec:r}}function L(i,h){return i[h]===255&&(i[h+1]&246)==240}function R(i,h){return i[h+1]&1?7:9}function _(i,h){return(i[h+3]&3)<<11|i[h+4]<<3|(i[h+5]&224)>>>5}function u(i,h){return h+5<i.length}function m(i,h){return h+1<i.length&&L(i,h)}function S(i,h){return u(i,h)&&L(i,h)&&_(i,h)<=i.length-h}function E(i,h){if(m(i,h)){var n=R(i,h);if(h+n>=i.length)return!1;var f=_(i,h);if(f<=n)return!1;var g=h+f;return g===i.length||m(i,g)}return!1}function A(i,h,n,f,g){if(!i.samplerate){var T=I(h,n,f,g);if(!T)return;i.config=T.config,i.samplerate=T.samplerate,i.channelCount=T.channelCount,i.codec=T.codec,i.manifestCodec=T.manifestCodec,D.logger.log("parsed codec:"+i.codec+", rate:"+T.samplerate+", channels:"+T.channelCount)}}function d(i){return 1024*9e4/i}function e(i,h,n,f,g){var T=R(i,h),p=_(i,h);if(p-=T,p>0){var o=n+f*g;return{headerLength:T,frameLength:p,stamp:o}}}function t(i,h,n,f,g){var T=d(i.samplerate),p=e(h,n,f,g,T);if(p){var o=p.frameLength,s=p.headerLength,r=p.stamp,c=s+o,l=Math.max(0,n+c-h.length),k;l?(k=new Uint8Array(c-s),k.set(h.subarray(n+s,h.length),0)):k=h.subarray(n+s,n+c);var x={unit:k,pts:r};return l||i.samples.push(x),{sample:x,length:c,missing:l}}}},"./src/demux/base-audio-demuxer.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"initPTSFn",function(){return _});var D=a("./src/polyfills/number.ts"),y=a("./src/demux/id3.ts"),b=a("./src/demux/dummy-demuxed-track.ts"),I=a("./src/utils/mp4-tools.ts"),L=a("./src/utils/typed-array.ts"),R=function(){function u(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var m=u.prototype;return m.resetInitSegment=function(S,E,A){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},m.resetTimeStamp=function(){},m.resetContiguity=function(){},m.canParse=function(S,E){return!1},m.appendFrame=function(S,E,A){},m.demux=function(S,E){this.cachedData&&(S=Object(I.appendUint8Array)(this.cachedData,S),this.cachedData=null);var A=y.getID3Data(S,0),d=A?A.length:0,e,t,i=this._audioTrack,h=this._id3Track,n=A?y.getTimeStamp(A):void 0,f=S.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=_(n,E)),A&&A.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:A}),t=this.initPTS;d<f;){if(this.canParse(S,d)){var g=this.appendFrame(i,S,d);g?(this.frameIndex++,t=g.sample.pts,d+=g.length,e=d):d=f}else y.canParse(S,d)?(A=y.getID3Data(S,d),h.samples.push({pts:t,dts:t,data:A}),d+=A.length,e=d):d++;if(d===f&&e!==f){var T=Object(L.sliceUint8)(S,e);this.cachedData?this.cachedData=Object(I.appendUint8Array)(this.cachedData,T):this.cachedData=T}}return{audioTrack:i,avcTrack:Object(b.dummyTrack)(),id3Track:h,textTrack:Object(b.dummyTrack)()}},m.demuxSampleAes=function(S,E,A){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},m.flush=function(S){var E=this.cachedData;return E&&(this.cachedData=null,this.demux(E,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},m.destroy=function(){},u}(),_=function(u,m){return Object(D.isFiniteNumber)(u)?u*90:m*9e4};w.default=R},"./src/demux/chunk-cache.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return D});var D=function(){function b(){this.chunks=[],this.dataLength=0}var I=b.prototype;return I.push=function(L){this.chunks.push(L),this.dataLength+=L.length},I.flush=function(){var L=this.chunks,R=this.dataLength,_;if(L.length)L.length===1?_=L[0]:_=y(L,R);else return new Uint8Array(0);return this.reset(),_},I.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function y(b,I){for(var L=new Uint8Array(I),R=0,_=0;_<b.length;_++){var u=b[_];L.set(u,R),R+=u.length}return L}},"./src/demux/dummy-demuxed-track.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"dummyTrack",function(){return D});function D(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/utils/logger.ts"),y=function(){function b(L){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=L,this.bytesAvailable=L.byteLength,this.word=0,this.bitsAvailable=0}var I=b.prototype;return I.loadWord=function(){var L=this.data,R=this.bytesAvailable,_=L.byteLength-R,u=new Uint8Array(4),m=Math.min(4,R);if(m===0)throw new Error("no bytes available");u.set(L.subarray(_,_+m)),this.word=new DataView(u.buffer).getUint32(0),this.bitsAvailable=m*8,this.bytesAvailable-=m},I.skipBits=function(L){var R;this.bitsAvailable>L?(this.word<<=L,this.bitsAvailable-=L):(L-=this.bitsAvailable,R=L>>3,L-=R>>3,this.bytesAvailable-=R,this.loadWord(),this.word<<=L,this.bitsAvailable-=L)},I.readBits=function(L){var R=Math.min(this.bitsAvailable,L),_=this.word>>>32-R;return L>32&&D.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=R,this.bitsAvailable>0?this.word<<=R:this.bytesAvailable>0&&this.loadWord(),R=L-R,R>0&&this.bitsAvailable?_<<R|this.readBits(R):_},I.skipLZ=function(){var L;for(L=0;L<this.bitsAvailable;++L)if((this.word&2147483648>>>L)!=0)return this.word<<=L,this.bitsAvailable-=L,L;return this.loadWord(),L+this.skipLZ()},I.skipUEG=function(){this.skipBits(1+this.skipLZ())},I.skipEG=function(){this.skipBits(1+this.skipLZ())},I.readUEG=function(){var L=this.skipLZ();return this.readBits(L+1)-1},I.readEG=function(){var L=this.readUEG();return 1&L?1+L>>>1:-1*(L>>>1)},I.readBoolean=function(){return this.readBits(1)===1},I.readUByte=function(){return this.readBits(8)},I.readUShort=function(){return this.readBits(16)},I.readUInt=function(){return this.readBits(32)},I.skipScalingList=function(L){for(var R=8,_=8,u,m=0;m<L;m++)_!==0&&(u=this.readEG(),_=(R+u+256)%256),R=_===0?R:_},I.readSPS=function(){var L=0,R=0,_=0,u=0,m,S,E,A=this.readUByte.bind(this),d=this.readBits.bind(this),e=this.readUEG.bind(this),t=this.readBoolean.bind(this),i=this.skipBits.bind(this),h=this.skipEG.bind(this),n=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);A();var g=A();if(d(5),i(3),A(),n(),g===100||g===110||g===122||g===244||g===44||g===83||g===86||g===118||g===128){var T=e();if(T===3&&i(1),n(),n(),i(1),t())for(S=T!==3?8:12,E=0;E<S;E++)t()&&(E<6?f(16):f(64))}n();var p=e();if(p===0)e();else if(p===1)for(i(1),h(),h(),m=e(),E=0;E<m;E++)h();n(),i(1);var o=e(),s=e(),r=d(1);r===0&&i(1),i(1),t()&&(L=e(),R=e(),_=e(),u=e());var c=[1,1];if(t()&&t()){var l=A();switch(l){case 1:c=[1,1];break;case 2:c=[12,11];break;case 3:c=[10,11];break;case 4:c=[16,11];break;case 5:c=[40,33];break;case 6:c=[24,11];break;case 7:c=[20,11];break;case 8:c=[32,11];break;case 9:c=[80,33];break;case 10:c=[18,11];break;case 11:c=[15,11];break;case 12:c=[64,33];break;case 13:c=[160,99];break;case 14:c=[4,3];break;case 15:c=[3,2];break;case 16:c=[2,1];break;case 255:{c=[A()<<8|A(),A()<<8|A()];break}}}return{width:Math.ceil((o+1)*16-L*2-R*2),height:(2-r)*(s+1)*16-(r?2:4)*(_+u),pixelRatio:c}},I.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},b}();w.default=y},"./src/demux/id3.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"isHeader",function(){return D}),a.d(w,"isFooter",function(){return y}),a.d(w,"getID3Data",function(){return b}),a.d(w,"canParse",function(){return L}),a.d(w,"getTimeStamp",function(){return R}),a.d(w,"isTimeStampFrame",function(){return _}),a.d(w,"getID3Frames",function(){return m}),a.d(w,"decodeFrame",function(){return S}),a.d(w,"utf8ArrayToStr",function(){return t}),a.d(w,"testables",function(){return i});var D=function(f,g){return g+10<=f.length&&f[g]===73&&f[g+1]===68&&f[g+2]===51&&f[g+3]<255&&f[g+4]<255&&f[g+6]<128&&f[g+7]<128&&f[g+8]<128&&f[g+9]<128},y=function(f,g){return g+10<=f.length&&f[g]===51&&f[g+1]===68&&f[g+2]===73&&f[g+3]<255&&f[g+4]<255&&f[g+6]<128&&f[g+7]<128&&f[g+8]<128&&f[g+9]<128},b=function(f,g){for(var T=g,p=0;D(f,g);){p+=10;var o=I(f,g+6);p+=o,y(f,g+10)&&(p+=10),g+=p}if(p>0)return f.subarray(T,T+p)},I=function(f,g){var T=0;return T=(f[g]&127)<<21,T|=(f[g+1]&127)<<14,T|=(f[g+2]&127)<<7,T|=f[g+3]&127,T},L=function(f,g){return D(f,g)&&I(f,g+6)+10<=f.length-g},R=function(f){for(var g=m(f),T=0;T<g.length;T++){var p=g[T];if(_(p))return e(p)}},_=function(f){return f&&f.key==="PRIV"&&f.info==="com.apple.streaming.transportStreamTimestamp"},u=function(f){var g=String.fromCharCode(f[0],f[1],f[2],f[3]),T=I(f,4),p=10;return{type:g,size:T,data:f.subarray(p,p+T)}},m=function(f){for(var g=0,T=[];D(f,g);){var p=I(f,g+6);g+=10;for(var o=g+p;g+8<o;){var s=u(f.subarray(g)),r=S(s);r&&T.push(r),g+=s.size+10}y(f,g)&&(g+=10)}return T},S=function(f){return f.type==="PRIV"?E(f):f.type[0]==="W"?d(f):A(f)},E=function(f){if(!(f.size<2)){var g=t(f.data,!0),T=new Uint8Array(f.data.subarray(g.length+1));return{key:f.type,info:g,data:T.buffer}}},A=function(f){if(!(f.size<2)){if(f.type==="TXXX"){var g=1,T=t(f.data.subarray(g),!0);g+=T.length+1;var p=t(f.data.subarray(g));return{key:f.type,info:T,data:p}}var o=t(f.data.subarray(1));return{key:f.type,data:o}}},d=function(f){if(f.type==="WXXX"){if(f.size<2)return;var g=1,T=t(f.data.subarray(g),!0);g+=T.length+1;var p=t(f.data.subarray(g));return{key:f.type,info:T,data:p}}var o=t(f.data);return{key:f.type,data:o}},e=function(f){if(f.data.byteLength===8){var g=new Uint8Array(f.data),T=g[3]&1,p=(g[4]<<23)+(g[5]<<15)+(g[6]<<7)+g[7];return p/=45,T&&(p+=4772185884e-2),Math.round(p)}},t=function(f,g){g===void 0&&(g=!1);var T=n();if(T){var p=T.decode(f);if(g){var o=p.indexOf("\0");return o!==-1?p.substring(0,o):p}return p.replace(/\0/g,"")}for(var s=f.length,r,c,l,k="",x=0;x<s;){if(r=f[x++],r===0&&g)return k;if(!(r===0||r===3))switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:k+=String.fromCharCode(r);break;case 12:case 13:c=f[x++],k+=String.fromCharCode((r&31)<<6|c&63);break;case 14:c=f[x++],l=f[x++],k+=String.fromCharCode((r&15)<<12|(c&63)<<6|(l&63)<<0);break;default:}}return k},i={decodeTextFrame:A},h;function n(){return!h&&typeof self.TextDecoder!="undefined"&&(h=new self.TextDecoder("utf-8")),h}},"./src/demux/mp3demuxer.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/demux/base-audio-demuxer.ts"),y=a("./src/demux/id3.ts"),b=a("./src/utils/logger.ts"),I=a("./src/demux/mpegaudio.ts");function L(u,m){u.prototype=Object.create(m.prototype),u.prototype.constructor=u,R(u,m)}function R(u,m){return R=Object.setPrototypeOf||function(S,E){return S.__proto__=E,S},R(u,m)}var _=function(u){L(m,u);function m(){return u.apply(this,arguments)||this}var S=m.prototype;return S.resetInitSegment=function(E,A,d){u.prototype.resetInitSegment.call(this,E,A,d),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:E,duration:d,inputTimeScale:9e4,dropped:0}},m.probe=function(E){if(!E)return!1;for(var A=y.getID3Data(E,0)||[],d=A.length,e=E.length;d<e;d++)if(I.probe(E,d))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},S.canParse=function(E,A){return I.canParse(E,A)},S.appendFrame=function(E,A,d){if(this.initPTS!==null)return I.appendFrame(E,A,d,this.initPTS,this.frameIndex)},m}(D.default);_.minProbeByteLength=4,w.default=_},"./src/demux/mp4demuxer.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/utils/mp4-tools.ts"),y=a("./src/demux/dummy-demuxed-track.ts"),b=function(){function I(R,_){this.remainderData=null,this.config=void 0,this.config=_}var L=I.prototype;return L.resetTimeStamp=function(){},L.resetInitSegment=function(){},L.resetContiguity=function(){},I.probe=function(R){return Object(D.findBox)({data:R,start:0,end:Math.min(R.length,16384)},["moof"]).length>0},L.demux=function(R){var _=R,u=Object(y.dummyTrack)();if(this.config.progressive){this.remainderData&&(_=Object(D.appendUint8Array)(this.remainderData,R));var m=Object(D.segmentValidRange)(_);this.remainderData=m.remainder,u.samples=m.valid||new Uint8Array}else u.samples=_;return{audioTrack:Object(y.dummyTrack)(),avcTrack:u,id3Track:Object(y.dummyTrack)(),textTrack:Object(y.dummyTrack)()}},L.flush=function(){var R=Object(y.dummyTrack)();return R.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(y.dummyTrack)(),avcTrack:R,id3Track:Object(y.dummyTrack)(),textTrack:Object(y.dummyTrack)()}},L.demuxSampleAes=function(R,_,u){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},L.destroy=function(){},I}();b.minProbeByteLength=1024,w.default=b},"./src/demux/mpegaudio.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"appendFrame",function(){return R}),a.d(w,"parseHeader",function(){return _}),a.d(w,"isHeaderPattern",function(){return u}),a.d(w,"isHeader",function(){return m}),a.d(w,"canParse",function(){return S}),a.d(w,"probe",function(){return E});var D=null,y=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],I=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],L=[0,1,1,4];function R(A,d,e,t,i){if(!(e+24>d.length)){var h=_(d,e);if(h&&e+h.frameLength<=d.length){var n=h.samplesPerFrame*9e4/h.sampleRate,f=t+i*n,g={unit:d.subarray(e,e+h.frameLength),pts:f,dts:f};return A.config=[],A.channelCount=h.channelCount,A.samplerate=h.sampleRate,A.samples.push(g),{sample:g,length:h.frameLength,missing:0}}}}function _(A,d){var e=A[d+1]>>3&3,t=A[d+1]>>1&3,i=A[d+2]>>4&15,h=A[d+2]>>2&3;if(e!==1&&i!==0&&i!==15&&h!==3){var n=A[d+2]>>1&1,f=A[d+3]>>6,g=e===3?3-t:t===3?3:4,T=y[g*14+i-1]*1e3,p=e===3?0:e===2?1:2,o=b[p*3+h],s=f===3?1:2,r=I[e][t],c=L[t],l=r*8*c,k=Math.floor(r*T/o+n)*c;if(D===null){var x=navigator.userAgent||"",C=x.match(/Chrome\/(\d+)/i);D=C?parseInt(C[1]):0}var P=!!D&&D<=87;return P&&t===2&&T>=224e3&&f===0&&(A[d+3]=A[d+3]|128),{sampleRate:o,channelCount:s,frameLength:k,samplesPerFrame:l}}}function u(A,d){return A[d]===255&&(A[d+1]&224)==224&&(A[d+1]&6)!=0}function m(A,d){return d+1<A.length&&u(A,d)}function S(A,d){var e=4;return u(A,d)&&e<=A.length-d}function E(A,d){if(d+1<A.length&&u(A,d)){var e=4,t=_(A,d),i=e;t!=null&&t.frameLength&&(i=t.frameLength);var h=d+i;return h===A.length||m(A,h)}return!1}},"./src/demux/sample-aes.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/crypt/decrypter.ts"),y=a("./src/demux/tsdemuxer.ts"),b=function(){function I(R,_,u){this.keyData=void 0,this.decrypter=void 0,this.keyData=u,this.decrypter=new D.default(R,_,{removePKCS7Padding:!1})}var L=I.prototype;return L.decryptBuffer=function(R,_){this.decrypter.decrypt(R,this.keyData.key.buffer,this.keyData.iv.buffer,_)},L.decryptAacSample=function(R,_,u,m){var S=R[_].unit,E=S.subarray(16,S.length-S.length%16),A=E.buffer.slice(E.byteOffset,E.byteOffset+E.length),d=this;this.decryptBuffer(A,function(e){var t=new Uint8Array(e);S.set(t,16),m||d.decryptAacSamples(R,_+1,u)})},L.decryptAacSamples=function(R,_,u){for(;;_++){if(_>=R.length){u();return}if(!(R[_].unit.length<32)){var m=this.decrypter.isSync();if(this.decryptAacSample(R,_,u,m),!m)return}}},L.getAvcEncryptedData=function(R){for(var _=Math.floor((R.length-48)/160)*16+16,u=new Int8Array(_),m=0,S=32;S<=R.length-16;S+=160,m+=16)u.set(R.subarray(S,S+16),m);return u},L.getAvcDecryptedUnit=function(R,_){for(var u=new Uint8Array(_),m=0,S=32;S<=R.length-16;S+=160,m+=16)R.set(u.subarray(m,m+16),S);return R},L.decryptAvcSample=function(R,_,u,m,S,E){var A=Object(y.discardEPB)(S.data),d=this.getAvcEncryptedData(A),e=this;this.decryptBuffer(d.buffer,function(t){S.data=e.getAvcDecryptedUnit(A,t),E||e.decryptAvcSamples(R,_,u+1,m)})},L.decryptAvcSamples=function(R,_,u,m){if(R instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;_++,u=0){if(_>=R.length){m();return}for(var S=R[_].units;!(u>=S.length);u++){var E=S[u];if(!(E.data.length<=48||E.type!==1&&E.type!==5)){var A=this.decrypter.isSync();if(this.decryptAvcSample(R,_,u,m,E,A),!A)return}}}},I}();w.default=b},"./src/demux/transmuxer-interface.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return E});var D=a("./node_modules/webworkify-webpack/index.js"),y=a.n(D),b=a("./src/events.ts"),I=a("./src/demux/transmuxer.ts"),L=a("./src/utils/logger.ts"),R=a("./src/errors.ts"),_=a("./src/utils/mediasource-helper.ts"),u=a("./node_modules/eventemitter3/index.js"),m=a.n(u),S=Object(_.getMediaSource)()||{isTypeSupported:function(){return!1}},E=function(){function A(e,t,i,h){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=e,this.id=t,this.onTransmuxComplete=i,this.onFlush=h;var f=e.config,g=function(s,r){r=r||{},r.frag=n.frag,r.id=n.id,e.trigger(s,r)};this.observer=new u.EventEmitter,this.observer.on(b.Events.FRAG_DECRYPTED,g),this.observer.on(b.Events.ERROR,g);var T={mp4:S.isTypeSupported("video/mp4"),mpeg:S.isTypeSupported("audio/mpeg"),mp3:S.isTypeSupported('audio/mp4; codecs="mp3"')},p=navigator.vendor;if(f.enableWorker&&typeof Worker!="undefined"){L.logger.log("demuxing in webworker");var o;try{o=this.worker=D("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(s){e.trigger(b.Events.ERROR,{type:R.ErrorTypes.OTHER_ERROR,details:R.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(s.message+"  ("+s.filename+":"+s.lineno+")")})},o.postMessage({cmd:"init",typeSupported:T,vendor:p,id:t,config:JSON.stringify(f)})}catch(s){L.logger.warn("Error in worker:",s),L.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new I.default(this.observer,T,f,p,t),this.worker=null}}else this.transmuxer=new I.default(this.observer,T,f,p,t)}var d=A.prototype;return d.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.observer=null},d.push=function(e,t,i,h,n,f,g,T,p,o){var s=this;p.transmuxing.start=self.performance.now();var r=this.transmuxer,c=this.worker,l=f?f.start:n.start,k=n.decryptdata,x=this.frag,C=!(x&&n.cc===x.cc),P=!(x&&p.level===x.level),N=x?p.sn-x.sn:-1,B=this.part?p.part-this.part.index:1,F=!P&&(N===1||N===0&&B===1),U=self.performance.now();(P||N||n.stats.parsing.start===0)&&(n.stats.parsing.start=U),f&&(B||!F)&&(f.stats.parsing.start=U);var H=new I.TransmuxState(C,F,T,P,l);if(!F||C){L.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+p.sn+" p: "+p.part+" level: "+p.level+" id: "+p.id+`
        discontinuity: `+C+`
        trackSwitch: `+P+`
        contiguous: `+F+`
        accurateTimeOffset: `+T+`
        timeOffset: `+l);var G=new I.TransmuxConfig(i,h,t,g,o);this.configureTransmuxer(G)}if(this.frag=n,this.part=f,c)c.postMessage({cmd:"demux",data:e,decryptdata:k,chunkMeta:p,state:H},e instanceof ArrayBuffer?[e]:[]);else if(r){var j=r.push(e,k,p,H);Object(I.isPromise)(j)?j.then(function(V){s.handleTransmuxComplete(V)}):this.handleTransmuxComplete(j)}},d.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer,h=this.worker;if(h)h.postMessage({cmd:"flush",chunkMeta:e});else if(i){var n=i.flush(e);Object(I.isPromise)(n)?n.then(function(f){t.handleFlushResult(f,e)}):this.handleFlushResult(n,e)}},d.handleFlushResult=function(e,t){var i=this;e.forEach(function(h){i.handleTransmuxComplete(h)}),this.onFlush(t)},d.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data);break}}},d.configureTransmuxer=function(e){var t=this.worker,i=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):i&&i.configure(e)},d.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},A}()},"./src/demux/transmuxer-worker.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return R});var D=a("./src/demux/transmuxer.ts"),y=a("./src/events.ts"),b=a("./src/utils/logger.ts"),I=a("./node_modules/eventemitter3/index.js"),L=a.n(I);function R(E){var A=new I.EventEmitter,d=function(e,t){E.postMessage({event:e,data:t})};A.on(y.Events.FRAG_DECRYPTED,d),A.on(y.Events.ERROR,d),E.addEventListener("message",function(e){var t=e.data;switch(t.cmd){case"init":{var i=JSON.parse(t.config);E.transmuxer=new D.default(A,t.typeSupported,i,t.vendor,t.id),Object(b.enableLogs)(i.debug),d("init",null);break}case"configure":{E.transmuxer.configure(t.config);break}case"demux":{var h=E.transmuxer.push(t.data,t.decryptdata,t.chunkMeta,t.state);Object(D.isPromise)(h)?h.then(function(g){_(E,g)}):_(E,h);break}case"flush":{var n=t.chunkMeta,f=E.transmuxer.flush(n);Object(D.isPromise)(f)?f.then(function(g){m(E,g,n)}):m(E,f,n);break}default:break}})}function _(E,A){if(!S(A.remuxResult)){var d=[],e=A.remuxResult,t=e.audio,i=e.video;t&&u(d,t),i&&u(d,i),E.postMessage({event:"transmuxComplete",data:A},d)}}function u(E,A){A.data1&&E.push(A.data1.buffer),A.data2&&E.push(A.data2.buffer)}function m(E,A,d){A.forEach(function(e){_(E,e)}),E.postMessage({event:"flush",data:d})}function S(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return i}),a.d(w,"isPromise",function(){return f}),a.d(w,"TransmuxConfig",function(){return g}),a.d(w,"TransmuxState",function(){return T});var D=a("./src/events.ts"),y=a("./src/errors.ts"),b=a("./src/crypt/decrypter.ts"),I=a("./src/demux/aacdemuxer.ts"),L=a("./src/demux/mp4demuxer.ts"),R=a("./src/demux/tsdemuxer.ts"),_=a("./src/demux/mp3demuxer.ts"),u=a("./src/remux/mp4-remuxer.ts"),m=a("./src/remux/passthrough-remuxer.ts"),S=a("./src/demux/chunk-cache.ts"),E=a("./src/utils/mp4-tools.ts"),A=a("./src/utils/logger.ts"),d;try{d=self.performance.now.bind(self.performance)}catch{A.logger.debug("Unable to use Performance API on this environment"),d=self.Date.now}var e=[{demux:R.default,remux:u.default},{demux:L.default,remux:m.default},{demux:I.default,remux:u.default},{demux:_.default,remux:u.default}],t=1024;e.forEach(function(p){var o=p.demux;t=Math.max(t,o.minProbeByteLength)});var i=function(){function p(s,r,c,l,k){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new S.default,this.observer=s,this.typeSupported=r,this.config=c,this.vendor=l,this.id=k}var o=p.prototype;return o.configure=function(s){this.transmuxConfig=s,this.decrypter&&this.decrypter.reset()},o.push=function(s,r,c,l){var k=this,x=c.transmuxing;x.executeStart=d();var C=new Uint8Array(s),P=this.cache,N=this.config,B=this.currentTransmuxState,F=this.transmuxConfig;l&&(this.currentTransmuxState=l);var U=h(C,r);if(U&&U.method==="AES-128"){var H=this.getDecrypter();if(N.enableSoftwareAES){var G=H.softwareDecrypt(C,U.key.buffer,U.iv.buffer);if(!G)return x.executeEnd=d(),n(c);C=new Uint8Array(G)}else return this.decryptionPromise=H.webCryptoDecrypt(C,U.key.buffer,U.iv.buffer).then(function(z){var oe=k.push(z,null,c);return k.decryptionPromise=null,oe}),this.decryptionPromise}var j=l||B,V=j.contiguous,q=j.discontinuity,W=j.trackSwitch,Y=j.accurateTimeOffset,$=j.timeOffset,Z=F.audioCodec,te=F.videoCodec,ie=F.defaultInitPts,ve=F.duration,ae=F.initSegmentData;if((q||W)&&this.resetInitSegment(ae,Z,te,ve),q&&this.resetInitialTimestamp(ie),V||this.resetContiguity(),this.needsProbing(C,q,W)){if(P.dataLength){var re=P.flush();C=Object(E.appendUint8Array)(re,C)}this.configureTransmuxer(C,F)}var Q=this.transmux(C,U,$,Y,c),X=this.currentTransmuxState;return X.contiguous=!0,X.discontinuity=!1,X.trackSwitch=!1,x.executeEnd=d(),Q},o.flush=function(s){var r=this,c=s.transmuxing;c.executeStart=d();var l=this.decrypter,k=this.cache,x=this.currentTransmuxState,C=this.decryptionPromise;if(C)return C.then(function(){return r.flush(s)});var P=[],N=x.timeOffset;if(l){var B=l.flush();B&&P.push(this.push(B,null,s))}var F=k.dataLength;k.reset();var U=this.demuxer,H=this.remuxer;if(!U||!H)return F>=t&&this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),c.executeEnd=d(),[n(s)];var G=U.flush(N);return f(G)?G.then(function(j){return r.flushRemux(P,j,s),P}):(this.flushRemux(P,G,s),P)},o.flushRemux=function(s,r,c){var l=r.audioTrack,k=r.avcTrack,x=r.id3Track,C=r.textTrack,P=this.currentTransmuxState,N=P.accurateTimeOffset,B=P.timeOffset;A.logger.log("[transmuxer.ts]: Flushed fragment "+c.sn+(c.part>-1?" p: "+c.part:"")+" of level "+c.level);var F=this.remuxer.remux(l,k,x,C,B,N,!0,this.id);s.push({remuxResult:F,chunkMeta:c}),c.transmuxing.executeEnd=d()},o.resetInitialTimestamp=function(s){var r=this.demuxer,c=this.remuxer;!r||!c||(r.resetTimeStamp(s),c.resetTimeStamp(s))},o.resetContiguity=function(){var s=this.demuxer,r=this.remuxer;!s||!r||(s.resetContiguity(),r.resetNextTimestamp())},o.resetInitSegment=function(s,r,c,l){var k=this.demuxer,x=this.remuxer;!k||!x||(k.resetInitSegment(r,c,l),x.resetInitSegment(s,r,c))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(s,r,c,l,k){var x;return r&&r.method==="SAMPLE-AES"?x=this.transmuxSampleAes(s,r,c,l,k):x=this.transmuxUnencrypted(s,c,l,k),x},o.transmuxUnencrypted=function(s,r,c,l){var k=this.demuxer.demux(s,r,!1,!this.config.progressive),x=k.audioTrack,C=k.avcTrack,P=k.id3Track,N=k.textTrack,B=this.remuxer.remux(x,C,P,N,r,c,!1,this.id);return{remuxResult:B,chunkMeta:l}},o.transmuxSampleAes=function(s,r,c,l,k){var x=this;return this.demuxer.demuxSampleAes(s,r,c).then(function(C){var P=x.remuxer.remux(C.audioTrack,C.avcTrack,C.id3Track,C.textTrack,c,l,!1,x.id);return{remuxResult:P,chunkMeta:k}})},o.configureTransmuxer=function(s,r){for(var c=this.config,l=this.observer,k=this.typeSupported,x=this.vendor,C=r.audioCodec,P=r.defaultInitPts,N=r.duration,B=r.initSegmentData,F=r.videoCodec,U,H=0,G=e.length;H<G;H++)if(e[H].demux.probe(s)){U=e[H];break}U||(A.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),U={demux:L.default,remux:m.default});var j=this.demuxer,V=this.remuxer,q=U.remux,W=U.demux;(!V||!(V instanceof q))&&(this.remuxer=new q(l,c,k,x)),(!j||!(j instanceof W))&&(this.demuxer=new W(l,c,k),this.probe=W.probe),this.resetInitSegment(B,C,F,N),this.resetInitialTimestamp(P)},o.needsProbing=function(s,r,c){return!this.demuxer||!this.remuxer||r||c},o.getDecrypter=function(){var s=this.decrypter;return s||(s=this.decrypter=new b.default(this.observer,this.config)),s},p}();function h(p,o){var s=null;return p.byteLength>0&&o!=null&&o.key!=null&&o.iv!==null&&o.method!=null&&(s=o),s}var n=function(p){return{remuxResult:{},chunkMeta:p}};function f(p){return"then"in p&&p.then instanceof Function}var g=function(p,o,s,r,c){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=p,this.videoCodec=o,this.initSegmentData=s,this.duration=r,this.defaultInitPts=c},T=function(p,o,s,r,c){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=p,this.contiguous=o,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=c}},"./src/demux/tsdemuxer.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"discardEPB",function(){return n});var D=a("./src/demux/adts.ts"),y=a("./src/demux/mpegaudio.ts"),b=a("./src/demux/exp-golomb.ts"),I=a("./src/demux/id3.ts"),L=a("./src/demux/sample-aes.ts"),R=a("./src/events.ts"),_=a("./src/utils/mp4-tools.ts"),u=a("./src/utils/logger.ts"),m=a("./src/errors.ts"),S={video:1,audio:2,id3:3,text:4},E=function(){function f(T,p,o){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=T,this.config=p,this.typeSupported=o}f.probe=function(T){var p=f.syncOffset(T);return p<0?!1:(p&&u.logger.warn("MPEG2-TS detected but first sync word found @ offset "+p+", junk ahead ?"),!0)},f.syncOffset=function(T){for(var p=Math.min(1e3,T.length-3*188),o=0;o<p;){if(T[o]===71&&T[o+188]===71&&T[o+2*188]===71)return o;o++}return-1},f.createTrack=function(T,p){return{container:T==="video"||T==="audio"?"video/mp2t":void 0,type:T,id:S[T],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:T==="audio"?p:void 0}};var g=f.prototype;return g.resetInitSegment=function(T,p,o){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=f.createTrack("video",o),this._audioTrack=f.createTrack("audio",o),this._id3Track=f.createTrack("id3",o),this._txtTrack=f.createTrack("text",o),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=T,this.videoCodec=p,this._duration=o},g.resetTimeStamp=function(){},g.resetContiguity=function(){var T=this._audioTrack,p=this._avcTrack,o=this._id3Track;T&&(T.pesData=null),p&&(p.pesData=null),o&&(o.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},g.demux=function(T,p,o,s){o===void 0&&(o=!1),s===void 0&&(s=!1),o||(this.sampleAes=null);var r,c=this._avcTrack,l=this._audioTrack,k=this._id3Track,x=c.pid,C=c.pesData,P=l.pid,N=k.pid,B=l.pesData,F=k.pesData,U=!1,H=this.pmtParsed,G=this._pmtId,j=T.length;if(this.remainderData&&(T=Object(_.appendUint8Array)(this.remainderData,T),j=T.length,this.remainderData=null),j<188&&!s)return this.remainderData=T,{audioTrack:l,avcTrack:c,id3Track:k,textTrack:this._txtTrack};var V=Math.max(0,f.syncOffset(T));j-=(j+V)%188,j<T.byteLength&&!s&&(this.remainderData=new Uint8Array(T.buffer,j,T.buffer.byteLength-j));for(var q=V;q<j;q+=188)if(T[q]===71){var W=!!(T[q+1]&64),Y=((T[q+1]&31)<<8)+T[q+2],$=(T[q+3]&48)>>4,Z=void 0;if($>1){if(Z=q+5+T[q+4],Z===q+188)continue}else Z=q+4;switch(Y){case x:W&&(C&&(r=t(C))&&this.parseAVCPES(r,!1),C={data:[],size:0}),C&&(C.data.push(T.subarray(Z,q+188)),C.size+=q+188-Z);break;case P:W&&(B&&(r=t(B))&&(l.isAAC?this.parseAACPES(r):this.parseMPEGPES(r)),B={data:[],size:0}),B&&(B.data.push(T.subarray(Z,q+188)),B.size+=q+188-Z);break;case N:W&&(F&&(r=t(F))&&this.parseID3PES(r),F={data:[],size:0}),F&&(F.data.push(T.subarray(Z,q+188)),F.size+=q+188-Z);break;case 0:W&&(Z+=T[Z]+1),G=this._pmtId=d(T,Z);break;case G:{W&&(Z+=T[Z]+1);var te=e(T,Z,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,o);x=te.avc,x>0&&(c.pid=x),P=te.audio,P>0&&(l.pid=P,l.isAAC=te.isAAC),N=te.id3,N>0&&(k.pid=N),U&&!H&&(u.logger.log("reparse from beginning"),U=!1,q=V-188),H=this.pmtParsed=!0;break}case 17:case 8191:break;default:U=!0;break}}else this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});c.pesData=C,l.pesData=B,k.pesData=F;var ie={audioTrack:l,avcTrack:c,id3Track:k,textTrack:this._txtTrack};return s&&this.extractRemainingSamples(ie),ie},g.flush=function(){var T=this.remainderData;this.remainderData=null;var p;return T?p=this.demux(T,-1,!1,!0):p={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(p),this.sampleAes?this.decrypt(p,this.sampleAes):p},g.extractRemainingSamples=function(T){var p=T.audioTrack,o=T.avcTrack,s=T.id3Track,r=o.pesData,c=p.pesData,l=s.pesData,k;r&&(k=t(r))?(this.parseAVCPES(k,!0),o.pesData=null):o.pesData=r,c&&(k=t(c))?(p.isAAC?this.parseAACPES(k):this.parseMPEGPES(k),p.pesData=null):(c!=null&&c.size&&u.logger.log("last AAC PES packet truncated,might overlap between fragments"),p.pesData=c),l&&(k=t(l))?(this.parseID3PES(k),s.pesData=null):s.pesData=l},g.demuxSampleAes=function(T,p,o){var s=this.demux(T,o,!0,!this.config.progressive),r=this.sampleAes=new L.default(this.observer,this.config,p);return this.decrypt(s,r)},g.decrypt=function(T,p){return new Promise(function(o){var s=T.audioTrack,r=T.avcTrack;s.samples&&s.isAAC?p.decryptAacSamples(s.samples,0,function(){r.samples?p.decryptAvcSamples(r.samples,0,0,function(){o(T)}):o(T)}):r.samples&&p.decryptAvcSamples(r.samples,0,0,function(){o(T)})})},g.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},g.parseAVCPES=function(T,p){var o=this,s=this._avcTrack,r=this.parseAVCNALu(T.data),c=!1,l=this.avcSample,k,x=!1;T.data=null,l&&r.length&&!s.audFound&&(i(l,s),l=this.avcSample=A(!1,T.pts,T.dts,"")),r.forEach(function(C){switch(C.type){case 1:{k=!0,l||(l=o.avcSample=A(!0,T.pts,T.dts,"")),c&&(l.debug+="NDR "),l.frame=!0;var P=C.data;if(x&&P.length>4){var N=new b.default(P).readSliceType();(N===2||N===4||N===7||N===9)&&(l.key=!0)}break}case 5:k=!0,l||(l=o.avcSample=A(!0,T.pts,T.dts,"")),c&&(l.debug+="IDR "),l.key=!0,l.frame=!0;break;case 6:{k=!0,c&&l&&(l.debug+="SEI ");var B=new b.default(n(C.data));B.readUByte();for(var F=0,U=0,H=!1,G=0;!H&&B.bytesAvailable>1;){F=0;do G=B.readUByte(),F+=G;while(G===255);U=0;do G=B.readUByte(),U+=G;while(G===255);if(F===4&&B.bytesAvailable!==0){H=!0;var j=B.readUByte();if(j===181){var V=B.readUShort();if(V===49){var q=B.readUInt();if(q===1195456820){var W=B.readUByte();if(W===3){for(var Y=B.readUByte(),$=B.readUByte(),Z=31&Y,te=[Y,$],ie=0;ie<Z;ie++)te.push(B.readUByte()),te.push(B.readUByte()),te.push(B.readUByte());h(o._txtTrack.samples,{type:3,pts:T.pts,bytes:te})}}}}}else if(F===5&&B.bytesAvailable!==0){if(H=!0,U>16){for(var ve=[],ae=0;ae<16;ae++)ve.push(B.readUByte().toString(16)),(ae===3||ae===5||ae===7||ae===9)&&ve.push("-");for(var re=U-16,Q=new Uint8Array(re),X=0;X<re;X++)Q[X]=B.readUByte();h(o._txtTrack.samples,{pts:T.pts,payloadType:F,uuid:ve.join(""),userData:Object(I.utf8ArrayToStr)(Q),userDataBytes:Q})}}else if(U<B.bytesAvailable)for(var z=0;z<U;z++)B.readUByte()}break}case 7:if(k=!0,x=!0,c&&l&&(l.debug+="SPS "),!s.sps){var oe=new b.default(C.data),he=oe.readSPS();s.width=he.width,s.height=he.height,s.pixelRatio=he.pixelRatio,s.sps=[C.data],s.duration=o._duration;for(var fe=C.data.subarray(1,4),ge="avc1.",de=0;de<3;de++){var pe=fe[de].toString(16);pe.length<2&&(pe="0"+pe),ge+=pe}s.codec=ge}break;case 8:k=!0,c&&l&&(l.debug+="PPS "),s.pps||(s.pps=[C.data]);break;case 9:k=!1,s.audFound=!0,l&&i(l,s),l=o.avcSample=A(!1,T.pts,T.dts,c?"AUD ":"");break;case 12:k=!1;break;default:k=!1,l&&(l.debug+="unknown NAL "+C.type+" ");break}if(l&&k){var se=l.units;se.push(C)}}),p&&l&&(i(l,s),this.avcSample=null)},g.getLastNalUnit=function(){var T,p=this.avcSample,o;if(!p||p.units.length===0){var s=this._avcTrack.samples;p=s[s.length-1]}if((T=p)!==null&&T!==void 0&&T.units){var r=p.units;o=r[r.length-1]}return o},g.parseAVCNALu=function(T){var p=T.byteLength,o=this._avcTrack,s=o.naluState||0,r=s,c=[],l=0,k,x,C,P=-1,N=0;for(s===-1&&(P=0,N=T[0]&31,s=0,l=1);l<p;){if(k=T[l++],!s){s=k?0:1;continue}if(s===1){s=k?0:2;continue}if(!k)s=3;else if(k===1){if(P>=0){var B={data:T.subarray(P,l-s-1),type:N};c.push(B)}else{var F=this.getLastNalUnit();if(F&&(r&&l<=4-r&&F.state&&(F.data=F.data.subarray(0,F.data.byteLength-r)),x=l-s-1,x>0)){var U=new Uint8Array(F.data.byteLength+x);U.set(F.data,0),U.set(T.subarray(0,x),F.data.byteLength),F.data=U}}l<p?(C=T[l]&31,P=l,N=C,s=0):s=-1}else s=0}if(P>=0&&s>=0){var H={data:T.subarray(P,p),type:N,state:s};c.push(H)}if(c.length===0){var G=this.getLastNalUnit();if(G){var j=new Uint8Array(G.data.byteLength+T.byteLength);j.set(G.data,0),j.set(T,G.data.byteLength),G.data=j}}return o.naluState=s,c},g.parseAACPES=function(T){var p=0,o=this._audioTrack,s=this.aacOverFlow,r=T.data;if(s){this.aacOverFlow=null;var c=s.sample.unit.byteLength,l=Math.min(s.missing,c),k=c-l;s.sample.unit.set(r.subarray(0,l),k),o.samples.push(s.sample),p=s.missing}var x,C;for(x=p,C=r.length;x<C-1&&!D.isHeader(r,x);x++);if(x!==p){var P,N;if(x<C-1?(P="AAC PES did not start with ADTS header,offset:"+x,N=!1):(P="no ADTS header found in AAC PES",N=!0),u.logger.warn("parsing error:"+P),this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.FRAG_PARSING_ERROR,fatal:N,reason:P}),N)return}D.initTrackConfig(o,this.observer,r,x,this.audioCodec);var B;if(T.pts!==void 0)B=T.pts;else if(s){var F=D.getFrameDuration(o.samplerate);B=s.sample.pts+F}else{u.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var U=0;x<C;)if(D.isHeader(r,x)){if(x+5<C){var H=D.appendFrame(o,r,x,B,U);if(H)if(H.missing)this.aacOverFlow=H;else{x+=H.length,U++;continue}}break}else x++},g.parseMPEGPES=function(T){var p=T.data,o=p.length,s=0,r=0,c=T.pts;if(c===void 0){u.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;r<o;)if(y.isHeader(p,r)){var l=y.appendFrame(this._audioTrack,p,r,c,s);if(l)r+=l.length,s++;else break}else r++},g.parseID3PES=function(T){if(T.pts===void 0){u.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(T)},f}();E.minProbeByteLength=188;function A(f,g,T,p){return{key:f,frame:!1,pts:g,dts:T,units:[],debug:p,length:0}}function d(f,g){return(f[g+10]&31)<<8|f[g+11]}function e(f,g,T,p){var o={audio:-1,avc:-1,id3:-1,isAAC:!0},s=(f[g+1]&15)<<8|f[g+2],r=g+3+s-4,c=(f[g+10]&15)<<8|f[g+11];for(g+=12+c;g<r;){var l=(f[g+1]&31)<<8|f[g+2];switch(f[g]){case 207:if(!p){u.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:o.audio===-1&&(o.audio=l);break;case 21:o.id3===-1&&(o.id3=l);break;case 219:if(!p){u.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:o.avc===-1&&(o.avc=l);break;case 3:case 4:T?o.audio===-1&&(o.audio=l,o.isAAC=!1):u.logger.log("MPEG audio found, not supported in this browser");break;case 36:u.logger.warn("Unsupported HEVC stream type found");break;default:break}g+=((f[g+3]&15)<<8|f[g+4])+5}return o}function t(f){var g=0,T,p,o,s,r,c=f.data;if(!f||f.size===0)return null;for(;c[0].length<19&&c.length>1;){var l=new Uint8Array(c[0].length+c[1].length);l.set(c[0]),l.set(c[1],c[0].length),c[0]=l,c.splice(1,1)}T=c[0];var k=(T[0]<<16)+(T[1]<<8)+T[2];if(k===1){if(p=(T[4]<<8)+T[5],p&&p>f.size-6)return null;var x=T[7];x&192&&(s=(T[9]&14)*536870912+(T[10]&255)*4194304+(T[11]&254)*16384+(T[12]&255)*128+(T[13]&254)/2,x&64?(r=(T[14]&14)*536870912+(T[15]&255)*4194304+(T[16]&254)*16384+(T[17]&255)*128+(T[18]&254)/2,s-r>60*9e4&&(u.logger.warn(Math.round((s-r)/9e4)+"s delta between PTS and DTS, align them"),s=r)):r=s),o=T[8];var C=o+9;if(f.size<=C)return null;f.size-=C;for(var P=new Uint8Array(f.size),N=0,B=c.length;N<B;N++){T=c[N];var F=T.byteLength;if(C)if(C>F){C-=F;continue}else T=T.subarray(C),F-=C,C=0;P.set(T,g),g+=F}return p&&(p-=o+3),{data:P,pts:s,dts:r,len:p}}return null}function i(f,g){if(f.units.length&&f.frame){if(f.pts===void 0){var T=g.samples,p=T.length;if(p){var o=T[p-1];f.pts=o.pts,f.dts=o.dts}else{g.dropped++;return}}g.samples.push(f)}f.debug.length&&u.logger.log(f.pts+"/"+f.dts+":"+f.debug)}function h(f,g){var T=f.length;if(T>0){if(g.pts>=f[T-1].pts)f.push(g);else for(var p=T-1;p>=0;p--)if(g.pts<f[p].pts){f.splice(p,0,g);break}}else f.push(g)}function n(f){for(var g=f.byteLength,T=[],p=1;p<g-2;)f[p]===0&&f[p+1]===0&&f[p+2]===3?(T.push(p+2),p+=2):p++;if(T.length===0)return f;var o=g-T.length,s=new Uint8Array(o),r=0;for(p=0;p<o;r++,p++)r===T[0]&&(r++,T.shift()),s[p]=f[r];return s}w.default=E},"./src/errors.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"ErrorTypes",function(){return D}),a.d(w,"ErrorDetails",function(){return y});var D;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(D||(D={}));var y;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(y||(y={}))},"./src/events.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"Events",function(){return D});var D;(function(y){y.MEDIA_ATTACHING="hlsMediaAttaching",y.MEDIA_ATTACHED="hlsMediaAttached",y.MEDIA_DETACHING="hlsMediaDetaching",y.MEDIA_DETACHED="hlsMediaDetached",y.BUFFER_RESET="hlsBufferReset",y.BUFFER_CODECS="hlsBufferCodecs",y.BUFFER_CREATED="hlsBufferCreated",y.BUFFER_APPENDING="hlsBufferAppending",y.BUFFER_APPENDED="hlsBufferAppended",y.BUFFER_EOS="hlsBufferEos",y.BUFFER_FLUSHING="hlsBufferFlushing",y.BUFFER_FLUSHED="hlsBufferFlushed",y.MANIFEST_LOADING="hlsManifestLoading",y.MANIFEST_LOADED="hlsManifestLoaded",y.MANIFEST_PARSED="hlsManifestParsed",y.LEVEL_SWITCHING="hlsLevelSwitching",y.LEVEL_SWITCHED="hlsLevelSwitched",y.LEVEL_LOADING="hlsLevelLoading",y.LEVEL_LOADED="hlsLevelLoaded",y.LEVEL_UPDATED="hlsLevelUpdated",y.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",y.LEVELS_UPDATED="hlsLevelsUpdated",y.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",y.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",y.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",y.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",y.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",y.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",y.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",y.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",y.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",y.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",y.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",y.CUES_PARSED="hlsCuesParsed",y.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",y.INIT_PTS_FOUND="hlsInitPtsFound",y.FRAG_LOADING="hlsFragLoading",y.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",y.FRAG_LOADED="hlsFragLoaded",y.FRAG_DECRYPTED="hlsFragDecrypted",y.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",y.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",y.FRAG_PARSING_METADATA="hlsFragParsingMetadata",y.FRAG_PARSED="hlsFragParsed",y.FRAG_BUFFERED="hlsFragBuffered",y.FRAG_CHANGED="hlsFragChanged",y.FPS_DROP="hlsFpsDrop",y.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",y.ERROR="hlsError",y.DESTROYING="hlsDestroying",y.KEY_LOADING="hlsKeyLoading",y.KEY_LOADED="hlsKeyLoaded",y.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",y.BACK_BUFFER_REACHED="hlsBackBufferReached"})(D||(D={}))},"./src/hls.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return f});var D=a("./node_modules/url-toolkit/src/url-toolkit.js"),y=a.n(D),b=a("./src/loader/playlist-loader.ts"),I=a("./src/loader/key-loader.ts"),L=a("./src/controller/id3-track-controller.ts"),R=a("./src/controller/latency-controller.ts"),_=a("./src/controller/level-controller.ts"),u=a("./src/controller/fragment-tracker.ts"),m=a("./src/controller/stream-controller.ts"),S=a("./src/is-supported.ts"),E=a("./src/utils/logger.ts"),A=a("./src/config.ts"),d=a("./node_modules/eventemitter3/index.js"),e=a.n(d),t=a("./src/events.ts"),i=a("./src/errors.ts");function h(g,T){for(var p=0;p<T.length;p++){var o=T[p];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(g,o.key,o)}}function n(g,T,p){return T&&h(g.prototype,T),p&&h(g,p),g}var f=function(){g.isSupported=function(){return Object(S.isSupported)()};function g(p){p===void 0&&(p={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new d.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var o=this.config=Object(A.mergeConfig)(g.DefaultConfig,p);this.userConfig=p,Object(E.enableLogs)(o.debug),this._autoLevelCapping=-1,o.progressive&&Object(A.enableStreamingMode)(o);var s=o.abrController,r=o.bufferController,c=o.capLevelController,l=o.fpsController,k=this.abrController=new s(this),x=this.bufferController=new r(this),C=this.capLevelController=new c(this),P=new l(this),N=new b.default(this),B=new I.default(this),F=new L.default(this),U=this.levelController=new _.default(this),H=new u.FragmentTracker(this),G=this.streamController=new m.default(this,H);C.setStreamController(G),P.setStreamController(G);var j=[U,G];this.networkControllers=j;var V=[N,B,k,x,C,P,F,H];this.audioTrackController=this.createController(o.audioTrackController,null,j),this.createController(o.audioStreamController,H,j),this.subtitleTrackController=this.createController(o.subtitleTrackController,null,j),this.createController(o.subtitleStreamController,H,j),this.createController(o.timelineController,null,V),this.emeController=this.createController(o.emeController,null,V),this.latencyController=this.createController(R.default,null,V),this.coreComponents=V}var T=g.prototype;return T.createController=function(p,o,s){if(p){var r=o?new p(this,o):new p(this);return s&&s.push(r),r}return null},T.on=function(p,o,s){s===void 0&&(s=this),this._emitter.on(p,o,s)},T.once=function(p,o,s){s===void 0&&(s=this),this._emitter.once(p,o,s)},T.removeAllListeners=function(p){this._emitter.removeAllListeners(p)},T.off=function(p,o,s,r){s===void 0&&(s=this),this._emitter.off(p,o,s,r)},T.listeners=function(p){return this._emitter.listeners(p)},T.emit=function(p,o,s){return this._emitter.emit(p,o,s)},T.trigger=function(p,o){if(this.config.debug)return this.emit(p,p,o);try{return this.emit(p,p,o)}catch(s){E.logger.error("An internal error happened while handling event "+p+'. Error message: "'+s.message+'". Here is a stacktrace:',s),this.trigger(t.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:p,error:s})}return!1},T.listenerCount=function(p){return this._emitter.listenerCount(p)},T.destroy=function(){E.logger.log("destroy"),this.trigger(t.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(p){return p.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(p){return p.destroy()}),this.coreComponents.length=0},T.attachMedia=function(p){E.logger.log("attachMedia"),this._media=p,this.trigger(t.Events.MEDIA_ATTACHING,{media:p})},T.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(t.Events.MEDIA_DETACHING,void 0),this._media=null},T.loadSource=function(p){this.stopLoad();var o=this.media,s=this.url,r=this.url=D.buildAbsoluteURL(self.location.href,p,{alwaysNormalize:!0});E.logger.log("loadSource:"+r),o&&s&&s!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(o)),this.trigger(t.Events.MANIFEST_LOADING,{url:p})},T.startLoad=function(p){p===void 0&&(p=-1),E.logger.log("startLoad("+p+")"),this.networkControllers.forEach(function(o){o.startLoad(p)})},T.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(p){p.stopLoad()})},T.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},T.recoverMediaError=function(){E.logger.log("recoverMediaError");var p=this._media;this.detachMedia(),p&&this.attachMedia(p)},T.removeLevel=function(p,o){o===void 0&&(o=0),this.levelController.removeLevel(p,o)},n(g,[{key:"levels",get:function(){var p=this.levelController.levels;return p||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(p){E.logger.log("set currentLevel:"+p),this.loadLevel=p,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(p){E.logger.log("set nextLevel:"+p),this.levelController.manualLevel=p,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(p){E.logger.log("set loadLevel:"+p),this.levelController.manualLevel=p}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(p){this.levelController.nextLoadLevel=p}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(p){E.logger.log("set firstLevel:"+p),this.levelController.firstLevel=p}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(p){E.logger.log("set startLevel:"+p),p!==-1&&(p=Math.max(p,this.minAutoLevel)),this.levelController.startLevel=p}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(p){var o=!!p;o!==this.config.capLevelToPlayerSize&&(o?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=o)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(p){this._autoLevelCapping!==p&&(E.logger.log("set autoLevelCapping:"+p),this._autoLevelCapping=p)}},{key:"bandwidthEstimate",get:function(){var p=this.abrController.bwEstimator;return p?p.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var p=this.levels,o=this.config.minAutoBitrate;if(!p)return 0;for(var s=p.length,r=0;r<s;r++)if(p[r].maxBitrate>o)return r;return 0}},{key:"maxAutoLevel",get:function(){var p=this.levels,o=this.autoLevelCapping,s;return o===-1&&p&&p.length?s=p.length-1:s=o,s}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(p){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,p)}},{key:"audioTracks",get:function(){var p=this.audioTrackController;return p?p.audioTracks:[]}},{key:"audioTrack",get:function(){var p=this.audioTrackController;return p?p.audioTrack:-1},set:function(p){var o=this.audioTrackController;o&&(o.audioTrack=p)}},{key:"subtitleTracks",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTrack:-1},set:function(p){var o=this.subtitleTrackController;o&&(o.subtitleTrack=p)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var p=this.subtitleTrackController;return p?p.subtitleDisplay:!1},set:function(p){var o=this.subtitleTrackController;o&&(o.subtitleDisplay=p)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(p){this.config.lowLatencyMode=p}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.11"}},{key:"Events",get:function(){return t.Events}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return g.defaultConfig?g.defaultConfig:A.hlsDefaultConfig},set:function(p){g.defaultConfig=p}}]),g}();f.defaultConfig=void 0},"./src/is-supported.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"isSupported",function(){return b}),a.d(w,"changeTypeSupported",function(){return I});var D=a("./src/utils/mediasource-helper.ts");function y(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var L=Object(D.getMediaSource)();if(!L)return!1;var R=y(),_=L&&typeof L.isTypeSupported=="function"&&L.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),u=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!_&&!!u}function I(){var L,R=y();return typeof(R==null||(L=R.prototype)===null||L===void 0?void 0:L.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return E}),a.d(w,"LoadError",function(){return d});var D=a("./src/polyfills/number.ts"),y=a("./src/errors.ts");function b(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,u(e,t)}function I(e){var t=typeof Map=="function"?new Map:void 0;return I=function(i){if(i===null||!_(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t!="undefined"){if(t.has(i))return t.get(i);t.set(i,h)}function h(){return L(i,arguments,m(this).constructor)}return h.prototype=Object.create(i.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),u(h,i)},I(e)}function L(e,t,i){return R()?L=Reflect.construct:L=function(h,n,f){var g=[null];g.push.apply(g,n);var T=Function.bind.apply(h,g),p=new T;return f&&u(p,f.prototype),p},L.apply(null,arguments)}function R(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function u(e,t){return u=Object.setPrototypeOf||function(i,h){return i.__proto__=h,i},u(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},m(e)}var S=Math.pow(2,17),E=function(){function e(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(i,h){var n=this,f=i.url;if(!f)return Promise.reject(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,networkDetails:null},"Fragment does not have a "+(f?"part list":"url")));this.abort();var g=this.config,T=g.fLoader,p=g.loader;return new Promise(function(o,s){n.loader&&n.loader.destroy();var r=n.loader=i.loader=T?new T(g):new p(g),c=A(i),l={timeout:g.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:g.fragLoadingMaxRetryTimeout,highWaterMark:S};i.stats=r.stats,r.load(c,l,{onSuccess:function(k,x,C,P){n.resetLoader(i,r),o({frag:i,part:null,payload:k.data,networkDetails:P})},onError:function(k,x,C){n.resetLoader(i,r),s(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,response:k,networkDetails:C}))},onAbort:function(k,x,C){n.resetLoader(i,r),s(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,networkDetails:C}))},onTimeout:function(k,x,C){n.resetLoader(i,r),s(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,networkDetails:C}))},onProgress:function(k,x,C,P){h&&h({frag:i,part:null,payload:C,networkDetails:P})}})})},t.loadPart=function(i,h,n){var f=this;this.abort();var g=this.config,T=g.fLoader,p=g.loader;return new Promise(function(o,s){f.loader&&f.loader.destroy();var r=f.loader=i.loader=T?new T(g):new p(g),c=A(i,h),l={timeout:g.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:g.fragLoadingMaxRetryTimeout,highWaterMark:S};h.stats=r.stats,r.load(c,l,{onSuccess:function(k,x,C,P){f.resetLoader(i,r),f.updateStatsFromPart(i,h);var N={frag:i,part:h,payload:k.data,networkDetails:P};n(N),o(N)},onError:function(k,x,C){f.resetLoader(i,r),s(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,part:h,response:k,networkDetails:C}))},onAbort:function(k,x,C){i.stats.aborted=h.stats.aborted,f.resetLoader(i,r),s(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,part:h,networkDetails:C}))},onTimeout:function(k,x,C){f.resetLoader(i,r),s(new d({type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,part:h,networkDetails:C}))}})})},t.updateStatsFromPart=function(i,h){var n=i.stats,f=h.stats,g=f.total;if(n.loaded+=f.loaded,g){var T=Math.round(i.duration/h.duration),p=Math.min(Math.round(n.loaded/g),T),o=T-p,s=o*Math.round(n.loaded/p);n.total=n.loaded+s}else n.total=Math.max(n.loaded,n.total);var r=n.loading,c=f.loading;r.start?r.first+=c.first-c.start:(r.start=c.start,r.first=c.first),r.end=c.end},t.resetLoader=function(i,h){i.loader=null,this.loader===h&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),h.destroy()},e}();function A(e,t){t===void 0&&(t=null);var i=t||e,h={frag:e,part:t,responseType:"arraybuffer",url:i.url,rangeStart:0,rangeEnd:0},n=i.byteRangeStartOffset,f=i.byteRangeEndOffset;return Object(D.isFiniteNumber)(n)&&Object(D.isFiniteNumber)(f)&&(h.rangeStart=n,h.rangeEnd=f),h}var d=function(e){b(t,e);function t(i){for(var h,n=arguments.length,f=new Array(n>1?n-1:0),g=1;g<n;g++)f[g-1]=arguments[g];return h=e.call.apply(e,[this].concat(f))||this,h.data=void 0,h.data=i,h}return t}(I(Error))},"./src/loader/fragment.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"ElementaryStreamTypes",function(){return E}),a.d(w,"BaseSegment",function(){return A}),a.d(w,"Fragment",function(){return d}),a.d(w,"Part",function(){return e});var D=a("./src/polyfills/number.ts"),y=a("./node_modules/url-toolkit/src/url-toolkit.js"),b=a.n(y),I=a("./src/utils/logger.ts"),L=a("./src/loader/level-key.ts"),R=a("./src/loader/load-stats.ts");function _(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,u(t,i)}function u(t,i){return u=Object.setPrototypeOf||function(h,n){return h.__proto__=n,h},u(t,i)}function m(t,i){for(var h=0;h<i.length;h++){var n=i[h];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function S(t,i,h){return i&&m(t.prototype,i),h&&m(t,h),t}var E;(function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"})(E||(E={}));var A=function(){function t(h){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(n={},n[E.AUDIO]=null,n[E.VIDEO]=null,n[E.AUDIOVIDEO]=null,n),this.baseurl=h}var i=t.prototype;return i.setByteRange=function(h,n){var f=h.split("@",2),g=[];f.length===1?g[0]=n?n.byteRangeEndOffset:0:g[0]=parseInt(f[1]),g[1]=parseInt(f[0])+g[0],this._byteRange=g},S(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(y.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(h){this._url=h}}]),t}(),d=function(t){_(i,t);function i(n,f){var g;return g=t.call(this,f)||this,g._decryptdata=null,g.rawProgramDateTime=null,g.programDateTime=null,g.tagList=[],g.duration=0,g.sn=0,g.levelkey=void 0,g.type=void 0,g.loader=null,g.level=-1,g.cc=0,g.startPTS=void 0,g.endPTS=void 0,g.appendedPTS=void 0,g.startDTS=void 0,g.endDTS=void 0,g.start=0,g.deltaPTS=void 0,g.maxStartPTS=void 0,g.minEndPTS=void 0,g.stats=new R.LoadStats,g.urlId=0,g.data=void 0,g.bitrateTest=!1,g.title=null,g.initSegment=null,g.type=n,g}var h=i.prototype;return h.createInitializationVector=function(n){for(var f=new Uint8Array(16),g=12;g<16;g++)f[g]=n>>8*(15-g)&255;return f},h.setDecryptDataFromLevelKey=function(n,f){var g=n;return(n==null?void 0:n.method)==="AES-128"&&n.uri&&!n.iv&&(g=L.LevelKey.fromURI(n.uri),g.method=n.method,g.iv=this.createInitializationVector(f),g.keyFormat="identity"),g},h.setElementaryStreamInfo=function(n,f,g,T,p,o){o===void 0&&(o=!1);var s=this.elementaryStreams,r=s[n];if(!r){s[n]={startPTS:f,endPTS:g,startDTS:T,endDTS:p,partial:o};return}r.startPTS=Math.min(r.startPTS,f),r.endPTS=Math.max(r.endPTS,g),r.startDTS=Math.min(r.startDTS,T),r.endDTS=Math.max(r.endDTS,p)},h.clearElementaryStreamInfo=function(){var n=this.elementaryStreams;n[E.AUDIO]=null,n[E.VIDEO]=null,n[E.AUDIOVIDEO]=null},S(i,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var n=this.sn;typeof n!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&I.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),n=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,n)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(D.isFiniteNumber)(this.programDateTime))return null;var n=Object(D.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+n*1e3}},{key:"encrypted",get:function(){var n;return!!((n=this.decryptdata)!==null&&n!==void 0&&n.keyFormat&&this.decryptdata.uri)}}]),i}(A),e=function(t){_(i,t);function i(h,n,f,g,T){var p;p=t.call(this,f)||this,p.fragOffset=0,p.duration=0,p.gap=!1,p.independent=!1,p.relurl=void 0,p.fragment=void 0,p.index=void 0,p.stats=new R.LoadStats,p.duration=h.decimalFloatingPoint("DURATION"),p.gap=h.bool("GAP"),p.independent=h.bool("INDEPENDENT"),p.relurl=h.enumeratedString("URI"),p.fragment=n,p.index=g;var o=h.enumeratedString("BYTERANGE");return o&&p.setByteRange(o,T),T&&(p.fragOffset=T.fragOffset+T.duration),p}return S(i,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var h=this.elementaryStreams;return!!(h.audio||h.video||h.audiovideo)}}]),i}(A)},"./src/loader/key-loader.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return I});var D=a("./src/events.ts"),y=a("./src/errors.ts"),b=a("./src/utils/logger.ts"),I=function(){function L(_){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=_,this._registerListeners()}var R=L.prototype;return R._registerListeners=function(){this.hls.on(D.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function(){this.hls.off(D.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function(){this._unregisterListeners();for(var _ in this.loaders){var u=this.loaders[_];u&&u.destroy()}this.loaders={}},R.onKeyLoading=function(_,u){var m=u.frag,S=m.type,E=this.loaders[S];if(!m.decryptdata){b.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var A=m.decryptdata.uri;if(A!==this.decrypturl||this.decryptkey===null){var d=this.hls.config;if(E&&(b.logger.warn("abort previous key loader for type:"+S),E.abort()),!A){b.logger.warn("key uri is falsy");return}var e=d.loader,t=m.loader=this.loaders[S]=new e(d);this.decrypturl=A,this.decryptkey=null;var i={url:A,frag:m,responseType:"arraybuffer"},h={timeout:d.fragLoadingTimeOut,maxRetry:0,retryDelay:d.fragLoadingRetryDelay,maxRetryDelay:d.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.load(i,h,n)}else this.decryptkey&&(m.decryptdata.key=this.decryptkey,this.hls.trigger(D.Events.KEY_LOADED,{frag:m}))},R.loadsuccess=function(_,u,m){var S=m.frag;if(!S.decryptdata){b.logger.error("after key load, decryptdata unset");return}this.decryptkey=S.decryptdata.key=new Uint8Array(_.data),S.loader=null,delete this.loaders[S.type],this.hls.trigger(D.Events.KEY_LOADED,{frag:S})},R.loaderror=function(_,u){var m=u.frag,S=m.loader;S&&S.abort(),delete this.loaders[m.type],this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:m,response:_})},R.loadtimeout=function(_,u){var m=u.frag,S=m.loader;S&&S.abort(),delete this.loaders[m.type],this.hls.trigger(D.Events.ERROR,{type:y.ErrorTypes.NETWORK_ERROR,details:y.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:m})},L}()},"./src/loader/level-details.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"LevelDetails",function(){return L});var D=a("./src/polyfills/number.ts");function y(R,_){for(var u=0;u<_.length;u++){var m=_[u];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(R,m.key,m)}}function b(R,_,u){return _&&y(R.prototype,_),u&&y(R,u),R}var I=10,L=function(){function R(u){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=u}var _=R.prototype;return _.reloaded=function(u){if(!u){this.advanced=!0,this.updated=!0;return}var m=this.lastPartSn-u.lastPartSn,S=this.lastPartIndex-u.lastPartIndex;this.updated=this.endSN!==u.endSN||!!S||!!m,this.advanced=this.endSN>u.endSN||m>0||m===0&&S>0,this.updated||this.advanced?this.misses=Math.floor(u.misses*.6):this.misses=u.misses+1,this.availabilityDelay=u.availabilityDelay},b(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(D.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||I}},{key:"drift",get:function(){var u=this.driftEndTime-this.driftStartTime;if(u>0){var m=this.driftEnd-this.driftStart;return m*1e3/u}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var u;return(u=this.partList)!==null&&u!==void 0&&u.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var u;return(u=this.fragments)!==null&&u!==void 0&&u.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var u;return(u=this.partList)!==null&&u!==void 0&&u.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var u;return(u=this.partList)!==null&&u!==void 0&&u.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"LevelKey",function(){return L});var D=a("./node_modules/url-toolkit/src/url-toolkit.js"),y=a.n(D);function b(R,_){for(var u=0;u<_.length;u++){var m=_[u];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(R,m.key,m)}}function I(R,_,u){return _&&b(R.prototype,_),u&&b(R,u),R}var L=function(){R.fromURL=function(_,u){return new R(_,u)},R.fromURI=function(_){return new R(_)};function R(_,u){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,u?this._uri=Object(D.buildAbsoluteURL)(_,u,{alwaysNormalize:!0}):this._uri=_}return I(R,[{key:"uri",get:function(){return this._uri}}]),R}()},"./src/loader/load-stats.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"LoadStats",function(){return D});var D=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return i});var D=a("./src/polyfills/number.ts"),y=a("./node_modules/url-toolkit/src/url-toolkit.js"),b=a.n(y),I=a("./src/loader/fragment.ts"),L=a("./src/loader/level-details.ts"),R=a("./src/loader/level-key.ts"),_=a("./src/utils/attr-list.ts"),u=a("./src/utils/logger.ts"),m=a("./src/utils/codecs.ts"),S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,E=/#EXT-X-MEDIA:(.*)/g,A=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),d=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),e=/\.(mp4|m4s|m4v|m4a)$/i;function t(T){var p,o;return e.test((p=(o=y.parseURL(T))===null||o===void 0?void 0:o.path)!=null?p:"")}var i=function(){function T(){}return T.findGroup=function(p,o){for(var s=0;s<p.length;s++){var r=p[s];if(r.id===o)return r}},T.convertAVC1ToAVCOTI=function(p){var o=p.split(".");if(o.length>2){var s=o.shift()+".";return s+=parseInt(o.shift()).toString(16),s+=("000"+parseInt(o.shift()).toString(16)).substr(-4),s}return p},T.resolve=function(p,o){return y.buildAbsoluteURL(o,p,{alwaysNormalize:!0})},T.parseMasterPlaylist=function(p,o){var s=[],r={},c=!1;S.lastIndex=0;for(var l;(l=S.exec(p))!=null;)if(l[1]){var k=new _.AttrList(l[1]),x={attrs:k,bitrate:k.decimalInteger("AVERAGE-BANDWIDTH")||k.decimalInteger("BANDWIDTH"),name:k.NAME,url:T.resolve(l[2],o)},C=k.decimalResolution("RESOLUTION");C&&(x.width=C.width,x.height=C.height),h((k.CODECS||"").split(/[ ,]+/).filter(function(N){return N}),x),x.videoCodec&&x.videoCodec.indexOf("avc1")!==-1&&(x.videoCodec=T.convertAVC1ToAVCOTI(x.videoCodec)),s.push(x)}else if(l[3]){var P=new _.AttrList(l[3]);P["DATA-ID"]&&(c=!0,r[P["DATA-ID"]]=P)}return{levels:s,sessionData:c?r:null}},T.parseMasterPlaylistMedia=function(p,o,s,r){r===void 0&&(r=[]);var c,l=[],k=0;for(E.lastIndex=0;(c=E.exec(p))!==null;){var x=new _.AttrList(c[1]);if(x.TYPE===s){var C={attrs:x,bitrate:0,id:k++,groupId:x["GROUP-ID"],instreamId:x["INSTREAM-ID"],name:x.NAME||x.LANGUAGE||"",type:s,default:x.bool("DEFAULT"),autoselect:x.bool("AUTOSELECT"),forced:x.bool("FORCED"),lang:x.LANGUAGE,url:x.URI?T.resolve(x.URI,o):""};if(r.length){var P=T.findGroup(r,C.groupId)||r[0];n(C,P,"audioCodec"),n(C,P,"textCodec")}l.push(C)}}return l},T.parseLevelPlaylist=function(p,o,s,r,c){var l=new L.LevelDetails(o),k=l.fragments,x=null,C=0,P=0,N=0,B=0,F=null,U=new I.Fragment(r,o),H,G,j,V=-1,q=!1;for(A.lastIndex=0,l.m3u8=p;(H=A.exec(p))!==null;){q&&(q=!1,U=new I.Fragment(r,o),U.start=N,U.sn=C,U.cc=B,U.level=s,x&&(U.initSegment=x,U.rawProgramDateTime=x.rawProgramDateTime));var W=H[1];if(W){U.duration=parseFloat(W);var Y=(" "+H[2]).slice(1);U.title=Y||null,U.tagList.push(Y?["INF",W,Y]:["INF",W])}else if(H[3])Object(D.isFiniteNumber)(U.duration)&&(U.start=N,j&&(U.levelkey=j),U.sn=C,U.level=s,U.cc=B,U.urlId=c,k.push(U),U.relurl=(" "+H[3]).slice(1),g(U,F),F=U,N+=U.duration,C++,P=0,q=!0);else if(H[4]){var $=(" "+H[4]).slice(1);F?U.setByteRange($,F):U.setByteRange($)}else if(H[5])U.rawProgramDateTime=(" "+H[5]).slice(1),U.tagList.push(["PROGRAM-DATE-TIME",U.rawProgramDateTime]),V===-1&&(V=k.length);else{if(H=H[0].match(d),!H){u.logger.warn("No matches on slow regex match for level playlist!");continue}for(G=1;G<H.length&&typeof H[G]=="undefined";G++);var Z=(" "+H[G]).slice(1),te=(" "+H[G+1]).slice(1),ie=H[G+2]?(" "+H[G+2]).slice(1):"";switch(Z){case"PLAYLIST-TYPE":l.type=te.toUpperCase();break;case"MEDIA-SEQUENCE":C=l.startSN=parseInt(te);break;case"SKIP":{var ve=new _.AttrList(te),ae=ve.decimalInteger("SKIPPED-SEGMENTS");if(Object(D.isFiniteNumber)(ae)){l.skippedSegments=ae;for(var re=ae;re--;)k.unshift(null);C+=ae}var Q=ve.enumeratedString("RECENTLY-REMOVED-DATERANGES");Q&&(l.recentlyRemovedDateranges=Q.split("	"));break}case"TARGETDURATION":l.targetduration=parseFloat(te);break;case"VERSION":l.version=parseInt(te);break;case"EXTM3U":break;case"ENDLIST":l.live=!1;break;case"#":(te||ie)&&U.tagList.push(ie?[te,ie]:[te]);break;case"DIS":B++;case"GAP":U.tagList.push([Z]);break;case"BITRATE":U.tagList.push([Z,te]);break;case"DISCONTINUITY-SEQ":B=parseInt(te);break;case"KEY":{var X,z=new _.AttrList(te),oe=z.enumeratedString("METHOD"),he=z.URI,fe=z.hexadecimalInteger("IV"),ge=z.enumeratedString("KEYFORMATVERSIONS"),de=z.enumeratedString("KEYID"),pe=(X=z.enumeratedString("KEYFORMAT"))!=null?X:"identity",se=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(se.indexOf(pe)>-1){u.logger.warn("Keyformat "+pe+" is not supported from the manifest");continue}else if(pe!=="identity")continue;oe&&(j=R.LevelKey.fromURL(o,he),he&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(oe)>=0&&(j.method=oe,j.keyFormat=pe,de&&(j.keyID=de),ge&&(j.keyFormatVersions=ge),j.iv=fe));break}case"START":{var ue=new _.AttrList(te),Se=ue.decimalFloatingPoint("TIME-OFFSET");Object(D.isFiniteNumber)(Se)&&(l.startTimeOffset=Se);break}case"MAP":{var Ie=new _.AttrList(te);U.relurl=Ie.URI,Ie.BYTERANGE&&U.setByteRange(Ie.BYTERANGE),U.level=s,U.sn="initSegment",j&&(U.levelkey=j),U.initSegment=null,x=U,q=!0;break}case"SERVER-CONTROL":{var Te=new _.AttrList(te);l.canBlockReload=Te.bool("CAN-BLOCK-RELOAD"),l.canSkipUntil=Te.optionalFloat("CAN-SKIP-UNTIL",0),l.canSkipDateRanges=l.canSkipUntil>0&&Te.bool("CAN-SKIP-DATERANGES"),l.partHoldBack=Te.optionalFloat("PART-HOLD-BACK",0),l.holdBack=Te.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Fe=new _.AttrList(te);l.partTarget=Fe.decimalFloatingPoint("PART-TARGET");break}case"PART":{var me=l.partList;me||(me=l.partList=[]);var Re=P>0?me[me.length-1]:void 0,ze=P++,Me=new I.Part(new _.AttrList(te),U,o,ze,Re);me.push(Me),U.duration+=Me.duration;break}case"PRELOAD-HINT":{var Oe=new _.AttrList(te);l.preloadHint=Oe;break}case"RENDITION-REPORT":{var et=new _.AttrList(te);l.renditionReports=l.renditionReports||[],l.renditionReports.push(et);break}default:u.logger.warn("line parsed but not handled: "+H);break}}}F&&!F.relurl?(k.pop(),N-=F.duration,l.partList&&(l.fragmentHint=F)):l.partList&&(g(U,F),U.cc=B,l.fragmentHint=U);var Pe=k.length,De=k[0],Ue=k[Pe-1];if(N+=l.skippedSegments*l.targetduration,N>0&&Pe&&Ue){l.averagetargetduration=N/Pe;var tt=Ue.sn;l.endSN=tt!=="initSegment"?tt:0,De&&(l.startCC=De.cc,De.initSegment||l.fragments.every(function(Be){return Be.relurl&&t(Be.relurl)})&&(u.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),U=new I.Fragment(r,o),U.relurl=Ue.relurl,U.level=s,U.sn="initSegment",De.initSegment=U,l.needSidxRanges=!0))}else l.endSN=0,l.startCC=0;return l.fragmentHint&&(N+=l.fragmentHint.duration),l.totalduration=N,l.endCC=B,V>0&&f(k,V),l},T}();function h(T,p){["video","audio","text"].forEach(function(o){var s=T.filter(function(c){return Object(m.isCodecType)(c,o)});if(s.length){var r=s.filter(function(c){return c.lastIndexOf("avc1",0)===0||c.lastIndexOf("mp4a",0)===0});p[o+"Codec"]=r.length>0?r[0]:s[0],T=T.filter(function(c){return s.indexOf(c)===-1})}}),p.unknownCodecs=T}function n(T,p,o){var s=p[o];s&&(T[o]=s)}function f(T,p){for(var o=T[p],s=p;s--;){var r=T[s];if(!r)return;r.programDateTime=o.programDateTime-r.duration*1e3,o=r}}function g(T,p){T.rawProgramDateTime?T.programDateTime=Date.parse(T.rawProgramDateTime):p!=null&&p.programDateTime&&(T.programDateTime=p.endProgramDateTime),Object(D.isFiniteNumber)(T.programDateTime)||(T.programDateTime=null,T.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/polyfills/number.ts"),y=a("./src/events.ts"),b=a("./src/errors.ts"),I=a("./src/utils/logger.ts"),L=a("./src/utils/mp4-tools.ts"),R=a("./src/loader/m3u8-parser.ts"),_=a("./src/types/loader.ts"),u=a("./src/utils/attr-list.ts");function m(A){var d=A.type;switch(d){case _.PlaylistContextType.AUDIO_TRACK:return _.PlaylistLevelType.AUDIO;case _.PlaylistContextType.SUBTITLE_TRACK:return _.PlaylistLevelType.SUBTITLE;default:return _.PlaylistLevelType.MAIN}}function S(A,d){var e=A.url;return(e===void 0||e.indexOf("data:")===0)&&(e=d.url),e}var E=function(){function A(e){this.hls=void 0,this.loaders=Object.create(null),this.hls=e,this.registerListeners()}var d=A.prototype;return d.registerListeners=function(){var e=this.hls;e.on(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.unregisterListeners=function(){var e=this.hls;e.off(y.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(y.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},d.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,h=t.loader,n=i||h,f=new n(t);return e.loader=f,this.loaders[e.type]=f,f},d.getInternalLoader=function(e){return this.loaders[e.type]},d.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},d.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},d.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},d.onManifestLoading=function(e,t){var i=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:_.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},d.onLevelLoading=function(e,t){var i=t.id,h=t.level,n=t.url,f=t.deliveryDirectives;this.load({id:i,groupId:null,level:h,responseType:"text",type:_.PlaylistContextType.LEVEL,url:n,deliveryDirectives:f})},d.onAudioTrackLoading=function(e,t){var i=t.id,h=t.groupId,n=t.url,f=t.deliveryDirectives;this.load({id:i,groupId:h,level:null,responseType:"text",type:_.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:f})},d.onSubtitleTrackLoading=function(e,t){var i=t.id,h=t.groupId,n=t.url,f=t.deliveryDirectives;this.load({id:i,groupId:h,level:null,responseType:"text",type:_.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:f})},d.load=function(e){var t,i=this.hls.config,h=this.getInternalLoader(e);if(h){var n=h.context;if(n&&n.url===e.url){I.logger.trace("[playlist-loader]: playlist request ongoing");return}I.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),h.abort()}var f,g,T,p;switch(e.type){case _.PlaylistContextType.MANIFEST:f=i.manifestLoadingMaxRetry,g=i.manifestLoadingTimeOut,T=i.manifestLoadingRetryDelay,p=i.manifestLoadingMaxRetryTimeout;break;case _.PlaylistContextType.LEVEL:case _.PlaylistContextType.AUDIO_TRACK:case _.PlaylistContextType.SUBTITLE_TRACK:f=0,g=i.levelLoadingTimeOut;break;default:f=i.levelLoadingMaxRetry,g=i.levelLoadingTimeOut,T=i.levelLoadingRetryDelay,p=i.levelLoadingMaxRetryTimeout;break}if(h=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part){var o;if(e.type===_.PlaylistContextType.LEVEL&&e.level!==null?o=this.hls.levels[e.level].details:e.type===_.PlaylistContextType.AUDIO_TRACK&&e.id!==null?o=this.hls.audioTracks[e.id].details:e.type===_.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(o=this.hls.subtitleTracks[e.id].details),o){var s=o.partTarget,r=o.targetduration;s&&r&&(g=Math.min(Math.max(s*3,r*.8)*1e3,g))}}var c={timeout:g,maxRetry:f,retryDelay:T,maxRetryDelay:p,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.load(e,c,l)},d.loadsuccess=function(e,t,i,h){if(h===void 0&&(h=null),i.isSidxRequest){this.handleSidxRequest(e,i),this.handlePlaylistLoaded(e,t,i,h);return}this.resetInternalLoader(i.type);var n=e.data;if(n.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,i,"no EXTM3U delimiter",h);return}t.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,i,h):this.handleMasterPlaylist(e,t,i,h)},d.loaderror=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!1,e)},d.loadtimeout=function(e,t,i){i===void 0&&(i=null),this.handleNetworkError(t,i,!0)},d.handleMasterPlaylist=function(e,t,i,h){var n=this.hls,f=e.data,g=S(e,i),T=R.default.parseMasterPlaylist(f,g),p=T.levels,o=T.sessionData;if(!p.length){this.handleManifestParsingError(e,i,"no level found in manifest",h);return}var s=p.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),r=p.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),c=R.default.parseMasterPlaylistMedia(f,g,"AUDIO",s),l=R.default.parseMasterPlaylistMedia(f,g,"SUBTITLES",r),k=R.default.parseMasterPlaylistMedia(f,g,"CLOSED-CAPTIONS");if(c.length){var x=c.some(function(C){return!C.url});!x&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(I.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),c.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new u.AttrList({}),bitrate:0,url:""}))}n.trigger(y.Events.MANIFEST_LOADED,{levels:p,audioTracks:c,subtitles:l,captions:k,url:g,stats:t,networkDetails:h,sessionData:o})},d.handleTrackOrLevelPlaylist=function(e,t,i,h){var n=this.hls,f=i.id,g=i.level,T=i.type,p=S(e,i),o=Object(D.isFiniteNumber)(f)?f:0,s=Object(D.isFiniteNumber)(g)?g:o,r=m(i),c=R.default.parseLevelPlaylist(e.data,p,s,r,o);if(!c.fragments.length){n.trigger(y.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:p,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0});return}if(T===_.PlaylistContextType.MANIFEST){var l={attrs:new u.AttrList({}),bitrate:0,details:c,name:"",url:p};n.trigger(y.Events.MANIFEST_LOADED,{levels:[l],audioTracks:[],url:p,stats:t,networkDetails:h,sessionData:null})}if(t.parsing.end=performance.now(),c.needSidxRanges){var k,x=(k=c.fragments[0].initSegment)===null||k===void 0?void 0:k.url;this.load({url:x,isSidxRequest:!0,type:T,level:g,levelDetails:c,id:f,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}i.levelDetails=c,this.handlePlaylistLoaded(e,t,i,h)},d.handleSidxRequest=function(e,t){var i=Object(L.parseSegmentIndex)(new Uint8Array(e.data));if(i){var h=i.references,n=t.levelDetails;h.forEach(function(f,g){var T=f.info,p=n.fragments[g];p.byteRange.length===0&&p.setByteRange(String(1+T.end-T.start)+"@"+String(T.start)),p.initSegment&&p.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},d.handleManifestParsingError=function(e,t,i,h){this.hls.trigger(y.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===_.PlaylistContextType.MANIFEST,url:e.url,reason:i,response:e,context:t,networkDetails:h})},d.handleNetworkError=function(e,t,i,h){i===void 0&&(i=!1),I.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var n=b.ErrorDetails.UNKNOWN,f=!1,g=this.getInternalLoader(e);switch(e.type){case _.PlaylistContextType.MANIFEST:n=i?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,f=!0;break;case _.PlaylistContextType.LEVEL:n=i?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,f=!1;break;case _.PlaylistContextType.AUDIO_TRACK:n=i?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case _.PlaylistContextType.SUBTITLE_TRACK:n=i?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,f=!1;break}g&&this.resetInternalLoader(e.type);var T={type:b.ErrorTypes.NETWORK_ERROR,details:n,fatal:f,url:e.url,loader:g,context:e,networkDetails:t};h&&(T.response=h),this.hls.trigger(y.Events.ERROR,T)},d.handlePlaylistLoaded=function(e,t,i,h){var n=i.type,f=i.level,g=i.id,T=i.groupId,p=i.loader,o=i.levelDetails,s=i.deliveryDirectives;if(!(o!=null&&o.targetduration)){this.handleManifestParsingError(e,i,"invalid target duration",h);return}if(p)switch(o.live&&(p.getCacheAge&&(o.ageHeader=p.getCacheAge()||0),(!p.getCacheAge||isNaN(o.ageHeader))&&(o.ageHeader=0)),n){case _.PlaylistContextType.MANIFEST:case _.PlaylistContextType.LEVEL:this.hls.trigger(y.Events.LEVEL_LOADED,{details:o,level:f||0,id:g||0,stats:t,networkDetails:h,deliveryDirectives:s});break;case _.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(y.Events.AUDIO_TRACK_LOADED,{details:o,id:g||0,groupId:T||"",stats:t,networkDetails:h,deliveryDirectives:s});break;case _.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(y.Events.SUBTITLE_TRACK_LOADED,{details:o,id:g||0,groupId:T||"",stats:t,networkDetails:h,deliveryDirectives:s});break}},A}();w.default=E},"./src/polyfills/number.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"isFiniteNumber",function(){return D}),a.d(w,"MAX_SAFE_INTEGER",function(){return y});var D=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},y=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(O,w,a){"use strict";a.r(w);var D=function(){function y(){}return y.getSilentFrame=function(b,I){switch(b){case"mp4a.40.2":if(I===1)return new Uint8Array([0,200,0,128,35,128]);if(I===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(I===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(I===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(I===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(I===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(I===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},y}();w.default=D},"./src/remux/mp4-generator.ts":function(O,w,a){"use strict";a.r(w);var D=Math.pow(2,32)-1,y=function(){function b(){}return b.init=function(){b.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var I;for(I in b.types)b.types.hasOwnProperty(I)&&(b.types[I]=[I.charCodeAt(0),I.charCodeAt(1),I.charCodeAt(2),I.charCodeAt(3)]);var L=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),R=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);b.HDLR_TYPES={video:L,audio:R};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),u=new Uint8Array([0,0,0,0,0,0,0,0]);b.STTS=b.STSC=b.STCO=u,b.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),b.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),b.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),b.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var m=new Uint8Array([105,115,111,109]),S=new Uint8Array([97,118,99,49]),E=new Uint8Array([0,0,0,1]);b.FTYP=b.box(b.types.ftyp,m,E,m,S),b.DINF=b.box(b.types.dinf,b.box(b.types.dref,_))},b.box=function(I){for(var L=8,R=arguments.length,_=new Array(R>1?R-1:0),u=1;u<R;u++)_[u-1]=arguments[u];for(var m=_.length,S=m;m--;)L+=_[m].byteLength;var E=new Uint8Array(L);for(E[0]=L>>24&255,E[1]=L>>16&255,E[2]=L>>8&255,E[3]=L&255,E.set(I,4),m=0,L=8;m<S;m++)E.set(_[m],L),L+=_[m].byteLength;return E},b.hdlr=function(I){return b.box(b.types.hdlr,b.HDLR_TYPES[I])},b.mdat=function(I){return b.box(b.types.mdat,I)},b.mdhd=function(I,L){L*=I;var R=Math.floor(L/(D+1)),_=Math.floor(L%(D+1));return b.box(b.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,R>>24,R>>16&255,R>>8&255,R&255,_>>24,_>>16&255,_>>8&255,_&255,85,196,0,0]))},b.mdia=function(I){return b.box(b.types.mdia,b.mdhd(I.timescale,I.duration),b.hdlr(I.type),b.minf(I))},b.mfhd=function(I){return b.box(b.types.mfhd,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255]))},b.minf=function(I){return I.type==="audio"?b.box(b.types.minf,b.box(b.types.smhd,b.SMHD),b.DINF,b.stbl(I)):b.box(b.types.minf,b.box(b.types.vmhd,b.VMHD),b.DINF,b.stbl(I))},b.moof=function(I,L,R){return b.box(b.types.moof,b.mfhd(I),b.traf(R,L))},b.moov=function(I){for(var L=I.length,R=[];L--;)R[L]=b.trak(I[L]);return b.box.apply(null,[b.types.moov,b.mvhd(I[0].timescale,I[0].duration)].concat(R).concat(b.mvex(I)))},b.mvex=function(I){for(var L=I.length,R=[];L--;)R[L]=b.trex(I[L]);return b.box.apply(null,[b.types.mvex].concat(R))},b.mvhd=function(I,L){L*=I;var R=Math.floor(L/(D+1)),_=Math.floor(L%(D+1)),u=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,R>>24,R>>16&255,R>>8&255,R&255,_>>24,_>>16&255,_>>8&255,_&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return b.box(b.types.mvhd,u)},b.sdtp=function(I){var L=I.samples||[],R=new Uint8Array(4+L.length),_,u;for(_=0;_<L.length;_++)u=L[_].flags,R[_+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return b.box(b.types.sdtp,R)},b.stbl=function(I){return b.box(b.types.stbl,b.stsd(I),b.box(b.types.stts,b.STTS),b.box(b.types.stsc,b.STSC),b.box(b.types.stsz,b.STSZ),b.box(b.types.stco,b.STCO))},b.avc1=function(I){var L=[],R=[],_,u,m;for(_=0;_<I.sps.length;_++)u=I.sps[_],m=u.byteLength,L.push(m>>>8&255),L.push(m&255),L=L.concat(Array.prototype.slice.call(u));for(_=0;_<I.pps.length;_++)u=I.pps[_],m=u.byteLength,R.push(m>>>8&255),R.push(m&255),R=R.concat(Array.prototype.slice.call(u));var S=b.box(b.types.avcC,new Uint8Array([1,L[3],L[4],L[5],252|3,224|I.sps.length].concat(L).concat([I.pps.length]).concat(R))),E=I.width,A=I.height,d=I.pixelRatio[0],e=I.pixelRatio[1];return b.box(b.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,E>>8&255,E&255,A>>8&255,A&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),S,b.box(b.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),b.box(b.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,e>>24,e>>16&255,e>>8&255,e&255])))},b.esds=function(I){var L=I.config.length;return new Uint8Array([0,0,0,0,3,23+L,0,1,0,4,15+L,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([L]).concat(I.config).concat([6,1,2]))},b.mp4a=function(I){var L=I.samplerate;return b.box(b.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]),b.box(b.types.esds,b.esds(I)))},b.mp3=function(I){var L=I.samplerate;return b.box(b.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,L>>8&255,L&255,0,0]))},b.stsd=function(I){return I.type==="audio"?!I.isAAC&&I.codec==="mp3"?b.box(b.types.stsd,b.STSD,b.mp3(I)):b.box(b.types.stsd,b.STSD,b.mp4a(I)):b.box(b.types.stsd,b.STSD,b.avc1(I))},b.tkhd=function(I){var L=I.id,R=I.duration*I.timescale,_=I.width,u=I.height,m=Math.floor(R/(D+1)),S=Math.floor(R%(D+1));return b.box(b.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,L>>24&255,L>>16&255,L>>8&255,L&255,0,0,0,0,m>>24,m>>16&255,m>>8&255,m&255,S>>24,S>>16&255,S>>8&255,S&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_>>8&255,_&255,0,0,u>>8&255,u&255,0,0]))},b.traf=function(I,L){var R=b.sdtp(I),_=I.id,u=Math.floor(L/(D+1)),m=Math.floor(L%(D+1));return b.box(b.types.traf,b.box(b.types.tfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255])),b.box(b.types.tfdt,new Uint8Array([1,0,0,0,u>>24,u>>16&255,u>>8&255,u&255,m>>24,m>>16&255,m>>8&255,m&255])),b.trun(I,R.length+16+20+8+16+8+8),R)},b.trak=function(I){return I.duration=I.duration||4294967295,b.box(b.types.trak,b.tkhd(I),b.mdia(I))},b.trex=function(I){var L=I.id;return b.box(b.types.trex,new Uint8Array([0,0,0,0,L>>24,L>>16&255,L>>8&255,L&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},b.trun=function(I,L){var R=I.samples||[],_=R.length,u=12+16*_,m=new Uint8Array(u),S,E,A,d,e,t;for(L+=8+u,m.set([0,0,15,1,_>>>24&255,_>>>16&255,_>>>8&255,_&255,L>>>24&255,L>>>16&255,L>>>8&255,L&255],0),S=0;S<_;S++)E=R[S],A=E.duration,d=E.size,e=E.flags,t=E.cts,m.set([A>>>24&255,A>>>16&255,A>>>8&255,A&255,d>>>24&255,d>>>16&255,d>>>8&255,d&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,t>>>24&255,t>>>16&255,t>>>8&255,t&255],12+16*S);return b.box(b.types.trun,m)},b.initSegment=function(I){b.types||b.init();var L=b.moov(I),R=new Uint8Array(b.FTYP.byteLength+L.byteLength);return R.set(b.FTYP),R.set(L,b.FTYP.byteLength),R},b}();y.types=void 0,y.HDLR_TYPES=void 0,y.STTS=void 0,y.STSC=void 0,y.STCO=void 0,y.STSZ=void 0,y.VMHD=void 0,y.SMHD=void 0,y.STSD=void 0,y.FTYP=void 0,y.DINF=void 0,w.default=y},"./src/remux/mp4-remuxer.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return i}),a.d(w,"normalizePts",function(){return h});var D=a("./src/polyfills/number.ts"),y=a("./src/remux/aac-helper.ts"),b=a("./src/remux/mp4-generator.ts"),I=a("./src/events.ts"),L=a("./src/errors.ts"),R=a("./src/utils/logger.ts"),_=a("./src/types/loader.ts"),u=a("./src/utils/timescale-conversion.ts");function m(){return m=Object.assign||function(T){for(var p=1;p<arguments.length;p++){var o=arguments[p];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(T[s]=o[s])}return T},m.apply(this,arguments)}var S=10*1e3,E=1024,A=1152,d=null,e=null,t=!1,i=function(){function T(o,s,r,c){if(c===void 0&&(c=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=o,this.config=s,this.typeSupported=r,this.ISGenerated=!1,d===null){var l=navigator.userAgent||"",k=l.match(/Chrome\/(\d+)/i);d=k?parseInt(k[1]):0}if(e===null){var x=navigator.userAgent.match(/Safari\/(\d+)/i);e=x?parseInt(x[1]):0}t=!!d&&d<75||!!e&&e<600}var p=T.prototype;return p.destroy=function(){},p.resetTimeStamp=function(o){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=o},p.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},p.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},p.getVideoStartPts=function(o){var s=!1,r=o.reduce(function(c,l){var k=l.pts-c;return k<-4294967296?(s=!0,h(c,l.pts)):k>0?c:l.pts},o[0].pts);return s&&R.logger.debug("PTS rollover detected"),r},p.remux=function(o,s,r,c,l,k,x,C){var P,N,B,F,U,H,G=l,j=l,V=o.pid>-1,q=s.pid>-1,W=s.samples.length,Y=o.samples.length>0,$=W>1,Z=(!V||Y)&&(!q||$)||this.ISGenerated||x;if(Z){this.ISGenerated||(B=this.generateIS(o,s,l));var te=this.isVideoContiguous,ie=-1;if($&&(ie=n(s.samples),!te&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,ie>0){R.logger.warn("[mp4-remuxer]: Dropped "+ie+" out of "+W+" video samples due to a missing keyframe");var ve=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(ie),s.dropped+=ie,j+=(s.samples[0].pts-ve)/(s.timescale||9e4)}else ie===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+W+" video samples"),H=!1);if(this.ISGenerated){if(Y&&$){var ae=this.getVideoStartPts(s.samples),re=h(o.samples[0].pts,ae)-ae,Q=re/s.inputTimeScale;G+=Math.max(0,Q),j+=Math.max(0,-Q)}if(Y){if(o.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),B=this.generateIS(o,s,l)),N=this.remuxAudio(o,G,this.isAudioContiguous,k,q||$||C===_.PlaylistLevelType.AUDIO?j:void 0),$){var X=N?N.endPTS-N.startPTS:0;s.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),B=this.generateIS(o,s,l)),P=this.remuxVideo(s,j,te,X)}}else $&&(P=this.remuxVideo(s,j,te,0));P&&(P.firstKeyFrame=ie,P.independent=ie!==-1)}}return this.ISGenerated&&(r.samples.length&&(U=this.remuxID3(r,l)),c.samples.length&&(F=this.remuxText(c,l))),{audio:N,video:P,initSegment:B,independent:H,text:F,id3:U}},p.generateIS=function(o,s,r){var c=o.samples,l=s.samples,k=this.typeSupported,x={},C=!Object(D.isFiniteNumber)(this._initPTS),P="audio/mp4",N,B,F;if(C&&(N=B=1/0),o.config&&c.length&&(o.timescale=o.samplerate,o.isAAC||(k.mpeg?(P="audio/mpeg",o.codec=""):k.mp3&&(o.codec="mp3")),x.audio={id:"audio",container:P,codec:o.codec,initSegment:!o.isAAC&&k.mpeg?new Uint8Array(0):b.default.initSegment([o]),metadata:{channelCount:o.channelCount}},C&&(F=o.inputTimeScale,N=B=c[0].pts-Math.round(F*r))),s.sps&&s.pps&&l.length&&(s.timescale=s.inputTimeScale,x.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:b.default.initSegment([s]),metadata:{width:s.width,height:s.height}},C)){F=s.inputTimeScale;var U=this.getVideoStartPts(l),H=Math.round(F*r);B=Math.min(B,h(l[0].dts,U)-H),N=Math.min(N,U-H)}if(Object.keys(x).length)return this.ISGenerated=!0,C&&(this._initPTS=N,this._initDTS=B),{tracks:x,initPTS:N,timescale:F}},p.remuxVideo=function(o,s,r,c){var l=o.inputTimeScale,k=o.samples,x=[],C=k.length,P=this._initPTS,N=this.nextAvcDts,B=8,F,U,H,G=Number.POSITIVE_INFINITY,j=Number.NEGATIVE_INFINITY,V=0,q=!1;if(!r||N===null){var W=s*l,Y=k[0].pts-h(k[0].dts,k[0].pts);N=W-Y}for(var $=0;$<C;$++){var Z=k[$];if(Z.pts=h(Z.pts-P,N),Z.dts=h(Z.dts-P,N),Z.dts>Z.pts){var te=9e4*.2;V=Math.max(Math.min(V,Z.pts-Z.dts),-1*te)}Z.dts<k[$>0?$-1:$].dts&&(q=!0)}q&&k.sort(function(Xr,Jr){var xn=Xr.dts-Jr.dts,Cn=Xr.pts-Jr.pts;return xn||Cn}),U=k[0].dts,H=k[k.length-1].dts;var ie=Math.round((H-U)/(C-1));if(V<0){if(V<ie*-2){R.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(u.toMsFromMpegTsClock)(-ie,!0)+" ms");for(var ve=V,ae=0;ae<C;ae++)k[ae].dts=ve=Math.max(ve,k[ae].pts-ie),k[ae].pts=Math.max(ve,k[ae].pts)}else{R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(u.toMsFromMpegTsClock)(V,!0)+" ms to overcome this issue");for(var re=0;re<C;re++)k[re].dts=k[re].dts+V}U=k[0].dts}if(r){var Q=U-N,X=Q>ie,z=Q<-1;if(X||z){X?R.logger.warn("AVC: "+Object(u.toMsFromMpegTsClock)(Q,!0)+" ms ("+Q+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(u.toMsFromMpegTsClock)(-Q,!0)+" ms ("+Q+"dts) overlapping between fragments detected"),U=N;var oe=k[0].pts-Q;k[0].dts=U,k[0].pts=oe,R.logger.log("Video: First PTS/DTS adjusted: "+Object(u.toMsFromMpegTsClock)(oe,!0)+"/"+Object(u.toMsFromMpegTsClock)(U,!0)+", delta: "+Object(u.toMsFromMpegTsClock)(Q,!0)+" ms")}}t&&(U=Math.max(0,U));for(var he=0,fe=0,ge=0;ge<C;ge++){for(var de=k[ge],pe=de.units,se=pe.length,ue=0,Se=0;Se<se;Se++)ue+=pe[Se].data.length;fe+=ue,he+=se,de.length=ue,de.dts=Math.max(de.dts,U),de.pts=Math.max(de.pts,de.dts,0),G=Math.min(de.pts,G),j=Math.max(de.pts,j)}H=k[C-1].dts;var Ie=fe+4*he+8,Te;try{Te=new Uint8Array(Ie)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:L.ErrorTypes.MUX_ERROR,details:L.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ie,reason:"fail allocating video mdat "+Ie});return}var Fe=new DataView(Te.buffer);Fe.setUint32(0,Ie),Te.set(b.default.types.mdat,4);for(var me=0;me<C;me++){for(var Re=k[me],ze=Re.units,Me=0,Oe=0,et=ze.length;Oe<et;Oe++){var Pe=ze[Oe],De=Pe.data,Ue=Pe.data.byteLength;Fe.setUint32(B,Ue),B+=4,Te.set(De,B),B+=Ue,Me+=4+Ue}if(me<C-1)F=k[me+1].dts-Re.dts;else{var tt=this.config,Be=Re.dts-k[me>0?me-1:me].dts;if(tt.stretchShortVideoTrack&&this.nextAudioPts!==null){var kn=Math.floor(tt.maxBufferHole*l),Dt=(c?G+c*l:this.nextAudioPts)-Re.pts;Dt>kn?(F=Dt-Be,F<0&&(F=Be),R.logger.log("[mp4-remuxer]: It is approximately "+Dt/90+" ms to the next segment; using duration "+F/90+" ms for the last video frame.")):F=Be}else F=Be}var Rn=Math.round(Re.pts-Re.dts);x.push(new f(Re.key,F,Me,Rn))}if(x.length&&d&&d<70){var Qr=x[0].flags;Qr.dependsOn=2,Qr.isNonSync=0}console.assert(F!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=N=H+F,this.isVideoContiguous=!0;var Dn=b.default.moof(o.sequenceNumber++,U,m({},o,{samples:x})),wn="video",In={data1:Dn,data2:Te,startPTS:G/l,endPTS:(j+F)/l,startDTS:U/l,endDTS:N/l,type:wn,hasAudio:!1,hasVideo:!0,nb:x.length,dropped:o.dropped};return o.samples=[],o.dropped=0,console.assert(Te.length,"MDAT length must not be zero"),In},p.remuxAudio=function(o,s,r,c,l){var k=o.inputTimeScale,x=o.samplerate?o.samplerate:k,C=k/x,P=o.isAAC?E:A,N=P*C,B=this._initPTS,F=!o.isAAC&&this.typeSupported.mpeg,U=[],H=o.samples,G=F?0:8,j=this.nextAudioPts||-1,V=s*k;if(this.isAudioContiguous=r=r||H.length&&j>0&&(c&&Math.abs(V-j)<9e3||Math.abs(h(H[0].pts-B,V)-j)<20*N),H.forEach(function(De){De.pts=h(De.pts-B,V)}),!r||j<0){if(H=H.filter(function(De){return De.pts>=0}),!H.length)return;l===0?j=0:c?j=Math.max(0,V):j=H[0].pts}if(o.isAAC)for(var q=l!==void 0,W=this.config.maxAudioFramesDrift,Y=0,$=j;Y<H.length;Y++){var Z=H[Y],te=Z.pts,ie=te-$,ve=Math.abs(1e3*ie/k);if(ie<=-W*N&&q)Y===0&&(R.logger.warn("Audio frame @ "+(te/k).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ie/k)+" ms."),this.nextAudioPts=j=$=te);else if(ie>=W*N&&ve<S&&q){var ae=Math.round(ie/N);$=te-ae*N,$<0&&(ae--,$+=N),Y===0&&(this.nextAudioPts=j=$),R.logger.warn("[mp4-remuxer]: Injecting "+ae+" audio frame @ "+($/k).toFixed(3)+"s due to "+Math.round(1e3*ie/k)+" ms gap.");for(var re=0;re<ae;re++){var Q=Math.max($,0),X=y.default.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);X||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),X=Z.unit.subarray()),H.splice(Y,0,{unit:X,pts:Q}),$+=N,Y++}}Z.pts=$,$+=N}for(var z=null,oe=null,he,fe=0,ge=H.length;ge--;)fe+=H[ge].unit.byteLength;for(var de=0,pe=H.length;de<pe;de++){var se=H[de],ue=se.unit,Se=se.pts;if(oe!==null){var Ie=U[de-1];Ie.duration=Math.round((Se-oe)/C)}else if(r&&o.isAAC&&(Se=j),z=Se,fe>0){fe+=G;try{he=new Uint8Array(fe)}catch{this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:L.ErrorTypes.MUX_ERROR,details:L.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:fe,reason:"fail allocating audio mdat "+fe});return}if(!F){var Te=new DataView(he.buffer);Te.setUint32(0,fe),he.set(b.default.types.mdat,4)}}else return;he.set(ue,G);var Fe=ue.byteLength;G+=Fe,U.push(new f(!0,P,Fe,0)),oe=Se}var me=U.length;if(me){var Re=U[U.length-1];this.nextAudioPts=j=oe+C*Re.duration;var ze=F?new Uint8Array(0):b.default.moof(o.sequenceNumber++,z/C,m({},o,{samples:U}));o.samples=[];var Me=z/k,Oe=j/k,et="audio",Pe={data1:ze,data2:he,startPTS:Me,endPTS:Oe,startDTS:Me,endDTS:Oe,type:et,hasAudio:!0,hasVideo:!1,nb:me};return this.isAudioContiguous=!0,console.assert(he.length,"MDAT length must not be zero"),Pe}},p.remuxEmptyAudio=function(o,s,r,c){var l=o.inputTimeScale,k=o.samplerate?o.samplerate:l,x=l/k,C=this.nextAudioPts,P=(C!==null?C:c.startDTS*l)+this._initDTS,N=c.endDTS*l+this._initDTS,B=x*E,F=Math.ceil((N-P)/B),U=y.default.getSilentFrame(o.manifestCodec||o.codec,o.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!U){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var H=[],G=0;G<F;G++){var j=P+G*B;H.push({unit:U,pts:j,dts:j})}return o.samples=H,this.remuxAudio(o,s,r,!1)},p.remuxID3=function(o,s){var r=o.samples.length;if(r){for(var c=o.inputTimeScale,l=this._initPTS,k=this._initDTS,x=0;x<r;x++){var C=o.samples[x];C.pts=h(C.pts-l,s*c)/c,C.dts=h(C.dts-k,s*c)/c}var P=o.samples;return o.samples=[],{samples:P}}},p.remuxText=function(o,s){var r=o.samples.length;if(r){for(var c=o.inputTimeScale,l=this._initPTS,k=0;k<r;k++){var x=o.samples[k];x.pts=h(x.pts-l,s*c)/c}o.samples.sort(function(P,N){return P.pts-N.pts});var C=o.samples;return o.samples=[],{samples:C}}},T}();function h(T,p){var o;if(p===null)return T;for(p<T?o=-8589934592:o=8589934592;Math.abs(T-p)>4294967296;)T+=o;return T}function n(T){for(var p=0;p<T.length;p++)if(T[p].key)return p;return-1}var f=function(T,p,o,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=p,this.size=o,this.cts=s,this.flags=new g(T)},g=function(T){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=T?2:1,this.isNonSync=T?0:1}},"./src/remux/passthrough-remuxer.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/polyfills/number.ts"),y=a("./src/utils/mp4-tools.ts"),b=a("./src/loader/fragment.ts"),I=a("./src/utils/logger.ts"),L=function(){function u(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var m=u.prototype;return m.destroy=function(){},m.resetTimeStamp=function(S){this.initPTS=S,this.lastEndDTS=null},m.resetNextTimestamp=function(){this.lastEndDTS=null},m.resetInitSegment=function(S,E,A){this.audioCodec=E,this.videoCodec=A,this.generateInitSegment(S),this.emitInitSegment=!0},m.generateInitSegment=function(S){var E=this.audioCodec,A=this.videoCodec;if(!S||!S.byteLength){this.initTracks=void 0,this.initData=void 0;return}var d=this.initData=Object(y.parseInitSegment)(S);E||(E=_(d.audio,b.ElementaryStreamTypes.AUDIO)),A||(A=_(d.video,b.ElementaryStreamTypes.VIDEO));var e={};d.audio&&d.video?e.audiovideo={container:"video/mp4",codec:E+","+A,initSegment:S,id:"main"}:d.audio?e.audio={container:"audio/mp4",codec:E,initSegment:S,id:"audio"}:d.video?e.video={container:"video/mp4",codec:A,initSegment:S,id:"main"}:I.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},m.remux=function(S,E,A,d,e){var t=this.initPTS,i=this.lastEndDTS,h={audio:void 0,video:void 0,text:d,id3:A,initSegment:void 0};Object(D.isFiniteNumber)(i)||(i=this.lastEndDTS=e||0);var n=E.samples;if(!n||!n.length)return h;var f={initPTS:void 0,timescale:1},g=this.initData;if((!g||!g.length)&&(this.generateInitSegment(n),g=this.initData),!g||!g.length)return I.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(D.isFiniteNumber)(t)||(this.initPTS=f.initPTS=t=R(g,n,i));var T=Object(y.getDuration)(n,g),p=i,o=T+p;Object(y.offsetStartDTS)(g,n,t),T>0?this.lastEndDTS=o:(I.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var s=!!g.audio,r=!!g.video,c="";s&&(c+="audio"),r&&(c+="video");var l={data1:n,startPTS:p,startDTS:p,endPTS:o,endDTS:o,type:c,hasAudio:s,hasVideo:r,nb:1,dropped:0};return h.audio=l.type==="audio"?l:void 0,h.video=l.type!=="audio"?l:void 0,h.text=d,h.id3=A,h.initSegment=f,h},u}(),R=function(u,m,S){return Object(y.getStartDTS)(u,m)-S};function _(u,m){var S=u==null?void 0:u.codec;return S&&S.length>4?S:S==="hvc1"?"hvc1.1.c.L120.90":S==="av01"?"av01.0.04M.08":S==="avc1"||m===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}w.default=L},"./src/task-loop.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return D});var D=function(){function y(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=y.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(I){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,I),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},y}()},"./src/types/level.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"HlsSkip",function(){return b}),a.d(w,"getSkipValue",function(){return I}),a.d(w,"HlsUrlParameters",function(){return L}),a.d(w,"Level",function(){return R});function D(_,u){for(var m=0;m<u.length;m++){var S=u[m];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(_,S.key,S)}}function y(_,u,m){return u&&D(_.prototype,u),m&&D(_,m),_}var b;(function(_){_.No="",_.Yes="YES",_.v2="v2"})(b||(b={}));function I(_,u){var m=_.canSkipUntil,S=_.canSkipDateRanges,E=_.endSN,A=u!==void 0?u-E:0;return m&&A<m?S?b.v2:b.Yes:b.No}var L=function(){function _(m,S,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=m,this.part=S,this.skip=E}var u=_.prototype;return u.addDirectives=function(m){var S=new self.URL(m);return this.msn!==void 0&&S.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&S.searchParams.set("_HLS_part",this.part.toString()),this.skip&&S.searchParams.set("_HLS_skip",this.skip),S.toString()},_}(),R=function(){function _(u){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[u.url],this.attrs=u.attrs,this.bitrate=u.bitrate,u.details&&(this.details=u.details),this.id=u.id||0,this.name=u.name,this.width=u.width||0,this.height=u.height||0,this.audioCodec=u.audioCodec,this.videoCodec=u.videoCodec,this.unknownCodecs=u.unknownCodecs,this.codecSet=[u.videoCodec,u.audioCodec].filter(function(m){return m}).join(",").replace(/\.[^.,]+/g,"")}return y(_,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(u){var m=u%this.url.length;this._urlId!==m&&(this.details=void 0,this._urlId=m)}}]),_}()},"./src/types/loader.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"PlaylistContextType",function(){return D}),a.d(w,"PlaylistLevelType",function(){return y});var D;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(D||(D={}));var y;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(y||(y={}))},"./src/types/transmuxer.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"ChunkMetadata",function(){return D});var D=function(b,I,L,R,_,u){R===void 0&&(R=0),_===void 0&&(_=-1),u===void 0&&(u=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=y(),this.buffering={audio:y(),video:y(),audiovideo:y()},this.level=b,this.sn=I,this.id=L,this.size=R,this.part=_,this.partial=u};function y(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"AttrList",function(){return b});var D=/^(\d+)x(\d+)$/,y=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function I(R){typeof R=="string"&&(R=I.parseAttrList(R));for(var _ in R)R.hasOwnProperty(_)&&(this[_]=R[_])}var L=I.prototype;return L.decimalInteger=function(R){var _=parseInt(this[R],10);return _>Number.MAX_SAFE_INTEGER?1/0:_},L.hexadecimalInteger=function(R){if(this[R]){var _=(this[R]||"0x").slice(2);_=(_.length&1?"0":"")+_;for(var u=new Uint8Array(_.length/2),m=0;m<_.length/2;m++)u[m]=parseInt(_.slice(m*2,m*2+2),16);return u}else return null},L.hexadecimalIntegerAsNumber=function(R){var _=parseInt(this[R],16);return _>Number.MAX_SAFE_INTEGER?1/0:_},L.decimalFloatingPoint=function(R){return parseFloat(this[R])},L.optionalFloat=function(R,_){var u=this[R];return u?parseFloat(u):_},L.enumeratedString=function(R){return this[R]},L.bool=function(R){return this[R]==="YES"},L.decimalResolution=function(R){var _=D.exec(this[R]);if(_!==null)return{width:parseInt(_[1],10),height:parseInt(_[2],10)}},I.parseAttrList=function(R){var _,u={},m='"';for(y.lastIndex=0;(_=y.exec(R))!==null;){var S=_[2];S.indexOf(m)===0&&S.lastIndexOf(m)===S.length-1&&(S=S.slice(1,-1)),u[_[1]]=S}return u},I}()},"./src/utils/binary-search.ts":function(O,w,a){"use strict";a.r(w);var D={search:function(y,b){for(var I=0,L=y.length-1,R=null,_=null;I<=L;){R=(I+L)/2|0,_=y[R];var u=b(_);if(u>0)I=R+1;else if(u<0)L=R-1;else return _}return null}};w.default=D},"./src/utils/buffer-helper.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"BufferHelper",function(){return b});var D=a("./src/utils/logger.ts"),y={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function I(){}return I.isBuffered=function(L,R){try{if(L){for(var _=I.getBuffered(L),u=0;u<_.length;u++)if(R>=_.start(u)&&R<=_.end(u))return!0}}catch{}return!1},I.bufferInfo=function(L,R,_){try{if(L){var u=I.getBuffered(L),m=[],S;for(S=0;S<u.length;S++)m.push({start:u.start(S),end:u.end(S)});return this.bufferedInfo(m,R,_)}}catch{}return{len:0,start:R,end:R,nextStart:void 0}},I.bufferedInfo=function(L,R,_){R=Math.max(0,R),L.sort(function(f,g){var T=f.start-g.start;return T||g.end-f.end});var u=[];if(_)for(var m=0;m<L.length;m++){var S=u.length;if(S){var E=u[S-1].end;L[m].start-E<_?L[m].end>E&&(u[S-1].end=L[m].end):u.push(L[m])}else u.push(L[m])}else u=L;for(var A=0,d,e=R,t=R,i=0;i<u.length;i++){var h=u[i].start,n=u[i].end;if(R+_>=h&&R<n)e=h,t=n,A=t-R;else if(R+_<h){d=h;break}}return{len:A,start:e||0,end:t||0,nextStart:d}},I.getBuffered=function(L){try{return L.buffered}catch(R){return D.logger.log("failed to get media.buffered",R),y}},I}()},"./src/utils/cea-608-parser.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"Row",function(){return i}),a.d(w,"CaptionScreen",function(){return h});var D=a("./src/utils/logger.ts"),y={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(o){var s=o;return y.hasOwnProperty(o)&&(s=y[o]),String.fromCharCode(s)},I=15,L=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_={17:2,18:4,21:6,22:8,23:10,19:13,20:15},u={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},m={25:2,26:4,29:6,30:8,31:10,27:13,28:15},S=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(E||(E={}));var A=function(){function o(){this.time=null,this.verboseLevel=E.ERROR}var s=o.prototype;return s.log=function(r,c){this.verboseLevel>=r&&D.logger.log(this.time+" ["+r+"] "+c)},o}(),d=function(o){for(var s=[],r=0;r<o.length;r++)s.push(o[r].toString(16));return s},e=function(){function o(r,c,l,k,x){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=r||"white",this.underline=c||!1,this.italics=l||!1,this.background=k||"black",this.flash=x||!1}var s=o.prototype;return s.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},s.setStyles=function(r){for(var c=["foreground","underline","italics","background","flash"],l=0;l<c.length;l++){var k=c[l];r.hasOwnProperty(k)&&(this[k]=r[k])}},s.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},s.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},s.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},s.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),t=function(){function o(r,c,l,k,x,C){this.uchar=void 0,this.penState=void 0,this.uchar=r||" ",this.penState=new e(c,l,k,x,C)}var s=o.prototype;return s.reset=function(){this.uchar=" ",this.penState.reset()},s.setChar=function(r,c){this.uchar=r,this.penState.copy(c)},s.setPenState=function(r){this.penState.copy(r)},s.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},s.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},s.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),i=function(){function o(r){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var c=0;c<L;c++)this.chars.push(new t);this.logger=r,this.pos=0,this.currPenState=new e}var s=o.prototype;return s.equals=function(r){for(var c=!0,l=0;l<L;l++)if(!this.chars[l].equals(r.chars[l])){c=!1;break}return c},s.copy=function(r){for(var c=0;c<L;c++)this.chars[c].copy(r.chars[c])},s.isEmpty=function(){for(var r=!0,c=0;c<L;c++)if(!this.chars[c].isEmpty()){r=!1;break}return r},s.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>L&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=L)},s.moveCursor=function(r){var c=this.pos+r;if(r>1)for(var l=this.pos+1;l<c+1;l++)this.chars[l].setPenState(this.currPenState);this.setCursor(c)},s.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},s.insertChar=function(r){r>=144&&this.backSpace();var c=b(r);if(this.pos>=L){this.logger.log(E.ERROR,"Cannot insert "+r.toString(16)+" ("+c+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(c,this.currPenState),this.moveCursor(1)},s.clearFromPos=function(r){var c;for(c=r;c<L;c++)this.chars[c].reset()},s.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},s.clearToEndOfRow=function(){this.clearFromPos(this.pos)},s.getTextString=function(){for(var r=[],c=!0,l=0;l<L;l++){var k=this.chars[l].uchar;k!==" "&&(c=!1),r.push(k)}return c?"":r.join("")},s.setPenStyles=function(r){this.currPenState.setStyles(r);var c=this.chars[this.pos];c.setPenState(this.currPenState)},o}(),h=function(){function o(r){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var c=0;c<I;c++)this.rows.push(new i(r));this.logger=r,this.currRow=I-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var s=o.prototype;return s.reset=function(){for(var r=0;r<I;r++)this.rows[r].clear();this.currRow=I-1},s.equals=function(r){for(var c=!0,l=0;l<I;l++)if(!this.rows[l].equals(r.rows[l])){c=!1;break}return c},s.copy=function(r){for(var c=0;c<I;c++)this.rows[c].copy(r.rows[c])},s.isEmpty=function(){for(var r=!0,c=0;c<I;c++)if(!this.rows[c].isEmpty()){r=!1;break}return r},s.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},s.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},s.insertChar=function(r){var c=this.rows[this.currRow];c.insertChar(r)},s.setPen=function(r){var c=this.rows[this.currRow];c.setPenStyles(r)},s.moveCursor=function(r){var c=this.rows[this.currRow];c.moveCursor(r)},s.setCursor=function(r){this.logger.log(E.INFO,"setCursor: "+r);var c=this.rows[this.currRow];c.setCursor(r)},s.setPAC=function(r){this.logger.log(E.INFO,"pacData = "+JSON.stringify(r));var c=r.row-1;if(this.nrRollUpRows&&c<this.nrRollUpRows-1&&(c=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==c){for(var l=0;l<I;l++)this.rows[l].clear();var k=this.currRow+1-this.nrRollUpRows,x=this.lastOutputScreen;if(x){var C=x.rows[k].cueStartTime,P=this.logger.time;if(C&&P!==null&&C<P)for(var N=0;N<this.nrRollUpRows;N++)this.rows[c-this.nrRollUpRows+N+1].copy(x.rows[k+N])}}this.currRow=c;var B=this.rows[this.currRow];if(r.indent!==null){var F=r.indent,U=Math.max(F-1,0);B.setCursor(r.indent),r.color=B.chars[U].penState.foreground}var H={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(H)},s.setBkgData=function(r){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)},s.setRollUpRows=function(r){this.nrRollUpRows=r},s.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,c=this.rows.splice(r,1)[0];c.clear(),this.rows.splice(this.currRow,0,c),this.logger.log(E.INFO,"Rolling up")},s.getDisplayText=function(r){r=r||!1;for(var c=[],l="",k=-1,x=0;x<I;x++){var C=this.rows[x].getTextString();C&&(k=x+1,r?c.push("Row "+k+": '"+C+"'"):c.push(C.trim()))}return c.length>0&&(r?l="["+c.join(" | ")+"]":l=c.join(`
`)),l},s.getTextAndFormat=function(){return this.rows},o}(),n=function(){function o(r,c,l){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=c,this.mode=null,this.verbose=0,this.displayedMemory=new h(l),this.nonDisplayedMemory=new h(l),this.lastOutputScreen=new h(l),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=l}var s=o.prototype;return s.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[I-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},s.getHandler=function(){return this.outputFilter},s.setHandler=function(r){this.outputFilter=r},s.setPAC=function(r){this.writeScreen.setPAC(r)},s.setBkgData=function(r){this.writeScreen.setBkgData(r)},s.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(E.INFO,"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},s.insertChars=function(r){for(var c=0;c<r.length;c++)this.writeScreen.insertChar(r[c]);var l=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,l+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},s.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},s.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},s.ccAOF=function(){},s.ccAON=function(){},s.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},s.ccRU=function(r){this.logger.log(E.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},s.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},s.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},s.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},s.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},s.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},s.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},s.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},s.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},s.ccTO=function(r){this.logger.log(E.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},s.ccMIDROW=function(r){var c={flash:!1};if(c.underline=r%2==1,c.italics=r>=46,c.italics)c.foreground="white";else{var l=Math.floor(r/2)-16,k=["white","green","blue","cyan","red","yellow","magenta"];c.foreground=k[l]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(c)),this.writeScreen.setPen(c)},s.outputDataUpdate=function(r){r===void 0&&(r=!1);var c=this.logger.time;c!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=c:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,c,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:c),this.lastOutputScreen.copy(this.displayedMemory))},s.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},o}(),f=function(){function o(r,c,l){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var k=new A;this.channels=[null,new n(r,c,k),new n(r+1,l,k)],this.cmdHistory=p(),this.logger=k}var s=o.prototype;return s.getHandler=function(r){return this.channels[r].getHandler()},s.setHandler=function(r,c){this.channels[r].setHandler(c)},s.addData=function(r,c){var l,k,x,C=!1;this.logger.time=r;for(var P=0;P<c.length;P+=2)if(k=c[P]&127,x=c[P+1]&127,!(k===0&&x===0)){if(this.logger.log(E.DATA,"["+d([c[P],c[P+1]])+"] -> ("+d([k,x])+")"),l=this.parseCmd(k,x),l||(l=this.parseMidrow(k,x)),l||(l=this.parsePAC(k,x)),l||(l=this.parseBackgroundAttributes(k,x)),!l&&(C=this.parseChars(k,x),C)){var N=this.currentChannel;if(N&&N>0){var B=this.channels[N];B.insertChars(C)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!l&&!C&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+d([k,x])+" orig: "+d([c[P],c[P+1]]))}},s.parseCmd=function(r,c){var l=this.cmdHistory,k=(r===20||r===28||r===21||r===29)&&c>=32&&c<=47,x=(r===23||r===31)&&c>=33&&c<=35;if(!(k||x))return!1;if(T(r,c,l))return g(null,null,l),this.logger.log(E.DEBUG,"Repeated command ("+d([r,c])+") is dropped"),!0;var C=r===20||r===21||r===23?1:2,P=this.channels[C];return r===20||r===21||r===28||r===29?c===32?P.ccRCL():c===33?P.ccBS():c===34?P.ccAOF():c===35?P.ccAON():c===36?P.ccDER():c===37?P.ccRU(2):c===38?P.ccRU(3):c===39?P.ccRU(4):c===40?P.ccFON():c===41?P.ccRDC():c===42?P.ccTR():c===43?P.ccRTD():c===44?P.ccEDM():c===45?P.ccCR():c===46?P.ccENM():c===47&&P.ccEOC():P.ccTO(c-32),g(r,c,l),this.currentChannel=C,!0},s.parseMidrow=function(r,c){var l=0;if((r===17||r===25)&&c>=32&&c<=47){if(r===17?l=1:l=2,l!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var k=this.channels[l];return k?(k.ccMIDROW(c),this.logger.log(E.DEBUG,"MIDROW ("+d([r,c])+")"),!0):!1}return!1},s.parsePAC=function(r,c){var l,k=this.cmdHistory,x=(r>=17&&r<=23||r>=25&&r<=31)&&c>=64&&c<=127,C=(r===16||r===24)&&c>=64&&c<=95;if(!(x||C))return!1;if(T(r,c,k))return g(null,null,k),!0;var P=r<=23?1:2;c>=64&&c<=95?l=P===1?R[r]:u[r]:l=P===1?_[r]:m[r];var N=this.channels[P];return N?(N.setPAC(this.interpretPAC(l,c)),g(r,c,k),this.currentChannel=P,!0):!1},s.interpretPAC=function(r,c){var l,k={color:null,italics:!1,indent:null,underline:!1,row:r};return c>95?l=c-96:l=c-64,k.underline=(l&1)==1,l<=13?k.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(l/2)]:l<=15?(k.italics=!0,k.color="white"):k.indent=Math.floor((l-16)/2)*4,k},s.parseChars=function(r,c){var l,k=null,x=null;if(r>=25?(l=2,x=r-8):(l=1,x=r),x>=17&&x<=19){var C;x===17?C=c+80:x===18?C=c+112:C=c+144,this.logger.log(E.INFO,"Special char '"+b(C)+"' in channel "+l),k=[C]}else r>=32&&r<=127&&(k=c===0?[r]:[r,c]);if(k){var P=d(k);this.logger.log(E.DEBUG,"Char codes =  "+P.join(",")),g(r,c,this.cmdHistory)}return k},s.parseBackgroundAttributes=function(r,c){var l=(r===16||r===24)&&c>=32&&c<=47,k=(r===23||r===31)&&c>=45&&c<=47;if(!(l||k))return!1;var x,C={};r===16||r===24?(x=Math.floor((c-32)/2),C.background=S[x],c%2==1&&(C.background=C.background+"_semi")):c===45?C.background="transparent":(C.foreground="black",c===47&&(C.underline=!0));var P=r<=23?1:2,N=this.channels[P];return N.setBkgData(C),g(r,c,this.cmdHistory),!0},s.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var c=this.channels[r];c&&c.reset()}this.cmdHistory=p()},s.cueSplitAtTime=function(r){for(var c=0;c<this.channels.length;c++){var l=this.channels[c];l&&l.cueSplitAtTime(r)}},o}();function g(o,s,r){r.a=o,r.b=s}function T(o,s,r){return r.a===o&&r.b===s}function p(){return{a:null,b:null}}w.default=f},"./src/utils/codecs.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"isCodecType",function(){return y}),a.d(w,"isCodecSupportedInMp4",function(){return b});var D={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function y(I,L){var R=D[L];return!!R&&R[I.slice(0,4)]===!0}function b(I,L){return MediaSource.isTypeSupported((L||"video")+'/mp4;codecs="'+I+'"')}},"./src/utils/cues.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/utils/vttparser.ts"),y=a("./src/utils/webvtt-parser.ts"),b=a("./src/utils/texttrack-utils.ts"),I=/\s/,L={newCue:function(R,_,u,m){for(var S=[],E,A,d,e,t,i=self.VTTCue||self.TextTrackCue,h=0;h<m.rows.length;h++)if(E=m.rows[h],d=!0,e=0,t="",!E.isEmpty()){for(var n=0;n<E.chars.length;n++)I.test(E.chars[n].uchar)&&d?e++:(t+=E.chars[n].uchar,d=!1);E.cueStartTime=_,_===u&&(u+=1e-4),e>=16?e--:e++;var f=Object(D.fixLineBreaks)(t.trim()),g=Object(y.generateCueId)(_,u,f);(!R||!R.cues||!R.cues.getCueById(g))&&(A=new i(_,u,f),A.id=g,A.line=h+1,A.align="left",A.position=10+Math.min(80,Math.floor(e*8/32)*10),S.push(A))}return R&&S.length&&(S.sort(function(T,p){return T.line==="auto"||p.line==="auto"?0:T.line>8&&p.line>8?p.line-T.line:T.line-p.line}),S.forEach(function(T){return Object(b.addCueToTrack)(R,T)})),S}};w.default=L},"./src/utils/discontinuities.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"findFirstFragWithCC",function(){return I}),a.d(w,"shouldAlignOnDiscontinuities",function(){return L}),a.d(w,"findDiscontinuousReferenceFrag",function(){return R}),a.d(w,"adjustSlidingStart",function(){return u}),a.d(w,"alignStream",function(){return m}),a.d(w,"alignPDT",function(){return E}),a.d(w,"alignFragmentByPDTDelta",function(){return A}),a.d(w,"alignMediaPlaylistByPDT",function(){return d});var D=a("./src/polyfills/number.ts"),y=a("./src/utils/logger.ts"),b=a("./src/controller/level-helper.ts");function I(e,t){for(var i=null,h=0,n=e.length;h<n;h++){var f=e[h];if(f&&f.cc===t){i=f;break}}return i}function L(e,t,i){return!!(t.details&&(i.endCC>i.startCC||e&&e.cc<i.startCC))}function R(e,t){var i=e.fragments,h=t.fragments;if(!h.length||!i.length){y.logger.log("No fragments to align");return}var n=I(i,h[0].cc);if(!n||n&&!n.startPTS){y.logger.log("No frag in previous level to align on");return}return n}function _(e,t){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function u(e,t){for(var i=t.fragments,h=0,n=i.length;h<n;h++)_(i[h],e);t.fragmentHint&&_(t.fragmentHint,e),t.alignedSliding=!0}function m(e,t,i){!t||(S(e,i,t),!i.alignedSliding&&t.details&&E(i,t.details),!i.alignedSliding&&t.details&&!i.skippedSegments&&Object(b.adjustSliding)(t.details,i))}function S(e,t,i){if(L(e,i,t)){var h=R(i.details,t);h&&Object(D.isFiniteNumber)(h.start)&&(y.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),u(h.start,t))}}function E(e,t){if(!(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)){var i=t.fragments[0].programDateTime,h=e.fragments[0].programDateTime,n=(h-i)/1e3+t.fragments[0].start;n&&Object(D.isFiniteNumber)(n)&&(y.logger.log("Adjusting PTS using programDateTime delta "+(h-i)+"ms, sliding:"+n.toFixed(3)+" "+e.url+" "),u(n,e))}}function A(e,t){var i=e.programDateTime;if(i){var h=(i-t)/1e3;e.start=e.startPTS=h,e.endPTS=h+e.duration}}function d(e,t){if(!(!t.fragments.length||!e.hasProgramDateTime||!t.hasProgramDateTime)){var i=t.fragments[0].programDateTime,h=t.fragments[0].start,n=i-h*1e3;e.fragments.forEach(function(f){A(f,n)}),e.fragmentHint&&A(e.fragmentHint,n),e.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/utils/ewma.ts"),y=function(){function b(L,R,_){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=_,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new D.default(L),this.fast_=new D.default(R)}var I=b.prototype;return I.update=function(L,R){var _=this.slow_,u=this.fast_;this.slow_.halfLife!==L&&(this.slow_=new D.default(L,_.getEstimate(),_.getTotalWeight())),this.fast_.halfLife!==R&&(this.fast_=new D.default(R,u.getEstimate(),u.getTotalWeight()))},I.sample=function(L,R){L=Math.max(L,this.minDelayMs_);var _=8*R,u=L/1e3,m=_/u;this.fast_.sample(u,m),this.slow_.sample(u,m)},I.canEstimate=function(){var L=this.fast_;return L&&L.getTotalWeight()>=this.minWeight_},I.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},I.destroy=function(){},b}();w.default=y},"./src/utils/ewma.ts":function(O,w,a){"use strict";a.r(w);var D=function(){function y(I,L,R){L===void 0&&(L=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=I,this.alpha_=I?Math.exp(Math.log(.5)/I):0,this.estimate_=L,this.totalWeight_=R}var b=y.prototype;return b.sample=function(I,L){var R=Math.pow(this.alpha_,I);this.estimate_=L*(1-R)+R*this.estimate_,this.totalWeight_+=I},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var I=1-Math.pow(this.alpha_,this.totalWeight_);if(I)return this.estimate_/I}return this.estimate_},y}();w.default=D},"./src/utils/fetch-loader.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"fetchSupported",function(){return E});var D=a("./src/polyfills/number.ts"),y=a("./src/loader/load-stats.ts"),b=a("./src/demux/chunk-cache.ts");function I(i,h){i.prototype=Object.create(h.prototype),i.prototype.constructor=i,m(i,h)}function L(i){var h=typeof Map=="function"?new Map:void 0;return L=function(n){if(n===null||!u(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof h!="undefined"){if(h.has(n))return h.get(n);h.set(n,f)}function f(){return R(n,arguments,S(this).constructor)}return f.prototype=Object.create(n.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),m(f,n)},L(i)}function R(i,h,n){return _()?R=Reflect.construct:R=function(f,g,T){var p=[null];p.push.apply(p,g);var o=Function.bind.apply(f,p),s=new o;return T&&m(s,T.prototype),s},R.apply(null,arguments)}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function u(i){return Function.toString.call(i).indexOf("[native code]")!==-1}function m(i,h){return m=Object.setPrototypeOf||function(n,f){return n.__proto__=f,n},m(i,h)}function S(i){return S=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},S(i)}function E(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var A=function(){function i(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||e,this.controller=new self.AbortController,this.stats=new y.LoadStats}var h=i.prototype;return h.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},h.abortInternal=function(){var n=this.response;(!n||!n.ok)&&(this.stats.aborted=!0,this.controller.abort())},h.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},h.load=function(n,f,g){var T=this,p=this.stats;if(p.loading.start)throw new Error("Loader can only be used once.");p.loading.start=self.performance.now();var o=d(n,this.controller.signal),s=g.onProgress,r=n.responseType==="arraybuffer",c=r?"byteLength":"length";this.context=n,this.config=f,this.callbacks=g,this.request=this.fetchSetup(n,o),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){T.abortInternal(),g.onTimeout(p,n,T.response)},f.timeout),self.fetch(this.request).then(function(l){if(T.response=T.loader=l,!l.ok){var k=l.status,x=l.statusText;throw new t(x||"fetch, bad network response",k,l)}return p.loading.first=Math.max(self.performance.now(),p.loading.start),p.total=parseInt(l.headers.get("Content-Length")||"0"),s&&Object(D.isFiniteNumber)(f.highWaterMark)?T.loadProgressively(l,p,n,f.highWaterMark,s):r?l.arrayBuffer():l.text()}).then(function(l){var k=T.response;self.clearTimeout(T.requestTimeout),p.loading.end=Math.max(self.performance.now(),p.loading.first),p.loaded=p.total=l[c];var x={url:k.url,data:l};s&&!Object(D.isFiniteNumber)(f.highWaterMark)&&s(p,n,l,k),g.onSuccess(x,p,n,k)}).catch(function(l){if(self.clearTimeout(T.requestTimeout),!p.aborted){var k=l.code||0;g.onError({code:k,text:l.message},n,l.details)}})},h.getCacheAge=function(){var n=null;if(this.response){var f=this.response.headers.get("age");n=f?parseFloat(f):null}return n},h.loadProgressively=function(n,f,g,T,p){T===void 0&&(T=0);var o=new b.default,s=n.body.getReader(),r=function c(){return s.read().then(function(l){if(l.done)return o.dataLength&&p(f,g,o.flush(),n),Promise.resolve(new ArrayBuffer(0));var k=l.value,x=k.length;return f.loaded+=x,x<T||o.dataLength?(o.push(k),o.dataLength>=T&&p(f,g,o.flush(),n)):p(f,g,k,n),c()}).catch(function(){return Promise.reject()})};return r()},i}();function d(i,h){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:h};return i.rangeEnd&&(n.headers=new self.Headers({Range:"bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)})),n}function e(i,h){return new self.Request(i.url,h)}var t=function(i){I(h,i);function h(n,f,g){var T;return T=i.call(this,n)||this,T.code=void 0,T.details=void 0,T.code=f,T.details=g,T}return h}(L(Error));w.default=A},"./src/utils/imsc1-ttml-parser.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"IMSC1_CODEC",function(){return u}),a.d(w,"parseIMSC1",function(){return A});var D=a("./src/utils/mp4-tools.ts"),y=a("./src/utils/vttparser.ts"),b=a("./src/utils/vttcue.ts"),I=a("./src/demux/id3.ts"),L=a("./src/utils/timescale-conversion.ts"),R=a("./src/utils/webvtt-parser.ts");function _(){return _=Object.assign||function(o){for(var s=1;s<arguments.length;s++){var r=arguments[s];for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(o[c]=r[c])}return o},_.apply(this,arguments)}var u="stpp.ttml.im1t",m=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,S=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function A(o,s,r,c,l){var k=Object(D.findBox)(new Uint8Array(o),["mdat"]);if(k.length===0){l(new Error("Could not parse IMSC1 mdat"));return}var x=k[0],C=Object(I.utf8ArrayToStr)(new Uint8Array(o,x.start,x.end-x.start)),P=Object(L.toTimescaleFromScale)(s,1,r);try{c(d(C,P))}catch(N){l(N)}}function d(o,s){var r=new DOMParser,c=r.parseFromString(o,"text/xml"),l=c.getElementsByTagName("tt")[0];if(!l)throw new Error("Invalid ttml");var k={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},x=Object.keys(k).reduce(function(F,U){return F[U]=l.getAttribute("ttp:"+U)||k[U],F},{}),C=l.getAttribute("xml:space")!=="preserve",P=t(e(l,"styling","style")),N=t(e(l,"layout","region")),B=e(l,"body","[begin]");return[].map.call(B,function(F){var U=i(F,C);if(!U||!F.hasAttribute("begin"))return null;var H=g(F.getAttribute("begin"),x),G=g(F.getAttribute("dur"),x),j=g(F.getAttribute("end"),x);if(H===null)throw f(F);if(j===null){if(G===null)throw f(F);j=H+G}var V=new b.default(H-s,j-s,U);V.id=Object(R.generateCueId)(V.startTime,V.endTime,V.text);var q=N[F.getAttribute("region")],W=P[F.getAttribute("style")];V.position=10,V.size=80;var Y=h(q,W),$=Y.textAlign;if($){var Z=E[$];Z&&(V.lineAlign=Z),V.align=$}return _(V,Y),V}).filter(function(F){return F!==null})}function e(o,s,r){var c=o.getElementsByTagName(s)[0];return c?[].slice.call(c.querySelectorAll(r)):[]}function t(o){return o.reduce(function(s,r){var c=r.getAttribute("xml:id");return c&&(s[c]=r),s},{})}function i(o,s){return[].slice.call(o.childNodes).reduce(function(r,c,l){var k;return c.nodeName==="br"&&l?r+`
`:(k=c.childNodes)!==null&&k!==void 0&&k.length?i(c,s):s?r+c.textContent.trim().replace(/\s+/g," "):r+c.textContent},"")}function h(o,s){var r="http://www.w3.org/ns/ttml#styling",c=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return c.reduce(function(l,k){var x=n(s,r,k)||n(o,r,k);return x&&(l[k]=x),l},{})}function n(o,s,r){return o.hasAttributeNS(s,r)?o.getAttributeNS(s,r):null}function f(o){return new Error("Could not parse ttml timestamp "+o)}function g(o,s){if(!o)return null;var r=Object(y.parseTimeStamp)(o);return r===null&&(m.test(o)?r=T(o,s):S.test(o)&&(r=p(o,s))),r}function T(o,s){var r=m.exec(o),c=(r[4]|0)+(r[5]|0)/s.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+c/s.frameRate}function p(o,s){var r=S.exec(o),c=Number(r[1]),l=r[2];switch(l){case"h":return c*3600;case"m":return c*60;case"ms":return c*1e3;case"f":return c/s.frameRate;case"t":return c/s.tickRate}return c}},"./src/utils/logger.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"enableLogs",function(){return R}),a.d(w,"logger",function(){return _});var D=function(){},y={trace:D,debug:D,log:D,warn:D,info:D,error:D},b=y;function I(u){var m=self.console[u];return m?m.bind(self.console,"["+u+"] >"):D}function L(u){for(var m=arguments.length,S=new Array(m>1?m-1:0),E=1;E<m;E++)S[E-1]=arguments[E];S.forEach(function(A){b[A]=u[A]?u[A].bind(u):I(A)})}function R(u){if(self.console&&u===!0||typeof u=="object"){L(u,"debug","log","info","warn","error");try{b.log()}catch{b=y}}else b=y}var _=b},"./src/utils/mediakeys-helper.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"KeySystems",function(){return D}),a.d(w,"requestMediaKeySystemAccess",function(){return y});var D;(function(b){b.WIDEVINE="com.widevine.alpha",b.PLAYREADY="com.microsoft.playready"})(D||(D={}));var y=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"getMediaSource",function(){return D});function D(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"bin2str",function(){return L}),a.d(w,"readUint16",function(){return R}),a.d(w,"readUint32",function(){return _}),a.d(w,"writeUint32",function(){return u}),a.d(w,"findBox",function(){return m}),a.d(w,"parseSegmentIndex",function(){return S}),a.d(w,"parseInitSegment",function(){return E}),a.d(w,"getStartDTS",function(){return A}),a.d(w,"getDuration",function(){return d}),a.d(w,"computeRawDurationFromSamples",function(){return e}),a.d(w,"offsetStartDTS",function(){return t}),a.d(w,"segmentValidRange",function(){return i}),a.d(w,"appendUint8Array",function(){return h});var D=a("./src/utils/typed-array.ts"),y=a("./src/loader/fragment.ts"),b=Math.pow(2,32)-1,I=[].push;function L(n){return String.fromCharCode.apply(null,n)}function R(n,f){"data"in n&&(f+=n.start,n=n.data);var g=n[f]<<8|n[f+1];return g<0?65536+g:g}function _(n,f){"data"in n&&(f+=n.start,n=n.data);var g=n[f]<<24|n[f+1]<<16|n[f+2]<<8|n[f+3];return g<0?4294967296+g:g}function u(n,f,g){"data"in n&&(f+=n.start,n=n.data),n[f]=g>>24,n[f+1]=g>>16&255,n[f+2]=g>>8&255,n[f+3]=g&255}function m(n,f){var g=[];if(!f.length)return g;var T,p,o;"data"in n?(T=n.data,p=n.start,o=n.end):(T=n,p=0,o=T.byteLength);for(var s=p;s<o;){var r=_(T,s),c=L(T.subarray(s+4,s+8)),l=r>1?s+r:o;if(c===f[0])if(f.length===1)g.push({data:T,start:s+8,end:l});else{var k=m({data:T,start:s+8,end:l},f.slice(1));k.length&&I.apply(g,k)}s=l}return g}function S(n){var f=m(n,["moov"]),g=f[0],T=g?g.end:null,p=m(n,["sidx"]);if(!p||!p[0])return null;var o=[],s=p[0],r=s.data[0],c=r===0?8:16,l=_(s,c);c+=4;var k=0,x=0;r===0?c+=8:c+=16,c+=2;var C=s.end+x,P=R(s,c);c+=2;for(var N=0;N<P;N++){var B=c,F=_(s,B);B+=4;var U=F&2147483647,H=(F&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var G=_(s,B);B+=4,o.push({referenceSize:U,subsegmentDuration:G,info:{duration:G/l,start:C,end:C+U-1}}),C+=U,B+=4,c=B}return{earliestPresentationTime:k,timescale:l,version:r,referencesCount:P,references:o,moovEndOffset:T}}function E(n){for(var f=[],g=m(n,["moov","trak"]),T=0;T<g.length;T++){var p=g[T],o=m(p,["tkhd"])[0];if(o){var s=o.data[o.start],r=s===0?12:20,c=_(o,r),l=m(p,["mdia","mdhd"])[0];if(l){s=l.data[l.start],r=s===0?12:20;var k=_(l,r),x=m(p,["mdia","hdlr"])[0];if(x){var C=L(x.data.subarray(x.start+8,x.start+12)),P={soun:y.ElementaryStreamTypes.AUDIO,vide:y.ElementaryStreamTypes.VIDEO}[C];if(P){var N=m(p,["mdia","minf","stbl","stsd"])[0],B=void 0;N&&(B=L(N.data.subarray(N.start+12,N.start+16))),f[c]={timescale:k,type:P},f[P]={timescale:k,id:c,codec:B}}}}}}var F=m(n,["moov","mvex","trex"]);return F.forEach(function(U){var H=_(U,4),G=f[H];G&&(G.default={duration:_(U,12),flags:_(U,20)})}),f}function A(n,f){return m(f,["moof","traf"]).reduce(function(g,T){var p=m(T,["tfdt"])[0],o=p.data[p.start],s=m(T,["tfhd"]).reduce(function(r,c){var l=_(c,4),k=n[l];if(k){var x=_(p,4);o===1&&(x*=Math.pow(2,32),x+=_(p,8));var C=k.timescale||9e4,P=x/C;if(isFinite(P)&&(r===null||P<r))return P}return r},null);return s!==null&&isFinite(s)&&(g===null||s<g)?s:g},null)||0}function d(n,f){for(var g=0,T=0,p=0,o=m(n,["moof","traf"]),s=0;s<o.length;s++){var r=o[s],c=m(r,["tfhd"])[0],l=_(c,4),k=f[l];if(k){var x=k.default,C=_(c,0)|(x==null?void 0:x.flags),P=x==null?void 0:x.duration;C&8&&(C&2?P=_(c,12):P=_(c,8));for(var N=k.timescale||9e4,B=m(r,["trun"]),F=0;F<B.length;F++){if(P){var U=_(B[F],4);g=P*U}else g=e(B[F]);k.type===y.ElementaryStreamTypes.VIDEO?T+=g/N:k.type===y.ElementaryStreamTypes.AUDIO&&(p+=g/N)}}}if(T===0&&p===0){var H=S(n);if(H!=null&&H.references)return H.references.reduce(function(G,j){return G+j.info.duration||0},0)}return T||p}function e(n){var f=_(n,0),g=8;f&1&&(g+=4),f&4&&(g+=4);for(var T=0,p=_(n,4),o=0;o<p;o++){if(f&256){var s=_(n,g);T+=s,g+=4}f&512&&(g+=4),f&1024&&(g+=4),f&2048&&(g+=4)}return T}function t(n,f,g){m(f,["moof","traf"]).forEach(function(T){m(T,["tfhd"]).forEach(function(p){var o=_(p,4),s=n[o];if(s){var r=s.timescale||9e4;m(T,["tfdt"]).forEach(function(c){var l=c.data[c.start],k=_(c,4);if(l===0)u(c,4,k-g*r);else{k*=Math.pow(2,32),k+=_(c,8),k-=g*r,k=Math.max(k,0);var x=Math.floor(k/(b+1)),C=Math.floor(k%(b+1));u(c,4,x),u(c,8,C)}})}})})}function i(n){var f={valid:null,remainder:null},g=m(n,["moof"]);if(g){if(g.length<2)return f.remainder=n,f}else return f;var T=g[g.length-1];return f.valid=Object(D.sliceUint8)(n,0,T.start-8),f.remainder=Object(D.sliceUint8)(n,T.start-8),f}function h(n,f){var g=new Uint8Array(n.length+f.length);return g.set(n),g.set(f,n.length),g}},"./src/utils/output-filter.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"default",function(){return D});var D=function(){function y(I,L){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=I,this.trackName=L}var b=y.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(I,L,R){(this.startTime===null||this.startTime>I)&&(this.startTime=I),this.endTime=L,this.screen=R,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[]},y}()},"./src/utils/texttrack-utils.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"sendAddTrackEvent",function(){return y}),a.d(w,"addCueToTrack",function(){return b}),a.d(w,"clearCurrentCues",function(){return I}),a.d(w,"removeCuesInRange",function(){return L}),a.d(w,"getCuesInRange",function(){return _});var D=a("./src/utils/logger.ts");function y(u,m){var S;try{S=new Event("addtrack")}catch{S=document.createEvent("Event"),S.initEvent("addtrack",!1,!1)}S.track=u,m.dispatchEvent(S)}function b(u,m){var S=u.mode;if(S==="disabled"&&(u.mode="hidden"),u.cues&&!u.cues.getCueById(m.id))try{if(u.addCue(m),!u.cues.getCueById(m.id))throw new Error("addCue is failed for: "+m)}catch(A){D.logger.debug("[texttrack-utils]: "+A);var E=new self.TextTrackCue(m.startTime,m.endTime,m.text);E.id=m.id,u.addCue(E)}S==="disabled"&&(u.mode=S)}function I(u){var m=u.mode;if(m==="disabled"&&(u.mode="hidden"),u.cues)for(var S=u.cues.length;S--;)u.removeCue(u.cues[S]);m==="disabled"&&(u.mode=m)}function L(u,m,S){var E=u.mode;if(E==="disabled"&&(u.mode="hidden"),u.cues&&u.cues.length>0)for(var A=_(u.cues,m,S),d=0;d<A.length;d++)u.removeCue(A[d]);E==="disabled"&&(u.mode=E)}function R(u,m){if(m<u[0].startTime)return 0;var S=u.length-1;if(m>u[S].endTime)return-1;for(var E=0,A=S;E<=A;){var d=Math.floor((A+E)/2);if(m<u[d].startTime)A=d-1;else if(m>u[d].startTime&&E<S)E=d+1;else return d}return u[E].startTime-m<m-u[A].startTime?E:A}function _(u,m,S){var E=[],A=R(u,m);if(A>-1)for(var d=A,e=u.length;d<e;d++){var t=u[d];if(t.startTime>=m&&t.endTime<=S)E.push(t);else if(t.startTime>S)return E}return E}},"./src/utils/time-ranges.ts":function(O,w,a){"use strict";a.r(w);var D={toString:function(y){for(var b="",I=y.length,L=0;L<I;L++)b+="["+y.start(L).toFixed(3)+","+y.end(L).toFixed(3)+"]";return b}};w.default=D},"./src/utils/timescale-conversion.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"toTimescaleFromBase",function(){return y}),a.d(w,"toTimescaleFromScale",function(){return b}),a.d(w,"toMsFromMpegTsClock",function(){return I}),a.d(w,"toMpegTsClockFromTimescale",function(){return L});var D=9e4;function y(R,_,u,m){u===void 0&&(u=1),m===void 0&&(m=!1);var S=R*_*u;return m?Math.round(S):S}function b(R,_,u,m){return u===void 0&&(u=1),m===void 0&&(m=!1),y(R,_,1/u,m)}function I(R,_){return _===void 0&&(_=!1),y(R,1e3,1/D,_)}function L(R,_){return _===void 0&&(_=1),y(R,D,1/_)}},"./src/utils/typed-array.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"sliceUint8",function(){return D});function D(y,b,I){return Uint8Array.prototype.slice?y.slice(b,I):new Uint8Array(Array.prototype.slice.call(y,b,I))}},"./src/utils/vttcue.ts":function(O,w,a){"use strict";a.r(w),w.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var D=["","lr","rl"],y=["start","middle","end","left","right"];function b(u,m){if(typeof m!="string"||!Array.isArray(u))return!1;var S=m.toLowerCase();return~u.indexOf(S)?S:!1}function I(u){return b(D,u)}function L(u){return b(y,u)}function R(u){for(var m=arguments.length,S=new Array(m>1?m-1:0),E=1;E<m;E++)S[E-1]=arguments[E];for(var A=1;A<arguments.length;A++){var d=arguments[A];for(var e in d)u[e]=d[e]}return u}function _(u,m,S){var E=this,A={enumerable:!0};E.hasBeenReset=!1;var d="",e=!1,t=u,i=m,h=S,n=null,f="",g=!0,T="auto",p="start",o=50,s="middle",r=50,c="middle";Object.defineProperty(E,"id",R({},A,{get:function(){return d},set:function(l){d=""+l}})),Object.defineProperty(E,"pauseOnExit",R({},A,{get:function(){return e},set:function(l){e=!!l}})),Object.defineProperty(E,"startTime",R({},A,{get:function(){return t},set:function(l){if(typeof l!="number")throw new TypeError("Start time must be set to a number.");t=l,this.hasBeenReset=!0}})),Object.defineProperty(E,"endTime",R({},A,{get:function(){return i},set:function(l){if(typeof l!="number")throw new TypeError("End time must be set to a number.");i=l,this.hasBeenReset=!0}})),Object.defineProperty(E,"text",R({},A,{get:function(){return h},set:function(l){h=""+l,this.hasBeenReset=!0}})),Object.defineProperty(E,"region",R({},A,{get:function(){return n},set:function(l){n=l,this.hasBeenReset=!0}})),Object.defineProperty(E,"vertical",R({},A,{get:function(){return f},set:function(l){var k=I(l);if(k===!1)throw new SyntaxError("An invalid or illegal string was specified.");f=k,this.hasBeenReset=!0}})),Object.defineProperty(E,"snapToLines",R({},A,{get:function(){return g},set:function(l){g=!!l,this.hasBeenReset=!0}})),Object.defineProperty(E,"line",R({},A,{get:function(){return T},set:function(l){if(typeof l!="number"&&l!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=l,this.hasBeenReset=!0}})),Object.defineProperty(E,"lineAlign",R({},A,{get:function(){return p},set:function(l){var k=L(l);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");p=k,this.hasBeenReset=!0}})),Object.defineProperty(E,"position",R({},A,{get:function(){return o},set:function(l){if(l<0||l>100)throw new Error("Position must be between 0 and 100.");o=l,this.hasBeenReset=!0}})),Object.defineProperty(E,"positionAlign",R({},A,{get:function(){return s},set:function(l){var k=L(l);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");s=k,this.hasBeenReset=!0}})),Object.defineProperty(E,"size",R({},A,{get:function(){return r},set:function(l){if(l<0||l>100)throw new Error("Size must be between 0 and 100.");r=l,this.hasBeenReset=!0}})),Object.defineProperty(E,"align",R({},A,{get:function(){return c},set:function(l){var k=L(l);if(!k)throw new SyntaxError("An invalid or illegal string was specified.");c=k,this.hasBeenReset=!0}})),E.displayState=void 0}return _.prototype.getCueAsHTML=function(){var u=self.WebVTT;return u.convertCueToDOMTree(self,this.text)},_}()},"./src/utils/vttparser.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"parseTimeStamp",function(){return b}),a.d(w,"fixLineBreaks",function(){return m}),a.d(w,"VTTParser",function(){return S});var D=a("./src/utils/vttcue.ts"),y=function(){function E(){}var A=E.prototype;return A.decode=function(d,e){if(!d)return"";if(typeof d!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(d))},E}();function b(E){function A(e,t,i,h){return(e|0)*3600+(t|0)*60+(i|0)+parseFloat(h||0)}var d=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return d?parseFloat(d[2])>59?A(d[2],d[3],0,d[4]):A(d[1],d[2],d[3],d[4]):null}var I=function(){function E(){this.values=Object.create(null)}var A=E.prototype;return A.set=function(d,e){!this.get(d)&&e!==""&&(this.values[d]=e)},A.get=function(d,e,t){return t?this.has(d)?this.values[d]:e[t]:this.has(d)?this.values[d]:e},A.has=function(d){return d in this.values},A.alt=function(d,e,t){for(var i=0;i<t.length;++i)if(e===t[i]){this.set(d,e);break}},A.integer=function(d,e){/^-?\d+$/.test(e)&&this.set(d,parseInt(e,10))},A.percent=function(d,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var t=parseFloat(e);if(t>=0&&t<=100)return this.set(d,t),!0}return!1},E}();function L(E,A,d,e){var t=e?E.split(e):[E];for(var i in t)if(typeof t[i]=="string"){var h=t[i].split(d);if(h.length===2){var n=h[0],f=h[1];A(n,f)}}}var R=new D.default(0,0,""),_=R.align==="middle"?"middle":"center";function u(E,A,d){var e=E;function t(){var n=b(E);if(n===null)throw new Error("Malformed timestamp: "+e);return E=E.replace(/^[^\sa-zA-Z-]+/,""),n}function i(n,f){var g=new I;L(n,function(o,s){var r;switch(o){case"region":for(var c=d.length-1;c>=0;c--)if(d[c].id===s){g.set(o,d[c].region);break}break;case"vertical":g.alt(o,s,["rl","lr"]);break;case"line":r=s.split(","),g.integer(o,r[0]),g.percent(o,r[0])&&g.set("snapToLines",!1),g.alt(o,r[0],["auto"]),r.length===2&&g.alt("lineAlign",r[1],["start",_,"end"]);break;case"position":r=s.split(","),g.percent(o,r[0]),r.length===2&&g.alt("positionAlign",r[1],["start",_,"end","line-left","line-right","auto"]);break;case"size":g.percent(o,s);break;case"align":g.alt(o,s,["start",_,"end","left","right"]);break}},/:/,/\s/),f.region=g.get("region",null),f.vertical=g.get("vertical","");var T=g.get("line","auto");T==="auto"&&R.line===-1&&(T=-1),f.line=T,f.lineAlign=g.get("lineAlign","start"),f.snapToLines=g.get("snapToLines",!0),f.size=g.get("size",100),f.align=g.get("align",_);var p=g.get("position","auto");p==="auto"&&R.position===50&&(p=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=p}function h(){E=E.replace(/^\s+/,"")}if(h(),A.startTime=t(),h(),E.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+e);E=E.substr(3),h(),A.endTime=t(),h(),i(E,A)}function m(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var S=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new y,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var A=E.prototype;return A.parse=function(d){var e=this;d&&(e.buffer+=e.decoder.decode(d,{stream:!0}));function t(){var T=e.buffer,p=0;for(T=m(T);p<T.length&&T[p]!=="\r"&&T[p]!==`
`;)++p;var o=T.substr(0,p);return T[p]==="\r"&&++p,T[p]===`
`&&++p,e.buffer=T.substr(p),o}function i(T){L(T,function(p,o){},/:/)}try{var h="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;h=t();var n=h.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var f=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(f?f=!1:h=t(),e.state){case"HEADER":/:/.test(h)?i(h):h||(e.state="ID");continue;case"NOTE":h||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(h)){e.state="NOTE";break}if(!h)continue;if(e.cue=new D.default(0,0,""),e.state="CUE",h.indexOf("-->")===-1){e.cue.id=h;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{u(h,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var g=h.indexOf("-->")!==-1;if(!h||g&&(f=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=h}continue;case"BADCUE":h||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},A.flush=function(){var d=this;try{if((d.cue||d.state==="HEADER")&&(d.buffer+=`

`,d.parse()),d.state==="INITIAL"||d.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){d.onparsingerror&&d.onparsingerror(e)}return d.onflush&&d.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":function(O,w,a){"use strict";a.r(w),a.d(w,"generateCueId",function(){return S}),a.d(w,"parseWebVTT",function(){return A});var D=a("./src/polyfills/number.ts"),y=a("./src/utils/vttparser.ts"),b=a("./src/demux/id3.ts"),I=a("./src/utils/timescale-conversion.ts"),L=a("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,_=function(d,e,t){return t===void 0&&(t=0),d.substr(t,e.length)===e},u=function(d){var e=parseInt(d.substr(-3)),t=parseInt(d.substr(-6,2)),i=parseInt(d.substr(-9,2)),h=d.length>9?parseInt(d.substr(0,d.indexOf(":"))):0;if(!Object(D.isFiniteNumber)(e)||!Object(D.isFiniteNumber)(t)||!Object(D.isFiniteNumber)(i)||!Object(D.isFiniteNumber)(h))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+d);return e+=1e3*t,e+=60*1e3*i,e+=60*60*1e3*h,e},m=function(d){for(var e=5381,t=d.length;t;)e=e*33^d.charCodeAt(--t);return(e>>>0).toString()};function S(d,e,t){return m(d.toString())+m(e.toString())+m(t)}var E=function(d,e,t){var i=d[e],h=d[i.prevCC];if(!h||!h.new&&i.new){d.ccOffset=d.presentationOffset=i.start,i.new=!1;return}for(;(n=h)!==null&&n!==void 0&&n.new;){var n;d.ccOffset+=i.start-h.start,i.new=!1,i=h,h=d[i.prevCC]}d.presentationOffset=t};function A(d,e,t,i,h,n,f,g){var T=new y.VTTParser,p=Object(b.utf8ArrayToStr)(new Uint8Array(d)).trim().replace(R,`
`).split(`
`),o=[],s=Object(I.toMpegTsClockFromTimescale)(e,t),r="00:00.000",c=0,l=0,k,x=!0,C=!1;T.oncue=function(P){var N=i[h],B=i.ccOffset,F=(c-s)/9e4;if(N!=null&&N.new&&(l!==void 0?B=i.ccOffset=N.start:E(i,h,F)),F&&(B=F-i.presentationOffset),C){var U=P.endTime-P.startTime,H=Object(L.normalizePts)((P.startTime+B-l)*9e4,n*9e4)/9e4;P.startTime=H,P.endTime=H+U}var G=P.text.trim();P.text=decodeURIComponent(encodeURIComponent(G)),P.id||(P.id=S(P.startTime,P.endTime,G)),P.endTime>0&&o.push(P)},T.onparsingerror=function(P){k=P},T.onflush=function(){if(k){g(k);return}f(o)},p.forEach(function(P){if(x)if(_(P,"X-TIMESTAMP-MAP=")){x=!1,C=!0,P.substr(16).split(",").forEach(function(N){_(N,"LOCAL:")?r=N.substr(6):_(N,"MPEGTS:")&&(c=parseInt(N.substr(7)))});try{l=u(r)/1e3}catch(N){C=!1,k=N}return}else P===""&&(x=!1);T.parse(P+`
`)}),T.flush()}},"./src/utils/xhr-loader.ts":function(O,w,a){"use strict";a.r(w);var D=a("./src/utils/logger.ts"),y=a("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,I=function(){function L(_){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=_?_.xhrSetup:null,this.stats=new y.LoadStats,this.retryDelay=0}var R=L.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var _=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),_&&(_.onreadystatechange=null,_.onprogress=null,_.readyState!==4&&(this.stats.aborted=!0,_.abort()))},R.abort=function(){var _;this.abortInternal(),(_=this.callbacks)!==null&&_!==void 0&&_.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(_,u,m){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=_,this.config=u,this.callbacks=m,this.retryDelay=u.retryDelay,this.loadInternal()},R.loadInternal=function(){var _=this.config,u=this.context;if(_){var m=this.loader=new self.XMLHttpRequest,S=this.stats;S.loading.first=0,S.loaded=0;var E=this.xhrSetup;try{if(E)try{E(m,u.url)}catch{m.open("GET",u.url,!0),E(m,u.url)}m.readyState||m.open("GET",u.url,!0)}catch(A){this.callbacks.onError({code:m.status,text:A.message},u,m);return}u.rangeEnd&&m.setRequestHeader("Range","bytes="+u.rangeStart+"-"+(u.rangeEnd-1)),m.onreadystatechange=this.readystatechange.bind(this),m.onprogress=this.loadprogress.bind(this),m.responseType=u.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout),m.send()}},R.readystatechange=function(){var _=this.context,u=this.loader,m=this.stats;if(!(!_||!u)){var S=u.readyState,E=this.config;if(!m.aborted&&S>=2)if(self.clearTimeout(this.requestTimeout),m.loading.first===0&&(m.loading.first=Math.max(self.performance.now(),m.loading.start)),S===4){u.onreadystatechange=null,u.onprogress=null;var A=u.status;if(A>=200&&A<300){m.loading.end=Math.max(self.performance.now(),m.loading.first);var d,e;if(_.responseType==="arraybuffer"?(d=u.response,e=d.byteLength):(d=u.responseText,e=d.length),m.loaded=m.total=e,!this.callbacks)return;var t=this.callbacks.onProgress;if(t&&t(m,_,d,u),!this.callbacks)return;var i={url:u.responseURL,data:d};this.callbacks.onSuccess(i,m,_,u)}else m.retry>=E.maxRetry||A>=400&&A<499?(D.logger.error(A+" while loading "+_.url),this.callbacks.onError({code:A,text:u.statusText},_,u)):(D.logger.warn(A+" while loading "+_.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,E.maxRetryDelay),m.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),E.timeout)}},R.loadtimeout=function(){D.logger.warn("timeout while loading "+this.context.url);var _=this.callbacks;_&&(this.abortInternal(),_.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(_){var u=this.stats;u.loaded=_.loaded,_.lengthComputable&&(u.total=_.total)},R.getCacheAge=function(){var _=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var u=this.loader.getResponseHeader("age");_=u?parseFloat(u):null}return _},L}();w.default=I}}).default})}),xa=st(v=>{var M=Object.create,O=Object.defineProperty,w=Object.getOwnPropertyDescriptor,a=Object.getOwnPropertyNames,D=Object.getPrototypeOf,y=Object.prototype.hasOwnProperty,b=r=>O(r,"__esModule",{value:!0}),I=(r,c)=>{b(r);for(var l in c)O(r,l,{get:c[l],enumerable:!0})},L=(r,c,l)=>{if(c&&typeof c=="object"||typeof c=="function")for(let k of a(c))!y.call(r,k)&&k!=="default"&&O(r,k,{get:()=>c[k],enumerable:!(l=w(c,k))||l.enumerable});return r},R=r=>L(b(O(r!=null?M(D(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);I(v,{ExtensionMimeTypeMap:()=>E,Hls:()=>u.default,MimeTypeShorthandMap:()=>A,StreamTypes:()=>S,allMediaTypes:()=>e,getStreamTypeConfig:()=>f,getType:()=>n,inferMimeTypeFromURL:()=>h,initialize:()=>s,loadMedia:()=>o,mux:()=>_.default,setupHls:()=>T,setupMux:()=>p,shorthandKeys:()=>d,teardown:()=>g,toMuxVideoURL:()=>i,toPlaybackIdParts:()=>t});var _=R(wa()),u=R(Ia()),m=(r,c)=>r in c,S={VOD:"on-demand",LIVE:"live",LL_LIVE:"ll-live"},E={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},A={HLS:E.M3U8},d=Object.keys(A),e=[...Object.values(E),...d,...d.map(r=>r.toUpperCase()),...d.map(r=>r.toLowerCase())],t=r=>{let c=r.indexOf("?");if(c<0)return[r];let l=r.slice(0,c),k=r.slice(c);return[l,k]},i=r=>{if(!r)return;let[c,l=""]=t(r);return`https://stream.mux.com/${c}.m3u8${l}`},h=r=>{let c="";try{c=new URL(r).pathname}catch{console.error("invalid url")}let l=c.lastIndexOf(".");if(l<0)return"";let k=c.slice(l+1).toUpperCase();return m(k,E)?E[k]:""},n=r=>{let c=r.type;if(c){let k=c.toUpperCase();return m(k,A)?A[k]:c}let{src:l}=r;return l?h(l):""},f=r=>r===S.LL_LIVE?{maxFragLookUpTolerance:.001}:{},g=(r,c)=>{c&&(c.detachMedia(),c.destroy()),(r==null?void 0:r.mux)&&(r.mux.destroy(),r.mux)},T=(r,c)=>{var l,k,x;let{debug:C,preferMse:P,streamType:N,startTime:B=-1}=r,F=n(r),U=F===E.M3U8,H=!F||((l=c==null?void 0:c.canPlayType(F))!=null?l:!0),G=u.default.isSupported(),j=((x=(k=window==null?void 0:window.navigator)==null?void 0:k.userAgent)!=null?x:"").toLowerCase().indexOf("android")!==-1&&N===S.LL_LIVE;if(U&&!(!U||H&&!((P||j)&&G))&&G){let V=f(N);return new u.default({debug:C,startPosition:B,...V})}},p=(r,c,l)=>{let{envKey:k}=r;if(k&&c){let{playerInitTime:x,playerSoftwareName:C,playerSoftwareVersion:P,beaconDomain:N,metadata:B,debug:F}=r;_.default.monitor(c,{debug:F,beaconDomain:N,hlsjs:l,Hls:l?u.default:void 0,data:{env_key:k,player_software_name:C,player_software_version:P,player_init_time:x,...B}})}},o=(r,c,l)=>{var k,x,C;if(!c){console.warn("attempting to load media before mediaEl exists");return}let{preferMse:P,streamType:N}=r,B=n(r),F=B===E.M3U8,U=!B||((k=c==null?void 0:c.canPlayType(B))!=null?k:!0),H=u.default.isSupported(),G=((C=(x=window==null?void 0:window.navigator)==null?void 0:x.userAgent)!=null?C:"").toLowerCase().indexOf("android")!==-1&&N===S.LL_LIVE,j=!F||U&&!((P||G)&&H),{src:V}=r;if(c&&U&&j)if(typeof V=="string"){let{startTime:q}=r;if(c.setAttribute("src",V),q){let W=({target:Y})=>{Y.currentTime=q,Y.removeEventListener("loadedmetadata",W)};c.addEventListener("loadedmetadata",W)}}else c.removeAttribute("src");else if(l&&V){l.on(u.default.Events.ERROR,(W,Y)=>{if(Y.fatal)switch(Y.type){case u.default.ErrorTypes.NETWORK_ERROR:console.error("fatal network error encountered, try to recover"),l.startLoad();break;case u.default.ErrorTypes.MEDIA_ERROR:console.error("fatal media error encountered, try to recover"),l.recoverMediaError();break;default:console.error("unrecoverable fatal error encountered, cannot recover (check logs for more info)"),l.destroy();break}});let q=()=>{Array.from(c.textTracks).forEach(W=>{var Y,$;if(!["subtitles","caption"].includes(W.kind)&&W.label==="thumbnails"){if(!((Y=W.cues)==null?void 0:Y.length)){let Z=c.querySelector('track[label="thumbnails"]'),te=($=Z==null?void 0:Z.getAttribute("src"))!=null?$:"";Z==null||Z.removeAttribute("src"),setTimeout(()=>{Z==null||Z.setAttribute("src",te)},0)}W.mode!=="hidden"&&(W.mode="hidden")}})};l.on(u.default.Events.MANIFEST_LOADED,q),l.on(u.default.Events.MEDIA_ATTACHED,q),l.loadSource(V),l.attachMedia(c)}else console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")},s=(r,c,l)=>{g(c,l);let k=T(r,c);return p(r,c,k),o(r,c,k),k}}),Nn=kr(Da()),Rr=document.createElement("template");Rr.innerHTML=`
<style>
  :host {
    /* Supposed to reset styles. Need to understand the specific effects more */
    all: initial;

    /* display:inline (like the native el) makes it so you can't fill
      the container with the native el */
    display: inline-block;
    box-sizing: border-box;

    width: auto;
    height: auto;
  }

  video {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

</style>

<video crossorigin></video>
`;var Je=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Rr.content.cloneNode(!0));let v=this.nativeEl=this.shadowRoot.querySelector("video");Array.prototype.forEach.call(this.attributes,O=>{this.attributeChangedCallback(O.name,null,O.value)}),v.defaultMuted&&(v.muted=!0),this.querySelectorAll(":scope > track").forEach(O=>{this.nativeEl.appendChild(O.cloneNode())});let M=(O,w)=>{for(let a of O)a.type==="childList"&&(a.removedNodes.forEach(D=>{this.nativeEl.removeChild(this.nativeEl.querySelector(`track[src="${D.src}"]`))}),a.addedNodes.forEach(D=>{this.nativeEl.appendChild(D.cloneNode())}))};new MutationObserver(M).observe(this,{childList:!0,subtree:!0})}static get observedAttributes(){let v=[];Object.getOwnPropertyNames(this.prototype).forEach(O=>{let w=!1;try{typeof this.prototype[O]=="function"&&(w=!0)}catch{}!w&&O!==O.toUpperCase()&&v.push(O.toLowerCase())});let M=Object.getPrototypeOf(this).observedAttributes;return M&&(v=v.concat(M)),v}attributeChangedCallback(v,M,O){let w=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),a=Ma(w,v),D=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;a&&!D?typeof this[a]=="boolean"?O===null?this[a]=!1:this[a]=!0:this[a]=O:O===null?this.nativeEl.removeAttribute(v):["id","class"].indexOf(v)===-1&&this.nativeEl.setAttribute(v,O)}connectedCallback(){}},ot=[],Dr=document.createElement("video"),Ca=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let v=Object.getPrototypeOf(Dr);v&&v!==HTMLElement.prototype;v=Object.getPrototypeOf(v))Object.keys(v).forEach(M=>{Ca.indexOf(M)===-1&&ot.push(M)});ot=ot.concat(Object.keys(EventTarget.prototype)),ot.forEach(v=>{if(typeof Dr[v]=="function")Je.prototype[v]=function(){return this.nativeEl[v].apply(this.nativeEl,arguments)};else{let M={get(){return this.nativeEl[v]}};v!==v.toUpperCase()&&(M.set=function(O){this.nativeEl[v]=O}),Object.defineProperty(Je.prototype,v,M)}});function Ma(v,M){let O=null;return v.forEach(w=>{w.toLowerCase()==M.toLowerCase()&&(O=w)}),O}globalThis.customElements.get("custom-video")||(globalThis.customElements.define("custom-video",Je),globalThis.CustomVideoElement=Je);var wr=Je,Ke=kr(xa()),Oa=()=>{try{return"0.2.2"}catch{}return"UNKNOWN"},Pa=Oa(),Na=()=>Pa,le={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_MSE:"prefer-mse",METADATA_VIDEO_ID:"metadata-video-id",METADATA_VIDEO_TITLE:"metadata-video-title",METADATA_VIEWER_USER_ID:"metadata-viewer-user-id",BEACON_DOMAIN:"beacon-domain",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},Fa=Object.values(le),Ua=Na(),Ba="mux-video",Ir=class extends wr{constructor(){super();this.__metadata={},this.__muxPlayerInitTime=Date.now()}static get observedAttributes(){var v;return[...Fa,...(v=wr.observedAttributes)!=null?v:[]]}get playerSoftwareName(){return Ba}get playerSoftwareVersion(){return Ua}get hls(){return this.__hls}get mux(){return this.nativeEl.mux}get src(){return this.getAttribute("src")}set src(v){v!==this.src&&(v==null?this.removeAttribute("src"):this.setAttribute("src",v))}get type(){var v;return(v=this.getAttribute(le.TYPE))!=null?v:void 0}set type(v){v!==this.type&&(v?this.setAttribute(le.TYPE,v):this.removeAttribute(le.TYPE))}get debug(){return this.getAttribute(le.DEBUG)!=null}set debug(v){v!==this.debug&&(v?this.setAttribute(le.DEBUG,""):this.removeAttribute(le.DEBUG))}get startTime(){let v=this.getAttribute(le.START_TIME);if(v==null)return;let M=+v;return Number.isNaN(M)?void 0:M}set startTime(v){v!==this.startTime&&(v==null?this.removeAttribute(le.START_TIME):this.setAttribute(le.START_TIME,`${v}`))}get playbackId(){var v;return(v=this.getAttribute(le.PLAYBACK_ID))!=null?v:void 0}set playbackId(v){v!==this.playbackId&&(v?this.setAttribute(le.PLAYBACK_ID,v):this.removeAttribute(le.PLAYBACK_ID))}get envKey(){var v;return(v=this.getAttribute(le.ENV_KEY))!=null?v:void 0}set envKey(v){v!==this.envKey&&(v?this.setAttribute(le.ENV_KEY,v):this.removeAttribute(le.ENV_KEY))}get beaconDomain(){var v;return(v=this.getAttribute(le.BEACON_DOMAIN))!=null?v:void 0}set beaconDomain(v){v!==this.beaconDomain&&(v?this.setAttribute(le.BEACON_DOMAIN,v):this.removeAttribute(le.BEACON_DOMAIN))}get streamType(){var v;return(v=this.getAttribute(le.STREAM_TYPE))!=null?v:void 0}set streamType(v){v!==this.streamType&&(v?this.setAttribute(le.STREAM_TYPE,v):this.removeAttribute(le.STREAM_TYPE))}get preferMSE(){return this.getAttribute(le.PREFER_MSE)!=null}set preferMSE(v){v?this.setAttribute(le.PREFER_MSE,""):this.removeAttribute(le.PREFER_MSE)}get metadata(){return this.__metadata}set metadata(v){this.__metadata=v!=null?v:{},this.mux&&this.mux.emit("hb",this.__metadata)}load(){let v=(0,Ke.initialize)(this,this.nativeEl,this.__hls);this.__hls=v}unload(){(0,Ke.teardown)(this.nativeEl,this.__hls),this.__hls=void 0}attributeChangedCallback(v,M,O){switch(v){case"src":let w=!!M,a=!!O;!w&&a?this.load():w&&!a?this.unload():w&&a&&(this.unload(),this.load());break;case le.PLAYBACK_ID:this.src=(0,Ke.toMuxVideoURL)(O!=null?O:void 0);break;case le.DEBUG:let D=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this.hls&&(this.hls.config.debug=D);break;case le.METADATA_URL:O&&fetch(O).then(y=>y.json()).then(y=>this.metadata=y).catch(y=>console.error(`Unable to load or parse metadata JSON from metadata-url ${O}!`));break;default:break}super.attributeChangedCallback(v,M,O)}disconnectedCallback(){this.unload()}connectedCallback(){this.src&&this.load()}};globalThis.customElements.get("mux-video")||(globalThis.customElements.define("mux-video",Ir),globalThis.MuxVideoElement=Ir);var Fn=Ke.PlaybackEngine,Un=Ke.ExtensionMimeTypeMap,Bn=Ke.PlaybackEngine,xr=["autoplay","crossorigin","loop","muted","playsinline","src","poster"],Cr=["loadstart","loadedmetadata","progress","durationchange","volumechange","ratechange","resize","waiting","play","playing","timeupdate","pause","seeking","seeked","ended"],Ha=class extends HTMLElement{static get observedAttributes(){return[...xr]}constructor(){super();this.querySelectorAll(":scope > track").forEach(M=>{var O;(O=this.video)==null||O.append(M.cloneNode())});let v=M=>{for(let O of M)O.type==="childList"&&(O.removedNodes.forEach(w=>{var a,D;let y=(a=this.video)==null?void 0:a.querySelector(`track[src="${w.src}"]`);y&&((D=this.video)==null||D.removeChild(y))}),O.addedNodes.forEach(w=>{var a;(a=this.video)==null||a.append(w.cloneNode())}))};new MutationObserver(v).observe(this,{childList:!0,subtree:!0})}attributeChangedCallback(v,M,O){var w,a;xr.includes(v)&&((w=this.video)==null?void 0:w.getAttribute(v))!=O&&((a=this.video)==null||a.setAttribute(v,O))}addEventListener(v,M,O){var w;if(Cr.includes(v)){(w=this.video)==null||w.addEventListener(v,M,O);return}super.addEventListener(v,M,O)}removeEventListener(v,M,O){var w;if(Cr.includes(v)){(w=this.video)==null||w.removeEventListener(v,M,O);return}super.removeEventListener(v,M,O)}play(){var v;return(v=this.video)==null?void 0:v.play()}pause(){var v;(v=this.video)==null||v.pause()}get video(){var v;return(v=this.shadowRoot)==null?void 0:v.querySelector("mux-video")}get paused(){var v,M;return(M=(v=this.video)==null?void 0:v.paused)!=null?M:!0}get duration(){var v,M;return(M=(v=this.video)==null?void 0:v.duration)!=null?M:NaN}get ended(){var v,M;return(M=(v=this.video)==null?void 0:v.ended)!=null?M:!1}get buffered(){var v;return(v=this.video)==null?void 0:v.buffered}get readyState(){var v,M;return(M=(v=this.video)==null?void 0:v.readyState)!=null?M:0}get videoWidth(){var v;return(v=this.video)==null?void 0:v.videoWidth}get videoHeight(){var v;return(v=this.video)==null?void 0:v.videoHeight}get currentTime(){var v,M;return(M=(v=this.video)==null?void 0:v.currentTime)!=null?M:0}set currentTime(v){this.video&&(this.video.currentTime=Number(v))}get volume(){var v,M;return(M=(v=this.video)==null?void 0:v.volume)!=null?M:1}set volume(v){this.video&&(this.video.volume=Number(v))}get src(){return Ve(this,"src")}set src(v){this.setAttribute("src",`${v}`)}get poster(){var v;return(v=Ve(this,"poster"))!=null?v:""}set poster(v){this.setAttribute("poster",`${v}`)}get playbackRate(){var v,M;return(M=(v=this.video)==null?void 0:v.playbackRate)!=null?M:1}set playbackRate(v){this.video&&(this.video.playbackRate=Number(v))}get crossOrigin(){return Ve(this,"crossorigin")}set crossOrigin(v){this.setAttribute("crossorigin",`${v}`)}get autoplay(){return Ve(this,"autoplay")!=null}set autoplay(v){v?this.setAttribute("autoplay",""):this.removeAttribute("autoplay")}get loop(){return Ve(this,"loop")!=null}set loop(v){v?this.setAttribute("loop",""):this.removeAttribute("loop")}get muted(){return Ve(this,"muted")!=null}set muted(v){v?this.setAttribute("muted",""):this.removeAttribute("muted")}};function Ve(v,M){return v.video?v.video.getAttribute(M):v.getAttribute(M)}var Mr=Ha;function Ga(v){let M="";return Object.entries(v).forEach(([O,w])=>{M+=`${ja(O)}: ${w}; `}),M.trim()}function ja(v){return v.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var Ka=0;function Va(v){var M=++Ka;return`${v}${M}`}function be(v,...M){let O=Va(""),w=[];M=M.map(b=>b==null||b===!1?"":b instanceof Node||b instanceof _t||b instanceof lt?`<div id="_${O}${w.push(b)}"></div>`:b);let a=String.raw(v,...M).replace(/>\n+/g,">").replace(/\s+</g,"<").replace(/>\s+/g,">"),D=document.createElement("template");D.innerHTML=a;let y=w.map((b,I)=>{let{id:L,template:R,props:_}=b;if(b instanceof _t){let u=R(_)||be``;b=new qa(u.childNodes,u.childFragments,R)}return b.id=L||I,b});return y.forEach((b,I)=>{var L;let R=new DocumentFragment;b instanceof lt?R.append(...b.childNodes):R.append(b);let _=D.content.querySelector(`#_${O}${I+1}`);(L=_==null?void 0:_.parentNode)==null||L.replaceChild(R,_)}),new lt(D.content.childNodes,y)}var lt=class{constructor(v,M){this.childFragments=M,this._cachedChildNodes=[...v],this._mark=new Text,this.id=void 0}get fragments(){let v={};for(let M of this.childFragments)M.id&&(v[M.id]=M),Object.assign(v,M.fragments);return v}get parentNode(){var v;return(v=this._mark)==null?void 0:v.parentNode}get childNodes(){return[this._mark,...this._cachedChildNodes]}replaceChildren(...v){let M=this._cachedChildNodes;this._cachedChildNodes=[...v],M.forEach(w=>{var a;return(a=w.parentNode)==null?void 0:a.removeChild(w)});let O=this._mark.nextSibling;v.forEach(w=>{var a,D;return(D=(a=this._mark)==null?void 0:a.parentNode)==null?void 0:D.insertBefore(w,O)})}},qa=class extends lt{constructor(v,M,O){super(v,M);this.template=O}render(v){let M=this.template(v)||be``;return this.childFragments=M.childFragments,this.replaceChildren(...M.childNodes),this}};function _e(v,M,O){return new _t(v,M,O)}var _t=class{constructor(v,M,O){this.id=v,this.template=M,this.props=O}},Wa=()=>{try{return"0.1.0"}catch{}return"UNKNOWN"},$a=Wa(),Ya=()=>$a,za=v=>`https://image.mux.com/${v}/thumbnail.jpg`,Qa=v=>`https://image.mux.com/${v}/storyboard.vtt`,Tt,Xa=(v="video")=>Tt||(typeof window!="undefined"&&(Tt=document.createElement(v)),Tt),Ja=async(v=Xa())=>{if(!v)return!1;let M=v.volume;return v.volume=M/2+.1,new Promise((O,w)=>{setTimeout(()=>{O(v.volume!==M)},0)})};function Or(v){var M,O;return Array.from((O=(M=v.video)==null?void 0:M.textTracks)!=null?O:[]).filter(({kind:w})=>w==="subtitles"||w==="captions")}function Za(v){let{primaryColor:M,secondaryColor:O,tertiaryColor:w}=v;return Ga({...M?{"--media-icon-color":M,"--media-range-thumb-background":M,"--media-range-bar-color":M,color:M}:{},...O?{"--media-background-color":O,"--media-control-background":O,"--media-control-hover-background":O}:{}})}var At=class extends Error{constructor(v,M=0,O){super(v);var w;this.name="MediaError",this.code=M,this.fatal=O!=null?O:M>=At.MEDIA_ERR_NETWORK,this.message||(this.message=(w=At.defaultMessages[this.code])!=null?w:"")}},ye=At;ye.MEDIA_ERR_CUSTOM=0,ye.MEDIA_ERR_ABORTED=1,ye.MEDIA_ERR_NETWORK=2,ye.MEDIA_ERR_DECODE=3,ye.MEDIA_ERR_SRC_NOT_SUPPORTED=4,ye.MEDIA_ERR_ENCRYPTED=5,ye.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var Pr=`
  :host {
    z-index: 100;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    box-sizing: border-box;
    color: #fff;
    line-height: 1.4;
    font-family: Arial, sans-serif;
    padding: var(--media-dialog-backdrop-padding, 0);
    background: var(--media-dialog-backdrop-background,
      linear-gradient(to bottom, rgba(20, 20, 30, 0.7) 50%, rgba(20, 20, 30, 0.9))
    );
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-open, opacity .2s) !important;
    transform: var(--media-dialog-transform-open, none) !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  :host(:not([open])) {
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-close, opacity .1s) !important;
    transform: var(--media-dialog-transform-close, none);
    opacity: 0 !important;
    pointer-events: none !important;
  }

  /*
    Only show outline when keyboard focusing.
    https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo
    :host-context support is bad https://caniuse.com/mdn-css_selectors_host-context
  */
  :host-context([media-keyboard-control]) ::slotted(:focus),
  :host-context([media-keyboard-control]) :focus {
    box-shadow: 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  .dialog {
    position: relative;
    box-sizing: border-box;
    background: var(--media-dialog-background, none);
    padding: var(--media-dialog-padding, 10px);
    width: min(320px, 100%);
    max-height: 100%;
    overflow: auto;
  }
`,Nr=document.createElement("template");Nr.innerHTML=`
  <style>
    ${Pr}
  </style>

  <div class="dialog">
    <slot></slot>
  </div>
`;var Ze=class extends HTMLElement{get observedAttributes(){return["open"]}constructor(){super();var v;this.attachShadow({mode:"open"}),(v=this.shadowRoot)==null||v.appendChild(this.constructor.template.content.cloneNode(!0))}show(){this.setAttribute("open",""),Fr(this)}close(){this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("close",{composed:!0,bubbles:!0})),en(this)}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","dialog"),this.hasAttribute("open")&&Fr(this)}};Ze.styles=Pr,Ze.template=Nr;function Fr(v){let M=v.querySelector("[autofocus]:not([disabled])");!M&&v.tabIndex>=0&&(M=v),M||(M=Ur(v.shadowRoot)),v._previouslyFocusedElement=document.activeElement,document.activeElement instanceof HTMLElement&&document.activeElement.blur(),M instanceof HTMLElement&&M.focus()}function Ur(v){let M=["button","input","keygen","select","textarea"].map(function(w){return w+":not([disabled])"});M.push('[tabindex]:not([disabled]):not([tabindex=""])');let O=v==null?void 0:v.querySelector(M.join(", "));if(!O&&"attachShadow"in Element.prototype){let w=(v==null?void 0:v.querySelectorAll("*"))||[];for(let a=0;a<w.length&&!(w[a].tagName&&w[a].shadowRoot&&(O=Ur(w[a].shadowRoot),O));a++);}return O}function en(v){v._previouslyFocusedElement instanceof HTMLElement&&v._previouslyFocusedElement.focus()}globalThis.customElements.get("media-dialog")||(globalThis.customElements.define("media-dialog",Ze),globalThis.MediaDialog=Ze);var Br=Ze,Hr=document.createElement("template");Hr.innerHTML=`
  <style>
    ${Br.styles}

    .close {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
      outline: inherit;
      width: 28px;
      height: 28px;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>

  <div class="dialog">
    <slot></slot>
  </div>

  <slot name="close">
    <button class="close" tabindex="0">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </slot>
`;var St=class extends Br{constructor(){super();var v,M;(M=(v=this.shadowRoot)==null?void 0:v.querySelector(".close"))==null||M.addEventListener("click",()=>{this.close()})}};St.template=Hr,globalThis.customElements.get("mxp-dialog")||(globalThis.customElements.define("mxp-dialog",St),globalThis.MxpDialog=St);var tn=v=>`
  <svg viewBox="0 0 20 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M10.19 11.22a.25.25 0 0 0-.38 0l-5.46 6.37a.25.25 0 0 0 .19.41h10.92a.25.25 0 0 0 .19-.41Z"
    />
    <path
      d="M19 0H1a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h2.94L5 13.75H1.25V1.25h17.5v12.5H15L16.06 15H19a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1Z"
    />
  </svg>
`,rn=v=>`
  <svg viewBox="0 0 20 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M19.83 2.68a2.58 2.58 0 0 0-2.3-2.5C15.72.06 12.86 0 10 0S4.28.06 2.47.18a2.58 2.58 0 0 0-2.3 2.5 115.86 115.86 0 0 0 0 12.64 2.58 2.58 0 0 0 2.3 2.5c1.81.12 4.67.18 7.53.18s5.72-.06 7.53-.18a2.58 2.58 0 0 0 2.3-2.5 115.86 115.86 0 0 0 0-12.64Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18s-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11 122.5 122.5 0 0 1 0-12.42 1.11 1.11 0 0 1 .91-1.11C4.24 1.57 7 1.5 10 1.5s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11 122.5 122.5 0 0 1 0 12.42ZM7.84 11a1.55 1.55 0 0 1-.76.18 1.57 1.57 0 0 1-.71-.18 1.69 1.69 0 0 1-.57-.42 2.1 2.1 0 0 1-.38-.58 2.47 2.47 0 0 1 0-1.64 2 2 0 0 1 .39-.66 1.73 1.73 0 0 1 .58-.42 1.81 1.81 0 0 1 .73-.16 1.68 1.68 0 0 1 .7.14 1.39 1.39 0 0 1 .51.39l1.08-.89a2.18 2.18 0 0 0-.47-.44A2.81 2.81 0 0 0 8.4 6a2.91 2.91 0 0 0-.58-.15 2.71 2.71 0 0 0-.56 0A4.08 4.08 0 0 0 5.88 6a3.27 3.27 0 0 0-1.09.67 3.14 3.14 0 0 0-.71 1.06 3.62 3.62 0 0 0-.26 1.39 3.57 3.57 0 0 0 .26 1.38 3 3 0 0 0 .71 1.06 3.27 3.27 0 0 0 1.09.67 3.85 3.85 0 0 0 1.38.23 3.2 3.2 0 0 0 1.28-.27 2.49 2.49 0 0 0 1-.83l-1.17-.88a1.42 1.42 0 0 1-.53.52Zm6.62 0a1.58 1.58 0 0 1-.76.18A1.54 1.54 0 0 1 13 11a1.69 1.69 0 0 1-.57-.42A2.12 2.12 0 0 1 12 10a2.29 2.29 0 0 1 .39-2.3 1.84 1.84 0 0 1 1.32-.58 1.71 1.71 0 0 1 .7.14 1.39 1.39 0 0 1 .51.39L16 6.73a2.43 2.43 0 0 0-.47-.44A3.22 3.22 0 0 0 15 6a3 3 0 0 0-.57-.15 2.87 2.87 0 0 0-.57 0A4.06 4.06 0 0 0 12.5 6a3.17 3.17 0 0 0-1.09.67 3 3 0 0 0-.72 1.06 3.62 3.62 0 0 0-.25 1.39 3.57 3.57 0 0 0 .25 1.38 2.93 2.93 0 0 0 .72 1.06 3.17 3.17 0 0 0 1.09.67 3.83 3.83 0 0 0 1.37.23 3.16 3.16 0 0 0 1.28-.27 2.45 2.45 0 0 0 1-.83L15 10.51a1.49 1.49 0 0 1-.54.49Z"
    />
  </svg>
`,an=v=>`
  <svg viewBox="0 0 20 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M19.83 2.68a2.58 2.58 0 0 0-2.3-2.5C13.91-.06 6.09-.06 2.47.18a2.58 2.58 0 0 0-2.3 2.5 115.86 115.86 0 0 0 0 12.64 2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5 115.86 115.86 0 0 0 0-12.64ZM8.42 12.78a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27A4 4 0 0 1 4 12a3.67 3.67 0 0 1-.84-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64A3.53 3.53 0 0 1 4 6.26a3.89 3.89 0 0 1 1.29-.8 4.76 4.76 0 0 1 1.63-.27 4.06 4.06 0 0 1 .67.06 4.57 4.57 0 0 1 .68.18 3.59 3.59 0 0 1 .64.34 2.7 2.7 0 0 1 .55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.35 2.35 0 0 0-.46.77 2.78 2.78 0 0 0-.16 1 2.74 2.74 0 0 0 .16 1 2.39 2.39 0 0 0 .46.77 2.07 2.07 0 0 0 .67.5 2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.88 2.88 0 0 1-1.22 1.01Zm7.52 0a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27 3.89 3.89 0 0 1-1.28-.83 3.55 3.55 0 0 1-.85-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64 3.43 3.43 0 0 1 .85-1.25 3.75 3.75 0 0 1 1.28-.8 4.76 4.76 0 0 1 1.63-.27 4 4 0 0 1 .67.06 4.27 4.27 0 0 1 .68.18 3.59 3.59 0 0 1 .64.34 2.46 2.46 0 0 1 .55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.35 2.35 0 0 0-.46.77 3 3 0 0 0-.16 1 3 3 0 0 0 .16 1 2.58 2.58 0 0 0 .46.77 2.07 2.07 0 0 0 .67.5 2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.82 2.82 0 0 1-1.21 1.05Z"
    />
  </svg>
`,nn=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M17.25 11.5h-5a.76.76 0 0 0-.75.75v5a.75.75 0 0 0 1.5 0V13h4.25a.75.75 0 0 0 0-1.5Zm-5-5h5a.75.75 0 0 0 0-1.5H13V.75a.75.75 0 0 0-1.5 0v5a.76.76 0 0 0 .75.75Zm-6.5 5h-5a.75.75 0 0 0 0 1.5H5v4.25a.75.75 0 0 0 1.5 0v-5a.76.76 0 0 0-.75-.75Zm0-11.5A.76.76 0 0 0 5 .75V5H.75a.75.75 0 0 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5A.76.76 0 0 0 5.75 0Z"
    />
  </svg>
`,sn=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M17.25 11.5a.76.76 0 0 0-.75.75v4.25h-4.25a.75.75 0 0 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5a.76.76 0 0 0-.75-.75Zm0-11.5h-5a.76.76 0 0 0-.75.75.76.76 0 0 0 .75.75h4.25v4.25a.75.75 0 0 0 1.5 0v-5a.76.76 0 0 0-.75-.75ZM5.75 16.5H1.5v-4.25a.76.76 0 0 0-.75-.75.76.76 0 0 0-.75.75v5a.76.76 0 0 0 .75.75h5a.75.75 0 0 0 0-1.5Zm0-16.5h-5A.76.76 0 0 0 0 .75v5a.76.76 0 0 0 .75.75.76.76 0 0 0 .75-.75V1.5h4.25A.76.76 0 0 0 6.5.75.76.76 0 0 0 5.75 0Z"
    />
  </svg>
`,on=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M3 16.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v15ZM11.5 1a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3Z"
    />
  </svg>
`,ln=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="m3.73 17.93 14.05-8.54a.46.46 0 0 0 0-.78L3.73.07A.48.48 0 0 0 3 .46v17.07a.48.48 0 0 0 .73.4Z"
    />
  </svg>
`,Gr=v=>`
  <svg viewBox="0 0 20 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M19 0H1a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h6.75v-1.25h-6.5V1.25h17.5v6.5H20V1a1 1 0 0 0-1-1Zm0 10h-8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Zm-.5 6.5h-7v-5h7Z"
    />
  </svg>
`,un=v=>`
  <svg viewBox="0 0 16 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M8.75 3.42H4.68l2.14-2.14A.75.75 0 0 0 5.76.22L2.22 3.75a.77.77 0 0 0 0 1.07l3.54 3.53a.75.75 0 0 0 1.06 0 .75.75 0 0 0 0-1.06L4.45 4.92h4.3A5.75 5.75 0 0 1 11 16a.75.75 0 0 0 .29 1.44.72.72 0 0 0 .29-.06A7.25 7.25 0 0 0 8.75 3.42Z"
    />
    <text
      class="value"
      transform="translate(.6 17.8)"
      style="font-size: 8px; font-family: 'ArialMT', 'Arial'"
    >
      ${v.value}
    </text>
    <path style="fill: none" d="M0 0h16v18H0z" />
  </svg>
`,dn=v=>`
  <svg viewBox="0 0 16 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="M7.25 3.42h4.07L9.18 1.28A.75.75 0 0 1 10.24.22l3.54 3.53a.77.77 0 0 1 0 1.07l-3.54 3.53a.75.75 0 0 1-1.06 0 .75.75 0 0 1 0-1.06l2.37-2.37h-4.3A5.75 5.75 0 0 0 5 16a.75.75 0 0 1-.29 1.44.72.72 0 0 1-.29-.06A7.25 7.25 0 0 1 7.25 3.42Z"
    />
    <text
      class="value"
      transform="translate(6.5 17.8)"
      style="font-size: 8px; font-family: 'ArialMT', 'Arial'"
    >
      ${v.value}
    </text>
    <path style="fill: none" d="M0 0h16v18H0z" />
  </svg>
`,cn=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="m8.14 1.86-4 4a.49.49 0 0 1-.35.14H.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V2.21a.5.5 0 0 0-.86-.35ZM10.88.3v1.52A7.52 7.52 0 0 1 16.47 9a7.52 7.52 0 0 1-5.59 7.18v1.52A9 9 0 0 0 18 9 9 9 0 0 0 10.88.3ZM14.44 9a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66A5.49 5.49 0 0 0 14.44 9Z"
    />
    <path style="fill: none" d="M0 0h18v18H0z" />
  </svg>
`,jr=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="m8.14 1.86-4 4a.49.49 0 0 1-.35.14H.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V2.21a.5.5 0 0 0-.86-.35ZM14.44 9a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66A5.49 5.49 0 0 0 14.44 9Z"
    />
    <path style="fill: none" d="M0 0h18v18H0z" />
  </svg>
`,hn=v=>`
  <svg viewBox="0 0 18 18" slot="${v.slot}">
    <title>${v.title}</title>
    <path
      d="m0 1.05 4.48 4.47-.33.33a.49.49 0 0 1-.36.15H.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.48.48 0 0 0 .36.15.5.5 0 0 0 .5-.5v-5.75l4.67 4.66a7.71 7.71 0 0 1-2.79 1.47v1.52a9.32 9.32 0 0 0 3.87-1.91L17 18l1-1L1.06 0Zm5.36 5.36L7.75 8.8V14L5 11.26a1.74 1.74 0 0 0-1.24-.51H1.25v-3.5h2.54A1.74 1.74 0 0 0 5 6.74ZM16.47 9a7.19 7.19 0 0 1-.89 3.47l1.11 1.1A8.64 8.64 0 0 0 18 9 9 9 0 0 0 10.88.3v1.52A7.52 7.52 0 0 1 16.47 9ZM9 5.88V2.21a.5.5 0 0 0-.5-.5.48.48 0 0 0-.36.15L6.56 3.44ZM12.91 9a4.28 4.28 0 0 1-.07.72l1.22 1.22A5.2 5.2 0 0 0 14.44 9a5.49 5.49 0 0 0-3.56-5.1v1.66A4 4 0 0 1 12.91 9Z"
    />
    <path style="fill: none" d="M0 0h18v18H0z" />
  </svg>
`,fn=`:host {
  /* default aspect ratio, overwrite w/ e.g. style="aspect-ratio: 16 / 10" */
  aspect-ratio: 16 / 9;
  display: block;
}

media-controller {
  --media-control-background: transparent;
  --media-control-hover-background: transparent;
  --media-range-track-background: rgba(255, 255, 255, 0.5);
  --media-range-track-border-radius: 3px;
  --media-aspect-ratio: auto;
  display: block;
  width: 100%;
  height: 100%;
}

media-control-bar {
  --media-button-icon-width: 18px;
}

media-control-bar [role="button"],
media-control-bar [role="switch"] {
  height: 44px;
}

.mxp-spacer {
  flex-grow: 1;
  height: 100%;
  background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
}

.mxp-center-controls {
  --media-background-color: transparent;
  --media-button-icon-width: 100%;
  --media-button-icon-height: auto;
  pointer-events: none;
  width: 100%;
  display: flex;
  flex-flow: row;
  align-items: center;
  justify-content: center;
}

.mxp-center-controls media-play-button {
  --media-control-background: transparent;
  --media-control-hover-background: transparent;
  padding: 0;
  width: min(9%, 90px);
}

.mxp-center-controls media-seek-backward-button,
.mxp-center-controls media-seek-forward-button {
  --media-control-background: transparent;
  --media-control-hover-background: transparent;
  padding: 0;
  margin: 0 10%;
  width: min(7%, 70px);
}

media-loading-indicator {
  --media-loading-icon-width: 100%;
  --media-button-icon-height: auto;
  pointer-events: none;
  position: absolute;
  width: min(15%, 150px);
  display: flex;
  flex-flow: row;
  align-items: center;
  justify-content: center;
}

/* Intentionally don't target the div for transition but the children
 of the div. Prevents messing with media-chrome's autohide feature. */
media-loading-indicator + div * {
  transition: opacity 0.15s;
  opacity: 1;
}

media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
  opacity: 0;
  transition-delay: 400ms;
}

media-volume-range {
  width: min(100%, 100px);
}

media-time-display {
  white-space: nowrap;
}
`,qe={VOD:"on-demand",LIVE:"live",LL_LIVE:"ll-live"},Kr={LG:"large",SM:"small"},Vr=()=>'<div class="mxp-spacer"></div>',vn=v=>{var M,O,w,a;return be`
  <style>
    ${fn}
  </style>
  <media-controller style="${Za(v)}">
    <mux-video
      slot="media"
      crossorigin
      playsinline
      ${v.autoplay||v.streamType===qe.LIVE||v.streamType===qe.LL_LIVE?"autoplay":""}
      ${v.muted?"muted":""}
      ${v.debug?"debug":""}
      ${v.preferMse?"prefer-mse":""}
      ${v.startTime!=null?`start-time="${v.startTime}"`:""}
      ${v.poster?`poster="${(M=v.poster)!=null?M:za(v.playbackId)}"`:""}
      ${v.playbackId?`playback-id="${v.playbackId}"`:""}
      ${v.envKey?`env-key="${v.envKey}"`:""}
      ${v.streamType?`stream-type="${v.streamType}"`:""}
      ${((O=v.metadata)==null?void 0:O.video_id)?`metadata-video-id="${v.metadata.video_id}"`:""}
      ${((w=v.metadata)==null?void 0:w.video_title)?`metadata-video-title="${v.metadata.video_title}"`:""}
      ${((a=v.metadata)==null?void 0:a.viewer_user_id)?`metadata-viewer-user-id="${v.metadata.viewer_user_id}"`:""}
    >
      ${v.playbackId&&v.streamType!==qe.LIVE&&v.streamType!==qe.LL_LIVE?`<track
            label="thumbnails"
            default
            kind="metadata"
            src=${Qa(v.playbackId)}
          />`:""}
    </mux-video>
    <media-loading-indicator
      slot="centered-chrome"
      no-auto-hide
    ></media-loading-indicator>
    ${_e("chromeRenderer",pn,v)}
    <mxp-dialog
      slot="centered-chrome"
      no-auto-hide${v.isDialogOpen&&" open"}
    >
      ${_e("dialogContent",D=>be`
            ${(D==null?void 0:D.title)?`<h3>${D.title}</h3>`:""}
            ${(D==null?void 0:D.message)?`<p>${D.message}</p>`:""}
          `,v.dialog)}
    </mxp-dialog>
  </media-controller>
`},pn=v=>{let{streamType:M,playerSize:O}=v;return M===qe.LIVE||M===qe.LL_LIVE?O===Kr.LG?En(v):yn(v):O===Kr.LG?mn(v):gn(v)},We=()=>`
  <media-play-button>
    ${ln({slot:"play",title:"Play"})}
    ${on({slot:"pause",title:"Pause"})}
  </media-play-button>
`,qr=v=>`
  <media-seek-backward-button seek-offset="${v.backwardSeekOffset}">
    ${un({slot:"backward",value:v.backwardSeekOffset})}
  </media-seek-backward-button>
`,Wr=v=>`
  <media-seek-forward-button seek-offset="${v.forwardSeekOffset}">
    ${dn({slot:"forward",value:v.forwardSeekOffset})}
  </media-seek-forward-button>
`,ut=()=>`
  <media-mute-button>
    ${cn({slot:"high"})} ${jr({slot:"medium"})}
    ${jr({slot:"low"})} ${hn({slot:"off"})}
  </media-mute-button>
`,dt=v=>be`
<media-captions-button${v.defaultShowCaptions?" default-showing":""}>
  ${rn({slot:"off"})} ${an({slot:"on"})}
</media-captions-button>`,ct=()=>be`<media-airplay-button>
  ${tn({slot:"airplay"})}
</media-airplay-button>`,ht=()=>`<media-pip-button>
  ${Gr({slot:"enter",title:"Enter Picture-in-Picture"})}
  ${Gr({slot:"exit",title:"Exit Picture-in-Picture"})}
</media-pip-button>`,ft=()=>`<media-fullscreen-button>
  ${sn({slot:"enter",title:"Enter Fullscreen"})}
  ${nn({slot:"exit",title:"Exit Fullscreen"})}
</media-fullscreen-button>`,gn=v=>be`
  <media-control-bar slot="top-chrome" style="justify-content: flex-end;">
    ${_e("captionsButton",({hasCaptions:M})=>M&&dt(v),v)}
    ${_e("airplayButton",({supportsAirPlay:M})=>M&&ct(),v)}
    ${ht()}
  </media-control-bar>
  <div slot="centered-chrome" class="mxp-center-controls">
    ${qr(v)} ${We()}
    ${Wr(v)}
  </div>
  <media-control-bar>
    <media-time-range></media-time-range>
    <media-time-display show-duration remaining></media-time-display>
    ${ut()}
    ${_e("volumeRange",({supportsVolume:M})=>M&&be`<media-volume-range></media-volume-range>`,v)}
    <media-playback-rate-button></media-playback-rate-button>
    ${ft()}
  </media-control-bar>
`,mn=v=>be`
  <div slot="centered-chrome" class="mxp-center-controls">
    ${We()}
  </div>
  <media-control-bar>
    ${We()} ${qr(v)}
    ${Wr(v)}
    <media-time-range></media-time-range>
    <media-time-display show-duration remaining></media-time-display>
    ${ut()}
    ${_e("volumeRange",({supportsVolume:M})=>M&&be`<media-volume-range></media-volume-range>`,v)}
    <media-playback-rate-button></media-playback-rate-button>
    ${_e("captionsButton",({hasCaptions:M})=>M&&dt(v),v)}
    ${_e("airplayButton",({supportsAirPlay:M})=>M&&ct(),v)}
    ${ht()} ${ft()}
  </media-control-bar>
`,yn=v=>be`
  <div slot="centered-chrome" class="mxp-center-controls">
    ${We()}
  </div>
  <media-control-bar>
    ${ut()}
    ${_e("volumeRange",({supportsVolume:M})=>M&&be`<media-volume-range></media-volume-range>`,v)}
    ${Vr()}
    <media-time-display></media-time-display>
    ${_e("captionsButton",({hasCaptions:M})=>M&&dt(v),v)}
    ${_e("airplayButton",({supportsAirPlay:M})=>M&&ct(),v)}
    ${ht()} ${ft()}
  </media-control-bar>
`,En=v=>be`
  <div slot="centered-chrome" class="mxp-center-controls">
    ${We()}
  </div>
  <media-control-bar>
    ${We()} ${ut()}
    ${_e("volumeRange",({supportsVolume:M})=>M&&be`<media-volume-range></media-volume-range>`,v)}
    ${Vr()}
    <media-time-display></media-time-display>
    ${_e("captionsButton",({hasCaptions:M})=>M&&dt(v),v)}
    ${_e("airplayButton",({supportsAirPlay:M})=>M&&ct(),v)}
    ${ht()} ${ft()}
  </media-control-bar>
`,bn=v=>{var M,O,w;return!((M=v.video)==null?void 0:M.paused)&&((w=(O=v.video)==null?void 0:O.readyState)!=null?w:0)<3},_n=class{constructor(v){this._state={};var M;this.el=v,this._template=vn(Yr(v)),v.attachShadow({mode:"open"}),(M=v.shadowRoot)==null||M.append(...this._template.childNodes),v.querySelectorAll(":scope > track").forEach(O=>{var w;(w=v.video)==null||w.append(O.cloneNode())}),Array.prototype.forEach.call(v.attributes,O=>{v.attributeChangedCallback(O.name,null,O.value)}),v.video&&(v.video.muted=v.video.defaultMuted),this._setUpErrors(v),this._setUpMutedAutoplay(v),this._setUpCaptionsButton(v),this._setUpAirplayButton(v),this._setUpVolumeRange(v)}connectedCallback(){this._renderChrome(),this._initResizing()}disconnectedCallback(){this._deinitResizing()}get _fragments(){return this._template.fragments}_renderChrome(){this._playerSize!=Lt(this.el)&&(this._playerSize=Lt(this.el),this._fragments.chromeRenderer.render(Yr(this.el,this._state)))}_initResizing(){this._resizeObserver=new ResizeObserver(()=>this._renderChrome()),this._resizeObserver.observe(this.el)}_deinitResizing(){var v;(v=this._resizeObserver)==null||v.disconnect()}_setUpErrors(v){var M,O;let w=a=>{var D;let{detail:y}=a;if(y instanceof ye||(y=new ye(y.message,y.code,y.fatal)),!!(y==null?void 0:y.fatal)){switch(y.code){case ye.MEDIA_ERR_NETWORK:this._state.dialog={title:"Network Error",message:`${y.message} Please reload the player and try again.`};break;case ye.MEDIA_ERR_DECODE:this._state.dialog={title:"Media Error",message:`${y.message} Please reload the player and try again.`};break;case ye.MEDIA_ERR_SRC_NOT_SUPPORTED:this._state.dialog={title:"Source Not Supported",message:y.message};break;default:this._state.dialog={title:"Error",message:y.message};break}this._fragments.dialogContent.render(this._state.dialog),(D=this._fragments.dialogContent.parentNode)==null||D.show()}};if(v.addEventListener("error",w),(M=v.video)==null||M.addEventListener("error",()=>{var a,D;let{message:y,code:b}=(D=(a=v.video)==null?void 0:a.error)!=null?D:{};v.dispatchEvent(new CustomEvent("error",{detail:new ye(y,b)}))}),(O=v.video)==null?void 0:O.hls){let a=v.video.hls.constructor,D=(y,b)=>{let I={[a.ErrorTypes.NETWORK_ERROR]:ye.MEDIA_ERR_NETWORK,[a.ErrorTypes.MEDIA_ERROR]:ye.MEDIA_ERR_DECODE},L=new ye("",I[b.type]);L.fatal=b.fatal,L.data=b,v.dispatchEvent(new CustomEvent("error",{detail:L}))};v.video.hls.on(a.Events.ERROR,D)}}_setUpMutedAutoplay(v){var M;if((M=v.video)==null?void 0:M.hls){let O=v.video.hls.constructor;v.autoplay&&v.video.hls.on(O.Events.MANIFEST_PARSED,()=>{var w,a=(w=v.video)==null?void 0:w.play();a&&a.catch(D=>{var y;if(console.log(`${D.name} ${D.message}`),D.name==="NotAllowedError")return console.log("Attempting to play with video muted"),v.video&&(v.video.muted=!0),(y=v.video)==null?void 0:y.play().catch(console.error)})})}}_setUpCaptionsButton(v){var M,O,w,a;let D=()=>{let y=Or(v);this._fragments.captionsButton.render({hasCaptions:!!y.length})};(O=(M=v.video)==null?void 0:M.textTracks)==null||O.addEventListener("addtrack",D),(a=(w=v.video)==null?void 0:w.textTracks)==null||a.addEventListener("removetrack",D)}_setUpAirplayButton(v){var M;if(globalThis.WebKitPlaybackTargetAvailabilityEvent){let O=w=>{let a=w.availability==="available";this._fragments.airplayButton.render({supportsAirPlay:a}),this._state.supportsAirPlay=a};(M=v.video)==null||M.addEventListener("webkitplaybacktargetavailabilitychanged",O)}}async _setUpVolumeRange(v){let M=await Ja();this._fragments.volumeRange.render({supportsVolume:M}),this._state.supportsVolume=M}},Tn=700,$r={LG:"large",SM:"small"};function Lt(v){return v.getBoundingClientRect().width<Tn?$r.SM:$r.LG}var Ae={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_MSE:"prefer-mse",METADATA_VIDEO_ID:"metadata-video-id",METADATA_VIDEO_TITLE:"metadata-video-title",METADATA_VIEWER_USER_ID:"metadata-viewer-user-id",BEACON_DOMAIN:"beacon-domain",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},$e={DEFAULT_SHOW_CAPTIONS:"default-show-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset"};function Yr(v,M){return{debug:v.debug,envKey:v.envKey,playbackId:v.playbackId,poster:v.poster,startTime:v.startTime,streamType:v.streamType,primaryColor:v.primaryColor,secondaryColor:v.secondaryColor,forwardSeekOffset:v.forwardSeekOffset,backwardSeekOffset:v.backwardSeekOffset,defaultShowCaptions:v.defaultShowCaptions,playerSize:Lt(v),hasCaptions:!!Or(v).length,showLoading:bn(v),supportsAirPlay:!1,supportsVolume:!1,...M}}var zr=Object.values(Ae),An=Object.values($e),Sn=Ya(),Ln="mux-player",kt=new WeakMap,Rt=class extends Mr{static get observedAttributes(){var v;return[...(v=Mr.observedAttributes)!=null?v:[],...zr,...An]}constructor(){super();kt.set(this,new _n(this))}connectedCallback(){kt.get(this).connectedCallback()}disconnectedCallback(){kt.get(this).disconnectedCallback()}attributeChangedCallback(v,M,O){var w;super.attributeChangedCallback(v,M,O),zr.includes(v)&&((w=this.video)==null||w.setAttribute(v,O))}get primaryColor(){return this.getAttribute($e.PRIMARY_COLOR)}get secondaryColor(){return this.getAttribute($e.SECONDARY_COLOR)}get forwardSeekOffset(){return this.getAttribute($e.FORWARD_SEEK_OFFSET)}get backwardSeekOffset(){return this.getAttribute($e.BACKWARD_SEEK_OFFSET)}get defaultShowCaptions(){return this.getAttribute($e.DEFAULT_SHOW_CAPTIONS)||!0}get playerSoftwareName(){return Ln}get playerSoftwareVersion(){return Sn}get hls(){var v;return(v=this.video)==null?void 0:v.hls}get mux(){var v;return(v=this.video)==null?void 0:v.mux}get playbackId(){return Ye(this,Ae.PLAYBACK_ID)}get envKey(){return Ye(this,Ae.ENV_KEY)}get debug(){return Ye(this,Ae.DEBUG)!=null}set debug(v){v?this.setAttribute(Ae.DEBUG,""):this.removeAttribute(Ae.DEBUG)}get streamType(){return Ye(this,Ae.STREAM_TYPE)}set streamType(v){this.setAttribute(Ae.STREAM_TYPE,`${v}`)}get startTime(){return Number(Ye(this,Ae.START_TIME))}set startTime(v){this.setAttribute(Ae.START_TIME,`${v}`)}get preferMse(){return Ye(this,Ae.PREFER_MSE)!=null}set preferMse(v){v?this.setAttribute(Ae.PREFER_MSE,""):this.removeAttribute(Ae.PREFER_MSE)}get metadata(){var v;return(v=this.video)==null?void 0:v.metadata}set metadata(v){this.video&&(this.video.metadata=v)}};function Ye(v,M){return v.video?v.video.getAttribute(M):v.getAttribute(M)}globalThis.customElements.get("mux-player")||(globalThis.customElements.define("mux-player",Rt),globalThis.MuxPlayerElement=Rt);var Hn=Rt})();export{wt as MuxPlayer};
