var ss=Object.defineProperty;var os=lt=>ss(lt,"__esModule",{value:!0});var Gt={};os(Gt);(()=>{var lt=Object.defineProperty,pi=o=>lt(o,"__esModule",{value:!0}),jt=(o,w)=>{pi(o);for(var x in w)lt(o,x,{get:w[x],enumerable:!0})},Ei={};jt(Ei,{MediaUIAttributes:()=>G,MediaUIEvents:()=>oe,ReadyStates:()=>yi,TextTrackKinds:()=>Ge,TextTrackModes:()=>Ne});var oe={MEDIA_PLAY_REQUEST:"mediaplayrequest",MEDIA_PAUSE_REQUEST:"mediapauserequest",MEDIA_MUTE_REQUEST:"mediamuterequest",MEDIA_UNMUTE_REQUEST:"mediaunmuterequest",MEDIA_VOLUME_REQUEST:"mediavolumerequest",MEDIA_SEEK_REQUEST:"mediaseekrequest",MEDIA_AIRPLAY_REQUEST:"mediaairplayrequest",MEDIA_ENTER_FULLSCREEN_REQUEST:"mediaenterfullscreenrequest",MEDIA_EXIT_FULLSCREEN_REQUEST:"mediaexitfullscreenrequest",MEDIA_PREVIEW_REQUEST:"mediapreviewrequest",MEDIA_ENTER_PIP_REQUEST:"mediaenterpiprequest",MEDIA_EXIT_PIP_REQUEST:"mediaexitpiprequest",MEDIA_SHOW_TEXT_TRACKS_REQUEST:"mediashowtexttracksrequest",MEDIA_HIDE_TEXT_TRACKS_REQUEST:"mediahidetexttracksrequest",MEDIA_SHOW_CAPTIONS_REQUEST:"mediashowcaptionsrequest",MEDIA_SHOW_SUBTITLES_REQUEST:"mediashowsubtitlesrequest",MEDIA_DISABLE_CAPTIONS_REQUEST:"mediadisablecaptionsrequest",MEDIA_DISABLE_SUBTITLES_REQUEST:"mediadisablesubtitlesrequest",MEDIA_PLAYBACK_RATE_REQUEST:"mediaplaybackraterequest",REGISTER_MEDIA_STATE_RECEIVER:"registermediastatereceiver",UNREGISTER_MEDIA_STATE_RECEIVER:"unregistermediastatereceiver"},G={MEDIA_PAUSED:"media-paused",MEDIA_MUTED:"media-muted",MEDIA_VOLUME_LEVEL:"media-volume-level",MEDIA_VOLUME:"media-volume",MEDIA_IS_PIP:"media-is-pip",MEDIA_CAPTIONS_LIST:"media-captions-list",MEDIA_SUBTITLES_LIST:"media-subtitles-list",MEDIA_CAPTIONS_SHOWING:"media-captions-showing",MEDIA_SUBTITLES_SHOWING:"media-subtitles-showing",MEDIA_IS_FULLSCREEN:"media-is-fullscreen",MEDIA_PLAYBACK_RATE:"media-playback-rate",MEDIA_CURRENT_TIME:"media-current-time",MEDIA_DURATION:"media-duration",MEDIA_PREVIEW_IMAGE:"media-preview-image",MEDIA_PREVIEW_COORDS:"media-preview-coords",MEDIA_CHROME_ATTRIBUTES:"media-chrome-attributes",MEDIA_CONTROLLER:"media-controller",MEDIA_LOADING:"media-loading"},Ge={SUBTITLES:"subtitles",CAPTIONS:"captions",DESCRIPTIONS:"descriptions",CHAPTERS:"chapters",METADATA:"metadata"},Ne={DISABLED:"disabled",HIDDEN:"hidden",SHOWING:"showing"},yi={HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},xe={AUDIO_PLAYER:()=>"audio player",VIDEO_PLAYER:()=>"video player",VOLUME:()=>"volume",SEEK:()=>"seek",CLOSED_CAPTIONS:()=>"closed captions",PLAYBACK_RATE:({playbackRate:o=1}={})=>`current playback rate ${o}`,PLAYBACK_TIME:()=>"playback time",MEDIA_LOADING:()=>"media loading"},Se={PLAY:()=>"play",PAUSE:()=>"pause",MUTE:()=>"mute",UNMUTE:()=>"unmute",AIRPLAY:()=>"air play",ENTER_FULLSCREEN:()=>"enter fullscreen mode",EXIT_FULLSCREEN:()=>"exit fullscreen mode",ENTER_PIP:()=>"enter picture in picture mode",EXIT_PIP:()=>"exit picture in picture mode",SEEK_FORWARD_N_SECS:({seekOffset:o=30}={})=>`seek forward ${o} seconds`,SEEK_BACK_N_SECS:({seekOffset:o=30}={})=>`seek back ${o} seconds`},ls={...xe,...Se},Ti={};jt(Ti,{formatAsTimePhrase:()=>je,formatTime:()=>Ve});var _i=o=>typeof o=="number"&&!Number.isNaN(o)&&Number.isFinite(o),Vt=[{singular:"hour",plural:"hours"},{singular:"minute",plural:"minutes"},{singular:"second",plural:"seconds"}],Ai=(o,w)=>{let x=o===1?Vt[w].singular:Vt[w].plural;return`${o} ${x}`},je=o=>{if(!_i(o))return"";let w=Math.abs(o),x=w!==o,O=new Date(0,0,0,0,0,w,0);return`${[O.getHours(),O.getMinutes(),O.getSeconds()].map((b,P)=>b&&Ai(b,P)).filter(b=>b).join(", ")}${x?" remaining":""}`};function Ve(o,w){let x=!1;o<0&&(x=!0,o=0-o),o=o<0?0:o;let O=Math.floor(o%60),s=Math.floor(o/60%60),R=Math.floor(o/3600),_=Math.floor(w/60%60),b=Math.floor(w/3600);return(isNaN(o)||o===1/0)&&(R=s=O="-"),R=R>0||b>0?R+":":"",s=((R||_>=10)&&s<10?"0"+s:s)+":",O=O<10?"0"+O:O,(x?"-":"")+R+s+O}var $t={HTMLElement:function(){this.addEventListener=()=>{},this.removeEventListener=()=>{},this.dispatchEvent=()=>{}},customElements:{get:function(){},define:function(){},whenDefined:function(){}},CustomEvent:function(){}},Si={createElement:function(){return new $t.HTMLElement}},Yt=typeof window=="undefined"||typeof window.customElements=="undefined",re=Yt?$t:window,Z=Yt?Si:window.document;function he(o,w){re.customElements.get(o)||(re.customElements.define(o,w),re[w.name]=w)}var zt=Z.createElement("template");zt.innerHTML=`
<style>
  :host {
    display: inline-block;
    width: auto;
    height: auto;
    vertical-align: middle;
    box-sizing: border-box;
    background: var(--media-control-background, rgba(20,20,30, 0.7));

    padding: 10px;

    /* Vertically center any text */
    font-size: 14px;
    font-weight: bold;
    color: #ffffff;
    text-align: center;

    transition: background 0.15s linear;

    pointer-events: auto;
    cursor: pointer;
    font-family: Arial, sans-serif;
    vertical-align: middle;
  }

  /*
    Only show outline when keyboard focusing.
    https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo
  */
  :host-context([media-keyboard-control]):host(:focus),
  :host-context([media-keyboard-control]):host(:focus-within) {
    box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  :host(:hover) {
    background: var(--media-control-hover-background, rgba(50,50,70, 0.7));
  }

  svg, img, ::slotted(svg), ::slotted(img) {
    width: var(--media-button-icon-width, 24px);
    height: var(--media-button-icon-height);
    transform: var(--media-button-icon-transform);
    transition: var(--media-button-icon-transition);
    fill: var(--media-icon-color, #eee);
    vertical-align: middle;
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

  ::slotted(div), ::slotted(span) {
    height: 24px;
  }
</style>
`;var Xt=["Enter"," "],Qt=class extends re.HTMLElement{static get observedAttributes(){return[G.MEDIA_CONTROLLER]}constructor(o={}){super();let w=this.attachShadow({mode:"open"}),x=zt.content.cloneNode(!0);this.nativeEl=x;let O=o.slotTemplate;O||(O=Z.createElement("template"),O.innerHTML=`<slot>${o.defaultContent||""}</slot>`),this.nativeEl.appendChild(O.content.cloneNode(!0)),w.appendChild(x),this.addEventListener("click",R=>{this.handleClick(R)});let s=R=>{let{key:_}=R;if(!Xt.includes(_)){this.removeEventListener("keyup",s);return}this.handleClick(R)};this.addEventListener("keydown",R=>{let{metaKey:_,altKey:b,key:P}=R;if(_||b||!Xt.includes(P)){this.removeEventListener("keyup",s);return}this.addEventListener("keyup",s)})}attributeChangedCallback(o,w,x){var O,s;if(o===G.MEDIA_CONTROLLER){if(w){let R=Z.getElementById(w);(O=R==null?void 0:R.unassociateElement)==null||O.call(R,this)}if(x){let R=Z.getElementById(x);(s=R==null?void 0:R.associateElement)==null||s.call(R,this)}}}connectedCallback(){var o;this.setAttribute("role","button"),this.setAttribute("tabindex",0);let w=this.getAttribute(G.MEDIA_CONTROLLER);if(w){let x=Z.getElementById(w);(o=x==null?void 0:x.associateElement)==null||o.call(x,this)}}disconnectedCallback(){var o;if(this.getAttribute(G.MEDIA_CONTROLLER)){let x=Z.getElementById(mediaControllerId);(o=x==null?void 0:x.unassociateElement)==null||o.call(x,this)}}handleClick(){}};he("media-chrome-button",Qt);var we=Qt,bi='<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 18"><defs><style>.cls-1{fill:var(--media-icon-color, #eee);}</style></defs><title>Mux Player SVG Icons_v2</title><path class="cls-1" d="M10.19,11.22a.25.25,0,0,0-.38,0L4.35,17.59a.25.25,0,0,0,.19.41H15.46a.25.25,0,0,0,.19-.41Z"/><path class="cls-1" d="M19,0H1A1,1,0,0,0,0,1V14a1,1,0,0,0,1,1H3.94L5,13.75H1.25V1.25h17.5v12.5H15L16.06,15H19a1,1,0,0,0,1-1V1A1,1,0,0,0,19,0Z"/></svg>',Jt=Z.createElement("template");Jt.innerHTML=`
  <style>
  </style>

  <slot name="airplay">${bi}</slot>
`;var Li=class extends we{static get observedAttributes(){return[...super.observedAttributes]}constructor(o={}){super({slotTemplate:Jt,...o})}connectedCallback(){this.setAttribute("aria-label",Se.AIRPLAY()),super.connectedCallback()}handleClick(o){let w=new re.CustomEvent(oe.MEDIA_AIRPLAY_REQUEST,{composed:!0,bubbles:!0});this.dispatchEvent(w)}};he("media-airplay-button",Li);var Zt=Z.createElement("template");Zt.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      position: relative;
      display: inline-block;
      background-color: #000;
    }

    :host(:not([audio])) *[part~=layer] {
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      display: flex;
      flex-flow: column nowrap;
      align-items: start;
      pointer-events: none;
      background: none;
    }

    :host(:not([audio])) :is([part~=gestures-layer],[part~=media-layer]) {
      pointer-events: auto;
    }
    
    :host(:not([audio])) *[part~=layer][part~=centered-layer] {
      align-items: center;
      justify-content: center;
    }

    .spacer {
      pointer-events: none;
      background: none;
    }

    /* Position the media element to fill the container */
    ::slotted([slot=media]) {
      width: 100%;
      height: 100%;
    }

    /* Video specific styles */
    :host(:not([audio])) {
      aspect-ratio: var(--media-aspect-ratio, auto 3 / 2);
      width: 720px;
    }

    :host(:not([audio])) .spacer {
      flex-grow: 1;
    }

    @supports not (aspect-ratio: 1 / 1) {
      :host(:not([audio])) {
        height: 480px;
      }
    }

    /* Safari needs this to actually make the element fill the window */
    :host(:-webkit-full-screen) {
      /* Needs to use !important otherwise easy to break */
      width: 100% !important;
      height: 100% !important;
    }

    ::slotted(:not([slot=media])) {
      pointer-events: auto;
    }

    /* Only add these if auto hide is not disabled */
    ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 1;
      transition: opacity 0.25s;
    }

    /* Hide controls when inactive, not paused, not audio and auto hide not disabled */
    :host([user-inactive]:not([${G.MEDIA_PAUSED}]):not([audio])) ::slotted(:not([slot=media]):not([no-auto-hide])) {
      opacity: 0;
      transition: opacity 1s;
    }

    ::slotted(media-control-bar)  {
      align-self: stretch;
    }
  </style>

  <span part="layer media-layer">
    <slot name="media"></slot>
  </span>
  <span part="layer gesture-layer">
    <slot name="gestures-chrome"></slot>
  </span>
  <span part="layer vertical-layer">
    <slot name="top-chrome"></slot>
    <span class="spacer"><slot name="middle-chrome"></slot></span>
    <!-- default, effectively "bottom-chrome" -->
    <slot></slot>
  </span>
  <span part="layer centered-layer">
    <slot name="centered-chrome"></slot>
  </span>
`;var Di=Object.values(G),qt=class extends re.HTMLElement{constructor(){super();let o=this.attachShadow({mode:"open"});this.shadowRoot.appendChild(Zt.content.cloneNode(!0));let w=(O,s)=>{let R=this.media;for(let _ of O)_.type==="childList"&&(_.removedNodes.forEach(b=>{if(b.slot=="media"&&_.target==this){let P=_.previousSibling&&_.previousSibling.previousElementSibling;if(!P||!R)this.mediaUnsetCallback(b);else{let M=P.slot!=="media";for(;(P=P.previousSibling)!==null;)P.slot=="media"&&(M=!1);M&&this.mediaUnsetCallback(b)}}}),R&&_.addedNodes.forEach(b=>{b==R&&this.handleMediaUpdated(R).then(P=>this.mediaSetCallback(P))}))};new MutationObserver(w).observe(this,{childList:!0,subtree:!0})}static get observedAttributes(){return["autohide"].concat(Di)}attributeChangedCallback(o,w,x){o.toLowerCase()=="autohide"&&(this.autohide=x)}get media(){let o=this.querySelector(":scope > [slot=media]");return(o==null?void 0:o.nodeName)=="SLOT"&&(o=o.assignedElements({flatten:!0})[0]),o}mediaSetCallback(o){this._mediaClickPlayToggle=w=>{let x=o.paused?oe.MEDIA_PLAY_REQUEST:oe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new re.CustomEvent(x,{composed:!0,bubbles:!0}))}}handleMediaUpdated(o){let w=s=>Promise.resolve(s),x=s=>(console.error('<media-chrome>: Media element set with slot="media" does not appear to be compatible.',s),Promise.reject(s));if(!o)return x(o);let O=o.nodeName.toLowerCase();return O.includes("-")?re.customElements.whenDefined(O).then(()=>w(o)):w(o)}mediaUnsetCallback(o){}connectedCallback(){let w=this.getAttribute("audio")!=null?xe.AUDIO_PLAYER():xe.VIDEO_PLAYER();this.setAttribute("role","region"),this.setAttribute("aria-label",w),this.media&&this.handleMediaUpdated(this.media).then(O=>this.mediaSetCallback(O));let x=()=>{this.removeAttribute("user-inactive"),re.clearTimeout(this.inactiveTimeout),!(this.autohide<0)&&(this.inactiveTimeout=re.setTimeout(()=>{this.setAttribute("user-inactive","user-inactive")},this.autohide*1e3))};this.addEventListener("keyup",O=>{x()}),this.addEventListener("keyup",O=>{this.setAttribute("media-keyboard-control","media-keyboard-control")}),this.addEventListener("mouseup",O=>{this.removeAttribute("media-keyboard-control")}),this.addEventListener("mousemove",O=>{O.target!==this&&(this.removeAttribute("user-inactive"),re.clearTimeout(this.inactiveTimeout),O.target===this.media&&x())}),this.addEventListener("mouseout",O=>{this.autohide>-1&&this.setAttribute("user-inactive","user-inactive")})}set autohide(o){o=Number(o),this._autohide=isNaN(o)?0:o}get autohide(){return this._autohide===void 0?2:this._autohide}};he("media-container-temp",qt);var Ii=qt,Te={enter:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange",element:"fullscreenElement",error:"fullscreenerror"};Z.fullscreenElement===void 0&&(Te.enter="webkitRequestFullScreen",Te.exit=Z.webkitExitFullscreen!=null?"webkitExitFullscreen":"webkitCancelFullScreen",Te.event="webkitfullscreenchange",Te.element="webkitFullscreenElement",Te.error="webkitfullscreenerror");function Lt(o,w=!1){return o.split("_").map(function(x,O){return(O||w?x[0].toUpperCase():x[0].toLowerCase())+x.slice(1).toLowerCase()}).join("")}var er=(o,w,x=".value")=>{let O=o.querySelector(x);!O||(O.textContent=w)},Mi=(o,w)=>{let x=`slot[name="${w}"]`,O=o.shadowRoot.querySelector(x);return O?O.children:[]},tr=(o,w)=>Mi(o,w)[0],rr=(o,w)=>!o||!w?!1:o.contains(w)?!0:[o,...o.querySelectorAll("*")].some(x=>rr(x.shadowRoot,w)),Dt=(o="")=>o.split(/\s+/),ir=(o="")=>{let[w,x]=o.split(":"),O=x?decodeURIComponent(x):void 0;return{language:w,label:O}},Ri=(o="",w={})=>Dt(o).map(x=>{let O=ir(x);return{...w,...O}}),Oi=o=>Array.isArray(o)?o.map(w=>typeof w=="string"?ir(w):w):typeof o=="string"?Ri(o):[o],Ci=({label:o,language:w}={})=>o?`${w}:${encodeURIComponent(o)}`:w,Me=(o=[])=>Array.prototype.map.call(o,Ci).join(" "),Pi=(o,w)=>x=>x[o]===w,nr=o=>{let w=Object.entries(o).map(([x,O])=>Pi(x,O));return x=>w.every(O=>O(x))},ut=(o,w=[],x=[])=>{let O=Oi(x).map(nr),s=R=>O.some(_=>_(R));Array.from(w).filter(s).forEach(R=>{R.mode=o})},qe=(o,w=()=>!0)=>{if(!(o==null?void 0:o.textTracks))return[];let x=typeof w=="function"?w:nr(w);return Array.from(o.textTracks).filter(x)},{MEDIA_PLAY_REQUEST:xi,MEDIA_PAUSE_REQUEST:wi,MEDIA_MUTE_REQUEST:ki,MEDIA_UNMUTE_REQUEST:Ui,MEDIA_VOLUME_REQUEST:Bi,MEDIA_ENTER_FULLSCREEN_REQUEST:Fi,MEDIA_EXIT_FULLSCREEN_REQUEST:Ni,MEDIA_SEEK_REQUEST:Ki,MEDIA_PREVIEW_REQUEST:Hi,MEDIA_ENTER_PIP_REQUEST:Wi,MEDIA_EXIT_PIP_REQUEST:Gi,MEDIA_PLAYBACK_RATE_REQUEST:ji}=oe,ar=class extends Ii{constructor(){super();this.mediaStateReceivers=[],this.associatedElementSubscriptions=new Map,this.associatedElements=[],this.associateElement(this);let o={MEDIA_PLAY_REQUEST:()=>this.media.play(),MEDIA_PAUSE_REQUEST:()=>this.media.pause(),MEDIA_MUTE_REQUEST:()=>this.media.muted=!0,MEDIA_UNMUTE_REQUEST:()=>{let w=this.media;w.muted=!1,w.volume===0&&(w.volume=.25)},MEDIA_VOLUME_REQUEST:w=>{let x=this.media,O=w.detail;x.volume=O,O>0&&x.muted&&(x.muted=!1);try{re.localStorage.setItem("media-chrome-pref-volume",O.toString())}catch{}},MEDIA_ENTER_FULLSCREEN_REQUEST:()=>{let w=this.media;Z.pictureInPictureElement&&Z.exitPictureInPicture(),super[Te.enter]?super[Te.enter]():w.webkitEnterFullscreen?w.webkitEnterFullscreen():w.requestFullscreen?w.requestFullscreen():console.warn("MediaChrome: Fullscreen not supported")},MEDIA_EXIT_FULLSCREEN_REQUEST:()=>{Z[Te.exit]()},MEDIA_ENTER_PIP_REQUEST:()=>{let w=this.media;!Z.pictureInPictureEnabled||(Z[Te.element]&&Z[Te.exit](),w.requestPictureInPicture())},MEDIA_EXIT_PIP_REQUEST:()=>{Z.pictureInPictureElement&&Z.exitPictureInPicture()},MEDIA_SEEK_REQUEST:w=>{let x=this.media,O=w.detail;(x.readyState>0||x.readyState===void 0)&&(x.currentTime=O)},MEDIA_PLAYBACK_RATE_REQUEST:w=>{this.media.playbackRate=w.detail},MEDIA_PREVIEW_REQUEST:w=>{let x=this.media;if(!x)return;let[O]=qe(x,{kind:Ge.METADATA,label:"thumbnails"});if(!(O&&O.cues))return;let s=w.detail,R=Array.prototype.find.call(O.cues,P=>P.startTime>=s);if(!R)return;let _=new URL(R.text),b=new URLSearchParams(_.hash).get("#xywh");this.propagateMediaState(G.MEDIA_PREVIEW_IMAGE,_.href),this.propagateMediaState(G.MEDIA_PREVIEW_COORDS,b.split(",").join(" "))},MEDIA_SHOW_CAPTIONS_REQUEST:w=>{let x=this.captionTracks,{detail:O=[]}=w;ut(Ne.SHOWING,x,O)},MEDIA_DISABLE_CAPTIONS_REQUEST:w=>{let x=this.captionTracks,{detail:O=[]}=w;ut(Ne.DISABLED,x,O)},MEDIA_SHOW_SUBTITLES_REQUEST:w=>{let x=this.subtitleTracks,{detail:O=[]}=w;ut(Ne.SHOWING,x,O)},MEDIA_DISABLE_SUBTITLES_REQUEST:w=>{let x=this.subtitleTracks,{detail:O=[]}=w;ut(Ne.DISABLED,x,O)},MEDIA_AIRPLAY_REQUEST:w=>{let{media:x}=this;if(!!x){if(!(x.webkitShowPlaybackTargetPicker&&re.WebKitPlaybackTargetAvailabilityEvent)){console.warn("received a request to select AirPlay but AirPlay is not supported in this environment");return}x.webkitShowPlaybackTargetPicker()}}};Object.keys(o).forEach(w=>{let x=`_handle${Lt(w,!0)}`;this[x]=O=>{if(O.stopPropagation(),!this.media){console.warn("MediaController: No media available.");return}o[w](O,this.media)},this.addEventListener(oe[w],this[x])}),this._mediaStatePropagators={"play,pause":()=>{this.propagateMediaState(G.MEDIA_PAUSED,this.paused)},volumechange:()=>{this.propagateMediaState(G.MEDIA_MUTED,this.muted),this.propagateMediaState(G.MEDIA_VOLUME,this.volume),this.propagateMediaState(G.MEDIA_VOLUME_LEVEL,this.volumeLevel)},[Te.event]:()=>{var w;let x=Z[Te.element];this.propagateMediaState(G.MEDIA_IS_FULLSCREEN,x===((w=this.getRootNode().host)!=null?w:this))},"enterpictureinpicture,leavepictureinpicture":w=>{let x;w?x=w.type=="enterpictureinpicture":x=this.isPip,this.propagateMediaState(G.MEDIA_IS_PIP,x)},"timeupdate,loadedmetadata":()=>{this.propagateMediaState(G.MEDIA_CURRENT_TIME,this.currentTime)},"durationchange,loadedmetadata":()=>{this.propagateMediaState(G.MEDIA_DURATION,this.duration)},ratechange:()=>{this.propagateMediaState(G.MEDIA_PLAYBACK_RATE,this.playbackRate)},"waiting,playing":()=>{var w;let x=((w=this.media)==null?void 0:w.readyState)<3;this.propagateMediaState(G.MEDIA_LOADING,x)}},this._textTrackMediaStatePropagators={"addtrack,removetrack":()=>{this.propagateMediaState(G.MEDIA_CAPTIONS_LIST,Me(this.captionTracks)||void 0),this.propagateMediaState(G.MEDIA_SUBTITLES_LIST,Me(this.subtitleTracks)||void 0),this.propagateMediaState(G.MEDIA_CAPTIONS_SHOWING,Me(this.showingCaptionTracks)||void 0),this.propagateMediaState(G.MEDIA_SUBTITLES_SHOWING,Me(this.showingSubtitleTracks)||void 0)},change:()=>{this.propagateMediaState(G.MEDIA_CAPTIONS_SHOWING,Me(this.showingCaptionTracks)||void 0),this.propagateMediaState(G.MEDIA_SUBTITLES_SHOWING,Me(this.showingSubtitleTracks)||void 0)}}}mediaSetCallback(o){super.mediaSetCallback(o),Object.keys(this._mediaStatePropagators).forEach(w=>{let x=w.split(","),O=this._mediaStatePropagators[w];x.forEach(s=>{(s==Te.event?this.getRootNode():o).addEventListener(s,O)}),O()}),Object.entries(this._textTrackMediaStatePropagators).forEach(([w,x])=>{w.split(",").forEach(s=>{o.textTracks&&o.textTracks.addEventListener(s,x)}),x()});try{let w=re.localStorage.getItem("media-chrome-pref-volume");w!==null&&(o.volume=w)}catch(w){console.debug("Error getting volume pref",w)}}mediaUnsetCallback(o){super.mediaUnsetCallback(o),Object.keys(this._mediaStatePropagators).forEach(w=>{let x=w.split(","),O=this._mediaStatePropagators[w];x.forEach(s=>{(s==Te.event?this.getRootNode():o).removeEventListener(s,O)})}),Object.entries(this._textTrackMediaStatePropagators).forEach(([w,x])=>{w.split(",").forEach(s=>{o.textTracks&&o.textTracks.removeEventListener(s,x)}),x()}),this.propagateMediaState(G.MEDIA_PAUSED,!0)}propagateMediaState(o,w){be(this.mediaStateReceivers,o,w)}associateElement(o){if(!o)return;let{associatedElementSubscriptions:w}=this;if(w.has(o))return;let x=this.registerMediaStateReceiver.bind(this),O=this.unregisterMediaStateReceiver.bind(this),s=zi(o,x,O);Object.keys(oe).forEach(R=>{o.addEventListener(oe[R],this[`_handle${Lt(R,!0)}`])}),w.set(o,s)}unassociateElement(o){if(!o)return;let{associatedElementSubscriptions:w}=this;if(!w.has(o))return;w.get(o)(),w.delete(o),Object.keys(oe).forEach(O=>{o.removeEventListener(oe[O],this[`_handle${Lt(O,!0)}`])})}registerMediaStateReceiver(o){if(!o)return;let w=this.mediaStateReceivers;w.indexOf(o)>-1||(w.push(o),this.media&&(be([o],G.MEDIA_CAPTIONS_LIST,Me(this.captionTracks)||void 0),be([o],G.MEDIA_SUBTITLES_LIST,Me(this.subtitleTracks)||void 0),be([o],G.MEDIA_CAPTIONS_SHOWING,Me(this.showingCaptionTracks)||void 0),be([o],G.MEDIA_SUBTITLES_SHOWING,Me(this.showingSubtitleTracks)||void 0),be([o],G.MEDIA_PAUSED,this.paused),be([o],G.MEDIA_MUTED,this.muted),be([o],G.MEDIA_VOLUME,this.volume),be([o],G.MEDIA_VOLUME_LEVEL,this.volumeLevel),be([o],G.MEDIA_CURRENT_TIME,this.currentTime),be([o],G.MEDIA_DURATION,this.duration),be([o],G.MEDIA_PLAYBACK_RATE,this.playbackRate)))}unregisterMediaStateReceiver(o){let w=this.mediaStateReceivers,x=w.indexOf(o);x<0||w.splice(x,1)}play(){this.dispatchEvent(new re.CustomEvent(xi))}pause(){this.dispatchEvent(new re.CustomEvent(wi))}get paused(){return this.media?this.media.paused:!0}get muted(){return!!(this.media&&this.media.muted)}set muted(o){let w=o?ki:Ui;this.dispatchEvent(new re.CustomEvent(w))}get volume(){let o=this.media;return o?o.volume:1}set volume(o){this.dispatchEvent(new re.CustomEvent(Bi,{detail:o}))}get volumeLevel(){let o="high";if(!this.media)return o;let{muted:w,volume:x}=this.media;return x===0||w?o="off":x<.5?o="low":x<.75&&(o="medium"),o}requestFullscreen(){this.dispatchEvent(new re.CustomEvent(Fi))}exitFullscreen(){this.dispatchEvent(new re.CustomEvent(Ni))}get currentTime(){let o=this.media;return o?o.currentTime:0}set currentTime(o){this.dispatchEvent(new re.CustomEvent(Ki,{detail:o}))}get duration(){let o=this.media;return o?o.duration:NaN}get playbackRate(){let o=this.media;return o?o.playbackRate:1}set playbackRate(o){this.dispatchEvent(new re.CustomEvent(ji,{detail:o}))}get subtitleTracks(){return qe(this.media,{kind:Ge.SUBTITLES})}get captionTracks(){return qe(this.media,{kind:Ge.CAPTIONS})}get showingSubtitleTracks(){return qe(this.media,{kind:Ge.SUBTITLES,mode:Ne.SHOWING})}get showingCaptionTracks(){return qe(this.media,{kind:Ge.CAPTIONS,mode:Ne.SHOWING})}get isPip(){var o;let w=(o=this.getRootNode().pictureInPictureElement)!=null?o:Z.pictureInPictureElement;return this.media&&rr(this.media,w)}requestPictureInPicture(){this.dispatchEvent(new re.CustomEvent(Wi))}exitPictureInPicture(){this.dispatchEvent(new re.CustomEvent(Gi))}requestPreview(o){this.dispatchEvent(new re.CustomEvent(Hi,{detail:o}))}},Vi=Object.values(G),sr=o=>{var w,x,O;let{constructor:{observedAttributes:s}}=o,R=(O=(x=(w=o==null?void 0:o.getAttribute)==null?void 0:w.call(o,G.MEDIA_CHROME_ATTRIBUTES))==null?void 0:x.split)==null?void 0:O.call(x,/\s+/);return Array.isArray(s||R)?(s||R).filter(_=>Vi.includes(_)):[]},It=o=>!!sr(o).length,$i=(o,w,x)=>x==null?o.removeAttribute(w):typeof x=="boolean"?x?o.setAttribute(w,""):o.removeAttribute(w):Number.isNaN(x)?o.removeAttribute(w):o.setAttribute(w,x),Yi=o=>{var w;return!!((w=o.closest)==null?void 0:w.call(o,'*[slot="media"]'))},et=(o,w)=>{if(Yi(o))return;let x=(s,R)=>{var _,b;It(s)&&R(s);let{children:P=[]}=s!=null?s:{},M=(b=(_=s==null?void 0:s.shadowRoot)==null?void 0:_.children)!=null?b:[];[...P,...M].forEach(D=>et(D,R))},O=o==null?void 0:o.nodeName.toLowerCase();if(O.includes("-")&&!It(o)){re.customElements.whenDefined(O).then(()=>{x(o,w)});return}x(o,w)},be=(o,w,x)=>{o.forEach(O=>{!sr(O).includes(w)||$i(O,w,x)})},zi=(o,w,x)=>{et(o,w);let O=P=>{var M;let I=(M=P==null?void 0:P.composedPath()[0])!=null?M:P.target;w(I)},s=P=>{var M;let I=(M=P==null?void 0:P.composedPath()[0])!=null?M:P.target;x(I)};o.addEventListener(oe.REGISTER_MEDIA_STATE_RECEIVER,O),o.addEventListener(oe.UNREGISTER_MEDIA_STATE_RECEIVER,s);let R=(P,M)=>{P.forEach(I=>{let{addedNodes:D=[],removedNodes:c=[],type:T,target:y,attributeName:E}=I;T==="childList"?(Array.prototype.forEach.call(D,A=>et(A,w)),Array.prototype.forEach.call(c,A=>et(A,x))):T==="attributes"&&E===G.MEDIA_CHROME_ATTRIBUTES&&(It(y)?w(y):x(y))})},_=new MutationObserver(R);return _.observe(o,{childList:!0,attributes:!0,subtree:!0}),()=>{et(o,x),_.disconnect(),o.removeEventListener(oe.REGISTER_MEDIA_STATE_RECEIVER,O),o.removeEventListener(oe.UNREGISTER_MEDIA_STATE_RECEIVER,s)}};he("media-controller",ar);var or=ar,lr=Z.createElement("template"),ur=`
  height: var(--thumb-height);
  width: var(--media-range-thumb-width, 10px);
  border: var(--media-range-thumb-border, none);
  border-radius: var(--media-range-thumb-border-radius, 10px);
  background: var(--media-range-thumb-background, #fff);
  box-shadow: var(--media-range-thumb-box-shadow, 1px 1px 1px transparent);
  cursor: pointer;
  transition: var(--media-range-thumb-transition, none);
  transform: var(--media-range-thumb-transform, none);
  opacity: var(--media-range-thumb-opacity, 1);
`,Mt=`
  width: var(--media-range-track-width, 100%);
  min-width: 40px;
  height: var(--track-height);
  border: var(--media-range-track-border, none);
  border-radius: var(--media-range-track-border-radius, 0);
  background: var(--media-range-track-background-internal, var(--media-range-track-background-color, #eee));

  box-shadow: var(--media-range-track-box-shadow, none);
  transition: var(--media-range-track-transition, none);
  cursor: pointer;
`;lr.innerHTML=`
  <style>
    :host {
      --thumb-height: var(--media-range-thumb-height, 10px);
      --track-height: var(--media-range-track-height, 4px);

      position: relative;
      display: inline-block;
      vertical-align: middle;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
      transition: background 0.15s linear;
      height: 44px;
      width: 100px;
      padding: 0 10px;

      pointer-events: auto;
    }

    /*
      Only show outline when keyboard focusing.
      https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo
    */
    :host-context([media-keyboard-control]):host(:focus),
    :host-context([media-keyboard-control]):host(:focus-within) {
      box-shadow: inset 0 0 0 2px rgba(27, 127, 204, 0.9);
    }

    :host(:hover) {
      background: var(--media-control-hover-background, rgba(50,50,60, 0.7));
    }

    input[type=range] {
      /* Reset */
      -webkit-appearance: none; /* Hides the slider so that custom slider can be made */
      background: transparent; /* Otherwise white in Chrome */

      /* Fill host with the range */
      min-height: 100%;
      width: var(--media-range-track-width, 100%); /* Specific width is required for Firefox. */

      box-sizing: border-box;
      padding: 0;
      margin: 0;
    }

    /* Special styling for WebKit/Blink */
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      ${ur}
      /* You need to specify a margin in Chrome, but in Firefox and IE it is automatic */
      margin-top: calc(calc(0px - var(--thumb-height) + var(--track-height)) / 2);
    }
    input[type=range]::-moz-range-thumb { ${ur} }

    input[type=range]::-webkit-slider-runnable-track { ${Mt} }
    input[type=range]::-moz-range-track { ${Mt} }
    input[type=range]::-ms-track {
      /* Reset */
      width: 100%;
      cursor: pointer;
      /* Hides the slider so custom styles can be added */
      background: transparent;
      border-color: transparent;
      color: transparent;

      ${Mt}
    }

    /* Eventually want to move towards different styles for focus-visible
       https://github.com/WICG/focus-visible/blob/master/src/focus-visible.js
       Youtube appears to do this by de-focusing a button after a button click */
    input[type=range]:focus {
      outline: 0;
    }
    input[type=range]:focus::-webkit-slider-runnable-track {
      outline: 0;
    }

    input[type=range]:disabled::-webkit-slider-thumb {
      background-color: #777;
    }

    input[type=range]:disabled::-webkit-slider-runnable-track {
      background-color: #777;
    }

  </style>
  <input id="range" type="range" min="0" max="1000" step="1" value="0">
`;var dr=class extends re.HTMLElement{static get observedAttributes(){return[G.MEDIA_CONTROLLER]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(lr.content.cloneNode(!0)),this.range=this.shadowRoot.querySelector("#range"),this.range.addEventListener("input",this.updateBar.bind(this))}attributeChangedCallback(o,w,x){var O,s;if(o===G.MEDIA_CONTROLLER){if(w){let R=Z.getElementById(w);(O=R==null?void 0:R.unassociateElement)==null||O.call(R,this)}if(x){let R=Z.getElementById(x);(s=R==null?void 0:R.associateElement)==null||s.call(R,this)}}}connectedCallback(){var o;let w=this.getAttribute(G.MEDIA_CONTROLLER);if(w){let x=Z.getElementById(w);(o=x==null?void 0:x.associateElement)==null||o.call(x,this)}this.updateBar()}disconnectedCallback(){var o;if(this.getAttribute(G.MEDIA_CONTROLLER)){let x=Z.getElementById(mediaControllerId);(o=x==null?void 0:x.unassociateElement)==null||o.call(x,this)}}updateBar(){let o=this.getBarColors(),w="linear-gradient(to right, ",x=0;o.forEach(O=>{O[1]<x||(w=w+`${O[0]} ${x}%, ${O[0]} ${O[1]}%,`,x=O[1])}),w=w.slice(0,w.length-1)+")",this.style.setProperty("--media-range-track-background-internal",w)}getBarColors(){let o=this.range,w=o.value/o.max*100;return[["var(--media-range-bar-color, #fff)",w],["var(--media-range-track-background-color, #333)",100]]}};he("media-chrome-range",dr);var cr=dr,fr=Z.createElement("template");fr.innerHTML=`
  <style>
    :host {
      /* Need position to display above video for some reason */
      box-sizing: border-box;
      display: inline-flex;

      color: var(--media-icon-color, #eee);
    }

    media-time-range,
    ::slotted(media-time-range),
    ::slotted(media-progress-range),
    ::slotted(media-clip-selector) {
      flex-grow: 1;
    }
  </style>

  <slot></slot>
`;var Xi=class extends re.HTMLElement{static get observedAttributes(){return[G.MEDIA_CONTROLLER]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(fr.content.cloneNode(!0))}attributeChangedCallback(o,w,x){var O,s;if(o===G.MEDIA_CONTROLLER){if(w){let R=Z.getElementById(w);(O=R==null?void 0:R.unassociateElement)==null||O.call(R,this)}if(x){let R=Z.getElementById(x);(s=R==null?void 0:R.associateElement)==null||s.call(R,this)}}}connectedCallback(){var o;let w=this.getAttribute(G.MEDIA_CONTROLLER);if(w){let x=Z.getElementById(w);(o=x==null?void 0:x.associateElement)==null||o.call(x,this)}}disconnectedCallback(){var o;if(this.getAttribute(G.MEDIA_CONTROLLER)){let x=Z.getElementById(mediaControllerId);(o=x==null?void 0:x.unassociateElement)==null||o.call(x,this)}}};he("media-control-bar",Xi);var hr=Z.createElement("template");hr.innerHTML=`
  <style>
    :host {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      background: var(--media-control-background, rgba(20,20,30, 0.7));
  
      padding: 10px;

      font-size: 14px;
      line-height: 24px;
      font-family: Arial, sans-serif;
      text-align: center;
      color: #ffffff;
      pointer-events: auto;
    }

    #container {
      /* NOTE: We don't currently have more generic sizing vars */
      height: var(--media-text-content-height, auto);
    }
  </style>
  <span id="container">
  <slot></slot>
  </span>
`;var vr=class extends re.HTMLElement{static get observedAttributes(){return[G.MEDIA_CONTROLLER]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(hr.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector("#container")}attributeChangedCallback(o,w,x){var O,s;if(o===G.MEDIA_CONTROLLER){if(w){let R=Z.getElementById(w);(O=R==null?void 0:R.unassociateElement)==null||O.call(R,this)}if(x){let R=Z.getElementById(x);(s=R==null?void 0:R.associateElement)==null||s.call(R,this)}}}connectedCallback(){var o;let w=this.getAttribute(G.MEDIA_CONTROLLER);if(w){let x=Z.getElementById(w);(o=x==null?void 0:x.associateElement)==null||o.call(x,this)}}disconnectedCallback(){var o;if(this.getAttribute(G.MEDIA_CONTROLLER)){let x=Z.getElementById(mediaControllerId);(o=x==null?void 0:x.unassociateElement)==null||o.call(x,this)}}};he("media-text-display",vr);var Rt=vr,Qi=class extends Rt{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_CURRENT_TIME]}attributeChangedCallback(o,w,x){o===G.MEDIA_CURRENT_TIME&&(this.container.innerHTML=Ve(x)),super.attributeChangedCallback(o,w,x)}};he("media-current-time-display",Qi);var Ji=class extends Rt{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_DURATION]}attributeChangedCallback(o,w,x){o===G.MEDIA_DURATION&&(this.container.innerHTML=Ve(x)),super.attributeChangedCallback(o,w,x)}};he("media-duration-display",Ji);var Zi=" / ",qi=(o,{timesSep:w=Zi}={})=>{let x=o.getAttribute("remaining")!=null,O=o.getAttribute("show-duration")!=null,s=+o.getAttribute(G.MEDIA_CURRENT_TIME),R=+o.getAttribute(G.MEDIA_DURATION),_=Ve(x?0-(R-s):s);return O?`${_}${w}${Ve(R)}`:_},en="video not loaded, unknown time.",tn=o=>{if(!(o.hasAttribute(G.MEDIA_CURRENT_TIME)&&o.hasAttribute(G.MEDIA_DURATION))){o.setAttribute("aria-valuetext",en);return}let w=o.getAttribute("remaining")!=null,x=o.getAttribute("show-duration")!=null,O=+o.getAttribute(G.MEDIA_CURRENT_TIME),s=+o.getAttribute(G.MEDIA_DURATION),R=je(w?0-(s-O):O);if(!x){o.setAttribute("aria-valuetext",R);return}let _=je(s),b=`${R} of ${_}`;o.setAttribute("aria-valuetext",b)},rn=class extends Rt{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_CURRENT_TIME,G.MEDIA_DURATION,"remaining","show-duration"]}connectedCallback(){this.setAttribute("role","progressbar"),this.setAttribute("aria-label",xe.PLAYBACK_TIME()),this.setAttribute("tabindex",0),super.connectedCallback()}attributeChangedCallback(o,w,x){if([G.MEDIA_CURRENT_TIME,G.MEDIA_DURATION,"remaining","show-duration"].includes(o)){let O=qi(this);tn(this),this.container.innerHTML=O}super.attributeChangedCallback(o,w,x)}};he("media-time-display",rn);var nn=`
<svg
   aria-hidden="true"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.0"
   viewbox="0 0 153 125.71389"
   width="auto"
   height="24">
  <g
     transform="scale(6.3080558,6.3080558)"
     id="g12">
    <path
       class="icon" 
       d="M 21.9806,9.0135 C 21.9505,5.8358 21.8299,4.4502 21.077,3.4712 C 20.9415,3.2605 20.6854,3.14 20.4746,2.9895 C 19.7366,2.4472 16.2577,2.2515 12.2215,2.2515 C 8.1853,2.2515 4.54077,2.4472 3.81787,2.9895 C 3.59192,3.14 3.33581,3.2605 3.1853,3.4712 C 2.44726,4.4502 2.34192,5.8358 2.29675,9.0135 C 2.34192,12.1914 2.44726,13.5769 3.1853,14.5558 C 3.33581,14.7817 3.59192,14.8871 3.81787,15.0377 C 4.54077,15.595 8.1853,15.7757 12.2215,15.8058 C 16.2577,15.7757 19.7366,15.595 20.4746,15.0377 C 20.6854,14.8871 20.9415,14.7817 21.077,14.5558 C 21.8299,13.5769 21.9505,12.1914 21.9806,9.0135 z "
       style="fill-rule:evenodd;stroke:none"
       id="path16" />
    <path
       class="icon" 
       d="M 11.6896,8.1906 C 11.4853,5.704 10.1628,4.239 7.79723,4.239 C 5.63596,4.239 3.93706,6.1879 3.93706,9.31964 C 3.93706,12.4648 5.48544,14.4271 8.04452,14.4271 C 10.0875,14.4271 11.5176,12.9218 11.7434,10.4217 L 9.30256,10.4217 C 9.20579,11.3492 8.81871,12.0616 8.00151,12.0616 C 6.71121,12.0616 6.47467,10.7847 6.47467,9.42716 C 6.47467,7.5588 7.0123,6.6046 7.90474,6.6046 C 8.70045,6.6046 9.20579,7.1825 9.28106,8.1906 L 11.6896,8.1906 z "
       style="fill:#000000;fill-rule:evenodd;stroke:none"
       id="path20" />
    <path
      class="icon" 
      d="M 20.1199,8.1906 C 19.9156,5.704 18.5931,4.239 16.2275,4.239 C 14.0662,4.239 12.3674,6.1879 12.3674,9.31964 C 12.3674,12.4648 13.9157,14.4271 16.4748,14.4271 C 18.5178,14.4271 19.9479,12.9218 20.1736,10.4217 L 17.7328,10.4217 C 17.6361,11.3492 17.249,12.0616 16.4318,12.0616 C 15.1415,12.0616 14.9049,10.7847 14.9049,9.42716 C 14.9049,7.5588 15.4426,6.6046 16.335,6.6046 C 17.1307,6.6046 17.6361,7.1825 17.7113,8.1906 L 20.1199,8.1906 z "
      style="fill:#000000;fill-rule:evenodd;stroke:none"
      id="path22" />
    <path class="icon" d="M 2,20 L 22,20" stroke-width="4" stroke="var(--media-icon-color, #eee)" id="path24"/>
  </g>
</svg>
`,an=`
<svg
   aria-hidden="true"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   version="1.0"
   viewbox="0 0 153 125.71389"
   width="auto"
   height="24">
  <g
     transform="scale(6.3080558,6.3080558)"
     id="g12">
    <path
       class="icon" 
       d="M 21.9806,9.0135 C 21.9505,5.8358 21.8299,4.4502 21.077,3.4712 C 20.9415,3.2605 20.6854,3.14 20.4746,2.9895 C 19.7366,2.4472 16.2577,2.2515 12.2215,2.2515 C 8.1853,2.2515 4.54077,2.4472 3.81787,2.9895 C 3.59192,3.14 3.33581,3.2605 3.1853,3.4712 C 2.44726,4.4502 2.34192,5.8358 2.29675,9.0135 C 2.34192,12.1914 2.44726,13.5769 3.1853,14.5558 C 3.33581,14.7817 3.59192,14.8871 3.81787,15.0377 C 4.54077,15.595 8.1853,15.7757 12.2215,15.8058 C 16.2577,15.7757 19.7366,15.595 20.4746,15.0377 C 20.6854,14.8871 20.9415,14.7817 21.077,14.5558 C 21.8299,13.5769 21.9505,12.1914 21.9806,9.0135 z "
       style="fill-rule:evenodd;stroke:none"
       id="path16" />
    <path
       class="icon" 
       d="M 11.6896,8.1906 C 11.4853,5.704 10.1628,4.239 7.79723,4.239 C 5.63596,4.239 3.93706,6.1879 3.93706,9.31964 C 3.93706,12.4648 5.48544,14.4271 8.04452,14.4271 C 10.0875,14.4271 11.5176,12.9218 11.7434,10.4217 L 9.30256,10.4217 C 9.20579,11.3492 8.81871,12.0616 8.00151,12.0616 C 6.71121,12.0616 6.47467,10.7847 6.47467,9.42716 C 6.47467,7.5588 7.0123,6.6046 7.90474,6.6046 C 8.70045,6.6046 9.20579,7.1825 9.28106,8.1906 L 11.6896,8.1906 z "
       style="fill:#000000;fill-rule:evenodd;stroke:none"
       id="path20" />
    <path
      class="icon" 
      d="M 20.1199,8.1906 C 19.9156,5.704 18.5931,4.239 16.2275,4.239 C 14.0662,4.239 12.3674,6.1879 12.3674,9.31964 C 12.3674,12.4648 13.9157,14.4271 16.4748,14.4271 C 18.5178,14.4271 19.9479,12.9218 20.1736,10.4217 L 17.7328,10.4217 C 17.6361,11.3492 17.249,12.0616 16.4318,12.0616 C 15.1415,12.0616 14.9049,10.7847 14.9049,9.42716 C 14.9049,7.5588 15.4426,6.6046 16.335,6.6046 C 17.1307,6.6046 17.6361,7.1825 17.7113,8.1906 L 20.1199,8.1906 z "
      style="fill:#000000;fill-rule:evenodd;stroke:none"
      id="path22" />
  </g>
</svg>
`,gr=Z.createElement("template");gr.innerHTML=`
  <style>
  :host([aria-checked="true"]) slot:not([name=on]) > *, 
  :host([aria-checked="true"]) ::slotted(:not([slot=on])) {
    display: none;
  }

  /* Double negative, but safer if display doesn't equal 'block' */
  :host(:not([aria-checked="true"])) slot:not([name=off]) > *, 
  :host(:not([aria-checked="true"])) ::slotted(:not([slot=off])) {
    display: none;
  }
  </style>

  <slot name="on">${nn}</slot>
  <slot name="off">${an}</slot>
`;var mr=o=>{o.setAttribute("aria-checked",pr(o))},pr=o=>{let w=!!o.getAttribute(G.MEDIA_CAPTIONS_SHOWING),x=!o.hasAttribute("no-subtitles-fallback")&&!!o.getAttribute(G.MEDIA_SUBTITLES_SHOWING);return w||x},sn=class extends we{static get observedAttributes(){return[...super.observedAttributes,"no-subtitles-fallback","default-showing",G.MEDIA_CAPTIONS_LIST,G.MEDIA_CAPTIONS_SHOWING,G.MEDIA_SUBTITLES_LIST,G.MEDIA_SUBTITLES_SHOWING]}constructor(o={}){super({slotTemplate:gr,...o});this._captionsReady=!1}connectedCallback(){super.connectedCallback(),this.setAttribute("role","switch"),this.setAttribute("aria-label",xe.CLOSED_CAPTIONS()),mr(this)}attributeChangedCallback(o,w,x){if([G.MEDIA_CAPTIONS_SHOWING,G.MEDIA_SUBTITLES_SHOWING].includes(o)&&mr(this),this.hasAttribute("default-showing")&&this.getAttribute("aria-checked")!=="true"){let O=!this.hasAttribute("no-subtitles-fallback");if((O?[G.MEDIA_CAPTIONS_LIST,G.MEDIA_SUBTITLES_LIST]:[G.MEDIA_CAPTIONS_LIST]).includes(o)){let R=!!this.getAttribute(G.MEDIA_CAPTIONS_LIST)||!!(O&&this.getAttribute(G.MEDIA_SUBTITLES_LIST));this._captionsReady!==R&&(this._captionsReady=R,this._captionsReady&&this.handleClick())}}super.attributeChangedCallback(o,w,x)}handleClick(o){var w,x,O,s;if(pr(this)){let _=this.getAttribute(G.MEDIA_CAPTIONS_SHOWING);if(_){let P=new re.CustomEvent(oe.MEDIA_DISABLE_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:_});this.dispatchEvent(P)}let b=this.getAttribute(G.MEDIA_SUBTITLES_SHOWING);if(b&&!this.hasAttribute("no-subtitles-fallback")){let P=new re.CustomEvent(oe.MEDIA_DISABLE_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:b});this.dispatchEvent(P)}}else{let[_]=(x=Dt((w=this.getAttribute(G.MEDIA_CAPTIONS_LIST))!=null?w:""))!=null?x:[];if(_){let b=new re.CustomEvent(oe.MEDIA_SHOW_CAPTIONS_REQUEST,{composed:!0,bubbles:!0,detail:_});this.dispatchEvent(b)}else if(this.hasAttribute("no-subtitles-fallback"))console.error("Attempting to enable closed captions but none are available! Please verify your media content if this is unexpected.");else{let[b]=(s=Dt((O=this.getAttribute(G.MEDIA_SUBTITLES_LIST))!=null?O:""))!=null?s:[];if(b){let P=new re.CustomEvent(oe.MEDIA_SHOW_SUBTITLES_REQUEST,{composed:!0,bubbles:!0,detail:b});this.dispatchEvent(P)}}}}};he("media-captions-button",sn);var Ot=30,on=`<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" viewBox="-3 -3 24 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(7.4 17.6)">${Ot}</text><path d="M8.52,3V0l5.61,4-5.61,4V5A5.54,5.54,0,0,0,6.6,15.48V17.6A7.5,7.5,0,0,1,8.52,3Z"/></svg>`,Er=Z.createElement("template");Er.innerHTML=`  
  <slot name="forward">${on}</slot>
`;var ln=0,un=o=>{let w=Math.abs(+o.getAttribute("seek-offset")),x=Se.SEEK_FORWARD_N_SECS({seekOffset:w});o.setAttribute("aria-label",x)},yr=o=>{let w=tr(o,"forward"),x=o.getAttribute("seek-offset");er(w,x)},dn=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_CURRENT_TIME,"seek-offset"]}constructor(o={}){super({slotTemplate:Er,...o})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",Ot),un(this),yr(this),super.connectedCallback()}attributeChangedCallback(o,w,x){o==="seek-offset"&&(x==null&&this.setAttribute("seek-offset",Ot),yr(this))}handleClick(){let o=this.getAttribute(G.MEDIA_CURRENT_TIME),w=+this.getAttribute("seek-offset"),O=(o&&!Number.isNaN(+o)?+o:ln)+w,s=new re.CustomEvent(oe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:O});this.dispatchEvent(s)}};he("media-seek-forward-button",dn);var cn=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path class="icon" d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/>
</svg>`,fn=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path class="icon" d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
</svg>`,Tr=Z.createElement("template");Tr.innerHTML=`
  <style>
  :host([${G.MEDIA_IS_FULLSCREEN}]) slot:not([name=exit]) > *, 
  :host([${G.MEDIA_IS_FULLSCREEN}]) ::slotted(:not([slot=exit])) {
    display: none;
  }

  /* Double negative, but safer if display doesn't equal 'block' */
  :host(:not([${G.MEDIA_IS_FULLSCREEN}])) slot:not([name=enter]) > *, 
  :host(:not([${G.MEDIA_IS_FULLSCREEN}])) ::slotted(:not([slot=enter])) {
    display: none;
  }
  </style>

  <slot name="enter">${cn}</slot>
  <slot name="exit">${fn}</slot>
`;var _r=o=>{let x=o.getAttribute(G.MEDIA_IS_FULLSCREEN)!=null?Se.EXIT_FULLSCREEN():Se.ENTER_FULLSCREEN();o.setAttribute("aria-label",x)},hn=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_IS_FULLSCREEN]}constructor(o={}){super({slotTemplate:Tr,...o})}connectedCallback(){_r(this),super.connectedCallback()}attributeChangedCallback(o,w,x){o===G.MEDIA_IS_FULLSCREEN&&_r(this),super.attributeChangedCallback(o,w,x)}handleClick(o){let w=this.getAttribute(G.MEDIA_IS_FULLSCREEN)!=null?oe.MEDIA_EXIT_FULLSCREEN_REQUEST:oe.MEDIA_ENTER_FULLSCREEN_REQUEST;this.dispatchEvent(new re.CustomEvent(w,{composed:!0,bubbles:!0}))}};he("media-fullscreen-button",hn);var vn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',Ar='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM5 9v6h4l5 5V4L9 9H5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',gn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',Sr=Z.createElement("template");Sr.innerHTML=`
  <style>
  /* Default to High slot/icon. */
  :host(:not([${G.MEDIA_VOLUME_LEVEL}])) slot:not([name=high]) > *, 
  :host(:not([${G.MEDIA_VOLUME_LEVEL}])) ::slotted(:not([slot=high])),
  :host([${G.MEDIA_VOLUME_LEVEL}=high]) slot:not([name=high]) > *, 
  :host([${G.MEDIA_VOLUME_LEVEL}=high]) ::slotted(:not([slot=high])) {
    display: none;
  }

  :host([${G.MEDIA_VOLUME_LEVEL}=off]) slot:not([name=off]) > *, 
  :host([${G.MEDIA_VOLUME_LEVEL}=off]) ::slotted(:not([slot=off])) {
    display: none;
  }

  :host([${G.MEDIA_VOLUME_LEVEL}=low]) slot:not([name=low]) > *, 
  :host([${G.MEDIA_VOLUME_LEVEL}=low]) ::slotted(:not([slot=low])) {
    display: none;
  }

  :host([${G.MEDIA_VOLUME_LEVEL}=medium]) slot:not([name=medium]) > *, 
  :host([${G.MEDIA_VOLUME_LEVEL}=medium]) ::slotted(:not([slot=medium])) {
    display: none;
  }
  </style>

  <slot name="off">${vn}</slot>
  <slot name="low">${Ar}</slot>
  <slot name="medium">${Ar}</slot>
  <slot name="high">${gn}</slot>
`;var br=o=>{let x=o.getAttribute(G.MEDIA_VOLUME_LEVEL)==="off"?Se.UNMUTE():Se.MUTE();o.setAttribute("aria-label",x)},mn=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_VOLUME_LEVEL]}constructor(o={}){super({slotTemplate:Sr,...o})}connectedCallback(){br(this),super.connectedCallback()}attributeChangedCallback(o,w,x){o===G.MEDIA_VOLUME_LEVEL&&br(this),super.attributeChangedCallback(o,w,x)}handleClick(o){let w=this.getAttribute(G.MEDIA_VOLUME_LEVEL)==="off"?oe.MEDIA_UNMUTE_REQUEST:oe.MEDIA_MUTE_REQUEST;this.dispatchEvent(new re.CustomEvent(w,{composed:!0,bubbles:!0}))}};he("media-mute-button",mn);var Lr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M19 7h-8v6h8V7zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2zm0 16.01H3V4.98h18v14.03z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',Dr=Z.createElement("template");Dr.innerHTML=`
  <style>
  :host([${G.MEDIA_IS_PIP}]) slot:not([name=exit]) > *, 
  :host([${G.MEDIA_IS_PIP}]) ::slotted(:not([slot=exit])) {
    display: none;
  }

  /* Double negative, but safer if display doesn't equal 'block' */
  :host(:not([${G.MEDIA_IS_PIP}])) slot:not([name=enter]) > *, 
  :host(:not([${G.MEDIA_IS_PIP}])) ::slotted(:not([slot=enter])) {
    display: none;
  }
  </style>

  <slot name="enter">${Lr}</slot>
  <slot name="exit">${Lr}</slot>
`;var Ir=o=>{let x=o.getAttribute(G.MEDIA_IS_PIP)!=null?Se.EXIT_PIP():Se.ENTER_PIP();o.setAttribute("aria-label",x)},pn=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_IS_PIP]}constructor(o={}){super({slotTemplate:Dr,...o})}connectedCallback(){Ir(this),super.connectedCallback()}attributeChangedCallback(o,w,x){o===G.MEDIA_IS_PIP&&Ir(this),super.attributeChangedCallback(o,w,x)}handleClick(o){let w=this.getAttribute(G.MEDIA_IS_PIP)!=null?oe.MEDIA_EXIT_PIP_REQUEST:oe.MEDIA_ENTER_PIP_REQUEST;this.dispatchEvent(new re.CustomEvent(w,{composed:!0,bubbles:!0}))}};he("media-pip-button",pn);var En='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M8 5v14l11-7z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',yn='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path class="icon" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/><path d="M0 0h24v24H0z" fill="none"/></svg>',Mr=Z.createElement("template");Mr.innerHTML=`
  <style>
  :host([${G.MEDIA_PAUSED}]) slot[name=pause] > *, 
  :host([${G.MEDIA_PAUSED}]) ::slotted([slot=pause]) {
    display: none;
  }

  :host(:not([${G.MEDIA_PAUSED}])) slot[name=play] > *, 
  :host(:not([${G.MEDIA_PAUSED}])) ::slotted([slot=play]) {
    display: none;
  }
  </style>

  <slot name="play">${En}</slot>
  <slot name="pause">${yn}</slot>
`;var Rr=o=>{let x=o.getAttribute(G.MEDIA_PAUSED)!=null?Se.PLAY():Se.PAUSE();o.setAttribute("aria-label",x)},Tn=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_PAUSED]}constructor(o={}){super({slotTemplate:Mr,...o})}connectedCallback(){Rr(this),super.connectedCallback()}attributeChangedCallback(o,w,x){o===G.MEDIA_PAUSED&&Rr(this),super.attributeChangedCallback(o,w,x)}handleClick(o){let w=this.getAttribute(G.MEDIA_PAUSED)!=null?oe.MEDIA_PLAY_REQUEST:oe.MEDIA_PAUSE_REQUEST;this.dispatchEvent(new re.CustomEvent(w,{composed:!0,bubbles:!0}))}};he("media-play-button",Tn);var Or=[1,1.25,1.5,1.75,2],dt=1,Cr=Z.createElement("template");Cr.innerHTML=`
  <style>
  :host {
    font-size: 14px;
    line-height: 24px;
    font-weight: bold;
  }

  #container {
    height: var(--media-text-content-height, 24px);
  }
  </style>

  <span id="container"></span>
`;var _n=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_PLAYBACK_RATE,"rates"]}constructor(o={}){super({slotTemplate:Cr,...o});this._rates=Or,this.container=this.shadowRoot.querySelector("#container"),this.container.innerHTML=`${dt}x`}attributeChangedCallback(o,w,x){if(o==="rates"){let O=(x!=null?x:"").trim().split(/\s*,?\s+/).map(s=>Number(s)).filter(s=>!Number.isNaN(s)).sort((s,R)=>s-R);this._rates=O.length?O:Or;return}if(o===G.MEDIA_PLAYBACK_RATE){let O=x?+x:Number.NaN,s=Number.isNaN(O)?dt:O;this.container.innerHTML=`${s}x`,this.setAttribute("aria-label",xe.PLAYBACK_RATE({playbackRate:s}));return}super.attributeChangedCallback(o,w,x)}handleClick(o){var w,x;let O=+this.getAttribute(G.MEDIA_PLAYBACK_RATE)||dt,s=(x=(w=this._rates.find(_=>_>O))!=null?w:this._rates[0])!=null?x:dt,R=new re.CustomEvent(oe.MEDIA_PLAYBACK_RATE_REQUEST,{composed:!0,bubbles:!0,detail:s});this.dispatchEvent(R)}};he("media-playback-rate-button",_n);var An="video not loaded, unknown time.",Pr=o=>{let w=o.range,x=je(+w.value),O=je(+w.max),s=x&&O?`${x} of ${O}`:An;w.setAttribute("aria-valuetext",s)},xr=Z.createElement("template");xr.innerHTML=`
  <style>
    #thumbnailContainer {
      display: none;
      position: absolute;
      top: 0;
    }

    media-thumbnail-preview {
      position: absolute;
      bottom: 10px;
      border: 2px solid #fff;
      border-radius: 2px;
      background-color: #000;
      width: 160px;
      height: 90px;

      /* Negative offset of half to center on the handle */
      margin-left: -80px;
    }

    /* Can't get this working. Trying a downward triangle. */
    /* media-thumbnail-preview::after {
      content: "";
      display: block;
      width: 300px;
      height: 300px;
      margin: 100px;
      background-color: #ff0;
    } */

    :host([${G.MEDIA_PREVIEW_IMAGE}]:hover) #thumbnailContainer {
      display: block;
      animation: fadeIn ease 0.5s;
    }

    @keyframes fadeIn {
      0% {
        /* transform-origin: bottom center; */
        /* transform: scale(0.7); */
        margin-top: 10px;
        opacity: 0;
      }
      100% {
        /* transform-origin: bottom center; */
        /* transform: scale(1); */
        margin-top: 0;
        opacity: 1;
      }
    }
  </style>
  <div id="thumbnailContainer">
    <media-thumbnail-preview></media-thumbnail-preview>
  </div>
`;var wr=class extends cr{static get observedAttributes(){return[...super.observedAttributes,"thumbnails",G.MEDIA_DURATION,G.MEDIA_CURRENT_TIME,G.MEDIA_PREVIEW_IMAGE]}constructor(){super();this.shadowRoot.appendChild(xr.content.cloneNode(!0)),this.range.addEventListener("input",()=>{let w=this.range.value,x=new re.CustomEvent(oe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:w});this.dispatchEvent(x)}),this.enableThumbnails()}connectedCallback(){this.range.setAttribute("aria-label",xe.SEEK()),super.connectedCallback()}attributeChangedCallback(o,w,x){o===G.MEDIA_CURRENT_TIME&&(this.range.value=+x,Pr(this),this.updateBar()),o===G.MEDIA_DURATION&&(this.range.max=Math.floor(+x),Pr(this),this.updateBar()),super.attributeChangedCallback(o,w,x)}getBarColors(){let o=super.getBarColors();if(!this.mediaBuffered||!this.mediaBuffered.length||this.mediaDuration<=0)return o;let w=this.mediaBuffered,x=w[w.length-1][1]/this.mediaDuration*100;return o.splice(1,0,["var(--media-time-buffered-color, #777)",x]),o}enableThumbnails(){this.thumbnailPreview=this.shadowRoot.querySelector("media-thumbnail-preview"),this.shadowRoot.querySelector("#thumbnailContainer").classList.add("enabled");let w,x=()=>{w=_=>{let b=+this.getAttribute(G.MEDIA_DURATION);if(!b)return;let P=this.range.getBoundingClientRect(),M=(_.clientX-P.left)/P.width;M=Math.max(0,Math.min(1,M));let D=P.left-this.getBoundingClientRect().left+M*P.width;this.thumbnailPreview.style.left=`${D}px`;let c=M*b,T=new re.CustomEvent(oe.MEDIA_PREVIEW_REQUEST,{composed:!0,bubbles:!0,detail:c});this.dispatchEvent(T)},re.addEventListener("mousemove",w,!1)},O=()=>{re.removeEventListener("mousemove",w)},s=!1,R=_=>{let b=this.getAttribute(G.MEDIA_DURATION);if(!s&&b){s=!0,x();let P=M=>{M.target!=this&&!this.contains(M.target)&&(re.removeEventListener("mousemove",P),s=!1,O())};re.addEventListener("mousemove",P,!1)}};this.addEventListener("mousemove",R,!1)}};he("media-time-range",wr);var Sn=wr,bn=class extends Sn{constructor(){super();console.warn("MediaChrome: <media-progress-range> is deprecated. Use <media-time-range> instead.")}};he("media-progress-range",bn);var ct=30,Ln=`<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="-3 -3 24 24"><defs><style>.text{font-size:8px;font-family:Arial-BoldMT, Arial;font-weight:700;}</style></defs><text class="text value" transform="translate(1.68 17.6)">${ct}</text><path d="M9.48,3V0L3.87,4l5.61,4V5a5.54,5.54,0,0,1,1.92,10.5V17.6A7.5,7.5,0,0,0,9.48,3Z"/></svg>`,kr=Z.createElement("template");kr.innerHTML=`  
  <slot name="backward">${Ln}</slot>
`;var Dn=0,In=o=>{let w=Math.abs(ct),x=Se.SEEK_BACK_N_SECS({seekOffset:w});o.setAttribute("aria-label",x)},Ur=o=>{let w=tr(o,"backward"),x=o.getAttribute("seek-offset");er(w,x)},Mn=class extends we{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_CURRENT_TIME]}constructor(o={}){super({slotTemplate:kr,...o})}connectedCallback(){this.hasAttribute("seek-offset")||this.setAttribute("seek-offset",ct),In(this),Ur(this),super.connectedCallback()}attributeChangedCallback(o,w,x){o==="seek-offset"&&(x==null&&this.setAttribute("seek-offset",ct),Ur(this))}handleClick(){let o=this.getAttribute(G.MEDIA_CURRENT_TIME),w=+this.getAttribute("seek-offset"),x=o&&!Number.isNaN(+o)?+o:Dn,O=Math.max(x-w,0),s=new re.CustomEvent(oe.MEDIA_SEEK_REQUEST,{composed:!0,bubbles:!0,detail:O});this.dispatchEvent(s)}};he("media-seek-backward-button",Mn);var Br=Z.createElement("template");Br.innerHTML=`
  <style>
    :host {
      box-sizing: border-box;
      background-color: #000;
      width: 284px;
      height: 160px;
      overflow: hidden;
    }

    img {
      position: absolute;
      left: 0;
      top: 0;
    }
  </style>
  <img crossorigin loading="eager" decoding="async" />
`;var Rn=class extends re.HTMLElement{static get observedAttributes(){return[G.MEDIA_CONTROLLER,"time",G.MEDIA_PREVIEW_IMAGE,G.MEDIA_PREVIEW_COORDS]}constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Br.content.cloneNode(!0))}connectedCallback(){var o;let w=this.getAttribute(G.MEDIA_CONTROLLER);if(w){let x=Z.getElementById(w);(o=x==null?void 0:x.associateElement)==null||o.call(x,this)}}disconnectedCallback(){var o;if(this.getAttribute(G.MEDIA_CONTROLLER)){let x=Z.getElementById(mediaControllerId);(o=x==null?void 0:x.unassociateElement)==null||o.call(x,this)}}attributeChangedCallback(o,w,x){var O,s;if(["time",G.MEDIA_PREVIEW_IMAGE,G.MEDIA_PREVIEW_COORDS].includes(o)&&this.update(),o===G.MEDIA_CONTROLLER){if(w){let R=Z.getElementById(w);(O=R==null?void 0:R.unassociateElement)==null||O.call(R,this)}if(x){let R=Z.getElementById(x);(s=R==null?void 0:R.associateElement)==null||s.call(R,this)}}}update(){let o=this.getAttribute(G.MEDIA_PREVIEW_COORDS),w=this.getAttribute(G.MEDIA_PREVIEW_IMAGE);if(!(o&&w))return;let x=this.offsetWidth,O=this.shadowRoot.querySelector("img"),[s,R,_,b]=o.split(/\s+/).map(D=>+D),P=w,M=x/_||1,I=()=>{O.style.width=`${M*O.naturalWidth}px`,O.style.height=`${M*O.naturalHeight}px`};O.src!==P&&(O.onload=I,O.src=P,I()),I(),O.style.left=`-${M*s}px`,O.style.top=`-${M*R}px`}};he("media-thumbnail-preview",Rn);var Fr=Z.createElement("template"),On=`
<svg viewBox="0 0 100 100">
  <path d="M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50">
    <animateTransform
       attributeName="transform"
       attributeType="XML"
       type="rotate"
       dur="1s"
       from="0 50 50"
       to="360 50 50"
       repeatCount="indefinite" />
  </path>
</svg>
`;Fr.innerHTML=`
<style>
:host {
  display: inline-block;
  vertical-align: middle;
  box-sizing: border-box;
}

#status {
  color: rgba(0,0,0,0);
  width: 0px;
  height: 0px;
}

:host slot[name=loading] > *,
:host ::slotted([slot=loading]) {
  opacity: 1;
  transition: opacity 0.15s;
}

:host(:not([is-loading])) slot[name=loading] > *, 
:host(:not([is-loading])) ::slotted([slot=loading]) {
  opacity: 0;
}

:host(:not([is-loading])) #status {
  display: none;
}

svg, img, ::slotted(svg), ::slotted(img) {
  width: var(--media-loading-icon-width, 44px);
  height: var(--media-loading-icon-height);
  fill: var(--media-icon-color, #fff);
  vertical-align: middle;
}
</style>

<slot name="loading">${On}</slot>
<div id="status" role="status" aria-live="polite">${xe.MEDIA_LOADING()}</div>
`;var Cn=500,Pn=class extends re.HTMLElement{static get observedAttributes(){return[G.MEDIA_CONTROLLER,G.MEDIA_PAUSED,G.MEDIA_LOADING,"loading-delay"]}constructor(){super();let o=this.attachShadow({mode:"open"}),w=Fr.content.cloneNode(!0);o.appendChild(w)}attributeChangedCallback(o,w,x){var O,s,R;if(o===G.MEDIA_LOADING||o===G.MEDIA_PAUSED){let _=this.getAttribute(G.MEDIA_PAUSED)!=null,b=this.getAttribute(G.MEDIA_LOADING)!=null,P=!_&&b;if(!P)this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.removeAttribute("is-loading");else if(!this.loadingDelayHandle&&P){let M=+((O=this.getAttribute("loading-delay"))!=null?O:Cn);this.loadingDelayHandle=setTimeout(()=>{this.setAttribute("is-loading",""),this.loadingDelayHandle=void 0},M)}}else if(o===G.MEDIA_CONTROLLER){if(w){let _=Z.getElementById(w);(s=_==null?void 0:_.unassociateElement)==null||s.call(_,this)}if(x){let _=Z.getElementById(x);(R=_==null?void 0:_.associateElement)==null||R.call(_,this)}}}connectedCallback(){var o;let w=this.getAttribute(G.MEDIA_CONTROLLER);if(w){let x=Z.getElementById(w);(o=x==null?void 0:x.associateElement)==null||o.call(x,this)}}disconnectedCallback(){var o;if(this.loadingDelayHandle&&(clearTimeout(this.loadingDelayHandle),this.loadingDelayHandle=void 0),this.getAttribute(G.MEDIA_CONTROLLER)){let x=Z.getElementById(mediaControllerId);(o=x==null?void 0:x.unassociateElement)==null||o.call(x,this)}}};he("media-loading-indicator",Pn);var Nr=Z.createElement("template");Nr.innerHTML=`
  <style>
    :host {

    }
  </style>

  <slot></slot>
`;var xn=class extends re.HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Nr.content.cloneNode(!0))}};he("media-title-bar",xn);var wn=100,kn=o=>{var w;if(o.getAttribute(G.MEDIA_MUTED)!=null)return 0;let O=+((w=o.getAttribute(G.MEDIA_VOLUME))!=null?w:1);return Math.round(O*o.range.max)},Un=({value:o,max:w})=>`${Math.round(o/w*100)}%`,Bn=class extends cr{static get observedAttributes(){return[...super.observedAttributes,G.MEDIA_VOLUME,G.MEDIA_MUTED]}constructor(){super();this.range.max=wn,this.range.addEventListener("input",()=>{let w=this.range.value/this.range.max,x=new re.CustomEvent(oe.MEDIA_VOLUME_REQUEST,{composed:!0,bubbles:!0,detail:w});this.dispatchEvent(x)})}connectedCallback(){this.range.setAttribute("aria-label",xe.VOLUME()),super.connectedCallback()}attributeChangedCallback(o,w,x){if(o===G.MEDIA_VOLUME||o===G.MEDIA_MUTED){let O=kn(this);this.range.value=O,this.range.setAttribute("aria-valuetext",Un(this.range)),this.updateBar()}super.attributeChangedCallback(o,w,x)}};he("media-volume-range",Bn);var Fn=class extends or{};re.customElements.get("media-chrome")||re.customElements.define("media-chrome",Fn);var Nn=class extends or{constructor(){super();console.warn("MediaChrome: <media-container> is deprecated. Use <media-controller>.")}};re.customElements.get("media-container")||re.customElements.define("media-container",Nn);var Kn=Object.create,Ct=Object.defineProperty,Hn=Object.getOwnPropertyDescriptor,Wn=Object.getOwnPropertyNames,Gn=Object.getPrototypeOf,jn=Object.prototype.hasOwnProperty,Vn=o=>Ct(o,"__esModule",{value:!0}),ft=(o,w)=>function(){return w||(0,o[Object.keys(o)[0]])((w={exports:{}}).exports,w),w.exports},$n=(o,w,x)=>{if(w&&typeof w=="object"||typeof w=="function")for(let O of Wn(w))!jn.call(o,O)&&O!=="default"&&Ct(o,O,{get:()=>w[O],enumerable:!(x=Hn(w,O))||x.enumerable});return o},Kr=o=>$n(Vn(Ct(o!=null?Kn(Gn(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o),Yn=ft({"src/polyfills/window.ts"(){if(globalThis.customElements||(globalThis.customElements={get(x){},define(x,O,s){},upgrade(x){},whenDefined(x){return Promise.resolve(globalThis.HTMLElement)}}),!globalThis.CustomEvent){class x{constructor(s,R={}){this.detail=R==null?void 0:R.detail}initCustomEvent(s,R,_,b){}}globalThis.CustomEvent=x}if(!globalThis.EventTarget){class x{addEventListener(){}removeEventListener(){}dispatchEvent(s){return!0}}globalThis.EventTarget=x}if(!globalThis.HTMLElement){class x extends EventTarget{}globalThis.HTMLElement=x}var o,w;if(!((o=globalThis.document)==null?void 0:o.createElement)){let x=(w=globalThis.document)!=null?w:{};x.createElement=function(s,R){return new HTMLElement},globalThis.document=x}}}),zn=ft({"../../node_modules/mux-embed/dist/mux.js"(o,w){(function(){var x=!1;(function(O,s){typeof o=="object"&&typeof w=="object"?w.exports=s():typeof x=="function"&&x.amd?x("mux",[],s):typeof o=="object"?o.mux=s():O.mux=s()})(this,function(){return function(O){function s(_){if(R[_])return R[_].exports;var b=R[_]={i:_,l:!1,exports:{}};return O[_].call(b.exports,b,b.exports,s),b.l=!0,b.exports}var R={};return s.m=O,s.c=R,s.d=function(_,b,P){s.o(_,b)||Object.defineProperty(_,b,{configurable:!1,enumerable:!0,get:P})},s.n=function(_){var b=_&&_.__esModule?function(){return _.default}:function(){return _};return s.d(b,"a",b),b},s.o=function(_,b){return Object.prototype.hasOwnProperty.call(_,b)},s.p="",s(s.s=15)}([function(O,s,R){(function(_){var b;b=typeof window!="undefined"?window:_!==void 0?_:typeof self!="undefined"?self:{},O.exports=b}).call(s,R(17))},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(0),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P={};P.now=function(){var M=b.default.performance,I=M&&M.timing;return I&&typeof I.navigationStart=="number"&&typeof M.now=="function"?I.navigationStart+M.now():Date.now()},s.default=P},function(O,s){function R(B,N,K){switch(K.length){case 0:return B.call(N);case 1:return B.call(N,K[0]);case 2:return B.call(N,K[0],K[1]);case 3:return B.call(N,K[0],K[1],K[2])}return B.apply(N,K)}function _(B,N){for(var K=-1,H=Array(B);++K<B;)H[K]=N(K);return H}function b(B,N){var K=U(B)||A(B)?_(B.length,String):[],H=K.length,j=!!H;for(var W in B)!N&&!i.call(B,W)||j&&(W=="length"||c(W,H))||K.push(W);return K}function P(B,N,K){var H=B[N];i.call(B,N)&&E(H,K)&&(K!==void 0||N in B)||(B[N]=K)}function M(B){if(!y(B))return L(B);var N=[];for(var K in Object(B))i.call(B,K)&&K!="constructor"&&N.push(K);return N}function I(B,N){return N=C(N===void 0?B.length-1:N,0),function(){for(var K=arguments,H=-1,j=C(K.length-N,0),W=Array(j);++H<j;)W[H]=K[N+H];H=-1;for(var V=Array(N+1);++H<N;)V[H]=K[H];return V[N]=W,R(B,this,V)}}function D(B,N,K,H){K||(K={});for(var j=-1,W=N.length;++j<W;){var V=N[j],$=H?H(K[V],B[V],V,K,B):void 0;P(K,V,$===void 0?B[V]:$)}return K}function c(B,N){return!!(N=N==null?f:N)&&(typeof B=="number"||u.test(B))&&B>-1&&B%1==0&&B<N}function T(B,N,K){if(!a(K))return!1;var H=typeof N;return!!(H=="number"?S(K)&&c(N,K.length):H=="string"&&N in K)&&E(K[N],B)}function y(B){var N=B&&B.constructor;return B===(typeof N=="function"&&N.prototype||r)}function E(B,N){return B===N||B!==B&&N!==N}function A(B){return n(B)&&i.call(B,"callee")&&(!g.call(B,"callee")||v.call(B)==p)}function S(B){return B!=null&&t(B.length)&&!e(B)}function n(B){return h(B)&&S(B)}function e(B){var N=a(B)?v.call(B):"";return N==m||N==d}function t(B){return typeof B=="number"&&B>-1&&B%1==0&&B<=f}function a(B){var N=typeof B;return!!B&&(N=="object"||N=="function")}function h(B){return!!B&&typeof B=="object"}function l(B){return S(B)?b(B):M(B)}var f=9007199254740991,p="[object Arguments]",m="[object Function]",d="[object GeneratorFunction]",u=/^(?:0|[1-9]\d*)$/,r=Object.prototype,i=r.hasOwnProperty,v=r.toString,g=r.propertyIsEnumerable,L=function(B,N){return function(K){return B(N(K))}}(Object.keys,Object),C=Math.max,k=!g.call({valueOf:1},"valueOf"),U=Array.isArray,F=function(B){return I(function(N,K){var H=-1,j=K.length,W=j>1?K[j-1]:void 0,V=j>2?K[2]:void 0;for(W=B.length>3&&typeof W=="function"?(j--,W):void 0,V&&T(K[0],K[1],V)&&(W=j<3?void 0:W,j=1),N=Object(N);++H<j;){var $=K[H];$&&B(N,$,H,W)}return N})}(function(B,N){if(k||y(N)||S(N))return void D(N,l(N),B);for(var K in N)i.call(N,K)&&P(B,K,N[K])});O.exports=F},function(O,s,R){"use strict";function _(b,P,M){M=M===void 0?1:M,b[P]=b[P]||0,b[P]+=M}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(18),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P=b.default.methodFactory;b.default.methodFactory=function(M,I,D){var c=P(M,I,D);return function(){for(var T=["[mux]"],y=0;y<arguments.length;y++)T.push(arguments[y]);c.apply(void 0,T)}},b.default.setLevel(b.default.getLevel()),s.default=b.default},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=function(M){return P(M)[0]},b=function(M){return P(M)[1]},P=function(M){if(typeof M!="string"||M==="")return["localhost"];var I=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,D=M.match(I)||[],c=D[4],T=void 0;return c&&(T=(c.match(/[^\.]+\.[^\.]+$/)||[])[0]),[c,T]};s.extractHostnameAndDomain=P,s.extractHostname=_,s.extractDomain=b},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(P){var M=16*Math.random()|0;return(P==="x"?M:3&M|8).toString(16)})},b=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)};s.generateUUID=_,s.generateShortID=b},function(O,s,R){"use strict";function _(P){P=P||"";var M={};return P.trim().split(/[\r\n]+/).forEach(function(I){if(I){var D=I.split(": "),c=D.shift();c&&b.indexOf(c.toLowerCase())>=0&&(M[c]=D.join(": "))}}),M}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_;var b=["x-cdn","content-type"]},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.findMediaElement=s.getMuxPlayerId=void 0;var _=R(6),b=function(M){return M&&M.nodeName!==void 0?(M.muxId||(M.muxId=M.id||(0,_.generateShortID)()),M.muxId):M},P=function(M){var I=void 0;return M&&M.nodeName!==void 0?(I=M,M=b(I)):I=document.querySelector(M),[I,M,I&&I.nodeName?I.nodeName.toLowerCase():""]};s.getMuxPlayerId=b,s.findMediaElement=P},function(O,s,R){"use strict";function _(){return(P.default.doNotTrack||P.default.navigator&&(P.default.navigator.doNotTrack||P.default.navigator.msDoNotTrack))==="1"}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_;var b=R(0),P=function(M){return M&&M.__esModule?M:{default:M}}(b)},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(0),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P={};P.exists=function(){var M=b.default.performance;return(M&&M.timing)!==void 0},P.domContentLoadedEventEnd=function(){var M=b.default.performance,I=M&&M.timing;return I&&I.domContentLoadedEventEnd},P.navigationStart=function(){var M=b.default.performance,I=M&&M.timing;return I&&I.navigationStart},s.default=P},function(O,s,R){"use strict";var _=R(37),b=R(38),P=R(13);O.exports={formats:P,parse:b,stringify:_}},function(O,s,R){"use strict";var _=Object.prototype.hasOwnProperty,b=function(){for(var M=[],I=0;I<256;++I)M.push("%"+((I<16?"0":"")+I.toString(16)).toUpperCase());return M}(),P=function(M){for(var I;M.length;){var D=M.pop();if(I=D.obj[D.prop],Array.isArray(I)){for(var c=[],T=0;T<I.length;++T)I[T]!==void 0&&c.push(I[T]);D.obj[D.prop]=c}}return I};s.arrayToObject=function(M,I){for(var D=I&&I.plainObjects?Object.create(null):{},c=0;c<M.length;++c)M[c]!==void 0&&(D[c]=M[c]);return D},s.merge=function(M,I,D){if(!I)return M;if(typeof I!="object"){if(Array.isArray(M))M.push(I);else{if(typeof M!="object")return[M,I];(D.plainObjects||D.allowPrototypes||!_.call(Object.prototype,I))&&(M[I]=!0)}return M}if(typeof M!="object")return[M].concat(I);var c=M;return Array.isArray(M)&&!Array.isArray(I)&&(c=s.arrayToObject(M,D)),Array.isArray(M)&&Array.isArray(I)?(I.forEach(function(T,y){_.call(M,y)?M[y]&&typeof M[y]=="object"?M[y]=s.merge(M[y],T,D):M.push(T):M[y]=T}),M):Object.keys(I).reduce(function(T,y){var E=I[y];return _.call(T,y)?T[y]=s.merge(T[y],E,D):T[y]=E,T},c)},s.assign=function(M,I){return Object.keys(I).reduce(function(D,c){return D[c]=I[c],D},M)},s.decode=function(M){try{return decodeURIComponent(M.replace(/\+/g," "))}catch{return M}},s.encode=function(M){if(M.length===0)return M;for(var I=typeof M=="string"?M:String(M),D="",c=0;c<I.length;++c){var T=I.charCodeAt(c);T===45||T===46||T===95||T===126||T>=48&&T<=57||T>=65&&T<=90||T>=97&&T<=122?D+=I.charAt(c):T<128?D+=b[T]:T<2048?D+=b[192|T>>6]+b[128|63&T]:T<55296||T>=57344?D+=b[224|T>>12]+b[128|T>>6&63]+b[128|63&T]:(c+=1,T=65536+((1023&T)<<10|1023&I.charCodeAt(c)),D+=b[240|T>>18]+b[128|T>>12&63]+b[128|T>>6&63]+b[128|63&T])}return D},s.compact=function(M){for(var I=[{obj:{o:M},prop:"o"}],D=[],c=0;c<I.length;++c)for(var T=I[c],y=T.obj[T.prop],E=Object.keys(y),A=0;A<E.length;++A){var S=E[A],n=y[S];typeof n=="object"&&n!==null&&D.indexOf(n)===-1&&(I.push({obj:y,prop:S}),D.push(n))}return P(I)},s.isRegExp=function(M){return Object.prototype.toString.call(M)==="[object RegExp]"},s.isBuffer=function(M){return M!=null&&!!(M.constructor&&M.constructor.isBuffer&&M.constructor.isBuffer(M))}},function(O,s,R){"use strict";var _=String.prototype.replace,b=/%20/g;O.exports={default:"RFC3986",formatters:{RFC1738:function(P){return _.call(P,b,"+")},RFC3986:function(P){return P}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(O,s,R){"use strict";function _(S){return S&&S.__esModule?S:{default:S}}function b(S){var n={};for(var e in S)S.hasOwnProperty(e)&&(n[S[e]]=e);return n}function P(S){var n={},e={};return Object.keys(S).forEach(function(t){var a=!1;if(S.hasOwnProperty(t)&&S[t]!==void 0){var h=t.split("_"),l=h[0],f=y[l];f||(I.default.info("Data key word `"+h[0]+"` not expected in "+t),f=l+"_"),h.splice(1).forEach(function(p){p==="url"&&(a=!0),A[p]?f+=A[p]:Number(p)&&Math.floor(Number(p))===Number(p)?f+=p:(I.default.info("Data key word `"+p+"` not expected in "+t),f+="_"+p+"_")}),a?e[f]=S[t]:n[f]=S[t]}}),(0,c.default)(n,e)}Object.defineProperty(s,"__esModule",{value:!0}),s.default=P;var M=R(4),I=_(M),D=R(2),c=_(D),T={a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"},y=b(T),E={ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"},A=b(E)},function(O,s,R){"use strict";O.exports=R(16).default},function(O,s,R){"use strict";function _(p){return p&&p.__esModule?p:{default:p}}Object.defineProperty(s,"__esModule",{value:!0});var b=function(){function p(m,d){var u=[],r=!0,i=!1,v=void 0;try{for(var g,L=m[Symbol.iterator]();!(r=(g=L.next()).done)&&(u.push(g.value),!d||u.length!==d);r=!0);}catch(C){i=!0,v=C}finally{try{!r&&L.return&&L.return()}finally{if(i)throw v}}return u}return function(m,d){if(Array.isArray(m))return m;if(Symbol.iterator in Object(m))return p(m,d);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=R(0),M=_(P),I=R(8),D=R(4),c=_(D),T=R(9),y=_(T),E=R(1),A=_(E),S=R(19),n=_(S),e=R(45),t=_(e),a=R(46),h=_(a),l={},f=function p(m){var d=arguments;typeof m=="string"?p.hasOwnProperty(m)?M.default.setTimeout(function(){d=Array.prototype.splice.call(d,1),p[m].apply(null,d)},0):c.default.warn("`"+m+"` is an unknown task"):typeof m=="function"?M.default.setTimeout(function(){m(p)},0):c.default.warn("`"+m+"` is invalid.")};f.loaded=A.default.now(),f.NAME="mux-embed",f.VERSION="4.3.0",f.API_VERSION="2.1",f.PLAYER_TRACKED=!1,f.monitor=function(p,m){return(0,t.default)(f,p,m)},f.destroyMonitor=function(p){var m=(0,I.findMediaElement)(p),d=b(m,1),u=d[0];u&&u.mux&&typeof u.mux.destroy=="function"?u.mux.destroy():c.default.error("A video element monitor for `"+p+"` has not been initialized via `mux.monitor`.")},f.addHLSJS=function(p,m){var d=(0,I.getMuxPlayerId)(p);l[d]?l[d].addHLSJS(m):c.default.error("A monitor for `"+d+"` has not been initialized.")},f.addDashJS=function(p,m){var d=(0,I.getMuxPlayerId)(p);l[d]?l[d].addDashJS(m):c.default.error("A monitor for `"+d+"` has not been initialized.")},f.removeHLSJS=function(p){var m=(0,I.getMuxPlayerId)(p);l[m]?l[m].removeHLSJS():c.default.error("A monitor for `"+m+"` has not been initialized.")},f.removeDashJS=function(p){var m=(0,I.getMuxPlayerId)(p);l[m]?l[m].removeDashJS():c.default.error("A monitor for `"+m+"` has not been initialized.")},f.init=function(p,m){(0,y.default)()&&m&&m.respectDoNotTrack&&c.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var d=(0,I.getMuxPlayerId)(p);l[d]=new n.default(f,d,m)},f.emit=function(p,m,d){var u=(0,I.getMuxPlayerId)(p);l[u]?(l[u].emit(m,d),m==="destroy"&&delete l[u]):c.default.error("A monitor for `"+u+"` has not been initialized.")},M.default!==void 0&&typeof M.default.addEventListener=="function"&&M.default.addEventListener("unload",function(){f.WINDOW_UNLOADING=!0},!1),f.checkDoNotTrack=y.default,f.log=c.default,f.utils=h.default,s.default=f},function(O,s){var R;R=function(){return this}();try{R=R||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(R=window)}O.exports=R},function(O,s,R){var _,b;(function(P,M){"use strict";_=M,(b=typeof _=="function"?_.call(s,R,s,O):_)!==void 0&&(O.exports=b)})(0,function(){"use strict";function P(h,l){var f=h[l];if(typeof f.bind=="function")return f.bind(h);try{return Function.prototype.bind.call(f,h)}catch{return function(){return Function.prototype.apply.apply(f,[h,arguments])}}}function M(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function I(h){return h==="debug"&&(h="log"),typeof console!==A&&(h==="trace"&&S?M:console[h]!==void 0?P(console,h):console.log!==void 0?P(console,"log"):E)}function D(h,l){for(var f=0;f<n.length;f++){var p=n[f];this[p]=f<h?E:this.methodFactory(p,h,l)}this.log=this.debug}function c(h,l,f){return function(){typeof console!==A&&(D.call(this,l,f),this[h].apply(this,arguments))}}function T(h,l,f){return I(h)||c.apply(this,arguments)}function y(h,l,f){function p(v){var g=(n[v]||"silent").toUpperCase();if(typeof window!==A&&r){try{return void(window.localStorage[r]=g)}catch{}try{window.document.cookie=encodeURIComponent(r)+"="+g+";"}catch{}}}function m(){var v;if(typeof window!==A&&r){try{v=window.localStorage[r]}catch{}if(typeof v===A)try{var g=window.document.cookie,L=g.indexOf(encodeURIComponent(r)+"=");L!==-1&&(v=/^([^;]+)/.exec(g.slice(L))[1])}catch{}return u.levels[v]===void 0&&(v=void 0),v}}var d,u=this,r="loglevel";typeof h=="string"?r+=":"+h:typeof h=="symbol"&&(r=void 0),u.name=h,u.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},u.methodFactory=f||T,u.getLevel=function(){return d},u.setLevel=function(v,g){if(typeof v=="string"&&u.levels[v.toUpperCase()]!==void 0&&(v=u.levels[v.toUpperCase()]),!(typeof v=="number"&&v>=0&&v<=u.levels.SILENT))throw"log.setLevel() called with invalid level: "+v;if(d=v,g!==!1&&p(v),D.call(u,v,h),typeof console===A&&v<u.levels.SILENT)return"No console available for logging"},u.setDefaultLevel=function(v){m()||u.setLevel(v,!1)},u.enableAll=function(v){u.setLevel(u.levels.TRACE,v)},u.disableAll=function(v){u.setLevel(u.levels.SILENT,v)};var i=m();i==null&&(i=l==null?"WARN":l),u.setLevel(i,!1)}var E=function(){},A="undefined",S=typeof window!==A&&typeof window.navigator!==A&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"],e=new y,t={};e.getLogger=function(h){if(typeof h!="symbol"&&typeof h!="string"||h==="")throw new TypeError("You must supply a name when creating a logger.");var l=t[h];return l||(l=t[h]=new y(h,e.getLevel(),e.methodFactory)),l};var a=typeof window!==A?window.log:void 0;return e.noConflict=function(){return typeof window!==A&&window.log===e&&(window.log=a),e},e.getLoggers=function(){return t},e.default=e,e})},function(O,s,R){"use strict";function _(te){return te&&te.__esModule?te:{default:te}}Object.defineProperty(s,"__esModule",{value:!0});var b=function(){function te(z,X){var ue=[],ve=!0,fe=!1,me=void 0;try{for(var pe,ce=z[Symbol.iterator]();!(ve=(pe=ce.next()).done)&&(ue.push(pe.value),!X||ue.length!==X);ve=!0);}catch(ae){fe=!0,me=ae}finally{try{!ve&&ce.return&&ce.return()}finally{if(fe)throw me}}return ue}return function(z,X){if(Array.isArray(z))return z;if(Symbol.iterator in Object(z))return te(z,X);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=R(4),M=_(P),I=R(2),D=_(I),c=R(6),T=R(5),y=R(0),E=_(y),A=R(10),S=_(A),n=R(3),e=_(n),t=R(20),a=R(21),h=R(22),l=_(h),f=R(23),p=_(f),m=R(24),d=_(m),u=R(25),r=_(u),i=R(26),v=_(i),g=R(27),L=_(g),C=R(28),k=_(C),U=R(29),F=_(U),B=R(30),N=_(B),K=R(31),H=_(K),j=R(32),W=_(j),V=R(33),$=_(V),Y=R(34),Q=_(Y),J=R(35),ie=_(J),q=R(44),ne=_(q),ge=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],ee=function(te,z,X){var ue=this;this.DOM_CONTENT_LOADED_EVENT_END=S.default.domContentLoadedEventEnd(),this.NAVIGATION_START=S.default.navigationStart();var ve={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(ae){return ae}};this.mux=te,this.id=z,X=(0,D.default)(ve,X),X.data=X.data||{},X.data.property_key&&(X.data.env_key=X.data.property_key,delete X.data.property_key),M.default.setLevel(X.debug?"debug":"warn"),this.getPlayheadTime=X.getPlayheadTime,this.getStateData=X.getStateData||function(){},this.getAdData=X.getAdData||function(){},this.minimumRebufferDuration=X.minimumRebufferDuration,this.sustainedRebufferThreshold=X.sustainedRebufferThreshold,this.playbackHeartbeatTime=X.playbackHeartbeatTime,this.disableRebufferTracking=X.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=X.errorTranslator,this.playbackEventDispatcher=new ie.default(te,X.data.env_key,X),this.data={player_instance_id:(0,c.generateUUID)(),mux_sample_rate:X.sampleRate,beacon_domain:X.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(ae,de){de=(0,D.default)({viewer_time:this.mux.utils.now()},de),this.oldEmit(ae,de)};var fe=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",function(ae,de){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,D.default)(this.data,de),this._initializeViewData(),this.one("play",fe),this.one("adbreakstart",fe)});var me=function(ae){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",ae)}.bind(this);this.on("videochange",function(ae,de){me(de)}),this.on("programchange",function(ae,de){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),me((0,D.default)(de,{view_program_changed:!0})),fe(),this.emit("play"),this.emit("playing")}),this.on("fragmentchange",function(ae,de){this.currentFragmentPDT=de.currentFragmentPDT,this.currentFragmentStart=de.currentFragmentStart}),this.on("destroy",this.destroy);var pe=this.destroy.bind(this);E.default!==void 0&&typeof E.default.addEventListener=="function"&&E.default.addEventListener("unload",pe,!1),this.on("destroy",function(){E.default!==void 0&&typeof E.default.removeEventListener=="function"&&E.default.removeEventListener("unload",pe)}),this.on("playerready",function(ae,de){(0,D.default)(this.data,de)}),ge.forEach(function(ae){ue.on(ae,function(de,Ce){ae.indexOf("ad")!==0&&this._updateStateData(),(0,D.default)(this.data,Ce),this._sanitizeData()}),ue.on("after"+ae,function(){(ae!=="error"||this.viewErrored)&&this.send(ae)})}),this.on("viewend",function(ae,de){(0,D.default)(ue.data,de)});var ce=function(ae){var de=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=de-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time};this.one("playerready",ce),d.default.apply(this),Q.default.apply(this),H.default.apply(this),L.default.apply(this),p.default.apply(this),N.default.apply(this),r.default.apply(this),v.default.apply(this),W.default.apply(this),k.default.apply(this),F.default.apply(this),$.default.apply(this),ne.default.apply(this),X.hlsjs&&this.addHLSJS(X),X.dashjs&&this.addDashJS(X),this.emit("viewinit",X.data)};(0,D.default)(ee.prototype,l.default.prototype),(0,D.default)(ee.prototype,L.default.prototype),(0,D.default)(ee.prototype,H.default.prototype),(0,D.default)(ee.prototype,p.default.prototype),(0,D.default)(ee.prototype,r.default.prototype),(0,D.default)(ee.prototype,v.default.prototype),(0,D.default)(ee.prototype,W.default.prototype),(0,D.default)(ee.prototype,k.default.prototype),(0,D.default)(ee.prototype,F.default.prototype),ee.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),E.default.clearTimeout(this._heartBeatTimeout))},ee.prototype.send=function(te){var z=(0,D.default)({},this.data);if(z.player_error_code===1&&(delete z.player_error_code,delete z.player_error_message),z.player_source_duration===1/0||z.video_source_duration===1/0?z.video_source_is_live=!0:(z.player_source_duration>0||z.video_source_duration>0)&&(z.video_source_is_live=!1),z.video_source_url=z.video_source_url||z.player_source_url,z.video_source_url){var X=(0,T.extractHostnameAndDomain)(z.video_source_url),ue=b(X,2),ve=ue[0],fe=ue[1];z.video_source_domain=fe,z.video_source_hostname=ve}delete z.ad_request_id,this.playbackEventDispatcher.send(te,z),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},ee.prototype._updateStateData=function(){(0,D.default)(this.data,this.getStateData()),this._updatePlayheadTime(),this._sanitizeData()},ee.prototype._sanitizeData=function(){var te=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(z){var X=parseInt(te.data[z],10);te.data[z]=isNaN(X)?void 0:X}),["player_source_url","video_source_url"].forEach(function(z){if(te.data[z]){var X=te.data[z].toLowerCase();X.indexOf("data:")!==0&&X.indexOf("blob:")!==0||(te.data[z]="MSE style URL")}})},ee.prototype._resetVideoData=function(te,z){var X=this;Object.keys(this.data).forEach(function(ue){ue.indexOf("video_")===0&&delete X.data[ue]})},ee.prototype._resetViewData=function(){var te=this;Object.keys(this.data).forEach(function(z){z.indexOf("view_")===0&&delete te.data[z]}),this.data.view_sequence_number=1},ee.prototype._resetErrorData=function(te,z){delete this.data.player_error_code,delete this.data.player_error_message},ee.prototype._initializeViewData=function(){var te=this,z=this.data.view_id=(0,c.generateUUID)(),X=function(){z===te.data.view_id&&(0,e.default)(te.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",X):X()},ee.prototype._restartHeartBeat=function(){var te=this;E.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=E.default.setTimeout(function(){te.data.player_is_paused||te.emit("hb")},1e4))},ee.prototype.addHLSJS=function(te){return te.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=te.hlsjs,void(0,t.monitorHlsJs)(this.mux,this.id,te.hlsjs,{},te.Hls||E.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},ee.prototype.removeHLSJS=function(){this.hlsjs&&((0,t.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},ee.prototype.addDashJS=function(te){return te.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=te.dashjs,void(0,a.monitorDashJS)(this.mux,this.id,te.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},ee.prototype.removeDashJS=function(){this.dashjs&&((0,a.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},s.default=ee},function(O,s,R){"use strict";function _(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(s,"__esModule",{value:!0}),s.stopMonitoringHlsJs=s.monitorHlsJs=void 0;var b=R(7),P=_(b),M=R(10),I=_(M),D=R(5),c=function(A){if(!A)return{};var S=I.default.navigationStart(),n=A.loading,e=n?n.start:A.trequest,t=n?n.first:A.tfirst,a=n?n.end:A.tload;return{bytesLoaded:A.total,requestStart:Math.round(S+e),responseStart:Math.round(S+t),responseEnd:Math.round(S+a)}},T=function(A){if(A&&typeof A.getAllResponseHeaders=="function")return(0,P.default)(A.getAllResponseHeaders())},y=function(A,S,n){var e=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments[4]),t=A.log,a=A.utils.secondsToMs,h=function(g){var L=parseInt(e.version),C=void 0;return L===1&&g.programDateTime!==null&&(C=g.programDateTime),L===0&&g.pdt!==null&&(C=g.pdt),C};if(!I.default.exists())return void t.warn("performance timing not supported. Not tracking HLS.js.");var l=function(g,L){return A.emit(S,g,L)},f=function(g,L){var C=L.levels,k=L.audioTracks,U=L.url,F=L.stats,B=L.networkDetails,N={},K={};C.forEach(function(Y,Q){N[Q]={width:Y.width,height:Y.height,bitrate:Y.bitrate,attrs:Y.attrs}}),k.forEach(function(Y,Q){K[Q]={name:Y.name,language:Y.lang,bitrate:Y.bitrate}});var H=c(F),j=H.bytesLoaded,W=H.requestStart,V=H.responseStart,$=H.responseEnd;l("requestcompleted",{request_event_type:g,request_bytes_loaded:j,request_start:W,request_response_start:V,request_response_end:$,request_type:"manifest",request_hostname:(0,D.extractHostname)(U),request_response_headers:T(B),request_rendition_lists:{media:N,audio:K,video:{}}})};n.on(e.Events.MANIFEST_LOADED,f);var p=function(g,L){var C=L.details,k=L.level,U=L.networkDetails,F=L.stats,B=c(F),N=B.bytesLoaded,K=B.requestStart,H=B.responseStart,j=B.responseEnd,W=C.fragments[C.fragments.length-1],V=h(W)+a(W.duration);l("requestcompleted",{request_event_type:g,request_bytes_loaded:N,request_start:K,request_response_start:H,request_response_end:j,request_current_level:k,request_type:"manifest",request_hostname:(0,D.extractHostname)(C.url),request_response_headers:T(U),video_holdback:C.holdBack&&a(C.holdBack),video_part_holdback:C.partHoldBack&&a(C.partHoldBack),video_part_target_duration:C.partTarget&&a(C.partTarget),video_target_duration:C.targetduration&&a(C.targetduration),player_manifest_newest_program_time:isNaN(V)?void 0:V})};n.on(e.Events.LEVEL_LOADED,p);var m=function(g,L){var C=L.details,k=L.networkDetails,U=L.stats,F=c(U),B=F.bytesLoaded,N=F.requestStart,K=F.responseStart,H=F.responseEnd;l("requestcompleted",{request_event_type:g,request_bytes_loaded:B,request_start:N,request_response_start:K,request_response_end:H,request_type:"manifest",request_hostname:(0,D.extractHostname)(C.url),request_response_headers:T(k)})};n.on(e.Events.AUDIO_TRACK_LOADED,m);var d=function(g,L){var C=L.stats,k=L.networkDetails,U=L.frag,F=c(C),B=F.bytesLoaded,N=F.requestStart,K=F.responseStart,H=F.responseEnd,j={request_event_type:g,request_bytes_loaded:B,request_start:N,request_response_start:K,request_response_end:H,request_hostname:k?(0,D.extractHostname)(k.responseURL):void 0,request_response_headers:T(k),request_media_duration:U.duration};U.type==="main"?(j.request_type="media",j.request_current_level=U.level,j.request_video_width=(n.levels[U.level]||{}).width,j.request_video_height=(n.levels[U.level]||{}).height):j.request_type=U.type,l("requestcompleted",j)};n.on(e.Events.FRAG_LOADED,d);var u=function(g,L){var C=L.frag,k=C.start,U=h(C),F={currentFragmentPDT:U,currentFragmentStart:a(k)};l("fragmentchange",F)};n.on(e.Events.FRAG_CHANGED,u);var r=function(g,L){var C=L.details,k=L.response,U=L.context,F=L.frag;if(C===e.ErrorDetails.MANIFEST_LOAD_ERROR||C===e.ErrorDetails.MANIFEST_LOAD_TIMEOUT||C===e.ErrorDetails.FRAG_LOAD_ERROR||C===e.ErrorDetails.FRAG_LOAD_TIMEOUT||C===e.ErrorDetails.LEVEL_LOAD_ERROR||C===e.ErrorDetails.LEVEL_LOAD_TIMEOUT){var B=F&&F.url||U&&U.url||"";l("requestfailed",{request_error:C,request_url:B,request_hostname:(0,D.extractHostname)(B),request_type:C===e.ErrorDetails.FRAG_LOAD_ERROR||C===e.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:k&&k.code,request_error_text:k&&k.text})}};n.on(e.Events.ERROR,r);var i=function(g,L){var C=L.frag,k=C&&C._url||"";l("requestcanceled",{request_cancel:g,request_url:k,request_type:"media",request_hostname:(0,D.extractHostname)(k)})};n.on(e.Events.FRAG_LOAD_EMERGENCY_ABORTED,i);var v=function(g,L){var C=L.level,k=n.levels[C];if(k&&k.attrs&&k.attrs.BANDWIDTH){var U=k.attrs.BANDWIDTH;U?l("renditionchange",{video_source_bitrate:U,video_source_width:k.width,video_source_height:k.height}):t.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};n.on(e.Events.LEVEL_SWITCHED,v),n._stopMuxMonitor=function(){n.off(e.Events.MANIFEST_LOADED,f),n.off(e.Events.LEVEL_LOADED,p),n.off(e.Events.AUDIO_TRACK_LOADED,m),n.off(e.Events.FRAG_LOADED,d),n.off(e.Events.FRAG_CHANGED,u),n.off(e.Events.ERROR,r),n.off(e.Events.FRAG_LOAD_EMERGENCY_ABORTED,i),n.off(e.Events.LEVEL_SWITCHED,v),n.off(e.Events.DESTROYING,n._stopMuxMonitor),delete n._stopMuxMonitor},n.on(e.Events.DESTROYING,n._stopMuxMonitor)},E=function(A){A&&typeof A._stopMuxMonitor=="function"&&A._stopMuxMonitor()};s.monitorHlsJs=y,s.stopMonitoringHlsJs=E},function(O,s,R){"use strict";function _(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(s,"__esModule",{value:!0}),s.stopMonitoringDashJS=s.monitorDashJS=void 0;var b=R(0),P=_(b),M=R(7),I=_(M),D=R(5),c=function(A,S){if(!A||typeof A.getRequests!="function")return{};var n=A.getRequests({state:"executed"});if(n.length===0)return{};var e=n[n.length-1],t=(0,D.extractHostname)(e.url),a=e.bytesLoaded,h=new Date(e.requestStartDate).getTime(),l=new Date(e.firstByteDate).getTime(),f=new Date(e.requestEndDate).getTime(),p=isNaN(e.duration)?0:e.duration,m=typeof S.getMetricsFor=="function"?S.getMetricsFor(e.mediaType).HttpList:S.getDashMetrics().getHttpRequests(e.mediaType),d=void 0;return m.length>0&&(d=(0,I.default)(m[m.length-1]._responseHeaders||"")),{requestStart:h,requestResponseStart:l,requestResponseEnd:f,requestBytesLoaded:a,requestResponseHeaders:d,requestMediaDuration:p,requestHostname:t}},T=function(A,S){var n=S.getQualityFor(A),e=S.getCurrentTrackFor(A),t=e.bitrateList;return t?{currentLevel:n,renditionWidth:t[n].width||null,renditionHeight:t[n].height||null,renditionBitrate:t[n].bandwidth}:{}},y=function(A,S,n){var e=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],A.log);if(!n||!n.on)return void e.warn("Invalid dash.js player reference. Monitoring blocked.");var t=function(r,i){return A.emit(S,r,i)},a=function(r){var i=r.type,v=r.data,g=v||{},L=g.url;t("requestcompleted",{request_event_type:i,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,D.extractHostname)(L)})};n.on("manifestLoaded",a);var h={},l=function(r){var i=r.type,v=r.fragmentModel,g=r.chunk,L=g||{},C=L.mediaInfo,k=C||{},U=k.type,F=k.bitrateList;F=F||[];var B={};F.forEach(function(Y,Q){B[Q]={},B[Q].width=Y.width,B[Q].height=Y.height,B[Q].bitrate=Y.bandwidth,B[Q].attrs={}}),U==="video"?h.video=B:U==="audio"?h.audio=B:h.media=B;var N=c(v,n),K=N.requestStart,H=N.requestResponseStart,j=N.requestResponseEnd,W=N.requestResponseHeaders,V=N.requestMediaDuration,$=N.requestHostname;t("requestcompleted",{request_event_type:i,request_start:K,request_response_start:H,request_response_end:j,request_bytes_loaded:-1,request_type:U+"_init",request_response_headers:W,request_hostname:$,request_media_duration:V,request_rendition_lists:h})};n.on("initFragmentLoaded",l);var f=function(r){var i=r.type,v=r.fragmentModel,g=r.chunk,L=g||{},C=L.mediaInfo,k=L.start,U=C||{},F=U.type,B=c(v,n),N=B.requestStart,K=B.requestResponseStart,H=B.requestResponseEnd,j=B.requestBytesLoaded,W=B.requestResponseHeaders,V=B.requestMediaDuration,$=B.requestHostname,Y=T(F,n),Q=Y.currentLevel,J=Y.renditionWidth,ie=Y.renditionHeight,q=Y.renditionBitrate;t("requestcompleted",{request_event_type:i,request_start:N,request_response_start:K,request_response_end:H,request_bytes_loaded:j,request_type:F,request_response_headers:W,request_hostname:$,request_media_start_time:k,request_media_duration:V,request_current_level:Q,request_labeled_bitrate:q,request_video_width:J,request_video_height:ie})};n.on("mediaFragmentLoaded",f);var p={video:void 0,audio:void 0,totalBitrate:void 0},m=function(){if(p.video&&typeof p.video.bitrate=="number"){if(!p.video.width||!p.video.height)return void e.warn("have bitrate info for video but missing width/height");var r=p.video.bitrate;return p.audio&&typeof p.audio.bitrate=="number"&&(r+=p.audio.bitrate),r!==p.totalBitrate?(p.totalBitrate=r,{video_source_bitrate:r,video_source_height:p.video.height,video_source_width:p.video.width}):void 0}},d=function(r,i,v){if(typeof r.newQuality!="number")return void e.warn("missing evt.newQuality in qualityChangeRendered event",r);var g=r.mediaType;if(g==="audio"||g==="video"){var L=n.getBitrateInfoListFor(g).find(function(k){return k.qualityIndex===r.newQuality});if(!L||typeof L.bitrate!="number")return void e.warn("missing bitrate info for "+g);p[g]=L;var C=m();C&&t("renditionchange",C)}};n.on("qualityChangeRendered",d);var u=function(r){var i=r.error,v=r.event;v=v||{};var g=v.request||{},L=P.default.event&&P.default.event.currentTarget||{};t("requestfailed",{request_error:i+"_"+v.id+"_"+g.type,request_url:v.url,request_hostname:(0,D.extractHostname)(v.url),request_type:g.mediaType,request_error_code:L.status,request_error_type:L.statusText})};n.on("error",u),n._stopMuxMonitor=function(){n.off("manifestLoaded",a),n.off("initFragmentLoaded",l),n.off("mediaFragmentLoaded",f),n.off("qualityChangeRendered",d),n.off("error",u),delete n._stopMuxMonitor}},E=function(A){A&&typeof A._stopMuxMonitor=="function"&&A._stopMuxMonitor()};s.monitorDashJS=y,s.stopMonitoringDashJS=E},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=function(){},b=0;_.prototype.on=function(P,M,I){return M._eventEmitterGuid=M._eventEmitterGuid||++b,this._listeners=this._listeners||{},this._listeners[P]=this._listeners[P]||[],I&&(M=M.bind(I)),this._listeners[P].push(M),M},_.prototype.off=function(P,M){var I=this._listeners&&this._listeners[P];I&&I.forEach(function(D,c){D._eventEmitterGuid===M._eventEmitterGuid&&I.splice(c,1)})},_.prototype.one=function(P,M,I){var D=this;M._eventEmitterGuid=M._eventEmitterGuid||++b;var c=function T(){D.off(P,T),M.apply(I||this,arguments)};c._eventEmitterGuid=M._eventEmitterGuid,this.on(P,c)},_.prototype.emit=function(P,M){var I=this;if(this._listeners){M=M||{};var D=this._listeners["before*"]||[],c=this._listeners[P]||[],T=this._listeners["after"+P]||[],y=function(E,A){E=E.slice(),E.forEach(function(S){S.call(I,{type:P},A)})};y(D,M),y(c,M),y(T,M)}},s.default=_},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(0),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",function(){this._playheadShouldBeProgressing=!0}),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()}),this.on("timeupdate",function(){this._playbackHeartbeatInterval!==null&&this.emit("playbackheartbeat")}),this.on("devicesleep",function(M,I){this._playbackHeartbeatInterval!==null&&(b.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:I.viewer_time}),this._playbackHeartbeatInterval=null)})};P.prototype._startPlaybackHeartbeatInterval=function(){var M=this;this._playbackHeartbeatInterval===null&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=b.default.setInterval(function(){M.emit("playbackheartbeat")},this.playbackHeartbeatTime))},P.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(b.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},s.default=P},function(O,s,R){"use strict";function _(){var b=this;this.on("viewinit",function(){b.viewErrored=!1}),this.on("error",function(){try{var P=b.errorTranslator({player_error_code:b.data.player_error_code,player_error_message:b.data.player_error_message});P?(b.data.player_error_code=P.player_error_code,b.data.player_error_message=P.player_error_message,b.viewErrored=!0):(delete b.data.player_error_code,delete b.data.player_error_message)}catch(M){b.mux.log.warn("Exception in error translator callback.",M),b.viewErrored=!0}})}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(3),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};P.prototype._updateWatchTime=function(M,I){var D=I.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=D),(0,b.default)(this.data,"view_watch_time",D-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=D},P.prototype._clearWatchTimeState=function(M,I){this._updateWatchTime(M,I),this._watchTimeTrackerLastCheckedTime=null},s.default=P},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(3),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};P.prototype._updatePlaybackTime=function(){var M=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&M>this._playbackTimeTrackerLastPlayheadPosition){var I=M-this._playbackTimeTrackerLastPlayheadPosition;I<=1e3&&(0,b.default)(this.data,"view_content_playback_time",I)}this._playbackTimeTrackerLastPlayheadPosition=M},P.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},s.default=P},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",function(){this.off("timeupdate",this._updatePlayheadTime)})};_.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=this.data.view_max_playhead_position===void 0?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},_.prototype._updatePlayheadTime=function(b,P){if(P&&P.player_playhead_time)this.data.player_playhead_time=P.player_playhead_time,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+P.player_playhead_time-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var M=this.getPlayheadTime();M!==void 0&&(this.data.player_playhead_time=M,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+M-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition())}},s.default=_},function(O,s,R){"use strict";function _(c){return c&&c.__esModule?c:{default:c}}Object.defineProperty(s,"__esModule",{value:!0});var b=R(1),P=_(b),M=R(3),I=_(M),D=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",function(){this._cleanupRebufferTracker(null,{viewer_time:P.default.now()})})};D.prototype._checkIfRebuffering=function(c,T){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(c,T);if(this._lastCheckedTime===null)return this._prepareRebufferTrackerState(T.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(c,T,!0);var y=T.viewer_time-this._lastPlayheadTimeUpdatedTime;y>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(T.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,I.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(y),this.emit("rebufferstart"))),this._lastCheckedTime=T.viewer_time}},D.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},D.prototype._prepareRebufferTrackerState=function(c){this._lastCheckedTime=c,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=c},D.prototype._cleanupRebufferTracker=function(c,T){var y=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(T.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:T.viewer_time});else{if(this._lastCheckedTime===null)return void this._updateRebufferMetrics();var E=this.data.player_playhead_time-this._lastPlayheadTime,A=T.viewer_time-this._lastPlayheadTimeUpdatedTime;E>0&&A-E>this.minimumRebufferDuration?((0,I.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(A-E),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+A-E})):this._updateRebufferMetrics()}y?this._prepareRebufferTrackerState(T.viewer_time):this._clearRebufferTrackerState()}},D.prototype._updateRebufferMetrics=function(c){c>0&&(0,I.default)(this.data,"view_rebuffer_duration",c),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},s.default=D},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(1),b=function(M){return M&&M.__esModule?M:{default:M}}(_),P=function(){this.on("viewinit",function(){var M=this.data,I=M.view_id;if(!M.view_program_changed){var D=function(c,T){var y=T.viewer_time;c.type==="playing"&&this.data.view_time_to_first_frame===void 0?this.calculateTimeToFirstFrame(y||b.default.now(),I):c.type!=="adplaying"||this.data.view_time_to_first_frame!==void 0&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(y||b.default.now(),I)};this.one("playing",D),this.one("adplaying",D),this.one("viewend",function(){this.off("playing",D),this.off("adplaying",D)})}})};P.prototype.calculateTimeToFirstFrame=function(M,I){I===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:M}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},s.default=P},function(O,s,R){"use strict";function _(){var M=this;this.on("viewinit",function(){this._lastPlayheadPosition=-1});var I=["pause","rebufferstart","seeking","error","adbreakstart","hb"],D=["playing","hb"];I.forEach(function(c){M.on(c,function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var T=this.data.player_playhead_time-this._lastPlayheadPosition;if(T<0)return void(this._lastPlayheadPosition=-1);var y=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),E=Math.max(0,y-1),A=Math.max(0,1-y);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,E),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,A),(0,P.default)(this.data,"view_total_content_playback_time",T),(0,P.default)(this.data,"view_total_upscaling",E*T),(0,P.default)(this.data,"view_total_downscaling",A*T)}this._lastPlayheadPosition=-1})}),D.forEach(function(c){M.on(c,function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height})})}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_;var b=R(3),P=function(M){return M&&M.__esModule?M:{default:M}}(b)},function(O,s,R){"use strict";function _(y){return y&&y.__esModule?y:{default:y}}function b(){this.isSeeking=!1,this.on("seeking",function(y,E){(0,T.default)(this.data,E),this._lastSeekingTime=M.default.now(),this.isSeeking===!1&&(this.isSeeking=!0,this.send("seeking"))}),this.on("seeked",function(){this.isSeeking=!1;var y=this._lastSeekingTime||M.default.now(),E=M.default.now()-y;(0,D.default)(this.data,"view_seek_count",1),(0,D.default)(this.data,"view_seek_duration",E);var A=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(A,E)}),this.on("viewend",function(){this.isSeeking=!1})}Object.defineProperty(s,"__esModule",{value:!0}),s.default=b;var P=R(1),M=_(P),I=R(3),D=_(I),c=R(2),T=_(c)},function(O,s,R){"use strict";function _(A){return A&&A.__esModule?A:{default:A}}Object.defineProperty(s,"__esModule",{value:!0});var b=function(){function A(S,n){var e=[],t=!0,a=!1,h=void 0;try{for(var l,f=S[Symbol.iterator]();!(t=(l=f.next()).done)&&(e.push(l.value),!n||e.length!==n);t=!0);}catch(p){a=!0,h=p}finally{try{!t&&f.return&&f.return()}finally{if(a)throw h}}return e}return function(S,n){if(Array.isArray(S))return S;if(Symbol.iterator in Object(S))return A(S,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),P=R(3),M=_(P),I=R(5),D=R(2),c=_(D),T=function(A,S){A.push(S),A.sort(function(n,e){return n.viewer_time-e.viewer_time})},y=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],E=function(){var A=this;this.on("viewinit",function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0}),y.forEach(function(n){return A.on(n,A._updateAdData)});var S=function(){A.isAdBreak=!1};this.on("adbreakstart",function(){this.isAdBreak=!0}),this.on("play",S),this.on("playing",S),this.on("viewend",S),this.on("adrequest",function(n,e){e=(0,c.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},e),T(this._adRequests,e),(0,M.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,M.default)(this.data,"view_preroll_request_count"))}),this.on("adresponse",function(n,e){e=(0,c.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},e),T(this._adResponses,e);var t=this.findAdRequest(e.ad_request_id);t&&(0,M.default)(this.data,"view_ad_request_time",Math.max(0,e.viewer_time-t.viewer_time))}),this.on("adplay",function(n,e){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,M.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,e.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,e.viewer_time-this.data.view_start)),this._prerollPlayTime=e.viewer_time)}),this.on("adplaying",function(n,e){this.inPrerollPosition()&&this.data.view_preroll_load_time===void 0&&this._prerollPlayTime!==void 0&&(this.data.view_preroll_load_time=e.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=e.viewer_time-this._prerollPlayTime)}),this.on("adended",function(){this._wouldBeNewAdPlay=!0}),this.on("aderror",function(){this._wouldBeNewAdPlay=!0})};E.prototype.inPrerollPosition=function(){return this.data.view_content_playback_time===void 0||this.data.view_content_playback_time<=1e3},E.prototype.findAdRequest=function(A){for(var S=0;S<this._adRequests.length;S++)if(this._adRequests[S].ad_request_id===A)return this._adRequests[S]},E.prototype._updateAdData=function(A,S){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&S.ad_tag_url){var n=(0,I.extractHostnameAndDomain)(S.ad_tag_url),e=b(n,2),t=e[0],a=e[1];this.data.view_preroll_ad_tag_domain=a,this.data.view_preroll_ad_tag_hostname=t}if(!this.data.view_preroll_ad_asset_hostname&&S.ad_asset_url){var h=(0,I.extractHostnameAndDomain)(S.ad_asset_url),l=b(h,2),f=l[0],p=l[1];this.data.view_preroll_ad_asset_domain=p,this.data.view_preroll_ad_asset_hostname=f}}},s.default=E},function(O,s,R){"use strict";function _(c){return c&&c.__esModule?c:{default:c}}function b(){var c=this,T=void 0,y=void 0,E=function(){c.disableRebufferTracking||((0,D.default)(c.data,"view_waiting_rebuffer_count",1),T=M.default.now(),y=window.setInterval(function(){if(T){var t=M.default.now();(0,D.default)(c.data,"view_waiting_rebuffer_duration",t-T),T=t}},250))},A=function(){c.disableRebufferTracking||T&&((0,D.default)(c.data,"view_waiting_rebuffer_duration",M.default.now()-T),T=!1,window.clearInterval(y))},S=!1,n=function(){S=!0},e=function(){S=!1,A()};this.on("waiting",function(){S&&E()}),this.on("playing",function(){A(),n()}),this.on("pause",e),this.on("seeking",e)}Object.defineProperty(s,"__esModule",{value:!0}),s.default=b;var P=R(1),M=_(P),I=R(3),D=_(I)},function(O,s,R){"use strict";function _(y){return y&&y.__esModule?y:{default:y}}function b(){var y=this;this.one("playbackheartbeat",c),this.on("playbackheartbeatend",function(){y.off("before*",T),y.one("playbackheartbeat",c)})}Object.defineProperty(s,"__esModule",{value:!0}),s.default=b;var P=R(2),M=_(P),I=R(1),D=_(I),c=function(){this.lastWallClockTime=D.default.now(),this.on("before*",T)},T=function(y){var E=D.default.now(),A=this.lastWallClockTime;this.lastWallClockTime=E,E-A>3e4&&(this.emit("devicesleep",{viewer_time:A}),(0,M.default)(this.data,{viewer_time:A}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:E}),(0,M.default)(this.data,{viewer_time:E}),this.send("devicewake"))}},function(O,s,R){"use strict";function _(i){return i&&i.__esModule?i:{default:i}}Object.defineProperty(s,"__esModule",{value:!0});var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},P=R(0),M=_(P),I=R(36),D=R(4),c=_(D),T=R(40),y=_(T),E=R(9),A=_(E),S=R(41),n=_(S),e=R(14),t=_(e),a=R(42),h=_(a),l=R(2),f=_(l),p=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],m=["viewstart","error","ended","viewend"],d=function(i,v){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=i,this.envKey=v,this.eventQueue=new h.default((0,y.default)(v,g.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=g.sampleRate,this.disableCookies=g.disableCookies,this.respectDoNotTrack=g.respectDoNotTrack;var L=g.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:L.name,viewer_application_version:L.version,viewer_application_engine:L.layout,viewer_device_name:L.product,viewer_device_category:"",viewer_device_manufacturer:L.manufacturer,viewer_os_family:L.os&&L.os.family,viewer_os_architecture:L.os&&L.os.architecture,viewer_os_version:L.os&&L.os.version};var C=(0,n.default)();C&&(this.pageLevelData=(0,f.default)(this.pageLevelData,{viewer_connection_type:C})),M.default!==void 0&&M.default.location&&M.default.location.href&&(this.pageLevelData.page_url=M.default.location.href),this.viewerData=this.disableCookies?{}:(0,I.getAndUpdateViewerData)()};d.prototype.send=function(i,v){if(i){if(this.respectDoNotTrack&&(0,A.default)())return c.default.info("Not sending `"+i+"` because Do Not Track is enabled");if(!v||(v===void 0?"undefined":b(v))!=="object")return c.default.error("A data object was expected in send() but was not provided");var g=this.disableCookies?{}:(0,I.getAndUpdateSessionData)(),L={};(0,f.default)(L,this.pageLevelData),(0,f.default)(L,v),(0,f.default)(L,g),(0,f.default)(L,this.viewerData),L.event=i,L.env_key=this.envKey,L.user_id&&(L.viewer_user_id=L.user_id,delete L.user_id);var C=L.mux_sample_number>=this.sampleRate,k=this._deduplicateBeaconData(i,L),U=(0,t.default)(k);if(this.lastEventTime=this.mux.utils.now(),C)return c.default.info("Not sending event due to sample rate restriction",i,L,U);if(!this.envKey)return c.default.info("Not sending event due to missing environment key",i,L,U);if(!this.rateLimited){if(c.default.info("Sending event",i,L,U),this.rateLimited=!this.eventQueue.queueEvent(i,U),this.mux.WINDOW_UNLOADING&&i==="viewend")this.eventQueue.destroy(!0);else if(m.indexOf(i)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return L.event="eventrateexceeded",U=(0,t.default)(L),this.eventQueue.queueEvent(L.event,U),c.default.error("Beaconing disabled due to rate limit.")}}},d.prototype.destroy=function(){this.eventQueue.destroy(!1)};var u=function(i,v,g,L){return!(!i||v.indexOf("request_")!==0)&&(v==="request_response_headers"||(g===void 0?"undefined":b(g))!=="object"||(L===void 0?"undefined":b(L))!=="object"||Object.keys(g||{}).length!==Object.keys(L||{}).length)},r=function(i,v){return i==="renditionchange"&&v.indexOf("video_source_")===0};d.prototype._deduplicateBeaconData=function(i,v){var g=this,L={},C=v.view_id;if(!C||i==="viewstart"||i==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)L=(0,f.default)({},v),C&&(this.previousBeaconData=L),C&&i==="viewend"&&(this.previousBeaconData=null);else{var k=i.indexOf("request")===0;Object.keys(v).forEach(function(U){var F=v[U];(F!==g.previousBeaconData[U]||p.indexOf(U)>-1||u(k,U,F,g.previousBeaconData[U])||r(i,U))&&(L[U]=F,g.previousBeaconData[U]=F)})}return L},s.default=d},function(O,s,R){"use strict";function _(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(s,"__esModule",{value:!0}),s.getAndUpdateSessionData=s.getAndUpdateViewerData=void 0;var b=R(11),P=_(b),M=R(39),I=_(M),D=R(6),c=R(1),T=_(c),y=function(){var n=void 0;try{n=P.default.parse(I.default.get("muxData")||"")}catch{n={}}return n},E=function(n){try{I.default.set("muxData",P.default.stringify(n),{expires:7300})}catch{}},A=function(){var n=y();return n.mux_viewer_id=n.mux_viewer_id||(0,D.generateUUID)(),n.msn=n.msn||Math.random(),E(n),{mux_viewer_id:n.mux_viewer_id,mux_sample_number:n.msn}},S=function(){var n=y(),e=T.default.now();return n.session_start&&(n.sst=n.session_start,delete n.session_start),n.session_id&&(n.sid=n.session_id,delete n.session_id),n.session_expires&&(n.sex=n.session_expires,delete n.session_expires),(!n.sex||n.sex<e)&&(n.sid=(0,D.generateUUID)(),n.sst=e),n.sex=e+15e5,E(n),{session_id:n.sid,session_start:n.sst,session_expires:n.sex}};s.getAndUpdateViewerData=A,s.getAndUpdateSessionData=S},function(O,s,R){"use strict";var _=R(12),b=R(13),P={brackets:function(c){return c+"[]"},indices:function(c,T){return c+"["+T+"]"},repeat:function(c){return c}},M=Date.prototype.toISOString,I={delimiter:"&",encode:!0,encoder:_.encode,encodeValuesOnly:!1,serializeDate:function(c){return M.call(c)},skipNulls:!1,strictNullHandling:!1},D=function c(T,y,E,A,S,n,e,t,a,h,l,f){var p=T;if(typeof e=="function")p=e(y,p);else if(p instanceof Date)p=h(p);else if(p===null){if(A)return n&&!f?n(y,I.encoder):y;p=""}if(typeof p=="string"||typeof p=="number"||typeof p=="boolean"||_.isBuffer(p))return n?[l(f?y:n(y,I.encoder))+"="+l(n(p,I.encoder))]:[l(y)+"="+l(String(p))];var m=[];if(p===void 0)return m;var d;if(Array.isArray(e))d=e;else{var u=Object.keys(p);d=t?u.sort(t):u}for(var r=0;r<d.length;++r){var i=d[r];S&&p[i]===null||(m=Array.isArray(p)?m.concat(c(p[i],E(y,i),E,A,S,n,e,t,a,h,l,f)):m.concat(c(p[i],y+(a?"."+i:"["+i+"]"),E,A,S,n,e,t,a,h,l,f)))}return m};O.exports=function(c,T){var y=c,E=T?_.assign({},T):{};if(E.encoder!==null&&E.encoder!==void 0&&typeof E.encoder!="function")throw new TypeError("Encoder has to be a function.");var A=E.delimiter===void 0?I.delimiter:E.delimiter,S=typeof E.strictNullHandling=="boolean"?E.strictNullHandling:I.strictNullHandling,n=typeof E.skipNulls=="boolean"?E.skipNulls:I.skipNulls,e=typeof E.encode=="boolean"?E.encode:I.encode,t=typeof E.encoder=="function"?E.encoder:I.encoder,a=typeof E.sort=="function"?E.sort:null,h=E.allowDots!==void 0&&E.allowDots,l=typeof E.serializeDate=="function"?E.serializeDate:I.serializeDate,f=typeof E.encodeValuesOnly=="boolean"?E.encodeValuesOnly:I.encodeValuesOnly;if(E.format===void 0)E.format=b.default;else if(!Object.prototype.hasOwnProperty.call(b.formatters,E.format))throw new TypeError("Unknown format option provided.");var p,m,d=b.formatters[E.format];typeof E.filter=="function"?(m=E.filter,y=m("",y)):Array.isArray(E.filter)&&(m=E.filter,p=m);var u=[];if(typeof y!="object"||y===null)return"";var r;r=E.arrayFormat in P?E.arrayFormat:"indices"in E?E.indices?"indices":"repeat":"indices";var i=P[r];p||(p=Object.keys(y)),a&&p.sort(a);for(var v=0;v<p.length;++v){var g=p[v];n&&y[g]===null||(u=u.concat(D(y[g],g,i,S,n,e?t:null,m,a,h,l,d,f)))}var L=u.join(A),C=E.addQueryPrefix===!0?"?":"";return L.length>0?C+L:""}},function(O,s,R){"use strict";var _=R(12),b=Object.prototype.hasOwnProperty,P={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:_.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},M=function(c,T){for(var y={},E=T.ignoreQueryPrefix?c.replace(/^\?/,""):c,A=T.parameterLimit===1/0?void 0:T.parameterLimit,S=E.split(T.delimiter,A),n=0;n<S.length;++n){var e,t,a=S[n],h=a.indexOf("]="),l=h===-1?a.indexOf("="):h+1;l===-1?(e=T.decoder(a,P.decoder),t=T.strictNullHandling?null:""):(e=T.decoder(a.slice(0,l),P.decoder),t=T.decoder(a.slice(l+1),P.decoder)),b.call(y,e)?y[e]=[].concat(y[e]).concat(t):y[e]=t}return y},I=function(c,T,y){for(var E=T,A=c.length-1;A>=0;--A){var S,n=c[A];if(n==="[]")S=[],S=S.concat(E);else{S=y.plainObjects?Object.create(null):{};var e=n.charAt(0)==="["&&n.charAt(n.length-1)==="]"?n.slice(1,-1):n,t=parseInt(e,10);!isNaN(t)&&n!==e&&String(t)===e&&t>=0&&y.parseArrays&&t<=y.arrayLimit?(S=[],S[t]=E):S[e]=E}E=S}return E},D=function(c,T,y){if(c){var E=y.allowDots?c.replace(/\.([^.[]+)/g,"[$1]"):c,A=/(\[[^[\]]*])/,S=/(\[[^[\]]*])/g,n=A.exec(E),e=n?E.slice(0,n.index):E,t=[];if(e){if(!y.plainObjects&&b.call(Object.prototype,e)&&!y.allowPrototypes)return;t.push(e)}for(var a=0;(n=S.exec(E))!==null&&a<y.depth;){if(a+=1,!y.plainObjects&&b.call(Object.prototype,n[1].slice(1,-1))&&!y.allowPrototypes)return;t.push(n[1])}return n&&t.push("["+E.slice(n.index)+"]"),I(t,T,y)}};O.exports=function(c,T){var y=T?_.assign({},T):{};if(y.decoder!==null&&y.decoder!==void 0&&typeof y.decoder!="function")throw new TypeError("Decoder has to be a function.");if(y.ignoreQueryPrefix=y.ignoreQueryPrefix===!0,y.delimiter=typeof y.delimiter=="string"||_.isRegExp(y.delimiter)?y.delimiter:P.delimiter,y.depth=typeof y.depth=="number"?y.depth:P.depth,y.arrayLimit=typeof y.arrayLimit=="number"?y.arrayLimit:P.arrayLimit,y.parseArrays=y.parseArrays!==!1,y.decoder=typeof y.decoder=="function"?y.decoder:P.decoder,y.allowDots=typeof y.allowDots=="boolean"?y.allowDots:P.allowDots,y.plainObjects=typeof y.plainObjects=="boolean"?y.plainObjects:P.plainObjects,y.allowPrototypes=typeof y.allowPrototypes=="boolean"?y.allowPrototypes:P.allowPrototypes,y.parameterLimit=typeof y.parameterLimit=="number"?y.parameterLimit:P.parameterLimit,y.strictNullHandling=typeof y.strictNullHandling=="boolean"?y.strictNullHandling:P.strictNullHandling,c===""||c===null||c===void 0)return y.plainObjects?Object.create(null):{};for(var E=typeof c=="string"?M(c,y):c,A=y.plainObjects?Object.create(null):{},S=Object.keys(E),n=0;n<S.length;++n){var e=S[n],t=D(e,E[e],y);A=_.merge(A,t,y)}return _.compact(A)}},function(O,s,R){"use strict";var _,b,P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(M){return typeof M}:function(M){return M&&typeof Symbol=="function"&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":typeof M};(function(M){var I=!1;if(_=M,(b=typeof _=="function"?_.call(s,R,s,O):_)!==void 0&&(O.exports=b),I=!0,P(s)==="object"&&(O.exports=M(),I=!0),!I){var D=window.Cookies,c=window.Cookies=M();c.noConflict=function(){return window.Cookies=D,c}}})(function(){function M(D){function c(T,y,E){var A;if(typeof document!="undefined"){if(arguments.length>1){if(E=I({path:"/"},c.defaults,E),typeof E.expires=="number"){var S=new Date;S.setMilliseconds(S.getMilliseconds()+864e5*E.expires),E.expires=S}try{A=JSON.stringify(y),/^[\{\[]/.test(A)&&(y=A)}catch{}return y=D.write?D.write(y,T):encodeURIComponent(String(y)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),T=encodeURIComponent(String(T)),T=T.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),T=T.replace(/[\(\)]/g,escape),document.cookie=[T,"=",y,E.expires?"; expires="+E.expires.toUTCString():"",E.path?"; path="+E.path:"",E.domain?"; domain="+E.domain:"",E.secure?"; secure":""].join("")}T||(A={});for(var n=document.cookie?document.cookie.split("; "):[],e=/(%[0-9A-Z]{2})+/g,t=0;t<n.length;t++){var a=n[t].split("="),h=a.slice(1).join("=");h.charAt(0)==='"'&&(h=h.slice(1,-1));try{var l=a[0].replace(e,decodeURIComponent);if(h=D.read?D.read(h,l):D(h,l)||h.replace(e,decodeURIComponent),this.json)try{h=JSON.parse(h)}catch{}if(T===l){A=h;break}T||(A[l]=h)}catch{}}return A}}return c.set=c,c.get=function(T){return c.call(c,T)},c.getJSON=function(){return c.apply({json:!0},[].slice.call(arguments))},c.defaults={},c.remove=function(T,y){c(T,"",I(y,{expires:-1}))},c.withConverter=M,c}var I=function(){for(var D=0,c={};D<arguments.length;D++){var T=arguments[D];for(var y in T)c[y]=T[y]}return c};return M(function(){})})},function(O,s,R){"use strict";function _(b,P){return b=b||"",P=P||"litix.io",b.match(/^[a-z0-9]+$/)?"https://"+b+"."+P:"https://img.litix.io/a.gif"}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_},function(O,s,R){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var _=R(0),b=function(I){return I&&I.__esModule?I:{default:I}}(_),P=function(){var I=void 0;switch(M()){case"cellular":I="cellular";break;case"ethernet":I="wired";break;case"wifi":I="wifi";break;case void 0:break;default:I="other"}return I},M=function(){var I=b.default.navigator,D=I&&(I.connection||I.mozConnection||I.webkitConnection);return D&&D.type};s.default=P},function(O,s,R){"use strict";function _(h){return h&&h.__esModule?h:{default:h}}Object.defineProperty(s,"__esModule",{value:!0});var b=R(0),P=_(b),M=R(4),I=_(M),D=R(43),c=_(D),T=R(2),y=_(T),E=R(14),A=_(E),S=R(1),n=_(S),e=!!P.default.XMLHttpRequest&&"withCredentials"in new P.default.XMLHttpRequest,t={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},a=function(h,l){this._beaconUrl=h||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,y.default)({},t,l)};a.prototype.queueEvent=function(h,l){var f=(0,y.default)({},l);return e?(this._eventQueue.length<=this._options.maxQueueLength||h==="eventrateexceeded")&&(this._eventQueue.push(f),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(c.default.send(this._beaconUrl,f),!0)},a.prototype.flushEvents=function(){e&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},a.prototype.destroy=function(){var h=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,h?this._clearBeaconQueue():this.flushEvents(),P.default.clearTimeout(this._sendTimeout)},a.prototype._clearBeaconQueue=function(){var h=P.default.navigator,l=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,f=this._eventQueue.slice(l);l>0&&(0,y.default)(f[f.length-1],(0,A.default)({mux_view_message:"event queue truncated"}));var p=this._createPayload(f);if(h.sendBeacon)h.sendBeacon(this._beaconUrl,p);else if(P.default.XMLHttpRequest){var m=new P.default.XMLHttpRequest;m.open("POST",this._beaconUrl),m.setRequestHeader("Content-Type","application/json"),m.send(p)}else c.default.send(this._beaconUrl,f[f.length-1])},a.prototype._sendBeaconQueue=function(){var h=this;if(P.default.XMLHttpRequest&&!this._postInFlight){var l=new P.default.XMLHttpRequest,f=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,l.onreadystatechange=function(){l.readyState===4&&(l.status!==200?(h._eventQueue=f.concat(h._eventQueue),h._failureCount+=1,I.default.info("Error sending beacon: "+l.status),I.default.info(l.responseText)):h._failureCount=0,h._roundTripTime=n.default.now()-m,h._postInFlight=!1)},l.open("POST",this._beaconUrl),l.setRequestHeader("Content-Type","application/json");var p=this._createPayload(f),m=n.default.now();l.send(p)}},a.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var h=Math.pow(2,this._failureCount-1);return(1+(h*=Math.random()))*this._options.baseTimeBetweenBeacons},a.prototype._startBeaconSending=function(){var h=this;P.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=P.default.setTimeout(function(){h._eventQueue.length&&h._sendBeaconQueue(),h._startBeaconSending()},this._getNextBeaconTime()))},a.prototype._createPayload=function(h){var l={transmission_timestamp:Math.round(n.default.now())};return this._roundTripTime&&(l.rtt_ms=Math.round(this._roundTripTime)),JSON.stringify({metadata:l,events:h})},s.default=a},function(O,s,R){"use strict";function _(c){return c&&c.__esModule?c:{default:c}}Object.defineProperty(s,"__esModule",{value:!0});var b=R(11),P=_(b),M=R(0),I=_(M),D={};D.send=function(c,T){function y(){E.src=S+(A?"&rc="+A:"")}var E=new Image,A=0,S=c+"?"+P.default.stringify(T);return E.addEventListener("error",function(){A>3||I.default.setTimeout(function(){A++,y()},5e3*A)}),y(),E},s.default=D},function(O,s,R){"use strict";function _(){function b(S,n){var e=n.request_start,t=n.request_response_start,a=n.request_response_end,h=n.request_bytes_loaded;T++;var l=void 0,f=void 0;if(t?(l=t-e,f=a-t):f=a-e,f>0&&h>0){var p=h/f*8e3;y++,D+=h,c+=f,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,p),this.data.view_average_request_throughput=D/c*8e3,this.data.view_request_count=T,l>0&&(I+=l,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,l),this.data.view_average_request_latency=I/y)}}function P(S,n){T++,E++,this.data.view_request_count=T,this.data.view_request_failed_count=E}function M(S,n){T++,A++,this.data.view_request_count=T,this.data.view_request_canceled_count=A}var I=0,D=0,c=0,T=0,y=0,E=0,A=0;this.on("requestcompleted",b),this.on("requestfailed",P),this.on("requestcanceled",M)}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_},function(O,s,R){"use strict";function _(y,E,A){var S=(0,D.findMediaElement)(E),n=P(S,3),e=n[0],t=n[1],a=n[2],h=y.log,l=y.utils.getComputedStyle,f=y.utils.secondsToMs,p={automaticErrorTracking:!0};if(!e)return h.error("No element was found with the `"+t+"` query selector.");if(a!=="video"&&a!=="audio")return h.error("The element of `"+t+"` was not a media element.");A=(0,I.default)(p,A),A.data=(0,I.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.3.0"},A.data),A.getPlayheadTime=function(){return f(e.currentTime)},A.getStateData=function(){var d=this.hlsjs&&this.hlsjs.url,u=this.dashjs&&b(this.dashjs.getSource==="function")&&this.dashjs.getSource();return{player_is_paused:e.paused,player_playhead_time:f(e.currentTime),player_width:parseInt(l(e,"width")),player_height:parseInt(l(e,"height")),player_autoplay_on:e.autoplay,player_preload_on:e.preload,video_poster_url:e.poster,video_source_url:d||u||e.currentSrc,video_source_duration:f(e.duration),video_source_height:e.videoHeight,video_source_width:e.videoWidth}},e.mux=e.mux||{},e.mux.deleted=!1,e.mux.emit=function(d,u){y.emit(t,d,u)};var m=function(){h.error("The monitor for this video element has already been destroyed.")};e.mux.destroy=function(){Object.keys(e.mux.listeners).forEach(function(d){e.removeEventListener(d,e.mux.listeners[d],!1)}),delete e.mux.listeners,e.mux.destroy=m,e.mux.swapElement=m,e.mux.emit=m,e.mux.addHLSJS=m,e.mux.addDashJS=m,e.mux.removeHLSJS=m,e.mux.removeDashJS=m,e.mux.deleted=!0,y.emit(t,"destroy")},e.mux.swapElement=function(d){var u=(0,D.findMediaElement)(d),r=P(u,3),i=r[0],v=r[1],g=r[2];return i?g!=="video"&&g!=="audio"?y.log.error("The element of `"+v+"` was not a media element."):(i.muxId=e.muxId,delete e.muxId,i.mux=i.mux||{},i.mux.listeners=(0,I.default)({},e.mux.listeners),delete e.mux.listeners,Object.keys(i.mux.listeners).forEach(function(L){e.removeEventListener(L,i.mux.listeners[L],!1),i.addEventListener(L,i.mux.listeners[L],!1)}),i.mux.swapElement=e.mux.swapElement,i.mux.destroy=e.mux.destroy,delete e.mux,void(e=i)):y.log.error("No element was found with the `"+v+"` query selector.")},e.mux.addHLSJS=function(d){y.addHLSJS(t,d)},e.mux.addDashJS=function(d){y.addDashJS(t,d)},e.mux.removeHLSJS=function(){y.removeHLSJS(t)},e.mux.removeDashJS=function(){y.removeDashJS(t)},y.init(t,A),y.emit(t,"playerready"),e.paused||(y.emit(t,"play"),e.readyState>2&&y.emit(t,"playing")),e.mux.listeners={},c.forEach(function(d){(d!=="error"||A.automaticErrorTracking)&&(e.mux.listeners[d]=function(){var u={};if(d==="error"){if(!e.error)return;u.player_error_code=e.error.code,u.player_error_message=T[e.error.code]||e.error.message}y.emit(t,d,u)},e.addEventListener(d,e.mux.listeners[d],!1))})}Object.defineProperty(s,"__esModule",{value:!0});var b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(y){return typeof y}:function(y){return y&&typeof Symbol=="function"&&y.constructor===Symbol&&y!==Symbol.prototype?"symbol":typeof y},P=function(){function y(E,A){var S=[],n=!0,e=!1,t=void 0;try{for(var a,h=E[Symbol.iterator]();!(n=(a=h.next()).done)&&(S.push(a.value),!A||S.length!==A);n=!0);}catch(l){e=!0,t=l}finally{try{!n&&h.return&&h.return()}finally{if(e)throw t}}return S}return function(E,A){if(Array.isArray(E))return E;if(Symbol.iterator in Object(E))return y(E,A);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();s.default=_;var M=R(2),I=function(y){return y&&y.__esModule?y:{default:y}}(M),D=R(8),c=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],T={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(O,s,R){"use strict";function _(l){return l&&l.__esModule?l:{default:l}}Object.defineProperty(s,"__esModule",{value:!0});var b=R(47),P=_(b),M=R(3),I=_(M),D=R(48),c=_(D),T=R(49),y=_(T),E=R(2),A=_(E),S=R(7),n=_(S),e=R(5),t=R(1),a=_(t),h={};h.safeCall=P.default,h.safeIncrement=I.default,h.getComputedStyle=c.default,h.secondsToMs=y.default,h.assign=A.default,h.headersStringToObject=n.default,h.extractHostnameAndDomain=e.extractHostnameAndDomain,h.extractHostname=e.extractHostname,h.now=a.default.now,s.default=h},function(O,s,R){"use strict";function _(M,I,D,c){var T=c;if(M&&typeof M[I]=="function")try{T=M[I].apply(M,D)}catch(y){P.default.info("safeCall error",y)}return T}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_;var b=R(4),P=function(M){return M&&M.__esModule?M:{default:M}}(b)},function(O,s,R){"use strict";function _(I,D){if(I&&D&&P.default&&typeof P.default.getComputedStyle=="function"){var c=void 0;return M&&M.has(I)&&(c=M.get(I)),c||(c=P.default.getComputedStyle(I,null),M&&M.set(I,c)),c.getPropertyValue(D)}}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_;var b=R(0),P=function(I){return I&&I.__esModule?I:{default:I}}(b),M=void 0;P.default&&P.default.WeakMap&&(M=new WeakMap)},function(O,s,R){"use strict";function _(b){return Math.floor(1e3*b)}Object.defineProperty(s,"__esModule",{value:!0}),s.default=_}])})})()}}),Xn=ft({"../../node_modules/hls.js/dist/hls.js"(o,w){typeof window!="undefined"&&function(O,s){typeof o=="object"&&typeof w=="object"?w.exports=s():typeof define=="function"&&define.amd?define([],s):typeof o=="object"?o.Hls=s():O.Hls=s()}(o,function(){return function(x){var O={};function s(R){if(O[R])return O[R].exports;var _=O[R]={i:R,l:!1,exports:{}};return x[R].call(_.exports,_,_.exports,s),_.l=!0,_.exports}return s.m=x,s.c=O,s.d=function(R,_,b){s.o(R,_)||Object.defineProperty(R,_,{enumerable:!0,get:b})},s.r=function(R){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(R,"__esModule",{value:!0})},s.t=function(R,_){if(_&1&&(R=s(R)),_&8||_&4&&typeof R=="object"&&R&&R.__esModule)return R;var b=Object.create(null);if(s.r(b),Object.defineProperty(b,"default",{enumerable:!0,value:R}),_&2&&typeof R!="string")for(var P in R)s.d(b,P,function(M){return R[M]}.bind(null,P));return b},s.n=function(R){var _=R&&R.__esModule?function(){return R.default}:function(){return R};return s.d(_,"a",_),_},s.o=function(R,_){return Object.prototype.hasOwnProperty.call(R,_)},s.p="/dist/",s(s.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(x,O,s){"use strict";var R=Object.prototype.hasOwnProperty,_="~";function b(){}Object.create&&(b.prototype=Object.create(null),new b().__proto__||(_=!1));function P(c,T,y){this.fn=c,this.context=T,this.once=y||!1}function M(c,T,y,E,A){if(typeof y!="function")throw new TypeError("The listener must be a function");var S=new P(y,E||c,A),n=_?_+T:T;return c._events[n]?c._events[n].fn?c._events[n]=[c._events[n],S]:c._events[n].push(S):(c._events[n]=S,c._eventsCount++),c}function I(c,T){--c._eventsCount==0?c._events=new b:delete c._events[T]}function D(){this._events=new b,this._eventsCount=0}D.prototype.eventNames=function(){var T=[],y,E;if(this._eventsCount===0)return T;for(E in y=this._events)R.call(y,E)&&T.push(_?E.slice(1):E);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(y)):T},D.prototype.listeners=function(T){var y=_?_+T:T,E=this._events[y];if(!E)return[];if(E.fn)return[E.fn];for(var A=0,S=E.length,n=new Array(S);A<S;A++)n[A]=E[A].fn;return n},D.prototype.listenerCount=function(T){var y=_?_+T:T,E=this._events[y];return E?E.fn?1:E.length:0},D.prototype.emit=function(T,y,E,A,S,n){var e=_?_+T:T;if(!this._events[e])return!1;var t=this._events[e],a=arguments.length,h,l;if(t.fn){switch(t.once&&this.removeListener(T,t.fn,void 0,!0),a){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,y),!0;case 3:return t.fn.call(t.context,y,E),!0;case 4:return t.fn.call(t.context,y,E,A),!0;case 5:return t.fn.call(t.context,y,E,A,S),!0;case 6:return t.fn.call(t.context,y,E,A,S,n),!0}for(l=1,h=new Array(a-1);l<a;l++)h[l-1]=arguments[l];t.fn.apply(t.context,h)}else{var f=t.length,p;for(l=0;l<f;l++)switch(t[l].once&&this.removeListener(T,t[l].fn,void 0,!0),a){case 1:t[l].fn.call(t[l].context);break;case 2:t[l].fn.call(t[l].context,y);break;case 3:t[l].fn.call(t[l].context,y,E);break;case 4:t[l].fn.call(t[l].context,y,E,A);break;default:if(!h)for(p=1,h=new Array(a-1);p<a;p++)h[p-1]=arguments[p];t[l].fn.apply(t[l].context,h)}}return!0},D.prototype.on=function(T,y,E){return M(this,T,y,E,!1)},D.prototype.once=function(T,y,E){return M(this,T,y,E,!0)},D.prototype.removeListener=function(T,y,E,A){var S=_?_+T:T;if(!this._events[S])return this;if(!y)return I(this,S),this;var n=this._events[S];if(n.fn)n.fn===y&&(!A||n.once)&&(!E||n.context===E)&&I(this,S);else{for(var e=0,t=[],a=n.length;e<a;e++)(n[e].fn!==y||A&&!n[e].once||E&&n[e].context!==E)&&t.push(n[e]);t.length?this._events[S]=t.length===1?t[0]:t:I(this,S)}return this},D.prototype.removeAllListeners=function(T){var y;return T?(y=_?_+T:T,this._events[y]&&I(this,y)):(this._events=new b,this._eventsCount=0),this},D.prototype.off=D.prototype.removeListener,D.prototype.addListener=D.prototype.on,D.prefixed=_,D.EventEmitter=D,x.exports=D},"./node_modules/url-toolkit/src/url-toolkit.js":function(x,O,s){(function(R){var _=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,b=/^([^\/?#]*)([^]*)$/,P=/(?:\/|^)\.(?=\/)/g,M=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,I={buildAbsoluteURL:function(D,c,T){if(T=T||{},D=D.trim(),c=c.trim(),!c){if(!T.alwaysNormalize)return D;var y=I.parseURL(D);if(!y)throw new Error("Error trying to parse base URL.");return y.path=I.normalizePath(y.path),I.buildURLFromParts(y)}var E=I.parseURL(c);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return T.alwaysNormalize?(E.path=I.normalizePath(E.path),I.buildURLFromParts(E)):c;var A=I.parseURL(D);if(!A)throw new Error("Error trying to parse base URL.");if(!A.netLoc&&A.path&&A.path[0]!=="/"){var S=b.exec(A.path);A.netLoc=S[1],A.path=S[2]}A.netLoc&&!A.path&&(A.path="/");var n={scheme:A.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(n.netLoc=A.netLoc,E.path[0]!=="/"))if(!E.path)n.path=A.path,E.params||(n.params=A.params,E.query||(n.query=A.query));else{var e=A.path,t=e.substring(0,e.lastIndexOf("/")+1)+E.path;n.path=I.normalizePath(t)}return n.path===null&&(n.path=T.alwaysNormalize?I.normalizePath(E.path):E.path),I.buildURLFromParts(n)},parseURL:function(D){var c=_.exec(D);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(D){for(D=D.split("").reverse().join("").replace(P,"");D.length!==(D=D.replace(M,"")).length;);return D.split("").reverse().join("")},buildURLFromParts:function(D){return D.scheme+D.netLoc+D.path+D.params+D.query+D.fragment}};x.exports=I})(this)},"./node_modules/webworkify-webpack/index.js":function(x,O,s){function R(T){var y={};function E(S){if(y[S])return y[S].exports;var n=y[S]={i:S,l:!1,exports:{}};return T[S].call(n.exports,n,n.exports,E),n.l=!0,n.exports}E.m=T,E.c=y,E.i=function(S){return S},E.d=function(S,n,e){E.o(S,n)||Object.defineProperty(S,n,{configurable:!1,enumerable:!0,get:e})},E.r=function(S){Object.defineProperty(S,"__esModule",{value:!0})},E.n=function(S){var n=S&&S.__esModule?function(){return S.default}:function(){return S};return E.d(n,"a",n),n},E.o=function(S,n){return Object.prototype.hasOwnProperty.call(S,n)},E.p="/",E.oe=function(S){throw console.error(S),S};var A=E(E.s=ENTRY_MODULE);return A.default||A}var _="[\\.|\\-|\\+|\\w|/|@]+",b="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+_+").*?\\)";function P(T){return(T+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function M(T){return!isNaN(1*T)}function I(T,y,E){var A={};A[E]=[];var S=y.toString(),n=S.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!n)return A;for(var e=n[1],t=new RegExp("(\\\\n|\\W)"+P(e)+b,"g"),a;a=t.exec(S);)a[3]!=="dll-reference"&&A[E].push(a[3]);for(t=new RegExp("\\("+P(e)+'\\("(dll-reference\\s('+_+'))"\\)\\)'+b,"g");a=t.exec(S);)T[a[2]]||(A[E].push(a[1]),T[a[2]]=s(a[1]).m),A[a[2]]=A[a[2]]||[],A[a[2]].push(a[4]);for(var h=Object.keys(A),l=0;l<h.length;l++)for(var f=0;f<A[h[l]].length;f++)M(A[h[l]][f])&&(A[h[l]][f]=1*A[h[l]][f]);return A}function D(T){var y=Object.keys(T);return y.reduce(function(E,A){return E||T[A].length>0},!1)}function c(T,y){for(var E={main:[y]},A={main:[]},S={main:{}};D(E);)for(var n=Object.keys(E),e=0;e<n.length;e++){var t=n[e],a=E[t],h=a.pop();if(S[t]=S[t]||{},!(S[t][h]||!T[t][h])){S[t][h]=!0,A[t]=A[t]||[],A[t].push(h);for(var l=I(T,T[t][h],t),f=Object.keys(l),p=0;p<f.length;p++)E[f[p]]=E[f[p]]||[],E[f[p]]=E[f[p]].concat(l[f[p]])}}return A}x.exports=function(T,y){y=y||{};var E={main:s.m},A=y.all?{main:Object.keys(E.main)}:c(E,T),S="";Object.keys(A).filter(function(h){return h!=="main"}).forEach(function(h){for(var l=0;A[h][l];)l++;A[h].push(l),E[h][l]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",S=S+"var "+h+" = ("+R.toString().replace("ENTRY_MODULE",JSON.stringify(l))+")({"+A[h].map(function(f){return""+JSON.stringify(f)+": "+E[h][f].toString()}).join(",")+`});
`}),S=S+"new (("+R.toString().replace("ENTRY_MODULE",JSON.stringify(T))+")({"+A.main.map(function(h){return""+JSON.stringify(h)+": "+E.main[h].toString()}).join(",")+"}))(self);";var n=new window.Blob([S],{type:"text/javascript"});if(y.bare)return n;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,t=e.createObjectURL(n),a=new window.Worker(t);return a.objectURL=t,a}},"./src/config.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"hlsDefaultConfig",function(){return f}),s.d(O,"mergeConfig",function(){return m}),s.d(O,"enableStreamingMode",function(){return d});var R=s("./src/controller/abr-controller.ts"),_=s("./src/controller/audio-stream-controller.ts"),b=s("./src/controller/audio-track-controller.ts"),P=s("./src/controller/subtitle-stream-controller.ts"),M=s("./src/controller/subtitle-track-controller.ts"),I=s("./src/controller/buffer-controller.ts"),D=s("./src/controller/timeline-controller.ts"),c=s("./src/controller/cap-level-controller.ts"),T=s("./src/controller/fps-controller.ts"),y=s("./src/controller/eme-controller.ts"),E=s("./src/utils/xhr-loader.ts"),A=s("./src/utils/fetch-loader.ts"),S=s("./src/utils/cues.ts"),n=s("./src/utils/mediakeys-helper.ts"),e=s("./src/utils/logger.ts");function t(){return t=Object.assign||function(u){for(var r=1;r<arguments.length;r++){var i=arguments[r];for(var v in i)Object.prototype.hasOwnProperty.call(i,v)&&(u[v]=i[v])}return u},t.apply(this,arguments)}function a(u,r){var i=Object.keys(u);if(Object.getOwnPropertySymbols){var v=Object.getOwnPropertySymbols(u);r&&(v=v.filter(function(g){return Object.getOwnPropertyDescriptor(u,g).enumerable})),i.push.apply(i,v)}return i}function h(u){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?a(Object(i),!0).forEach(function(v){l(u,v,i[v])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach(function(v){Object.defineProperty(u,v,Object.getOwnPropertyDescriptor(i,v))})}return u}function l(u,r,i){return r in u?Object.defineProperty(u,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):u[r]=i,u}var f=h(h({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:E.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:R.default,bufferController:I.default,capLevelController:c.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:n.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},p()),{},{subtitleStreamController:P.SubtitleStreamController,subtitleTrackController:M.default,timelineController:D.TimelineController,audioStreamController:_.default,audioTrackController:b.default,emeController:y.default});function p(){return{cueHandler:S.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function m(u,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return t({},u,r)}function d(u){var r=u.loader;if(r!==A.default&&r!==E.default)e.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),u.progressive=!1;else{var i=Object(A.fetchSupported)();i&&(u.loader=A.default,u.progressive=!0,u.enableSoftwareAES=!0,e.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/polyfills/number.ts"),_=s("./src/utils/ewma-bandwidth-estimator.ts"),b=s("./src/events.ts"),P=s("./src/utils/buffer-helper.ts"),M=s("./src/errors.ts"),I=s("./src/types/loader.ts"),D=s("./src/utils/logger.ts");function c(E,A){for(var S=0;S<A.length;S++){var n=A[S];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(E,n.key,n)}}function T(E,A,S){return A&&c(E.prototype,A),S&&c(E,S),E}var y=function(){function E(S){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=S;var n=S.config;this.bwEstimator=new _.default(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var A=E.prototype;return A.registerListeners=function(){var n=this.hls;n.on(b.Events.FRAG_LOADING,this.onFragLoading,this),n.on(b.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(b.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){var n=this.hls;n.off(b.Events.FRAG_LOADING,this.onFragLoading,this),n.off(b.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),n.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(b.Events.ERROR,this.onError,this)},A.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},A.onFragLoading=function(n,e){var t=e.frag;if(t.type===I.PlaylistLevelType.MAIN&&!this.timer){var a;this.fragCurrent=t,this.partCurrent=(a=e.part)!=null?a:null,this.timer=self.setInterval(this.onCheck,100)}},A.onLevelLoaded=function(n,e){var t=this.hls.config;e.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},A._abandonRulesCheck=function(){var n=this.fragCurrent,e=this.partCurrent,t=this.hls,a=t.autoLevelEnabled,h=t.config,l=t.media;if(!(!n||!l)){var f=e?e.stats:n.stats,p=e?e.duration:n.duration;if(f.aborted){D.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!a||l.paused||!l.playbackRate||!l.readyState)){var m=performance.now()-f.loading.start,d=Math.abs(l.playbackRate);if(!(m<=500*p/d)){var u=t.levels,r=t.minAutoLevel,i=u[n.level],v=f.total||Math.max(f.loaded,Math.round(p*i.maxBitrate/8)),g=Math.max(1,f.bwEstimate?f.bwEstimate/8:f.loaded*1e3/m),L=(v-f.loaded)/g,C=l.currentTime,k=(P.BufferHelper.bufferInfo(l,C,h.maxBufferHole).end-C)/d;if(!(k>=2*p/d||L<=k)){var U=Number.POSITIVE_INFINITY,F;for(F=n.level-1;F>r;F--){var B=u[F].maxBitrate;if(U=p*B/(8*.8*g),U<k)break}if(!(U>=L)){var N=this.bwEstimator.getEstimate();D.logger.warn("Fragment "+n.sn+(e?" part "+e.index:"")+" of level "+n.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+(Object(R.isFiniteNumber)(N)?(N/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+L.toFixed(3)+` s
      Estimated load time for the next fragment: `+U.toFixed(3)+` s
      Time to underbuffer: `+k.toFixed(3)+" s"),t.nextLoadLevel=F,this.bwEstimator.sample(m,f.loaded),this.clearTimer(),n.loader&&(this.fragCurrent=this.partCurrent=null,n.loader.abort()),t.trigger(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,part:e,stats:f})}}}}}},A.onFragLoaded=function(n,e){var t=e.frag,a=e.part;if(t.type===I.PlaylistLevelType.MAIN&&Object(R.isFiniteNumber)(t.sn)){var h=a?a.stats:t.stats,l=a?a.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var f=this.hls.levels[t.level],p=(f.loaded?f.loaded.bytes:0)+h.loaded,m=(f.loaded?f.loaded.duration:0)+l;f.loaded={bytes:p,duration:m},f.realBitrate=Math.round(8*p/m)}if(t.bitrateTest){var d={stats:h,frag:t,part:a,id:t.type};this.onFragBuffered(b.Events.FRAG_BUFFERED,d),t.bitrateTest=!1}}},A.onFragBuffered=function(n,e){var t=e.frag,a=e.part,h=a?a.stats:t.stats;if(!h.aborted&&!(t.type!==I.PlaylistLevelType.MAIN||t.sn==="initSegment")){var l=h.parsing.end-h.loading.start;this.bwEstimator.sample(l,h.loaded),h.bwEstimate=this.bwEstimator.getEstimate(),t.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}},A.onError=function(n,e){switch(e.details){case M.ErrorDetails.FRAG_LOAD_ERROR:case M.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},A.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},A.getNextABRAutoLevel=function(){var n=this.fragCurrent,e=this.partCurrent,t=this.hls,a=t.maxAutoLevel,h=t.config,l=t.minAutoLevel,f=t.media,p=e?e.duration:n?n.duration:0,m=f?f.currentTime:0,d=f&&f.playbackRate!==0?Math.abs(f.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():h.abrEwmaDefaultEstimate,r=(P.BufferHelper.bufferInfo(f,m,h.maxBufferHole).end-m)/d,i=this.findBestLevel(u,l,a,r,h.abrBandWidthFactor,h.abrBandWidthUpFactor);if(i>=0)return i;D.logger.trace((r?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var v=p?Math.min(p,h.maxStarvationDelay):h.maxStarvationDelay,g=h.abrBandWidthFactor,L=h.abrBandWidthUpFactor;if(!r){var C=this.bitrateTestDelay;if(C){var k=p?Math.min(p,h.maxLoadingDelay):h.maxLoadingDelay;v=k-C,D.logger.trace("bitrate test took "+Math.round(1e3*C)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*v)+" ms"),g=L=1}}return i=this.findBestLevel(u,l,a,r+v,g,L),Math.max(i,0)},A.findBestLevel=function(n,e,t,a,h,l){for(var f,p=this.fragCurrent,m=this.partCurrent,d=this.lastLoadedFragLevel,u=this.hls.levels,r=u[d],i=!!(r!=null&&(f=r.details)!==null&&f!==void 0&&f.live),v=r==null?void 0:r.codecSet,g=m?m.duration:p?p.duration:0,L=t;L>=e;L--){var C=u[L];if(!(!C||v&&C.codecSet!==v)){var k=C.details,U=(m?k==null?void 0:k.partTarget:k==null?void 0:k.averagetargetduration)||g,F=void 0;L<=d?F=h*n:F=l*n;var B=u[L].maxBitrate,N=B*U/F;if(D.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+L+"/"+Math.round(F)+"/"+B+"/"+U+"/"+a+"/"+N),F>B&&(!N||i&&!this.bitrateTestDelay||N<a))return L}}return-1},T(E,[{key:"nextAutoLevel",get:function(){var n=this._nextAutoLevel,e=this.bwEstimator;if(n!==-1&&(!e||!e.canEstimate()))return n;var t=this.getNextABRAutoLevel();return n!==-1&&(t=Math.min(n,t)),t},set:function(n){this._nextAutoLevel=n}}]),E}();O.default=y},"./src/controller/audio-stream-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/polyfills/number.ts"),_=s("./src/controller/base-stream-controller.ts"),b=s("./src/events.ts"),P=s("./src/utils/buffer-helper.ts"),M=s("./src/controller/fragment-tracker.ts"),I=s("./src/types/level.ts"),D=s("./src/types/loader.ts"),c=s("./src/loader/fragment.ts"),T=s("./src/demux/chunk-cache.ts"),y=s("./src/demux/transmuxer-interface.ts"),E=s("./src/types/transmuxer.ts"),A=s("./src/controller/fragment-finders.ts"),S=s("./src/utils/discontinuities.ts"),n=s("./src/errors.ts"),e=s("./src/utils/logger.ts");function t(){return t=Object.assign||function(p){for(var m=1;m<arguments.length;m++){var d=arguments[m];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(p[u]=d[u])}return p},t.apply(this,arguments)}function a(p,m){p.prototype=Object.create(m.prototype),p.prototype.constructor=p,h(p,m)}function h(p,m){return h=Object.setPrototypeOf||function(u,r){return u.__proto__=r,u},h(p,m)}var l=100,f=function(p){a(m,p);function m(u,r){var i;return i=p.call(this,u,r,"[audio-stream-controller]")||this,i.videoBuffer=null,i.videoTrackCC=-1,i.waitingVideoCC=-1,i.audioSwitch=!1,i.trackId=-1,i.waitingData=null,i.mainDetails=null,i.bufferFlushed=!1,i._registerListeners(),i}var d=m.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var r=this.hls;r.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.on(b.Events.ERROR,this.onError,this),r.on(b.Events.BUFFER_RESET,this.onBufferReset,this),r.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),r.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.on(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d._unregisterListeners=function(){var r=this.hls;r.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(b.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),r.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),r.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),r.off(b.Events.ERROR,this.onError,this),r.off(b.Events.BUFFER_RESET,this.onBufferReset,this),r.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),r.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),r.off(b.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},d.onInitPtsFound=function(r,i){var v=i.frag,g=i.id,L=i.initPTS;if(g==="main"){var C=v.cc;this.initPTS[v.cc]=L,this.log("InitPTS for cc: "+C+" found from main: "+L),this.videoTrackCC=C,this.state===_.State.WAITING_INIT_PTS&&this.tick()}},d.startLoad=function(r){if(!this.levels){this.startPosition=r,this.state=_.State.STOPPED;return}var i=this.lastCurrentTime;this.stopLoad(),this.setInterval(l),this.fragLoadError=0,i>0&&r===-1?(this.log("Override startPosition with lastCurrentTime @"+i.toFixed(3)),this.state=_.State.IDLE):(this.loadedmetadata=!1,this.state=_.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},d.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_TRACK:{var r,i=this.levels,v=this.trackId,g=i==null||(r=i[v])===null||r===void 0?void 0:r.details;if(g){if(this.waitForCdnTuneIn(g))break;this.state=_.State.WAITING_INIT_PTS}break}case _.State.FRAG_LOADING_WAITING_RETRY:{var L,C=performance.now(),k=this.retryDate;(!k||C>=k||(L=this.media)!==null&&L!==void 0&&L.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=_.State.IDLE);break}case _.State.WAITING_INIT_PTS:{var U=this.waitingData;if(U){var F=U.frag,B=U.part,N=U.cache,K=U.complete;if(this.initPTS[F.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=_.State.FRAG_LOADING;var H=N.flush(),j={frag:F,part:B,payload:H,networkDetails:null};this._handleFragmentLoadProgress(j),K&&p.prototype._handleFragmentLoadComplete.call(this,j)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+F.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var W=this.getLoadPosition(),V=P.BufferHelper.bufferInfo(this.mediaBuffer,W,this.config.maxBufferHole),$=Object(A.fragmentWithinToleranceTest)(V.end,this.config.maxFragLookUpTolerance,F);$<0&&(e.logger.log("Waiting fragment cc ("+F.cc+") @ "+F.start+" cancelled because another fragment at "+V.end+" is needed"),this.clearWaitingFragment())}}else this.state=_.State.IDLE}}this.onTickEnd()},d.clearWaitingFragment=function(){var r=this.waitingData;r&&(this.fragmentTracker.removeFragment(r.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=_.State.IDLE)},d.onTickEnd=function(){var r=this.media;if(!(!r||!r.readyState)){var i=this.mediaBuffer?this.mediaBuffer:r,v=i.buffered;!this.loadedmetadata&&v.length&&(this.loadedmetadata=!0),this.lastCurrentTime=r.currentTime}},d.doTickIdle=function(){var r,i,v=this.hls,g=this.levels,L=this.media,C=this.trackId,k=v.config;if(!(!g||!g[C])&&!(!L&&(this.startFragRequested||!k.startFragPrefetch))){var U=g[C],F=U.details;if(!F||F.live&&this.levelLastLoaded!==C||this.waitForCdnTuneIn(F)){this.state=_.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,c.ElementaryStreamTypes.AUDIO,D.PlaylistLevelType.AUDIO));var B=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,D.PlaylistLevelType.AUDIO);if(B!==null){var N=B.len,K=this.getMaxBufferLength(),H=this.audioSwitch;if(!(N>=K&&!H)){if(!H&&this._streamEnded(B,F)){v.trigger(b.Events.BUFFER_EOS,{type:"audio"}),this.state=_.State.ENDED;return}var j=F.fragments,W=j[0].start,V=B.end;if(H){var $=this.getLoadPosition();V=$,F.PTSKnown&&$<W&&(B.end>W||B.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),L.currentTime=W+.05)}var Y=this.getNextFragment(V,F);if(!Y){this.bufferFlushed=!0;return}((r=Y.decryptdata)===null||r===void 0?void 0:r.keyFormat)==="identity"&&!((i=Y.decryptdata)!==null&&i!==void 0&&i.key)?this.loadKey(Y,F):this.loadFragment(Y,F,V)}}}},d.getMaxBufferLength=function(){var r=p.prototype.getMaxBufferLength.call(this),i=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,D.PlaylistLevelType.MAIN);return i===null?r:Math.max(r,i.len)},d.onMediaDetaching=function(){this.videoBuffer=null,p.prototype.onMediaDetaching.call(this)},d.onAudioTracksUpdated=function(r,i){var v=i.audioTracks;this.resetTransmuxer(),this.levels=v.map(function(g){return new I.Level(g)})},d.onAudioTrackSwitching=function(r,i){var v=!!i.url;this.trackId=i.id;var g=this.fragCurrent;g!=null&&g.loader&&g.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),v?this.setInterval(l):this.resetTransmuxer(),v?(this.audioSwitch=!0,this.state=_.State.IDLE):this.state=_.State.STOPPED,this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},d.onLevelLoaded=function(r,i){this.mainDetails=i.details},d.onAudioTrackLoaded=function(r,i){var v,g=this.levels,L=i.details,C=i.id;if(!g){this.warn("Audio tracks were reset while loading level "+C);return}this.log("Track "+C+" loaded ["+L.startSN+","+L.endSN+"],duration:"+L.totalduration);var k=g[C],U=0;if(L.live||(v=k.details)!==null&&v!==void 0&&v.live){var F=this.mainDetails;if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed||!F)return;!k.details&&L.hasProgramDateTime&&F.hasProgramDateTime?(Object(S.alignMediaPlaylistByPDT)(L,F),U=L.fragments[0].start):U=this.alignPlaylists(L,k.details)}k.details=L,this.levelLastLoaded=C,!this.startFragRequested&&(this.mainDetails||!L.live)&&this.setStartPosition(k.details,U),this.state===_.State.WAITING_TRACK&&!this.waitForCdnTuneIn(L)&&(this.state=_.State.IDLE),this.tick()},d._handleFragmentLoadProgress=function(r){var i,v=r.frag,g=r.part,L=r.payload,C=this.config,k=this.trackId,U=this.levels;if(!U){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+v.sn+" of level "+v.level+" will not be buffered");return}var F=U[k];console.assert(F,"Audio track is defined on fragment load progress");var B=F.details;console.assert(B,"Audio track details are defined on fragment load progress");var N=C.defaultAudioCodec||F.audioCodec||"mp4a.40.2",K=this.transmuxer;K||(K=this.transmuxer=new y.default(this.hls,D.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var H=this.initPTS[v.cc],j=(i=v.initSegment)===null||i===void 0?void 0:i.data;if(H!==void 0){var W=!1,V=g?g.index:-1,$=V!==-1,Y=new E.ChunkMetadata(v.level,v.sn,v.stats.chunkCount,L.byteLength,V,$);K.push(L,j,N,"",v,g,B.totalduration,W,Y,H)}else{e.logger.log("Unknown video PTS for cc "+v.cc+", waiting for video PTS before demuxing audio frag "+v.sn+" of ["+B.startSN+" ,"+B.endSN+"],track "+k);var Q=this.waitingData=this.waitingData||{frag:v,part:g,cache:new T.default,complete:!1},J=Q.cache;J.push(new Uint8Array(L)),this.waitingVideoCC=this.videoTrackCC,this.state=_.State.WAITING_INIT_PTS}},d._handleFragmentLoadComplete=function(r){if(this.waitingData){this.waitingData.complete=!0;return}p.prototype._handleFragmentLoadComplete.call(this,r)},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(r,i){var v=i.tracks.audio;v&&(this.mediaBuffer=v.buffer),i.tracks.video&&(this.videoBuffer=i.tracks.video.buffer)},d.onFragBuffered=function(r,i){var v=i.frag,g=i.part;if(v.type===D.PlaylistLevelType.AUDIO){if(this.fragContextChanged(v)){this.warn("Fragment "+v.sn+(g?" p: "+g.index:"")+" of level "+v.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}v.sn!=="initSegment"&&(this.fragPrevious=v,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(v,g)}},d.onError=function(r,i){switch(i.details){case n.ErrorDetails.FRAG_LOAD_ERROR:case n.ErrorDetails.FRAG_LOAD_TIMEOUT:case n.ErrorDetails.KEY_LOAD_ERROR:case n.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(D.PlaylistLevelType.AUDIO,i);break;case n.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case n.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==_.State.ERROR&&this.state!==_.State.STOPPED&&(this.state=i.fatal?_.State.ERROR:_.State.IDLE,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case n.ErrorDetails.BUFFER_FULL_ERROR:if(i.parent==="audio"&&(this.state===_.State.PARSING||this.state===_.State.PARSED)){var v=!0,g=this.getFwdBufferInfo(this.mediaBuffer,D.PlaylistLevelType.AUDIO);g&&g.len>.5&&(v=!this.reduceMaxBufferLength(g.len)),v&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,p.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},d.onBufferFlushed=function(r,i){var v=i.type;v===c.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},d._handleTransmuxComplete=function(r){var i,v="audio",g=this.hls,L=r.remuxResult,C=r.chunkMeta,k=this.getCurrentContext(C);if(!k){this.warn("The loading context changed while buffering fragment "+C.sn+" of level "+C.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(C.level);return}var U=k.frag,F=k.part,B=L.audio,N=L.text,K=L.id3,H=L.initSegment;if(!this.fragContextChanged(U)){if(this.state=_.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),H!=null&&H.tracks&&(this._bufferInitSegment(H.tracks,U,C),g.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:U,id:v,tracks:H.tracks})),B){var j=B.startPTS,W=B.endPTS,V=B.startDTS,$=B.endDTS;F&&(F.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:W,startDTS:V,endDTS:$}),U.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,j,W,V,$),this.bufferFragmentData(B,U,F,C)}if(K!=null&&(i=K.samples)!==null&&i!==void 0&&i.length){var Y=t({frag:U,id:v},K);g.trigger(b.Events.FRAG_PARSING_METADATA,Y)}if(N){var Q=t({frag:U,id:v},N);g.trigger(b.Events.FRAG_PARSING_USERDATA,Q)}}},d._bufferInitSegment=function(r,i,v){if(this.state===_.State.PARSING){r.video&&delete r.video;var g=r.audio;if(!!g){g.levelCodec=g.codec,g.id="audio",this.log("Init audio buffer, container:"+g.container+", codecs[parsed]=["+g.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,r);var L=g.initSegment;if(L!=null&&L.byteLength){var C={type:"audio",frag:i,part:null,chunkMeta:v,parent:i.type,data:L};this.hls.trigger(b.Events.BUFFER_APPENDING,C)}this.tick()}}},d.loadFragment=function(r,i,v){var g=this.fragmentTracker.getState(r);this.fragCurrent=r,(this.audioSwitch||g===M.FragmentState.NOT_LOADED||g===M.FragmentState.PARTIAL)&&(r.sn==="initSegment"?this._loadInitSegment(r):i.live&&!Object(R.isFiniteNumber)(this.initPTS[r.cc])?(this.log("Waiting for video PTS in continuity counter "+r.cc+" of live stream before loading audio fragment "+r.sn+" of level "+this.trackId),this.state=_.State.WAITING_INIT_PTS):(this.startFragRequested=!0,p.prototype.loadFragment.call(this,r,i,v)))},d.completeAudioSwitch=function(){var r=this.hls,i=this.media,v=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),p.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,r.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:v})},m}(_.default);O.default=f},"./src/controller/audio-track-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/events.ts"),_=s("./src/errors.ts"),b=s("./src/controller/base-playlist-controller.ts"),P=s("./src/types/loader.ts");function M(y,E){for(var A=0;A<E.length;A++){var S=E[A];S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(y,S.key,S)}}function I(y,E,A){return E&&M(y.prototype,E),A&&M(y,A),y}function D(y,E){y.prototype=Object.create(E.prototype),y.prototype.constructor=y,c(y,E)}function c(y,E){return c=Object.setPrototypeOf||function(S,n){return S.__proto__=n,S},c(y,E)}var T=function(y){D(E,y);function E(S){var n;return n=y.call(this,S,"[audio-track-controller]")||this,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}var A=E.prototype;return A.registerListeners=function(){var n=this.hls;n.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),n.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.on(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.on(R.Events.ERROR,this.onError,this)},A.unregisterListeners=function(){var n=this.hls;n.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),n.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),n.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),n.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),n.off(R.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),n.off(R.Events.ERROR,this.onError,this)},A.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,y.prototype.destroy.call(this)},A.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},A.onManifestParsed=function(n,e){this.tracks=e.audioTracks||[]},A.onAudioTrackLoaded=function(n,e){var t=e.id,a=e.details,h=this.tracksInGroup[t];if(!h){this.warn("Invalid audio track id "+t);return}var l=h.details;h.details=e.details,this.log("audioTrack "+t+" loaded ["+a.startSN+"-"+a.endSN+"]"),t===this.trackId&&(this.retryCount=0,this.playlistLoaded(t,e,l))},A.onLevelLoading=function(n,e){this.switchLevel(e.level)},A.onLevelSwitching=function(n,e){this.switchLevel(e.level)},A.switchLevel=function(n){var e=this.hls.levels[n];if(!!(e!=null&&e.audioGroupIds)){var t=e.audioGroupIds[e.urlId];if(this.groupId!==t){this.groupId=t;var a=this.tracks.filter(function(l){return!t||l.groupId===t});this.selectDefaultTrack&&!a.some(function(l){return l.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=a;var h={audioTracks:a};this.log("Updating audio tracks, "+a.length+' track(s) found in "'+t+'" group-id'),this.hls.trigger(R.Events.AUDIO_TRACKS_UPDATED,h),this.selectInitialTrack()}}},A.onError=function(n,e){y.prototype.onError.call(this,n,e),!(e.fatal||!e.context)&&e.context.type===P.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},A.setAudioTrack=function(n){var e=this.tracksInGroup;if(n<0||n>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var t=e[this.trackId];this.log("Now switching to audio-track index "+n);var a=e[n],h=a.id,l=a.groupId,f=l===void 0?"":l,p=a.name,m=a.type,d=a.url;if(this.trackId=n,this.trackName=p,this.selectDefaultTrack=!1,this.hls.trigger(R.Events.AUDIO_TRACK_SWITCHING,{id:h,groupId:f,name:p,type:m,url:d}),!(a.details&&!a.details.live)){var u=this.switchParams(a.url,t==null?void 0:t.details);this.loadPlaylist(u)}},A.selectInitialTrack=function(){var n=this.tracksInGroup;console.assert(n.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,t=this.findTrackId(e)||this.findTrackId();t!==-1?this.setAudioTrack(t):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},A.findTrackId=function(n){for(var e=this.tracksInGroup,t=0;t<e.length;t++){var a=e[t];if((!this.selectDefaultTrack||a.default)&&(!n||n===a.name))return a.id}return-1},A.loadPlaylist=function(n){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var t=e.id,a=e.groupId,h=e.url;if(n)try{h=n.addDirectives(h)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("loading audio-track playlist for id: "+t),this.clearTimer(),this.hls.trigger(R.Events.AUDIO_TRACK_LOADING,{url:h,id:t,groupId:a,deliveryDirectives:n||null})}},I(E,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(n){this.selectDefaultTrack=!1,this.setAudioTrack(n)}}]),E}(b.default);O.default=T},"./src/controller/base-playlist-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return I});var R=s("./src/polyfills/number.ts"),_=s("./src/types/level.ts"),b=s("./src/controller/level-helper.ts"),P=s("./src/utils/logger.ts"),M=s("./src/errors.ts"),I=function(){function D(T,y){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=P.logger.log.bind(P.logger,y+":"),this.warn=P.logger.warn.bind(P.logger,y+":"),this.hls=T}var c=D.prototype;return c.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},c.onError=function(y,E){E.fatal&&E.type===M.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},c.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},c.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},c.stopLoad=function(){this.canLoad=!1,this.clearTimer()},c.switchParams=function(y,E){var A=E==null?void 0:E.renditionReports;if(A)for(var S=0;S<A.length;S++){var n=A[S],e=""+n.URI;if(e===y.substr(-e.length)){var t=parseInt(n["LAST-MSN"]),a=parseInt(n["LAST-PART"]);if(E&&this.hls.config.lowLatencyMode){var h=Math.min(E.age-E.partTarget,E.targetduration);a!==void 0&&h>E.partTarget&&(a+=1)}if(Object(R.isFiniteNumber)(t))return new _.HlsUrlParameters(t,Object(R.isFiniteNumber)(a)?a:void 0,_.HlsSkip.No)}}},c.loadPlaylist=function(y){},c.shouldLoadTrack=function(y){return this.canLoad&&y&&!!y.url&&(!y.details||y.details.live)},c.playlistLoaded=function(y,E,A){var S=this,n=E.details,e=E.stats,t=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(n.advancedDateTime=Date.now()-t,n.live||A!=null&&A.live){if(n.reloaded(A),A&&this.log("live playlist "+y+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),A&&n.fragments.length>0&&Object(b.mergeDetails)(A,n),!this.canLoad||!n.live)return;var a,h=void 0,l=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var f=this.hls.config.lowLatencyMode,p=n.lastPartSn,m=n.endSN,d=n.lastPartIndex,u=d!==-1,r=p===m,i=f?0:d;u?(h=r?m+1:p,l=r?i:d+1):h=m+1;var v=n.age,g=v+n.ageHeader,L=Math.min(g-n.partTarget,n.targetduration*1.5);if(L>0){if(A&&L>A.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+A.tuneInGoal+" to: "+L+" with playlist age: "+n.age),L=0;else{var C=Math.floor(L/n.targetduration);if(h+=C,l!==void 0){var k=Math.round(L%n.targetduration/n.partTarget);l+=k}this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+v.toFixed(2)+"s goal: "+L+" skip sn "+C+" to part "+l)}n.tuneInGoal=L}if(a=this.getDeliveryDirectives(n,E.deliveryDirectives,h,l),f||!r){this.loadPlaylist(a);return}}else a=this.getDeliveryDirectives(n,E.deliveryDirectives,h,l);var U=Object(b.computeReloadInterval)(n,e);h!==void 0&&n.canBlockReload&&(U-=n.partTarget||1),this.log("reload live playlist "+y+" in "+Math.round(U)+" ms"),this.timer=self.setTimeout(function(){return S.loadPlaylist(a)},U)}else this.clearTimer()},c.getDeliveryDirectives=function(y,E,A,S){var n=Object(_.getSkipValue)(y,A);return E!=null&&E.skip&&y.deltaUpdateFailed&&(A=E.msn,S=E.part,n=_.HlsSkip.No),new _.HlsUrlParameters(A,S,n)},c.retryLoadingOrFail=function(y){var E=this,A=this.hls.config,S=this.retryCount<A.levelLoadingMaxRetry;if(S){var n;if(this.retryCount++,y.details.indexOf("LoadTimeOut")>-1&&(n=y.context)!==null&&n!==void 0&&n.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+y.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*A.levelLoadingRetryDelay,A.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+y.details+'"')}}else this.warn('cannot recover from error "'+y.details+'"'),this.clearTimer(),y.fatal=!0;return S},D}()},"./src/controller/base-stream-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"State",function(){return m}),s.d(O,"default",function(){return d});var R=s("./src/polyfills/number.ts"),_=s("./src/task-loop.ts"),b=s("./src/controller/fragment-tracker.ts"),P=s("./src/utils/buffer-helper.ts"),M=s("./src/utils/logger.ts"),I=s("./src/events.ts"),D=s("./src/errors.ts"),c=s("./src/types/transmuxer.ts"),T=s("./src/utils/mp4-tools.ts"),y=s("./src/utils/discontinuities.ts"),E=s("./src/controller/fragment-finders.ts"),A=s("./src/controller/level-helper.ts"),S=s("./src/loader/fragment-loader.ts"),n=s("./src/crypt/decrypter.ts"),e=s("./src/utils/time-ranges.ts"),t=s("./src/types/loader.ts");function a(u,r){for(var i=0;i<r.length;i++){var v=r[i];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(u,v.key,v)}}function h(u,r,i){return r&&a(u.prototype,r),i&&a(u,i),u}function l(u){if(u===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return u}function f(u,r){u.prototype=Object.create(r.prototype),u.prototype.constructor=u,p(u,r)}function p(u,r){return p=Object.setPrototypeOf||function(v,g){return v.__proto__=g,v},p(u,r)}var m={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},d=function(u){f(r,u);function r(v,g,L){var C;return C=u.call(this)||this,C.hls=void 0,C.fragPrevious=null,C.fragCurrent=null,C.fragmentTracker=void 0,C.transmuxer=null,C._state=m.STOPPED,C.media=void 0,C.mediaBuffer=void 0,C.config=void 0,C.bitrateTest=!1,C.lastCurrentTime=0,C.nextLoadPosition=0,C.startPosition=0,C.loadedmetadata=!1,C.fragLoadError=0,C.retryDate=0,C.levels=null,C.fragmentLoader=void 0,C.levelLastLoaded=null,C.startFragRequested=!1,C.decrypter=void 0,C.initPTS=[],C.onvseeking=null,C.onvended=null,C.logPrefix="",C.log=void 0,C.warn=void 0,C.logPrefix=L,C.log=M.logger.log.bind(M.logger,L+":"),C.warn=M.logger.warn.bind(M.logger,L+":"),C.hls=v,C.fragmentLoader=new S.default(v.config),C.fragmentTracker=g,C.config=v.config,C.decrypter=new n.default(v,v.config),v.on(I.Events.KEY_LOADED,C.onKeyLoaded,l(C)),C}var i=r.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(g){},i.stopLoad=function(){this.fragmentLoader.abort();var g=this.fragCurrent;g&&this.fragmentTracker.removeFragment(g),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=m.STOPPED},i._streamEnded=function(g,L){var C=this.fragCurrent,k=this.fragmentTracker;if(!L.live&&C&&C.sn===L.endSN&&!g.nextStart){var U=k.getState(C);return U===b.FragmentState.PARTIAL||U===b.FragmentState.OK}return!1},i.onMediaAttached=function(g,L){var C=this.media=this.mediaBuffer=L.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),C.addEventListener("seeking",this.onvseeking),C.addEventListener("ended",this.onvended);var k=this.config;this.levels&&k.autoStartLoad&&this.state===m.STOPPED&&this.startLoad(k.startPosition)},i.onMediaDetaching=function(){var g=this.media;g!=null&&g.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),g&&(g.removeEventListener("seeking",this.onvseeking),g.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var g=this.config,L=this.fragCurrent,C=this.media,k=this.mediaBuffer,U=this.state,F=C?C.currentTime:0,B=P.BufferHelper.bufferInfo(k||C,F,g.maxBufferHole);if(this.log("media seeking to "+(Object(R.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+U),U===m.ENDED)this.resetLoadingState();else if(L&&!B.len){var N=g.maxFragLookUpTolerance,K=L.start-N,H=L.start+L.duration+N,j=F>H;(F<K||j)&&(j&&L.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),L.loader.abort()),this.resetLoadingState())}C&&(this.lastCurrentTime=F),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onKeyLoaded=function(g,L){if(!(this.state!==m.KEY_LOADING||L.frag!==this.fragCurrent||!this.levels)){this.state=m.IDLE;var C=this.levels[L.frag.level].details;C&&this.loadFragment(L.frag,C,L.frag.start)}},i.onHandlerDestroying=function(){this.stopLoad(),u.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=m.STOPPED,this.hls.off(I.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,u.prototype.onHandlerDestroyed.call(this)},i.loadKey=function(g,L){this.log("Loading key for "+g.sn+" of ["+L.startSN+"-"+L.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+g.level),this.state=m.KEY_LOADING,this.fragCurrent=g,this.hls.trigger(I.Events.KEY_LOADING,{frag:g})},i.loadFragment=function(g,L,C){this._loadFragForPlayback(g,L,C)},i._loadFragForPlayback=function(g,L,C){var k=this,U=function(B){if(k.fragContextChanged(g)){k.warn("Fragment "+g.sn+(B.part?" p: "+B.part.index:"")+" of level "+g.level+" was dropped during download."),k.fragmentTracker.removeFragment(g);return}g.stats.chunkCount++,k._handleFragmentLoadProgress(B)};this._doFragLoad(g,L,C,U).then(function(F){if(!!F){k.fragLoadError=0;var B=k.state;if(k.fragContextChanged(g)){(B===m.FRAG_LOADING||B===m.BACKTRACKING||!k.fragCurrent&&B===m.PARSING)&&(k.fragmentTracker.removeFragment(g),k.state=m.IDLE);return}if("payload"in F&&(k.log("Loaded fragment "+g.sn+" of level "+g.level),k.hls.trigger(I.Events.FRAG_LOADED,F),k.state===m.BACKTRACKING)){k.fragmentTracker.backtrack(g,F),k.resetFragmentLoading(g);return}k._handleFragmentLoadComplete(F)}}).catch(function(F){k.warn(F),k.resetFragmentLoading(g)})},i.flushMainBuffer=function(g,L,C){if(C===void 0&&(C=null),!!(g-L)){var k={startOffset:g,endOffset:L,type:C};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,k)}},i._loadInitSegment=function(g){var L=this;this._doFragLoad(g).then(function(C){if(!C||L.fragContextChanged(g)||!L.levels)throw new Error("init load aborted");return C}).then(function(C){var k=L.hls,U=C.payload,F=g.decryptdata;if(U&&U.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var B=self.performance.now();return L.decrypter.webCryptoDecrypt(new Uint8Array(U),F.key.buffer,F.iv.buffer).then(function(N){var K=self.performance.now();return k.trigger(I.Events.FRAG_DECRYPTED,{frag:g,payload:N,stats:{tstart:B,tdecrypt:K}}),C.payload=N,C})}return C}).then(function(C){var k=L.fragCurrent,U=L.hls,F=L.levels;if(!F)throw new Error("init load aborted, missing levels");var B=F[g.level].details;console.assert(B,"Level details are defined when init segment is loaded");var N=g.stats;L.state=m.IDLE,L.fragLoadError=0,g.data=new Uint8Array(C.payload),N.parsing.start=N.buffering.start=self.performance.now(),N.parsing.end=N.buffering.end=self.performance.now(),C.frag===k&&U.trigger(I.Events.FRAG_BUFFERED,{stats:N,frag:k,part:null,id:g.type}),L.tick()}).catch(function(C){L.warn(C),L.resetFragmentLoading(g)})},i.fragContextChanged=function(g){var L=this.fragCurrent;return!g||!L||g.level!==L.level||g.sn!==L.sn||g.urlId!==L.urlId},i.fragBufferedComplete=function(g,L){var C=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+g.type+" sn: "+g.sn+(L?" part: "+L.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+g.level+" "+e.default.toString(P.BufferHelper.getBuffered(C))),this.state=m.IDLE,this.tick()},i._handleFragmentLoadComplete=function(g){var L=this.transmuxer;if(!!L){var C=g.frag,k=g.part,U=g.partsLoaded,F=!U||U.length===0||U.some(function(N){return!N}),B=new c.ChunkMetadata(C.level,C.sn,C.stats.chunkCount+1,0,k?k.index:-1,!F);L.flush(B)}},i._handleFragmentLoadProgress=function(g){},i._doFragLoad=function(g,L,C,k){var U=this;if(C===void 0&&(C=null),!this.levels)throw new Error("frag load aborted, missing levels");if(C=Math.max(g.start,C||0),this.config.lowLatencyMode&&L){var F=L.partList;if(F&&k){C>g.end&&L.fragmentHint&&(g=L.fragmentHint);var B=this.getNextPart(F,g,C);if(B>-1){var N=F[B];return this.log("Loading part sn: "+g.sn+" p: "+N.index+" cc: "+g.cc+" of playlist ["+L.startSN+"-"+L.endSN+"] parts [0-"+B+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+g.level+", target: "+parseFloat(C.toFixed(3))),this.nextLoadPosition=N.start+N.duration,this.state=m.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:g,part:F[B],targetBufferTime:C}),this.doFragPartsLoad(g,F,B,k).catch(function(K){return U.handleFragLoadError(K)})}else if(!g.url||this.loadedEndOfParts(F,C))return Promise.resolve(null)}}return this.log("Loading fragment "+g.sn+" cc: "+g.cc+" "+(L?"of ["+L.startSN+"-"+L.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+g.level+", target: "+parseFloat(C.toFixed(3))),Object(R.isFiniteNumber)(g.sn)&&!this.bitrateTest&&(this.nextLoadPosition=g.start+g.duration),this.state=m.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:g,targetBufferTime:C}),this.fragmentLoader.load(g,k).catch(function(K){return U.handleFragLoadError(K)})},i.doFragPartsLoad=function(g,L,C,k){var U=this;return new Promise(function(F,B){var N=[],K=function H(j){var W=L[j];U.fragmentLoader.loadPart(g,W,k).then(function(V){N[W.index]=V;var $=V.part;U.hls.trigger(I.Events.FRAG_LOADED,V);var Y=L[j+1];if(Y&&Y.fragment===g)H(j+1);else return F({frag:g,part:$,partsLoaded:N})}).catch(B)};K(C)})},i.handleFragLoadError=function(g){var L=g.data;return L&&L.details===D.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(L.frag,L.part):this.hls.trigger(I.Events.ERROR,L),null},i._handleTransmuxerFlush=function(g){var L=this.getCurrentContext(g);if(!L||this.state!==m.PARSING){this.fragCurrent||(this.state=m.IDLE);return}var C=L.frag,k=L.part,U=L.level,F=self.performance.now();C.stats.parsing.end=F,k&&(k.stats.parsing.end=F),this.updateLevelTiming(C,k,U,g.partial)},i.getCurrentContext=function(g){var L=this.levels,C=g.level,k=g.sn,U=g.part;if(!L||!L[C])return this.warn("Levels object was unset while buffering fragment "+k+" of level "+C+". The current chunk will not be buffered."),null;var F=L[C],B=U>-1?Object(A.getPartWith)(F,k,U):null,N=B?B.fragment:Object(A.getFragmentWithSN)(F,k,this.fragCurrent);return N?{frag:N,part:B,level:F}:null},i.bufferFragmentData=function(g,L,C,k){if(!(!g||this.state!==m.PARSING)){var U=g.data1,F=g.data2,B=U;if(U&&F&&(B=Object(T.appendUint8Array)(U,F)),!(!B||!B.length)){var N={type:g.type,frag:L,part:C,chunkMeta:k,parent:L.type,data:B};this.hls.trigger(I.Events.BUFFER_APPENDING,N),g.dropped&&g.independent&&!C&&this.flushBufferGap(L)}}},i.flushBufferGap=function(g){var L=this.media;if(!!L){if(!P.BufferHelper.isBuffered(L,L.currentTime)){this.flushMainBuffer(0,g.start);return}var C=L.currentTime,k=P.BufferHelper.bufferInfo(L,C,0),U=g.duration,F=Math.min(this.config.maxFragLookUpTolerance*2,U*.25),B=Math.max(Math.min(g.start-F,k.end-F),C+F);g.start-B>F&&this.flushMainBuffer(B,g.start)}},i.getFwdBufferInfo=function(g,L){var C=this.config,k=this.getLoadPosition();if(!Object(R.isFiniteNumber)(k))return null;var U=P.BufferHelper.bufferInfo(g,k,C.maxBufferHole);if(U.len===0&&U.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(k,L);if(F&&U.nextStart<F.end)return P.BufferHelper.bufferInfo(g,k,Math.max(U.nextStart,C.maxBufferHole))}return U},i.getMaxBufferLength=function(g){var L=this.config,C;return g?C=Math.max(8*L.maxBufferSize/g,L.maxBufferLength):C=L.maxBufferLength,Math.min(C,L.maxMaxBufferLength)},i.reduceMaxBufferLength=function(g){var L=this.config,C=g||L.maxBufferLength;return L.maxMaxBufferLength>=C?(L.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+L.maxMaxBufferLength+"s"),!0):!1},i.getNextFragment=function(g,L){var C,k,U=L.fragments,F=U.length;if(!F)return null;var B=this.config,N=U[0].start,K;if(L.live){var H=B.initialLiveManifestSize;if(F<H)return this.warn("Not enough fragments to start playback (have: "+F+", need: "+H+")"),null;!L.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(K=this.getInitialLiveFragment(L,U),this.startPosition=K?this.hls.liveSyncPosition||K.start:g)}else g<=N&&(K=U[0]);if(!K){var j=B.lowLatencyMode?L.partEnd:L.fragmentEnd;K=this.getFragmentAtPosition(g,j,L)}return(C=K)!==null&&C!==void 0&&C.initSegment&&!((k=K)!==null&&k!==void 0&&k.initSegment.data)&&!this.bitrateTest&&(K=K.initSegment),K},i.getNextPart=function(g,L,C){for(var k=-1,U=!1,F=!0,B=0,N=g.length;B<N;B++){var K=g[B];if(F=F&&!K.independent,k>-1&&C<K.start)break;var H=K.loaded;!H&&(U||K.independent||F)&&K.fragment===L&&(k=B),U=H}return k},i.loadedEndOfParts=function(g,L){var C=g[g.length-1];return C&&L>C.start&&C.loaded},i.getInitialLiveFragment=function(g,L){var C=this.fragPrevious,k=null;if(C){if(g.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+C.programDateTime),k=Object(E.findFragmentByPDT)(L,C.endProgramDateTime,this.config.maxFragLookUpTolerance)),!k){var U=C.sn+1;if(U>=g.startSN&&U<=g.endSN){var F=L[U-g.startSN];C.cc===F.cc&&(k=F,this.log("Live playlist, switching playlist, load frag with next SN: "+k.sn))}k||(k=Object(E.findFragWithCC)(L,C.cc),k&&this.log("Live playlist, switching playlist, load frag with same CC: "+k.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(k=this.getFragmentAtPosition(B,this.bitrateTest?g.fragmentEnd:g.edge,g))}return k},i.getFragmentAtPosition=function(g,L,C){var k=this.config,U=this.fragPrevious,F=C.fragments,B=C.endSN,N=C.fragmentHint,K=k.maxFragLookUpTolerance,H=!!(k.lowLatencyMode&&C.partList&&N);H&&N&&!this.bitrateTest&&(F=F.concat(N),B=N.sn);var j;if(g<L){var W=g>L-K?0:K;j=Object(E.findFragmentByPTS)(U,F,g,W)}else j=F[F.length-1];if(j){var V=j.sn-C.startSN,$=U&&j.level===U.level,Y=F[V+1],Q=this.fragmentTracker.getState(j);if(Q===b.FragmentState.BACKTRACKED){j=null;for(var J=V;F[J]&&this.fragmentTracker.getState(F[J])===b.FragmentState.BACKTRACKED;)U?j=F[J--]:j=F[--J];j||(j=Y)}else U&&j.sn===U.sn&&!H&&$&&(j.sn<B&&this.fragmentTracker.getState(Y)!==b.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+Y.sn),j=Y):j=null)}return j},i.synchronizeToLiveEdge=function(g){var L=this.config,C=this.media;if(!!C){var k=this.hls.liveSyncPosition,U=C.currentTime,F=g.fragments[0].start,B=g.edge,N=U>=F-L.maxFragLookUpTolerance&&U<=B;if(k!==null&&C.duration>k&&(U<k||!N)){var K=L.liveMaxLatencyDuration!==void 0?L.liveMaxLatencyDuration:L.liveMaxLatencyDurationCount*g.targetduration;(!N&&C.readyState<4||U<B-K)&&(this.loadedmetadata||(this.nextLoadPosition=k),C.readyState&&(this.warn("Playback: "+U.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+k.toFixed(3)),C.currentTime=k))}}},i.alignPlaylists=function(g,L){var C=this.levels,k=this.levelLastLoaded,U=this.fragPrevious,F=k!==null?C[k]:null,B=g.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var N=g.fragments[0].start,K=!L,H=g.alignedSliding&&Object(R.isFiniteNumber)(N);if(K||!H&&!N){Object(y.alignStream)(U,F,g);var j=g.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(L?L.startSN:"na")+"->"+g.startSN+" prev-sn: "+(U?U.sn:"na")+" fragments: "+B),j}return N},i.waitForCdnTuneIn=function(g){var L=3;return g.live&&g.canBlockReload&&g.tuneInGoal>Math.max(g.partHoldBack,g.partTarget*L)},i.setStartPosition=function(g,L){var C=this.startPosition;if(C<L&&(C=-1),C===-1||this.lastCurrentTime===-1){var k=g.startTimeOffset;Object(R.isFiniteNumber)(k)?(C=L+k,k<0&&(C+=g.totalduration),C=Math.min(Math.max(L,C),L+g.totalduration),this.log("Start time offset "+k+" found in playlist, adjust startPosition to "+C),this.startPosition=C):g.live?C=this.hls.liveSyncPosition||L:this.startPosition=C=0,this.lastCurrentTime=C}this.nextLoadPosition=C},i.getLoadPosition=function(){var g=this.media,L=0;return this.loadedmetadata&&g?L=g.currentTime:this.nextLoadPosition&&(L=this.nextLoadPosition),L},i.handleFragLoadAborted=function(g,L){this.transmuxer&&g.sn!=="initSegment"&&g.stats.aborted&&(this.warn("Fragment "+g.sn+(L?" part"+L.index:"")+" of level "+g.level+" was aborted"),this.resetFragmentLoading(g))},i.resetFragmentLoading=function(g){(!this.fragCurrent||!this.fragContextChanged(g))&&(this.state=m.IDLE)},i.onFragmentOrKeyLoadError=function(g,L){if(!L.fatal){var C=L.frag;if(!(!C||C.type!==g)){var k=this.fragCurrent;console.assert(k&&C.sn===k.sn&&C.level===k.level&&C.urlId===k.urlId,"Frag load error must match current frag to retry");var U=this.config;if(this.fragLoadError+1<=U.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(C.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*U.fragLoadingRetryDelay,U.fragLoadingMaxRetryTimeout);this.warn("Fragment "+C.sn+" of "+g+" "+C.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=m.FRAG_LOADING_WAITING_RETRY}else L.levelRetry?(g===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=m.IDLE):(M.logger.error(L.details+" reaches max retry, redispatch as fatal ..."),L.fatal=!0,this.hls.stopLoad(),this.state=m.ERROR)}}},i.afterBufferFlushed=function(g,L,C){if(!!g){var k=P.BufferHelper.getBuffered(g);this.fragmentTracker.detectEvictedFragments(L,k,C),this.state===m.ENDED&&this.resetLoadingState()}},i.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=m.IDLE},i.resetLiveStartWhenNotLoaded=function(g){if(!this.loadedmetadata){this.startFragRequested=!1;var L=this.levels?this.levels[g].details:null;if(L!=null&&L.live)return this.startPosition=-1,this.setStartPosition(L,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},i.updateLevelTiming=function(g,L,C,k){var U=this,F=C.details;console.assert(!!F,"level.details must be defined");var B=Object.keys(g.elementaryStreams).reduce(function(N,K){var H=g.elementaryStreams[K];if(H){var j=H.endPTS-H.startPTS;if(j<=0)return U.warn("Could not parse fragment "+g.sn+" "+K+" duration reliably ("+j+") resetting transmuxer to fallback to playlist timing"),U.resetTransmuxer(),N||!1;var W=k?0:Object(A.updateFragPTSDTS)(F,g,H.startPTS,H.endPTS,H.startDTS,H.endDTS);return U.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:F,level:C,drift:W,type:K,frag:g,start:H.startPTS,end:H.endPTS}),!0}return N},!1);B?(this.state=m.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:g,part:L})):this.resetLoadingState()},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},h(r,[{key:"state",get:function(){return this._state},set:function(g){var L=this._state;L!==g&&(this._state=g,this.log(L+"->"+g))}}]),r}(_.default)},"./src/controller/buffer-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return E});var R=s("./src/polyfills/number.ts"),_=s("./src/events.ts"),b=s("./src/utils/logger.ts"),P=s("./src/errors.ts"),M=s("./src/utils/buffer-helper.ts"),I=s("./src/utils/mediasource-helper.ts"),D=s("./src/loader/fragment.ts"),c=s("./src/controller/buffer-operation-queue.ts"),T=Object(I.getMediaSource)(),y=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function A(n){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.hls,a=e.media,h=e.mediaSource;b.logger.log("[buffer-controller]: Media source opened"),a&&(e.updateMediaElementDuration(),t.trigger(_.Events.MEDIA_ATTACHED,{media:a})),h&&h.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){b.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){b.logger.log("[buffer-controller]: Media source ended")},this.hls=n,this._initSourceBuffer(),this.registerListeners()}var S=A.prototype;return S.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},S.destroy=function(){this.unregisterListeners(),this.details=null},S.registerListeners=function(){var e=this.hls;e.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(_.Events.BUFFER_RESET,this.onBufferReset,this),e.on(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(_.Events.BUFFER_EOS,this.onBufferEos,this),e.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(_.Events.FRAG_PARSED,this.onFragParsed,this),e.on(_.Events.FRAG_CHANGED,this.onFragChanged,this)},S.unregisterListeners=function(){var e=this.hls;e.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(_.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(_.Events.BUFFER_RESET,this.onBufferReset,this),e.off(_.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(_.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(_.Events.BUFFER_EOS,this.onBufferEos,this),e.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(_.Events.FRAG_PARSED,this.onFragParsed,this),e.off(_.Events.FRAG_CHANGED,this.onFragChanged,this)},S._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new c.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},S.onManifestParsed=function(e,t){var a=2;(t.audio&&!t.video||!t.altAudio)&&(a=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=a,this.details=null,b.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},S.onMediaAttaching=function(e,t){var a=this.media=t.media;if(a&&T){var h=this.mediaSource=new T;h.addEventListener("sourceopen",this._onMediaSourceOpen),h.addEventListener("sourceended",this._onMediaSourceEnded),h.addEventListener("sourceclose",this._onMediaSourceClose),a.src=self.URL.createObjectURL(h),this._objectUrl=a.src}},S.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,a=this._objectUrl;if(t){if(b.logger.log("[buffer-controller]: media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(h){b.logger.warn("[buffer-controller]: onMediaDetaching: "+h.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(a&&self.URL.revokeObjectURL(a),e.src===a?(e.removeAttribute("src"),e.load()):b.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(_.Events.MEDIA_DETACHED,void 0)},S.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(t){var a=e.sourceBuffer[t];try{a&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(a),e.sourceBuffer[t]=void 0)}catch(h){b.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",h)}}),this._initSourceBuffer()},S.onBufferCodecs=function(e,t){var a=this,h=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(l){if(h){var f=a.tracks[l];if(f&&typeof f.buffer.changeType=="function"){var p=t[l],m=p.codec,d=p.levelCodec,u=p.container,r=(f.levelCodec||f.codec).replace(y,"$1"),i=(d||m).replace(y,"$1");if(r!==i){var v=u+";codecs="+(d||m);a.appendChangeType(l,v)}}}else a.pendingTracks[l]=t[l]}),!h&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},S.appendChangeType=function(e,t){var a=this,h=this.operationQueue,l={execute:function(){var p=a.sourceBuffer[e];p&&(b.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),p.changeType(t)),h.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(p){b.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",p)}};h.append(l,e)},S.onBufferAppending=function(e,t){var a=this,h=this.hls,l=this.operationQueue,f=this.tracks,p=t.data,m=t.type,d=t.frag,u=t.part,r=t.chunkMeta,i=r.buffering[m],v=self.performance.now();i.start=v;var g=d.stats.buffering,L=u?u.stats.buffering:null;g.start===0&&(g.start=v),L&&L.start===0&&(L.start=v);var C=f.audio,k=m==="audio"&&r.id===1&&(C==null?void 0:C.container)==="audio/mpeg",U={execute:function(){if(i.executeStart=self.performance.now(),k){var B=a.sourceBuffer[m];if(B){var N=d.start-B.timestampOffset;Math.abs(N)>=.1&&(b.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+d.start+" (delta: "+N+") sn: "+d.sn+")"),B.timestampOffset=d.start)}}a.appendExecutor(p,m)},onStart:function(){},onComplete:function(){var B=self.performance.now();i.executeEnd=i.end=B,g.first===0&&(g.first=B),L&&L.first===0&&(L.first=B);var N=a.sourceBuffer,K={};for(var H in N)K[H]=M.BufferHelper.getBuffered(N[H]);a.appendError=0,a.hls.trigger(_.Events.BUFFER_APPENDED,{type:m,frag:d,part:u,chunkMeta:r,parent:d.type,timeRanges:K})},onError:function(B){b.logger.error("[buffer-controller]: Error encountered while trying to append to the "+m+" SourceBuffer",B);var N={type:P.ErrorTypes.MEDIA_ERROR,parent:d.type,details:P.ErrorDetails.BUFFER_APPEND_ERROR,err:B,fatal:!1};B.code===DOMException.QUOTA_EXCEEDED_ERR?N.details=P.ErrorDetails.BUFFER_FULL_ERROR:(a.appendError++,N.details=P.ErrorDetails.BUFFER_APPEND_ERROR,a.appendError>h.config.appendErrorMaxRetry&&(b.logger.error("[buffer-controller]: Failed "+h.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),N.fatal=!0)),h.trigger(_.Events.ERROR,N)}};l.append(U,m)},S.onBufferFlushing=function(e,t){var a=this,h=this.operationQueue,l=function(p){return{execute:a.removeExecutor.bind(a,p,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){a.hls.trigger(_.Events.BUFFER_FLUSHED,{type:p})},onError:function(d){b.logger.warn("[buffer-controller]: Failed to remove from "+p+" SourceBuffer",d)}}};t.type?h.append(l(t.type),t.type):this.getSourceBufferTypes().forEach(function(f){h.append(l(f),f)})},S.onFragParsed=function(e,t){var a=this,h=t.frag,l=t.part,f=[],p=l?l.elementaryStreams:h.elementaryStreams;p[D.ElementaryStreamTypes.AUDIOVIDEO]?f.push("audiovideo"):(p[D.ElementaryStreamTypes.AUDIO]&&f.push("audio"),p[D.ElementaryStreamTypes.VIDEO]&&f.push("video"));var m=function(){var u=self.performance.now();h.stats.buffering.end=u,l&&(l.stats.buffering.end=u);var r=l?l.stats:h.stats;a.hls.trigger(_.Events.FRAG_BUFFERED,{frag:h,part:l,stats:r,id:h.type})};f.length===0&&b.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+h.type+" level: "+h.level+" sn: "+h.sn),this.blockBuffers(m,f)},S.onFragChanged=function(e,t){this.flushBackBuffer()},S.onBufferEos=function(e,t){var a=this,h=this.getSourceBufferTypes().reduce(function(l,f){var p=a.sourceBuffer[f];return(!t.type||t.type===f)&&p&&!p.ended&&(p.ended=!0,b.logger.log("[buffer-controller]: "+f+" sourceBuffer now EOS")),l&&!!(!p||p.ended)},!0);h&&this.blockBuffers(function(){var l=a.mediaSource;!l||l.readyState!=="open"||l.endOfStream()})},S.onLevelUpdated=function(e,t){var a=t.details;!a.fragments.length||(this.details=a,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},S.flushBackBuffer=function(){var e=this.hls,t=this.details,a=this.media,h=this.sourceBuffer;if(!(!a||t===null)){var l=this.getSourceBufferTypes();if(!!l.length){var f=t.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(R.isFiniteNumber)(f)||f<0)){var p=a.currentTime,m=t.levelTargetDuration,d=Math.max(f,m),u=Math.floor(p/m)*m-d;l.forEach(function(r){var i=h[r];if(i){var v=M.BufferHelper.getBuffered(i);v.length>0&&u>v.start(0)&&(e.trigger(_.Events.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live&&e.trigger(_.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u}),e.trigger(_.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:r}))}})}}}},S.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,t=this.hls,a=this.media,h=this.mediaSource,l=e.fragments[0].start+e.totalduration,f=a.duration,p=Object(R.isFiniteNumber)(h.duration)?h.duration:0;e.live&&t.config.liveDurationInfinity?(b.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),h.duration=1/0,this.updateSeekableRange(e)):(l>p&&l>f||!Object(R.isFiniteNumber)(f))&&(b.logger.log("[buffer-controller]: Updating Media Source duration to "+l.toFixed(3)),h.duration=l)}},S.updateSeekableRange=function(e){var t=this.mediaSource,a=e.fragments,h=a.length;if(h&&e.live&&t!==null&&t!==void 0&&t.setLiveSeekableRange){var l=Math.max(0,a[0].start),f=Math.max(l,l+e.totalduration);t.setLiveSeekableRange(l,f)}},S.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,a=this.pendingTracks,h=Object.keys(a).length;if(h&&!e||h===2){this.createSourceBuffers(a),this.pendingTracks={};var l=this.getSourceBufferTypes();if(l.length===0){this.hls.trigger(_.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}l.forEach(function(f){t.executeNext(f)})}},S.createSourceBuffers=function(e){var t=this.sourceBuffer,a=this.mediaSource;if(!a)throw Error("createSourceBuffers called when mediaSource was null");var h=0;for(var l in e)if(!t[l]){var f=e[l];if(!f)throw Error("source buffer exists for track "+l+", however track does not");var p=f.levelCodec||f.codec,m=f.container+";codecs="+p;b.logger.log("[buffer-controller]: creating sourceBuffer("+m+")");try{var d=t[l]=a.addSourceBuffer(m),u=l;this.addBufferListener(u,"updatestart",this._onSBUpdateStart),this.addBufferListener(u,"updateend",this._onSBUpdateEnd),this.addBufferListener(u,"error",this._onSBUpdateError),this.tracks[l]={buffer:d,codec:p,container:f.container,levelCodec:f.levelCodec,id:f.id},h++}catch(r){b.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+r.message),this.hls.trigger(_.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:r,mimeType:m})}}h&&this.hls.trigger(_.Events.BUFFER_CREATED,{tracks:this.tracks})},S._onSBUpdateStart=function(e){var t=this.operationQueue,a=t.current(e);a.onStart()},S._onSBUpdateEnd=function(e){var t=this.operationQueue,a=t.current(e);a.onComplete(),t.shiftAndExecuteNext(e)},S._onSBUpdateError=function(e,t){b.logger.error("[buffer-controller]: "+e+" SourceBuffer error",t),this.hls.trigger(_.Events.ERROR,{type:P.ErrorTypes.MEDIA_ERROR,details:P.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var a=this.operationQueue.current(e);a&&a.onError(t)},S.removeExecutor=function(e,t,a){var h=this.media,l=this.mediaSource,f=this.operationQueue,p=this.sourceBuffer,m=p[e];if(!h||!l||!m){b.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),f.shiftAndExecuteNext(e);return}var d=Object(R.isFiniteNumber)(h.duration)?h.duration:1/0,u=Object(R.isFiniteNumber)(l.duration)?l.duration:1/0,r=Math.max(0,t),i=Math.min(a,d,u);i>r?(b.logger.log("[buffer-controller]: Removing ["+r+","+i+"] from the "+e+" SourceBuffer"),console.assert(!m.updating,e+" sourceBuffer must not be updating"),m.remove(r,i)):f.shiftAndExecuteNext(e)},S.appendExecutor=function(e,t){var a=this.operationQueue,h=this.sourceBuffer,l=h[t];if(!l){b.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(t);return}l.ended=!1,console.assert(!l.updating,t+" sourceBuffer must not be updating"),l.appendBuffer(e)},S.blockBuffers=function(e,t){var a=this;if(t===void 0&&(t=this.getSourceBufferTypes()),!t.length){b.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(e);return}var h=this.operationQueue,l=t.map(function(f){return h.appendBlocker(f)});Promise.all(l).then(function(){e(),t.forEach(function(f){var p=a.sourceBuffer[f];(!p||!p.updating)&&h.shiftAndExecuteNext(f)})})},S.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},S.addBufferListener=function(e,t,a){var h=this.sourceBuffer[e];if(!!h){var l=a.bind(this,e);this.listeners[e].push({event:t,listener:l}),h.addEventListener(t,l)}},S.removeBufferListeners=function(e){var t=this.sourceBuffer[e];!t||this.listeners[e].forEach(function(a){t.removeEventListener(a.event,a.listener)})},A}()},"./src/controller/buffer-operation-queue.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return _});var R=s("./src/utils/logger.ts"),_=function(){function b(M){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=M}var P=b.prototype;return P.append=function(I,D){var c=this.queues[D];c.push(I),c.length===1&&this.buffers[D]&&this.executeNext(D)},P.insertAbort=function(I,D){var c=this.queues[D];c.unshift(I),this.executeNext(D)},P.appendBlocker=function(I){var D,c=new Promise(function(y){D=y}),T={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(T,I),c},P.executeNext=function(I){var D=this.buffers,c=this.queues,T=D[I],y=c[I];if(y.length){var E=y[0];try{E.execute()}catch(A){R.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),E.onError(A),(!T||!T.updating)&&(y.shift(),this.executeNext(I))}}},P.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},P.current=function(I){return this.queues[I][0]},b}()},"./src/controller/cap-level-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/events.ts");function _(M,I){for(var D=0;D<I.length;D++){var c=I[D];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(M,c.key,c)}}function b(M,I,D){return I&&_(M.prototype,I),D&&_(M,D),M}var P=function(){function M(D){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=D,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var I=M.prototype;return I.setStreamController=function(c){this.streamController=c},I.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},I.registerListeners=function(){var c=this.hls;c.on(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.unregisterListener=function(){var c=this.hls;c.off(R.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),c.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),c.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),c.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),c.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},I.onFpsDropLevelCapping=function(c,T){M.isLevelAllowed(T.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(T.droppedLevel)},I.onMediaAttaching=function(c,T){this.media=T.media instanceof HTMLVideoElement?T.media:null},I.onManifestParsed=function(c,T){var y=this.hls;this.restrictedLevels=[],this.firstLevel=T.firstLevel,y.config.capLevelToPlayerSize&&T.video&&this.startCapping()},I.onBufferCodecs=function(c,T){var y=this.hls;y.config.capLevelToPlayerSize&&T.video&&this.startCapping()},I.onMediaDetaching=function(){this.stopCapping()},I.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var c=this.hls.levels;if(c.length){var T=this.hls;T.autoLevelCapping=this.getMaxLevel(c.length-1),T.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=T.autoLevelCapping}}},I.getMaxLevel=function(c){var T=this,y=this.hls.levels;if(!y.length)return-1;var E=y.filter(function(A,S){return M.isLevelAllowed(S,T.restrictedLevels)&&S<=c});return this.clientRect=null,M.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},I.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},I.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},I.getDimensions=function(){if(this.clientRect)return this.clientRect;var c=this.media,T={width:0,height:0};if(c){var y=c.getBoundingClientRect();T.width=y.width,T.height=y.height,!T.width&&!T.height&&(T.width=y.right-y.left||c.width||0,T.height=y.bottom-y.top||c.height||0)}return this.clientRect=T,T},M.isLevelAllowed=function(c,T){return T===void 0&&(T=[]),T.indexOf(c)===-1},M.getMaxLevelByMediaSize=function(c,T,y){if(!c||!c.length)return-1;for(var E=function(t,a){return a?t.width!==a.width||t.height!==a.height:!0},A=c.length-1,S=0;S<c.length;S+=1){var n=c[S];if((n.width>=T||n.height>=y)&&E(n,c[S+1])){A=S;break}}return A},b(M,[{key:"mediaWidth",get:function(){return this.getDimensions().width*M.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*M.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var c=1;try{c=self.devicePixelRatio}catch{}return c}}]),M}();O.default=P},"./src/controller/eme-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/events.ts"),_=s("./src/errors.ts"),b=s("./src/utils/logger.ts"),P=s("./src/utils/mediakeys-helper.ts");function M(E,A){for(var S=0;S<A.length;S++){var n=A[S];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(E,n.key,n)}}function I(E,A,S){return A&&M(E.prototype,A),S&&M(E,S),E}var D=3,c=function(A,S,n){var e={audioCapabilities:[],videoCapabilities:[]};return A.forEach(function(t){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})}),S.forEach(function(t){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})}),[e]},T=function(A,S,n,e){switch(A){case P.KeySystems.WIDEVINE:return c(S,n,e);default:throw new Error("Unknown key-system: "+A)}},y=function(){function E(S){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=S,this._config=S.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var A=E.prototype;return A.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},A._registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},A._unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(R.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this)},A.getLicenseServerUrl=function(n){switch(n){case P.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+n+'"')},A._attemptKeySystemAccess=function(n,e,t){var a=this,h=T(n,e,t,this._drmSystemOptions);b.logger.log("Requesting encrypted media key-system access");var l=this.requestMediaKeySystemAccess(n,h);this.mediaKeysPromise=l.then(function(f){return a._onMediaKeySystemAccessObtained(n,f)}),l.catch(function(f){b.logger.error('Failed to obtain key-system "'+n+'" access:',f)})},A._onMediaKeySystemAccessObtained=function(n,e){var t=this;b.logger.log('Access for key-system "'+n+'" obtained');var a={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:n};this._mediaKeysList.push(a);var h=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(l){return a.mediaKeys=l,b.logger.log('Media-keys created for key-system "'+n+'"'),t._onMediaKeysCreated(),l});return h.catch(function(l){b.logger.error("Failed to create media-keys:",l)}),h},A._onMediaKeysCreated=function(){var n=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),n._onNewMediaKeySession(e.mediaKeysSession))})},A._onNewMediaKeySession=function(n){var e=this;b.logger.log("New key-system session "+n.sessionId),n.addEventListener("message",function(t){e._onKeySessionMessage(n,t.message)},!1)},A._onKeySessionMessage=function(n,e){b.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(t){b.logger.log("Received license data (length: "+(t&&t.byteLength)+"), updating key-session"),n.update(t)})},A.onMediaEncrypted=function(n){var e=this;if(b.logger.log('Media is encrypted using "'+n.initDataType+'" init data type'),!this.mediaKeysPromise){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var t=function(h){!e._media||(e._attemptSetMediaKeys(h),e._generateRequestWithPreferredKeySession(n.initDataType,n.initData))};this.mediaKeysPromise.then(t).catch(t)},A._attemptSetMediaKeys=function(n){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){b.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}b.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},A._generateRequestWithPreferredKeySession=function(n,e){var t=this,a=this._mediaKeysList[0];if(!a){b.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(a.mediaKeysSessionInitialized){b.logger.warn("Key-Session already initialized but requested again");return}var h=a.mediaKeysSession;if(!h){b.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){b.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}b.logger.log('Generating key-session request for "'+n+'" init data type'),a.mediaKeysSessionInitialized=!0,h.generateRequest(n,e).then(function(){b.logger.debug("Key-session generation succeeded")}).catch(function(l){b.logger.error("Error generating key-session request:",l),t.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},A._createLicenseXhr=function(n,e,t){var a=new XMLHttpRequest;a.responseType="arraybuffer",a.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,a,n,e,t);var h=this._licenseXhrSetup;if(h)try{h.call(this.hls,a,n),h=void 0}catch(l){b.logger.error(l)}try{a.readyState||a.open("POST",n,!0),h&&h.call(this.hls,a,n)}catch(l){throw new Error("issue setting up KeySystem license XHR "+l)}return a},A._onLicenseRequestReadyStageChange=function(n,e,t,a){switch(n.readyState){case 4:if(n.status===200){this._requestLicenseFailureCount=0,b.logger.log("License request succeeded");var h=n.response,l=this._licenseResponseCallback;if(l)try{h=l.call(this.hls,n,e)}catch(p){b.logger.error(p)}a(h)}else{if(b.logger.error("License Request XHR failed ("+e+"). Status: "+n.status+" ("+n.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>D){this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var f=D-this._requestLicenseFailureCount+1;b.logger.warn("Retrying license request, "+f+" attempts left"),this._requestLicense(t,a)}break}},A._generateLicenseRequestChallenge=function(n,e){switch(n.mediaKeySystemDomain){case P.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+n.mediaKeySystemDomain)},A._requestLicense=function(n,e){b.logger.log("Requesting content license for key-system");var t=this._mediaKeysList[0];if(!t){b.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var a=this.getLicenseServerUrl(t.mediaKeySystemDomain),h=this._createLicenseXhr(a,n,e);b.logger.log("Sending license request to URL: "+a);var l=this._generateLicenseRequestChallenge(t,n);h.send(l)}catch(f){b.logger.error("Failure requesting DRM license: "+f),this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.KEY_SYSTEM_ERROR,details:_.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},A.onMediaAttached=function(n,e){if(!!this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},A.onMediaDetached=function(){var n=this._media,e=this._mediaKeysList;!n||(n.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch(function(){})})).then(function(){return n.setMediaKeys(null)}).catch(function(){}))},A.onManifestParsed=function(n,e){if(!!this._emeEnabled){var t=e.levels.map(function(h){return h.audioCodec}).filter(function(h){return!!h}),a=e.levels.map(function(h){return h.videoCodec}).filter(function(h){return!!h});this._attemptKeySystemAccess(P.KeySystems.WIDEVINE,t,a)}},I(E,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),E}();O.default=y},"./src/controller/fps-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/events.ts"),_=s("./src/utils/logger.ts"),b=function(){function P(I){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=I,this.registerListeners()}var M=P.prototype;return M.setStreamController=function(D){this.streamController=D},M.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},M.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching)},M.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},M.onMediaAttaching=function(D,c){var T=this.hls.config;if(T.capLevelOnFPSDrop){var y=c.media instanceof self.HTMLVideoElement?c.media:null;this.media=y,y&&typeof y.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),T.fpsDroppedMonitoringPeriod)}},M.checkFPS=function(D,c,T){var y=performance.now();if(c){if(this.lastTime){var E=y-this.lastTime,A=T-this.lastDroppedFrames,S=c-this.lastDecodedFrames,n=1e3*A/E,e=this.hls;if(e.trigger(R.Events.FPS_DROP,{currentDropped:A,currentDecoded:S,totalDroppedFrames:T}),n>0&&A>e.config.fpsDroppedMonitoringThreshold*S){var t=e.currentLevel;_.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=t)&&(t=t-1,e.trigger(R.Events.FPS_DROP_LEVEL_CAPPING,{level:t,droppedLevel:e.currentLevel}),e.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=y,this.lastDroppedFrames=T,this.lastDecodedFrames=c}},M.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var c=D.getVideoPlaybackQuality();this.checkFPS(D,c.totalVideoFrames,c.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},P}();O.default=b},"./src/controller/fragment-finders.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"findFragmentByPDT",function(){return b}),s.d(O,"findFragmentByPTS",function(){return P}),s.d(O,"fragmentWithinToleranceTest",function(){return M}),s.d(O,"pdtWithinToleranceTest",function(){return I}),s.d(O,"findFragWithCC",function(){return D});var R=s("./src/polyfills/number.ts"),_=s("./src/utils/binary-search.ts");function b(c,T,y){if(T===null||!Array.isArray(c)||!c.length||!Object(R.isFiniteNumber)(T))return null;var E=c[0].programDateTime;if(T<(E||0))return null;var A=c[c.length-1].endProgramDateTime;if(T>=(A||0))return null;y=y||0;for(var S=0;S<c.length;++S){var n=c[S];if(I(T,y,n))return n}return null}function P(c,T,y,E){y===void 0&&(y=0),E===void 0&&(E=0);var A=null;if(c?A=T[c.sn-T[0].sn+1]||null:y===0&&T[0].start===0&&(A=T[0]),A&&M(y,E,A)===0)return A;var S=_.default.search(T,M.bind(null,y,E));return S||A}function M(c,T,y){c===void 0&&(c=0),T===void 0&&(T=0);var E=Math.min(T,y.duration+(y.deltaPTS?y.deltaPTS:0));return y.start+y.duration-E<=c?1:y.start-E>c&&y.start?-1:0}function I(c,T,y){var E=Math.min(T,y.duration+(y.deltaPTS?y.deltaPTS:0))*1e3,A=y.endProgramDateTime||0;return A-E>c}function D(c,T){return _.default.search(c,function(y){return y.cc<T?1:y.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"FragmentState",function(){return b}),s.d(O,"FragmentTracker",function(){return P});var R=s("./src/events.ts"),_=s("./src/types/loader.ts"),b;(function(D){D.NOT_LOADED="NOT_LOADED",D.BACKTRACKED="BACKTRACKED",D.APPENDING="APPENDING",D.PARTIAL="PARTIAL",D.OK="OK"})(b||(b={}));var P=function(){function D(T){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=T,this._registerListeners()}var c=D.prototype;return c._registerListeners=function(){var y=this.hls;y.on(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.on(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.on(R.Events.FRAG_LOADED,this.onFragLoaded,this)},c._unregisterListeners=function(){var y=this.hls;y.off(R.Events.BUFFER_APPENDED,this.onBufferAppended,this),y.off(R.Events.FRAG_BUFFERED,this.onFragBuffered,this),y.off(R.Events.FRAG_LOADED,this.onFragLoaded,this)},c.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},c.getAppendedFrag=function(y,E){if(E===_.PlaylistLevelType.MAIN){var A=this.activeFragment,S=this.activeParts;if(!A)return null;if(S)for(var n=S.length;n--;){var e=S[n],t=e?e.end:A.appendedPTS;if(e.start<=y&&t!==void 0&&y<=t)return n>9&&(this.activeParts=S.slice(n-9)),e}else if(A.start<=y&&A.appendedPTS!==void 0&&y<=A.appendedPTS)return A}return this.getBufferedFrag(y,E)},c.getBufferedFrag=function(y,E){for(var A=this.fragments,S=Object.keys(A),n=S.length;n--;){var e=A[S[n]];if((e==null?void 0:e.body.type)===E&&e.buffered){var t=e.body;if(t.start<=y&&y<=t.end)return t}}return null},c.detectEvictedFragments=function(y,E,A){var S=this;Object.keys(this.fragments).forEach(function(n){var e=S.fragments[n];if(!!e){if(!e.buffered){e.body.type===A&&S.removeFragment(e.body);return}var t=e.range[y];!t||t.time.some(function(a){var h=!S.isTimeBuffered(a.startPTS,a.endPTS,E);return h&&S.removeFragment(e.body),h})}})},c.detectPartialFragments=function(y){var E=this,A=this.timeRanges,S=y.frag,n=y.part;if(!(!A||S.sn==="initSegment")){var e=I(S),t=this.fragments[e];!t||(Object.keys(A).forEach(function(a){var h=S.elementaryStreams[a];if(!!h){var l=A[a],f=n!==null||h.partial===!0;t.range[a]=E.getBufferedTimes(S,n,f,l)}}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},c.fragBuffered=function(y){var E=I(y),A=this.fragments[E];A&&(A.backtrack=A.loaded=null,A.buffered=!0)},c.getBufferedTimes=function(y,E,A,S){for(var n={time:[],partial:A},e=E?E.start:y.start,t=E?E.end:y.end,a=y.minEndPTS||t,h=y.maxStartPTS||e,l=0;l<S.length;l++){var f=S.start(l)-this.bufferPadding,p=S.end(l)+this.bufferPadding;if(h>=f&&a<=p){n.time.push({startPTS:Math.max(e,S.start(l)),endPTS:Math.min(t,S.end(l))});break}else if(e<p&&t>f)n.partial=!0,n.time.push({startPTS:Math.max(e,S.start(l)),endPTS:Math.min(t,S.end(l))});else if(t<=f)break}return n},c.getPartialFragment=function(y){var E=null,A,S,n,e=0,t=this.bufferPadding,a=this.fragments;return Object.keys(a).forEach(function(h){var l=a[h];!l||M(l)&&(S=l.body.start-t,n=l.body.end+t,y>=S&&y<=n&&(A=Math.min(y-S,n-y),e<=A&&(E=l.body,e=A)))}),E},c.getState=function(y){var E=I(y),A=this.fragments[E];return A?A.buffered?M(A)?b.PARTIAL:b.OK:A.backtrack?b.BACKTRACKED:b.APPENDING:b.NOT_LOADED},c.backtrack=function(y,E){var A=I(y),S=this.fragments[A];if(!S||S.backtrack)return null;var n=S.backtrack=E||S.loaded;return S.loaded=null,n},c.getBacktrackData=function(y){var E=I(y),A=this.fragments[E];if(A){var S,n=A.backtrack;if(n!=null&&(S=n.payload)!==null&&S!==void 0&&S.byteLength)return n;this.removeFragment(y)}return null},c.isTimeBuffered=function(y,E,A){for(var S,n,e=0;e<A.length;e++){if(S=A.start(e)-this.bufferPadding,n=A.end(e)+this.bufferPadding,y>=S&&E<=n)return!0;if(E<=S)return!1}return!1},c.onFragLoaded=function(y,E){var A=E.frag,S=E.part;if(!(A.sn==="initSegment"||A.bitrateTest||S)){var n=I(A);this.fragments[n]={body:A,loaded:E,backtrack:null,buffered:!1,range:Object.create(null)}}},c.onBufferAppended=function(y,E){var A=this,S=E.frag,n=E.part,e=E.timeRanges;if(S.type===_.PlaylistLevelType.MAIN)if(this.activeFragment=S,n){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(n)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(a){var h=e[a];if(A.detectEvictedFragments(a,h),!n)for(var l=0;l<h.length;l++)S.appendedPTS=Math.max(h.end(l),S.appendedPTS||0)})},c.onFragBuffered=function(y,E){this.detectPartialFragments(E)},c.hasFragment=function(y){var E=I(y);return!!this.fragments[E]},c.removeFragmentsInRange=function(y,E,A){var S=this;Object.keys(this.fragments).forEach(function(n){var e=S.fragments[n];if(!!e&&e.buffered){var t=e.body;t.type===A&&t.start<E&&t.end>y&&S.removeFragment(t)}})},c.removeFragment=function(y){var E=I(y);y.stats.loaded=0,y.clearElementaryStreamInfo(),delete this.fragments[E]},c.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},D}();function M(D){var c,T;return D.buffered&&(((c=D.range.video)===null||c===void 0?void 0:c.partial)||((T=D.range.audio)===null||T===void 0?void 0:T.partial))}function I(D){return D.type+"_"+D.level+"_"+D.urlId+"_"+D.sn}},"./src/controller/gap-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"STALL_MINIMUM_DURATION_MS",function(){return M}),s.d(O,"MAX_START_GAP_JUMP",function(){return I}),s.d(O,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return D}),s.d(O,"SKIP_BUFFER_RANGE_START",function(){return c}),s.d(O,"default",function(){return T});var R=s("./src/utils/buffer-helper.ts"),_=s("./src/errors.ts"),b=s("./src/events.ts"),P=s("./src/utils/logger.ts"),M=250,I=2,D=.1,c=.05,T=function(){function y(A,S,n,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=A,this.media=S,this.fragmentTracker=n,this.hls=e}var E=y.prototype;return E.destroy=function(){this.hls=this.fragmentTracker=this.media=null},E.poll=function(S){var n=this.config,e=this.media,t=this.stalled,a=e.currentTime,h=e.seeking,l=this.seeking&&!h,f=!this.seeking&&h;if(this.seeking=h,a!==S){if(this.moved=!0,t!==null){if(this.stallReported){var p=self.performance.now()-t;P.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(p)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((f||l)&&(this.stalled=null),!(e.paused||e.ended||e.playbackRate===0||!R.BufferHelper.getBuffered(e).length)){var m=R.BufferHelper.bufferInfo(e,a,0),d=m.len>0,u=m.nextStart||0;if(!(!d&&!u)){if(h){var r=m.len>I,i=!u||u-a>I&&!this.fragmentTracker.getPartialFragment(a);if(r||i)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var v,g=Math.max(u,m.start||0)-a,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,C=L==null||(v=L.details)===null||v===void 0?void 0:v.live,k=C?L.details.targetduration*2:I;if(g>0&&g<=k){this._trySkipBufferHole(null);return}}var U=self.performance.now();if(t===null){this.stalled=U;return}var F=U-t;!h&&F>=M&&this._reportStall(m.len);var B=R.BufferHelper.bufferInfo(e,a,n.maxBufferHole);this._tryFixBufferStall(B,F)}}},E._tryFixBufferStall=function(S,n){var e=this.config,t=this.fragmentTracker,a=this.media,h=a.currentTime,l=t.getPartialFragment(h);if(l){var f=this._trySkipBufferHole(l);if(f)return}S.len>e.maxBufferHole&&n>e.highBufferWatchdogPeriod*1e3&&(P.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},E._reportStall=function(S){var n=this.hls,e=this.media,t=this.stallReported;t||(this.stallReported=!0,P.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer (buffer="+S+")"),n.trigger(b.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:S}))},E._trySkipBufferHole=function(S){for(var n=this.config,e=this.hls,t=this.media,a=t.currentTime,h=0,l=R.BufferHelper.getBuffered(t),f=0;f<l.length;f++){var p=l.start(f);if(a+n.maxBufferHole>=h&&a<p){var m=Math.max(p+c,t.currentTime+D);return P.logger.warn("skipping hole, adjusting currentTime from "+a+" to "+m),this.moved=!0,this.stalled=null,t.currentTime=m,S&&e.trigger(b.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+a+" to "+m,frag:S}),m}h=l.end(f)}return 0},E._tryNudgeBuffer=function(){var S=this.config,n=this.hls,e=this.media,t=e.currentTime,a=(this.nudgeRetry||0)+1;if(this.nudgeRetry=a,a<S.nudgeMaxRetry){var h=t+a*S.nudgeOffset;P.logger.warn("Nudging 'currentTime' from "+t+" to "+h),e.currentTime=h,n.trigger(b.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else P.logger.error("Playhead still not moving while enough data buffered @"+t+" after "+S.nudgeMaxRetry+" nudges"),n.trigger(b.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},y}()},"./src/controller/id3-track-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/events.ts"),_=s("./src/utils/texttrack-utils.ts"),b=s("./src/demux/id3.ts"),P=.25,M=function(){function I(c){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=c,this._registerListeners()}var D=I.prototype;return D.destroy=function(){this._unregisterListeners()},D._registerListeners=function(){var T=this.hls;T.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.on(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),T.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D._unregisterListeners=function(){var T=this.hls;T.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),T.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),T.off(R.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),T.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},D.onMediaAttached=function(T,y){this.media=y.media},D.onMediaDetaching=function(){!this.id3Track||(Object(_.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},D.getID3Track=function(T){if(!!this.media){for(var y=0;y<T.length;y++){var E=T[y];if(E.kind==="metadata"&&E.label==="id3")return Object(_.sendAddTrackEvent)(E,this.media),E}return this.media.addTextTrack("metadata","id3")}},D.onFragParsingMetadata=function(T,y){if(!!this.media){var E=y.frag,A=y.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var S=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,n=0;n<A.length;n++){var e=b.getID3Frames(A[n].data);if(e){var t=A[n].pts,a=n<A.length-1?A[n+1].pts:E.end,h=a-t;h<=0&&(a=t+P);for(var l=0;l<e.length;l++){var f=e[l];if(!b.isTimeStampFrame(f)){var p=new S(t,a,"");p.value=f,this.id3Track.addCue(p)}}}}}},D.onBufferFlushing=function(T,y){var E=y.startOffset,A=y.endOffset,S=y.type;if(!S||S==="audio"){var n=this.id3Track;n&&Object(_.removeCuesInRange)(n,E,A)}},I}();O.default=M},"./src/controller/latency-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return I});var R=s("./src/errors.ts"),_=s("./src/events.ts"),b=s("./src/utils/logger.ts");function P(D,c){for(var T=0;T<c.length;T++){var y=c[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(D,y.key,y)}}function M(D,c,T){return c&&P(D.prototype,c),T&&P(D,T),D}var I=function(){function D(T){var y=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return y.timeupdate()},this.hls=T,this.config=T.config,this.registerListeners()}var c=D.prototype;return c.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},c.registerListeners=function(){this.hls.on(_.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(_.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(_.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){this.hls.off(_.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(_.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(_.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(_.Events.ERROR,this.onError)},c.onMediaAttached=function(y,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},c.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},c.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},c.onLevelUpdated=function(y,E){var A=E.details;this.levelDetails=A,A.advanced&&this.timeupdate(),!A.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},c.onError=function(y,E){E.details===R.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,b.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},c.timeupdate=function(){var y=this.media,E=this.levelDetails;if(!(!y||!E)){this.currentTime=y.currentTime;var A=this.computeLatency();if(A!==null){this._latency=A;var S=this.config,n=S.lowLatencyMode,e=S.maxLiveSyncPlaybackRate;if(!(!n||e===1)){var t=this.targetLatency;if(t!==null){var a=A-t,h=Math.min(this.maxLatency,t+E.targetduration),l=a<h;if(E.live&&l&&a>.05&&this.forwardBufferLength>1){var f=Math.min(2,Math.max(1,e)),p=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;y.playbackRate=Math.min(f,Math.max(1,p))}else y.playbackRate!==1&&y.playbackRate!==0&&(y.playbackRate=1)}}}}},c.estimateLiveEdge=function(){var y=this.levelDetails;return y===null?null:y.edge+y.age},c.computeLatency=function(){var y=this.estimateLiveEdge();return y===null?null:y-this.currentTime},M(D,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var y=this.config,E=this.levelDetails;return y.liveMaxLatencyDuration!==void 0?y.liveMaxLatencyDuration:E?y.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var y=this.levelDetails;if(y===null)return null;var E=y.holdBack,A=y.partHoldBack,S=y.targetduration,n=this.config,e=n.liveSyncDuration,t=n.liveSyncDurationCount,a=n.lowLatencyMode,h=this.hls.userConfig,l=a&&A||E;(h.liveSyncDuration||h.liveSyncDurationCount||l===0)&&(l=e!==void 0?e:t*S);var f=S,p=1;return l+Math.min(this.stallCount*p,f)}},{key:"liveSyncPosition",get:function(){var y=this.estimateLiveEdge(),E=this.targetLatency,A=this.levelDetails;if(y===null||E===null||A===null)return null;var S=A.edge,n=y-E-this.edgeStalled,e=S-A.totalduration,t=S-(this.config.lowLatencyMode&&A.partTarget||A.targetduration);return Math.min(Math.max(e,n),t)}},{key:"drift",get:function(){var y=this.levelDetails;return y===null?1:y.drift}},{key:"edgeStalled",get:function(){var y=this.levelDetails;if(y===null)return 0;var E=(this.config.lowLatencyMode&&y.partTarget||y.targetduration)*3;return Math.max(y.age-E,0)}},{key:"forwardBufferLength",get:function(){var y=this.media,E=this.levelDetails;if(!y||!E)return 0;var A=y.buffered.length;return A?y.buffered.end(A-1):E.edge-this.currentTime}}]),D}()},"./src/controller/level-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return n});var R=s("./src/types/level.ts"),_=s("./src/events.ts"),b=s("./src/errors.ts"),P=s("./src/utils/codecs.ts"),M=s("./src/controller/level-helper.ts"),I=s("./src/controller/base-playlist-controller.ts"),D=s("./src/types/loader.ts");function c(){return c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(e[h]=a[h])}return e},c.apply(this,arguments)}function T(e,t){for(var a=0;a<t.length;a++){var h=t[a];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(e,h.key,h)}}function y(e,t,a){return t&&T(e.prototype,t),a&&T(e,a),e}function E(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,A(e,t)}function A(e,t){return A=Object.setPrototypeOf||function(h,l){return h.__proto__=l,h},A(e,t)}var S=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n=function(e){E(t,e);function t(h){var l;return l=e.call(this,h,"[level-controller]")||this,l._levels=[],l._firstLevel=-1,l._startLevel=void 0,l.currentLevelIndex=-1,l.manualLevelIndex=-1,l.onParsedComplete=void 0,l._registerListeners(),l}var a=t.prototype;return a._registerListeners=function(){var l=this.hls;l.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.on(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(_.Events.ERROR,this.onError,this)},a._unregisterListeners=function(){var l=this.hls;l.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(_.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(_.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(_.Events.ERROR,this.onError,this)},a.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},a.startLoad=function(){var l=this._levels;l.forEach(function(f){f.loadError=0}),e.prototype.startLoad.call(this)},a.onManifestLoaded=function(l,f){var p=[],m=[],d=[],u,r={},i,v=!1,g=!1,L=!1;if(f.levels.forEach(function(F){var B=F.attrs;v=v||!!(F.width&&F.height),g=g||!!F.videoCodec,L=L||!!F.audioCodec,S&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var N=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;i=r[N],i?i.url.push(F.url):(i=new R.Level(F),r[N]=i,p.push(i)),B&&(B.AUDIO&&Object(M.addGroupId)(i,"audio",B.AUDIO),B.SUBTITLES&&Object(M.addGroupId)(i,"text",B.SUBTITLES))}),(v||g)&&L&&(p=p.filter(function(F){var B=F.videoCodec,N=F.width,K=F.height;return!!B||!!(N&&K)})),p=p.filter(function(F){var B=F.audioCodec,N=F.videoCodec;return(!B||Object(P.isCodecSupportedInMp4)(B,"audio"))&&(!N||Object(P.isCodecSupportedInMp4)(N,"video"))}),f.audioTracks&&(m=f.audioTracks.filter(function(F){return!F.audioCodec||Object(P.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(M.assignTrackIdsByGroup)(m)),f.subtitles&&(d=f.subtitles,Object(M.assignTrackIdsByGroup)(d)),p.length>0){u=p[0].bitrate,p.sort(function(F,B){return F.bitrate-B.bitrate}),this._levels=p;for(var C=0;C<p.length;C++)if(p[C].bitrate===u){this._firstLevel=C,this.log("manifest loaded, "+p.length+" level(s) found, first bitrate: "+u);break}var k=L&&!g,U={levels:p,audioTracks:m,subtitleTracks:d,firstLevel:this._firstLevel,stats:f.stats,audio:L,video:g,altAudio:!k&&m.some(function(F){return!!F.url})};this.hls.trigger(_.Events.MANIFEST_PARSED,U),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(_.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:f.url,reason:"no level with compatible codecs found in manifest"})},a.onError=function(l,f){if(e.prototype.onError.call(this,l,f),!f.fatal){var p=f.context,m=this._levels[this.currentLevelIndex];if(p&&(p.type===D.PlaylistContextType.AUDIO_TRACK&&m.audioGroupIds&&p.groupId===m.audioGroupIds[m.urlId]||p.type===D.PlaylistContextType.SUBTITLE_TRACK&&m.textGroupIds&&p.groupId===m.textGroupIds[m.urlId])){this.redundantFailover(this.currentLevelIndex);return}var d=!1,u=!0,r;switch(f.details){case b.ErrorDetails.FRAG_LOAD_ERROR:case b.ErrorDetails.FRAG_LOAD_TIMEOUT:case b.ErrorDetails.KEY_LOAD_ERROR:case b.ErrorDetails.KEY_LOAD_TIMEOUT:if(f.frag){var i=this._levels[f.frag.level];i?(i.fragmentError++,i.fragmentError>this.hls.config.fragLoadingMaxRetry&&(r=f.frag.level)):r=f.frag.level}break;case b.ErrorDetails.LEVEL_LOAD_ERROR:case b.ErrorDetails.LEVEL_LOAD_TIMEOUT:p&&(p.deliveryDirectives&&(u=!1),r=p.level),d=!0;break;case b.ErrorDetails.REMUX_ALLOC_ERROR:r=f.level,d=!0;break}r!==void 0&&this.recoverLevel(f,r,d,u)}},a.recoverLevel=function(l,f,p,m){var d=l.details,u=this._levels[f];if(u.loadError++,p){var r=this.retryLoadingOrFail(l);if(r)l.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(m){var i=u.url.length;if(i>1&&u.loadError<i)l.levelRetry=!0,this.redundantFailover(f);else if(this.manualLevelIndex===-1){var v=f===0?this._levels.length-1:f-1;this.currentLevelIndex!==v&&this._levels[v].loadError===0&&(this.warn(d+": switch to "+v),l.levelRetry=!0,this.hls.nextAutoLevel=v)}}},a.redundantFailover=function(l){var f=this._levels[l],p=f.url.length;if(p>1){var m=(f.urlId+1)%p;this.warn("Switching to redundant URL-id "+m),this._levels.forEach(function(d){d.urlId=m}),this.level=l}},a.onFragLoaded=function(l,f){var p=f.frag;if(p!==void 0&&p.type===D.PlaylistLevelType.MAIN){var m=this._levels[p.level];m!==void 0&&(m.fragmentError=0,m.loadError=0)}},a.onLevelLoaded=function(l,f){var p,m=f.level,d=f.details,u=this._levels[m];if(!u){var r;this.warn("Invalid level index "+m),(r=f.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(d.deltaUpdateFailed=!0);return}m===this.currentLevelIndex?(u.fragmentError===0&&(u.loadError=0,this.retryCount=0),this.playlistLoaded(m,f,u.details)):(p=f.deliveryDirectives)!==null&&p!==void 0&&p.skip&&(d.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function(l,f){var p=this.hls.levels[this.currentLevelIndex];if(!!p&&p.audioGroupIds){for(var m=-1,d=this.hls.audioTracks[f.id].groupId,u=0;u<p.audioGroupIds.length;u++)if(p.audioGroupIds[u]===d){m=u;break}m!==p.urlId&&(p.urlId=m,this.startLoad())}},a.loadPlaylist=function(l){var f=this.currentLevelIndex,p=this._levels[f];if(this.canLoad&&p&&p.url.length>0){var m=p.urlId,d=p.url[m];if(l)try{d=l.addDirectives(d)}catch(u){this.warn("Could not construct new URL with HLS Delivery Directives: "+u)}this.log("Attempt loading level index "+f+(l?" at sn "+l.msn+" part "+l.part:"")+" with URL-id "+m+" "+d),this.clearTimer(),this.hls.trigger(_.Events.LEVEL_LOADING,{url:d,level:f,id:m,deliveryDirectives:l||null})}},a.removeLevel=function(l,f){var p=function(u,r){return r!==f},m=this._levels.filter(function(d,u){return u!==l?!0:d.url.length>1&&f!==void 0?(d.url=d.url.filter(p),d.audioGroupIds&&(d.audioGroupIds=d.audioGroupIds.filter(p)),d.textGroupIds&&(d.textGroupIds=d.textGroupIds.filter(p)),d.urlId=0,!0):!1}).map(function(d,u){var r=d.details;return r!=null&&r.fragments&&r.fragments.forEach(function(i){i.level=u}),d});this._levels=m,this.hls.trigger(_.Events.LEVELS_UPDATED,{levels:m})},y(t,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(l){var f,p=this._levels;if(p.length!==0&&!(this.currentLevelIndex===l&&(f=p[l])!==null&&f!==void 0&&f.details)){if(l<0||l>=p.length){var m=l<0;if(this.hls.trigger(_.Events.ERROR,{type:b.ErrorTypes.OTHER_ERROR,details:b.ErrorDetails.LEVEL_SWITCH_ERROR,level:l,fatal:m,reason:"invalid level idx"}),m)return;l=Math.min(l,p.length-1)}this.clearTimer();var d=this.currentLevelIndex,u=p[d],r=p[l];this.log("switching to level "+l+" from "+d),this.currentLevelIndex=l;var i=c({},r,{level:l,maxBitrate:r.maxBitrate,uri:r.uri,urlId:r.urlId});delete i._urlId,this.hls.trigger(_.Events.LEVEL_SWITCHING,i);var v=r.details;if(!v||v.live){var g=this.switchParams(r.uri,u==null?void 0:u.details);this.loadPlaylist(g)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(l){this.manualLevelIndex=l,this._startLevel===void 0&&(this._startLevel=l),l!==-1&&(this.level=l)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(l){this._firstLevel=l}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var l=this.hls.config.startLevel;return l!==void 0?l:this._firstLevel}else return this._startLevel},set:function(l){this._startLevel=l}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(l){this.level=l,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=l)}}]),t}(I.default)},"./src/controller/level-helper.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"addGroupId",function(){return b}),s.d(O,"assignTrackIdsByGroup",function(){return P}),s.d(O,"updatePTS",function(){return M}),s.d(O,"updateFragPTSDTS",function(){return D}),s.d(O,"mergeDetails",function(){return c}),s.d(O,"mapPartIntersection",function(){return T}),s.d(O,"mapFragmentIntersection",function(){return y}),s.d(O,"adjustSliding",function(){return E}),s.d(O,"addSliding",function(){return A}),s.d(O,"computeReloadInterval",function(){return S}),s.d(O,"getFragmentWithSN",function(){return n}),s.d(O,"getPartWith",function(){return e});var R=s("./src/polyfills/number.ts"),_=s("./src/utils/logger.ts");function b(t,a,h){switch(a){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(h);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(h);break}}function P(t){var a={};t.forEach(function(h){var l=h.groupId||"";h.id=a[l]=a[l]||0,a[l]++})}function M(t,a,h){var l=t[a],f=t[h];I(l,f)}function I(t,a){var h=a.startPTS;if(Object(R.isFiniteNumber)(h)){var l=0,f;a.sn>t.sn?(l=h-t.start,f=t):(l=t.start-h,f=a),f.duration!==l&&(f.duration=l)}else if(a.sn>t.sn){var p=t.cc===a.cc;p&&t.minEndPTS?a.start=t.start+(t.minEndPTS-t.start):a.start=t.start+t.duration}else a.start=Math.max(t.start-a.duration,0)}function D(t,a,h,l,f,p){var m=l-h;m<=0&&(_.logger.warn("Fragment should have a positive duration",a),l=h+a.duration,p=f+a.duration);var d=h,u=l,r=a.startPTS,i=a.endPTS;if(Object(R.isFiniteNumber)(r)){var v=Math.abs(r-h);Object(R.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(v,a.deltaPTS):a.deltaPTS=v,d=Math.max(h,r),h=Math.min(h,r),f=Math.min(f,a.startDTS),u=Math.min(l,i),l=Math.max(l,i),p=Math.max(p,a.endDTS)}a.duration=l-h;var g=h-a.start;a.appendedPTS=l,a.start=a.startPTS=h,a.maxStartPTS=d,a.startDTS=f,a.endPTS=l,a.minEndPTS=u,a.endDTS=p;var L=a.sn;if(!t||L<t.startSN||L>t.endSN)return 0;var C,k=L-t.startSN,U=t.fragments;for(U[k]=a,C=k;C>0;C--)I(U[C],U[C-1]);for(C=k;C<U.length-1;C++)I(U[C],U[C+1]);return t.fragmentHint&&I(U[U.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,g}function c(t,a){for(var h=null,l=t.fragments,f=l.length-1;f>=0;f--){var p=l[f].initSegment;if(p){h=p;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var m=0,d;if(y(t,a,function(L,C){var k;L.relurl&&(m=L.cc-C.cc),Object(R.isFiniteNumber)(L.startPTS)&&Object(R.isFiniteNumber)(L.endPTS)&&(C.start=C.startPTS=L.startPTS,C.startDTS=L.startDTS,C.appendedPTS=L.appendedPTS,C.maxStartPTS=L.maxStartPTS,C.endPTS=L.endPTS,C.endDTS=L.endDTS,C.minEndPTS=L.minEndPTS,C.duration=L.endPTS-L.startPTS,C.duration&&(d=C),a.PTSKnown=a.alignedSliding=!0),C.elementaryStreams=L.elementaryStreams,C.loader=L.loader,C.stats=L.stats,C.urlId=L.urlId,L.initSegment?(C.initSegment=L.initSegment,h=L.initSegment):(!C.initSegment||C.initSegment.relurl==((k=h)===null||k===void 0?void 0:k.relurl))&&(C.initSegment=h)}),a.skippedSegments&&(a.deltaUpdateFailed=a.fragments.some(function(L){return!L}),a.deltaUpdateFailed)){_.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=a.skippedSegments;u--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}var r=a.fragments;if(m){_.logger.warn("discontinuity sliding from playlist, take drift into account");for(var i=0;i<r.length;i++)r[i].cc+=m}a.skippedSegments&&(a.startCC=a.fragments[0].cc),T(t.partList,a.partList,function(L,C){C.elementaryStreams=L.elementaryStreams,C.stats=L.stats}),d?D(a,d,d.startPTS,d.endPTS,d.startDTS,d.endDTS):E(t,a),r.length&&(a.totalduration=a.edge-r[0].start),a.driftStartTime=t.driftStartTime,a.driftStart=t.driftStart;var v=a.advancedDateTime;if(a.advanced&&v){var g=a.edge;a.driftStart||(a.driftStartTime=v,a.driftStart=g),a.driftEndTime=v,a.driftEnd=g}else a.driftEndTime=t.driftEndTime,a.driftEnd=t.driftEnd,a.advancedDateTime=t.advancedDateTime}function T(t,a,h){if(t&&a)for(var l=0,f=0,p=t.length;f<=p;f++){var m=t[f],d=a[f+l];m&&d&&m.index===d.index&&m.fragment.sn===d.fragment.sn?h(m,d):l--}}function y(t,a,h){for(var l=a.skippedSegments,f=Math.max(t.startSN,a.startSN)-a.startSN,p=(t.fragmentHint?1:0)+(l?a.endSN:Math.min(t.endSN,a.endSN))-a.startSN,m=a.startSN-t.startSN,d=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,u=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,r=f;r<=p;r++){var i=u[m+r],v=d[r];l&&!v&&r<l&&(v=a.fragments[r]=i),i&&v&&h(i,v)}}function E(t,a){var h=a.startSN+a.skippedSegments-t.startSN,l=t.fragments;h<0||h>=l.length||A(a,l[h].start)}function A(t,a){if(a){for(var h=t.fragments,l=t.skippedSegments;l<h.length;l++)h[l].start+=a;t.fragmentHint&&(t.fragmentHint.start+=a)}}function S(t,a){var h=1e3*t.levelTargetDuration,l=h/2,f=t.age,p=f>0&&f<h*3,m=a.loading.end-a.loading.start,d,u=t.availabilityDelay;if(t.updated===!1)if(p){var r=333*t.misses;d=Math.max(Math.min(l,m*2),r),t.availabilityDelay=(t.availabilityDelay||0)+d}else d=l;else p?(u=Math.min(u||h/2,f),t.availabilityDelay=u,d=u+h-f):d=h-m;return Math.round(d)}function n(t,a,h){if(!t||!t.details)return null;var l=t.details,f=l.fragments[a-l.startSN];return f||(f=l.fragmentHint,f&&f.sn===a)?f:a<l.startSN&&h&&h.sn===a?h:null}function e(t,a,h){if(!t||!t.details)return null;var l=t.details.partList;if(l)for(var f=l.length;f--;){var p=l[f];if(p.index===h&&p.fragment.sn===a)return p}return null}},"./src/controller/stream-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return l});var R=s("./src/polyfills/number.ts"),_=s("./src/controller/base-stream-controller.ts"),b=s("./src/is-supported.ts"),P=s("./src/events.ts"),M=s("./src/utils/buffer-helper.ts"),I=s("./src/controller/fragment-tracker.ts"),D=s("./src/types/loader.ts"),c=s("./src/loader/fragment.ts"),T=s("./src/demux/transmuxer-interface.ts"),y=s("./src/types/transmuxer.ts"),E=s("./src/controller/gap-controller.ts"),A=s("./src/errors.ts"),S=s("./src/utils/logger.ts");function n(f,p){for(var m=0;m<p.length;m++){var d=p[m];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(f,d.key,d)}}function e(f,p,m){return p&&n(f.prototype,p),m&&n(f,m),f}function t(f,p){f.prototype=Object.create(p.prototype),f.prototype.constructor=f,a(f,p)}function a(f,p){return a=Object.setPrototypeOf||function(d,u){return d.__proto__=u,d},a(f,p)}var h=100,l=function(f){t(p,f);function p(d,u){var r;return r=f.call(this,d,u,"[stream-controller]")||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.stalled=!1,r.couldBacktrack=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}var m=p.prototype;return m._registerListeners=function(){var u=this.hls;u.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.on(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.on(P.Events.ERROR,this.onError,this),u.on(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.on(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.on(P.Events.BUFFER_CREATED,this.onBufferCreated,this),u.on(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.on(P.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var u=this.hls;u.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),u.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),u.off(P.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),u.off(P.Events.ERROR,this.onError,this),u.off(P.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),u.off(P.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),u.off(P.Events.BUFFER_CREATED,this.onBufferCreated,this),u.off(P.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),u.off(P.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),u.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},m.startLoad=function(u){if(this.levels){var r=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(h),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var v=i.startLevel;v===-1&&(i.config.testBandwidth?(v=0,this.bitrateTest=!0):v=i.nextAutoLevel),this.level=i.nextLoadLevel=v,this.loadedmetadata=!1}r>0&&u===-1&&(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),u=r),this.state=_.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=u,this.tick()}else this._forceStartLoad=!0,this.state=_.State.STOPPED},m.stopLoad=function(){this._forceStartLoad=!1,f.prototype.stopLoad.call(this)},m.doTick=function(){switch(this.state){case _.State.IDLE:this.doTickIdle();break;case _.State.WAITING_LEVEL:{var u,r=this.levels,i=this.level,v=r==null||(u=r[i])===null||u===void 0?void 0:u.details;if(v&&(!v.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(v))break;this.state=_.State.IDLE;break}break}case _.State.FRAG_LOADING_WAITING_RETRY:{var g,L=self.performance.now(),C=this.retryDate;(!C||L>=C||(g=this.media)!==null&&g!==void 0&&g.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=_.State.IDLE)}break;default:break}this.onTickEnd()},m.onTickEnd=function(){f.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},m.doTickIdle=function(){var u,r,i=this.hls,v=this.levelLastLoaded,g=this.levels,L=this.media,C=i.config,k=i.nextLoadLevel;if(!(v===null||!L&&(this.startFragRequested||!C.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!g||!g[k])){var U=g[k];this.level=i.nextLoadLevel=k;var F=U.details;if(!F||this.state===_.State.WAITING_LEVEL||F.live&&this.levelLastLoaded!==k){this.state=_.State.WAITING_LEVEL;return}var B=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:L,D.PlaylistLevelType.MAIN);if(B!==null){var N=B.len,K=this.getMaxBufferLength(U.maxBitrate);if(!(N>=K)){if(this._streamEnded(B,F)){var H={};this.altAudio&&(H.type="video"),this.hls.trigger(P.Events.BUFFER_EOS,H),this.state=_.State.ENDED;return}var j=B.end,W=this.getNextFragment(j,F);if(this.couldBacktrack&&!this.fragPrevious&&W&&W.sn!=="initSegment"){var V=W.sn-F.startSN;V>1&&(W=F.fragments[V-1],this.fragmentTracker.removeFragment(W))}if(W&&this.fragmentTracker.getState(W)===I.FragmentState.OK&&this.nextLoadPosition>j){var $=this.audioOnly&&!this.altAudio?c.ElementaryStreamTypes.AUDIO:c.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(L,$,D.PlaylistLevelType.MAIN),W=this.getNextFragment(this.nextLoadPosition,F)}!W||(W.initSegment&&!W.initSegment.data&&!this.bitrateTest&&(W=W.initSegment),((u=W.decryptdata)===null||u===void 0?void 0:u.keyFormat)==="identity"&&!((r=W.decryptdata)!==null&&r!==void 0&&r.key)?this.loadKey(W,F):this.loadFragment(W,F,j))}}}},m.loadFragment=function(u,r,i){var v,g=this.fragmentTracker.getState(u);if(this.fragCurrent=u,g===I.FragmentState.BACKTRACKED){var L=this.fragmentTracker.getBacktrackData(u);if(L){this._handleFragmentLoadProgress(L),this._handleFragmentLoadComplete(L);return}else g=I.FragmentState.NOT_LOADED}g===I.FragmentState.NOT_LOADED||g===I.FragmentState.PARTIAL?u.sn==="initSegment"?this._loadInitSegment(u):this.bitrateTest?(u.bitrateTest=!0,this.log("Fragment "+u.sn+" of level "+u.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(u)):(this.startFragRequested=!0,f.prototype.loadFragment.call(this,u,r,i)):g===I.FragmentState.APPENDING?this.reduceMaxBufferLength(u.duration)&&this.fragmentTracker.removeFragment(u):((v=this.media)===null||v===void 0?void 0:v.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},m.getAppendedFrag=function(u){var r=this.fragmentTracker.getAppendedFrag(u,D.PlaylistLevelType.MAIN);return r&&"fragment"in r?r.fragment:r},m.getBufferedFrag=function(u){return this.fragmentTracker.getBufferedFrag(u,D.PlaylistLevelType.MAIN)},m.followingBufferedFrag=function(u){return u?this.getBufferedFrag(u.end+.5):null},m.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},m.nextLevelSwitch=function(){var u=this.levels,r=this.media;if(r!=null&&r.readyState){var i,v=this.getAppendedFrag(r.currentTime);if(v&&v.start>1&&this.flushMainBuffer(0,v.start-1),!r.paused&&u){var g=this.hls.nextLoadLevel,L=u[g],C=this.fragLastKbps;C&&this.fragCurrent?i=this.fragCurrent.duration*L.maxBitrate/(1e3*C)+1:i=0}else i=0;var k=this.getBufferedFrag(r.currentTime+i);if(k){var U=this.followingBufferedFrag(k);if(U){this.abortCurrentFrag();var F=U.maxStartPTS?U.maxStartPTS:U.start,B=U.duration,N=Math.max(k.end,F+Math.min(Math.max(B-this.config.maxFragLookUpTolerance,B*.5),B*.75));this.flushMainBuffer(N,Number.POSITIVE_INFINITY)}}}},m.abortCurrentFrag=function(){var u=this.fragCurrent;this.fragCurrent=null,u!=null&&u.loader&&u.loader.abort(),this.state===_.State.KEY_LOADING&&(this.state=_.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},m.flushMainBuffer=function(u,r){f.prototype.flushMainBuffer.call(this,u,r,this.altAudio?"video":null)},m.onMediaAttached=function(u,r){f.prototype.onMediaAttached.call(this,u,r);var i=r.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),i.addEventListener("playing",this.onvplaying),i.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,i,this.fragmentTracker,this.hls)},m.onMediaDetaching=function(){var u=this.media;u&&(u.removeEventListener("playing",this.onvplaying),u.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),f.prototype.onMediaDetaching.call(this)},m.onMediaPlaying=function(){this.tick()},m.onMediaSeeked=function(){var u=this.media,r=u?u.currentTime:null;Object(R.isFiniteNumber)(r)&&this.log("Media seeked to "+r.toFixed(3)),this.tick()},m.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(P.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},m.onManifestParsed=function(u,r){var i=!1,v=!1,g;r.levels.forEach(function(L){g=L.audioCodec,g&&(g.indexOf("mp4a.40.2")!==-1&&(i=!0),g.indexOf("mp4a.40.5")!==-1&&(v=!0))}),this.audioCodecSwitch=i&&v&&!Object(b.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=r.levels,this.startFragRequested=!1},m.onLevelLoading=function(u,r){var i=this.levels;if(!(!i||this.state!==_.State.IDLE)){var v=i[r.level];(!v.details||v.details.live&&this.levelLastLoaded!==r.level||this.waitForCdnTuneIn(v.details))&&(this.state=_.State.WAITING_LEVEL)}},m.onLevelLoaded=function(u,r){var i,v=this.levels,g=r.level,L=r.details,C=L.totalduration;if(!v){this.warn("Levels were reset while loading level "+g);return}this.log("Level "+g+" loaded ["+L.startSN+","+L.endSN+"], cc ["+L.startCC+", "+L.endCC+"] duration:"+C);var k=this.fragCurrent;k&&(this.state===_.State.FRAG_LOADING||this.state===_.State.FRAG_LOADING_WAITING_RETRY)&&k.level!==r.level&&k.loader&&(this.state=_.State.IDLE,k.loader.abort());var U=v[g],F=0;if(L.live||(i=U.details)!==null&&i!==void 0&&i.live){if(L.fragments[0]||(L.deltaUpdateFailed=!0),L.deltaUpdateFailed)return;F=this.alignPlaylists(L,U.details)}if(U.details=L,this.levelLastLoaded=g,this.hls.trigger(P.Events.LEVEL_UPDATED,{details:L,level:g}),this.state===_.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(L))return;this.state=_.State.IDLE}this.startFragRequested?L.live&&this.synchronizeToLiveEdge(L):this.setStartPosition(L,F),this.tick()},m._handleFragmentLoadProgress=function(u){var r,i=u.frag,v=u.part,g=u.payload,L=this.levels;if(!L){this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered");return}var C=L[i.level],k=C.details;if(!k){this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset");return}var U=C.videoCodec,F=k.PTSKnown||!k.live,B=(r=i.initSegment)===null||r===void 0?void 0:r.data,N=this._getAudioCodec(C),K=this.transmuxer=this.transmuxer||new T.default(this.hls,D.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),H=v?v.index:-1,j=H!==-1,W=new y.ChunkMetadata(i.level,i.sn,i.stats.chunkCount,g.byteLength,H,j),V=this.initPTS[i.cc];K.push(g,B,N,U,i,v,k.totalduration,F,W,V)},m.onAudioTrackSwitching=function(u,r){var i=this.altAudio,v=!!r.url,g=r.id;if(!v){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var L=this.fragCurrent;L!=null&&L.loader&&(this.log("Switching to main audio track, cancel main fragment load"),L.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var C=this.hls;i&&C.trigger(P.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),C.trigger(P.Events.AUDIO_TRACK_SWITCHED,{id:g})}},m.onAudioTrackSwitched=function(u,r){var i=r.id,v=!!this.hls.audioTracks[i].url;if(v){var g=this.videoBuffer;g&&this.mediaBuffer!==g&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=g)}this.altAudio=v,this.tick()},m.onBufferCreated=function(u,r){var i=r.tracks,v,g,L=!1;for(var C in i){var k=i[C];if(k.id==="main"){if(g=C,v=k,C==="video"){var U=i[C];U&&(this.videoBuffer=U.buffer)}}else L=!0}L&&v?(this.log("Alternate track found, use "+g+".buffered to schedule main fragment loading"),this.mediaBuffer=v.buffer):this.mediaBuffer=this.media},m.onFragBuffered=function(u,r){var i=r.frag,v=r.part;if(!(i&&i.type!==D.PlaylistLevelType.MAIN)){if(this.fragContextChanged(i)){this.warn("Fragment "+i.sn+(v?" p: "+v.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),this.state===_.State.PARSED&&(this.state=_.State.IDLE);return}var g=v?v.stats:i.stats;this.fragLastKbps=Math.round(8*g.total/(g.buffering.end-g.loading.first)),i.sn!=="initSegment"&&(this.fragPrevious=i),this.fragBufferedComplete(i,v)}},m.onError=function(u,r){switch(r.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(D.PlaylistLevelType.MAIN,r);break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==_.State.ERROR&&(r.fatal?(this.warn(""+r.details),this.state=_.State.ERROR):!r.levelRetry&&this.state===_.State.WAITING_LEVEL&&(this.state=_.State.IDLE));break;case A.ErrorDetails.BUFFER_FULL_ERROR:if(r.parent==="main"&&(this.state===_.State.PARSING||this.state===_.State.PARSED)){var i=!0,v=this.getFwdBufferInfo(this.media,D.PlaylistLevelType.MAIN);v&&v.len>.5&&(i=!this.reduceMaxBufferLength(v.len)),i&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},m.checkBuffer=function(){var u=this.media,r=this.gapController;if(!(!u||!r||!u.readyState)){var i=M.BufferHelper.getBuffered(u);!this.loadedmetadata&&i.length?(this.loadedmetadata=!0,this.seekToStartPos()):r.poll(this.lastCurrentTime),this.lastCurrentTime=u.currentTime}},m.onFragLoadEmergencyAborted=function(){this.state=_.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},m.onBufferFlushed=function(u,r){var i=r.type;if(i!==c.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var v=(i===c.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(v,i,D.PlaylistLevelType.MAIN)}},m.onLevelsUpdated=function(u,r){this.levels=r.levels},m.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},m.seekToStartPos=function(){var u=this.media,r=u.currentTime,i=this.startPosition;if(i>=0&&r<i){if(u.seeking){S.logger.log("could not seek to "+i+", already seeking at "+r);return}var v=M.BufferHelper.getBuffered(u),g=v.length?v.start(0):0,L=g-i;L>0&&(L<this.config.maxBufferHole||L<this.config.maxFragLookUpTolerance)&&(S.logger.log("adjusting start position by "+L+" to match buffer start"),i+=L,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+r),u.currentTime=i}},m._getAudioCodec=function(u){var r=this.config.defaultAudioCodec||u.audioCodec;return this.audioCodecSwap&&r&&(this.log("Swapping audio codec"),r.indexOf("mp4a.40.5")!==-1?r="mp4a.40.2":r="mp4a.40.5"),r},m._loadBitrateTestFrag=function(u){var r=this;this._doFragLoad(u).then(function(i){var v=r.hls;if(!(!i||v.nextLoadLevel||r.fragContextChanged(u))){r.fragLoadError=0,r.state=_.State.IDLE,r.startFragRequested=!1,r.bitrateTest=!1;var g=u.stats;g.parsing.start=g.parsing.end=g.buffering.start=g.buffering.end=self.performance.now(),v.trigger(P.Events.FRAG_LOADED,i)}})},m._handleTransmuxComplete=function(u){var r,i="main",v=this.hls,g=u.remuxResult,L=u.chunkMeta,C=this.getCurrentContext(L);if(!C){this.warn("The loading context changed while buffering fragment "+L.sn+" of level "+L.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(L.level);return}var k=C.frag,U=C.part,F=C.level,B=g.video,N=g.text,K=g.id3,H=g.initSegment,j=this.altAudio?void 0:g.audio;if(!this.fragContextChanged(k)){if(this.state=_.State.PARSING,H){H.tracks&&(this._bufferInitSegment(F,H.tracks,k,L),v.trigger(P.Events.FRAG_PARSING_INIT_SEGMENT,{frag:k,id:i,tracks:H.tracks}));var W=H.initPTS,V=H.timescale;Object(R.isFiniteNumber)(W)&&(this.initPTS[k.cc]=W,v.trigger(P.Events.INIT_PTS_FOUND,{frag:k,id:i,initPTS:W,timescale:V}))}if(B&&g.independent!==!1){if(F.details){var $=B.startPTS,Y=B.endPTS,Q=B.startDTS,J=B.endDTS;if(U)U.elementaryStreams[B.type]={startPTS:$,endPTS:Y,startDTS:Q,endDTS:J};else if(B.firstKeyFrame&&B.independent&&(this.couldBacktrack=!0),B.dropped&&B.independent){var ie=this.getLoadPosition()+this.config.maxBufferHole;if(ie<$){this.backtrack(k);return}k.setElementaryStreamInfo(B.type,k.start,Y,k.start,J,!0)}k.setElementaryStreamInfo(B.type,$,Y,Q,J),this.bufferFragmentData(B,k,U,L)}}else if(g.independent===!1){this.backtrack(k);return}if(j){var q=j.startPTS,ne=j.endPTS,ge=j.startDTS,ee=j.endDTS;U&&(U.elementaryStreams[c.ElementaryStreamTypes.AUDIO]={startPTS:q,endPTS:ne,startDTS:ge,endDTS:ee}),k.setElementaryStreamInfo(c.ElementaryStreamTypes.AUDIO,q,ne,ge,ee),this.bufferFragmentData(j,k,U,L)}if(K!=null&&(r=K.samples)!==null&&r!==void 0&&r.length){var te={frag:k,id:i,samples:K.samples};v.trigger(P.Events.FRAG_PARSING_METADATA,te)}if(N){var z={frag:k,id:i,samples:N.samples};v.trigger(P.Events.FRAG_PARSING_USERDATA,z)}}},m._bufferInitSegment=function(u,r,i,v){var g=this;if(this.state===_.State.PARSING){this.audioOnly=!!r.audio&&!r.video,this.altAudio&&!this.audioOnly&&delete r.audio;var L=r.audio,C=r.video,k=r.audiovideo;if(L){var U=u.audioCodec,F=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(U&&(U.indexOf("mp4a.40.5")!==-1?U="mp4a.40.2":U="mp4a.40.5"),L.metadata.channelCount!==1&&F.indexOf("firefox")===-1&&(U="mp4a.40.5")),F.indexOf("android")!==-1&&L.container!=="audio/mpeg"&&(U="mp4a.40.2",this.log("Android: force audio codec to "+U)),u.audioCodec&&u.audioCodec!==U&&this.log('Swapping manifest audio codec "'+u.audioCodec+'" for "'+U+'"'),L.levelCodec=U,L.id="main",this.log("Init audio buffer, container:"+L.container+", codecs[selected/level/parsed]=["+(U||"")+"/"+(u.audioCodec||"")+"/"+L.codec+"]")}C&&(C.levelCodec=u.videoCodec,C.id="main",this.log("Init video buffer, container:"+C.container+", codecs[level/parsed]=["+(u.videoCodec||"")+"/"+C.codec+"]")),k&&this.log("Init audiovideo buffer, container:"+k.container+", codecs[level/parsed]=["+(u.attrs.CODECS||"")+"/"+k.codec+"]"),this.hls.trigger(P.Events.BUFFER_CODECS,r),Object.keys(r).forEach(function(B){var N=r[B],K=N.initSegment;K!=null&&K.byteLength&&g.hls.trigger(P.Events.BUFFER_APPENDING,{type:B,data:K,frag:i,part:null,chunkMeta:v,parent:i.type})}),this.tick()}},m.backtrack=function(u){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(u);var r=this.fragmentTracker.backtrack(u);this.fragPrevious=null,this.nextLoadPosition=u.start,r?this.resetFragmentLoading(u):this.state=_.State.BACKTRACKING},m.checkFragmentChanged=function(){var u=this.media,r=null;if(u&&u.readyState>1&&u.seeking===!1){var i=u.currentTime;if(M.BufferHelper.isBuffered(u,i)?r=this.getAppendedFrag(i):M.BufferHelper.isBuffered(u,i+.1)&&(r=this.getAppendedFrag(i+.1)),r){var v=this.fragPlaying,g=r.level;(!v||r.sn!==v.sn||v.level!==g||r.urlId!==v.urlId)&&(this.hls.trigger(P.Events.FRAG_CHANGED,{frag:r}),(!v||v.level!==g)&&this.hls.trigger(P.Events.LEVEL_SWITCHED,{level:g}),this.fragPlaying=r)}}},e(p,[{key:"nextLevel",get:function(){var u=this.nextBufferedFrag;return u?u.level:-1}},{key:"currentLevel",get:function(){var u=this.media;if(u){var r=this.getAppendedFrag(u.currentTime);if(r)return r.level}return-1}},{key:"nextBufferedFrag",get:function(){var u=this.media;if(u){var r=this.getAppendedFrag(u.currentTime);return this.followingBufferedFrag(r)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),p}(_.default)},"./src/controller/subtitle-stream-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"SubtitleStreamController",function(){return t});var R=s("./src/events.ts"),_=s("./src/utils/logger.ts"),b=s("./src/utils/buffer-helper.ts"),P=s("./src/controller/fragment-finders.ts"),M=s("./src/utils/discontinuities.ts"),I=s("./src/controller/level-helper.ts"),D=s("./src/controller/fragment-tracker.ts"),c=s("./src/controller/base-stream-controller.ts"),T=s("./src/types/loader.ts"),y=s("./src/types/level.ts");function E(a,h){for(var l=0;l<h.length;l++){var f=h[l];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(a,f.key,f)}}function A(a,h,l){return h&&E(a.prototype,h),l&&E(a,l),a}function S(a,h){a.prototype=Object.create(h.prototype),a.prototype.constructor=a,n(a,h)}function n(a,h){return n=Object.setPrototypeOf||function(f,p){return f.__proto__=p,f},n(a,h)}var e=500,t=function(a){S(h,a);function h(f,p){var m;return m=a.call(this,f,p,"[subtitle-stream-controller]")||this,m.levels=[],m.currentTrackId=-1,m.tracksBuffered=[],m.mainDetails=null,m._registerListeners(),m}var l=h.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var p=this.hls;p.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.on(R.Events.ERROR,this.onError,this),p.on(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.on(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.on(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var p=this.hls;p.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),p.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),p.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),p.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),p.off(R.Events.ERROR,this.onError,this),p.off(R.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),p.off(R.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),p.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),p.off(R.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),p.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=c.State.IDLE,this.setInterval(e),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(p,m){this.mainDetails=m.details},l.onSubtitleFragProcessed=function(p,m){var d=m.frag,u=m.success;if(this.fragPrevious=d,this.state=c.State.IDLE,!!u){var r=this.tracksBuffered[this.currentTrackId];if(!!r){for(var i,v=d.start,g=0;g<r.length;g++)if(v>=r[g].start&&v<=r[g].end){i=r[g];break}var L=d.start+d.duration;i?i.end=L:(i={start:v,end:L},r.push(i)),this.fragmentTracker.fragBuffered(d)}}},l.onBufferFlushing=function(p,m){var d=m.startOffset,u=m.endOffset;if(d===0&&u!==Number.POSITIVE_INFINITY){var r=this.currentTrackId,i=this.levels;if(!i.length||!i[r]||!i[r].details)return;var v=i[r].details,g=v.targetduration,L=u-g;if(L<=0)return;m.endOffsetSubtitles=Math.max(0,L),this.tracksBuffered.forEach(function(C){for(var k=0;k<C.length;){if(C[k].end<=L){C.shift();continue}else if(C[k].start<L)C[k].start=L;else break;k++}}),this.fragmentTracker.removeFragmentsInRange(d,L,T.PlaylistLevelType.SUBTITLE)}},l.onError=function(p,m){var d,u=m.frag;!u||u.type!==T.PlaylistLevelType.SUBTITLE||((d=this.fragCurrent)!==null&&d!==void 0&&d.loader&&this.fragCurrent.loader.abort(),this.state=c.State.IDLE)},l.onSubtitleTracksUpdated=function(p,m){var d=this,u=m.subtitleTracks;this.tracksBuffered=[],this.levels=u.map(function(r){return new y.Level(r)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(r){d.tracksBuffered[r.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(p,m){if(this.currentTrackId=m.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var d=this.levels[this.currentTrackId];d!=null&&d.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(e)):this.mediaBuffer=null},l.onSubtitleTrackLoaded=function(p,m){var d,u=m.details,r=m.id,i=this.currentTrackId,v=this.levels;if(!!v.length){var g=v[i];if(!(r>=v.length||r!==i||!g)){if(this.mediaBuffer=this.mediaBufferTimeRanges,u.live||(d=g.details)!==null&&d!==void 0&&d.live){var L=this.mainDetails;if(u.deltaUpdateFailed||!L)return;var C=L.fragments[0];if(!g.details)u.hasProgramDateTime&&L.hasProgramDateTime?Object(M.alignMediaPlaylistByPDT)(u,L):C&&Object(I.addSliding)(u,C.start);else{var k=this.alignPlaylists(u,g.details);k===0&&C&&Object(I.addSliding)(u,C.start)}}if(g.details=u,this.levelLastLoaded=r,this.tick(),u.live&&!this.fragCurrent&&this.media&&this.state===c.State.IDLE){var U=Object(P.findFragmentByPTS)(null,u.fragments,this.media.currentTime,0);U||(this.warn("Subtitle playlist not aligned with playback"),g.details=void 0)}}}},l._handleFragmentLoadComplete=function(p){var m=p.frag,d=p.payload,u=m.decryptdata,r=this.hls;if(!this.fragContextChanged(m)&&d&&d.byteLength>0&&u&&u.key&&u.iv&&u.method==="AES-128"){var i=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(d),u.key.buffer,u.iv.buffer).then(function(v){var g=performance.now();r.trigger(R.Events.FRAG_DECRYPTED,{frag:m,payload:v,stats:{tstart:i,tdecrypt:g}})})}},l.doTick=function(){if(!this.media){this.state=c.State.IDLE;return}if(this.state===c.State.IDLE){var p,m=this.currentTrackId,d=this.levels;if(!d.length||!d[m]||!d[m].details)return;var u=d[m].details,r=u.targetduration,i=this.config,v=this.media,g=b.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,v.currentTime-r,i.maxBufferHole),L=g.end,C=g.len,k=this.getMaxBufferLength()+r;if(C>k)return;console.assert(u,"Subtitle track details are defined on idle subtitle stream controller tick");var U=u.fragments,F=U.length,B=u.edge,N,K=this.fragPrevious;if(L<B){var H=i.maxFragLookUpTolerance;K&&u.hasProgramDateTime&&(N=Object(P.findFragmentByPDT)(U,K.endProgramDateTime,H)),N||(N=Object(P.findFragmentByPTS)(K,U,L,H),!N&&K&&K.start<U[0].start&&(N=U[0]))}else N=U[F-1];(p=N)!==null&&p!==void 0&&p.encrypted?(_.logger.log("Loading key for "+N.sn),this.state=c.State.KEY_LOADING,this.hls.trigger(R.Events.KEY_LOADING,{frag:N})):N&&this.fragmentTracker.getState(N)===D.FragmentState.NOT_LOADED&&this.loadFragment(N,u,L)}},l.loadFragment=function(p,m,d){this.fragCurrent=p,a.prototype.loadFragment.call(this,p,m,d)},A(h,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),h}(c.default)},"./src/controller/subtitle-track-controller.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/events.ts"),_=s("./src/utils/texttrack-utils.ts"),b=s("./src/controller/base-playlist-controller.ts"),P=s("./src/types/loader.ts");function M(E,A){for(var S=0;S<A.length;S++){var n=A[S];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(E,n.key,n)}}function I(E,A,S){return A&&M(E.prototype,A),S&&M(E,S),E}function D(E,A){E.prototype=Object.create(A.prototype),E.prototype.constructor=E,c(E,A)}function c(E,A){return c=Object.setPrototypeOf||function(n,e){return n.__proto__=e,n},c(E,A)}var T=function(E){D(A,E);function A(n){var e;return e=E.call(this,n,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}var S=A.prototype;return S.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,E.prototype.destroy.call(this)},S.registerListeners=function(){var e=this.hls;e.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(R.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){var e=this.hls;e.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(R.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(R.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(R.Events.ERROR,this.onError,this)},S.onMediaAttached=function(e,t){this.media=t.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},S.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},S.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=y(this.media.textTracks);e.forEach(function(t){Object(_.clearCurrentCues)(t)}),this.subtitleTrack=-1,this.media=null}},S.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},S.onManifestParsed=function(e,t){this.tracks=t.subtitleTracks},S.onSubtitleTrackLoaded=function(e,t){var a=t.id,h=t.details,l=this.trackId,f=this.tracksInGroup[l];if(!f){this.warn("Invalid subtitle track id "+a);return}var p=f.details;f.details=t.details,this.log("subtitle track "+a+" loaded ["+h.startSN+"-"+h.endSN+"]"),a===this.trackId&&(this.retryCount=0,this.playlistLoaded(a,t,p))},S.onLevelLoading=function(e,t){this.switchLevel(t.level)},S.onLevelSwitching=function(e,t){this.switchLevel(t.level)},S.switchLevel=function(e){var t=this.hls.levels[e];if(!!(t!=null&&t.textGroupIds)){var a=t.textGroupIds[t.urlId];if(this.groupId!==a){var h=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,l=this.tracks.filter(function(m){return!a||m.groupId===a});this.tracksInGroup=l;var f=this.findTrackId(h==null?void 0:h.name)||this.findTrackId();this.groupId=a;var p={subtitleTracks:l};this.log("Updating subtitle tracks, "+l.length+' track(s) found in "'+a+'" group-id'),this.hls.trigger(R.Events.SUBTITLE_TRACKS_UPDATED,p),f!==-1&&this.setSubtitleTrack(f,h)}}},S.findTrackId=function(e){for(var t=this.tracksInGroup,a=0;a<t.length;a++){var h=t[a];if((!this.selectDefaultTrack||h.default)&&(!e||e===h.name))return h.id}return-1},S.onError=function(e,t){E.prototype.onError.call(this,e,t),!(t.fatal||!t.context)&&t.context.type===P.PlaylistContextType.SUBTITLE_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},S.loadPlaylist=function(e){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var a=t.id,h=t.groupId,l=t.url;if(e)try{l=e.addDirectives(l)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Loading subtitle playlist for id "+a),this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADING,{url:l,id:a,groupId:h,deliveryDirectives:e||null})}},S.toggleTrackModes=function(e){var t=this,a=this.media,h=this.subtitleDisplay,l=this.trackId;if(!!a){var f=y(a.textTracks),p=f.filter(function(u){return u.groupId===t.groupId});if(e===-1)[].slice.call(f).forEach(function(u){u.mode="disabled"});else{var m=p[l];m&&(m.mode="disabled")}var d=p[e];d&&(d.mode=h?"showing":"hidden")}},S.setSubtitleTrack=function(e,t){var a,h=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(a=h[e])!==null&&a!==void 0&&a.details)||e<-1||e>=h.length)){this.clearTimer();var l=h[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,l){var f=l.id,p=l.groupId,m=p===void 0?"":p,d=l.name,u=l.type,r=l.url;this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:f,groupId:m,name:d,type:u,url:r});var i=this.switchParams(l.url,t==null?void 0:t.details);this.loadPlaylist(i)}else this.hls.trigger(R.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},S.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,t=y(this.media.textTracks),a=0;a<t.length;a++)if(t[a].mode==="hidden")e=a;else if(t[a].mode==="showing"){e=a;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},I(A,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var t=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,t)}}]),A}(b.default);function y(E){for(var A=[],S=0;S<E.length;S++){var n=E[S];n.kind==="subtitles"&&n.label&&A.push(E[S])}return A}O.default=T},"./src/controller/timeline-controller.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"TimelineController",function(){return y});var R=s("./src/polyfills/number.ts"),_=s("./src/events.ts"),b=s("./src/utils/cea-608-parser.ts"),P=s("./src/utils/output-filter.ts"),M=s("./src/utils/webvtt-parser.ts"),I=s("./src/utils/texttrack-utils.ts"),D=s("./src/utils/imsc1-ttml-parser.ts"),c=s("./src/types/loader.ts"),T=s("./src/utils/logger.ts"),y=function(){function n(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=S(),this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var a=new P.default(this,"textTrack1"),h=new P.default(this,"textTrack2"),l=new P.default(this,"textTrack3"),f=new P.default(this,"textTrack4");this.cea608Parser1=new b.default(1,a,h),this.cea608Parser2=new b.default(3,l,f)}t.on(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(_.Events.FRAG_LOADING,this.onFragLoading,this),t.on(_.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=n.prototype;return e.destroy=function(){var a=this.hls;a.off(_.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),a.off(_.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(_.Events.MANIFEST_LOADED,this.onManifestLoaded,this),a.off(_.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(_.Events.FRAG_LOADING,this.onFragLoading,this),a.off(_.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(_.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),a.off(_.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),a.off(_.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(_.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),a.off(_.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(a,h,l,f,p){for(var m=!1,d=p.length;d--;){var u=p[d],r=A(u[0],u[1],h,l);if(r>=0&&(u[0]=Math.min(u[0],h),u[1]=Math.max(u[1],l),m=!0,r/(l-h)>.5))return}if(m||p.push([h,l]),this.config.renderTextTracksNatively){var i=this.captionsTracks[a];this.Cues.newCue(i,h,l,f)}else{var v=this.Cues.newCue(null,h,l,f);this.hls.trigger(_.Events.CUES_PARSED,{type:"captions",cues:v,track:a})}},e.onInitPtsFound=function(a,h){var l=this,f=h.frag,p=h.id,m=h.initPTS,d=h.timescale,u=this.unparsedVttFrags;p==="main"&&(this.initPTS[f.cc]=m,this.timescale[f.cc]=d),u.length&&(this.unparsedVttFrags=[],u.forEach(function(r){l.onFragLoaded(_.Events.FRAG_LOADED,r)}))},e.getExistingTrack=function(a){var h=this.media;if(h)for(var l=0;l<h.textTracks.length;l++){var f=h.textTracks[l];if(f[a])return f}return null},e.createCaptionsTrack=function(a){this.config.renderTextTracksNatively?this.createNativeTrack(a):this.createNonNativeTrack(a)},e.createNativeTrack=function(a){if(!this.captionsTracks[a]){var h=this.captionsProperties,l=this.captionsTracks,f=this.media,p=h[a],m=p.label,d=p.languageCode,u=this.getExistingTrack(a);if(u)l[a]=u,Object(I.clearCurrentCues)(l[a]),Object(I.sendAddTrackEvent)(l[a],f);else{var r=this.createTextTrack("captions",m,d);r&&(r[a]=!0,l[a]=r)}}},e.createNonNativeTrack=function(a){if(!this.nonNativeCaptionsTracks[a]){var h=this.captionsProperties[a];if(!!h){var l=h.label,f={_id:a,label:l,kind:"captions",default:h.media?!!h.media.default:!1,closedCaptions:h.media};this.nonNativeCaptionsTracks[a]=f,this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[f]})}}},e.createTextTrack=function(a,h,l){var f=this.media;if(!!f)return f.addTextTrack(a,h,l)},e.onMediaAttaching=function(a,h){this.media=h.media,this._cleanTracks()},e.onMediaDetaching=function(){var a=this.captionsTracks;Object.keys(a).forEach(function(h){Object(I.clearCurrentCues)(a[h]),delete a[h]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=S(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var a=this.media;if(!!a){var h=a.textTracks;if(h)for(var l=0;l<h.length;l++)Object(I.clearCurrentCues)(h[l])}},e.onSubtitleTracksUpdated=function(a,h){var l=this;this.textTracks=[];var f=h.subtitleTracks||[],p=f.some(function(r){return r.textCodec===D.IMSC1_CODEC});if(this.config.enableWebVTT||p&&this.config.enableIMSC1){var m=this.tracks&&f&&this.tracks.length===f.length;if(this.tracks=f||[],this.config.renderTextTracksNatively){var d=this.media?this.media.textTracks:[];this.tracks.forEach(function(r,i){var v;if(i<d.length){for(var g=null,L=0;L<d.length;L++)if(E(d[L],r)){g=d[L];break}g&&(v=g)}v?Object(I.clearCurrentCues)(v):(v=l.createTextTrack("subtitles",r.name,r.lang),v&&(v.mode="disabled")),v&&(v.groupId=r.groupId,l.textTracks.push(v))})}else if(!m&&this.tracks&&this.tracks.length){var u=this.tracks.map(function(r){return{label:r.name,kind:r.type.toLowerCase(),default:r.default,subtitleTrack:r}});this.hls.trigger(_.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:u})}}},e.onManifestLoaded=function(a,h){var l=this;this.config.enableCEA708Captions&&h.captions&&h.captions.forEach(function(f){var p=/(?:CC|SERVICE)([1-4])/.exec(f.instreamId);if(!!p){var m="textTrack"+p[1],d=l.captionsProperties[m];!d||(d.label=f.name,f.lang&&(d.languageCode=f.lang),d.media=f)}})},e.onFragLoading=function(a,h){var l=this.cea608Parser1,f=this.cea608Parser2,p=this.lastSn;if(!(!this.enabled||!(l&&f))&&h.frag.type===c.PlaylistLevelType.MAIN){var m=h.frag.sn;m!==p+1&&(l.reset(),f.reset()),this.lastSn=m}},e.onFragLoaded=function(a,h){var l=h.frag,f=h.payload,p=this.initPTS,m=this.unparsedVttFrags;if(l.type===c.PlaylistLevelType.SUBTITLE)if(f.byteLength){if(!Object(R.isFiniteNumber)(p[l.cc])){m.push(h),p.length&&this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:new Error("Missing initial subtitle PTS")});return}var d=l.decryptdata;if(d==null||d.key==null||d.method!=="AES-128"){var u=this.tracks[l.level],r=this.vttCCs;r[l.cc]||(r[l.cc]={start:l.start,prevCC:this.prevCC,new:!0},this.prevCC=l.cc),u&&u.textCodec===D.IMSC1_CODEC?this._parseIMSC1(l,f):this._parseVTTs(l,f,r)}}else this.hls.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(a,h){var l=this,f=this.hls;Object(D.parseIMSC1)(h,this.initPTS[a.cc],this.timescale[a.cc],function(p){l._appendCues(p,a.level),f.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(p){T.logger.log("Failed to parse IMSC1: "+p),f.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:p})})},e._parseVTTs=function(a,h,l){var f=this,p=this.hls;Object(M.parseWebVTT)(h,this.initPTS[a.cc],this.timescale[a.cc],l,a.cc,a.start,function(m){f._appendCues(m,a.level),p.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:a})},function(m){f._fallbackToIMSC1(a,h),T.logger.log("Failed to parse VTT cue: "+m),p.trigger(_.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:m})})},e._fallbackToIMSC1=function(a,h){var l=this,f=this.tracks[a.level];f.textCodec||Object(D.parseIMSC1)(h,this.initPTS[a.cc],this.timescale[a.cc],function(){f.textCodec=D.IMSC1_CODEC,l._parseIMSC1(a,h)},function(){f.textCodec="wvtt"})},e._appendCues=function(a,h){var l=this.hls;if(this.config.renderTextTracksNatively){var f=this.textTracks[h];if(f.mode==="disabled")return;a.forEach(function(d){return Object(I.addCueToTrack)(f,d)})}else{var p=this.tracks[h],m=p.default?"default":"subtitles"+h;l.trigger(_.Events.CUES_PARSED,{type:"subtitles",cues:a,track:m})}},e.onFragDecrypted=function(a,h){var l=h.frag;if(l.type===c.PlaylistLevelType.SUBTITLE){if(!Object(R.isFiniteNumber)(this.initPTS[l.cc])){this.unparsedVttFrags.push(h);return}this.onFragLoaded(_.Events.FRAG_LOADED,h)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(a,h){var l=this.cea608Parser1,f=this.cea608Parser2;if(!(!this.enabled||!(l&&f)))for(var p=0;p<h.samples.length;p++){var m=h.samples[p].bytes;if(m){var d=this.extractCea608Data(m);l.addData(h.samples[p].pts,d[0]),f.addData(h.samples[p].pts,d[1])}}},e.onBufferFlushing=function(a,h){var l=h.startOffset,f=h.endOffset,p=h.endOffsetSubtitles,m=h.type,d=this.media;if(!(!d||d.currentTime<f)){if(!m||m==="video"){var u=this.captionsTracks;Object.keys(u).forEach(function(i){return Object(I.removeCuesInRange)(u[i],l,f)})}if(this.config.renderTextTracksNatively&&l===0&&p!==void 0){var r=this.textTracks;Object.keys(r).forEach(function(i){return Object(I.removeCuesInRange)(r[i],l,p)})}}},e.extractCea608Data=function(a){for(var h=a[0]&31,l=2,f=[[],[]],p=0;p<h;p++){var m=a[l++],d=127&a[l++],u=127&a[l++],r=(4&m)!=0,i=3&m;d===0&&u===0||r&&(i===0||i===1)&&(f[i].push(d),f[i].push(u))}return f},n}();function E(n,e){return n&&n.label===e.name&&!(n.textTrack1||n.textTrack2)}function A(n,e,t,a){return Math.min(e,a)-Math.max(n,t)}function S(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return R});var R=function(){function _(P,M){this.subtle=void 0,this.aesIV=void 0,this.subtle=P,this.aesIV=M}var b=_.prototype;return b.decrypt=function(M,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,M)},_}()},"./src/crypt/aes-decryptor.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"removePadding",function(){return _}),s.d(O,"default",function(){return b});var R=s("./src/utils/typed-array.ts");function _(P){var M=P.byteLength,I=M&&new DataView(P.buffer).getUint8(M-1);return I?Object(R.sliceUint8)(P,0,M-I):P}var b=function(){function P(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var M=P.prototype;return M.uint8ArrayToUint32Array_=function(D){for(var c=new DataView(D),T=new Uint32Array(4),y=0;y<4;y++)T[y]=c.getUint32(y*4);return T},M.initTable=function(){var D=this.sBox,c=this.invSBox,T=this.subMix,y=T[0],E=T[1],A=T[2],S=T[3],n=this.invSubMix,e=n[0],t=n[1],a=n[2],h=n[3],l=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)m<128?l[m]=m<<1:l[m]=m<<1^283;for(m=0;m<256;m++){var d=p^p<<1^p<<2^p<<3^p<<4;d=d>>>8^d&255^99,D[f]=d,c[d]=f;var u=l[f],r=l[u],i=l[r],v=l[d]*257^d*16843008;y[f]=v<<24|v>>>8,E[f]=v<<16|v>>>16,A[f]=v<<8|v>>>24,S[f]=v,v=i*16843009^r*65537^u*257^f*16843008,e[d]=v<<24|v>>>8,t[d]=v<<16|v>>>16,a[d]=v<<8|v>>>24,h[d]=v,f?(f=u^l[l[l[i^u]]],p^=l[l[p]]):f=p=1}},M.expandKey=function(D){for(var c=this.uint8ArrayToUint32Array_(D),T=!0,y=0;y<c.length&&T;)T=c[y]===this.key[y],y++;if(!T){this.key=c;var E=this.keySize=c.length;if(E!==4&&E!==6&&E!==8)throw new Error("Invalid aes key size="+E);var A=this.ksRows=(E+6+1)*4,S,n,e=this.keySchedule=new Uint32Array(A),t=this.invKeySchedule=new Uint32Array(A),a=this.sBox,h=this.rcon,l=this.invSubMix,f=l[0],p=l[1],m=l[2],d=l[3],u,r;for(S=0;S<A;S++){if(S<E){u=e[S]=c[S];continue}r=u,S%E==0?(r=r<<8|r>>>24,r=a[r>>>24]<<24|a[r>>>16&255]<<16|a[r>>>8&255]<<8|a[r&255],r^=h[S/E|0]<<24):E>6&&S%E==4&&(r=a[r>>>24]<<24|a[r>>>16&255]<<16|a[r>>>8&255]<<8|a[r&255]),e[S]=u=(e[S-E]^r)>>>0}for(n=0;n<A;n++)S=A-n,n&3?r=e[S]:r=e[S-4],n<4||S<=4?t[n]=r:t[n]=f[a[r>>>24]]^p[a[r>>>16&255]]^m[a[r>>>8&255]]^d[a[r&255]],t[n]=t[n]>>>0}},M.networkToHostOrderSwap=function(D){return D<<24|(D&65280)<<8|(D&16711680)>>8|D>>>24},M.decrypt=function(D,c,T){for(var y=this.keySize+6,E=this.invKeySchedule,A=this.invSBox,S=this.invSubMix,n=S[0],e=S[1],t=S[2],a=S[3],h=this.uint8ArrayToUint32Array_(T),l=h[0],f=h[1],p=h[2],m=h[3],d=new Int32Array(D),u=new Int32Array(d.length),r,i,v,g,L,C,k,U,F,B,N,K,H,j,W=this.networkToHostOrderSwap;c<d.length;){for(F=W(d[c]),B=W(d[c+1]),N=W(d[c+2]),K=W(d[c+3]),L=F^E[0],C=K^E[1],k=N^E[2],U=B^E[3],H=4,j=1;j<y;j++)r=n[L>>>24]^e[C>>16&255]^t[k>>8&255]^a[U&255]^E[H],i=n[C>>>24]^e[k>>16&255]^t[U>>8&255]^a[L&255]^E[H+1],v=n[k>>>24]^e[U>>16&255]^t[L>>8&255]^a[C&255]^E[H+2],g=n[U>>>24]^e[L>>16&255]^t[C>>8&255]^a[k&255]^E[H+3],L=r,C=i,k=v,U=g,H=H+4;r=A[L>>>24]<<24^A[C>>16&255]<<16^A[k>>8&255]<<8^A[U&255]^E[H],i=A[C>>>24]<<24^A[k>>16&255]<<16^A[U>>8&255]<<8^A[L&255]^E[H+1],v=A[k>>>24]<<24^A[U>>16&255]<<16^A[L>>8&255]<<8^A[C&255]^E[H+2],g=A[U>>>24]<<24^A[L>>16&255]<<16^A[C>>8&255]<<8^A[k&255]^E[H+3],u[c]=W(r^l),u[c+1]=W(g^f),u[c+2]=W(v^p),u[c+3]=W(i^m),l=F,f=B,p=N,m=K,c=c+4}return u.buffer},P}()},"./src/crypt/decrypter.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return c});var R=s("./src/crypt/aes-crypto.ts"),_=s("./src/crypt/fast-aes-key.ts"),b=s("./src/crypt/aes-decryptor.ts"),P=s("./src/utils/logger.ts"),M=s("./src/utils/mp4-tools.ts"),I=s("./src/utils/typed-array.ts"),D=16,c=function(){function T(E,A,S){var n=S===void 0?{}:S,e=n.removePKCS7Padding,t=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=A,this.removePKCS7Padding=t,t)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var y=T.prototype;return y.destroy=function(){this.observer=null},y.isSync=function(){return this.config.enableSoftwareAES},y.flush=function(){var A=this.currentResult;if(!A){this.reset();return}var S=new Uint8Array(A);return this.reset(),this.removePKCS7Padding?Object(b.removePadding)(S):S},y.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},y.decrypt=function(A,S,n,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(A),S,n);var t=this.flush();t&&e(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(A),S,n).then(e)},y.softwareDecrypt=function(A,S,n){var e=this.currentIV,t=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(A=Object(M.appendUint8Array)(a,A),this.remainderData=null);var h=this.getValidChunk(A);if(!h.length)return null;e&&(n=e);var l=this.softwareDecrypter;l||(l=this.softwareDecrypter=new b.default),l.expandKey(S);var f=t;return this.currentResult=l.decrypt(h.buffer,0,n),this.currentIV=Object(I.sliceUint8)(h,-16).buffer,f||null},y.webCryptoDecrypt=function(A,S,n){var e=this,t=this.subtle;return(this.key!==S||!this.fastAesKey)&&(this.key=S,this.fastAesKey=new _.default(t,S)),this.fastAesKey.expandKey().then(function(a){if(!t)return Promise.reject(new Error("web crypto not initialized"));var h=new R.default(t,n);return h.decrypt(A.buffer,a)}).catch(function(a){return e.onWebCryptoError(a,A,S,n)})},y.onWebCryptoError=function(A,S,n,e){return P.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",A),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(S,n,e)},y.getValidChunk=function(A){var S=A,n=A.length-A.length%D;return n!==A.length&&(S=Object(I.sliceUint8)(A,0,n),this.remainderData=Object(I.sliceUint8)(A,n)),S},y.logOnce=function(A){!this.logEnabled||(P.logger.log("[decrypter.ts]: "+A),this.logEnabled=!1)},T}()},"./src/crypt/fast-aes-key.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return R});var R=function(){function _(P,M){this.subtle=void 0,this.key=void 0,this.subtle=P,this.key=M}var b=_.prototype;return b.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},_}()},"./src/demux/aacdemuxer.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/demux/base-audio-demuxer.ts"),_=s("./src/demux/adts.ts"),b=s("./src/utils/logger.ts"),P=s("./src/demux/id3.ts");function M(c,T){c.prototype=Object.create(T.prototype),c.prototype.constructor=c,I(c,T)}function I(c,T){return I=Object.setPrototypeOf||function(E,A){return E.__proto__=A,E},I(c,T)}var D=function(c){M(T,c);function T(E,A){var S;return S=c.call(this)||this,S.observer=void 0,S.config=void 0,S.observer=E,S.config=A,S}var y=T.prototype;return y.resetInitSegment=function(A,S,n){c.prototype.resetInitSegment.call(this,A,S,n),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:A,duration:n,inputTimeScale:9e4,dropped:0}},T.probe=function(A){if(!A)return!1;for(var S=P.getID3Data(A,0)||[],n=S.length,e=A.length;n<e;n++)if(_.probe(A,n))return b.logger.log("ADTS sync word found !"),!0;return!1},y.canParse=function(A,S){return _.canParse(A,S)},y.appendFrame=function(A,S,n){_.initTrackConfig(A,this.observer,S,n,A.manifestCodec);var e=_.appendFrame(A,S,n,this.initPTS,this.frameIndex);if(e&&e.missing===0)return e},T}(R.default);D.minProbeByteLength=9,O.default=D},"./src/demux/adts.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"getAudioConfig",function(){return P}),s.d(O,"isHeaderPattern",function(){return M}),s.d(O,"getHeaderLength",function(){return I}),s.d(O,"getFullFrameLength",function(){return D}),s.d(O,"canGetFrameLength",function(){return c}),s.d(O,"isHeader",function(){return T}),s.d(O,"canParse",function(){return y}),s.d(O,"probe",function(){return E}),s.d(O,"initTrackConfig",function(){return A}),s.d(O,"getFrameDuration",function(){return S}),s.d(O,"parseFrameHeader",function(){return n}),s.d(O,"appendFrame",function(){return e});var R=s("./src/utils/logger.ts"),_=s("./src/errors.ts"),b=s("./src/events.ts");function P(t,a,h,l){var f,p,m,d,u=navigator.userAgent.toLowerCase(),r=l,i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];f=((a[h+2]&192)>>>6)+1;var v=(a[h+2]&60)>>>2;if(v>i.length-1){t.trigger(b.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+v});return}return m=(a[h+2]&1)<<2,m|=(a[h+3]&192)>>>6,R.logger.log("manifest codec:"+l+", ADTS type:"+f+", samplingIndex:"+v),/firefox/i.test(u)?v>=6?(f=5,d=new Array(4),p=v-3):(f=2,d=new Array(2),p=v):u.indexOf("android")!==-1?(f=2,d=new Array(2),p=v):(f=5,d=new Array(4),l&&(l.indexOf("mp4a.40.29")!==-1||l.indexOf("mp4a.40.5")!==-1)||!l&&v>=6?p=v-3:((l&&l.indexOf("mp4a.40.2")!==-1&&(v>=6&&m===1||/vivaldi/i.test(u))||!l&&m===1)&&(f=2,d=new Array(2)),p=v)),d[0]=f<<3,d[0]|=(v&14)>>1,d[1]|=(v&1)<<7,d[1]|=m<<3,f===5&&(d[1]|=(p&14)>>1,d[2]=(p&1)<<7,d[2]|=2<<2,d[3]=0),{config:d,samplerate:i[v],channelCount:m,codec:"mp4a.40."+f,manifestCodec:r}}function M(t,a){return t[a]===255&&(t[a+1]&246)==240}function I(t,a){return t[a+1]&1?7:9}function D(t,a){return(t[a+3]&3)<<11|t[a+4]<<3|(t[a+5]&224)>>>5}function c(t,a){return a+5<t.length}function T(t,a){return a+1<t.length&&M(t,a)}function y(t,a){return c(t,a)&&M(t,a)&&D(t,a)<=t.length-a}function E(t,a){if(T(t,a)){var h=I(t,a);if(a+h>=t.length)return!1;var l=D(t,a);if(l<=h)return!1;var f=a+l;return f===t.length||T(t,f)}return!1}function A(t,a,h,l,f){if(!t.samplerate){var p=P(a,h,l,f);if(!p)return;t.config=p.config,t.samplerate=p.samplerate,t.channelCount=p.channelCount,t.codec=p.codec,t.manifestCodec=p.manifestCodec,R.logger.log("parsed codec:"+t.codec+", rate:"+p.samplerate+", channels:"+p.channelCount)}}function S(t){return 1024*9e4/t}function n(t,a,h,l,f){var p=I(t,a),m=D(t,a);if(m-=p,m>0){var d=h+l*f;return{headerLength:p,frameLength:m,stamp:d}}}function e(t,a,h,l,f){var p=S(t.samplerate),m=n(a,h,l,f,p);if(m){var d=m.frameLength,u=m.headerLength,r=m.stamp,i=u+d,v=Math.max(0,h+i-a.length),g;v?(g=new Uint8Array(i-u),g.set(a.subarray(h+u,a.length),0)):g=a.subarray(h+u,h+i);var L={unit:g,pts:r};return v||t.samples.push(L),{sample:L,length:i,missing:v}}}},"./src/demux/base-audio-demuxer.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"initPTSFn",function(){return D});var R=s("./src/polyfills/number.ts"),_=s("./src/demux/id3.ts"),b=s("./src/demux/dummy-demuxed-track.ts"),P=s("./src/utils/mp4-tools.ts"),M=s("./src/utils/typed-array.ts"),I=function(){function c(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var T=c.prototype;return T.resetInitSegment=function(E,A,S){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},T.resetTimeStamp=function(){},T.resetContiguity=function(){},T.canParse=function(E,A){return!1},T.appendFrame=function(E,A,S){},T.demux=function(E,A){this.cachedData&&(E=Object(P.appendUint8Array)(this.cachedData,E),this.cachedData=null);var S=_.getID3Data(E,0),n=S?S.length:0,e,t,a=this._audioTrack,h=this._id3Track,l=S?_.getTimeStamp(S):void 0,f=E.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=D(l,A)),S&&S.length>0&&h.samples.push({pts:this.initPTS,dts:this.initPTS,data:S}),t=this.initPTS;n<f;){if(this.canParse(E,n)){var p=this.appendFrame(a,E,n);p?(this.frameIndex++,t=p.sample.pts,n+=p.length,e=n):n=f}else _.canParse(E,n)?(S=_.getID3Data(E,n),h.samples.push({pts:t,dts:t,data:S}),n+=S.length,e=n):n++;if(n===f&&e!==f){var m=Object(M.sliceUint8)(E,e);this.cachedData?this.cachedData=Object(P.appendUint8Array)(this.cachedData,m):this.cachedData=m}}return{audioTrack:a,avcTrack:Object(b.dummyTrack)(),id3Track:h,textTrack:Object(b.dummyTrack)()}},T.demuxSampleAes=function(E,A,S){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},T.flush=function(E){var A=this.cachedData;return A&&(this.cachedData=null,this.demux(A,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},T.destroy=function(){},c}(),D=function(T,y){return Object(R.isFiniteNumber)(T)?T*90:y*9e4};O.default=I},"./src/demux/chunk-cache.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return R});var R=function(){function b(){this.chunks=[],this.dataLength=0}var P=b.prototype;return P.push=function(I){this.chunks.push(I),this.dataLength+=I.length},P.flush=function(){var I=this.chunks,D=this.dataLength,c;if(I.length)I.length===1?c=I[0]:c=_(I,D);else return new Uint8Array(0);return this.reset(),c},P.reset=function(){this.chunks.length=0,this.dataLength=0},b}();function _(b,P){for(var M=new Uint8Array(P),I=0,D=0;D<b.length;D++){var c=b[D];M.set(c,I),I+=c.length}return M}},"./src/demux/dummy-demuxed-track.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"dummyTrack",function(){return R});function R(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/utils/logger.ts"),_=function(){function b(M){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=M,this.bytesAvailable=M.byteLength,this.word=0,this.bitsAvailable=0}var P=b.prototype;return P.loadWord=function(){var I=this.data,D=this.bytesAvailable,c=I.byteLength-D,T=new Uint8Array(4),y=Math.min(4,D);if(y===0)throw new Error("no bytes available");T.set(I.subarray(c,c+y)),this.word=new DataView(T.buffer).getUint32(0),this.bitsAvailable=y*8,this.bytesAvailable-=y},P.skipBits=function(I){var D;this.bitsAvailable>I?(this.word<<=I,this.bitsAvailable-=I):(I-=this.bitsAvailable,D=I>>3,I-=D>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=I,this.bitsAvailable-=I)},P.readBits=function(I){var D=Math.min(this.bitsAvailable,I),c=this.word>>>32-D;return I>32&&R.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),D=I-D,D>0&&this.bitsAvailable?c<<D|this.readBits(D):c},P.skipLZ=function(){var I;for(I=0;I<this.bitsAvailable;++I)if((this.word&2147483648>>>I)!=0)return this.word<<=I,this.bitsAvailable-=I,I;return this.loadWord(),I+this.skipLZ()},P.skipUEG=function(){this.skipBits(1+this.skipLZ())},P.skipEG=function(){this.skipBits(1+this.skipLZ())},P.readUEG=function(){var I=this.skipLZ();return this.readBits(I+1)-1},P.readEG=function(){var I=this.readUEG();return 1&I?1+I>>>1:-1*(I>>>1)},P.readBoolean=function(){return this.readBits(1)===1},P.readUByte=function(){return this.readBits(8)},P.readUShort=function(){return this.readBits(16)},P.readUInt=function(){return this.readBits(32)},P.skipScalingList=function(I){for(var D=8,c=8,T,y=0;y<I;y++)c!==0&&(T=this.readEG(),c=(D+T+256)%256),D=c===0?D:c},P.readSPS=function(){var I=0,D=0,c=0,T=0,y,E,A,S=this.readUByte.bind(this),n=this.readBits.bind(this),e=this.readUEG.bind(this),t=this.readBoolean.bind(this),a=this.skipBits.bind(this),h=this.skipEG.bind(this),l=this.skipUEG.bind(this),f=this.skipScalingList.bind(this);S();var p=S();if(n(5),a(3),S(),l(),p===100||p===110||p===122||p===244||p===44||p===83||p===86||p===118||p===128){var m=e();if(m===3&&a(1),l(),l(),a(1),t())for(E=m!==3?8:12,A=0;A<E;A++)t()&&(A<6?f(16):f(64))}l();var d=e();if(d===0)e();else if(d===1)for(a(1),h(),h(),y=e(),A=0;A<y;A++)h();l(),a(1);var u=e(),r=e(),i=n(1);i===0&&a(1),a(1),t()&&(I=e(),D=e(),c=e(),T=e());var v=[1,1];if(t()&&t()){var g=S();switch(g){case 1:v=[1,1];break;case 2:v=[12,11];break;case 3:v=[10,11];break;case 4:v=[16,11];break;case 5:v=[40,33];break;case 6:v=[24,11];break;case 7:v=[20,11];break;case 8:v=[32,11];break;case 9:v=[80,33];break;case 10:v=[18,11];break;case 11:v=[15,11];break;case 12:v=[64,33];break;case 13:v=[160,99];break;case 14:v=[4,3];break;case 15:v=[3,2];break;case 16:v=[2,1];break;case 255:{v=[S()<<8|S(),S()<<8|S()];break}}}return{width:Math.ceil((u+1)*16-I*2-D*2),height:(2-i)*(r+1)*16-(i?2:4)*(c+T),pixelRatio:v}},P.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},b}();O.default=_},"./src/demux/id3.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"isHeader",function(){return R}),s.d(O,"isFooter",function(){return _}),s.d(O,"getID3Data",function(){return b}),s.d(O,"canParse",function(){return M}),s.d(O,"getTimeStamp",function(){return I}),s.d(O,"isTimeStampFrame",function(){return D}),s.d(O,"getID3Frames",function(){return T}),s.d(O,"decodeFrame",function(){return y}),s.d(O,"utf8ArrayToStr",function(){return e}),s.d(O,"testables",function(){return t});var R=function(f,p){return p+10<=f.length&&f[p]===73&&f[p+1]===68&&f[p+2]===51&&f[p+3]<255&&f[p+4]<255&&f[p+6]<128&&f[p+7]<128&&f[p+8]<128&&f[p+9]<128},_=function(f,p){return p+10<=f.length&&f[p]===51&&f[p+1]===68&&f[p+2]===73&&f[p+3]<255&&f[p+4]<255&&f[p+6]<128&&f[p+7]<128&&f[p+8]<128&&f[p+9]<128},b=function(f,p){for(var m=p,d=0;R(f,p);){d+=10;var u=P(f,p+6);d+=u,_(f,p+10)&&(d+=10),p+=d}if(d>0)return f.subarray(m,m+d)},P=function(f,p){var m=0;return m=(f[p]&127)<<21,m|=(f[p+1]&127)<<14,m|=(f[p+2]&127)<<7,m|=f[p+3]&127,m},M=function(f,p){return R(f,p)&&P(f,p+6)+10<=f.length-p},I=function(f){for(var p=T(f),m=0;m<p.length;m++){var d=p[m];if(D(d))return n(d)}},D=function(f){return f&&f.key==="PRIV"&&f.info==="com.apple.streaming.transportStreamTimestamp"},c=function(f){var p=String.fromCharCode(f[0],f[1],f[2],f[3]),m=P(f,4),d=10;return{type:p,size:m,data:f.subarray(d,d+m)}},T=function(f){for(var p=0,m=[];R(f,p);){var d=P(f,p+6);p+=10;for(var u=p+d;p+8<u;){var r=c(f.subarray(p)),i=y(r);i&&m.push(i),p+=r.size+10}_(f,p)&&(p+=10)}return m},y=function(f){return f.type==="PRIV"?E(f):f.type[0]==="W"?S(f):A(f)},E=function(f){if(!(f.size<2)){var p=e(f.data,!0),m=new Uint8Array(f.data.subarray(p.length+1));return{key:f.type,info:p,data:m.buffer}}},A=function(f){if(!(f.size<2)){if(f.type==="TXXX"){var p=1,m=e(f.data.subarray(p),!0);p+=m.length+1;var d=e(f.data.subarray(p));return{key:f.type,info:m,data:d}}var u=e(f.data.subarray(1));return{key:f.type,data:u}}},S=function(f){if(f.type==="WXXX"){if(f.size<2)return;var p=1,m=e(f.data.subarray(p),!0);p+=m.length+1;var d=e(f.data.subarray(p));return{key:f.type,info:m,data:d}}var u=e(f.data);return{key:f.type,data:u}},n=function(f){if(f.data.byteLength===8){var p=new Uint8Array(f.data),m=p[3]&1,d=(p[4]<<23)+(p[5]<<15)+(p[6]<<7)+p[7];return d/=45,m&&(d+=4772185884e-2),Math.round(d)}},e=function(f,p){p===void 0&&(p=!1);var m=h();if(m){var d=m.decode(f);if(p){var u=d.indexOf("\0");return u!==-1?d.substring(0,u):d}return d.replace(/\0/g,"")}for(var r=f.length,i,v,g,L="",C=0;C<r;){if(i=f[C++],i===0&&p)return L;if(i===0||i===3)continue;switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:L+=String.fromCharCode(i);break;case 12:case 13:v=f[C++],L+=String.fromCharCode((i&31)<<6|v&63);break;case 14:v=f[C++],g=f[C++],L+=String.fromCharCode((i&15)<<12|(v&63)<<6|(g&63)<<0);break;default:}}return L},t={decodeTextFrame:A},a;function h(){return!a&&typeof self.TextDecoder!="undefined"&&(a=new self.TextDecoder("utf-8")),a}},"./src/demux/mp3demuxer.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/demux/base-audio-demuxer.ts"),_=s("./src/demux/id3.ts"),b=s("./src/utils/logger.ts"),P=s("./src/demux/mpegaudio.ts");function M(c,T){c.prototype=Object.create(T.prototype),c.prototype.constructor=c,I(c,T)}function I(c,T){return I=Object.setPrototypeOf||function(E,A){return E.__proto__=A,E},I(c,T)}var D=function(c){M(T,c);function T(){return c.apply(this,arguments)||this}var y=T.prototype;return y.resetInitSegment=function(A,S,n){c.prototype.resetInitSegment.call(this,A,S,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:A,duration:n,inputTimeScale:9e4,dropped:0}},T.probe=function(A){if(!A)return!1;for(var S=_.getID3Data(A,0)||[],n=S.length,e=A.length;n<e;n++)if(P.probe(A,n))return b.logger.log("MPEG Audio sync word found !"),!0;return!1},y.canParse=function(A,S){return P.canParse(A,S)},y.appendFrame=function(A,S,n){if(this.initPTS!==null)return P.appendFrame(A,S,n,this.initPTS,this.frameIndex)},T}(R.default);D.minProbeByteLength=4,O.default=D},"./src/demux/mp4demuxer.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/utils/mp4-tools.ts"),_=s("./src/demux/dummy-demuxed-track.ts"),b=function(){function P(I,D){this.remainderData=null,this.config=void 0,this.config=D}var M=P.prototype;return M.resetTimeStamp=function(){},M.resetInitSegment=function(){},M.resetContiguity=function(){},P.probe=function(D){return Object(R.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},M.demux=function(D){var c=D,T=Object(_.dummyTrack)();if(this.config.progressive){this.remainderData&&(c=Object(R.appendUint8Array)(this.remainderData,D));var y=Object(R.segmentValidRange)(c);this.remainderData=y.remainder,T.samples=y.valid||new Uint8Array}else T.samples=c;return{audioTrack:Object(_.dummyTrack)(),avcTrack:T,id3Track:Object(_.dummyTrack)(),textTrack:Object(_.dummyTrack)()}},M.flush=function(){var D=Object(_.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(_.dummyTrack)(),avcTrack:D,id3Track:Object(_.dummyTrack)(),textTrack:Object(_.dummyTrack)()}},M.demuxSampleAes=function(D,c,T){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},M.destroy=function(){},P}();b.minProbeByteLength=1024,O.default=b},"./src/demux/mpegaudio.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"appendFrame",function(){return I}),s.d(O,"parseHeader",function(){return D}),s.d(O,"isHeaderPattern",function(){return c}),s.d(O,"isHeader",function(){return T}),s.d(O,"canParse",function(){return y}),s.d(O,"probe",function(){return E});var R=null,_=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],b=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],P=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],M=[0,1,1,4];function I(A,S,n,e,t){if(!(n+24>S.length)){var a=D(S,n);if(a&&n+a.frameLength<=S.length){var h=a.samplesPerFrame*9e4/a.sampleRate,l=e+t*h,f={unit:S.subarray(n,n+a.frameLength),pts:l,dts:l};return A.config=[],A.channelCount=a.channelCount,A.samplerate=a.sampleRate,A.samples.push(f),{sample:f,length:a.frameLength,missing:0}}}}function D(A,S){var n=A[S+1]>>3&3,e=A[S+1]>>1&3,t=A[S+2]>>4&15,a=A[S+2]>>2&3;if(n!==1&&t!==0&&t!==15&&a!==3){var h=A[S+2]>>1&1,l=A[S+3]>>6,f=n===3?3-e:e===3?3:4,p=_[f*14+t-1]*1e3,m=n===3?0:n===2?1:2,d=b[m*3+a],u=l===3?1:2,r=P[n][e],i=M[e],v=r*8*i,g=Math.floor(r*p/d+h)*i;if(R===null){var L=navigator.userAgent||"",C=L.match(/Chrome\/(\d+)/i);R=C?parseInt(C[1]):0}var k=!!R&&R<=87;return k&&e===2&&p>=224e3&&l===0&&(A[S+3]=A[S+3]|128),{sampleRate:d,channelCount:u,frameLength:g,samplesPerFrame:v}}}function c(A,S){return A[S]===255&&(A[S+1]&224)==224&&(A[S+1]&6)!=0}function T(A,S){return S+1<A.length&&c(A,S)}function y(A,S){var n=4;return c(A,S)&&n<=A.length-S}function E(A,S){if(S+1<A.length&&c(A,S)){var n=4,e=D(A,S),t=n;e!=null&&e.frameLength&&(t=e.frameLength);var a=S+t;return a===A.length||T(A,a)}return!1}},"./src/demux/sample-aes.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/crypt/decrypter.ts"),_=s("./src/demux/tsdemuxer.ts"),b=function(){function P(I,D,c){this.keyData=void 0,this.decrypter=void 0,this.keyData=c,this.decrypter=new R.default(I,D,{removePKCS7Padding:!1})}var M=P.prototype;return M.decryptBuffer=function(D,c){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,c)},M.decryptAacSample=function(D,c,T,y){var E=D[c].unit,A=E.subarray(16,E.length-E.length%16),S=A.buffer.slice(A.byteOffset,A.byteOffset+A.length),n=this;this.decryptBuffer(S,function(e){var t=new Uint8Array(e);E.set(t,16),y||n.decryptAacSamples(D,c+1,T)})},M.decryptAacSamples=function(D,c,T){for(;;c++){if(c>=D.length){T();return}if(!(D[c].unit.length<32)){var y=this.decrypter.isSync();if(this.decryptAacSample(D,c,T,y),!y)return}}},M.getAvcEncryptedData=function(D){for(var c=Math.floor((D.length-48)/160)*16+16,T=new Int8Array(c),y=0,E=32;E<=D.length-16;E+=160,y+=16)T.set(D.subarray(E,E+16),y);return T},M.getAvcDecryptedUnit=function(D,c){for(var T=new Uint8Array(c),y=0,E=32;E<=D.length-16;E+=160,y+=16)D.set(T.subarray(y,y+16),E);return D},M.decryptAvcSample=function(D,c,T,y,E,A){var S=Object(_.discardEPB)(E.data),n=this.getAvcEncryptedData(S),e=this;this.decryptBuffer(n.buffer,function(t){E.data=e.getAvcDecryptedUnit(S,t),A||e.decryptAvcSamples(D,c,T+1,y)})},M.decryptAvcSamples=function(D,c,T,y){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;c++,T=0){if(c>=D.length){y();return}for(var E=D[c].units;!(T>=E.length);T++){var A=E[T];if(!(A.data.length<=48||A.type!==1&&A.type!==5)){var S=this.decrypter.isSync();if(this.decryptAvcSample(D,c,T,y,A,S),!S)return}}}},P}();O.default=b},"./src/demux/transmuxer-interface.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return E});var R=s("./node_modules/webworkify-webpack/index.js"),_=s.n(R),b=s("./src/events.ts"),P=s("./src/demux/transmuxer.ts"),M=s("./src/utils/logger.ts"),I=s("./src/errors.ts"),D=s("./src/utils/mediasource-helper.ts"),c=s("./node_modules/eventemitter3/index.js"),T=s.n(c),y=Object(D.getMediaSource)()||{isTypeSupported:function(){return!1}},E=function(){function A(n,e,t,a){var h=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=n,this.id=e,this.onTransmuxComplete=t,this.onFlush=a;var l=n.config,f=function(r,i){i=i||{},i.frag=h.frag,i.id=h.id,n.trigger(r,i)};this.observer=new c.EventEmitter,this.observer.on(b.Events.FRAG_DECRYPTED,f),this.observer.on(b.Events.ERROR,f);var p={mp4:y.isTypeSupported("video/mp4"),mpeg:y.isTypeSupported("audio/mpeg"),mp3:y.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(l.enableWorker&&typeof Worker!="undefined"){M.logger.log("demuxing in webworker");var d;try{d=this.worker=R("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(u){n.trigger(b.Events.ERROR,{type:I.ErrorTypes.OTHER_ERROR,details:I.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(u.message+"  ("+u.filename+":"+u.lineno+")")})},d.postMessage({cmd:"init",typeSupported:p,vendor:m,id:e,config:JSON.stringify(l)})}catch(u){M.logger.warn("Error in worker:",u),M.logger.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new P.default(this.observer,p,l,m,e),this.worker=null}}else this.transmuxer=new P.default(this.observer,p,l,m,e)}var S=A.prototype;return S.destroy=function(){var e=this.worker;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var a=this.observer;a&&a.removeAllListeners(),this.observer=null},S.push=function(e,t,a,h,l,f,p,m,d,u){var r=this;d.transmuxing.start=self.performance.now();var i=this.transmuxer,v=this.worker,g=f?f.start:l.start,L=l.decryptdata,C=this.frag,k=!(C&&l.cc===C.cc),U=!(C&&d.level===C.level),F=C?d.sn-C.sn:-1,B=this.part?d.part-this.part.index:1,N=!U&&(F===1||F===0&&B===1),K=self.performance.now();(U||F||l.stats.parsing.start===0)&&(l.stats.parsing.start=K),f&&(B||!N)&&(f.stats.parsing.start=K);var H=new P.TransmuxState(k,N,m,U,g);if(!N||k){M.logger.log("[transmuxer-interface, "+l.type+"]: Starting new transmux session for sn: "+d.sn+" p: "+d.part+" level: "+d.level+" id: "+d.id+`
        discontinuity: `+k+`
        trackSwitch: `+U+`
        contiguous: `+N+`
        accurateTimeOffset: `+m+`
        timeOffset: `+g);var j=new P.TransmuxConfig(a,h,t,p,u);this.configureTransmuxer(j)}if(this.frag=l,this.part=f,v)v.postMessage({cmd:"demux",data:e,decryptdata:L,chunkMeta:d,state:H},e instanceof ArrayBuffer?[e]:[]);else if(i){var W=i.push(e,L,d,H);Object(P.isPromise)(W)?W.then(function(V){r.handleTransmuxComplete(V)}):this.handleTransmuxComplete(W)}},S.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var a=this.transmuxer,h=this.worker;if(h)h.postMessage({cmd:"flush",chunkMeta:e});else if(a){var l=a.flush(e);Object(P.isPromise)(l)?l.then(function(f){t.handleFlushResult(f,e)}):this.handleFlushResult(l,e)}},S.handleFlushResult=function(e,t){var a=this;e.forEach(function(h){a.handleTransmuxComplete(h)}),this.onFlush(t)},S.onWorkerMessage=function(e){var t=e.data,a=this.hls;switch(t.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,a.trigger(t.event,t.data);break}}},S.configureTransmuxer=function(e){var t=this.worker,a=this.transmuxer;t?t.postMessage({cmd:"configure",config:e}):a&&a.configure(e)},S.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},A}()},"./src/demux/transmuxer-worker.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return I});var R=s("./src/demux/transmuxer.ts"),_=s("./src/events.ts"),b=s("./src/utils/logger.ts"),P=s("./node_modules/eventemitter3/index.js"),M=s.n(P);function I(E){var A=new P.EventEmitter,S=function(e,t){E.postMessage({event:e,data:t})};A.on(_.Events.FRAG_DECRYPTED,S),A.on(_.Events.ERROR,S),E.addEventListener("message",function(n){var e=n.data;switch(e.cmd){case"init":{var t=JSON.parse(e.config);E.transmuxer=new R.default(A,e.typeSupported,t,e.vendor,e.id),Object(b.enableLogs)(t.debug),S("init",null);break}case"configure":{E.transmuxer.configure(e.config);break}case"demux":{var a=E.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(R.isPromise)(a)?a.then(function(f){D(E,f)}):D(E,a);break}case"flush":{var h=e.chunkMeta,l=E.transmuxer.flush(h);Object(R.isPromise)(l)?l.then(function(f){T(E,f,h)}):T(E,l,h);break}default:break}})}function D(E,A){if(!y(A.remuxResult)){var S=[],n=A.remuxResult,e=n.audio,t=n.video;e&&c(S,e),t&&c(S,t),E.postMessage({event:"transmuxComplete",data:A},S)}}function c(E,A){A.data1&&E.push(A.data1.buffer),A.data2&&E.push(A.data2.buffer)}function T(E,A,S){A.forEach(function(n){D(E,n)}),E.postMessage({event:"flush",data:S})}function y(E){return!E.audio&&!E.video&&!E.text&&!E.id3&&!E.initSegment}},"./src/demux/transmuxer.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return t}),s.d(O,"isPromise",function(){return l}),s.d(O,"TransmuxConfig",function(){return f}),s.d(O,"TransmuxState",function(){return p});var R=s("./src/events.ts"),_=s("./src/errors.ts"),b=s("./src/crypt/decrypter.ts"),P=s("./src/demux/aacdemuxer.ts"),M=s("./src/demux/mp4demuxer.ts"),I=s("./src/demux/tsdemuxer.ts"),D=s("./src/demux/mp3demuxer.ts"),c=s("./src/remux/mp4-remuxer.ts"),T=s("./src/remux/passthrough-remuxer.ts"),y=s("./src/demux/chunk-cache.ts"),E=s("./src/utils/mp4-tools.ts"),A=s("./src/utils/logger.ts"),S;try{S=self.performance.now.bind(self.performance)}catch{A.logger.debug("Unable to use Performance API on this environment"),S=self.Date.now}var n=[{demux:I.default,remux:c.default},{demux:M.default,remux:T.default},{demux:P.default,remux:c.default},{demux:D.default,remux:c.default}],e=1024;n.forEach(function(m){var d=m.demux;e=Math.max(e,d.minProbeByteLength)});var t=function(){function m(u,r,i,v,g){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new y.default,this.observer=u,this.typeSupported=r,this.config=i,this.vendor=v,this.id=g}var d=m.prototype;return d.configure=function(r){this.transmuxConfig=r,this.decrypter&&this.decrypter.reset()},d.push=function(r,i,v,g){var L=this,C=v.transmuxing;C.executeStart=S();var k=new Uint8Array(r),U=this.cache,F=this.config,B=this.currentTransmuxState,N=this.transmuxConfig;g&&(this.currentTransmuxState=g);var K=a(k,i);if(K&&K.method==="AES-128"){var H=this.getDecrypter();if(F.enableSoftwareAES){var j=H.softwareDecrypt(k,K.key.buffer,K.iv.buffer);if(!j)return C.executeEnd=S(),h(v);k=new Uint8Array(j)}else return this.decryptionPromise=H.webCryptoDecrypt(k,K.key.buffer,K.iv.buffer).then(function(ue){var ve=L.push(ue,null,v);return L.decryptionPromise=null,ve}),this.decryptionPromise}var W=g||B,V=W.contiguous,$=W.discontinuity,Y=W.trackSwitch,Q=W.accurateTimeOffset,J=W.timeOffset,ie=N.audioCodec,q=N.videoCodec,ne=N.defaultInitPts,ge=N.duration,ee=N.initSegmentData;if(($||Y)&&this.resetInitSegment(ee,ie,q,ge),$&&this.resetInitialTimestamp(ne),V||this.resetContiguity(),this.needsProbing(k,$,Y)){if(U.dataLength){var te=U.flush();k=Object(E.appendUint8Array)(te,k)}this.configureTransmuxer(k,N)}var z=this.transmux(k,K,J,Q,v),X=this.currentTransmuxState;return X.contiguous=!0,X.discontinuity=!1,X.trackSwitch=!1,C.executeEnd=S(),z},d.flush=function(r){var i=this,v=r.transmuxing;v.executeStart=S();var g=this.decrypter,L=this.cache,C=this.currentTransmuxState,k=this.decryptionPromise;if(k)return k.then(function(){return i.flush(r)});var U=[],F=C.timeOffset;if(g){var B=g.flush();B&&U.push(this.push(B,null,r))}var N=L.dataLength;L.reset();var K=this.demuxer,H=this.remuxer;if(!K||!H)return N>=e&&this.observer.emit(R.Events.ERROR,R.Events.ERROR,{type:_.ErrorTypes.MEDIA_ERROR,details:_.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),v.executeEnd=S(),[h(r)];var j=K.flush(F);return l(j)?j.then(function(W){return i.flushRemux(U,W,r),U}):(this.flushRemux(U,j,r),U)},d.flushRemux=function(r,i,v){var g=i.audioTrack,L=i.avcTrack,C=i.id3Track,k=i.textTrack,U=this.currentTransmuxState,F=U.accurateTimeOffset,B=U.timeOffset;A.logger.log("[transmuxer.ts]: Flushed fragment "+v.sn+(v.part>-1?" p: "+v.part:"")+" of level "+v.level);var N=this.remuxer.remux(g,L,C,k,B,F,!0,this.id);r.push({remuxResult:N,chunkMeta:v}),v.transmuxing.executeEnd=S()},d.resetInitialTimestamp=function(r){var i=this.demuxer,v=this.remuxer;!i||!v||(i.resetTimeStamp(r),v.resetTimeStamp(r))},d.resetContiguity=function(){var r=this.demuxer,i=this.remuxer;!r||!i||(r.resetContiguity(),i.resetNextTimestamp())},d.resetInitSegment=function(r,i,v,g){var L=this.demuxer,C=this.remuxer;!L||!C||(L.resetInitSegment(i,v,g),C.resetInitSegment(r,i,v))},d.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},d.transmux=function(r,i,v,g,L){var C;return i&&i.method==="SAMPLE-AES"?C=this.transmuxSampleAes(r,i,v,g,L):C=this.transmuxUnencrypted(r,v,g,L),C},d.transmuxUnencrypted=function(r,i,v,g){var L=this.demuxer.demux(r,i,!1,!this.config.progressive),C=L.audioTrack,k=L.avcTrack,U=L.id3Track,F=L.textTrack,B=this.remuxer.remux(C,k,U,F,i,v,!1,this.id);return{remuxResult:B,chunkMeta:g}},d.transmuxSampleAes=function(r,i,v,g,L){var C=this;return this.demuxer.demuxSampleAes(r,i,v).then(function(k){var U=C.remuxer.remux(k.audioTrack,k.avcTrack,k.id3Track,k.textTrack,v,g,!1,C.id);return{remuxResult:U,chunkMeta:L}})},d.configureTransmuxer=function(r,i){for(var v=this.config,g=this.observer,L=this.typeSupported,C=this.vendor,k=i.audioCodec,U=i.defaultInitPts,F=i.duration,B=i.initSegmentData,N=i.videoCodec,K,H=0,j=n.length;H<j;H++)if(n[H].demux.probe(r)){K=n[H];break}K||(A.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),K={demux:M.default,remux:T.default});var W=this.demuxer,V=this.remuxer,$=K.remux,Y=K.demux;(!V||!(V instanceof $))&&(this.remuxer=new $(g,v,L,C)),(!W||!(W instanceof Y))&&(this.demuxer=new Y(g,v,L),this.probe=Y.probe),this.resetInitSegment(B,k,N,F),this.resetInitialTimestamp(U)},d.needsProbing=function(r,i,v){return!this.demuxer||!this.remuxer||i||v},d.getDecrypter=function(){var r=this.decrypter;return r||(r=this.decrypter=new b.default(this.observer,this.config)),r},m}();function a(m,d){var u=null;return m.byteLength>0&&d!=null&&d.key!=null&&d.iv!==null&&d.method!=null&&(u=d),u}var h=function(d){return{remuxResult:{},chunkMeta:d}};function l(m){return"then"in m&&m.then instanceof Function}var f=function(d,u,r,i,v){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=d,this.videoCodec=u,this.initSegmentData=r,this.duration=i,this.defaultInitPts=v},p=function(d,u,r,i,v){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=d,this.contiguous=u,this.accurateTimeOffset=r,this.trackSwitch=i,this.timeOffset=v}},"./src/demux/tsdemuxer.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"discardEPB",function(){return h});var R=s("./src/demux/adts.ts"),_=s("./src/demux/mpegaudio.ts"),b=s("./src/demux/exp-golomb.ts"),P=s("./src/demux/id3.ts"),M=s("./src/demux/sample-aes.ts"),I=s("./src/events.ts"),D=s("./src/utils/mp4-tools.ts"),c=s("./src/utils/logger.ts"),T=s("./src/errors.ts"),y={video:1,audio:2,id3:3,text:4},E=function(){function l(p,m,d){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=p,this.config=m,this.typeSupported=d}l.probe=function(m){var d=l.syncOffset(m);return d<0?!1:(d&&c.logger.warn("MPEG2-TS detected but first sync word found @ offset "+d+", junk ahead ?"),!0)},l.syncOffset=function(m){for(var d=Math.min(1e3,m.length-3*188),u=0;u<d;){if(m[u]===71&&m[u+188]===71&&m[u+2*188]===71)return u;u++}return-1},l.createTrack=function(m,d){return{container:m==="video"||m==="audio"?"video/mp2t":void 0,type:m,id:y[m],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:m==="audio"?d:void 0}};var f=l.prototype;return f.resetInitSegment=function(m,d,u){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=l.createTrack("video",u),this._audioTrack=l.createTrack("audio",u),this._id3Track=l.createTrack("id3",u),this._txtTrack=l.createTrack("text",u),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=d,this._duration=u},f.resetTimeStamp=function(){},f.resetContiguity=function(){var m=this._audioTrack,d=this._avcTrack,u=this._id3Track;m&&(m.pesData=null),d&&(d.pesData=null),u&&(u.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},f.demux=function(m,d,u,r){u===void 0&&(u=!1),r===void 0&&(r=!1),u||(this.sampleAes=null);var i,v=this._avcTrack,g=this._audioTrack,L=this._id3Track,C=v.pid,k=v.pesData,U=g.pid,F=L.pid,B=g.pesData,N=L.pesData,K=!1,H=this.pmtParsed,j=this._pmtId,W=m.length;if(this.remainderData&&(m=Object(D.appendUint8Array)(this.remainderData,m),W=m.length,this.remainderData=null),W<188&&!r)return this.remainderData=m,{audioTrack:g,avcTrack:v,id3Track:L,textTrack:this._txtTrack};var V=Math.max(0,l.syncOffset(m));W-=(W+V)%188,W<m.byteLength&&!r&&(this.remainderData=new Uint8Array(m.buffer,W,m.buffer.byteLength-W));for(var $=V;$<W;$+=188)if(m[$]===71){var Y=!!(m[$+1]&64),Q=((m[$+1]&31)<<8)+m[$+2],J=(m[$+3]&48)>>4,ie=void 0;if(J>1){if(ie=$+5+m[$+4],ie===$+188)continue}else ie=$+4;switch(Q){case C:Y&&(k&&(i=e(k))&&this.parseAVCPES(i,!1),k={data:[],size:0}),k&&(k.data.push(m.subarray(ie,$+188)),k.size+=$+188-ie);break;case U:Y&&(B&&(i=e(B))&&(g.isAAC?this.parseAACPES(i):this.parseMPEGPES(i)),B={data:[],size:0}),B&&(B.data.push(m.subarray(ie,$+188)),B.size+=$+188-ie);break;case F:Y&&(N&&(i=e(N))&&this.parseID3PES(i),N={data:[],size:0}),N&&(N.data.push(m.subarray(ie,$+188)),N.size+=$+188-ie);break;case 0:Y&&(ie+=m[ie]+1),j=this._pmtId=S(m,ie);break;case j:{Y&&(ie+=m[ie]+1);var q=n(m,ie,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,u);C=q.avc,C>0&&(v.pid=C),U=q.audio,U>0&&(g.pid=U,g.isAAC=q.isAAC),F=q.id3,F>0&&(L.pid=F),K&&!H&&(c.logger.log("reparse from beginning"),K=!1,$=V-188),H=this.pmtParsed=!0;break}case 17:case 8191:break;default:K=!0;break}}else this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});v.pesData=k,g.pesData=B,L.pesData=N;var ne={audioTrack:g,avcTrack:v,id3Track:L,textTrack:this._txtTrack};return r&&this.extractRemainingSamples(ne),ne},f.flush=function(){var m=this.remainderData;this.remainderData=null;var d;return m?d=this.demux(m,-1,!1,!0):d={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(d),this.sampleAes?this.decrypt(d,this.sampleAes):d},f.extractRemainingSamples=function(m){var d=m.audioTrack,u=m.avcTrack,r=m.id3Track,i=u.pesData,v=d.pesData,g=r.pesData,L;i&&(L=e(i))?(this.parseAVCPES(L,!0),u.pesData=null):u.pesData=i,v&&(L=e(v))?(d.isAAC?this.parseAACPES(L):this.parseMPEGPES(L),d.pesData=null):(v!=null&&v.size&&c.logger.log("last AAC PES packet truncated,might overlap between fragments"),d.pesData=v),g&&(L=e(g))?(this.parseID3PES(L),r.pesData=null):r.pesData=g},f.demuxSampleAes=function(m,d,u){var r=this.demux(m,u,!0,!this.config.progressive),i=this.sampleAes=new M.default(this.observer,this.config,d);return this.decrypt(r,i)},f.decrypt=function(m,d){return new Promise(function(u){var r=m.audioTrack,i=m.avcTrack;r.samples&&r.isAAC?d.decryptAacSamples(r.samples,0,function(){i.samples?d.decryptAvcSamples(i.samples,0,0,function(){u(m)}):u(m)}):i.samples&&d.decryptAvcSamples(i.samples,0,0,function(){u(m)})})},f.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},f.parseAVCPES=function(m,d){var u=this,r=this._avcTrack,i=this.parseAVCNALu(m.data),v=!1,g=this.avcSample,L,C=!1;m.data=null,g&&i.length&&!r.audFound&&(t(g,r),g=this.avcSample=A(!1,m.pts,m.dts,"")),i.forEach(function(k){switch(k.type){case 1:{L=!0,g||(g=u.avcSample=A(!0,m.pts,m.dts,"")),v&&(g.debug+="NDR "),g.frame=!0;var U=k.data;if(C&&U.length>4){var F=new b.default(U).readSliceType();(F===2||F===4||F===7||F===9)&&(g.key=!0)}break}case 5:L=!0,g||(g=u.avcSample=A(!0,m.pts,m.dts,"")),v&&(g.debug+="IDR "),g.key=!0,g.frame=!0;break;case 6:{L=!0,v&&g&&(g.debug+="SEI ");var B=new b.default(h(k.data));B.readUByte();for(var N=0,K=0,H=!1,j=0;!H&&B.bytesAvailable>1;){N=0;do j=B.readUByte(),N+=j;while(j===255);K=0;do j=B.readUByte(),K+=j;while(j===255);if(N===4&&B.bytesAvailable!==0){H=!0;var W=B.readUByte();if(W===181){var V=B.readUShort();if(V===49){var $=B.readUInt();if($===1195456820){var Y=B.readUByte();if(Y===3){for(var Q=B.readUByte(),J=B.readUByte(),ie=31&Q,q=[Q,J],ne=0;ne<ie;ne++)q.push(B.readUByte()),q.push(B.readUByte()),q.push(B.readUByte());a(u._txtTrack.samples,{type:3,pts:m.pts,bytes:q})}}}}}else if(N===5&&B.bytesAvailable!==0){if(H=!0,K>16){for(var ge=[],ee=0;ee<16;ee++)ge.push(B.readUByte().toString(16)),(ee===3||ee===5||ee===7||ee===9)&&ge.push("-");for(var te=K-16,z=new Uint8Array(te),X=0;X<te;X++)z[X]=B.readUByte();a(u._txtTrack.samples,{pts:m.pts,payloadType:N,uuid:ge.join(""),userData:Object(P.utf8ArrayToStr)(z),userDataBytes:z})}}else if(K<B.bytesAvailable)for(var ue=0;ue<K;ue++)B.readUByte()}break}case 7:if(L=!0,C=!0,v&&g&&(g.debug+="SPS "),!r.sps){var ve=new b.default(k.data),fe=ve.readSPS();r.width=fe.width,r.height=fe.height,r.pixelRatio=fe.pixelRatio,r.sps=[k.data],r.duration=u._duration;for(var me=k.data.subarray(1,4),pe="avc1.",ce=0;ce<3;ce++){var ae=me[ce].toString(16);ae.length<2&&(ae="0"+ae),pe+=ae}r.codec=pe}break;case 8:L=!0,v&&g&&(g.debug+="PPS "),r.pps||(r.pps=[k.data]);break;case 9:L=!1,r.audFound=!0,g&&t(g,r),g=u.avcSample=A(!1,m.pts,m.dts,v?"AUD ":"");break;case 12:L=!1;break;default:L=!1,g&&(g.debug+="unknown NAL "+k.type+" ");break}if(g&&L){var de=g.units;de.push(k)}}),d&&g&&(t(g,r),this.avcSample=null)},f.getLastNalUnit=function(){var m,d=this.avcSample,u;if(!d||d.units.length===0){var r=this._avcTrack.samples;d=r[r.length-1]}if((m=d)!==null&&m!==void 0&&m.units){var i=d.units;u=i[i.length-1]}return u},f.parseAVCNALu=function(m){var d=m.byteLength,u=this._avcTrack,r=u.naluState||0,i=r,v=[],g=0,L,C,k,U=-1,F=0;for(r===-1&&(U=0,F=m[0]&31,r=0,g=1);g<d;){if(L=m[g++],!r){r=L?0:1;continue}if(r===1){r=L?0:2;continue}if(!L)r=3;else if(L===1){if(U>=0){var B={data:m.subarray(U,g-r-1),type:F};v.push(B)}else{var N=this.getLastNalUnit();if(N&&(i&&g<=4-i&&N.state&&(N.data=N.data.subarray(0,N.data.byteLength-i)),C=g-r-1,C>0)){var K=new Uint8Array(N.data.byteLength+C);K.set(N.data,0),K.set(m.subarray(0,C),N.data.byteLength),N.data=K}}g<d?(k=m[g]&31,U=g,F=k,r=0):r=-1}else r=0}if(U>=0&&r>=0){var H={data:m.subarray(U,d),type:F,state:r};v.push(H)}if(v.length===0){var j=this.getLastNalUnit();if(j){var W=new Uint8Array(j.data.byteLength+m.byteLength);W.set(j.data,0),W.set(m,j.data.byteLength),j.data=W}}return u.naluState=r,v},f.parseAACPES=function(m){var d=0,u=this._audioTrack,r=this.aacOverFlow,i=m.data;if(r){this.aacOverFlow=null;var v=r.sample.unit.byteLength,g=Math.min(r.missing,v),L=v-g;r.sample.unit.set(i.subarray(0,g),L),u.samples.push(r.sample),d=r.missing}var C,k;for(C=d,k=i.length;C<k-1&&!R.isHeader(i,C);C++);if(C!==d){var U,F;if(C<k-1?(U="AAC PES did not start with ADTS header,offset:"+C,F=!1):(U="no ADTS header found in AAC PES",F=!0),c.logger.warn("parsing error:"+U),this.observer.emit(I.Events.ERROR,I.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:U}),F)return}R.initTrackConfig(u,this.observer,i,C,this.audioCodec);var B;if(m.pts!==void 0)B=m.pts;else if(r){var N=R.getFrameDuration(u.samplerate);B=r.sample.pts+N}else{c.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var K=0;C<k;)if(R.isHeader(i,C)){if(C+5<k){var H=R.appendFrame(u,i,C,B,K);if(H)if(H.missing)this.aacOverFlow=H;else{C+=H.length,K++;continue}}break}else C++},f.parseMPEGPES=function(m){var d=m.data,u=d.length,r=0,i=0,v=m.pts;if(v===void 0){c.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;i<u;)if(_.isHeader(d,i)){var g=_.appendFrame(this._audioTrack,d,i,v,r);if(g)i+=g.length,r++;else break}else i++},f.parseID3PES=function(m){if(m.pts===void 0){c.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(m)},l}();E.minProbeByteLength=188;function A(l,f,p,m){return{key:l,frame:!1,pts:f,dts:p,units:[],debug:m,length:0}}function S(l,f){return(l[f+10]&31)<<8|l[f+11]}function n(l,f,p,m){var d={audio:-1,avc:-1,id3:-1,isAAC:!0},u=(l[f+1]&15)<<8|l[f+2],r=f+3+u-4,i=(l[f+10]&15)<<8|l[f+11];for(f+=12+i;f<r;){var v=(l[f+1]&31)<<8|l[f+2];switch(l[f]){case 207:if(!m){c.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:d.audio===-1&&(d.audio=v);break;case 21:d.id3===-1&&(d.id3=v);break;case 219:if(!m){c.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:d.avc===-1&&(d.avc=v);break;case 3:case 4:p?d.audio===-1&&(d.audio=v,d.isAAC=!1):c.logger.log("MPEG audio found, not supported in this browser");break;case 36:c.logger.warn("Unsupported HEVC stream type found");break;default:break}f+=((l[f+3]&15)<<8|l[f+4])+5}return d}function e(l){var f=0,p,m,d,u,r,i=l.data;if(!l||l.size===0)return null;for(;i[0].length<19&&i.length>1;){var v=new Uint8Array(i[0].length+i[1].length);v.set(i[0]),v.set(i[1],i[0].length),i[0]=v,i.splice(1,1)}p=i[0];var g=(p[0]<<16)+(p[1]<<8)+p[2];if(g===1){if(m=(p[4]<<8)+p[5],m&&m>l.size-6)return null;var L=p[7];L&192&&(u=(p[9]&14)*536870912+(p[10]&255)*4194304+(p[11]&254)*16384+(p[12]&255)*128+(p[13]&254)/2,L&64?(r=(p[14]&14)*536870912+(p[15]&255)*4194304+(p[16]&254)*16384+(p[17]&255)*128+(p[18]&254)/2,u-r>60*9e4&&(c.logger.warn(Math.round((u-r)/9e4)+"s delta between PTS and DTS, align them"),u=r)):r=u),d=p[8];var C=d+9;if(l.size<=C)return null;l.size-=C;for(var k=new Uint8Array(l.size),U=0,F=i.length;U<F;U++){p=i[U];var B=p.byteLength;if(C)if(C>B){C-=B;continue}else p=p.subarray(C),B-=C,C=0;k.set(p,f),f+=B}return m&&(m-=d+3),{data:k,pts:u,dts:r,len:m}}return null}function t(l,f){if(l.units.length&&l.frame){if(l.pts===void 0){var p=f.samples,m=p.length;if(m){var d=p[m-1];l.pts=d.pts,l.dts=d.dts}else{f.dropped++;return}}f.samples.push(l)}l.debug.length&&c.logger.log(l.pts+"/"+l.dts+":"+l.debug)}function a(l,f){var p=l.length;if(p>0){if(f.pts>=l[p-1].pts)l.push(f);else for(var m=p-1;m>=0;m--)if(f.pts<l[m].pts){l.splice(m,0,f);break}}else l.push(f)}function h(l){for(var f=l.byteLength,p=[],m=1;m<f-2;)l[m]===0&&l[m+1]===0&&l[m+2]===3?(p.push(m+2),m+=2):m++;if(p.length===0)return l;var d=f-p.length,u=new Uint8Array(d),r=0;for(m=0;m<d;r++,m++)r===p[0]&&(r++,p.shift()),u[m]=l[r];return u}O.default=E},"./src/errors.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"ErrorTypes",function(){return R}),s.d(O,"ErrorDetails",function(){return _});var R;(function(b){b.NETWORK_ERROR="networkError",b.MEDIA_ERROR="mediaError",b.KEY_SYSTEM_ERROR="keySystemError",b.MUX_ERROR="muxError",b.OTHER_ERROR="otherError"})(R||(R={}));var _;(function(b){b.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",b.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",b.KEY_SYSTEM_NO_SESSION="keySystemNoSession",b.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",b.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",b.MANIFEST_LOAD_ERROR="manifestLoadError",b.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",b.MANIFEST_PARSING_ERROR="manifestParsingError",b.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",b.LEVEL_EMPTY_ERROR="levelEmptyError",b.LEVEL_LOAD_ERROR="levelLoadError",b.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",b.LEVEL_SWITCH_ERROR="levelSwitchError",b.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",b.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",b.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",b.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",b.FRAG_LOAD_ERROR="fragLoadError",b.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",b.FRAG_DECRYPT_ERROR="fragDecryptError",b.FRAG_PARSING_ERROR="fragParsingError",b.REMUX_ALLOC_ERROR="remuxAllocError",b.KEY_LOAD_ERROR="keyLoadError",b.KEY_LOAD_TIMEOUT="keyLoadTimeOut",b.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",b.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",b.BUFFER_APPEND_ERROR="bufferAppendError",b.BUFFER_APPENDING_ERROR="bufferAppendingError",b.BUFFER_STALLED_ERROR="bufferStalledError",b.BUFFER_FULL_ERROR="bufferFullError",b.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",b.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",b.INTERNAL_EXCEPTION="internalException",b.INTERNAL_ABORTED="aborted",b.UNKNOWN="unknown"})(_||(_={}))},"./src/events.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"Events",function(){return R});var R;(function(_){_.MEDIA_ATTACHING="hlsMediaAttaching",_.MEDIA_ATTACHED="hlsMediaAttached",_.MEDIA_DETACHING="hlsMediaDetaching",_.MEDIA_DETACHED="hlsMediaDetached",_.BUFFER_RESET="hlsBufferReset",_.BUFFER_CODECS="hlsBufferCodecs",_.BUFFER_CREATED="hlsBufferCreated",_.BUFFER_APPENDING="hlsBufferAppending",_.BUFFER_APPENDED="hlsBufferAppended",_.BUFFER_EOS="hlsBufferEos",_.BUFFER_FLUSHING="hlsBufferFlushing",_.BUFFER_FLUSHED="hlsBufferFlushed",_.MANIFEST_LOADING="hlsManifestLoading",_.MANIFEST_LOADED="hlsManifestLoaded",_.MANIFEST_PARSED="hlsManifestParsed",_.LEVEL_SWITCHING="hlsLevelSwitching",_.LEVEL_SWITCHED="hlsLevelSwitched",_.LEVEL_LOADING="hlsLevelLoading",_.LEVEL_LOADED="hlsLevelLoaded",_.LEVEL_UPDATED="hlsLevelUpdated",_.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",_.LEVELS_UPDATED="hlsLevelsUpdated",_.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",_.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",_.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",_.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",_.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",_.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",_.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",_.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",_.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",_.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",_.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",_.CUES_PARSED="hlsCuesParsed",_.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",_.INIT_PTS_FOUND="hlsInitPtsFound",_.FRAG_LOADING="hlsFragLoading",_.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",_.FRAG_LOADED="hlsFragLoaded",_.FRAG_DECRYPTED="hlsFragDecrypted",_.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",_.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",_.FRAG_PARSING_METADATA="hlsFragParsingMetadata",_.FRAG_PARSED="hlsFragParsed",_.FRAG_BUFFERED="hlsFragBuffered",_.FRAG_CHANGED="hlsFragChanged",_.FPS_DROP="hlsFpsDrop",_.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",_.ERROR="hlsError",_.DESTROYING="hlsDestroying",_.KEY_LOADING="hlsKeyLoading",_.KEY_LOADED="hlsKeyLoaded",_.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",_.BACK_BUFFER_REACHED="hlsBackBufferReached"})(R||(R={}))},"./src/hls.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return l});var R=s("./node_modules/url-toolkit/src/url-toolkit.js"),_=s.n(R),b=s("./src/loader/playlist-loader.ts"),P=s("./src/loader/key-loader.ts"),M=s("./src/controller/id3-track-controller.ts"),I=s("./src/controller/latency-controller.ts"),D=s("./src/controller/level-controller.ts"),c=s("./src/controller/fragment-tracker.ts"),T=s("./src/controller/stream-controller.ts"),y=s("./src/is-supported.ts"),E=s("./src/utils/logger.ts"),A=s("./src/config.ts"),S=s("./node_modules/eventemitter3/index.js"),n=s.n(S),e=s("./src/events.ts"),t=s("./src/errors.ts");function a(f,p){for(var m=0;m<p.length;m++){var d=p[m];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(f,d.key,d)}}function h(f,p,m){return p&&a(f.prototype,p),m&&a(f,m),f}var l=function(){f.isSupported=function(){return Object(y.isSupported)()};function f(m){m===void 0&&(m={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new S.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var d=this.config=Object(A.mergeConfig)(f.DefaultConfig,m);this.userConfig=m,Object(E.enableLogs)(d.debug),this._autoLevelCapping=-1,d.progressive&&Object(A.enableStreamingMode)(d);var u=d.abrController,r=d.bufferController,i=d.capLevelController,v=d.fpsController,g=this.abrController=new u(this),L=this.bufferController=new r(this),C=this.capLevelController=new i(this),k=new v(this),U=new b.default(this),F=new P.default(this),B=new M.default(this),N=this.levelController=new D.default(this),K=new c.FragmentTracker(this),H=this.streamController=new T.default(this,K);C.setStreamController(H),k.setStreamController(H);var j=[N,H];this.networkControllers=j;var W=[U,F,g,L,C,k,B,K];this.audioTrackController=this.createController(d.audioTrackController,null,j),this.createController(d.audioStreamController,K,j),this.subtitleTrackController=this.createController(d.subtitleTrackController,null,j),this.createController(d.subtitleStreamController,K,j),this.createController(d.timelineController,null,W),this.emeController=this.createController(d.emeController,null,W),this.latencyController=this.createController(I.default,null,W),this.coreComponents=W}var p=f.prototype;return p.createController=function(d,u,r){if(d){var i=u?new d(this,u):new d(this);return r&&r.push(i),i}return null},p.on=function(d,u,r){r===void 0&&(r=this),this._emitter.on(d,u,r)},p.once=function(d,u,r){r===void 0&&(r=this),this._emitter.once(d,u,r)},p.removeAllListeners=function(d){this._emitter.removeAllListeners(d)},p.off=function(d,u,r,i){r===void 0&&(r=this),this._emitter.off(d,u,r,i)},p.listeners=function(d){return this._emitter.listeners(d)},p.emit=function(d,u,r){return this._emitter.emit(d,u,r)},p.trigger=function(d,u){if(this.config.debug)return this.emit(d,d,u);try{return this.emit(d,d,u)}catch(r){E.logger.error("An internal error happened while handling event "+d+'. Error message: "'+r.message+'". Here is a stacktrace:',r),this.trigger(e.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:d,error:r})}return!1},p.listenerCount=function(d){return this._emitter.listenerCount(d)},p.destroy=function(){E.logger.log("destroy"),this.trigger(e.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(d){return d.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(d){return d.destroy()}),this.coreComponents.length=0},p.attachMedia=function(d){E.logger.log("attachMedia"),this._media=d,this.trigger(e.Events.MEDIA_ATTACHING,{media:d})},p.detachMedia=function(){E.logger.log("detachMedia"),this.trigger(e.Events.MEDIA_DETACHING,void 0),this._media=null},p.loadSource=function(d){this.stopLoad();var u=this.media,r=this.url,i=this.url=R.buildAbsoluteURL(self.location.href,d,{alwaysNormalize:!0});E.logger.log("loadSource:"+i),u&&r&&r!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(u)),this.trigger(e.Events.MANIFEST_LOADING,{url:d})},p.startLoad=function(d){d===void 0&&(d=-1),E.logger.log("startLoad("+d+")"),this.networkControllers.forEach(function(u){u.startLoad(d)})},p.stopLoad=function(){E.logger.log("stopLoad"),this.networkControllers.forEach(function(d){d.stopLoad()})},p.swapAudioCodec=function(){E.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},p.recoverMediaError=function(){E.logger.log("recoverMediaError");var d=this._media;this.detachMedia(),d&&this.attachMedia(d)},p.removeLevel=function(d,u){u===void 0&&(u=0),this.levelController.removeLevel(d,u)},h(f,[{key:"levels",get:function(){var d=this.levelController.levels;return d||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(d){E.logger.log("set currentLevel:"+d),this.loadLevel=d,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(d){E.logger.log("set nextLevel:"+d),this.levelController.manualLevel=d,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(d){E.logger.log("set loadLevel:"+d),this.levelController.manualLevel=d}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(d){this.levelController.nextLoadLevel=d}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(d){E.logger.log("set firstLevel:"+d),this.levelController.firstLevel=d}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(d){E.logger.log("set startLevel:"+d),d!==-1&&(d=Math.max(d,this.minAutoLevel)),this.levelController.startLevel=d}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(d){var u=!!d;u!==this.config.capLevelToPlayerSize&&(u?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=u)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(d){this._autoLevelCapping!==d&&(E.logger.log("set autoLevelCapping:"+d),this._autoLevelCapping=d)}},{key:"bandwidthEstimate",get:function(){var d=this.abrController.bwEstimator;return d?d.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var d=this.levels,u=this.config.minAutoBitrate;if(!d)return 0;for(var r=d.length,i=0;i<r;i++)if(d[i].maxBitrate>u)return i;return 0}},{key:"maxAutoLevel",get:function(){var d=this.levels,u=this.autoLevelCapping,r;return u===-1&&d&&d.length?r=d.length-1:r=u,r}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(d){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,d)}},{key:"audioTracks",get:function(){var d=this.audioTrackController;return d?d.audioTracks:[]}},{key:"audioTrack",get:function(){var d=this.audioTrackController;return d?d.audioTrack:-1},set:function(d){var u=this.audioTrackController;u&&(u.audioTrack=d)}},{key:"subtitleTracks",get:function(){var d=this.subtitleTrackController;return d?d.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var d=this.subtitleTrackController;return d?d.subtitleTrack:-1},set:function(d){var u=this.subtitleTrackController;u&&(u.subtitleTrack=d)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var d=this.subtitleTrackController;return d?d.subtitleDisplay:!1},set:function(d){var u=this.subtitleTrackController;u&&(u.subtitleDisplay=d)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(d){this.config.lowLatencyMode=d}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.11"}},{key:"Events",get:function(){return e.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return f.defaultConfig?f.defaultConfig:A.hlsDefaultConfig},set:function(d){f.defaultConfig=d}}]),f}();l.defaultConfig=void 0},"./src/is-supported.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"isSupported",function(){return b}),s.d(O,"changeTypeSupported",function(){return P});var R=s("./src/utils/mediasource-helper.ts");function _(){return self.SourceBuffer||self.WebKitSourceBuffer}function b(){var M=Object(R.getMediaSource)();if(!M)return!1;var I=_(),D=M&&typeof M.isTypeSupported=="function"&&M.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),c=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!D&&!!c}function P(){var M,I=_();return typeof(I==null||(M=I.prototype)===null||M===void 0?void 0:M.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return E}),s.d(O,"LoadError",function(){return S});var R=s("./src/polyfills/number.ts"),_=s("./src/errors.ts");function b(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,c(n,e)}function P(n){var e=typeof Map=="function"?new Map:void 0;return P=function(a){if(a===null||!D(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(a))return e.get(a);e.set(a,h)}function h(){return M(a,arguments,T(this).constructor)}return h.prototype=Object.create(a.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),c(h,a)},P(n)}function M(n,e,t){return I()?M=Reflect.construct:M=function(h,l,f){var p=[null];p.push.apply(p,l);var m=Function.bind.apply(h,p),d=new m;return f&&c(d,f.prototype),d},M.apply(null,arguments)}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function D(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function c(n,e){return c=Object.setPrototypeOf||function(a,h){return a.__proto__=h,a},c(n,e)}function T(n){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},T(n)}var y=Math.pow(2,17),E=function(){function n(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=n.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(a,h){var l=this,f=a.url;if(!f)return Promise.reject(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,networkDetails:null},"Fragment does not have a "+(f?"part list":"url")));this.abort();var p=this.config,m=p.fLoader,d=p.loader;return new Promise(function(u,r){l.loader&&l.loader.destroy();var i=l.loader=a.loader=m?new m(p):new d(p),v=A(a),g={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:y};a.stats=i.stats,i.load(v,g,{onSuccess:function(C,k,U,F){l.resetLoader(a,i),u({frag:a,part:null,payload:C.data,networkDetails:F})},onError:function(C,k,U){l.resetLoader(a,i),r(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,response:C,networkDetails:U}))},onAbort:function(C,k,U){l.resetLoader(a,i),r(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,networkDetails:U}))},onTimeout:function(C,k,U){l.resetLoader(a,i),r(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,networkDetails:U}))},onProgress:function(C,k,U,F){h&&h({frag:a,part:null,payload:U,networkDetails:F})}})})},e.loadPart=function(a,h,l){var f=this;this.abort();var p=this.config,m=p.fLoader,d=p.loader;return new Promise(function(u,r){f.loader&&f.loader.destroy();var i=f.loader=a.loader=m?new m(p):new d(p),v=A(a,h),g={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:y};h.stats=i.stats,i.load(v,g,{onSuccess:function(C,k,U,F){f.resetLoader(a,i),f.updateStatsFromPart(a,h);var B={frag:a,part:h,payload:C.data,networkDetails:F};l(B),u(B)},onError:function(C,k,U){f.resetLoader(a,i),r(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:a,part:h,response:C,networkDetails:U}))},onAbort:function(C,k,U){a.stats.aborted=h.stats.aborted,f.resetLoader(a,i),r(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:a,part:h,networkDetails:U}))},onTimeout:function(C,k,U){f.resetLoader(a,i),r(new S({type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:a,part:h,networkDetails:U}))}})})},e.updateStatsFromPart=function(a,h){var l=a.stats,f=h.stats,p=f.total;if(l.loaded+=f.loaded,p){var m=Math.round(a.duration/h.duration),d=Math.min(Math.round(l.loaded/p),m),u=m-d,r=u*Math.round(l.loaded/d);l.total=l.loaded+r}else l.total=Math.max(l.loaded,l.total);var i=l.loading,v=f.loading;i.start?i.first+=v.first-v.start:(i.start=v.start,i.first=v.first),i.end=v.end},e.resetLoader=function(a,h){a.loader=null,this.loader===h&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),h.destroy()},n}();function A(n,e){e===void 0&&(e=null);var t=e||n,a={frag:n,part:e,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},h=t.byteRangeStartOffset,l=t.byteRangeEndOffset;return Object(R.isFiniteNumber)(h)&&Object(R.isFiniteNumber)(l)&&(a.rangeStart=h,a.rangeEnd=l),a}var S=function(n){b(e,n);function e(t){for(var a,h=arguments.length,l=new Array(h>1?h-1:0),f=1;f<h;f++)l[f-1]=arguments[f];return a=n.call.apply(n,[this].concat(l))||this,a.data=void 0,a.data=t,a}return e}(P(Error))},"./src/loader/fragment.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"ElementaryStreamTypes",function(){return E}),s.d(O,"BaseSegment",function(){return A}),s.d(O,"Fragment",function(){return S}),s.d(O,"Part",function(){return n});var R=s("./src/polyfills/number.ts"),_=s("./node_modules/url-toolkit/src/url-toolkit.js"),b=s.n(_),P=s("./src/utils/logger.ts"),M=s("./src/loader/level-key.ts"),I=s("./src/loader/load-stats.ts");function D(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function c(e,t){return c=Object.setPrototypeOf||function(h,l){return h.__proto__=l,h},c(e,t)}function T(e,t){for(var a=0;a<t.length;a++){var h=t[a];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(e,h.key,h)}}function y(e,t,a){return t&&T(e.prototype,t),a&&T(e,a),e}var E;(function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"})(E||(E={}));var A=function(){function e(a){var h;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(h={},h[E.AUDIO]=null,h[E.VIDEO]=null,h[E.AUDIOVIDEO]=null,h),this.baseurl=a}var t=e.prototype;return t.setByteRange=function(h,l){var f=h.split("@",2),p=[];f.length===1?p[0]=l?l.byteRangeEndOffset:0:p[0]=parseInt(f[1]),p[1]=parseInt(f[0])+p[0],this._byteRange=p},y(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(_.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(h){this._url=h}}]),e}(),S=function(e){D(t,e);function t(h,l){var f;return f=e.call(this,l)||this,f._decryptdata=null,f.rawProgramDateTime=null,f.programDateTime=null,f.tagList=[],f.duration=0,f.sn=0,f.levelkey=void 0,f.type=void 0,f.loader=null,f.level=-1,f.cc=0,f.startPTS=void 0,f.endPTS=void 0,f.appendedPTS=void 0,f.startDTS=void 0,f.endDTS=void 0,f.start=0,f.deltaPTS=void 0,f.maxStartPTS=void 0,f.minEndPTS=void 0,f.stats=new I.LoadStats,f.urlId=0,f.data=void 0,f.bitrateTest=!1,f.title=null,f.initSegment=null,f.type=h,f}var a=t.prototype;return a.createInitializationVector=function(l){for(var f=new Uint8Array(16),p=12;p<16;p++)f[p]=l>>8*(15-p)&255;return f},a.setDecryptDataFromLevelKey=function(l,f){var p=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&(p=M.LevelKey.fromURI(l.uri),p.method=l.method,p.iv=this.createInitializationVector(f),p.keyFormat="identity"),p},a.setElementaryStreamInfo=function(l,f,p,m,d,u){u===void 0&&(u=!1);var r=this.elementaryStreams,i=r[l];if(!i){r[l]={startPTS:f,endPTS:p,startDTS:m,endDTS:d,partial:u};return}i.startPTS=Math.min(i.startPTS,f),i.endPTS=Math.max(i.endPTS,p),i.startDTS=Math.min(i.startDTS,m),i.endDTS=Math.max(i.endDTS,d)},a.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[E.AUDIO]=null,l[E.VIDEO]=null,l[E.AUDIOVIDEO]=null},y(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&P.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(R.isFiniteNumber)(this.programDateTime))return null;var l=Object(R.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+l*1e3}},{key:"encrypted",get:function(){var l;return!!((l=this.decryptdata)!==null&&l!==void 0&&l.keyFormat&&this.decryptdata.uri)}}]),t}(A),n=function(e){D(t,e);function t(a,h,l,f,p){var m;m=e.call(this,l)||this,m.fragOffset=0,m.duration=0,m.gap=!1,m.independent=!1,m.relurl=void 0,m.fragment=void 0,m.index=void 0,m.stats=new I.LoadStats,m.duration=a.decimalFloatingPoint("DURATION"),m.gap=a.bool("GAP"),m.independent=a.bool("INDEPENDENT"),m.relurl=a.enumeratedString("URI"),m.fragment=h,m.index=f;var d=a.enumeratedString("BYTERANGE");return d&&m.setByteRange(d,p),p&&(m.fragOffset=p.fragOffset+p.duration),m}return y(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var h=this.elementaryStreams;return!!(h.audio||h.video||h.audiovideo)}}]),t}(A)},"./src/loader/key-loader.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return P});var R=s("./src/events.ts"),_=s("./src/errors.ts"),b=s("./src/utils/logger.ts"),P=function(){function M(D){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=D,this._registerListeners()}var I=M.prototype;return I._registerListeners=function(){this.hls.on(R.Events.KEY_LOADING,this.onKeyLoading,this)},I._unregisterListeners=function(){this.hls.off(R.Events.KEY_LOADING,this.onKeyLoading)},I.destroy=function(){this._unregisterListeners();for(var c in this.loaders){var T=this.loaders[c];T&&T.destroy()}this.loaders={}},I.onKeyLoading=function(c,T){var y=T.frag,E=y.type,A=this.loaders[E];if(!y.decryptdata){b.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var S=y.decryptdata.uri;if(S!==this.decrypturl||this.decryptkey===null){var n=this.hls.config;if(A&&(b.logger.warn("abort previous key loader for type:"+E),A.abort()),!S){b.logger.warn("key uri is falsy");return}var e=n.loader,t=y.loader=this.loaders[E]=new e(n);this.decrypturl=S,this.decryptkey=null;var a={url:S,frag:y,responseType:"arraybuffer"},h={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:n.fragLoadingRetryDelay,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:0},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.load(a,h,l)}else this.decryptkey&&(y.decryptdata.key=this.decryptkey,this.hls.trigger(R.Events.KEY_LOADED,{frag:y}))},I.loadsuccess=function(c,T,y){var E=y.frag;if(!E.decryptdata){b.logger.error("after key load, decryptdata unset");return}this.decryptkey=E.decryptdata.key=new Uint8Array(c.data),E.loader=null,delete this.loaders[E.type],this.hls.trigger(R.Events.KEY_LOADED,{frag:E})},I.loaderror=function(c,T){var y=T.frag,E=y.loader;E&&E.abort(),delete this.loaders[y.type],this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:y,response:c})},I.loadtimeout=function(c,T){var y=T.frag,E=y.loader;E&&E.abort(),delete this.loaders[y.type],this.hls.trigger(R.Events.ERROR,{type:_.ErrorTypes.NETWORK_ERROR,details:_.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:y})},M}()},"./src/loader/level-details.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"LevelDetails",function(){return M});var R=s("./src/polyfills/number.ts");function _(I,D){for(var c=0;c<D.length;c++){var T=D[c];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(I,T.key,T)}}function b(I,D,c){return D&&_(I.prototype,D),c&&_(I,c),I}var P=10,M=function(){function I(c){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=c}var D=I.prototype;return D.reloaded=function(T){if(!T){this.advanced=!0,this.updated=!0;return}var y=this.lastPartSn-T.lastPartSn,E=this.lastPartIndex-T.lastPartIndex;this.updated=this.endSN!==T.endSN||!!E||!!y,this.advanced=this.endSN>T.endSN||y>0||y===0&&E>0,this.updated||this.advanced?this.misses=Math.floor(T.misses*.6):this.misses=T.misses+1,this.availabilityDelay=T.availabilityDelay},b(I,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(R.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||P}},{key:"drift",get:function(){var T=this.driftEndTime-this.driftStartTime;if(T>0){var y=this.driftEnd-this.driftStart;return y*1e3/T}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var T;return(T=this.fragments)!==null&&T!==void 0&&T.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),I}()},"./src/loader/level-key.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"LevelKey",function(){return M});var R=s("./node_modules/url-toolkit/src/url-toolkit.js"),_=s.n(R);function b(I,D){for(var c=0;c<D.length;c++){var T=D[c];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(I,T.key,T)}}function P(I,D,c){return D&&b(I.prototype,D),c&&b(I,c),I}var M=function(){I.fromURL=function(c,T){return new I(c,T)},I.fromURI=function(c){return new I(c)};function I(D,c){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,c?this._uri=Object(R.buildAbsoluteURL)(D,c,{alwaysNormalize:!0}):this._uri=D}return P(I,[{key:"uri",get:function(){return this._uri}}]),I}()},"./src/loader/load-stats.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"LoadStats",function(){return R});var R=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return t});var R=s("./src/polyfills/number.ts"),_=s("./node_modules/url-toolkit/src/url-toolkit.js"),b=s.n(_),P=s("./src/loader/fragment.ts"),M=s("./src/loader/level-details.ts"),I=s("./src/loader/level-key.ts"),D=s("./src/utils/attr-list.ts"),c=s("./src/utils/logger.ts"),T=s("./src/utils/codecs.ts"),y=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,E=/#EXT-X-MEDIA:(.*)/g,A=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),S=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),n=/\.(mp4|m4s|m4v|m4a)$/i;function e(p){var m,d;return n.test((m=(d=_.parseURL(p))===null||d===void 0?void 0:d.path)!=null?m:"")}var t=function(){function p(){}return p.findGroup=function(d,u){for(var r=0;r<d.length;r++){var i=d[r];if(i.id===u)return i}},p.convertAVC1ToAVCOTI=function(d){var u=d.split(".");if(u.length>2){var r=u.shift()+".";return r+=parseInt(u.shift()).toString(16),r+=("000"+parseInt(u.shift()).toString(16)).substr(-4),r}return d},p.resolve=function(d,u){return _.buildAbsoluteURL(u,d,{alwaysNormalize:!0})},p.parseMasterPlaylist=function(d,u){var r=[],i={},v=!1;y.lastIndex=0;for(var g;(g=y.exec(d))!=null;)if(g[1]){var L=new D.AttrList(g[1]),C={attrs:L,bitrate:L.decimalInteger("AVERAGE-BANDWIDTH")||L.decimalInteger("BANDWIDTH"),name:L.NAME,url:p.resolve(g[2],u)},k=L.decimalResolution("RESOLUTION");k&&(C.width=k.width,C.height=k.height),a((L.CODECS||"").split(/[ ,]+/).filter(function(F){return F}),C),C.videoCodec&&C.videoCodec.indexOf("avc1")!==-1&&(C.videoCodec=p.convertAVC1ToAVCOTI(C.videoCodec)),r.push(C)}else if(g[3]){var U=new D.AttrList(g[3]);U["DATA-ID"]&&(v=!0,i[U["DATA-ID"]]=U)}return{levels:r,sessionData:v?i:null}},p.parseMasterPlaylistMedia=function(d,u,r,i){i===void 0&&(i=[]);var v,g=[],L=0;for(E.lastIndex=0;(v=E.exec(d))!==null;){var C=new D.AttrList(v[1]);if(C.TYPE===r){var k={attrs:C,bitrate:0,id:L++,groupId:C["GROUP-ID"],instreamId:C["INSTREAM-ID"],name:C.NAME||C.LANGUAGE||"",type:r,default:C.bool("DEFAULT"),autoselect:C.bool("AUTOSELECT"),forced:C.bool("FORCED"),lang:C.LANGUAGE,url:C.URI?p.resolve(C.URI,u):""};if(i.length){var U=p.findGroup(i,k.groupId)||i[0];h(k,U,"audioCodec"),h(k,U,"textCodec")}g.push(k)}}return g},p.parseLevelPlaylist=function(d,u,r,i,v){var g=new M.LevelDetails(u),L=g.fragments,C=null,k=0,U=0,F=0,B=0,N=null,K=new P.Fragment(i,u),H,j,W,V=-1,$=!1;for(A.lastIndex=0,g.m3u8=d;(H=A.exec(d))!==null;){$&&($=!1,K=new P.Fragment(i,u),K.start=F,K.sn=k,K.cc=B,K.level=r,C&&(K.initSegment=C,K.rawProgramDateTime=C.rawProgramDateTime));var Y=H[1];if(Y){K.duration=parseFloat(Y);var Q=(" "+H[2]).slice(1);K.title=Q||null,K.tagList.push(Q?["INF",Y,Q]:["INF",Y])}else if(H[3])Object(R.isFiniteNumber)(K.duration)&&(K.start=F,W&&(K.levelkey=W),K.sn=k,K.level=r,K.cc=B,K.urlId=v,L.push(K),K.relurl=(" "+H[3]).slice(1),f(K,N),N=K,F+=K.duration,k++,U=0,$=!0);else if(H[4]){var J=(" "+H[4]).slice(1);N?K.setByteRange(J,N):K.setByteRange(J)}else if(H[5])K.rawProgramDateTime=(" "+H[5]).slice(1),K.tagList.push(["PROGRAM-DATE-TIME",K.rawProgramDateTime]),V===-1&&(V=L.length);else{if(H=H[0].match(S),!H){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(j=1;j<H.length&&typeof H[j]=="undefined";j++);var ie=(" "+H[j]).slice(1),q=(" "+H[j+1]).slice(1),ne=H[j+2]?(" "+H[j+2]).slice(1):"";switch(ie){case"PLAYLIST-TYPE":g.type=q.toUpperCase();break;case"MEDIA-SEQUENCE":k=g.startSN=parseInt(q);break;case"SKIP":{var ge=new D.AttrList(q),ee=ge.decimalInteger("SKIPPED-SEGMENTS");if(Object(R.isFiniteNumber)(ee)){g.skippedSegments=ee;for(var te=ee;te--;)L.unshift(null);k+=ee}var z=ge.enumeratedString("RECENTLY-REMOVED-DATERANGES");z&&(g.recentlyRemovedDateranges=z.split("	"));break}case"TARGETDURATION":g.targetduration=parseFloat(q);break;case"VERSION":g.version=parseInt(q);break;case"EXTM3U":break;case"ENDLIST":g.live=!1;break;case"#":(q||ne)&&K.tagList.push(ne?[q,ne]:[q]);break;case"DIS":B++;case"GAP":K.tagList.push([ie]);break;case"BITRATE":K.tagList.push([ie,q]);break;case"DISCONTINUITY-SEQ":B=parseInt(q);break;case"KEY":{var X,ue=new D.AttrList(q),ve=ue.enumeratedString("METHOD"),fe=ue.URI,me=ue.hexadecimalInteger("IV"),pe=ue.enumeratedString("KEYFORMATVERSIONS"),ce=ue.enumeratedString("KEYID"),ae=(X=ue.enumeratedString("KEYFORMAT"))!=null?X:"identity",de=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(de.indexOf(ae)>-1){c.logger.warn("Keyformat "+ae+" is not supported from the manifest");continue}else if(ae!=="identity")continue;ve&&(W=I.LevelKey.fromURL(u,fe),fe&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ve)>=0&&(W.method=ve,W.keyFormat=ae,ce&&(W.keyID=ce),pe&&(W.keyFormatVersions=pe),W.iv=me));break}case"START":{var Ce=new D.AttrList(q),De=Ce.decimalFloatingPoint("TIME-OFFSET");Object(R.isFiniteNumber)(De)&&(g.startTimeOffset=De);break}case"MAP":{var Pe=new D.AttrList(q);K.relurl=Pe.URI,Pe.BYTERANGE&&K.setByteRange(Pe.BYTERANGE),K.level=r,K.sn="initSegment",W&&(K.levelkey=W),K.initSegment=null,C=K,$=!0;break}case"SERVER-CONTROL":{var _e=new D.AttrList(q);g.canBlockReload=_e.bool("CAN-BLOCK-RELOAD"),g.canSkipUntil=_e.optionalFloat("CAN-SKIP-UNTIL",0),g.canSkipDateRanges=g.canSkipUntil>0&&_e.bool("CAN-SKIP-DATERANGES"),g.partHoldBack=_e.optionalFloat("PART-HOLD-BACK",0),g.holdBack=_e.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ke=new D.AttrList(q);g.partTarget=Ke.decimalFloatingPoint("PART-TARGET");break}case"PART":{var Ee=g.partList;Ee||(Ee=g.partList=[]);var Ie=U>0?Ee[Ee.length-1]:void 0,Ze=U++,Ue=new P.Part(new D.AttrList(q),K,u,Ze,Ie);Ee.push(Ue),K.duration+=Ue.duration;break}case"PRELOAD-HINT":{var Be=new D.AttrList(q);g.preloadHint=Be;break}case"RENDITION-REPORT":{var st=new D.AttrList(q);g.renditionReports=g.renditionReports||[],g.renditionReports.push(st);break}default:c.logger.warn("line parsed but not handled: "+H);break}}}N&&!N.relurl?(L.pop(),F-=N.duration,g.partList&&(g.fragmentHint=N)):g.partList&&(f(K,N),K.cc=B,g.fragmentHint=K);var Fe=L.length,Le=L[0],He=L[Fe-1];if(F+=g.skippedSegments*g.targetduration,F>0&&Fe&&He){g.averagetargetduration=F/Fe;var ot=He.sn;g.endSN=ot!=="initSegment"?ot:0,Le&&(g.startCC=Le.cc,Le.initSegment||g.fragments.every(function(We){return We.relurl&&e(We.relurl)})&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),K=new P.Fragment(i,u),K.relurl=He.relurl,K.level=r,K.sn="initSegment",Le.initSegment=K,g.needSidxRanges=!0))}else g.endSN=0,g.startCC=0;return g.fragmentHint&&(F+=g.fragmentHint.duration),g.totalduration=F,g.endCC=B,V>0&&l(L,V),g},p}();function a(p,m){["video","audio","text"].forEach(function(d){var u=p.filter(function(i){return Object(T.isCodecType)(i,d)});if(u.length){var r=u.filter(function(i){return i.lastIndexOf("avc1",0)===0||i.lastIndexOf("mp4a",0)===0});m[d+"Codec"]=r.length>0?r[0]:u[0],p=p.filter(function(i){return u.indexOf(i)===-1})}}),m.unknownCodecs=p}function h(p,m,d){var u=m[d];u&&(p[d]=u)}function l(p,m){for(var d=p[m],u=m;u--;){var r=p[u];if(!r)return;r.programDateTime=d.programDateTime-r.duration*1e3,d=r}}function f(p,m){p.rawProgramDateTime?p.programDateTime=Date.parse(p.rawProgramDateTime):m!=null&&m.programDateTime&&(p.programDateTime=m.endProgramDateTime),Object(R.isFiniteNumber)(p.programDateTime)||(p.programDateTime=null,p.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/polyfills/number.ts"),_=s("./src/events.ts"),b=s("./src/errors.ts"),P=s("./src/utils/logger.ts"),M=s("./src/utils/mp4-tools.ts"),I=s("./src/loader/m3u8-parser.ts"),D=s("./src/types/loader.ts"),c=s("./src/utils/attr-list.ts");function T(A){var S=A.type;switch(S){case D.PlaylistContextType.AUDIO_TRACK:return D.PlaylistLevelType.AUDIO;case D.PlaylistContextType.SUBTITLE_TRACK:return D.PlaylistLevelType.SUBTITLE;default:return D.PlaylistLevelType.MAIN}}function y(A,S){var n=A.url;return(n===void 0||n.indexOf("data:")===0)&&(n=S.url),n}var E=function(){function A(n){this.hls=void 0,this.loaders=Object.create(null),this.hls=n,this.registerListeners()}var S=A.prototype;return S.registerListeners=function(){var e=this.hls;e.on(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(_.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.unregisterListeners=function(){var e=this.hls;e.off(_.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(_.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(_.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(_.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},S.createInternalLoader=function(e){var t=this.hls.config,a=t.pLoader,h=t.loader,l=a||h,f=new l(t);return e.loader=f,this.loaders[e.type]=f,f},S.getInternalLoader=function(e){return this.loaders[e.type]},S.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},S.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},S.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},S.onManifestLoading=function(e,t){var a=t.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:D.PlaylistContextType.MANIFEST,url:a,deliveryDirectives:null})},S.onLevelLoading=function(e,t){var a=t.id,h=t.level,l=t.url,f=t.deliveryDirectives;this.load({id:a,groupId:null,level:h,responseType:"text",type:D.PlaylistContextType.LEVEL,url:l,deliveryDirectives:f})},S.onAudioTrackLoading=function(e,t){var a=t.id,h=t.groupId,l=t.url,f=t.deliveryDirectives;this.load({id:a,groupId:h,level:null,responseType:"text",type:D.PlaylistContextType.AUDIO_TRACK,url:l,deliveryDirectives:f})},S.onSubtitleTrackLoading=function(e,t){var a=t.id,h=t.groupId,l=t.url,f=t.deliveryDirectives;this.load({id:a,groupId:h,level:null,responseType:"text",type:D.PlaylistContextType.SUBTITLE_TRACK,url:l,deliveryDirectives:f})},S.load=function(e){var t,a=this.hls.config,h=this.getInternalLoader(e);if(h){var l=h.context;if(l&&l.url===e.url){P.logger.trace("[playlist-loader]: playlist request ongoing");return}P.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),h.abort()}var f,p,m,d;switch(e.type){case D.PlaylistContextType.MANIFEST:f=a.manifestLoadingMaxRetry,p=a.manifestLoadingTimeOut,m=a.manifestLoadingRetryDelay,d=a.manifestLoadingMaxRetryTimeout;break;case D.PlaylistContextType.LEVEL:case D.PlaylistContextType.AUDIO_TRACK:case D.PlaylistContextType.SUBTITLE_TRACK:f=0,p=a.levelLoadingTimeOut;break;default:f=a.levelLoadingMaxRetry,p=a.levelLoadingTimeOut,m=a.levelLoadingRetryDelay,d=a.levelLoadingMaxRetryTimeout;break}if(h=this.createInternalLoader(e),(t=e.deliveryDirectives)!==null&&t!==void 0&&t.part){var u;if(e.type===D.PlaylistContextType.LEVEL&&e.level!==null?u=this.hls.levels[e.level].details:e.type===D.PlaylistContextType.AUDIO_TRACK&&e.id!==null?u=this.hls.audioTracks[e.id].details:e.type===D.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(u=this.hls.subtitleTracks[e.id].details),u){var r=u.partTarget,i=u.targetduration;r&&i&&(p=Math.min(Math.max(r*3,i*.8)*1e3,p))}}var v={timeout:p,maxRetry:f,retryDelay:m,maxRetryDelay:d,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.load(e,v,g)},S.loadsuccess=function(e,t,a,h){if(h===void 0&&(h=null),a.isSidxRequest){this.handleSidxRequest(e,a),this.handlePlaylistLoaded(e,t,a,h);return}this.resetInternalLoader(a.type);var l=e.data;if(l.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,a,"no EXTM3U delimiter",h);return}t.parsing.start=performance.now(),l.indexOf("#EXTINF:")>0||l.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,t,a,h):this.handleMasterPlaylist(e,t,a,h)},S.loaderror=function(e,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!1,e)},S.loadtimeout=function(e,t,a){a===void 0&&(a=null),this.handleNetworkError(t,a,!0)},S.handleMasterPlaylist=function(e,t,a,h){var l=this.hls,f=e.data,p=y(e,a),m=I.default.parseMasterPlaylist(f,p),d=m.levels,u=m.sessionData;if(!d.length){this.handleManifestParsingError(e,a,"no level found in manifest",h);return}var r=d.map(function(k){return{id:k.attrs.AUDIO,audioCodec:k.audioCodec}}),i=d.map(function(k){return{id:k.attrs.SUBTITLES,textCodec:k.textCodec}}),v=I.default.parseMasterPlaylistMedia(f,p,"AUDIO",r),g=I.default.parseMasterPlaylistMedia(f,p,"SUBTITLES",i),L=I.default.parseMasterPlaylistMedia(f,p,"CLOSED-CAPTIONS");if(v.length){var C=v.some(function(k){return!k.url});!C&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(P.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new c.AttrList({}),bitrate:0,url:""}))}l.trigger(_.Events.MANIFEST_LOADED,{levels:d,audioTracks:v,subtitles:g,captions:L,url:p,stats:t,networkDetails:h,sessionData:u})},S.handleTrackOrLevelPlaylist=function(e,t,a,h){var l=this.hls,f=a.id,p=a.level,m=a.type,d=y(e,a),u=Object(R.isFiniteNumber)(f)?f:0,r=Object(R.isFiniteNumber)(p)?p:u,i=T(a),v=I.default.parseLevelPlaylist(e.data,d,r,i,u);if(!v.fragments.length){l.trigger(_.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:d,reason:"no fragments found in level",level:typeof a.level=="number"?a.level:void 0});return}if(m===D.PlaylistContextType.MANIFEST){var g={attrs:new c.AttrList({}),bitrate:0,details:v,name:"",url:d};l.trigger(_.Events.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:d,stats:t,networkDetails:h,sessionData:null})}if(t.parsing.end=performance.now(),v.needSidxRanges){var L,C=(L=v.fragments[0].initSegment)===null||L===void 0?void 0:L.url;this.load({url:C,isSidxRequest:!0,type:m,level:p,levelDetails:v,id:f,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}a.levelDetails=v,this.handlePlaylistLoaded(e,t,a,h)},S.handleSidxRequest=function(e,t){var a=Object(M.parseSegmentIndex)(new Uint8Array(e.data));if(!!a){var h=a.references,l=t.levelDetails;h.forEach(function(f,p){var m=f.info,d=l.fragments[p];d.byteRange.length===0&&d.setByteRange(String(1+m.end-m.start)+"@"+String(m.start)),d.initSegment&&d.initSegment.setByteRange(String(a.moovEndOffset)+"@0")})}},S.handleManifestParsingError=function(e,t,a,h){this.hls.trigger(_.Events.ERROR,{type:b.ErrorTypes.NETWORK_ERROR,details:b.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===D.PlaylistContextType.MANIFEST,url:e.url,reason:a,response:e,context:t,networkDetails:h})},S.handleNetworkError=function(e,t,a,h){a===void 0&&(a=!1),P.logger.warn("[playlist-loader]: A network "+(a?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var l=b.ErrorDetails.UNKNOWN,f=!1,p=this.getInternalLoader(e);switch(e.type){case D.PlaylistContextType.MANIFEST:l=a?b.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b.ErrorDetails.MANIFEST_LOAD_ERROR,f=!0;break;case D.PlaylistContextType.LEVEL:l=a?b.ErrorDetails.LEVEL_LOAD_TIMEOUT:b.ErrorDetails.LEVEL_LOAD_ERROR,f=!1;break;case D.PlaylistContextType.AUDIO_TRACK:l=a?b.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:b.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,f=!1;break;case D.PlaylistContextType.SUBTITLE_TRACK:l=a?b.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:b.ErrorDetails.SUBTITLE_LOAD_ERROR,f=!1;break}p&&this.resetInternalLoader(e.type);var m={type:b.ErrorTypes.NETWORK_ERROR,details:l,fatal:f,url:e.url,loader:p,context:e,networkDetails:t};h&&(m.response=h),this.hls.trigger(_.Events.ERROR,m)},S.handlePlaylistLoaded=function(e,t,a,h){var l=a.type,f=a.level,p=a.id,m=a.groupId,d=a.loader,u=a.levelDetails,r=a.deliveryDirectives;if(!(u!=null&&u.targetduration)){this.handleManifestParsingError(e,a,"invalid target duration",h);return}if(!!d)switch(u.live&&(d.getCacheAge&&(u.ageHeader=d.getCacheAge()||0),(!d.getCacheAge||isNaN(u.ageHeader))&&(u.ageHeader=0)),l){case D.PlaylistContextType.MANIFEST:case D.PlaylistContextType.LEVEL:this.hls.trigger(_.Events.LEVEL_LOADED,{details:u,level:f||0,id:p||0,stats:t,networkDetails:h,deliveryDirectives:r});break;case D.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(_.Events.AUDIO_TRACK_LOADED,{details:u,id:p||0,groupId:m||"",stats:t,networkDetails:h,deliveryDirectives:r});break;case D.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(_.Events.SUBTITLE_TRACK_LOADED,{details:u,id:p||0,groupId:m||"",stats:t,networkDetails:h,deliveryDirectives:r});break}},A}();O.default=E},"./src/polyfills/number.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"isFiniteNumber",function(){return R}),s.d(O,"MAX_SAFE_INTEGER",function(){return _});var R=Number.isFinite||function(b){return typeof b=="number"&&isFinite(b)},_=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(x,O,s){"use strict";s.r(O);var R=function(){function _(){}return _.getSilentFrame=function(P,M){switch(P){case"mp4a.40.2":if(M===1)return new Uint8Array([0,200,0,128,35,128]);if(M===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(M===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(M===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(M===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(M===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(M===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(M===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(M===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},_}();O.default=R},"./src/remux/mp4-generator.ts":function(x,O,s){"use strict";s.r(O);var R=Math.pow(2,32)-1,_=function(){function b(){}return b.init=function(){b.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var M;for(M in b.types)b.types.hasOwnProperty(M)&&(b.types[M]=[M.charCodeAt(0),M.charCodeAt(1),M.charCodeAt(2),M.charCodeAt(3)]);var I=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);b.HDLR_TYPES={video:I,audio:D};var c=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),T=new Uint8Array([0,0,0,0,0,0,0,0]);b.STTS=b.STSC=b.STCO=T,b.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),b.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),b.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),b.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var y=new Uint8Array([105,115,111,109]),E=new Uint8Array([97,118,99,49]),A=new Uint8Array([0,0,0,1]);b.FTYP=b.box(b.types.ftyp,y,A,y,E),b.DINF=b.box(b.types.dinf,b.box(b.types.dref,c))},b.box=function(M){for(var I=8,D=arguments.length,c=new Array(D>1?D-1:0),T=1;T<D;T++)c[T-1]=arguments[T];for(var y=c.length,E=y;y--;)I+=c[y].byteLength;var A=new Uint8Array(I);for(A[0]=I>>24&255,A[1]=I>>16&255,A[2]=I>>8&255,A[3]=I&255,A.set(M,4),y=0,I=8;y<E;y++)A.set(c[y],I),I+=c[y].byteLength;return A},b.hdlr=function(M){return b.box(b.types.hdlr,b.HDLR_TYPES[M])},b.mdat=function(M){return b.box(b.types.mdat,M)},b.mdhd=function(M,I){I*=M;var D=Math.floor(I/(R+1)),c=Math.floor(I%(R+1));return b.box(b.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,M>>24&255,M>>16&255,M>>8&255,M&255,D>>24,D>>16&255,D>>8&255,D&255,c>>24,c>>16&255,c>>8&255,c&255,85,196,0,0]))},b.mdia=function(M){return b.box(b.types.mdia,b.mdhd(M.timescale,M.duration),b.hdlr(M.type),b.minf(M))},b.mfhd=function(M){return b.box(b.types.mfhd,new Uint8Array([0,0,0,0,M>>24,M>>16&255,M>>8&255,M&255]))},b.minf=function(M){return M.type==="audio"?b.box(b.types.minf,b.box(b.types.smhd,b.SMHD),b.DINF,b.stbl(M)):b.box(b.types.minf,b.box(b.types.vmhd,b.VMHD),b.DINF,b.stbl(M))},b.moof=function(M,I,D){return b.box(b.types.moof,b.mfhd(M),b.traf(D,I))},b.moov=function(M){for(var I=M.length,D=[];I--;)D[I]=b.trak(M[I]);return b.box.apply(null,[b.types.moov,b.mvhd(M[0].timescale,M[0].duration)].concat(D).concat(b.mvex(M)))},b.mvex=function(M){for(var I=M.length,D=[];I--;)D[I]=b.trex(M[I]);return b.box.apply(null,[b.types.mvex].concat(D))},b.mvhd=function(M,I){I*=M;var D=Math.floor(I/(R+1)),c=Math.floor(I%(R+1)),T=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,M>>24&255,M>>16&255,M>>8&255,M&255,D>>24,D>>16&255,D>>8&255,D&255,c>>24,c>>16&255,c>>8&255,c&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return b.box(b.types.mvhd,T)},b.sdtp=function(M){var I=M.samples||[],D=new Uint8Array(4+I.length),c,T;for(c=0;c<I.length;c++)T=I[c].flags,D[c+4]=T.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy;return b.box(b.types.sdtp,D)},b.stbl=function(M){return b.box(b.types.stbl,b.stsd(M),b.box(b.types.stts,b.STTS),b.box(b.types.stsc,b.STSC),b.box(b.types.stsz,b.STSZ),b.box(b.types.stco,b.STCO))},b.avc1=function(M){var I=[],D=[],c,T,y;for(c=0;c<M.sps.length;c++)T=M.sps[c],y=T.byteLength,I.push(y>>>8&255),I.push(y&255),I=I.concat(Array.prototype.slice.call(T));for(c=0;c<M.pps.length;c++)T=M.pps[c],y=T.byteLength,D.push(y>>>8&255),D.push(y&255),D=D.concat(Array.prototype.slice.call(T));var E=b.box(b.types.avcC,new Uint8Array([1,I[3],I[4],I[5],252|3,224|M.sps.length].concat(I).concat([M.pps.length]).concat(D))),A=M.width,S=M.height,n=M.pixelRatio[0],e=M.pixelRatio[1];return b.box(b.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,A>>8&255,A&255,S>>8&255,S&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),E,b.box(b.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),b.box(b.types.pasp,new Uint8Array([n>>24,n>>16&255,n>>8&255,n&255,e>>24,e>>16&255,e>>8&255,e&255])))},b.esds=function(M){var I=M.config.length;return new Uint8Array([0,0,0,0,3,23+I,0,1,0,4,15+I,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([I]).concat(M.config).concat([6,1,2]))},b.mp4a=function(M){var I=M.samplerate;return b.box(b.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,M.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]),b.box(b.types.esds,b.esds(M)))},b.mp3=function(M){var I=M.samplerate;return b.box(b.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,M.channelCount,0,16,0,0,0,0,I>>8&255,I&255,0,0]))},b.stsd=function(M){return M.type==="audio"?!M.isAAC&&M.codec==="mp3"?b.box(b.types.stsd,b.STSD,b.mp3(M)):b.box(b.types.stsd,b.STSD,b.mp4a(M)):b.box(b.types.stsd,b.STSD,b.avc1(M))},b.tkhd=function(M){var I=M.id,D=M.duration*M.timescale,c=M.width,T=M.height,y=Math.floor(D/(R+1)),E=Math.floor(D%(R+1));return b.box(b.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,0,0,0,0,y>>24,y>>16&255,y>>8&255,y&255,E>>24,E>>16&255,E>>8&255,E&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,c>>8&255,c&255,0,0,T>>8&255,T&255,0,0]))},b.traf=function(M,I){var D=b.sdtp(M),c=M.id,T=Math.floor(I/(R+1)),y=Math.floor(I%(R+1));return b.box(b.types.traf,b.box(b.types.tfhd,new Uint8Array([0,0,0,0,c>>24,c>>16&255,c>>8&255,c&255])),b.box(b.types.tfdt,new Uint8Array([1,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,y>>24,y>>16&255,y>>8&255,y&255])),b.trun(M,D.length+16+20+8+16+8+8),D)},b.trak=function(M){return M.duration=M.duration||4294967295,b.box(b.types.trak,b.tkhd(M),b.mdia(M))},b.trex=function(M){var I=M.id;return b.box(b.types.trex,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},b.trun=function(M,I){var D=M.samples||[],c=D.length,T=12+16*c,y=new Uint8Array(T),E,A,S,n,e,t;for(I+=8+T,y.set([0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,c&255,I>>>24&255,I>>>16&255,I>>>8&255,I&255],0),E=0;E<c;E++)A=D[E],S=A.duration,n=A.size,e=A.flags,t=A.cts,y.set([S>>>24&255,S>>>16&255,S>>>8&255,S&255,n>>>24&255,n>>>16&255,n>>>8&255,n&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,t>>>24&255,t>>>16&255,t>>>8&255,t&255],12+16*E);return b.box(b.types.trun,y)},b.initSegment=function(M){b.types||b.init();var I=b.moov(M),D=new Uint8Array(b.FTYP.byteLength+I.byteLength);return D.set(b.FTYP),D.set(I,b.FTYP.byteLength),D},b}();_.types=void 0,_.HDLR_TYPES=void 0,_.STTS=void 0,_.STSC=void 0,_.STCO=void 0,_.STSZ=void 0,_.VMHD=void 0,_.SMHD=void 0,_.STSD=void 0,_.FTYP=void 0,_.DINF=void 0,O.default=_},"./src/remux/mp4-remuxer.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return t}),s.d(O,"normalizePts",function(){return a});var R=s("./src/polyfills/number.ts"),_=s("./src/remux/aac-helper.ts"),b=s("./src/remux/mp4-generator.ts"),P=s("./src/events.ts"),M=s("./src/errors.ts"),I=s("./src/utils/logger.ts"),D=s("./src/types/loader.ts"),c=s("./src/utils/timescale-conversion.ts");function T(){return T=Object.assign||function(p){for(var m=1;m<arguments.length;m++){var d=arguments[m];for(var u in d)Object.prototype.hasOwnProperty.call(d,u)&&(p[u]=d[u])}return p},T.apply(this,arguments)}var y=10*1e3,E=1024,A=1152,S=null,n=null,e=!1,t=function(){function p(d,u,r,i){if(i===void 0&&(i=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=d,this.config=u,this.typeSupported=r,this.ISGenerated=!1,S===null){var v=navigator.userAgent||"",g=v.match(/Chrome\/(\d+)/i);S=g?parseInt(g[1]):0}if(n===null){var L=navigator.userAgent.match(/Safari\/(\d+)/i);n=L?parseInt(L[1]):0}e=!!S&&S<75||!!n&&n<600}var m=p.prototype;return m.destroy=function(){},m.resetTimeStamp=function(u){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=u},m.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},m.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},m.getVideoStartPts=function(u){var r=!1,i=u.reduce(function(v,g){var L=g.pts-v;return L<-4294967296?(r=!0,a(v,g.pts)):L>0?v:g.pts},u[0].pts);return r&&I.logger.debug("PTS rollover detected"),i},m.remux=function(u,r,i,v,g,L,C,k){var U,F,B,N,K,H,j=g,W=g,V=u.pid>-1,$=r.pid>-1,Y=r.samples.length,Q=u.samples.length>0,J=Y>1,ie=(!V||Q)&&(!$||J)||this.ISGenerated||C;if(ie){this.ISGenerated||(B=this.generateIS(u,r,g));var q=this.isVideoContiguous,ne=-1;if(J&&(ne=h(r.samples),!q&&this.config.forceKeyFrameOnDiscontinuity))if(H=!0,ne>0){I.logger.warn("[mp4-remuxer]: Dropped "+ne+" out of "+Y+" video samples due to a missing keyframe");var ge=this.getVideoStartPts(r.samples);r.samples=r.samples.slice(ne),r.dropped+=ne,W+=(r.samples[0].pts-ge)/(r.timescale||9e4)}else ne===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+Y+" video samples"),H=!1);if(this.ISGenerated){if(Q&&J){var ee=this.getVideoStartPts(r.samples),te=a(u.samples[0].pts,ee)-ee,z=te/r.inputTimeScale;j+=Math.max(0,z),W+=Math.max(0,-z)}if(Q){if(u.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),B=this.generateIS(u,r,g)),F=this.remuxAudio(u,j,this.isAudioContiguous,L,$||J||k===D.PlaylistLevelType.AUDIO?W:void 0),J){var X=F?F.endPTS-F.startPTS:0;r.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),B=this.generateIS(u,r,g)),U=this.remuxVideo(r,W,q,X)}}else J&&(U=this.remuxVideo(r,W,q,0));U&&(U.firstKeyFrame=ne,U.independent=ne!==-1)}}return this.ISGenerated&&(i.samples.length&&(K=this.remuxID3(i,g)),v.samples.length&&(N=this.remuxText(v,g))),{audio:F,video:U,initSegment:B,independent:H,text:N,id3:K}},m.generateIS=function(u,r,i){var v=u.samples,g=r.samples,L=this.typeSupported,C={},k=!Object(R.isFiniteNumber)(this._initPTS),U="audio/mp4",F,B,N;if(k&&(F=B=1/0),u.config&&v.length&&(u.timescale=u.samplerate,u.isAAC||(L.mpeg?(U="audio/mpeg",u.codec=""):L.mp3&&(u.codec="mp3")),C.audio={id:"audio",container:U,codec:u.codec,initSegment:!u.isAAC&&L.mpeg?new Uint8Array(0):b.default.initSegment([u]),metadata:{channelCount:u.channelCount}},k&&(N=u.inputTimeScale,F=B=v[0].pts-Math.round(N*i))),r.sps&&r.pps&&g.length&&(r.timescale=r.inputTimeScale,C.video={id:"main",container:"video/mp4",codec:r.codec,initSegment:b.default.initSegment([r]),metadata:{width:r.width,height:r.height}},k)){N=r.inputTimeScale;var K=this.getVideoStartPts(g),H=Math.round(N*i);B=Math.min(B,a(g[0].dts,K)-H),F=Math.min(F,K-H)}if(Object.keys(C).length)return this.ISGenerated=!0,k&&(this._initPTS=F,this._initDTS=B),{tracks:C,initPTS:F,timescale:N}},m.remuxVideo=function(u,r,i,v){var g=u.inputTimeScale,L=u.samples,C=[],k=L.length,U=this._initPTS,F=this.nextAvcDts,B=8,N,K,H,j=Number.POSITIVE_INFINITY,W=Number.NEGATIVE_INFINITY,V=0,$=!1;if(!i||F===null){var Y=r*g,Q=L[0].pts-a(L[0].dts,L[0].pts);F=Y-Q}for(var J=0;J<k;J++){var ie=L[J];if(ie.pts=a(ie.pts-U,F),ie.dts=a(ie.dts-U,F),ie.dts>ie.pts){var q=9e4*.2;V=Math.max(Math.min(V,ie.pts-ie.dts),-1*q)}ie.dts<L[J>0?J-1:J].dts&&($=!0)}$&&L.sort(function(Wt,mi){var ns=Wt.dts-mi.dts,as=Wt.pts-mi.pts;return ns||as}),K=L[0].dts,H=L[L.length-1].dts;var ne=Math.round((H-K)/(k-1));if(V<0){if(V<ne*-2){I.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(c.toMsFromMpegTsClock)(-ne,!0)+" ms");for(var ge=V,ee=0;ee<k;ee++)L[ee].dts=ge=Math.max(ge,L[ee].pts-ne),L[ee].pts=Math.max(ge,L[ee].pts)}else{I.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(c.toMsFromMpegTsClock)(V,!0)+" ms to overcome this issue");for(var te=0;te<k;te++)L[te].dts=L[te].dts+V}K=L[0].dts}if(i){var z=K-F,X=z>ne,ue=z<-1;if(X||ue){X?I.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(z,!0)+" ms ("+z+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+Object(c.toMsFromMpegTsClock)(-z,!0)+" ms ("+z+"dts) overlapping between fragments detected"),K=F;var ve=L[0].pts-z;L[0].dts=K,L[0].pts=ve,I.logger.log("Video: First PTS/DTS adjusted: "+Object(c.toMsFromMpegTsClock)(ve,!0)+"/"+Object(c.toMsFromMpegTsClock)(K,!0)+", delta: "+Object(c.toMsFromMpegTsClock)(z,!0)+" ms")}}e&&(K=Math.max(0,K));for(var fe=0,me=0,pe=0;pe<k;pe++){for(var ce=L[pe],ae=ce.units,de=ae.length,Ce=0,De=0;De<de;De++)Ce+=ae[De].data.length;me+=Ce,fe+=de,ce.length=Ce,ce.dts=Math.max(ce.dts,K),ce.pts=Math.max(ce.pts,ce.dts,0),j=Math.min(ce.pts,j),W=Math.max(ce.pts,W)}H=L[k-1].dts;var Pe=me+4*fe+8,_e;try{_e=new Uint8Array(Pe)}catch{this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:M.ErrorTypes.MUX_ERROR,details:M.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Pe,reason:"fail allocating video mdat "+Pe});return}var Ke=new DataView(_e.buffer);Ke.setUint32(0,Pe),_e.set(b.default.types.mdat,4);for(var Ee=0;Ee<k;Ee++){for(var Ie=L[Ee],Ze=Ie.units,Ue=0,Be=0,st=Ze.length;Be<st;Be++){var Fe=Ze[Be],Le=Fe.data,He=Fe.data.byteLength;Ke.setUint32(B,He),B+=4,_e.set(Le,B),B+=He,Ue+=4+He}if(Ee<k-1)N=L[Ee+1].dts-Ie.dts;else{var ot=this.config,We=Ie.dts-L[Ee>0?Ee-1:Ee].dts;if(ot.stretchShortVideoTrack&&this.nextAudioPts!==null){var qa=Math.floor(ot.maxBufferHole*g),Ht=(v?j+v*g:this.nextAudioPts)-Ie.pts;Ht>qa?(N=Ht-We,N<0&&(N=We),I.logger.log("[mp4-remuxer]: It is approximately "+Ht/90+" ms to the next segment; using duration "+N/90+" ms for the last video frame.")):N=We}else N=We}var es=Math.round(Ie.pts-Ie.dts);C.push(new l(Ie.key,N,Ue,es))}if(C.length&&S&&S<70){var gi=C[0].flags;gi.dependsOn=2,gi.isNonSync=0}console.assert(N!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=F=H+N,this.isVideoContiguous=!0;var ts=b.default.moof(u.sequenceNumber++,K,T({},u,{samples:C})),rs="video",is={data1:ts,data2:_e,startPTS:j/g,endPTS:(W+N)/g,startDTS:K/g,endDTS:F/g,type:rs,hasAudio:!1,hasVideo:!0,nb:C.length,dropped:u.dropped};return u.samples=[],u.dropped=0,console.assert(_e.length,"MDAT length must not be zero"),is},m.remuxAudio=function(u,r,i,v,g){var L=u.inputTimeScale,C=u.samplerate?u.samplerate:L,k=L/C,U=u.isAAC?E:A,F=U*k,B=this._initPTS,N=!u.isAAC&&this.typeSupported.mpeg,K=[],H=u.samples,j=N?0:8,W=this.nextAudioPts||-1,V=r*L;if(this.isAudioContiguous=i=i||H.length&&W>0&&(v&&Math.abs(V-W)<9e3||Math.abs(a(H[0].pts-B,V)-W)<20*F),H.forEach(function(Le){Le.pts=a(Le.pts-B,V)}),!i||W<0){if(H=H.filter(function(Le){return Le.pts>=0}),!H.length)return;g===0?W=0:v?W=Math.max(0,V):W=H[0].pts}if(u.isAAC)for(var $=g!==void 0,Y=this.config.maxAudioFramesDrift,Q=0,J=W;Q<H.length;Q++){var ie=H[Q],q=ie.pts,ne=q-J,ge=Math.abs(1e3*ne/L);if(ne<=-Y*F&&$)Q===0&&(I.logger.warn("Audio frame @ "+(q/L).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ne/L)+" ms."),this.nextAudioPts=W=J=q);else if(ne>=Y*F&&ge<y&&$){var ee=Math.round(ne/F);J=q-ee*F,J<0&&(ee--,J+=F),Q===0&&(this.nextAudioPts=W=J),I.logger.warn("[mp4-remuxer]: Injecting "+ee+" audio frame @ "+(J/L).toFixed(3)+"s due to "+Math.round(1e3*ne/L)+" ms gap.");for(var te=0;te<ee;te++){var z=Math.max(J,0),X=_.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);X||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),X=ie.unit.subarray()),H.splice(Q,0,{unit:X,pts:z}),J+=F,Q++}}ie.pts=J,J+=F}for(var ue=null,ve=null,fe,me=0,pe=H.length;pe--;)me+=H[pe].unit.byteLength;for(var ce=0,ae=H.length;ce<ae;ce++){var de=H[ce],Ce=de.unit,De=de.pts;if(ve!==null){var Pe=K[ce-1];Pe.duration=Math.round((De-ve)/k)}else if(i&&u.isAAC&&(De=W),ue=De,me>0){me+=j;try{fe=new Uint8Array(me)}catch{this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:M.ErrorTypes.MUX_ERROR,details:M.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:me,reason:"fail allocating audio mdat "+me});return}if(!N){var _e=new DataView(fe.buffer);_e.setUint32(0,me),fe.set(b.default.types.mdat,4)}}else return;fe.set(Ce,j);var Ke=Ce.byteLength;j+=Ke,K.push(new l(!0,U,Ke,0)),ve=De}var Ee=K.length;if(!!Ee){var Ie=K[K.length-1];this.nextAudioPts=W=ve+k*Ie.duration;var Ze=N?new Uint8Array(0):b.default.moof(u.sequenceNumber++,ue/k,T({},u,{samples:K}));u.samples=[];var Ue=ue/L,Be=W/L,st="audio",Fe={data1:Ze,data2:fe,startPTS:Ue,endPTS:Be,startDTS:Ue,endDTS:Be,type:st,hasAudio:!0,hasVideo:!1,nb:Ee};return this.isAudioContiguous=!0,console.assert(fe.length,"MDAT length must not be zero"),Fe}},m.remuxEmptyAudio=function(u,r,i,v){var g=u.inputTimeScale,L=u.samplerate?u.samplerate:g,C=g/L,k=this.nextAudioPts,U=(k!==null?k:v.startDTS*g)+this._initDTS,F=v.endDTS*g+this._initDTS,B=C*E,N=Math.ceil((F-U)/B),K=_.default.getSilentFrame(u.manifestCodec||u.codec,u.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!K){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var H=[],j=0;j<N;j++){var W=U+j*B;H.push({unit:K,pts:W,dts:W})}return u.samples=H,this.remuxAudio(u,r,i,!1)},m.remuxID3=function(u,r){var i=u.samples.length;if(!!i){for(var v=u.inputTimeScale,g=this._initPTS,L=this._initDTS,C=0;C<i;C++){var k=u.samples[C];k.pts=a(k.pts-g,r*v)/v,k.dts=a(k.dts-L,r*v)/v}var U=u.samples;return u.samples=[],{samples:U}}},m.remuxText=function(u,r){var i=u.samples.length;if(!!i){for(var v=u.inputTimeScale,g=this._initPTS,L=0;L<i;L++){var C=u.samples[L];C.pts=a(C.pts-g,r*v)/v}u.samples.sort(function(U,F){return U.pts-F.pts});var k=u.samples;return u.samples=[],{samples:k}}},p}();function a(p,m){var d;if(m===null)return p;for(m<p?d=-8589934592:d=8589934592;Math.abs(p-m)>4294967296;)p+=d;return p}function h(p){for(var m=0;m<p.length;m++)if(p[m].key)return m;return-1}var l=function(m,d,u,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=d,this.size=u,this.cts=r,this.flags=new f(m)},f=function(m){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=m?2:1,this.isNonSync=m?0:1}},"./src/remux/passthrough-remuxer.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/polyfills/number.ts"),_=s("./src/utils/mp4-tools.ts"),b=s("./src/loader/fragment.ts"),P=s("./src/utils/logger.ts"),M=function(){function c(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var T=c.prototype;return T.destroy=function(){},T.resetTimeStamp=function(E){this.initPTS=E,this.lastEndDTS=null},T.resetNextTimestamp=function(){this.lastEndDTS=null},T.resetInitSegment=function(E,A,S){this.audioCodec=A,this.videoCodec=S,this.generateInitSegment(E),this.emitInitSegment=!0},T.generateInitSegment=function(E){var A=this.audioCodec,S=this.videoCodec;if(!E||!E.byteLength){this.initTracks=void 0,this.initData=void 0;return}var n=this.initData=Object(_.parseInitSegment)(E);A||(A=D(n.audio,b.ElementaryStreamTypes.AUDIO)),S||(S=D(n.video,b.ElementaryStreamTypes.VIDEO));var e={};n.audio&&n.video?e.audiovideo={container:"video/mp4",codec:A+","+S,initSegment:E,id:"main"}:n.audio?e.audio={container:"audio/mp4",codec:A,initSegment:E,id:"audio"}:n.video?e.video={container:"video/mp4",codec:S,initSegment:E,id:"main"}:P.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=e},T.remux=function(E,A,S,n,e){var t=this.initPTS,a=this.lastEndDTS,h={audio:void 0,video:void 0,text:n,id3:S,initSegment:void 0};Object(R.isFiniteNumber)(a)||(a=this.lastEndDTS=e||0);var l=A.samples;if(!l||!l.length)return h;var f={initPTS:void 0,timescale:1},p=this.initData;if((!p||!p.length)&&(this.generateInitSegment(l),p=this.initData),!p||!p.length)return P.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),h;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(R.isFiniteNumber)(t)||(this.initPTS=f.initPTS=t=I(p,l,a));var m=Object(_.getDuration)(l,p),d=a,u=m+d;Object(_.offsetStartDTS)(p,l,t),m>0?this.lastEndDTS=u:(P.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var r=!!p.audio,i=!!p.video,v="";r&&(v+="audio"),i&&(v+="video");var g={data1:l,startPTS:d,startDTS:d,endPTS:u,endDTS:u,type:v,hasAudio:r,hasVideo:i,nb:1,dropped:0};return h.audio=g.type==="audio"?g:void 0,h.video=g.type!=="audio"?g:void 0,h.text=n,h.id3=S,h.initSegment=f,h},c}(),I=function(T,y,E){return Object(_.getStartDTS)(T,y)-E};function D(c,T){var y=c==null?void 0:c.codec;return y&&y.length>4?y:y==="hvc1"?"hvc1.1.c.L120.90":y==="av01"?"av01.0.04M.08":y==="avc1"||T===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}O.default=M},"./src/task-loop.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return R});var R=function(){function _(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var b=_.prototype;return b.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},b.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},b.onHandlerDestroyed=function(){},b.hasInterval=function(){return!!this._tickInterval},b.hasNextTick=function(){return!!this._tickTimer},b.setInterval=function(M){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,M),!0)},b.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},b.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},b.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},b.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},b.doTick=function(){},_}()},"./src/types/level.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"HlsSkip",function(){return b}),s.d(O,"getSkipValue",function(){return P}),s.d(O,"HlsUrlParameters",function(){return M}),s.d(O,"Level",function(){return I});function R(D,c){for(var T=0;T<c.length;T++){var y=c[T];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(D,y.key,y)}}function _(D,c,T){return c&&R(D.prototype,c),T&&R(D,T),D}var b;(function(D){D.No="",D.Yes="YES",D.v2="v2"})(b||(b={}));function P(D,c){var T=D.canSkipUntil,y=D.canSkipDateRanges,E=D.endSN,A=c!==void 0?c-E:0;return T&&A<T?y?b.v2:b.Yes:b.No}var M=function(){function D(T,y,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=T,this.part=y,this.skip=E}var c=D.prototype;return c.addDirectives=function(y){var E=new self.URL(y);return this.msn!==void 0&&E.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.toString()},D}(),I=function(){function D(c){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[c.url],this.attrs=c.attrs,this.bitrate=c.bitrate,c.details&&(this.details=c.details),this.id=c.id||0,this.name=c.name,this.width=c.width||0,this.height=c.height||0,this.audioCodec=c.audioCodec,this.videoCodec=c.videoCodec,this.unknownCodecs=c.unknownCodecs,this.codecSet=[c.videoCodec,c.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}return _(D,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(T){var y=T%this.url.length;this._urlId!==y&&(this.details=void 0,this._urlId=y)}}]),D}()},"./src/types/loader.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"PlaylistContextType",function(){return R}),s.d(O,"PlaylistLevelType",function(){return _});var R;(function(b){b.MANIFEST="manifest",b.LEVEL="level",b.AUDIO_TRACK="audioTrack",b.SUBTITLE_TRACK="subtitleTrack"})(R||(R={}));var _;(function(b){b.MAIN="main",b.AUDIO="audio",b.SUBTITLE="subtitle"})(_||(_={}))},"./src/types/transmuxer.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"ChunkMetadata",function(){return R});var R=function(P,M,I,D,c,T){D===void 0&&(D=0),c===void 0&&(c=-1),T===void 0&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=_(),this.buffering={audio:_(),video:_(),audiovideo:_()},this.level=P,this.sn=M,this.id=I,this.size=D,this.part=c,this.partial=T};function _(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"AttrList",function(){return b});var R=/^(\d+)x(\d+)$/,_=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,b=function(){function P(I){typeof I=="string"&&(I=P.parseAttrList(I));for(var D in I)I.hasOwnProperty(D)&&(this[D]=I[D])}var M=P.prototype;return M.decimalInteger=function(D){var c=parseInt(this[D],10);return c>Number.MAX_SAFE_INTEGER?1/0:c},M.hexadecimalInteger=function(D){if(this[D]){var c=(this[D]||"0x").slice(2);c=(c.length&1?"0":"")+c;for(var T=new Uint8Array(c.length/2),y=0;y<c.length/2;y++)T[y]=parseInt(c.slice(y*2,y*2+2),16);return T}else return null},M.hexadecimalIntegerAsNumber=function(D){var c=parseInt(this[D],16);return c>Number.MAX_SAFE_INTEGER?1/0:c},M.decimalFloatingPoint=function(D){return parseFloat(this[D])},M.optionalFloat=function(D,c){var T=this[D];return T?parseFloat(T):c},M.enumeratedString=function(D){return this[D]},M.bool=function(D){return this[D]==="YES"},M.decimalResolution=function(D){var c=R.exec(this[D]);if(c!==null)return{width:parseInt(c[1],10),height:parseInt(c[2],10)}},P.parseAttrList=function(D){var c,T={},y='"';for(_.lastIndex=0;(c=_.exec(D))!==null;){var E=c[2];E.indexOf(y)===0&&E.lastIndexOf(y)===E.length-1&&(E=E.slice(1,-1)),T[c[1]]=E}return T},P}()},"./src/utils/binary-search.ts":function(x,O,s){"use strict";s.r(O);var R={search:function(b,P){for(var M=0,I=b.length-1,D=null,c=null;M<=I;){D=(M+I)/2|0,c=b[D];var T=P(c);if(T>0)M=D+1;else if(T<0)I=D-1;else return c}return null}};O.default=R},"./src/utils/buffer-helper.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"BufferHelper",function(){return b});var R=s("./src/utils/logger.ts"),_={length:0,start:function(){return 0},end:function(){return 0}},b=function(){function P(){}return P.isBuffered=function(I,D){try{if(I){for(var c=P.getBuffered(I),T=0;T<c.length;T++)if(D>=c.start(T)&&D<=c.end(T))return!0}}catch{}return!1},P.bufferInfo=function(I,D,c){try{if(I){var T=P.getBuffered(I),y=[],E;for(E=0;E<T.length;E++)y.push({start:T.start(E),end:T.end(E)});return this.bufferedInfo(y,D,c)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},P.bufferedInfo=function(I,D,c){D=Math.max(0,D),I.sort(function(f,p){var m=f.start-p.start;return m||p.end-f.end});var T=[];if(c)for(var y=0;y<I.length;y++){var E=T.length;if(E){var A=T[E-1].end;I[y].start-A<c?I[y].end>A&&(T[E-1].end=I[y].end):T.push(I[y])}else T.push(I[y])}else T=I;for(var S=0,n,e=D,t=D,a=0;a<T.length;a++){var h=T[a].start,l=T[a].end;if(D+c>=h&&D<l)e=h,t=l,S=t-D;else if(D+c<h){n=h;break}}return{len:S,start:e||0,end:t||0,nextStart:n}},P.getBuffered=function(I){try{return I.buffered}catch(D){return R.logger.log("failed to get media.buffered",D),_}},P}()},"./src/utils/cea-608-parser.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"Row",function(){return t}),s.d(O,"CaptionScreen",function(){return a});var R=s("./src/utils/logger.ts"),_={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},b=function(u){var r=u;return _.hasOwnProperty(u)&&(r=_[u]),String.fromCharCode(r)},P=15,M=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},D={17:2,18:4,21:6,22:8,23:10,19:13,20:15},c={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},y=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(d){d[d.ERROR=0]="ERROR",d[d.TEXT=1]="TEXT",d[d.WARNING=2]="WARNING",d[d.INFO=2]="INFO",d[d.DEBUG=3]="DEBUG",d[d.DATA=3]="DATA"})(E||(E={}));var A=function(){function d(){this.time=null,this.verboseLevel=E.ERROR}var u=d.prototype;return u.log=function(i,v){this.verboseLevel>=i&&R.logger.log(this.time+" ["+i+"] "+v)},d}(),S=function(u){for(var r=[],i=0;i<u.length;i++)r.push(u[i].toString(16));return r},n=function(){function d(r,i,v,g,L){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=r||"white",this.underline=i||!1,this.italics=v||!1,this.background=g||"black",this.flash=L||!1}var u=d.prototype;return u.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},u.setStyles=function(i){for(var v=["foreground","underline","italics","background","flash"],g=0;g<v.length;g++){var L=v[g];i.hasOwnProperty(L)&&(this[L]=i[L])}},u.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},u.equals=function(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash},u.copy=function(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash},u.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},d}(),e=function(){function d(r,i,v,g,L,C){this.uchar=void 0,this.penState=void 0,this.uchar=r||" ",this.penState=new n(i,v,g,L,C)}var u=d.prototype;return u.reset=function(){this.uchar=" ",this.penState.reset()},u.setChar=function(i,v){this.uchar=i,this.penState.copy(v)},u.setPenState=function(i){this.penState.copy(i)},u.equals=function(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)},u.copy=function(i){this.uchar=i.uchar,this.penState.copy(i.penState)},u.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},d}(),t=function(){function d(r){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var i=0;i<M;i++)this.chars.push(new e);this.logger=r,this.pos=0,this.currPenState=new n}var u=d.prototype;return u.equals=function(i){for(var v=!0,g=0;g<M;g++)if(!this.chars[g].equals(i.chars[g])){v=!1;break}return v},u.copy=function(i){for(var v=0;v<M;v++)this.chars[v].copy(i.chars[v])},u.isEmpty=function(){for(var i=!0,v=0;v<M;v++)if(!this.chars[v].isEmpty()){i=!1;break}return i},u.setCursor=function(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>M&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=M)},u.moveCursor=function(i){var v=this.pos+i;if(i>1)for(var g=this.pos+1;g<v+1;g++)this.chars[g].setPenState(this.currPenState);this.setCursor(v)},u.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},u.insertChar=function(i){i>=144&&this.backSpace();var v=b(i);if(this.pos>=M){this.logger.log(E.ERROR,"Cannot insert "+i.toString(16)+" ("+v+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(v,this.currPenState),this.moveCursor(1)},u.clearFromPos=function(i){var v;for(v=i;v<M;v++)this.chars[v].reset()},u.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},u.clearToEndOfRow=function(){this.clearFromPos(this.pos)},u.getTextString=function(){for(var i=[],v=!0,g=0;g<M;g++){var L=this.chars[g].uchar;L!==" "&&(v=!1),i.push(L)}return v?"":i.join("")},u.setPenStyles=function(i){this.currPenState.setStyles(i);var v=this.chars[this.pos];v.setPenState(this.currPenState)},d}(),a=function(){function d(r){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var i=0;i<P;i++)this.rows.push(new t(r));this.logger=r,this.currRow=P-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var u=d.prototype;return u.reset=function(){for(var i=0;i<P;i++)this.rows[i].clear();this.currRow=P-1},u.equals=function(i){for(var v=!0,g=0;g<P;g++)if(!this.rows[g].equals(i.rows[g])){v=!1;break}return v},u.copy=function(i){for(var v=0;v<P;v++)this.rows[v].copy(i.rows[v])},u.isEmpty=function(){for(var i=!0,v=0;v<P;v++)if(!this.rows[v].isEmpty()){i=!1;break}return i},u.backSpace=function(){var i=this.rows[this.currRow];i.backSpace()},u.clearToEndOfRow=function(){var i=this.rows[this.currRow];i.clearToEndOfRow()},u.insertChar=function(i){var v=this.rows[this.currRow];v.insertChar(i)},u.setPen=function(i){var v=this.rows[this.currRow];v.setPenStyles(i)},u.moveCursor=function(i){var v=this.rows[this.currRow];v.moveCursor(i)},u.setCursor=function(i){this.logger.log(E.INFO,"setCursor: "+i);var v=this.rows[this.currRow];v.setCursor(i)},u.setPAC=function(i){this.logger.log(E.INFO,"pacData = "+JSON.stringify(i));var v=i.row-1;if(this.nrRollUpRows&&v<this.nrRollUpRows-1&&(v=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==v){for(var g=0;g<P;g++)this.rows[g].clear();var L=this.currRow+1-this.nrRollUpRows,C=this.lastOutputScreen;if(C){var k=C.rows[L].cueStartTime,U=this.logger.time;if(k&&U!==null&&k<U)for(var F=0;F<this.nrRollUpRows;F++)this.rows[v-this.nrRollUpRows+F+1].copy(C.rows[L+F])}}this.currRow=v;var B=this.rows[this.currRow];if(i.indent!==null){var N=i.indent,K=Math.max(N-1,0);B.setCursor(i.indent),i.color=B.chars[K].penState.foreground}var H={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(H)},u.setBkgData=function(i){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)},u.setRollUpRows=function(i){this.nrRollUpRows=i},u.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var i=this.currRow+1-this.nrRollUpRows,v=this.rows.splice(i,1)[0];v.clear(),this.rows.splice(this.currRow,0,v),this.logger.log(E.INFO,"Rolling up")},u.getDisplayText=function(i){i=i||!1;for(var v=[],g="",L=-1,C=0;C<P;C++){var k=this.rows[C].getTextString();k&&(L=C+1,i?v.push("Row "+L+": '"+k+"'"):v.push(k.trim()))}return v.length>0&&(i?g="["+v.join(" | ")+"]":g=v.join(`
`)),g},u.getTextAndFormat=function(){return this.rows},d}(),h=function(){function d(r,i,v){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=i,this.mode=null,this.verbose=0,this.displayedMemory=new a(v),this.nonDisplayedMemory=new a(v),this.lastOutputScreen=new a(v),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=v}var u=d.prototype;return u.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[P-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},u.getHandler=function(){return this.outputFilter},u.setHandler=function(i){this.outputFilter=i},u.setPAC=function(i){this.writeScreen.setPAC(i)},u.setBkgData=function(i){this.writeScreen.setBkgData(i)},u.setMode=function(i){i!==this.mode&&(this.mode=i,this.logger.log(E.INFO,"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)},u.insertChars=function(i){for(var v=0;v<i.length;v++)this.writeScreen.insertChar(i[v]);var g=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,g+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},u.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},u.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},u.ccAOF=function(){},u.ccAON=function(){},u.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},u.ccRU=function(i){this.logger.log(E.INFO,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)},u.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},u.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},u.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},u.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},u.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},u.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},u.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},u.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},u.ccTO=function(i){this.logger.log(E.INFO,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)},u.ccMIDROW=function(i){var v={flash:!1};if(v.underline=i%2==1,v.italics=i>=46,v.italics)v.foreground="white";else{var g=Math.floor(i/2)-16,L=["white","green","blue","cyan","red","yellow","magenta"];v.foreground=L[g]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(v)),this.writeScreen.setPen(v)},u.outputDataUpdate=function(i){i===void 0&&(i=!1);var v=this.logger.time;v!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=v:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,v,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:v),this.lastOutputScreen.copy(this.displayedMemory))},u.cueSplitAtTime=function(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))},d}(),l=function(){function d(r,i,v){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var g=new A;this.channels=[null,new h(r,i,g),new h(r+1,v,g)],this.cmdHistory=m(),this.logger=g}var u=d.prototype;return u.getHandler=function(i){return this.channels[i].getHandler()},u.setHandler=function(i,v){this.channels[i].setHandler(v)},u.addData=function(i,v){var g,L,C,k=!1;this.logger.time=i;for(var U=0;U<v.length;U+=2)if(L=v[U]&127,C=v[U+1]&127,!(L===0&&C===0)){if(this.logger.log(E.DATA,"["+S([v[U],v[U+1]])+"] -> ("+S([L,C])+")"),g=this.parseCmd(L,C),g||(g=this.parseMidrow(L,C)),g||(g=this.parsePAC(L,C)),g||(g=this.parseBackgroundAttributes(L,C)),!g&&(k=this.parseChars(L,C),k)){var F=this.currentChannel;if(F&&F>0){var B=this.channels[F];B.insertChars(k)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!g&&!k&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+S([L,C])+" orig: "+S([v[U],v[U+1]]))}},u.parseCmd=function(i,v){var g=this.cmdHistory,L=(i===20||i===28||i===21||i===29)&&v>=32&&v<=47,C=(i===23||i===31)&&v>=33&&v<=35;if(!(L||C))return!1;if(p(i,v,g))return f(null,null,g),this.logger.log(E.DEBUG,"Repeated command ("+S([i,v])+") is dropped"),!0;var k=i===20||i===21||i===23?1:2,U=this.channels[k];return i===20||i===21||i===28||i===29?v===32?U.ccRCL():v===33?U.ccBS():v===34?U.ccAOF():v===35?U.ccAON():v===36?U.ccDER():v===37?U.ccRU(2):v===38?U.ccRU(3):v===39?U.ccRU(4):v===40?U.ccFON():v===41?U.ccRDC():v===42?U.ccTR():v===43?U.ccRTD():v===44?U.ccEDM():v===45?U.ccCR():v===46?U.ccENM():v===47&&U.ccEOC():U.ccTO(v-32),f(i,v,g),this.currentChannel=k,!0},u.parseMidrow=function(i,v){var g=0;if((i===17||i===25)&&v>=32&&v<=47){if(i===17?g=1:g=2,g!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var L=this.channels[g];return L?(L.ccMIDROW(v),this.logger.log(E.DEBUG,"MIDROW ("+S([i,v])+")"),!0):!1}return!1},u.parsePAC=function(i,v){var g,L=this.cmdHistory,C=(i>=17&&i<=23||i>=25&&i<=31)&&v>=64&&v<=127,k=(i===16||i===24)&&v>=64&&v<=95;if(!(C||k))return!1;if(p(i,v,L))return f(null,null,L),!0;var U=i<=23?1:2;v>=64&&v<=95?g=U===1?I[i]:c[i]:g=U===1?D[i]:T[i];var F=this.channels[U];return F?(F.setPAC(this.interpretPAC(g,v)),f(i,v,L),this.currentChannel=U,!0):!1},u.interpretPAC=function(i,v){var g,L={color:null,italics:!1,indent:null,underline:!1,row:i};return v>95?g=v-96:g=v-64,L.underline=(g&1)==1,g<=13?L.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(g/2)]:g<=15?(L.italics=!0,L.color="white"):L.indent=Math.floor((g-16)/2)*4,L},u.parseChars=function(i,v){var g,L=null,C=null;if(i>=25?(g=2,C=i-8):(g=1,C=i),C>=17&&C<=19){var k;C===17?k=v+80:C===18?k=v+112:k=v+144,this.logger.log(E.INFO,"Special char '"+b(k)+"' in channel "+g),L=[k]}else i>=32&&i<=127&&(L=v===0?[i]:[i,v]);if(L){var U=S(L);this.logger.log(E.DEBUG,"Char codes =  "+U.join(",")),f(i,v,this.cmdHistory)}return L},u.parseBackgroundAttributes=function(i,v){var g=(i===16||i===24)&&v>=32&&v<=47,L=(i===23||i===31)&&v>=45&&v<=47;if(!(g||L))return!1;var C,k={};i===16||i===24?(C=Math.floor((v-32)/2),k.background=y[C],v%2==1&&(k.background=k.background+"_semi")):v===45?k.background="transparent":(k.foreground="black",v===47&&(k.underline=!0));var U=i<=23?1:2,F=this.channels[U];return F.setBkgData(k),f(i,v,this.cmdHistory),!0},u.reset=function(){for(var i=0;i<Object.keys(this.channels).length;i++){var v=this.channels[i];v&&v.reset()}this.cmdHistory=m()},u.cueSplitAtTime=function(i){for(var v=0;v<this.channels.length;v++){var g=this.channels[v];g&&g.cueSplitAtTime(i)}},d}();function f(d,u,r){r.a=d,r.b=u}function p(d,u,r){return r.a===d&&r.b===u}function m(){return{a:null,b:null}}O.default=l},"./src/utils/codecs.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"isCodecType",function(){return _}),s.d(O,"isCodecSupportedInMp4",function(){return b});var R={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function _(P,M){var I=R[M];return!!I&&I[P.slice(0,4)]===!0}function b(P,M){return MediaSource.isTypeSupported((M||"video")+'/mp4;codecs="'+P+'"')}},"./src/utils/cues.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/utils/vttparser.ts"),_=s("./src/utils/webvtt-parser.ts"),b=s("./src/utils/texttrack-utils.ts"),P=/\s/,M={newCue:function(D,c,T,y){for(var E=[],A,S,n,e,t,a=self.VTTCue||self.TextTrackCue,h=0;h<y.rows.length;h++)if(A=y.rows[h],n=!0,e=0,t="",!A.isEmpty()){for(var l=0;l<A.chars.length;l++)P.test(A.chars[l].uchar)&&n?e++:(t+=A.chars[l].uchar,n=!1);A.cueStartTime=c,c===T&&(T+=1e-4),e>=16?e--:e++;var f=Object(R.fixLineBreaks)(t.trim()),p=Object(_.generateCueId)(c,T,f);(!D||!D.cues||!D.cues.getCueById(p))&&(S=new a(c,T,f),S.id=p,S.line=h+1,S.align="left",S.position=10+Math.min(80,Math.floor(e*8/32)*10),E.push(S))}return D&&E.length&&(E.sort(function(m,d){return m.line==="auto"||d.line==="auto"?0:m.line>8&&d.line>8?d.line-m.line:m.line-d.line}),E.forEach(function(m){return Object(b.addCueToTrack)(D,m)})),E}};O.default=M},"./src/utils/discontinuities.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"findFirstFragWithCC",function(){return P}),s.d(O,"shouldAlignOnDiscontinuities",function(){return M}),s.d(O,"findDiscontinuousReferenceFrag",function(){return I}),s.d(O,"adjustSlidingStart",function(){return c}),s.d(O,"alignStream",function(){return T}),s.d(O,"alignPDT",function(){return E}),s.d(O,"alignFragmentByPDTDelta",function(){return A}),s.d(O,"alignMediaPlaylistByPDT",function(){return S});var R=s("./src/polyfills/number.ts"),_=s("./src/utils/logger.ts"),b=s("./src/controller/level-helper.ts");function P(n,e){for(var t=null,a=0,h=n.length;a<h;a++){var l=n[a];if(l&&l.cc===e){t=l;break}}return t}function M(n,e,t){return!!(e.details&&(t.endCC>t.startCC||n&&n.cc<t.startCC))}function I(n,e){var t=n.fragments,a=e.fragments;if(!a.length||!t.length){_.logger.log("No fragments to align");return}var h=P(t,a[0].cc);if(!h||h&&!h.startPTS){_.logger.log("No frag in previous level to align on");return}return h}function D(n,e){if(n){var t=n.start+e;n.start=n.startPTS=t,n.endPTS=t+n.duration}}function c(n,e){for(var t=e.fragments,a=0,h=t.length;a<h;a++)D(t[a],n);e.fragmentHint&&D(e.fragmentHint,n),e.alignedSliding=!0}function T(n,e,t){!e||(y(n,t,e),!t.alignedSliding&&e.details&&E(t,e.details),!t.alignedSliding&&e.details&&!t.skippedSegments&&Object(b.adjustSliding)(e.details,t))}function y(n,e,t){if(M(n,t,e)){var a=I(t.details,e);a&&Object(R.isFiniteNumber)(a.start)&&(_.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),c(a.start,e))}}function E(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var t=e.fragments[0].programDateTime,a=n.fragments[0].programDateTime,h=(a-t)/1e3+e.fragments[0].start;h&&Object(R.isFiniteNumber)(h)&&(_.logger.log("Adjusting PTS using programDateTime delta "+(a-t)+"ms, sliding:"+h.toFixed(3)+" "+n.url+" "),c(h,n))}}function A(n,e){var t=n.programDateTime;if(!!t){var a=(t-e)/1e3;n.start=n.startPTS=a,n.endPTS=a+n.duration}}function S(n,e){if(!(!e.fragments.length||!n.hasProgramDateTime||!e.hasProgramDateTime)){var t=e.fragments[0].programDateTime,a=e.fragments[0].start,h=t-a*1e3;n.fragments.forEach(function(l){A(l,h)}),n.fragmentHint&&A(n.fragmentHint,h),n.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/utils/ewma.ts"),_=function(){function b(M,I,D){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=D,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new R.default(M),this.fast_=new R.default(I)}var P=b.prototype;return P.update=function(I,D){var c=this.slow_,T=this.fast_;this.slow_.halfLife!==I&&(this.slow_=new R.default(I,c.getEstimate(),c.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new R.default(D,T.getEstimate(),T.getTotalWeight()))},P.sample=function(I,D){I=Math.max(I,this.minDelayMs_);var c=8*D,T=I/1e3,y=c/T;this.fast_.sample(T,y),this.slow_.sample(T,y)},P.canEstimate=function(){var I=this.fast_;return I&&I.getTotalWeight()>=this.minWeight_},P.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},P.destroy=function(){},b}();O.default=_},"./src/utils/ewma.ts":function(x,O,s){"use strict";s.r(O);var R=function(){function _(P,M,I){M===void 0&&(M=0),I===void 0&&(I=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=P,this.alpha_=P?Math.exp(Math.log(.5)/P):0,this.estimate_=M,this.totalWeight_=I}var b=_.prototype;return b.sample=function(M,I){var D=Math.pow(this.alpha_,M);this.estimate_=I*(1-D)+D*this.estimate_,this.totalWeight_+=M},b.getTotalWeight=function(){return this.totalWeight_},b.getEstimate=function(){if(this.alpha_){var M=1-Math.pow(this.alpha_,this.totalWeight_);if(M)return this.estimate_/M}return this.estimate_},_}();O.default=R},"./src/utils/fetch-loader.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"fetchSupported",function(){return E});var R=s("./src/polyfills/number.ts"),_=s("./src/loader/load-stats.ts"),b=s("./src/demux/chunk-cache.ts");function P(t,a){t.prototype=Object.create(a.prototype),t.prototype.constructor=t,T(t,a)}function M(t){var a=typeof Map=="function"?new Map:void 0;return M=function(l){if(l===null||!c(l))return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(typeof a!="undefined"){if(a.has(l))return a.get(l);a.set(l,f)}function f(){return I(l,arguments,y(this).constructor)}return f.prototype=Object.create(l.prototype,{constructor:{value:f,enumerable:!1,writable:!0,configurable:!0}}),T(f,l)},M(t)}function I(t,a,h){return D()?I=Reflect.construct:I=function(f,p,m){var d=[null];d.push.apply(d,p);var u=Function.bind.apply(f,d),r=new u;return m&&T(r,m.prototype),r},I.apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function c(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function T(t,a){return T=Object.setPrototypeOf||function(l,f){return l.__proto__=f,l},T(t,a)}function y(t){return y=Object.setPrototypeOf?Object.getPrototypeOf:function(h){return h.__proto__||Object.getPrototypeOf(h)},y(t)}function E(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var A=function(){function t(h){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=h.fetchSetup||n,this.controller=new self.AbortController,this.stats=new _.LoadStats}var a=t.prototype;return a.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},a.abortInternal=function(){var l=this.response;(!l||!l.ok)&&(this.stats.aborted=!0,this.controller.abort())},a.abort=function(){var l;this.abortInternal(),(l=this.callbacks)!==null&&l!==void 0&&l.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},a.load=function(l,f,p){var m=this,d=this.stats;if(d.loading.start)throw new Error("Loader can only be used once.");d.loading.start=self.performance.now();var u=S(l,this.controller.signal),r=p.onProgress,i=l.responseType==="arraybuffer",v=i?"byteLength":"length";this.context=l,this.config=f,this.callbacks=p,this.request=this.fetchSetup(l,u),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){m.abortInternal(),p.onTimeout(d,l,m.response)},f.timeout),self.fetch(this.request).then(function(g){if(m.response=m.loader=g,!g.ok){var L=g.status,C=g.statusText;throw new e(C||"fetch, bad network response",L,g)}return d.loading.first=Math.max(self.performance.now(),d.loading.start),d.total=parseInt(g.headers.get("Content-Length")||"0"),r&&Object(R.isFiniteNumber)(f.highWaterMark)?m.loadProgressively(g,d,l,f.highWaterMark,r):i?g.arrayBuffer():g.text()}).then(function(g){var L=m.response;self.clearTimeout(m.requestTimeout),d.loading.end=Math.max(self.performance.now(),d.loading.first),d.loaded=d.total=g[v];var C={url:L.url,data:g};r&&!Object(R.isFiniteNumber)(f.highWaterMark)&&r(d,l,g,L),p.onSuccess(C,d,l,L)}).catch(function(g){if(self.clearTimeout(m.requestTimeout),!d.aborted){var L=g.code||0;p.onError({code:L,text:g.message},l,g.details)}})},a.getCacheAge=function(){var l=null;if(this.response){var f=this.response.headers.get("age");l=f?parseFloat(f):null}return l},a.loadProgressively=function(l,f,p,m,d){m===void 0&&(m=0);var u=new b.default,r=l.body.getReader(),i=function v(){return r.read().then(function(g){if(g.done)return u.dataLength&&d(f,p,u.flush(),l),Promise.resolve(new ArrayBuffer(0));var L=g.value,C=L.length;return f.loaded+=C,C<m||u.dataLength?(u.push(L),u.dataLength>=m&&d(f,p,u.flush(),l)):d(f,p,L,l),v()}).catch(function(){return Promise.reject()})};return i()},t}();function S(t,a){var h={method:"GET",mode:"cors",credentials:"same-origin",signal:a};return t.rangeEnd&&(h.headers=new self.Headers({Range:"bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)})),h}function n(t,a){return new self.Request(t.url,a)}var e=function(t){P(a,t);function a(h,l,f){var p;return p=t.call(this,h)||this,p.code=void 0,p.details=void 0,p.code=l,p.details=f,p}return a}(M(Error));O.default=A},"./src/utils/imsc1-ttml-parser.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"IMSC1_CODEC",function(){return c}),s.d(O,"parseIMSC1",function(){return A});var R=s("./src/utils/mp4-tools.ts"),_=s("./src/utils/vttparser.ts"),b=s("./src/utils/vttcue.ts"),P=s("./src/demux/id3.ts"),M=s("./src/utils/timescale-conversion.ts"),I=s("./src/utils/webvtt-parser.ts");function D(){return D=Object.assign||function(d){for(var u=1;u<arguments.length;u++){var r=arguments[u];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(d[i]=r[i])}return d},D.apply(this,arguments)}var c="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,y=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function A(d,u,r,i,v){var g=Object(R.findBox)(new Uint8Array(d),["mdat"]);if(g.length===0){v(new Error("Could not parse IMSC1 mdat"));return}var L=g[0],C=Object(P.utf8ArrayToStr)(new Uint8Array(d,L.start,L.end-L.start)),k=Object(M.toTimescaleFromScale)(u,1,r);try{i(S(C,k))}catch(U){v(U)}}function S(d,u){var r=new DOMParser,i=r.parseFromString(d,"text/xml"),v=i.getElementsByTagName("tt")[0];if(!v)throw new Error("Invalid ttml");var g={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},L=Object.keys(g).reduce(function(B,N){return B[N]=v.getAttribute("ttp:"+N)||g[N],B},{}),C=v.getAttribute("xml:space")!=="preserve",k=e(n(v,"styling","style")),U=e(n(v,"layout","region")),F=n(v,"body","[begin]");return[].map.call(F,function(B){var N=t(B,C);if(!N||!B.hasAttribute("begin"))return null;var K=f(B.getAttribute("begin"),L),H=f(B.getAttribute("dur"),L),j=f(B.getAttribute("end"),L);if(K===null)throw l(B);if(j===null){if(H===null)throw l(B);j=K+H}var W=new b.default(K-u,j-u,N);W.id=Object(I.generateCueId)(W.startTime,W.endTime,W.text);var V=U[B.getAttribute("region")],$=k[B.getAttribute("style")];W.position=10,W.size=80;var Y=a(V,$),Q=Y.textAlign;if(Q){var J=E[Q];J&&(W.lineAlign=J),W.align=Q}return D(W,Y),W}).filter(function(B){return B!==null})}function n(d,u,r){var i=d.getElementsByTagName(u)[0];return i?[].slice.call(i.querySelectorAll(r)):[]}function e(d){return d.reduce(function(u,r){var i=r.getAttribute("xml:id");return i&&(u[i]=r),u},{})}function t(d,u){return[].slice.call(d.childNodes).reduce(function(r,i,v){var g;return i.nodeName==="br"&&v?r+`
`:(g=i.childNodes)!==null&&g!==void 0&&g.length?t(i,u):u?r+i.textContent.trim().replace(/\s+/g," "):r+i.textContent},"")}function a(d,u){var r="http://www.w3.org/ns/ttml#styling",i=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return i.reduce(function(v,g){var L=h(u,r,g)||h(d,r,g);return L&&(v[g]=L),v},{})}function h(d,u,r){return d.hasAttributeNS(u,r)?d.getAttributeNS(u,r):null}function l(d){return new Error("Could not parse ttml timestamp "+d)}function f(d,u){if(!d)return null;var r=Object(_.parseTimeStamp)(d);return r===null&&(T.test(d)?r=p(d,u):y.test(d)&&(r=m(d,u))),r}function p(d,u){var r=T.exec(d),i=(r[4]|0)+(r[5]|0)/u.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+i/u.frameRate}function m(d,u){var r=y.exec(d),i=Number(r[1]),v=r[2];switch(v){case"h":return i*3600;case"m":return i*60;case"ms":return i*1e3;case"f":return i/u.frameRate;case"t":return i/u.tickRate}return i}},"./src/utils/logger.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"enableLogs",function(){return I}),s.d(O,"logger",function(){return D});var R=function(){},_={trace:R,debug:R,log:R,warn:R,info:R,error:R},b=_;function P(c){var T=self.console[c];return T?T.bind(self.console,"["+c+"] >"):R}function M(c){for(var T=arguments.length,y=new Array(T>1?T-1:0),E=1;E<T;E++)y[E-1]=arguments[E];y.forEach(function(A){b[A]=c[A]?c[A].bind(c):P(A)})}function I(c){if(self.console&&c===!0||typeof c=="object"){M(c,"debug","log","info","warn","error");try{b.log()}catch{b=_}}else b=_}var D=b},"./src/utils/mediakeys-helper.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"KeySystems",function(){return R}),s.d(O,"requestMediaKeySystemAccess",function(){return _});var R;(function(b){b.WIDEVINE="com.widevine.alpha",b.PLAYREADY="com.microsoft.playready"})(R||(R={}));var _=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"getMediaSource",function(){return R});function R(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"bin2str",function(){return M}),s.d(O,"readUint16",function(){return I}),s.d(O,"readUint32",function(){return D}),s.d(O,"writeUint32",function(){return c}),s.d(O,"findBox",function(){return T}),s.d(O,"parseSegmentIndex",function(){return y}),s.d(O,"parseInitSegment",function(){return E}),s.d(O,"getStartDTS",function(){return A}),s.d(O,"getDuration",function(){return S}),s.d(O,"computeRawDurationFromSamples",function(){return n}),s.d(O,"offsetStartDTS",function(){return e}),s.d(O,"segmentValidRange",function(){return t}),s.d(O,"appendUint8Array",function(){return a});var R=s("./src/utils/typed-array.ts"),_=s("./src/loader/fragment.ts"),b=Math.pow(2,32)-1,P=[].push;function M(h){return String.fromCharCode.apply(null,h)}function I(h,l){"data"in h&&(l+=h.start,h=h.data);var f=h[l]<<8|h[l+1];return f<0?65536+f:f}function D(h,l){"data"in h&&(l+=h.start,h=h.data);var f=h[l]<<24|h[l+1]<<16|h[l+2]<<8|h[l+3];return f<0?4294967296+f:f}function c(h,l,f){"data"in h&&(l+=h.start,h=h.data),h[l]=f>>24,h[l+1]=f>>16&255,h[l+2]=f>>8&255,h[l+3]=f&255}function T(h,l){var f=[];if(!l.length)return f;var p,m,d;"data"in h?(p=h.data,m=h.start,d=h.end):(p=h,m=0,d=p.byteLength);for(var u=m;u<d;){var r=D(p,u),i=M(p.subarray(u+4,u+8)),v=r>1?u+r:d;if(i===l[0])if(l.length===1)f.push({data:p,start:u+8,end:v});else{var g=T({data:p,start:u+8,end:v},l.slice(1));g.length&&P.apply(f,g)}u=v}return f}function y(h){var l=T(h,["moov"]),f=l[0],p=f?f.end:null,m=T(h,["sidx"]);if(!m||!m[0])return null;var d=[],u=m[0],r=u.data[0],i=r===0?8:16,v=D(u,i);i+=4;var g=0,L=0;r===0?i+=8:i+=16,i+=2;var C=u.end+L,k=I(u,i);i+=2;for(var U=0;U<k;U++){var F=i,B=D(u,F);F+=4;var N=B&2147483647,K=(B&2147483648)>>>31;if(K===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=D(u,F);F+=4,d.push({referenceSize:N,subsegmentDuration:H,info:{duration:H/v,start:C,end:C+N-1}}),C+=N,F+=4,i=F}return{earliestPresentationTime:g,timescale:v,version:r,referencesCount:k,references:d,moovEndOffset:p}}function E(h){for(var l=[],f=T(h,["moov","trak"]),p=0;p<f.length;p++){var m=f[p],d=T(m,["tkhd"])[0];if(d){var u=d.data[d.start],r=u===0?12:20,i=D(d,r),v=T(m,["mdia","mdhd"])[0];if(v){u=v.data[v.start],r=u===0?12:20;var g=D(v,r),L=T(m,["mdia","hdlr"])[0];if(L){var C=M(L.data.subarray(L.start+8,L.start+12)),k={soun:_.ElementaryStreamTypes.AUDIO,vide:_.ElementaryStreamTypes.VIDEO}[C];if(k){var U=T(m,["mdia","minf","stbl","stsd"])[0],F=void 0;U&&(F=M(U.data.subarray(U.start+12,U.start+16))),l[i]={timescale:g,type:k},l[k]={timescale:g,id:i,codec:F}}}}}}var B=T(h,["moov","mvex","trex"]);return B.forEach(function(N){var K=D(N,4),H=l[K];H&&(H.default={duration:D(N,12),flags:D(N,20)})}),l}function A(h,l){return T(l,["moof","traf"]).reduce(function(f,p){var m=T(p,["tfdt"])[0],d=m.data[m.start],u=T(p,["tfhd"]).reduce(function(r,i){var v=D(i,4),g=h[v];if(g){var L=D(m,4);d===1&&(L*=Math.pow(2,32),L+=D(m,8));var C=g.timescale||9e4,k=L/C;if(isFinite(k)&&(r===null||k<r))return k}return r},null);return u!==null&&isFinite(u)&&(f===null||u<f)?u:f},null)||0}function S(h,l){for(var f=0,p=0,m=0,d=T(h,["moof","traf"]),u=0;u<d.length;u++){var r=d[u],i=T(r,["tfhd"])[0],v=D(i,4),g=l[v];if(!!g){var L=g.default,C=D(i,0)|(L==null?void 0:L.flags),k=L==null?void 0:L.duration;C&8&&(C&2?k=D(i,12):k=D(i,8));for(var U=g.timescale||9e4,F=T(r,["trun"]),B=0;B<F.length;B++){if(k){var N=D(F[B],4);f=k*N}else f=n(F[B]);g.type===_.ElementaryStreamTypes.VIDEO?p+=f/U:g.type===_.ElementaryStreamTypes.AUDIO&&(m+=f/U)}}}if(p===0&&m===0){var K=y(h);if(K!=null&&K.references)return K.references.reduce(function(H,j){return H+j.info.duration||0},0)}return p||m}function n(h){var l=D(h,0),f=8;l&1&&(f+=4),l&4&&(f+=4);for(var p=0,m=D(h,4),d=0;d<m;d++){if(l&256){var u=D(h,f);p+=u,f+=4}l&512&&(f+=4),l&1024&&(f+=4),l&2048&&(f+=4)}return p}function e(h,l,f){T(l,["moof","traf"]).forEach(function(p){T(p,["tfhd"]).forEach(function(m){var d=D(m,4),u=h[d];if(!!u){var r=u.timescale||9e4;T(p,["tfdt"]).forEach(function(i){var v=i.data[i.start],g=D(i,4);if(v===0)c(i,4,g-f*r);else{g*=Math.pow(2,32),g+=D(i,8),g-=f*r,g=Math.max(g,0);var L=Math.floor(g/(b+1)),C=Math.floor(g%(b+1));c(i,4,L),c(i,8,C)}})}})})}function t(h){var l={valid:null,remainder:null},f=T(h,["moof"]);if(f){if(f.length<2)return l.remainder=h,l}else return l;var p=f[f.length-1];return l.valid=Object(R.sliceUint8)(h,0,p.start-8),l.remainder=Object(R.sliceUint8)(h,p.start-8),l}function a(h,l){var f=new Uint8Array(h.length+l.length);return f.set(h),f.set(l,h.length),f}},"./src/utils/output-filter.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"default",function(){return R});var R=function(){function _(P,M){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=P,this.trackName=M}var b=_.prototype;return b.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},b.newCue=function(M,I,D){(this.startTime===null||this.startTime>M)&&(this.startTime=M),this.endTime=I,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},b.reset=function(){this.cueRanges=[]},_}()},"./src/utils/texttrack-utils.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"sendAddTrackEvent",function(){return _}),s.d(O,"addCueToTrack",function(){return b}),s.d(O,"clearCurrentCues",function(){return P}),s.d(O,"removeCuesInRange",function(){return M}),s.d(O,"getCuesInRange",function(){return D});var R=s("./src/utils/logger.ts");function _(c,T){var y;try{y=new Event("addtrack")}catch{y=document.createEvent("Event"),y.initEvent("addtrack",!1,!1)}y.track=c,T.dispatchEvent(y)}function b(c,T){var y=c.mode;if(y==="disabled"&&(c.mode="hidden"),c.cues&&!c.cues.getCueById(T.id))try{if(c.addCue(T),!c.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(A){R.logger.debug("[texttrack-utils]: "+A);var E=new self.TextTrackCue(T.startTime,T.endTime,T.text);E.id=T.id,c.addCue(E)}y==="disabled"&&(c.mode=y)}function P(c){var T=c.mode;if(T==="disabled"&&(c.mode="hidden"),c.cues)for(var y=c.cues.length;y--;)c.removeCue(c.cues[y]);T==="disabled"&&(c.mode=T)}function M(c,T,y){var E=c.mode;if(E==="disabled"&&(c.mode="hidden"),c.cues&&c.cues.length>0)for(var A=D(c.cues,T,y),S=0;S<A.length;S++)c.removeCue(A[S]);E==="disabled"&&(c.mode=E)}function I(c,T){if(T<c[0].startTime)return 0;var y=c.length-1;if(T>c[y].endTime)return-1;for(var E=0,A=y;E<=A;){var S=Math.floor((A+E)/2);if(T<c[S].startTime)A=S-1;else if(T>c[S].startTime&&E<y)E=S+1;else return S}return c[E].startTime-T<T-c[A].startTime?E:A}function D(c,T,y){var E=[],A=I(c,T);if(A>-1)for(var S=A,n=c.length;S<n;S++){var e=c[S];if(e.startTime>=T&&e.endTime<=y)E.push(e);else if(e.startTime>y)return E}return E}},"./src/utils/time-ranges.ts":function(x,O,s){"use strict";s.r(O);var R={toString:function(b){for(var P="",M=b.length,I=0;I<M;I++)P+="["+b.start(I).toFixed(3)+","+b.end(I).toFixed(3)+"]";return P}};O.default=R},"./src/utils/timescale-conversion.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"toTimescaleFromBase",function(){return _}),s.d(O,"toTimescaleFromScale",function(){return b}),s.d(O,"toMsFromMpegTsClock",function(){return P}),s.d(O,"toMpegTsClockFromTimescale",function(){return M});var R=9e4;function _(I,D,c,T){c===void 0&&(c=1),T===void 0&&(T=!1);var y=I*D*c;return T?Math.round(y):y}function b(I,D,c,T){return c===void 0&&(c=1),T===void 0&&(T=!1),_(I,D,1/c,T)}function P(I,D){return D===void 0&&(D=!1),_(I,1e3,1/R,D)}function M(I,D){return D===void 0&&(D=1),_(I,R,1/D)}},"./src/utils/typed-array.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"sliceUint8",function(){return R});function R(_,b,P){return Uint8Array.prototype.slice?_.slice(b,P):new Uint8Array(Array.prototype.slice.call(_,b,P))}},"./src/utils/vttcue.ts":function(x,O,s){"use strict";s.r(O),O.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var R=["","lr","rl"],_=["start","middle","end","left","right"];function b(c,T){if(typeof T!="string"||!Array.isArray(c))return!1;var y=T.toLowerCase();return~c.indexOf(y)?y:!1}function P(c){return b(R,c)}function M(c){return b(_,c)}function I(c){for(var T=arguments.length,y=new Array(T>1?T-1:0),E=1;E<T;E++)y[E-1]=arguments[E];for(var A=1;A<arguments.length;A++){var S=arguments[A];for(var n in S)c[n]=S[n]}return c}function D(c,T,y){var E=this,A={enumerable:!0};E.hasBeenReset=!1;var S="",n=!1,e=c,t=T,a=y,h=null,l="",f=!0,p="auto",m="start",d=50,u="middle",r=50,i="middle";Object.defineProperty(E,"id",I({},A,{get:function(){return S},set:function(g){S=""+g}})),Object.defineProperty(E,"pauseOnExit",I({},A,{get:function(){return n},set:function(g){n=!!g}})),Object.defineProperty(E,"startTime",I({},A,{get:function(){return e},set:function(g){if(typeof g!="number")throw new TypeError("Start time must be set to a number.");e=g,this.hasBeenReset=!0}})),Object.defineProperty(E,"endTime",I({},A,{get:function(){return t},set:function(g){if(typeof g!="number")throw new TypeError("End time must be set to a number.");t=g,this.hasBeenReset=!0}})),Object.defineProperty(E,"text",I({},A,{get:function(){return a},set:function(g){a=""+g,this.hasBeenReset=!0}})),Object.defineProperty(E,"region",I({},A,{get:function(){return h},set:function(g){h=g,this.hasBeenReset=!0}})),Object.defineProperty(E,"vertical",I({},A,{get:function(){return l},set:function(g){var L=P(g);if(L===!1)throw new SyntaxError("An invalid or illegal string was specified.");l=L,this.hasBeenReset=!0}})),Object.defineProperty(E,"snapToLines",I({},A,{get:function(){return f},set:function(g){f=!!g,this.hasBeenReset=!0}})),Object.defineProperty(E,"line",I({},A,{get:function(){return p},set:function(g){if(typeof g!="number"&&g!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");p=g,this.hasBeenReset=!0}})),Object.defineProperty(E,"lineAlign",I({},A,{get:function(){return m},set:function(g){var L=M(g);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");m=L,this.hasBeenReset=!0}})),Object.defineProperty(E,"position",I({},A,{get:function(){return d},set:function(g){if(g<0||g>100)throw new Error("Position must be between 0 and 100.");d=g,this.hasBeenReset=!0}})),Object.defineProperty(E,"positionAlign",I({},A,{get:function(){return u},set:function(g){var L=M(g);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");u=L,this.hasBeenReset=!0}})),Object.defineProperty(E,"size",I({},A,{get:function(){return r},set:function(g){if(g<0||g>100)throw new Error("Size must be between 0 and 100.");r=g,this.hasBeenReset=!0}})),Object.defineProperty(E,"align",I({},A,{get:function(){return i},set:function(g){var L=M(g);if(!L)throw new SyntaxError("An invalid or illegal string was specified.");i=L,this.hasBeenReset=!0}})),E.displayState=void 0}return D.prototype.getCueAsHTML=function(){var c=self.WebVTT;return c.convertCueToDOMTree(self,this.text)},D}()},"./src/utils/vttparser.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"parseTimeStamp",function(){return b}),s.d(O,"fixLineBreaks",function(){return T}),s.d(O,"VTTParser",function(){return y});var R=s("./src/utils/vttcue.ts"),_=function(){function E(){}var A=E.prototype;return A.decode=function(n,e){if(!n)return"";if(typeof n!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(n))},E}();function b(E){function A(n,e,t,a){return(n|0)*3600+(e|0)*60+(t|0)+parseFloat(a||0)}var S=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return S?parseFloat(S[2])>59?A(S[2],S[3],0,S[4]):A(S[1],S[2],S[3],S[4]):null}var P=function(){function E(){this.values=Object.create(null)}var A=E.prototype;return A.set=function(n,e){!this.get(n)&&e!==""&&(this.values[n]=e)},A.get=function(n,e,t){return t?this.has(n)?this.values[n]:e[t]:this.has(n)?this.values[n]:e},A.has=function(n){return n in this.values},A.alt=function(n,e,t){for(var a=0;a<t.length;++a)if(e===t[a]){this.set(n,e);break}},A.integer=function(n,e){/^-?\d+$/.test(e)&&this.set(n,parseInt(e,10))},A.percent=function(n,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var t=parseFloat(e);if(t>=0&&t<=100)return this.set(n,t),!0}return!1},E}();function M(E,A,S,n){var e=n?E.split(n):[E];for(var t in e)if(typeof e[t]=="string"){var a=e[t].split(S);if(a.length===2){var h=a[0],l=a[1];A(h,l)}}}var I=new R.default(0,0,""),D=I.align==="middle"?"middle":"center";function c(E,A,S){var n=E;function e(){var h=b(E);if(h===null)throw new Error("Malformed timestamp: "+n);return E=E.replace(/^[^\sa-zA-Z-]+/,""),h}function t(h,l){var f=new P;M(h,function(d,u){var r;switch(d){case"region":for(var i=S.length-1;i>=0;i--)if(S[i].id===u){f.set(d,S[i].region);break}break;case"vertical":f.alt(d,u,["rl","lr"]);break;case"line":r=u.split(","),f.integer(d,r[0]),f.percent(d,r[0])&&f.set("snapToLines",!1),f.alt(d,r[0],["auto"]),r.length===2&&f.alt("lineAlign",r[1],["start",D,"end"]);break;case"position":r=u.split(","),f.percent(d,r[0]),r.length===2&&f.alt("positionAlign",r[1],["start",D,"end","line-left","line-right","auto"]);break;case"size":f.percent(d,u);break;case"align":f.alt(d,u,["start",D,"end","left","right"]);break}},/:/,/\s/),l.region=f.get("region",null),l.vertical=f.get("vertical","");var p=f.get("line","auto");p==="auto"&&I.line===-1&&(p=-1),l.line=p,l.lineAlign=f.get("lineAlign","start"),l.snapToLines=f.get("snapToLines",!0),l.size=f.get("size",100),l.align=f.get("align",D);var m=f.get("position","auto");m==="auto"&&I.position===50&&(m=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=m}function a(){E=E.replace(/^\s+/,"")}if(a(),A.startTime=e(),a(),E.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);E=E.substr(3),a(),A.endTime=e(),a(),t(E,A)}function T(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var y=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new _,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var A=E.prototype;return A.parse=function(n){var e=this;n&&(e.buffer+=e.decoder.decode(n,{stream:!0}));function t(){var m=e.buffer,d=0;for(m=T(m);d<m.length&&m[d]!=="\r"&&m[d]!==`
`;)++d;var u=m.substr(0,d);return m[d]==="\r"&&++d,m[d]===`
`&&++d,e.buffer=m.substr(d),u}function a(m){M(m,function(d,u){},/:/)}try{var h="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;h=t();var l=h.match(/^()?WEBVTT([ \t].*)?$/);if(!l||!l[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var f=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(f?f=!1:h=t(),e.state){case"HEADER":/:/.test(h)?a(h):h||(e.state="ID");continue;case"NOTE":h||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(h)){e.state="NOTE";break}if(!h)continue;if(e.cue=new R.default(0,0,""),e.state="CUE",h.indexOf("-->")===-1){e.cue.id=h;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{c(h,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var p=h.indexOf("-->")!==-1;if(!h||p&&(f=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=h}continue;case"BADCUE":h||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},A.flush=function(){var n=this;try{if((n.cue||n.state==="HEADER")&&(n.buffer+=`

`,n.parse()),n.state==="INITIAL"||n.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){n.onparsingerror&&n.onparsingerror(e)}return n.onflush&&n.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":function(x,O,s){"use strict";s.r(O),s.d(O,"generateCueId",function(){return y}),s.d(O,"parseWebVTT",function(){return A});var R=s("./src/polyfills/number.ts"),_=s("./src/utils/vttparser.ts"),b=s("./src/demux/id3.ts"),P=s("./src/utils/timescale-conversion.ts"),M=s("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,D=function(n,e,t){return t===void 0&&(t=0),n.substr(t,e.length)===e},c=function(n){var e=parseInt(n.substr(-3)),t=parseInt(n.substr(-6,2)),a=parseInt(n.substr(-9,2)),h=n.length>9?parseInt(n.substr(0,n.indexOf(":"))):0;if(!Object(R.isFiniteNumber)(e)||!Object(R.isFiniteNumber)(t)||!Object(R.isFiniteNumber)(a)||!Object(R.isFiniteNumber)(h))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+n);return e+=1e3*t,e+=60*1e3*a,e+=60*60*1e3*h,e},T=function(n){for(var e=5381,t=n.length;t;)e=e*33^n.charCodeAt(--t);return(e>>>0).toString()};function y(S,n,e){return T(S.toString())+T(n.toString())+T(e)}var E=function(n,e,t){var a=n[e],h=n[a.prevCC];if(!h||!h.new&&a.new){n.ccOffset=n.presentationOffset=a.start,a.new=!1;return}for(;(l=h)!==null&&l!==void 0&&l.new;){var l;n.ccOffset+=a.start-h.start,a.new=!1,a=h,h=n[a.prevCC]}n.presentationOffset=t};function A(S,n,e,t,a,h,l,f){var p=new _.VTTParser,m=Object(b.utf8ArrayToStr)(new Uint8Array(S)).trim().replace(I,`
`).split(`
`),d=[],u=Object(P.toMpegTsClockFromTimescale)(n,e),r="00:00.000",i=0,v=0,g,L=!0,C=!1;p.oncue=function(k){var U=t[a],F=t.ccOffset,B=(i-u)/9e4;if(U!=null&&U.new&&(v!==void 0?F=t.ccOffset=U.start:E(t,a,B)),B&&(F=B-t.presentationOffset),C){var N=k.endTime-k.startTime,K=Object(M.normalizePts)((k.startTime+F-v)*9e4,h*9e4)/9e4;k.startTime=K,k.endTime=K+N}var H=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(H)),k.id||(k.id=y(k.startTime,k.endTime,H)),k.endTime>0&&d.push(k)},p.onparsingerror=function(k){g=k},p.onflush=function(){if(g){f(g);return}l(d)},m.forEach(function(k){if(L)if(D(k,"X-TIMESTAMP-MAP=")){L=!1,C=!0,k.substr(16).split(",").forEach(function(U){D(U,"LOCAL:")?r=U.substr(6):D(U,"MPEGTS:")&&(i=parseInt(U.substr(7)))});try{v=c(r)/1e3}catch(U){C=!1,g=U}return}else k===""&&(L=!1);p.parse(k+`
`)}),p.flush()}},"./src/utils/xhr-loader.ts":function(x,O,s){"use strict";s.r(O);var R=s("./src/utils/logger.ts"),_=s("./src/loader/load-stats.ts"),b=/^age:\s*[\d.]+\s*$/m,P=function(){function M(D){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=D?D.xhrSetup:null,this.stats=new _.LoadStats,this.retryDelay=0}var I=M.prototype;return I.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},I.abortInternal=function(){var c=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),c&&(c.onreadystatechange=null,c.onprogress=null,c.readyState!==4&&(this.stats.aborted=!0,c.abort()))},I.abort=function(){var c;this.abortInternal(),(c=this.callbacks)!==null&&c!==void 0&&c.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},I.load=function(c,T,y){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=c,this.config=T,this.callbacks=y,this.retryDelay=T.retryDelay,this.loadInternal()},I.loadInternal=function(){var c=this.config,T=this.context;if(!!c){var y=this.loader=new self.XMLHttpRequest,E=this.stats;E.loading.first=0,E.loaded=0;var A=this.xhrSetup;try{if(A)try{A(y,T.url)}catch{y.open("GET",T.url,!0),A(y,T.url)}y.readyState||y.open("GET",T.url,!0)}catch(S){this.callbacks.onError({code:y.status,text:S.message},T,y);return}T.rangeEnd&&y.setRequestHeader("Range","bytes="+T.rangeStart+"-"+(T.rangeEnd-1)),y.onreadystatechange=this.readystatechange.bind(this),y.onprogress=this.loadprogress.bind(this),y.responseType=T.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),c.timeout),y.send()}},I.readystatechange=function(){var c=this.context,T=this.loader,y=this.stats;if(!(!c||!T)){var E=T.readyState,A=this.config;if(!y.aborted&&E>=2)if(self.clearTimeout(this.requestTimeout),y.loading.first===0&&(y.loading.first=Math.max(self.performance.now(),y.loading.start)),E===4){T.onreadystatechange=null,T.onprogress=null;var S=T.status;if(S>=200&&S<300){y.loading.end=Math.max(self.performance.now(),y.loading.first);var n,e;if(c.responseType==="arraybuffer"?(n=T.response,e=n.byteLength):(n=T.responseText,e=n.length),y.loaded=y.total=e,!this.callbacks)return;var t=this.callbacks.onProgress;if(t&&t(y,c,n,T),!this.callbacks)return;var a={url:T.responseURL,data:n};this.callbacks.onSuccess(a,y,c,T)}else y.retry>=A.maxRetry||S>=400&&S<499?(R.logger.error(S+" while loading "+c.url),this.callbacks.onError({code:S,text:T.statusText},c,T)):(R.logger.warn(S+" while loading "+c.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,A.maxRetryDelay),y.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),A.timeout)}},I.loadtimeout=function(){R.logger.warn("timeout while loading "+this.context.url);var c=this.callbacks;c&&(this.abortInternal(),c.onTimeout(this.stats,this.context,this.loader))},I.loadprogress=function(c){var T=this.stats;T.loaded=c.loaded,c.lengthComputable&&(T.total=c.total)},I.getCacheAge=function(){var c=null;if(this.loader&&b.test(this.loader.getAllResponseHeaders())){var T=this.loader.getResponseHeader("age");c=T?parseFloat(T):null}return c},M}();O.default=P}}).default})}}),Qn=ft({"../playback-core/dist/index.js"(o){var w=Object.create,x=Object.defineProperty,O=Object.getOwnPropertyDescriptor,s=Object.getOwnPropertyNames,R=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty,b=r=>x(r,"__esModule",{value:!0}),P=(r,i)=>{b(r);for(var v in i)x(r,v,{get:i[v],enumerable:!0})},M=(r,i,v)=>{if(i&&typeof i=="object"||typeof i=="function")for(let g of s(i))!_.call(r,g)&&g!=="default"&&x(r,g,{get:()=>i[g],enumerable:!(v=O(i,g))||v.enumerable});return r},I=r=>M(b(x(r!=null?w(R(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);P(o,{ExtensionMimeTypeMap:()=>E,Hls:()=>c.default,MimeTypeShorthandMap:()=>A,StreamTypes:()=>y,allMediaTypes:()=>n,getStreamTypeConfig:()=>l,getType:()=>h,inferMimeTypeFromURL:()=>a,initialize:()=>u,loadMedia:()=>d,mux:()=>D.default,setupHls:()=>p,setupMux:()=>m,shorthandKeys:()=>S,teardown:()=>f,toMuxVideoURL:()=>t,toPlaybackIdParts:()=>e});var D=I(zn()),c=I(Xn()),T=(r,i)=>r in i,y={VOD:"on-demand",LIVE:"live",LL_LIVE:"ll-live"},E={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},A={HLS:E.M3U8},S=Object.keys(A),n=[...Object.values(E),...S,...S.map(r=>r.toUpperCase()),...S.map(r=>r.toLowerCase())],e=r=>{let i=r.indexOf("?");if(i<0)return[r];let v=r.slice(0,i),g=r.slice(i);return[v,g]},t=r=>{if(!r)return;let[i,v=""]=e(r);return`https://stream.mux.com/${i}.m3u8${v}`},a=r=>{let i="";try{i=new URL(r).pathname}catch{console.error("invalid url")}let v=i.lastIndexOf(".");if(v<0)return"";let L=i.slice(v+1).toUpperCase();return T(L,E)?E[L]:""},h=r=>{let i=r.type;if(i){let g=i.toUpperCase();return T(g,A)?A[g]:i}let{src:v}=r;return v?a(v):""},l=r=>r===y.LL_LIVE?{maxFragLookUpTolerance:.001}:{},f=(r,i)=>{i&&(i.detachMedia(),i.destroy()),(r==null?void 0:r.mux)&&(r.mux.destroy(),r.mux)},p=(r,i)=>{var v,g,L;let{debug:C,preferMse:k,streamType:U,startTime:F=-1}=r,B=h(r),N=B===E.M3U8,K=!B||((v=i==null?void 0:i.canPlayType(B))!=null?v:!0),H=c.default.isSupported(),V=((L=(g=window==null?void 0:window.navigator)==null?void 0:g.userAgent)!=null?L:"").toLowerCase().indexOf("android")!==-1&&U===y.LL_LIVE;if(N&&!(!N||K&&!((k||V)&&H))&&H){let Y=l(U);return new c.default({debug:C,startPosition:F,...Y})}},m=(r,i,v)=>{let{envKey:g}=r;if(g&&i){let{playerInitTime:L,playerSoftwareName:C,playerSoftwareVersion:k,beaconDomain:U,metadata:F,debug:B}=r;D.default.monitor(i,{debug:B,beaconDomain:U,hlsjs:v,Hls:v?c.default:void 0,data:{env_key:g,player_software_name:C,player_software_version:k,player_init_time:L,...F}})}},d=(r,i,v)=>{var g,L,C;if(!i){console.warn("attempting to load media before mediaEl exists");return}let{preferMse:k,streamType:U}=r,F=h(r),B=F===E.M3U8,N=!F||((g=i==null?void 0:i.canPlayType(F))!=null?g:!0),K=c.default.isSupported(),W=((C=(L=window==null?void 0:window.navigator)==null?void 0:L.userAgent)!=null?C:"").toLowerCase().indexOf("android")!==-1&&U===y.LL_LIVE,V=!B||N&&!((k||W)&&K),{src:$}=r;if(i&&N&&V)if(typeof $=="string"){let{startTime:Y}=r;if(i.setAttribute("src",$),Y){let Q=({target:J})=>{J.currentTime=Y,J.removeEventListener("loadedmetadata",Q)};i.addEventListener("loadedmetadata",Q)}}else i.removeAttribute("src");else if(v&&$){v.on(c.default.Events.ERROR,(Q,J)=>{if(J.fatal)switch(J.type){case c.default.ErrorTypes.NETWORK_ERROR:console.error("fatal network error encountered, try to recover"),v.startLoad();break;case c.default.ErrorTypes.MEDIA_ERROR:console.error("fatal media error encountered, try to recover"),v.recoverMediaError();break;default:console.error("unrecoverable fatal error encountered, cannot recover (check logs for more info)"),v.destroy();break}});let Y=()=>{Array.from(i.textTracks).forEach(Q=>{var J,ie;if(!["subtitles","caption"].includes(Q.kind)&&Q.label==="thumbnails"){if(!((J=Q.cues)==null?void 0:J.length)){let q=i.querySelector('track[label="thumbnails"]'),ne=(ie=q==null?void 0:q.getAttribute("src"))!=null?ie:"";q==null||q.removeAttribute("src"),setTimeout(()=>{q==null||q.setAttribute("src",ne)},0)}Q.mode!=="hidden"&&(Q.mode="hidden")}})};v.on(c.default.Events.MANIFEST_LOADED,Y),v.on(c.default.Events.MEDIA_ATTACHED,Y),v.loadSource($),v.attachMedia(i)}else console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")},u=(r,i,v)=>{f(i,v);let g=p(r,i);return m(r,i,g),d(r,i,g),g}}}),us=Kr(Yn()),Hr=document.createElement("template");Hr.innerHTML=`
<style>
  :host {
    /* Supposed to reset styles. Need to understand the specific effects more */
    all: initial;

    /* display:inline (like the native el) makes it so you can't fill
      the container with the native el */
    display: inline-block;
    box-sizing: border-box;

    width: auto;
    height: auto;
  }

  video {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

</style>

<video crossorigin></video>
`;var tt=class extends HTMLElement{constructor(){super();this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(Hr.content.cloneNode(!0));let o=this.nativeEl=this.shadowRoot.querySelector("video");Array.prototype.forEach.call(this.attributes,O=>{this.attributeChangedCallback(O.name,null,O.value)}),o.defaultMuted&&(o.muted=!0),this.querySelectorAll(":scope > track").forEach(O=>{this.nativeEl.appendChild(O.cloneNode())});let w=(O,s)=>{for(let R of O)R.type==="childList"&&(R.removedNodes.forEach(_=>{this.nativeEl.removeChild(this.nativeEl.querySelector(`track[src="${_.src}"]`))}),R.addedNodes.forEach(_=>{this.nativeEl.appendChild(_.cloneNode())}))};new MutationObserver(w).observe(this,{childList:!0,subtree:!0})}static get observedAttributes(){let o=[];Object.getOwnPropertyNames(this.prototype).forEach(x=>{let O=!1;try{typeof this.prototype[x]=="function"&&(O=!0)}catch{}!O&&x!==x.toUpperCase()&&o.push(x.toLowerCase())});let w=Object.getPrototypeOf(this).observedAttributes;return w&&(o=o.concat(w)),o}attributeChangedCallback(o,w,x){let O=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),s=Zn(O,o),R=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;s&&!R?typeof this[s]=="boolean"?x===null?this[s]=!1:this[s]=!0:this[s]=x:x===null?this.nativeEl.removeAttribute(o):["id","class"].indexOf(o)===-1&&this.nativeEl.setAttribute(o,x)}connectedCallback(){}},ht=[],Wr=document.createElement("video"),Jn=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let o=Object.getPrototypeOf(Wr);o&&o!==HTMLElement.prototype;o=Object.getPrototypeOf(o))Object.keys(o).forEach(w=>{Jn.indexOf(w)===-1&&ht.push(w)});ht=ht.concat(Object.keys(EventTarget.prototype)),ht.forEach(o=>{if(typeof Wr[o]=="function")tt.prototype[o]=function(){return this.nativeEl[o].apply(this.nativeEl,arguments)};else{let x={get(){return this.nativeEl[o]}};o!==o.toUpperCase()&&(x.set=function(O){this.nativeEl[o]=O}),Object.defineProperty(tt.prototype,o,x)}});function Zn(o,w){let x=null;return o.forEach(O=>{O.toLowerCase()==w.toLowerCase()&&(x=O)}),x}globalThis.customElements.get("custom-video")||(globalThis.customElements.define("custom-video",tt),globalThis.CustomVideoElement=tt);var Gr=tt,$e=Kr(Qn()),qn=()=>{try{return"0.2.2"}catch{}return"UNKNOWN"},ea=qn(),ta=()=>ea,le={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_MSE:"prefer-mse",METADATA_VIDEO_ID:"metadata-video-id",METADATA_VIDEO_TITLE:"metadata-video-title",METADATA_VIEWER_USER_ID:"metadata-viewer-user-id",BEACON_DOMAIN:"beacon-domain",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},ra=Object.values(le),ia=ta(),na="mux-video",jr=class extends Gr{constructor(){super();this.__metadata={},this.__muxPlayerInitTime=Date.now()}static get observedAttributes(){var o;return[...ra,...(o=Gr.observedAttributes)!=null?o:[]]}get playerSoftwareName(){return na}get playerSoftwareVersion(){return ia}get hls(){return this.__hls}get mux(){return this.nativeEl.mux}get src(){return this.getAttribute("src")}set src(o){o!==this.src&&(o==null?this.removeAttribute("src"):this.setAttribute("src",o))}get type(){var o;return(o=this.getAttribute(le.TYPE))!=null?o:void 0}set type(o){o!==this.type&&(o?this.setAttribute(le.TYPE,o):this.removeAttribute(le.TYPE))}get debug(){return this.getAttribute(le.DEBUG)!=null}set debug(o){o!==this.debug&&(o?this.setAttribute(le.DEBUG,""):this.removeAttribute(le.DEBUG))}get startTime(){let o=this.getAttribute(le.START_TIME);if(o==null)return;let w=+o;return Number.isNaN(w)?void 0:w}set startTime(o){o!==this.startTime&&(o==null?this.removeAttribute(le.START_TIME):this.setAttribute(le.START_TIME,`${o}`))}get playbackId(){var o;return(o=this.getAttribute(le.PLAYBACK_ID))!=null?o:void 0}set playbackId(o){o!==this.playbackId&&(o?this.setAttribute(le.PLAYBACK_ID,o):this.removeAttribute(le.PLAYBACK_ID))}get envKey(){var o;return(o=this.getAttribute(le.ENV_KEY))!=null?o:void 0}set envKey(o){o!==this.envKey&&(o?this.setAttribute(le.ENV_KEY,o):this.removeAttribute(le.ENV_KEY))}get beaconDomain(){var o;return(o=this.getAttribute(le.BEACON_DOMAIN))!=null?o:void 0}set beaconDomain(o){o!==this.beaconDomain&&(o?this.setAttribute(le.BEACON_DOMAIN,o):this.removeAttribute(le.BEACON_DOMAIN))}get streamType(){var o;return(o=this.getAttribute(le.STREAM_TYPE))!=null?o:void 0}set streamType(o){o!==this.streamType&&(o?this.setAttribute(le.STREAM_TYPE,o):this.removeAttribute(le.STREAM_TYPE))}get preferMSE(){return this.getAttribute(le.PREFER_MSE)!=null}set preferMSE(o){o?this.setAttribute(le.PREFER_MSE,""):this.removeAttribute(le.PREFER_MSE)}get metadata(){let o=this.getAttribute(le.METADATA_VIDEO_ID),w=this.getAttribute(le.METADATA_VIDEO_TITLE),x=this.getAttribute(le.METADATA_VIEWER_USER_ID);return{...this.__metadata,...o!=null?{video_id:o}:{},...w!=null?{video_title:w}:{},...x!=null?{viewer_user_id:x}:{}}}set metadata(o){this.__metadata=o!=null?o:{},this.mux&&this.mux.emit("hb",this.__metadata)}load(){let o=(0,$e.initialize)(this,this.nativeEl,this.__hls);this.__hls=o}unload(){(0,$e.teardown)(this.nativeEl,this.__hls),this.__hls=void 0}attributeChangedCallback(o,w,x){switch(o){case"src":let O=!!w,s=!!x;!O&&s?this.load():O&&!s?this.unload():O&&s&&(this.unload(),this.load());break;case le.PLAYBACK_ID:this.src=(0,$e.toMuxVideoURL)(x!=null?x:void 0);break;case le.DEBUG:let R=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this.hls&&(this.hls.config.debug=R);break;case le.METADATA_URL:x&&fetch(x).then(_=>_.json()).then(_=>this.metadata=_).catch(_=>console.error(`Unable to load or parse metadata JSON from metadata-url ${x}!`));break;default:break}super.attributeChangedCallback(o,w,x)}disconnectedCallback(){this.unload()}connectedCallback(){this.src&&this.load()}};globalThis.customElements.get("mux-video")||(globalThis.customElements.define("mux-video",jr),globalThis.MuxVideoElement=jr);var ds=$e.PlaybackEngine,cs=$e.ExtensionMimeTypeMap,fs=$e.PlaybackEngine,Vr=["autoplay","crossorigin","loop","muted","playsinline","src","poster","preload"],$r=["loadstart","loadedmetadata","progress","durationchange","volumechange","ratechange","resize","waiting","play","playing","timeupdate","pause","seeking","seeked","ended"],aa=class extends HTMLElement{static get observedAttributes(){return[...Vr]}constructor(){super();this.querySelectorAll(":scope > track").forEach(x=>{var O;(O=this.video)==null||O.append(x.cloneNode())});let o=x=>{for(let O of x)O.type==="childList"&&(O.removedNodes.forEach(s=>{var R,_;let b=(R=this.video)==null?void 0:R.querySelector(`track[src="${s.src}"]`);b&&((_=this.video)==null||_.removeChild(b))}),O.addedNodes.forEach(s=>{var R;(R=this.video)==null||R.append(s.cloneNode())}))};new MutationObserver(o).observe(this,{childList:!0,subtree:!0})}attributeChangedCallback(o,w,x){var O,s,R;Vr.includes(o)&&((O=this.video)==null?void 0:O.getAttribute(o))!=x&&(x===null?(s=this.video)==null||s.removeAttribute(o):(R=this.video)==null||R.setAttribute(o,x))}addEventListener(o,w,x){var O;if($r.includes(o)){(O=this.video)==null||O.addEventListener(o,w,x);return}super.addEventListener(o,w,x)}removeEventListener(o,w,x){var O;if($r.includes(o)){(O=this.video)==null||O.removeEventListener(o,w,x);return}super.removeEventListener(o,w,x)}play(){var o;return(o=this.video)==null?void 0:o.play()}pause(){var o;(o=this.video)==null||o.pause()}get video(){var o;return(o=this.shadowRoot)==null?void 0:o.querySelector("mux-video")}get paused(){var o,w;return(w=(o=this.video)==null?void 0:o.paused)!=null?w:!0}get duration(){var o,w;return(w=(o=this.video)==null?void 0:o.duration)!=null?w:NaN}get ended(){var o,w;return(w=(o=this.video)==null?void 0:o.ended)!=null?w:!1}get buffered(){var o;return(o=this.video)==null?void 0:o.buffered}get readyState(){var o,w;return(w=(o=this.video)==null?void 0:o.readyState)!=null?w:0}get videoWidth(){var o;return(o=this.video)==null?void 0:o.videoWidth}get videoHeight(){var o;return(o=this.video)==null?void 0:o.videoHeight}get currentTime(){var o,w;return(w=(o=this.video)==null?void 0:o.currentTime)!=null?w:0}set currentTime(o){this.video&&(this.video.currentTime=Number(o))}get volume(){var o,w;return(w=(o=this.video)==null?void 0:o.volume)!=null?w:1}set volume(o){this.video&&(this.video.volume=Number(o))}get src(){return Ye(this,"src")}set src(o){this.setAttribute("src",`${o}`)}get poster(){var o;return(o=Ye(this,"poster"))!=null?o:""}set poster(o){this.setAttribute("poster",`${o}`)}get playbackRate(){var o,w;return(w=(o=this.video)==null?void 0:o.playbackRate)!=null?w:1}set playbackRate(o){this.video&&(this.video.playbackRate=Number(o))}get crossOrigin(){return Ye(this,"crossorigin")}set crossOrigin(o){this.setAttribute("crossorigin",`${o}`)}get autoplay(){return Ye(this,"autoplay")!=null}set autoplay(o){o?this.setAttribute("autoplay",""):this.removeAttribute("autoplay")}get loop(){return Ye(this,"loop")!=null}set loop(o){o?this.setAttribute("loop",""):this.removeAttribute("loop")}get muted(){return Ye(this,"muted")!=null}set muted(o){o?this.setAttribute("muted",""):this.removeAttribute("muted")}};function Ye(o,w){return o.video?o.video.getAttribute(w):o.getAttribute(w)}var Yr=aa;function sa(o){let w="";return Object.entries(o).forEach(([x,O])=>{w+=`${oa(x)}: ${O}; `}),w.trim()}function oa(o){return o.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}var la=()=>{try{return"0.1.0-alpha.2"}catch{}return"UNKNOWN"},ua=la(),da=()=>ua,ca=o=>`https://image.mux.com/${o}/thumbnail.jpg`,fa=o=>`https://image.mux.com/${o}/storyboard.vtt`,vt,ha=(o="video")=>vt||(typeof window!="undefined"&&(vt=document.createElement(o)),vt),va=async(o=ha())=>{if(!o)return!1;let w=o.volume;return o.volume=w/2+.1,new Promise((x,O)=>{setTimeout(()=>{x(o.volume!==w)},0)})};function ga(o){var w,x;return Array.from((x=(w=o.video)==null?void 0:w.textTracks)!=null?x:[]).filter(({kind:O})=>O==="subtitles"||O==="captions")}function ma(o){let{primaryColor:w,secondaryColor:x,tertiaryColor:O}=o;return sa({...w?{"--media-icon-color":w,"--media-range-thumb-background":w,"--media-range-bar-color":w,color:w}:{},...x?{"--media-background-color":x,"--media-control-background":x,"--media-control-hover-background":x}:{}})}var Pt=class extends Error{constructor(o,w=0,x){super(o);var O;this.name="MediaError",this.code=w,this.fatal=x!=null?x:w>=Pt.MEDIA_ERR_NETWORK,this.message||(this.message=(O=Pt.defaultMessages[this.code])!=null?O:"")}},ye=Pt;ye.MEDIA_ERR_CUSTOM=0,ye.MEDIA_ERR_ABORTED=1,ye.MEDIA_ERR_NETWORK=2,ye.MEDIA_ERR_DECODE=3,ye.MEDIA_ERR_SRC_NOT_SUPPORTED=4,ye.MEDIA_ERR_ENCRYPTED=5,ye.defaultMessages={1:"You aborted the media playback",2:"A network error caused the media download to fail.",3:"A media error caused playback to be aborted. The media could be corrupt or your browser does not support this format.",4:"An unsupported error occurred. The server or network failed, or your browser does not support this format.",5:"The media is encrypted and there are no keys to decrypt it."};var zr=`
  :host {
    z-index: 100;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    box-sizing: border-box;
    color: #fff;
    line-height: 18px;
    font-family: Arial, sans-serif;
    padding: var(--media-dialog-backdrop-padding, 0);
    background: var(--media-dialog-backdrop-background,
      linear-gradient(to bottom, rgba(20, 20, 30, 0.7) 50%, rgba(20, 20, 30, 0.9))
    );
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-open, opacity .2s) !important;
    transform: var(--media-dialog-transform-open, none) !important;
    opacity: 1 !important;
    pointer-events: auto !important;
  }

  :host(:not([open])) {
    /* Needs to use !important to prevent overwrite of media-chrome */
    transition: var(--media-dialog-transition-close, opacity .1s) !important;
    transform: var(--media-dialog-transform-close, none);
    opacity: 0 !important;
    pointer-events: none !important;
  }

  /*
    Only show outline when keyboard focusing.
    https://drafts.csswg.org/selectors-4/#the-focus-visible-pseudo
    :host-context support is bad https://caniuse.com/mdn-css_selectors_host-context
  */
  :host-context([media-keyboard-control]) ::slotted(:focus),
  :host-context([media-keyboard-control]) :focus {
    box-shadow: 0 0 0 2px rgba(27, 127, 204, 0.9);
  }

  .dialog {
    position: relative;
    box-sizing: border-box;
    background: var(--media-dialog-background, none);
    padding: var(--media-dialog-padding, 10px);
    width: min(320px, 100%);
    max-height: 100%;
    overflow: auto;
  }
`,Xr=document.createElement("template");Xr.innerHTML=`
  <style>
    ${zr}
  </style>

  <div class="dialog">
    <slot></slot>
  </div>
`;var rt=class extends HTMLElement{get observedAttributes(){return["open"]}constructor(){super();var o;this.attachShadow({mode:"open"}),(o=this.shadowRoot)==null||o.appendChild(this.constructor.template.content.cloneNode(!0))}show(){this.setAttribute("open",""),Qr(this)}close(){this.removeAttribute("open"),this.dispatchEvent(new CustomEvent("close",{composed:!0,bubbles:!0})),pa(this)}connectedCallback(){this.hasAttribute("role")||this.setAttribute("role","dialog"),this.hasAttribute("open")&&Qr(this)}};rt.styles=zr,rt.template=Xr;function Qr(o){let w=o.querySelector("[autofocus]:not([disabled])");!w&&o.tabIndex>=0&&(w=o),w||(w=Jr(o.shadowRoot)),o._previouslyFocusedElement=document.activeElement,document.activeElement instanceof HTMLElement&&document.activeElement.blur(),w instanceof HTMLElement&&w.focus()}function Jr(o){let x=["button","input","keygen","select","textarea"].map(function(s){return s+":not([disabled])"});x.push('[tabindex]:not([disabled]):not([tabindex=""])');let O=o==null?void 0:o.querySelector(x.join(", "));if(!O&&"attachShadow"in Element.prototype){let s=(o==null?void 0:o.querySelectorAll("*"))||[];for(let R=0;R<s.length&&!(s[R].tagName&&s[R].shadowRoot&&(O=Jr(s[R].shadowRoot),O));R++);}return O}function pa(o){o._previouslyFocusedElement instanceof HTMLElement&&o._previouslyFocusedElement.focus()}globalThis.customElements.get("media-dialog")||(globalThis.customElements.define("media-dialog",rt),globalThis.MediaDialog=rt);var Zr=rt,qr=document.createElement("template");qr.innerHTML=`
  <style>
    ${Zr.styles}

    .close {
      background: none;
      color: inherit;
      border: none;
      padding: 0;
      font: inherit;
      cursor: pointer;
      outline: inherit;
      width: 28px;
      height: 28px;
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>

  <div class="dialog">
    <slot></slot>
  </div>

  <slot name="close">
    <button class="close" tabindex="0">
      <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </slot>
`;var xt=class extends Zr{constructor(){super();var o,w;(w=(o=this.shadowRoot)==null?void 0:o.querySelector(".close"))==null||w.addEventListener("click",()=>{this.close()})}};xt.template=qr,globalThis.customElements.get("mxp-dialog")||(globalThis.customElements.define("mxp-dialog",xt),globalThis.MxpDialog=xt);var gt=new Map;function ei(o){if(gt.has(o))return gt.get(o);let w="",x=0,O=!1,s=[];for(let R=0;R<o.length;R+=1)o[R]==="{"&&o[R+1]==="{"&&o[R-1]!=="\\"&&!O?(O=!0,w&&s.push(Object.freeze({type:"string",start:x,end:R,value:w})),w="{{",x=R,R+=2):o[R]==="}"&&o[R+1]==="}"&&o[R-1]!=="\\"&&O&&(O=!1,s.push(Object.freeze({type:"part",start:x,end:R+2,value:w.slice(2).trim()})),w="",R+=2,x=R),w+=o[R]||"";return w&&s.push(Object.freeze({type:"string",start:x,end:o.length,value:w})),gt.set(o,Object.freeze(s)),gt.get(o)}var ti=function(o,w,x){if(!w.has(o))throw new TypeError("attempted to set private field on non-instance");return w.set(o,x),x},ke=function(o,w){if(!w.has(o))throw new TypeError("attempted to get private field on non-instance");return w.get(o)},Re,mt,wt=class{constructor(o,w){this.expression=w,Re.set(this,void 0),mt.set(this,""),ti(this,Re,o),ke(this,Re).updateParent("")}get attributeName(){return ke(this,Re).attr.name}get attributeNamespace(){return ke(this,Re).attr.namespaceURI}get value(){return ke(this,mt)}set value(o){ti(this,mt,o||""),ke(this,Re).updateParent(o)}get element(){return ke(this,Re).element}get booleanValue(){return ke(this,Re).booleanValue}set booleanValue(o){ke(this,Re).booleanValue=o}};Re=new WeakMap,mt=new WeakMap;var Ea=class{constructor(o,w){this.element=o,this.attr=w,this.partList=[]}get booleanValue(){return this.element.hasAttributeNS(this.attr.namespaceURI,this.attr.name)}set booleanValue(o){if(this.partList.length!==1)throw new DOMException("Operation not supported","NotSupportedError");this.partList[0].value=o?"":null}append(o){this.partList.push(o)}updateParent(o){if(this.partList.length===1&&o===null)this.element.removeAttributeNS(this.attr.namespaceURI,this.attr.name);else{let w=this.partList.map(x=>typeof x=="string"?x:x.value).join("");this.element.setAttributeNS(this.attr.namespaceURI,this.attr.name,w)}}},ri=function(o,w,x){if(!w.has(o))throw new TypeError("attempted to set private field on non-instance");return w.set(o,x),x},ze=function(o,w){if(!w.has(o))throw new TypeError("attempted to get private field on non-instance");return w.get(o)},Oe,pt=class{constructor(o,w){this.expression=w,Oe.set(this,void 0),ri(this,Oe,[o]),o.textContent=""}get value(){return ze(this,Oe).map(o=>o.textContent).join("")}set value(o){this.replace(o)}get previousSibling(){return ze(this,Oe)[0].previousSibling}get nextSibling(){return ze(this,Oe)[ze(this,Oe).length-1].nextSibling}replace(...o){let w=o.map(x=>typeof x=="string"?new Text(x):x);w.length||w.push(new Text("")),ze(this,Oe)[0].before(...w);for(let x of ze(this,Oe))x.remove();ri(this,Oe,w)}};Oe=new WeakMap;function kt(o){return{createCallback(w,x,O){this.processCallback(w,x,O)},processCallback(w,x,O){var s;if(!(typeof O!="object"||!O)){for(let R of x)if(R.expression in O){let _=(s=O[R.expression])!==null&&s!==void 0?s:"";o(R,_)}}}}}function ii(o,w){o.value=String(w)}function ya(o,w){return typeof w=="boolean"&&o instanceof wt&&typeof o.element[o.attributeName]=="boolean"?(o.booleanValue=w,!0):!1}var Ta=kt(ii),hs=kt((o,w)=>{ya(o,w)||ii(o,w)}),ni=function(o,w,x){if(!w.has(o))throw new TypeError("attempted to set private field on non-instance");return w.set(o,x),x},Et=function(o,w){if(!w.has(o))throw new TypeError("attempted to get private field on non-instance");return w.get(o)},it,nt;function*_a(o){let w=o.ownerDocument.createTreeWalker(o,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,null,!1),x;for(;x=w.nextNode();)if(x instanceof Element&&x.hasAttributes())for(let O=0;O<x.attributes.length;O+=1){let s=x.attributes.item(O);if(s&&s.value.includes("{{")){let R=new Ea(x,s);for(let _ of ei(s.value))if(_.type==="string")R.append(_.value);else{let b=new wt(R,_.value);R.append(b),yield b}}}else if(x instanceof Text&&x.textContent&&x.textContent.includes("{{"))for(let O of ei(x.textContent)){O.end<x.textContent.length&&x.splitText(O.end),O.type==="part"&&(yield new pt(x,O.value));break}}var Ut=class extends DocumentFragment{constructor(o,w,x=Ta){var O,s;super();it.set(this,void 0),nt.set(this,void 0),Object.getPrototypeOf(this)!==Ut.prototype&&Object.setPrototypeOf(this,Ut.prototype),this.appendChild(o.content.cloneNode(!0)),ni(this,nt,Array.from(_a(this))),ni(this,it,x),(s=(O=Et(this,it)).createCallback)===null||s===void 0||s.call(O,this,Et(this,nt),w)}update(o){Et(this,it).processCallback(this,Et(this,nt),o)}};it=new WeakMap,nt=new WeakMap;function Aa(o,w){return w instanceof oi&&o instanceof pt?(w.renderInto(o),!0):!1}function Sa(o,w){return w instanceof DocumentFragment&&o instanceof pt?(w.childNodes.length&&o.replace(...w.childNodes),!0):!1}function ba(o,w){return o.value=String(w),!0}function La(o,w){return typeof w=="boolean"&&o instanceof wt?(o.booleanValue=w,!0):!1}function Da(o,w){La(o,w)||Aa(o,w)||Sa(o,w)||ba(o,w)}var Bt=new WeakMap,ai=new WeakMap,si=new WeakMap,oi=class{constructor(o,w,x){this.strings=o,this.values=w,this.processor=x}get template(){if(Bt.has(this.strings))return Bt.get(this.strings);{let o=document.createElement("template"),w=this.strings.length-1;return o.innerHTML=this.strings.reduce((x,O,s)=>x+O+(s<w?`{{ ${s} }}`:""),""),Bt.set(this.strings,o),o}}renderInto(o){let w=this.template;if(ai.get(o)!==w){ai.set(o,w);let x=new Ut(w,this.values,this.processor);si.set(o,x),o instanceof pt?o.replace(...x.children):o.appendChild(x);return}si.get(o).update(this.values)}},Ia=kt(Da);function se(o,...w){return new oi(o,w,Ia)}function Ma(o,w){o.renderInto(w)}var Ra=o=>se`
  <svg viewBox="0 0 20 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M10.19 11.22a.25.25 0 0 0-.38 0l-5.46 6.37a.25.25 0 0 0 .19.41h10.92a.25.25 0 0 0 .19-.41Z"
    />
    <path
      d="M19 0H1a1 1 0 0 0-1 1v13a1 1 0 0 0 1 1h2.94L5 13.75H1.25V1.25h17.5v12.5H15L16.06 15H19a1 1 0 0 0 1-1V1a1 1 0 0 0-1-1Z"
    />
  </svg>
`,Oa=o=>se`
  <svg viewBox="0 0 20 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M19.83 2.68a2.58 2.58 0 0 0-2.3-2.5C15.72.06 12.86 0 10 0S4.28.06 2.47.18a2.58 2.58 0 0 0-2.3 2.5 115.86 115.86 0 0 0 0 12.64 2.58 2.58 0 0 0 2.3 2.5c1.81.12 4.67.18 7.53.18s5.72-.06 7.53-.18a2.58 2.58 0 0 0 2.3-2.5 115.86 115.86 0 0 0 0-12.64Zm-1.49 12.53a1.11 1.11 0 0 1-.91 1.11c-1.67.11-4.45.18-7.43.18s-5.76-.07-7.43-.18a1.11 1.11 0 0 1-.91-1.11 122.5 122.5 0 0 1 0-12.42 1.11 1.11 0 0 1 .91-1.11C4.24 1.57 7 1.5 10 1.5s5.76.07 7.43.18a1.11 1.11 0 0 1 .91 1.11 122.5 122.5 0 0 1 0 12.42ZM7.84 11a1.55 1.55 0 0 1-.76.18 1.57 1.57 0 0 1-.71-.18 1.69 1.69 0 0 1-.57-.42 2.1 2.1 0 0 1-.38-.58 2.47 2.47 0 0 1 0-1.64 2 2 0 0 1 .39-.66 1.73 1.73 0 0 1 .58-.42 1.81 1.81 0 0 1 .73-.16 1.68 1.68 0 0 1 .7.14 1.39 1.39 0 0 1 .51.39l1.08-.89a2.18 2.18 0 0 0-.47-.44A2.81 2.81 0 0 0 8.4 6a2.91 2.91 0 0 0-.58-.15 2.71 2.71 0 0 0-.56 0A4.08 4.08 0 0 0 5.88 6a3.27 3.27 0 0 0-1.09.67 3.14 3.14 0 0 0-.71 1.06 3.62 3.62 0 0 0-.26 1.39 3.57 3.57 0 0 0 .26 1.38 3 3 0 0 0 .71 1.06 3.27 3.27 0 0 0 1.09.67 3.85 3.85 0 0 0 1.38.23 3.2 3.2 0 0 0 1.28-.27 2.49 2.49 0 0 0 1-.83l-1.17-.88a1.42 1.42 0 0 1-.53.52Zm6.62 0a1.58 1.58 0 0 1-.76.18A1.54 1.54 0 0 1 13 11a1.69 1.69 0 0 1-.57-.42A2.12 2.12 0 0 1 12 10a2.29 2.29 0 0 1 .39-2.3 1.84 1.84 0 0 1 1.32-.58 1.71 1.71 0 0 1 .7.14 1.39 1.39 0 0 1 .51.39L16 6.73a2.43 2.43 0 0 0-.47-.44A3.22 3.22 0 0 0 15 6a3 3 0 0 0-.57-.15 2.87 2.87 0 0 0-.57 0A4.06 4.06 0 0 0 12.5 6a3.17 3.17 0 0 0-1.09.67 3 3 0 0 0-.72 1.06 3.62 3.62 0 0 0-.25 1.39 3.57 3.57 0 0 0 .25 1.38 2.93 2.93 0 0 0 .72 1.06 3.17 3.17 0 0 0 1.09.67 3.83 3.83 0 0 0 1.37.23 3.16 3.16 0 0 0 1.28-.27 2.45 2.45 0 0 0 1-.83L15 10.51a1.49 1.49 0 0 1-.54.49Z"
    />
  </svg>
`,Ca=o=>se`
  <svg viewBox="0 0 20 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M19.83 2.68a2.58 2.58 0 0 0-2.3-2.5C13.91-.06 6.09-.06 2.47.18a2.58 2.58 0 0 0-2.3 2.5 115.86 115.86 0 0 0 0 12.64 2.58 2.58 0 0 0 2.3 2.5c3.62.24 11.44.24 15.06 0a2.58 2.58 0 0 0 2.3-2.5 115.86 115.86 0 0 0 0-12.64ZM8.42 12.78a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27A4 4 0 0 1 4 12a3.67 3.67 0 0 1-.84-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64A3.53 3.53 0 0 1 4 6.26a3.89 3.89 0 0 1 1.29-.8 4.76 4.76 0 0 1 1.63-.27 4.06 4.06 0 0 1 .67.06 4.57 4.57 0 0 1 .68.18 3.59 3.59 0 0 1 .64.34 2.7 2.7 0 0 1 .55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.35 2.35 0 0 0-.46.77 2.78 2.78 0 0 0-.16 1 2.74 2.74 0 0 0 .16 1 2.39 2.39 0 0 0 .46.77 2.07 2.07 0 0 0 .67.5 2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.88 2.88 0 0 1-1.22 1.01Zm7.52 0a3.63 3.63 0 0 1-1.51.32 4.76 4.76 0 0 1-1.63-.27 3.89 3.89 0 0 1-1.28-.83 3.55 3.55 0 0 1-.85-1.26 4.23 4.23 0 0 1-.3-1.63 4.28 4.28 0 0 1 .3-1.64 3.43 3.43 0 0 1 .85-1.25 3.75 3.75 0 0 1 1.28-.8 4.76 4.76 0 0 1 1.63-.27 4 4 0 0 1 .67.06 4.27 4.27 0 0 1 .68.18 3.59 3.59 0 0 1 .64.34 2.46 2.46 0 0 1 .55.52l-1.27 1a1.79 1.79 0 0 0-.6-.46 2 2 0 0 0-.83-.16 2 2 0 0 0-1.56.69 2.35 2.35 0 0 0-.46.77 3 3 0 0 0-.16 1 3 3 0 0 0 .16 1 2.58 2.58 0 0 0 .46.77 2.07 2.07 0 0 0 .67.5 2 2 0 0 0 .84.18 1.87 1.87 0 0 0 .9-.21 1.78 1.78 0 0 0 .65-.6l1.38 1a2.82 2.82 0 0 1-1.21 1.05Z"
    />
  </svg>
`,Pa=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M17.25 11.5h-5a.76.76 0 0 0-.75.75v5a.75.75 0 0 0 1.5 0V13h4.25a.75.75 0 0 0 0-1.5Zm-5-5h5a.75.75 0 0 0 0-1.5H13V.75a.75.75 0 0 0-1.5 0v5a.76.76 0 0 0 .75.75Zm-6.5 5h-5a.75.75 0 0 0 0 1.5H5v4.25a.75.75 0 0 0 1.5 0v-5a.76.76 0 0 0-.75-.75Zm0-11.5A.76.76 0 0 0 5 .75V5H.75a.75.75 0 0 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5A.76.76 0 0 0 5.75 0Z"
    />
  </svg>
`,xa=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M17.25 11.5a.76.76 0 0 0-.75.75v4.25h-4.25a.75.75 0 0 0 0 1.5h5a.76.76 0 0 0 .75-.75v-5a.76.76 0 0 0-.75-.75Zm0-11.5h-5a.76.76 0 0 0-.75.75.76.76 0 0 0 .75.75h4.25v4.25a.75.75 0 0 0 1.5 0v-5a.76.76 0 0 0-.75-.75ZM5.75 16.5H1.5v-4.25a.76.76 0 0 0-.75-.75.76.76 0 0 0-.75.75v5a.76.76 0 0 0 .75.75h5a.75.75 0 0 0 0-1.5Zm0-16.5h-5A.76.76 0 0 0 0 .75v5a.76.76 0 0 0 .75.75.76.76 0 0 0 .75-.75V1.5h4.25A.76.76 0 0 0 6.5.75.76.76 0 0 0 5.75 0Z"
    />
  </svg>
`,wa=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M3 16.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v15ZM11.5 1a.5.5 0 0 0-.5.5v15a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-15a.5.5 0 0 0-.5-.5h-3Z"
    />
  </svg>
`,ka=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="m3.73 17.93 14.05-8.54a.46.46 0 0 0 0-.78L3.73.07A.48.48 0 0 0 3 .46v17.07a.48.48 0 0 0 .73.4Z"
    />
  </svg>
`,li=o=>se`
  <svg viewBox="0 0 20 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M19 0H1a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h6.75v-1.25h-6.5V1.25h17.5v6.5H20V1a1 1 0 0 0-1-1Zm0 10h-8a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-6a1 1 0 0 0-1-1Zm-.5 6.5h-7v-5h7Z"
    />
  </svg>
`,Ua=o=>se`
  <svg viewBox="0 0 16 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M8.75 3.42H4.68l2.14-2.14A.75.75 0 0 0 5.76.22L2.22 3.75a.77.77 0 0 0 0 1.07l3.54 3.53a.75.75 0 0 0 1.06 0 .75.75 0 0 0 0-1.06L4.45 4.92h4.3A5.75 5.75 0 0 1 11 16a.75.75 0 0 0 .29 1.44.72.72 0 0 0 .29-.06A7.25 7.25 0 0 0 8.75 3.42Z"
    />
    <text
      class="value"
      transform="translate(.6 17.8)"
      style="font-size: 8px; font-family: 'ArialMT', 'Arial'"
    >
      ${o.value}
    </text>
    <path style="fill: none" d="M0 0h16v18H0z" />
  </svg>
`,Ba=o=>se`
  <svg viewBox="0 0 16 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="M7.25 3.42h4.07L9.18 1.28A.75.75 0 0 1 10.24.22l3.54 3.53a.77.77 0 0 1 0 1.07l-3.54 3.53a.75.75 0 0 1-1.06 0 .75.75 0 0 1 0-1.06l2.37-2.37h-4.3A5.75 5.75 0 0 0 5 16a.75.75 0 0 1-.29 1.44.72.72 0 0 1-.29-.06A7.25 7.25 0 0 1 7.25 3.42Z"
    />
    <text
      class="value"
      transform="translate(6.5 17.8)"
      style="font-size: 8px; font-family: 'ArialMT', 'Arial'"
    >
      ${o.value}
    </text>
    <path style="fill: none" d="M0 0h16v18H0z" />
  </svg>
`,Fa=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="m8.14 1.86-4 4a.49.49 0 0 1-.35.14H.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V2.21a.5.5 0 0 0-.86-.35ZM10.88.3v1.52A7.52 7.52 0 0 1 16.47 9a7.52 7.52 0 0 1-5.59 7.18v1.52A9 9 0 0 0 18 9 9 9 0 0 0 10.88.3ZM14.44 9a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66A5.49 5.49 0 0 0 14.44 9Z"
    />
    <path style="fill: none" d="M0 0h18v18H0z" />
  </svg>
`,ui=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="m8.14 1.86-4 4a.49.49 0 0 1-.35.14H.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.5.5 0 0 0 .85-.36V2.21a.5.5 0 0 0-.86-.35ZM14.44 9a5.49 5.49 0 0 0-3.56-5.1v1.66a3.93 3.93 0 0 1 0 6.88v1.66A5.49 5.49 0 0 0 14.44 9Z"
    />
    <path style="fill: none" d="M0 0h18v18H0z" />
  </svg>
`,Na=o=>se`
  <svg viewBox="0 0 18 18" slot="${o.slot}">
    <title>${o.title}</title>
    <path
      d="m0 1.05 4.48 4.47-.33.33a.49.49 0 0 1-.36.15H.25a.25.25 0 0 0-.25.25v5.5a.25.25 0 0 0 .25.25h3.54a.49.49 0 0 1 .36.15l4 4a.48.48 0 0 0 .36.15.5.5 0 0 0 .5-.5v-5.75l4.67 4.66a7.71 7.71 0 0 1-2.79 1.47v1.52a9.32 9.32 0 0 0 3.87-1.91L17 18l1-1L1.06 0Zm5.36 5.36L7.75 8.8V14L5 11.26a1.74 1.74 0 0 0-1.24-.51H1.25v-3.5h2.54A1.74 1.74 0 0 0 5 6.74ZM16.47 9a7.19 7.19 0 0 1-.89 3.47l1.11 1.1A8.64 8.64 0 0 0 18 9 9 9 0 0 0 10.88.3v1.52A7.52 7.52 0 0 1 16.47 9ZM9 5.88V2.21a.5.5 0 0 0-.5-.5.48.48 0 0 0-.36.15L6.56 3.44ZM12.91 9a4.28 4.28 0 0 1-.07.72l1.22 1.22A5.2 5.2 0 0 0 14.44 9a5.49 5.49 0 0 0-3.56-5.1v1.66A4 4 0 0 1 12.91 9Z"
    />
    <path style="fill: none" d="M0 0h18v18H0z" />
  </svg>
`,Ka=`:host {
  /* default aspect ratio, overwrite w/ e.g. style="aspect-ratio: 16 / 10" */
  aspect-ratio: 16 / 9;
  display: block;
}

media-controller {
  --media-control-background: transparent;
  --media-control-hover-background: transparent;
  --media-range-track-background: rgba(255, 255, 255, 0.5);
  --media-range-track-border-radius: 3px;
  --media-aspect-ratio: auto;
  display: block;
  width: 100%;
  height: 100%;
}

media-control-bar {
  --media-button-icon-width: 18px;
}

media-control-bar [role="button"],
media-control-bar [role="switch"] {
  height: 44px;
}

.mxp-spacer {
  flex-grow: 1;
  height: 100%;
  background-color: var(--media-control-background, rgba(20, 20, 30, 0.7));
}

.mxp-center-controls {
  --media-background-color: transparent;
  --media-button-icon-width: 100%;
  --media-button-icon-height: auto;
  pointer-events: none;
  width: 100%;
  display: flex;
  flex-flow: row;
  align-items: center;
  justify-content: center;
}

.mxp-center-controls media-play-button {
  --media-control-background: transparent;
  --media-control-hover-background: transparent;
  padding: 0;
  width: min(9%, 90px);
}

.mxp-center-controls media-seek-backward-button,
.mxp-center-controls media-seek-forward-button {
  --media-control-background: transparent;
  --media-control-hover-background: transparent;
  padding: 0;
  margin: 0 10%;
  width: min(7%, 70px);
}

media-loading-indicator {
  --media-loading-icon-width: 100%;
  --media-button-icon-height: auto;
  pointer-events: none;
  position: absolute;
  width: min(15%, 150px);
  display: flex;
  flex-flow: row;
  align-items: center;
  justify-content: center;
}

/* Intentionally don't target the div for transition but the children
 of the div. Prevents messing with media-chrome's autohide feature. */
media-loading-indicator + div * {
  transition: opacity 0.15s;
  opacity: 1;
}

media-loading-indicator[media-loading]:not([media-paused]) ~ div > * {
  opacity: 0;
  transition-delay: 400ms;
}

media-volume-range {
  width: min(100%, 100px);
}

media-time-display {
  white-space: nowrap;
}

.mxp-live-indicator::before {
  content: "\u25CF ";
  color: #fb3c4d;
  padding-right: 5px;
}
`,Xe={VOD:"on-demand",LIVE:"live",LL_LIVE:"ll-live"},di={LG:"large",SM:"small"},Ft=()=>se`<div class="mxp-spacer"></div>`,Ha=o=>{var w,x,O,s,R,_,b,P,M,I,D;return se`
  <style>
    ${Ka}
  </style>
  <media-controller style="${ma(o)}">
    <mux-video
      slot="media"
      crossorigin
      playsinline
      autoplay="${o.autoplay||o.streamType===Xe.LIVE||o.streamType===Xe.LL_LIVE}"
      muted="${o.muted}"
      debug="${o.debug}"
      prefer-mse="${o.preferMse}"
      start-time="${o.startTime!=null?o.startTime:!1}"
      poster="${o.poster?o.poster:o.playbackId?ca(o.playbackId):!1}"
      playback-id="${(w=o.playbackId)!=null?w:!1}"
      env-key="${(x=o.envKey)!=null?x:!1}"
      stream-type="${(O=o.streamType)!=null?O:!1}"
      metadata-video-id="${(R=(s=o.metadata)==null?void 0:s.video_id)!=null?R:!1}"
      metadata-video-title="${(b=(_=o.metadata)==null?void 0:_.video_title)!=null?b:!1}"
      metadata-viewer-user-id="${(M=(P=o.metadata)==null?void 0:P.viewer_user_id)!=null?M:!1}"
    >
      ${o.playbackId&&o.streamType!==Xe.LIVE&&o.streamType!==Xe.LL_LIVE?se`<track
            label="thumbnails"
            default
            kind="metadata"
            src="${fa(o.playbackId)}"
          />`:""}
    </mux-video>
    <media-loading-indicator
      slot="centered-chrome"
      no-auto-hide
    ></media-loading-indicator>
    ${Wa(o)}
    <mxp-dialog
      slot="centered-chrome"
      no-auto-hide
      open="${o.isDialogOpen}"
    >
      ${((I=o.dialog)==null?void 0:I.title)?se`<h3>${o.dialog.title}</h3>`:""}
      ${((D=o.dialog)==null?void 0:D.message)?se`<p>${o.dialog.message}</p>`:""}
    </mxp-dialog>
  </media-controller>
`},Wa=o=>{let{streamType:w,playerSize:x}=o;return w===Xe.LIVE||w===Xe.LL_LIVE?x===di.LG?$a(o):Va(o):x===di.LG?ja(o):Ga(o)},at=()=>se`
  <media-play-button>
    ${ka({slot:"play",title:"Play"})}
    ${wa({slot:"pause",title:"Pause"})}
  </media-play-button>
`,ci=o=>se`
  <media-seek-backward-button seek-offset="${o.backwardSeekOffset}">
    ${Ua({slot:"backward",value:o.backwardSeekOffset})}
  </media-seek-backward-button>
`,fi=o=>se`
  <media-seek-forward-button seek-offset="${o.forwardSeekOffset}">
    ${Ba({slot:"forward",value:o.forwardSeekOffset})}
  </media-seek-forward-button>
`,yt=()=>se`
  <media-mute-button>
    ${Fa({slot:"high"})} ${ui({slot:"medium"})}
    ${ui({slot:"low"})} ${Na({slot:"off"})}
  </media-mute-button>
`,Tt=o=>se` <media-captions-button
  default-showing="${o.defaultShowCaptions}"
>
  ${Oa({slot:"off"})} ${Ca({slot:"on"})}
</media-captions-button>`,_t=()=>se`<media-airplay-button>
  ${Ra({slot:"airplay"})}
</media-airplay-button>`,At=()=>se`<media-pip-button>
  ${li({slot:"enter",title:"Enter Picture-in-Picture"})}
  ${li({slot:"exit",title:"Exit Picture-in-Picture"})}
</media-pip-button>`,St=()=>se`<media-fullscreen-button>
  ${xa({slot:"enter",title:"Enter Fullscreen"})}
  ${Pa({slot:"exit",title:"Exit Fullscreen"})}
</media-fullscreen-button>`,Ga=o=>se`
  <media-control-bar slot="top-chrome" style="justify-content: flex-end;">
    ${o.hasCaptions?Tt(o):""}
    ${o.supportsAirPlay?_t():""} ${At()}
  </media-control-bar>
  <div slot="centered-chrome" class="mxp-center-controls">
    ${ci(o)} ${at()}
    ${fi(o)}
  </div>
  <media-control-bar>
    <media-time-range></media-time-range>
    <media-time-display show-duration remaining></media-time-display>
    ${yt()}
    ${o.supportsVolume?se`<media-volume-range></media-volume-range>`:""}
    <media-playback-rate-button></media-playback-rate-button>
    ${St()}
  </media-control-bar>
`,ja=o=>se`
  <div slot="centered-chrome" class="mxp-center-controls">
    ${at()}
  </div>
  <media-control-bar>
    ${at()} ${ci(o)}
    ${fi(o)}
    <media-time-range></media-time-range>
    <media-time-display show-duration remaining></media-time-display>
    ${yt()}
    ${o.supportsVolume?se`<media-volume-range></media-volume-range>`:""}
    <media-playback-rate-button></media-playback-rate-button>
    ${o.hasCaptions?Tt(o):""}
    ${o.supportsAirPlay?_t():""} ${At()}
    ${St()}
  </media-control-bar>
`,Va=o=>se`
  <media-control-bar slot="top-chrome">
    <media-text-display class="mxp-live-indicator">Live</media-text-display>
    ${Ft()} ${o.hasCaptions?Tt(o):""}
    ${o.supportsAirPlay?_t():""} ${At()}
  </media-control-bar>
  <div slot="centered-chrome" class="mxp-center-controls">
    ${at()}
  </div>
  <media-control-bar>
    ${yt()}
    ${o.supportsVolume?se`<media-volume-range></media-volume-range>`:""}
    ${Ft()} ${St()}
  </media-control-bar>
`,$a=o=>se`
  <media-control-bar slot="top-chrome">
    <media-text-display class="mxp-live-indicator">Live</media-text-display>
  </media-control-bar>
  <div slot="centered-chrome" class="mxp-center-controls">
    ${at()}
  </div>
  <media-control-bar>
    ${yt()}
    ${o.supportsVolume?se`<media-volume-range></media-volume-range>`:""}
    ${Ft()} ${o.hasCaptions?Tt(o):""}
    ${o.supportsAirPlay?_t():""} ${At()}
    ${St()}
  </media-control-bar>
`,Ya=class{constructor(o){this._state={isDialogOpen:!1,supportsAirPlay:!1,supportsVolume:!1},this.el=o,o.attachShadow({mode:"open"}),this._setState({playerSize:bt(this.el)}),o.querySelectorAll(":scope > track").forEach(w=>{var x;(x=o.video)==null||x.append(w.cloneNode())}),Array.prototype.forEach.call(o.attributes,w=>{o.attributeChangedCallback(w.name,null,w.value)}),o.video&&(o.video.muted=o.video.defaultMuted),this._setUpErrors(o),this._setUpMutedAutoplay(o),this._setUpCaptionsButton(o),this._setUpAirplayButton(o),this._setUpVolumeRange(o)}connectedCallback(){this._renderChrome(),this._initResizing()}disconnectedCallback(){this._deinitResizing()}_setState(o){Object.assign(this._state,o),this._render()}_render(){Ma(Ha(Xa(this.el,this._state)),this.el.shadowRoot)}_renderChrome(){this._state.playerSize!=bt(this.el)&&this._setState({playerSize:bt(this.el)})}_initResizing(){this._resizeObserver=new ResizeObserver(()=>this._renderChrome()),this._resizeObserver.observe(this.el)}_deinitResizing(){var o;(o=this._resizeObserver)==null||o.disconnect()}_setUpErrors(o){var w,x;let O=s=>{let{detail:R}=s;if(R instanceof ye||(R=new ye(R.message,R.code,R.fatal)),!(R==null?void 0:R.fatal))return;let _;switch(R.code){case ye.MEDIA_ERR_NETWORK:_={title:"Network Error",message:`${R.message} Please reload the player and try again.`};break;case ye.MEDIA_ERR_DECODE:_={title:"Media Error",message:`${R.message} Please reload the player and try again.`};break;case ye.MEDIA_ERR_SRC_NOT_SUPPORTED:_={title:"Source Not Supported",message:R.message};break;default:_={title:"Error",message:R.message};break}this._setState({isDialogOpen:!0,dialog:_})};if(o.addEventListener("error",O),(w=o.video)==null||w.addEventListener("error",()=>{var s,R;let{message:_,code:b}=(R=(s=o.video)==null?void 0:s.error)!=null?R:{};o.dispatchEvent(new CustomEvent("error",{detail:new ye(_,b)}))}),(x=o.video)==null?void 0:x.hls){let s=o.video.hls.constructor,R=(_,b)=>{let P={[s.ErrorTypes.NETWORK_ERROR]:ye.MEDIA_ERR_NETWORK,[s.ErrorTypes.MEDIA_ERROR]:ye.MEDIA_ERR_DECODE},M=new ye("",P[b.type]);M.fatal=b.fatal,M.data=b,o.dispatchEvent(new CustomEvent("error",{detail:M}))};o.video.hls.on(s.Events.ERROR,R)}}_setUpMutedAutoplay(o){var w;if((w=o.video)==null?void 0:w.hls){let x=o.video.hls.constructor;o.autoplay&&o.video.hls.on(x.Events.MANIFEST_PARSED,()=>{var O,s=(O=o.video)==null?void 0:O.play();s&&s.catch(R=>{var _;if(console.log(`${R.name} ${R.message}`),R.name==="NotAllowedError")return console.log("Attempting to play with video muted"),o.video&&(o.video.muted=!0),(_=o.video)==null?void 0:_.play().catch(console.error)})})}}_setUpCaptionsButton(o){var w,x,O,s;let R=()=>this._render();(x=(w=o.video)==null?void 0:w.textTracks)==null||x.addEventListener("addtrack",R),(s=(O=o.video)==null?void 0:O.textTracks)==null||s.addEventListener("removetrack",R)}_setUpAirplayButton(o){var w;if(globalThis.WebKitPlaybackTargetAvailabilityEvent){let x=O=>{let s=O.availability==="available";this._setState({supportsAirPlay:s})};(w=o.video)==null||w.addEventListener("webkitplaybacktargetavailabilitychanged",x)}}async _setUpVolumeRange(o){let w=await va();this._setState({supportsVolume:w})}},za=700,hi={LG:"large",SM:"small"};function bt(o){return o.getBoundingClientRect().width<za?hi.SM:hi.LG}var Ae={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_MSE:"prefer-mse",METADATA_VIDEO_ID:"metadata-video-id",METADATA_VIDEO_TITLE:"metadata-video-title",METADATA_VIEWER_USER_ID:"metadata-viewer-user-id",BEACON_DOMAIN:"beacon-domain",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},Qe={DEFAULT_SHOW_CAPTIONS:"default-show-captions",PRIMARY_COLOR:"primary-color",SECONDARY_COLOR:"secondary-color",FORWARD_SEEK_OFFSET:"forward-seek-offset",BACKWARD_SEEK_OFFSET:"backward-seek-offset"};function Xa(o,w){return{debug:o.debug,muted:o.muted,envKey:o.envKey,playbackId:o.playbackId,poster:o.poster,metadata:o.metadata,startTime:o.startTime,preferMse:o.preferMse,streamType:o.streamType,primaryColor:o.primaryColor,secondaryColor:o.secondaryColor,forwardSeekOffset:o.forwardSeekOffset,backwardSeekOffset:o.backwardSeekOffset,defaultShowCaptions:o.defaultShowCaptions,playerSize:bt(o),hasCaptions:!!ga(o).length,...w}}var vi=Object.values(Ae),Qa=Object.values(Qe),Ja=da(),Za="mux-player",Nt=new WeakMap,Kt=class extends Yr{static get observedAttributes(){var o;return[...(o=Yr.observedAttributes)!=null?o:[],...vi,...Qa]}constructor(){super();Nt.set(this,new Ya(this))}connectedCallback(){Nt.get(this).connectedCallback()}disconnectedCallback(){Nt.get(this).disconnectedCallback()}attributeChangedCallback(o,w,x){var O,s;super.attributeChangedCallback(o,w,x),vi.includes(o)&&(x===null?(O=this.video)==null||O.removeAttribute(o):(s=this.video)==null||s.setAttribute(o,x))}get primaryColor(){return this.getAttribute(Qe.PRIMARY_COLOR)}get secondaryColor(){return this.getAttribute(Qe.SECONDARY_COLOR)}get forwardSeekOffset(){return this.getAttribute(Qe.FORWARD_SEEK_OFFSET)}get backwardSeekOffset(){return this.getAttribute(Qe.BACKWARD_SEEK_OFFSET)}get defaultShowCaptions(){return this.getAttribute(Qe.DEFAULT_SHOW_CAPTIONS)||!0}get playerSoftwareName(){return Za}get playerSoftwareVersion(){return Ja}get hls(){var o;return(o=this.video)==null?void 0:o.hls}get mux(){var o;return(o=this.video)==null?void 0:o.mux}get playbackId(){return Je(this,Ae.PLAYBACK_ID)}get envKey(){return Je(this,Ae.ENV_KEY)}get debug(){return Je(this,Ae.DEBUG)!=null}set debug(o){o?this.setAttribute(Ae.DEBUG,""):this.removeAttribute(Ae.DEBUG)}get streamType(){return Je(this,Ae.STREAM_TYPE)}set streamType(o){this.setAttribute(Ae.STREAM_TYPE,`${o}`)}get startTime(){let o=Je(this,Ae.START_TIME);if(o==null)return;let w=+o;return Number.isNaN(w)?void 0:w}set startTime(o){this.setAttribute(Ae.START_TIME,`${o}`)}get preferMse(){return Je(this,Ae.PREFER_MSE)!=null}set preferMse(o){o?this.setAttribute(Ae.PREFER_MSE,""):this.removeAttribute(Ae.PREFER_MSE)}get metadata(){var o;return(o=this.video)==null?void 0:o.metadata}set metadata(o){this.video&&(this.video.metadata=o)}};function Je(o,w){return o.video?o.video.getAttribute(w):o.getAttribute(w)}globalThis.customElements.get("mux-player")||(globalThis.customElements.define("mux-player",Kt),globalThis.MuxPlayerElement=Kt);var vs=Kt})();export{Gt as MuxPlayer};
