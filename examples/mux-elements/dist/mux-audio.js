var ve=Object.create;var Nt=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var pe=Object.getOwnPropertyNames;var me=Object.getPrototypeOf,ye=Object.prototype.hasOwnProperty;var _e=ct=>Nt(ct,"__esModule",{value:!0});var Ee=(ct,vt)=>()=>(vt||ct((vt={exports:{}}).exports,vt),vt.exports);var Te=(ct,vt,xt)=>{if(vt&&typeof vt=="object"||typeof vt=="function")for(let St of pe(vt))!ye.call(ct,St)&&St!=="default"&&Nt(ct,St,{get:()=>vt[St],enumerable:!(xt=ge(vt,St))||xt.enumerable});return ct},be=ct=>Te(_e(Nt(ct!=null?ve(me(ct)):{},"default",ct&&ct.__esModule&&"default"in ct?{get:()=>ct.default,enumerable:!0}:{value:ct,enumerable:!0})),ct);var Kt=Ee(()=>{(()=>{var ct=Object.create,vt=Object.defineProperty,xt=Object.getOwnPropertyDescriptor,St=Object.getOwnPropertyNames,Vt=Object.getPrototypeOf,Wt=Object.prototype.hasOwnProperty,Yt=H=>vt(H,"__esModule",{value:!0}),It=(H,Z)=>()=>(Z||H((Z={exports:{}}).exports,Z),Z.exports),zt=(H,Z,j)=>{if(Z&&typeof Z=="object"||typeof Z=="function")for(let x of St(Z))!Wt.call(H,x)&&x!=="default"&&vt(H,x,{get:()=>Z[x],enumerable:!(j=xt(Z,x))||j.enumerable});return H},Xt=H=>zt(Yt(vt(H!=null?ct(Vt(H)):{},"default",H&&H.__esModule&&"default"in H?{get:()=>H.default,enumerable:!0}:{value:H,enumerable:!0})),H),Jt=It((H,Z)=>{(function(){var j=!1;(function(x,p){typeof H=="object"&&typeof Z=="object"?Z.exports=p():typeof j=="function"&&j.amd?j("mux",[],p):typeof H=="object"?H.mux=p():x.mux=p()})(this,function(){return function(x){function p(S){if(w[S])return w[S].exports;var L=w[S]={i:S,l:!1,exports:{}};return x[S].call(L.exports,L,L.exports,p),L.l=!0,L.exports}var w={};return p.m=x,p.c=w,p.d=function(S,L,k){p.o(S,L)||Object.defineProperty(S,L,{configurable:!1,enumerable:!0,get:k})},p.n=function(S){var L=S&&S.__esModule?function(){return S.default}:function(){return S};return p.d(L,"a",L),L},p.o=function(S,L){return Object.prototype.hasOwnProperty.call(S,L)},p.p="",p(p.s=15)}([function(x,p,w){(function(S){var L;L=typeof window!="undefined"?window:S!==void 0?S:typeof self!="undefined"?self:{},x.exports=L}).call(p,w(17))},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(0),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k={};k.now=function(){var A=L.default.performance,D=A&&A.timing;return D&&typeof D.navigationStart=="number"&&typeof A.now=="function"?D.navigationStart+A.now():Date.now()},p.default=k},function(x,p){function w(M,P,N){switch(N.length){case 0:return M.call(P);case 1:return M.call(P,N[0]);case 2:return M.call(P,N[0],N[1]);case 3:return M.call(P,N[0],N[1],N[2])}return M.apply(P,N)}function S(M,P){for(var N=-1,U=Array(M);++N<M;)U[N]=P(N);return U}function L(M,P){var N=I(M)||E(M)?S(M.length,String):[],U=N.length,B=!!U;for(var G in M)!P&&!u.call(M,G)||B&&(G=="length"||d(G,U))||N.push(G);return N}function k(M,P,N){var U=M[P];u.call(M,P)&&m(U,N)&&(N!==void 0||P in M)||(M[P]=N)}function A(M){if(!T(M))return R(M);var P=[];for(var N in Object(M))u.call(M,N)&&N!="constructor"&&P.push(N);return P}function D(M,P){return P=O(P===void 0?M.length-1:P,0),function(){for(var N=arguments,U=-1,B=O(N.length-P,0),G=Array(B);++U<B;)G[U]=N[P+U];U=-1;for(var q=Array(P+1);++U<P;)q[U]=N[U];return q[P]=G,w(M,this,q)}}function _(M,P,N,U){N||(N={});for(var B=-1,G=P.length;++B<G;){var q=P[B],K=U?U(N[q],M[q],q,N,M):void 0;k(N,q,K===void 0?M[q]:K)}return N}function d(M,P){return!!(P=P==null?v:P)&&(typeof M=="number"||a.test(M))&&M>-1&&M%1==0&&M<P}function g(M,P,N){if(!c(N))return!1;var U=typeof P;return!!(U=="number"?l(N)&&d(P,N.length):U=="string"&&P in N)&&m(N[P],M)}function T(M){var P=M&&M.constructor;return M===(typeof P=="function"&&P.prototype||r)}function m(M,P){return M===P||M!==M&&P!==P}function E(M){return t(M)&&u.call(M,"callee")&&(!b.call(M,"callee")||o.call(M)==y)}function l(M){return M!=null&&i(M.length)&&!e(M)}function t(M){return n(M)&&l(M)}function e(M){var P=c(M)?o.call(M):"";return P==f||P==s}function i(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=v}function c(M){var P=typeof M;return!!M&&(P=="object"||P=="function")}function n(M){return!!M&&typeof M=="object"}function h(M){return l(M)?L(M):A(M)}var v=9007199254740991,y="[object Arguments]",f="[object Function]",s="[object GeneratorFunction]",a=/^(?:0|[1-9]\d*)$/,r=Object.prototype,u=r.hasOwnProperty,o=r.toString,b=r.propertyIsEnumerable,R=function(M,P){return function(N){return M(P(N))}}(Object.keys,Object),O=Math.max,C=!b.call({valueOf:1},"valueOf"),I=Array.isArray,F=function(M){return D(function(P,N){var U=-1,B=N.length,G=B>1?N[B-1]:void 0,q=B>2?N[2]:void 0;for(G=M.length>3&&typeof G=="function"?(B--,G):void 0,q&&g(N[0],N[1],q)&&(G=B<3?void 0:G,B=1),P=Object(P);++U<B;){var K=N[U];K&&M(P,K,U,G)}return P})}(function(M,P){if(C||T(P)||l(P))return void _(P,h(P),M);for(var N in P)u.call(P,N)&&k(M,N,P[N])});x.exports=F},function(x,p,w){"use strict";function S(L,k,A){A=A===void 0?1:A,L[k]=L[k]||0,L[k]+=A}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(18),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k=L.default.methodFactory;L.default.methodFactory=function(A,D,_){var d=k(A,D,_);return function(){for(var g=["[mux]"],T=0;T<arguments.length;T++)g.push(arguments[T]);d.apply(void 0,g)}},L.default.setLevel(L.default.getLevel()),p.default=L.default},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=function(A){return k(A)[0]},L=function(A){return k(A)[1]},k=function(A){if(typeof A!="string"||A==="")return["localhost"];var D=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,_=A.match(D)||[],d=_[4],g=void 0;return d&&(g=(d.match(/[^\.]+\.[^\.]+$/)||[])[0]),[d,g]};p.extractHostnameAndDomain=k,p.extractHostname=S,p.extractDomain=L},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(k){var A=16*Math.random()|0;return(k==="x"?A:3&A|8).toString(16)})},L=function(){return("000000"+(Math.random()*Math.pow(36,6)<<0).toString(36)).slice(-6)};p.generateUUID=S,p.generateShortID=L},function(x,p,w){"use strict";function S(k){k=k||"";var A={};return k.trim().split(/[\r\n]+/).forEach(function(D){if(D){var _=D.split(": "),d=_.shift();d&&L.indexOf(d.toLowerCase())>=0&&(A[d]=_.join(": "))}}),A}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S;var L=["x-cdn","content-type"]},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0}),p.findMediaElement=p.getMuxPlayerId=void 0;var S=w(6),L=function(A){return A&&A.nodeName!==void 0?(A.muxId||(A.muxId=A.id||(0,S.generateShortID)()),A.muxId):A},k=function(A){var D=void 0;return A&&A.nodeName!==void 0?(D=A,A=L(D)):D=document.querySelector(A),[D,A,D&&D.nodeName?D.nodeName.toLowerCase():""]};p.getMuxPlayerId=L,p.findMediaElement=k},function(x,p,w){"use strict";function S(){return(k.default.doNotTrack||k.default.navigator&&(k.default.navigator.doNotTrack||k.default.navigator.msDoNotTrack))==="1"}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S;var L=w(0),k=function(A){return A&&A.__esModule?A:{default:A}}(L)},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(0),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k={};k.exists=function(){var A=L.default.performance;return(A&&A.timing)!==void 0},k.domContentLoadedEventEnd=function(){var A=L.default.performance,D=A&&A.timing;return D&&D.domContentLoadedEventEnd},k.navigationStart=function(){var A=L.default.performance,D=A&&A.timing;return D&&D.navigationStart},p.default=k},function(x,p,w){"use strict";var S=w(37),L=w(38),k=w(13);x.exports={formats:k,parse:L,stringify:S}},function(x,p,w){"use strict";var S=Object.prototype.hasOwnProperty,L=function(){for(var A=[],D=0;D<256;++D)A.push("%"+((D<16?"0":"")+D.toString(16)).toUpperCase());return A}(),k=function(A){for(var D;A.length;){var _=A.pop();if(D=_.obj[_.prop],Array.isArray(D)){for(var d=[],g=0;g<D.length;++g)D[g]!==void 0&&d.push(D[g]);_.obj[_.prop]=d}}return D};p.arrayToObject=function(A,D){for(var _=D&&D.plainObjects?Object.create(null):{},d=0;d<A.length;++d)A[d]!==void 0&&(_[d]=A[d]);return _},p.merge=function(A,D,_){if(!D)return A;if(typeof D!="object"){if(Array.isArray(A))A.push(D);else{if(typeof A!="object")return[A,D];(_.plainObjects||_.allowPrototypes||!S.call(Object.prototype,D))&&(A[D]=!0)}return A}if(typeof A!="object")return[A].concat(D);var d=A;return Array.isArray(A)&&!Array.isArray(D)&&(d=p.arrayToObject(A,_)),Array.isArray(A)&&Array.isArray(D)?(D.forEach(function(g,T){S.call(A,T)?A[T]&&typeof A[T]=="object"?A[T]=p.merge(A[T],g,_):A.push(g):A[T]=g}),A):Object.keys(D).reduce(function(g,T){var m=D[T];return S.call(g,T)?g[T]=p.merge(g[T],m,_):g[T]=m,g},d)},p.assign=function(A,D){return Object.keys(D).reduce(function(_,d){return _[d]=D[d],_},A)},p.decode=function(A){try{return decodeURIComponent(A.replace(/\+/g," "))}catch{return A}},p.encode=function(A){if(A.length===0)return A;for(var D=typeof A=="string"?A:String(A),_="",d=0;d<D.length;++d){var g=D.charCodeAt(d);g===45||g===46||g===95||g===126||g>=48&&g<=57||g>=65&&g<=90||g>=97&&g<=122?_+=D.charAt(d):g<128?_+=L[g]:g<2048?_+=L[192|g>>6]+L[128|63&g]:g<55296||g>=57344?_+=L[224|g>>12]+L[128|g>>6&63]+L[128|63&g]:(d+=1,g=65536+((1023&g)<<10|1023&D.charCodeAt(d)),_+=L[240|g>>18]+L[128|g>>12&63]+L[128|g>>6&63]+L[128|63&g])}return _},p.compact=function(A){for(var D=[{obj:{o:A},prop:"o"}],_=[],d=0;d<D.length;++d)for(var g=D[d],T=g.obj[g.prop],m=Object.keys(T),E=0;E<m.length;++E){var l=m[E],t=T[l];typeof t=="object"&&t!==null&&_.indexOf(t)===-1&&(D.push({obj:T,prop:l}),_.push(t))}return k(D)},p.isRegExp=function(A){return Object.prototype.toString.call(A)==="[object RegExp]"},p.isBuffer=function(A){return A!=null&&!!(A.constructor&&A.constructor.isBuffer&&A.constructor.isBuffer(A))}},function(x,p,w){"use strict";var S=String.prototype.replace,L=/%20/g;x.exports={default:"RFC3986",formatters:{RFC1738:function(k){return S.call(k,L,"+")},RFC3986:function(k){return k}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},function(x,p,w){"use strict";function S(l){return l&&l.__esModule?l:{default:l}}function L(l){var t={};for(var e in l)l.hasOwnProperty(e)&&(t[l[e]]=e);return t}function k(l){var t={},e={};return Object.keys(l).forEach(function(i){var c=!1;if(l.hasOwnProperty(i)&&l[i]!==void 0){var n=i.split("_"),h=n[0],v=T[h];v||(D.default.info("Data key word `"+n[0]+"` not expected in "+i),v=h+"_"),n.splice(1).forEach(function(y){y==="url"&&(c=!0),E[y]?v+=E[y]:Number(y)&&Math.floor(Number(y))===Number(y)?v+=y:(D.default.info("Data key word `"+y+"` not expected in "+i),v+="_"+y+"_")}),c?e[v]=l[i]:t[v]=l[i]}}),(0,d.default)(t,e)}Object.defineProperty(p,"__esModule",{value:!0}),p.default=k;var A=w(4),D=S(A),_=w(2),d=S(_),g={a:"env",b:"beacon",c:"custom",d:"ad",e:"event",f:"experiment",m:"mux",n:"response",p:"player",q:"request",r:"retry",s:"session",t:"timestamp",u:"viewer",v:"video",w:"page",x:"view",y:"sub"},T=L(g),m={ad:"ad",ag:"aggregate",ap:"api",al:"application",ar:"architecture",as:"asset",au:"autoplay",av:"average",bi:"bitrate",br:"break",bw:"browser",by:"bytes",ca:"cached",cb:"cancel",cd:"code",cg:"category",ch:"changed",cn:"config",co:"count",ce:"counter",cp:"complete",cr:"creative",ct:"content",cu:"current",cx:"connection",dg:"downscaling",dm:"domain",dn:"cdn",do:"downscale",du:"duration",dv:"device",ec:"encoding",en:"end",eg:"engine",em:"embed",er:"error",es:"errorcode",et:"errortext",ee:"event",ev:"events",ex:"expires",fi:"first",fm:"family",ft:"format",fq:"frequency",fr:"frame",fs:"fullscreen",hb:"holdback",he:"headers",ho:"host",hn:"hostname",ht:"height",id:"id",ii:"init",in:"instance",ip:"ip",is:"is",ke:"key",la:"language",lb:"labeled",le:"level",li:"live",ld:"loaded",lo:"load",ls:"lists",lt:"latency",ma:"max",md:"media",me:"message",mf:"manifest",mi:"mime",ml:"midroll",mm:"min",mn:"manufacturer",mo:"model",mx:"mux",ne:"newest",nm:"name",no:"number",on:"on",os:"os",pa:"paused",pb:"playback",pd:"producer",pe:"percentage",pf:"played",pg:"program",ph:"playhead",pi:"plugin",pl:"preroll",pn:"playing",po:"poster",pr:"preload",ps:"position",pt:"part",py:"property",ra:"rate",rd:"requested",re:"rebuffer",rf:"rendition",rm:"remote",ro:"ratio",rp:"response",rq:"request",rs:"requests",sa:"sample",se:"session",sk:"seek",sm:"stream",so:"source",sq:"sequence",sr:"series",st:"start",su:"startup",sv:"server",sw:"software",ta:"tag",tc:"tech",te:"text",tg:"target",th:"throughput",ti:"time",tl:"total",to:"to",tt:"title",ty:"type",ug:"upscaling",up:"upscale",ur:"url",us:"user",va:"variant",vd:"viewed",vi:"video",ve:"version",vw:"view",vr:"viewer",wd:"width",wa:"watch",wt:"waiting"},E=L(m)},function(x,p,w){"use strict";x.exports=w(16).default},function(x,p,w){"use strict";function S(y){return y&&y.__esModule?y:{default:y}}Object.defineProperty(p,"__esModule",{value:!0});var L=function(){function y(f,s){var a=[],r=!0,u=!1,o=void 0;try{for(var b,R=f[Symbol.iterator]();!(r=(b=R.next()).done)&&(a.push(b.value),!s||a.length!==s);r=!0);}catch(O){u=!0,o=O}finally{try{!r&&R.return&&R.return()}finally{if(u)throw o}}return a}return function(f,s){if(Array.isArray(f))return f;if(Symbol.iterator in Object(f))return y(f,s);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=w(0),A=S(k),D=w(8),_=w(4),d=S(_),g=w(9),T=S(g),m=w(1),E=S(m),l=w(19),t=S(l),e=w(45),i=S(e),c=w(46),n=S(c),h={},v=function y(f){var s=arguments;typeof f=="string"?y.hasOwnProperty(f)?A.default.setTimeout(function(){s=Array.prototype.splice.call(s,1),y[f].apply(null,s)},0):d.default.warn("`"+f+"` is an unknown task"):typeof f=="function"?A.default.setTimeout(function(){f(y)},0):d.default.warn("`"+f+"` is invalid.")};v.loaded=E.default.now(),v.NAME="mux-embed",v.VERSION="4.3.0",v.API_VERSION="2.1",v.PLAYER_TRACKED=!1,v.monitor=function(y,f){return(0,i.default)(v,y,f)},v.destroyMonitor=function(y){var f=(0,D.findMediaElement)(y),s=L(f,1),a=s[0];a&&a.mux&&typeof a.mux.destroy=="function"?a.mux.destroy():d.default.error("A video element monitor for `"+y+"` has not been initialized via `mux.monitor`.")},v.addHLSJS=function(y,f){var s=(0,D.getMuxPlayerId)(y);h[s]?h[s].addHLSJS(f):d.default.error("A monitor for `"+s+"` has not been initialized.")},v.addDashJS=function(y,f){var s=(0,D.getMuxPlayerId)(y);h[s]?h[s].addDashJS(f):d.default.error("A monitor for `"+s+"` has not been initialized.")},v.removeHLSJS=function(y){var f=(0,D.getMuxPlayerId)(y);h[f]?h[f].removeHLSJS():d.default.error("A monitor for `"+f+"` has not been initialized.")},v.removeDashJS=function(y){var f=(0,D.getMuxPlayerId)(y);h[f]?h[f].removeDashJS():d.default.error("A monitor for `"+f+"` has not been initialized.")},v.init=function(y,f){(0,T.default)()&&f&&f.respectDoNotTrack&&d.default.info("The browser's Do Not Track flag is enabled - Mux beaconing is disabled.");var s=(0,D.getMuxPlayerId)(y);h[s]=new t.default(v,s,f)},v.emit=function(y,f,s){var a=(0,D.getMuxPlayerId)(y);h[a]?(h[a].emit(f,s),f==="destroy"&&delete h[a]):d.default.error("A monitor for `"+a+"` has not been initialized.")},A.default!==void 0&&typeof A.default.addEventListener=="function"&&A.default.addEventListener("unload",function(){v.WINDOW_UNLOADING=!0},!1),v.checkDoNotTrack=T.default,v.log=d.default,v.utils=n.default,p.default=v},function(x,p){var w;w=function(){return this}();try{w=w||Function("return this")()||(0,eval)("this")}catch{typeof window=="object"&&(w=window)}x.exports=w},function(x,p,w){var S,L;(function(k,A){"use strict";S=A,(L=typeof S=="function"?S.call(p,w,p,x):S)!==void 0&&(x.exports=L)})(0,function(){"use strict";function k(n,h){var v=n[h];if(typeof v.bind=="function")return v.bind(n);try{return Function.prototype.bind.call(v,n)}catch{return function(){return Function.prototype.apply.apply(v,[n,arguments])}}}function A(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function D(n){return n==="debug"&&(n="log"),typeof console!==E&&(n==="trace"&&l?A:console[n]!==void 0?k(console,n):console.log!==void 0?k(console,"log"):m)}function _(n,h){for(var v=0;v<t.length;v++){var y=t[v];this[y]=v<n?m:this.methodFactory(y,n,h)}this.log=this.debug}function d(n,h,v){return function(){typeof console!==E&&(_.call(this,h,v),this[n].apply(this,arguments))}}function g(n,h,v){return D(n)||d.apply(this,arguments)}function T(n,h,v){function y(o){var b=(t[o]||"silent").toUpperCase();if(typeof window!==E&&r){try{return void(window.localStorage[r]=b)}catch{}try{window.document.cookie=encodeURIComponent(r)+"="+b+";"}catch{}}}function f(){var o;if(typeof window!==E&&r){try{o=window.localStorage[r]}catch{}if(typeof o===E)try{var b=window.document.cookie,R=b.indexOf(encodeURIComponent(r)+"=");R!==-1&&(o=/^([^;]+)/.exec(b.slice(R))[1])}catch{}return a.levels[o]===void 0&&(o=void 0),o}}var s,a=this,r="loglevel";typeof n=="string"?r+=":"+n:typeof n=="symbol"&&(r=void 0),a.name=n,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=v||g,a.getLevel=function(){return s},a.setLevel=function(o,b){if(typeof o=="string"&&a.levels[o.toUpperCase()]!==void 0&&(o=a.levels[o.toUpperCase()]),!(typeof o=="number"&&o>=0&&o<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+o;if(s=o,b!==!1&&y(o),_.call(a,o,n),typeof console===E&&o<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(o){f()||a.setLevel(o,!1)},a.enableAll=function(o){a.setLevel(a.levels.TRACE,o)},a.disableAll=function(o){a.setLevel(a.levels.SILENT,o)};var u=f();u==null&&(u=h==null?"WARN":h),a.setLevel(u,!1)}var m=function(){},E="undefined",l=typeof window!==E&&typeof window.navigator!==E&&/Trident\/|MSIE /.test(window.navigator.userAgent),t=["trace","debug","info","warn","error"],e=new T,i={};e.getLogger=function(n){if(typeof n!="symbol"&&typeof n!="string"||n==="")throw new TypeError("You must supply a name when creating a logger.");var h=i[n];return h||(h=i[n]=new T(n,e.getLevel(),e.methodFactory)),h};var c=typeof window!==E?window.log:void 0;return e.noConflict=function(){return typeof window!==E&&window.log===e&&(window.log=c),e},e.getLoggers=function(){return i},e.default=e,e})},function(x,p,w){"use strict";function S(z){return z&&z.__esModule?z:{default:z}}Object.defineProperty(p,"__esModule",{value:!0});var L=function(){function z(X,Y){var it=[],st=!0,ot=!1,ht=void 0;try{for(var at,ut=X[Symbol.iterator]();!(st=(at=ut.next()).done)&&(it.push(at.value),!Y||it.length!==Y);st=!0);}catch(rt){ot=!0,ht=rt}finally{try{!st&&ut.return&&ut.return()}finally{if(ot)throw ht}}return it}return function(X,Y){if(Array.isArray(X))return X;if(Symbol.iterator in Object(X))return z(X,Y);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=w(4),A=S(k),D=w(2),_=S(D),d=w(6),g=w(5),T=w(0),m=S(T),E=w(10),l=S(E),t=w(3),e=S(t),i=w(20),c=w(21),n=w(22),h=S(n),v=w(23),y=S(v),f=w(24),s=S(f),a=w(25),r=S(a),u=w(26),o=S(u),b=w(27),R=S(b),O=w(28),C=S(O),I=w(29),F=S(I),M=w(30),P=S(M),N=w(31),U=S(N),B=w(32),G=S(B),q=w(33),K=S(q),W=w(34),V=S(W),J=w(35),Q=S(J),tt=w(44),lt=S(tt),et=["viewstart","ended","loadstart","pause","play","playing","ratechange","waiting","adplay","adpause","adended","aderror","adplaying","adrequest","adresponse","adbreakstart","adbreakend","adfirstquartile","admidpoint","adthirdquartile","rebufferstart","rebufferend","seeked","error","hb","requestcompleted","requestfailed","requestcanceled","renditionchange"],$=function(z,X,Y){var it=this;this.DOM_CONTENT_LOADED_EVENT_END=l.default.domContentLoadedEventEnd(),this.NAVIGATION_START=l.default.navigationStart();var st={debug:!1,minimumRebufferDuration:250,sustainedRebufferThreshold:1e3,playbackHeartbeatTime:25,beaconDomain:"litix.io",sampleRate:1,disableCookies:!1,respectDoNotTrack:!1,disableRebufferTracking:!1,errorTranslator:function(rt){return rt}};this.mux=z,this.id=X,Y=(0,_.default)(st,Y),Y.data=Y.data||{},Y.data.property_key&&(Y.data.env_key=Y.data.property_key,delete Y.data.property_key),A.default.setLevel(Y.debug?"debug":"warn"),this.getPlayheadTime=Y.getPlayheadTime,this.getStateData=Y.getStateData||function(){},this.getAdData=Y.getAdData||function(){},this.minimumRebufferDuration=Y.minimumRebufferDuration,this.sustainedRebufferThreshold=Y.sustainedRebufferThreshold,this.playbackHeartbeatTime=Y.playbackHeartbeatTime,this.disableRebufferTracking=Y.disableRebufferTracking,this.disableRebufferTracking&&this.mux.log.warn("Disabling rebuffer tracking. This should only be used in specific circumstances as a last resort when your player is known to unreliably track rebuffering."),this.errorTranslator=Y.errorTranslator,this.playbackEventDispatcher=new Q.default(z,Y.data.env_key,Y),this.data={player_instance_id:(0,d.generateUUID)(),mux_sample_rate:Y.sampleRate,beacon_domain:Y.beaconDomain},this.data.view_sequence_number=1,this.data.player_sequence_number=1,this.oldEmit=this.emit,this.emit=function(rt,nt){nt=(0,_.default)({viewer_time:this.mux.utils.now()},nt),this.oldEmit(rt,nt)};var ot=function(){this.data.view_start===void 0&&(this.data.view_start=this.mux.utils.now(),this.emit("viewstart"))}.bind(this);this.on("viewinit",function(rt,nt){this._resetVideoData(),this._resetViewData(),this._resetErrorData(),this._updateStateData(),(0,_.default)(this.data,nt),this._initializeViewData(),this.one("play",ot),this.one("adbreakstart",ot)});var ht=function(rt){this.emit("viewend"),this.send("viewend"),this.emit("viewinit",rt)}.bind(this);this.on("videochange",function(rt,nt){ht(nt)}),this.on("programchange",function(rt,nt){this.data.player_is_paused&&this.mux.log.warn("The `programchange` event is intended to be used when the content changes mid playback without the video source changing, however the video is not currently playing. If the video source is changing please use the videochange event otherwise you will lose startup time information."),ht((0,_.default)(nt,{view_program_changed:!0})),ot(),this.emit("play"),this.emit("playing")}),this.on("fragmentchange",function(rt,nt){this.currentFragmentPDT=nt.currentFragmentPDT,this.currentFragmentStart=nt.currentFragmentStart}),this.on("destroy",this.destroy);var at=this.destroy.bind(this);m.default!==void 0&&typeof m.default.addEventListener=="function"&&m.default.addEventListener("unload",at,!1),this.on("destroy",function(){m.default!==void 0&&typeof m.default.removeEventListener=="function"&&m.default.removeEventListener("unload",at)}),this.on("playerready",function(rt,nt){(0,_.default)(this.data,nt)}),et.forEach(function(rt){it.on(rt,function(nt,pt){rt.indexOf("ad")!==0&&this._updateStateData(),(0,_.default)(this.data,pt),this._sanitizeData()}),it.on("after"+rt,function(){(rt!=="error"||this.viewErrored)&&this.send(rt)})}),this.on("viewend",function(rt,nt){(0,_.default)(it.data,nt)});var ut=function(rt){var nt=this.mux.utils.now();this.data.player_init_time&&(this.data.player_startup_time=nt-this.data.player_init_time),!this.mux.PLAYER_TRACKED&&this.NAVIGATION_START&&(this.mux.PLAYER_TRACKED=!0,(this.data.player_init_time||this.DOM_CONTENT_LOADED_EVENT_END)&&(this.data.page_load_time=Math.min(this.data.player_init_time||1/0,this.DOM_CONTENT_LOADED_EVENT_END||1/0)-this.NAVIGATION_START)),this.send("playerready"),delete this.data.player_startup_time,delete this.data.page_load_time};this.one("playerready",ut),s.default.apply(this),V.default.apply(this),U.default.apply(this),R.default.apply(this),y.default.apply(this),P.default.apply(this),r.default.apply(this),o.default.apply(this),G.default.apply(this),C.default.apply(this),F.default.apply(this),K.default.apply(this),lt.default.apply(this),Y.hlsjs&&this.addHLSJS(Y),Y.dashjs&&this.addDashJS(Y),this.emit("viewinit",Y.data)};(0,_.default)($.prototype,h.default.prototype),(0,_.default)($.prototype,R.default.prototype),(0,_.default)($.prototype,U.default.prototype),(0,_.default)($.prototype,y.default.prototype),(0,_.default)($.prototype,r.default.prototype),(0,_.default)($.prototype,o.default.prototype),(0,_.default)($.prototype,G.default.prototype),(0,_.default)($.prototype,C.default.prototype),(0,_.default)($.prototype,F.default.prototype),$.prototype.destroy=function(){this._destroyed||(this._destroyed=!0,this.data.view_start!==void 0&&(this.emit("viewend"),this.send("viewend")),this.playbackEventDispatcher.destroy(),this.removeHLSJS(),this.removeDashJS(),m.default.clearTimeout(this._heartBeatTimeout))},$.prototype.send=function(z){var X=(0,_.default)({},this.data);if(X.player_error_code===1&&(delete X.player_error_code,delete X.player_error_message),X.player_source_duration===1/0||X.video_source_duration===1/0?X.video_source_is_live=!0:(X.player_source_duration>0||X.video_source_duration>0)&&(X.video_source_is_live=!1),X.video_source_url=X.video_source_url||X.player_source_url,X.video_source_url){var Y=(0,g.extractHostnameAndDomain)(X.video_source_url),it=L(Y,2),st=it[0],ot=it[1];X.video_source_domain=ot,X.video_source_hostname=st}delete X.ad_request_id,this.playbackEventDispatcher.send(z,X),this.data.view_sequence_number++,this.data.player_sequence_number++,this._restartHeartBeat()},$.prototype._updateStateData=function(){(0,_.default)(this.data,this.getStateData()),this._updatePlayheadTime(),this._sanitizeData()},$.prototype._sanitizeData=function(){var z=this;["player_width","player_height","video_source_width","video_source_height","player_playhead_time","video_source_bitrate"].forEach(function(X){var Y=parseInt(z.data[X],10);z.data[X]=isNaN(Y)?void 0:Y}),["player_source_url","video_source_url"].forEach(function(X){if(z.data[X]){var Y=z.data[X].toLowerCase();Y.indexOf("data:")!==0&&Y.indexOf("blob:")!==0||(z.data[X]="MSE style URL")}})},$.prototype._resetVideoData=function(z,X){var Y=this;Object.keys(this.data).forEach(function(it){it.indexOf("video_")===0&&delete Y.data[it]})},$.prototype._resetViewData=function(){var z=this;Object.keys(this.data).forEach(function(X){X.indexOf("view_")===0&&delete z.data[X]}),this.data.view_sequence_number=1},$.prototype._resetErrorData=function(z,X){delete this.data.player_error_code,delete this.data.player_error_message},$.prototype._initializeViewData=function(){var z=this,X=this.data.view_id=(0,d.generateUUID)(),Y=function(){X===z.data.view_id&&(0,e.default)(z.data,"player_view_count",1)};this.data.player_is_paused?this.one("play",Y):Y()},$.prototype._restartHeartBeat=function(){var z=this;m.default.clearTimeout(this._heartBeatTimeout),this.viewErrored||(this._heartBeatTimeout=m.default.setTimeout(function(){z.data.player_is_paused||z.emit("hb")},1e4))},$.prototype.addHLSJS=function(z){return z.hlsjs?this.hlsjs?void this.mux.log.warn("An instance of HLS.js is already being monitored for this player."):(this.hlsjs=z.hlsjs,void(0,i.monitorHlsJs)(this.mux,this.id,z.hlsjs,{},z.Hls||m.default.Hls)):void this.mux.log.warn("You must pass a valid hlsjs instance in order to track it.")},$.prototype.removeHLSJS=function(){this.hlsjs&&((0,i.stopMonitoringHlsJs)(this.hlsjs),this.hlsjs=void 0)},$.prototype.addDashJS=function(z){return z.dashjs?this.dashjs?void this.mux.log.warn("An instance of Dash.js is already being monitored for this player."):(this.dashjs=z.dashjs,void(0,c.monitorDashJS)(this.mux,this.id,z.dashjs)):void this.mux.log.warn("You must pass a valid dashjs instance in order to track it.")},$.prototype.removeDashJS=function(){this.dashjs&&((0,c.stopMonitoringDashJS)(this.dashjs),this.dashjs=void 0)},p.default=$},function(x,p,w){"use strict";function S(E){return E&&E.__esModule?E:{default:E}}Object.defineProperty(p,"__esModule",{value:!0}),p.stopMonitoringHlsJs=p.monitorHlsJs=void 0;var L=w(7),k=S(L),A=w(10),D=S(A),_=w(5),d=function(E){if(!E)return{};var l=D.default.navigationStart(),t=E.loading,e=t?t.start:E.trequest,i=t?t.first:E.tfirst,c=t?t.end:E.tload;return{bytesLoaded:E.total,requestStart:Math.round(l+e),responseStart:Math.round(l+i),responseEnd:Math.round(l+c)}},g=function(E){if(E&&typeof E.getAllResponseHeaders=="function")return(0,k.default)(E.getAllResponseHeaders())},T=function(E,l,t){var e=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments[4]),i=E.log,c=E.utils.secondsToMs,n=function(b){var R=parseInt(e.version),O=void 0;return R===1&&b.programDateTime!==null&&(O=b.programDateTime),R===0&&b.pdt!==null&&(O=b.pdt),O};if(!D.default.exists())return void i.warn("performance timing not supported. Not tracking HLS.js.");var h=function(b,R){return E.emit(l,b,R)},v=function(b,R){var O=R.levels,C=R.audioTracks,I=R.url,F=R.stats,M=R.networkDetails,P={},N={};O.forEach(function(W,V){P[V]={width:W.width,height:W.height,bitrate:W.bitrate,attrs:W.attrs}}),C.forEach(function(W,V){N[V]={name:W.name,language:W.lang,bitrate:W.bitrate}});var U=d(F),B=U.bytesLoaded,G=U.requestStart,q=U.responseStart,K=U.responseEnd;h("requestcompleted",{request_event_type:b,request_bytes_loaded:B,request_start:G,request_response_start:q,request_response_end:K,request_type:"manifest",request_hostname:(0,_.extractHostname)(I),request_response_headers:g(M),request_rendition_lists:{media:P,audio:N,video:{}}})};t.on(e.Events.MANIFEST_LOADED,v);var y=function(b,R){var O=R.details,C=R.level,I=R.networkDetails,F=R.stats,M=d(F),P=M.bytesLoaded,N=M.requestStart,U=M.responseStart,B=M.responseEnd,G=O.fragments[O.fragments.length-1],q=n(G)+c(G.duration);h("requestcompleted",{request_event_type:b,request_bytes_loaded:P,request_start:N,request_response_start:U,request_response_end:B,request_current_level:C,request_type:"manifest",request_hostname:(0,_.extractHostname)(O.url),request_response_headers:g(I),video_holdback:O.holdBack&&c(O.holdBack),video_part_holdback:O.partHoldBack&&c(O.partHoldBack),video_part_target_duration:O.partTarget&&c(O.partTarget),video_target_duration:O.targetduration&&c(O.targetduration),player_manifest_newest_program_time:isNaN(q)?void 0:q})};t.on(e.Events.LEVEL_LOADED,y);var f=function(b,R){var O=R.details,C=R.networkDetails,I=R.stats,F=d(I),M=F.bytesLoaded,P=F.requestStart,N=F.responseStart,U=F.responseEnd;h("requestcompleted",{request_event_type:b,request_bytes_loaded:M,request_start:P,request_response_start:N,request_response_end:U,request_type:"manifest",request_hostname:(0,_.extractHostname)(O.url),request_response_headers:g(C)})};t.on(e.Events.AUDIO_TRACK_LOADED,f);var s=function(b,R){var O=R.stats,C=R.networkDetails,I=R.frag,F=d(O),M=F.bytesLoaded,P=F.requestStart,N=F.responseStart,U=F.responseEnd,B={request_event_type:b,request_bytes_loaded:M,request_start:P,request_response_start:N,request_response_end:U,request_hostname:C?(0,_.extractHostname)(C.responseURL):void 0,request_response_headers:g(C),request_media_duration:I.duration};I.type==="main"?(B.request_type="media",B.request_current_level=I.level,B.request_video_width=(t.levels[I.level]||{}).width,B.request_video_height=(t.levels[I.level]||{}).height):B.request_type=I.type,h("requestcompleted",B)};t.on(e.Events.FRAG_LOADED,s);var a=function(b,R){var O=R.frag,C=O.start,I=n(O),F={currentFragmentPDT:I,currentFragmentStart:c(C)};h("fragmentchange",F)};t.on(e.Events.FRAG_CHANGED,a);var r=function(b,R){var O=R.details,C=R.response,I=R.context,F=R.frag;if(O===e.ErrorDetails.MANIFEST_LOAD_ERROR||O===e.ErrorDetails.MANIFEST_LOAD_TIMEOUT||O===e.ErrorDetails.FRAG_LOAD_ERROR||O===e.ErrorDetails.FRAG_LOAD_TIMEOUT||O===e.ErrorDetails.LEVEL_LOAD_ERROR||O===e.ErrorDetails.LEVEL_LOAD_TIMEOUT){var M=F&&F.url||I&&I.url||"";h("requestfailed",{request_error:O,request_url:M,request_hostname:(0,_.extractHostname)(M),request_type:O===e.ErrorDetails.FRAG_LOAD_ERROR||O===e.ErrorDetails.FRAG_LOAD_TIMEOUT?"media":"manifest",request_error_code:C&&C.code,request_error_text:C&&C.text})}};t.on(e.Events.ERROR,r);var u=function(b,R){var O=R.frag,C=O&&O._url||"";h("requestcanceled",{request_cancel:b,request_url:C,request_type:"media",request_hostname:(0,_.extractHostname)(C)})};t.on(e.Events.FRAG_LOAD_EMERGENCY_ABORTED,u);var o=function(b,R){var O=R.level,C=t.levels[O];if(C&&C.attrs&&C.attrs.BANDWIDTH){var I=C.attrs.BANDWIDTH;I?h("renditionchange",{video_source_bitrate:I,video_source_width:C.width,video_source_height:C.height}):i.warn("missing BANDWIDTH from HLS manifest parsed by HLS.js")}};t.on(e.Events.LEVEL_SWITCHED,o),t._stopMuxMonitor=function(){t.off(e.Events.MANIFEST_LOADED,v),t.off(e.Events.LEVEL_LOADED,y),t.off(e.Events.AUDIO_TRACK_LOADED,f),t.off(e.Events.FRAG_LOADED,s),t.off(e.Events.FRAG_CHANGED,a),t.off(e.Events.ERROR,r),t.off(e.Events.FRAG_LOAD_EMERGENCY_ABORTED,u),t.off(e.Events.LEVEL_SWITCHED,o),t.off(e.Events.DESTROYING,t._stopMuxMonitor),delete t._stopMuxMonitor},t.on(e.Events.DESTROYING,t._stopMuxMonitor)},m=function(E){E&&typeof E._stopMuxMonitor=="function"&&E._stopMuxMonitor()};p.monitorHlsJs=T,p.stopMonitoringHlsJs=m},function(x,p,w){"use strict";function S(E){return E&&E.__esModule?E:{default:E}}Object.defineProperty(p,"__esModule",{value:!0}),p.stopMonitoringDashJS=p.monitorDashJS=void 0;var L=w(0),k=S(L),A=w(7),D=S(A),_=w(5),d=function(E,l){if(!E||typeof E.getRequests!="function")return{};var t=E.getRequests({state:"executed"});if(t.length===0)return{};var e=t[t.length-1],i=(0,_.extractHostname)(e.url),c=e.bytesLoaded,n=new Date(e.requestStartDate).getTime(),h=new Date(e.firstByteDate).getTime(),v=new Date(e.requestEndDate).getTime(),y=isNaN(e.duration)?0:e.duration,f=typeof l.getMetricsFor=="function"?l.getMetricsFor(e.mediaType).HttpList:l.getDashMetrics().getHttpRequests(e.mediaType),s=void 0;return f.length>0&&(s=(0,D.default)(f[f.length-1]._responseHeaders||"")),{requestStart:n,requestResponseStart:h,requestResponseEnd:v,requestBytesLoaded:c,requestResponseHeaders:s,requestMediaDuration:y,requestHostname:i}},g=function(E,l){var t=l.getQualityFor(E),e=l.getCurrentTrackFor(E),i=e.bitrateList;return i?{currentLevel:t,renditionWidth:i[t].width||null,renditionHeight:i[t].height||null,renditionBitrate:i[t].bandwidth}:{}},T=function(E,l,t){var e=(arguments.length>3&&arguments[3]!==void 0&&arguments[3],E.log);if(!t||!t.on)return void e.warn("Invalid dash.js player reference. Monitoring blocked.");var i=function(r,u){return E.emit(l,r,u)},c=function(r){var u=r.type,o=r.data,b=o||{},R=b.url;i("requestcompleted",{request_event_type:u,request_start:0,request_response_start:0,request_response_end:0,request_bytes_loaded:-1,request_type:"manifest",request_hostname:(0,_.extractHostname)(R)})};t.on("manifestLoaded",c);var n={},h=function(r){var u=r.type,o=r.fragmentModel,b=r.chunk,R=b||{},O=R.mediaInfo,C=O||{},I=C.type,F=C.bitrateList;F=F||[];var M={};F.forEach(function(W,V){M[V]={},M[V].width=W.width,M[V].height=W.height,M[V].bitrate=W.bandwidth,M[V].attrs={}}),I==="video"?n.video=M:I==="audio"?n.audio=M:n.media=M;var P=d(o,t),N=P.requestStart,U=P.requestResponseStart,B=P.requestResponseEnd,G=P.requestResponseHeaders,q=P.requestMediaDuration,K=P.requestHostname;i("requestcompleted",{request_event_type:u,request_start:N,request_response_start:U,request_response_end:B,request_bytes_loaded:-1,request_type:I+"_init",request_response_headers:G,request_hostname:K,request_media_duration:q,request_rendition_lists:n})};t.on("initFragmentLoaded",h);var v=function(r){var u=r.type,o=r.fragmentModel,b=r.chunk,R=b||{},O=R.mediaInfo,C=R.start,I=O||{},F=I.type,M=d(o,t),P=M.requestStart,N=M.requestResponseStart,U=M.requestResponseEnd,B=M.requestBytesLoaded,G=M.requestResponseHeaders,q=M.requestMediaDuration,K=M.requestHostname,W=g(F,t),V=W.currentLevel,J=W.renditionWidth,Q=W.renditionHeight,tt=W.renditionBitrate;i("requestcompleted",{request_event_type:u,request_start:P,request_response_start:N,request_response_end:U,request_bytes_loaded:B,request_type:F,request_response_headers:G,request_hostname:K,request_media_start_time:C,request_media_duration:q,request_current_level:V,request_labeled_bitrate:tt,request_video_width:J,request_video_height:Q})};t.on("mediaFragmentLoaded",v);var y={video:void 0,audio:void 0,totalBitrate:void 0},f=function(){if(y.video&&typeof y.video.bitrate=="number"){if(!y.video.width||!y.video.height)return void e.warn("have bitrate info for video but missing width/height");var r=y.video.bitrate;return y.audio&&typeof y.audio.bitrate=="number"&&(r+=y.audio.bitrate),r!==y.totalBitrate?(y.totalBitrate=r,{video_source_bitrate:r,video_source_height:y.video.height,video_source_width:y.video.width}):void 0}},s=function(r,u,o){if(typeof r.newQuality!="number")return void e.warn("missing evt.newQuality in qualityChangeRendered event",r);var b=r.mediaType;if(b==="audio"||b==="video"){var R=t.getBitrateInfoListFor(b).find(function(C){return C.qualityIndex===r.newQuality});if(!R||typeof R.bitrate!="number")return void e.warn("missing bitrate info for "+b);y[b]=R;var O=f();O&&i("renditionchange",O)}};t.on("qualityChangeRendered",s);var a=function(r){var u=r.error,o=r.event;o=o||{};var b=o.request||{},R=k.default.event&&k.default.event.currentTarget||{};i("requestfailed",{request_error:u+"_"+o.id+"_"+b.type,request_url:o.url,request_hostname:(0,_.extractHostname)(o.url),request_type:b.mediaType,request_error_code:R.status,request_error_type:R.statusText})};t.on("error",a),t._stopMuxMonitor=function(){t.off("manifestLoaded",c),t.off("initFragmentLoaded",h),t.off("mediaFragmentLoaded",v),t.off("qualityChangeRendered",s),t.off("error",a),delete t._stopMuxMonitor}},m=function(E){E&&typeof E._stopMuxMonitor=="function"&&E._stopMuxMonitor()};p.monitorDashJS=T,p.stopMonitoringDashJS=m},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=function(){},L=0;S.prototype.on=function(k,A,D){return A._eventEmitterGuid=A._eventEmitterGuid||++L,this._listeners=this._listeners||{},this._listeners[k]=this._listeners[k]||[],D&&(A=A.bind(D)),this._listeners[k].push(A),A},S.prototype.off=function(k,A){var D=this._listeners&&this._listeners[k];D&&D.forEach(function(_,d){_._eventEmitterGuid===A._eventEmitterGuid&&D.splice(d,1)})},S.prototype.one=function(k,A,D){var _=this;A._eventEmitterGuid=A._eventEmitterGuid||++L;var d=function g(){_.off(k,g),A.apply(D||this,arguments)};d._eventEmitterGuid=A._eventEmitterGuid,this.on(k,d)},S.prototype.emit=function(k,A){var D=this;if(this._listeners){A=A||{};var _=this._listeners["before*"]||[],d=this._listeners[k]||[],g=this._listeners["after"+k]||[],T=function(m,E){m=m.slice(),m.forEach(function(l){l.call(D,{type:k},E)})};T(_,A),T(d,A),T(g,A)}},p.default=S},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(0),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k=function(){this._playbackHeartbeatInterval=null,this._playheadShouldBeProgressing=!1,this.on("playing",function(){this._playheadShouldBeProgressing=!0}),this.on("play",this._startPlaybackHeartbeatInterval),this.on("playing",this._startPlaybackHeartbeatInterval),this.on("adbreakstart",this._startPlaybackHeartbeatInterval),this.on("adplay",this._startPlaybackHeartbeatInterval),this.on("adplaying",this._startPlaybackHeartbeatInterval),this.on("seeking",this._startPlaybackHeartbeatInterval),this.on("devicewake",this._startPlaybackHeartbeatInterval),this.on("viewstart",this._startPlaybackHeartbeatInterval),this.on("pause",this._stopPlaybackHeartbeatInterval),this.on("ended",this._stopPlaybackHeartbeatInterval),this.on("viewend",this._stopPlaybackHeartbeatInterval),this.on("error",this._stopPlaybackHeartbeatInterval),this.on("aderror",this._stopPlaybackHeartbeatInterval),this.on("adpause",this._stopPlaybackHeartbeatInterval),this.on("adended",this._stopPlaybackHeartbeatInterval),this.on("adbreakend",this._stopPlaybackHeartbeatInterval),this.on("seeked",function(){this.data.player_is_paused?this._stopPlaybackHeartbeatInterval():this._startPlaybackHeartbeatInterval()}),this.on("timeupdate",function(){this._playbackHeartbeatInterval!==null&&this.emit("playbackheartbeat")}),this.on("devicesleep",function(A,D){this._playbackHeartbeatInterval!==null&&(L.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend",{viewer_time:D.viewer_time}),this._playbackHeartbeatInterval=null)})};k.prototype._startPlaybackHeartbeatInterval=function(){var A=this;this._playbackHeartbeatInterval===null&&(this.emit("playbackheartbeat"),this._playbackHeartbeatInterval=L.default.setInterval(function(){A.emit("playbackheartbeat")},this.playbackHeartbeatTime))},k.prototype._stopPlaybackHeartbeatInterval=function(){this._playheadShouldBeProgressing=!1,this._playbackHeartbeatInterval!==null&&(L.default.clearInterval(this._playbackHeartbeatInterval),this.emit("playbackheartbeatend"),this._playbackHeartbeatInterval=null)},p.default=k},function(x,p,w){"use strict";function S(){var L=this;this.on("viewinit",function(){L.viewErrored=!1}),this.on("error",function(){try{var k=L.errorTranslator({player_error_code:L.data.player_error_code,player_error_message:L.data.player_error_message});k?(L.data.player_error_code=k.player_error_code,L.data.player_error_message=k.player_error_message,L.viewErrored=!0):(delete L.data.player_error_code,delete L.data.player_error_message)}catch(A){L.mux.log.warn("Exception in error translator callback.",A),L.viewErrored=!0}})}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(3),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k=function(){this._watchTimeTrackerLastCheckedTime=null,this.on("playbackheartbeat",this._updateWatchTime),this.on("playbackheartbeatend",this._clearWatchTimeState)};k.prototype._updateWatchTime=function(A,D){var _=D.viewer_time;this._watchTimeTrackerLastCheckedTime===null&&(this._watchTimeTrackerLastCheckedTime=_),(0,L.default)(this.data,"view_watch_time",_-this._watchTimeTrackerLastCheckedTime),this._watchTimeTrackerLastCheckedTime=_},k.prototype._clearWatchTimeState=function(A,D){this._updateWatchTime(A,D),this._watchTimeTrackerLastCheckedTime=null},p.default=k},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(3),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k=function(){this._playbackTimeTrackerLastPlayheadPosition=-1,this.on("playbackheartbeat",this._updatePlaybackTime),this.on("playbackheartbeatend",this._clearPlaybackTimeState),this.on("seeking",this._clearPlaybackTimeState)};k.prototype._updatePlaybackTime=function(){var A=this.data.player_playhead_time;if(this._playbackTimeTrackerLastPlayheadPosition>=0&&A>this._playbackTimeTrackerLastPlayheadPosition){var D=A-this._playbackTimeTrackerLastPlayheadPosition;D<=1e3&&(0,L.default)(this.data,"view_content_playback_time",D)}this._playbackTimeTrackerLastPlayheadPosition=A},k.prototype._clearPlaybackTimeState=function(){this._updatePlaybackTime(),this._playbackTimeTrackerLastPlayheadPosition=-1},p.default=k},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=function(){this.on("playbackheartbeat",this._updatePlayheadTime),this.on("playbackheartbeatend",this._updatePlayheadTime),this.on("timeupdate",this._updatePlayheadTime),this.on("destroy",function(){this.off("timeupdate",this._updatePlayheadTime)})};S.prototype._updateMaxPlayheadPosition=function(){this.data.view_max_playhead_position=this.data.view_max_playhead_position===void 0?this.data.player_playhead_time:Math.max(this.data.view_max_playhead_position,this.data.player_playhead_time)},S.prototype._updatePlayheadTime=function(L,k){if(k&&k.player_playhead_time)this.data.player_playhead_time=k.player_playhead_time,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+k.player_playhead_time-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition();else if(this.getPlayheadTime){var A=this.getPlayheadTime();A!==void 0&&(this.data.player_playhead_time=A,this.data.player_program_time=this.currentFragmentPDT&&this.currentFragmentStart?this.currentFragmentPDT+A-this.currentFragmentStart:void 0,this._updateMaxPlayheadPosition())}},p.default=S},function(x,p,w){"use strict";function S(d){return d&&d.__esModule?d:{default:d}}Object.defineProperty(p,"__esModule",{value:!0});var L=w(1),k=S(L),A=w(3),D=S(A),_=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null,this.on("playbackheartbeat",this._checkIfRebuffering),this.on("playbackheartbeatend",this._cleanupRebufferTracker),this.on("seeking",function(){this._cleanupRebufferTracker(null,{viewer_time:k.default.now()})})};_.prototype._checkIfRebuffering=function(d,g){if(!this.disableRebufferTracking){if(this.isSeeking||this.isAdBreak||!this._playheadShouldBeProgressing)return void this._cleanupRebufferTracker(d,g);if(this._lastCheckedTime===null)return this._prepareRebufferTrackerState(g.viewer_time),void this._updateRebufferMetrics();if(this._lastPlayheadTime!==this.data.player_playhead_time)return void this._cleanupRebufferTracker(d,g,!0);var T=g.viewer_time-this._lastPlayheadTimeUpdatedTime;T>=this.sustainedRebufferThreshold&&(this._rebuffering?this._updateRebufferMetrics(g.viewer_time-this._lastCheckedTime):(this._rebuffering=!0,(0,D.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(T),this.emit("rebufferstart"))),this._lastCheckedTime=g.viewer_time}},_.prototype._clearRebufferTrackerState=function(){this._lastCheckedTime=null,this._lastPlayheadTime=null,this._lastPlayheadTimeUpdatedTime=null},_.prototype._prepareRebufferTrackerState=function(d){this._lastCheckedTime=d,this._lastPlayheadTime=this.data.player_playhead_time,this._lastPlayheadTimeUpdatedTime=d},_.prototype._cleanupRebufferTracker=function(d,g){var T=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.disableRebufferTracking){if(this._rebuffering)this._rebuffering=!1,this._updateRebufferMetrics(g.viewer_time-this._lastCheckedTime),this.emit("rebufferend",{viewer_time:g.viewer_time});else{if(this._lastCheckedTime===null)return void this._updateRebufferMetrics();var m=this.data.player_playhead_time-this._lastPlayheadTime,E=g.viewer_time-this._lastPlayheadTimeUpdatedTime;m>0&&E-m>this.minimumRebufferDuration?((0,D.default)(this.data,"view_rebuffer_count",1),this._updateRebufferMetrics(E-m),this.emit("rebufferstart",{viewer_time:this._lastPlayheadTimeUpdatedTime}),this.emit("rebufferend",{viewer_time:this._lastPlayheadTimeUpdatedTime+E-m})):this._updateRebufferMetrics()}T?this._prepareRebufferTrackerState(g.viewer_time):this._clearRebufferTrackerState()}},_.prototype._updateRebufferMetrics=function(d){d>0&&(0,D.default)(this.data,"view_rebuffer_duration",d),this.data.view_watch_time>=0&&this.data.view_rebuffer_count>0&&(this.data.view_rebuffer_frequency=this.data.view_rebuffer_count/this.data.view_watch_time,this.data.view_rebuffer_percentage=this.data.view_rebuffer_duration/this.data.view_watch_time)},p.default=_},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(1),L=function(A){return A&&A.__esModule?A:{default:A}}(S),k=function(){this.on("viewinit",function(){var A=this.data,D=A.view_id;if(!A.view_program_changed){var _=function(d,g){var T=g.viewer_time;d.type==="playing"&&this.data.view_time_to_first_frame===void 0?this.calculateTimeToFirstFrame(T||L.default.now(),D):d.type!=="adplaying"||this.data.view_time_to_first_frame!==void 0&&!this.inPrerollPosition()||this.calculateTimeToFirstFrame(T||L.default.now(),D)};this.one("playing",_),this.one("adplaying",_),this.one("viewend",function(){this.off("playing",_),this.off("adplaying",_)})}})};k.prototype.calculateTimeToFirstFrame=function(A,D){D===this.data.view_id&&(this._updateWatchTime(null,{viewer_time:A}),this.data.view_time_to_first_frame=this.data.view_watch_time,(this.data.player_autoplay_on||this.data.video_is_autoplay)&&this.NAVIGATION_START&&(this.data.view_aggregate_startup_time=this.data.view_start+this.data.view_watch_time-this.NAVIGATION_START))},p.default=k},function(x,p,w){"use strict";function S(){var A=this;this.on("viewinit",function(){this._lastPlayheadPosition=-1});var D=["pause","rebufferstart","seeking","error","adbreakstart","hb"],_=["playing","hb"];D.forEach(function(d){A.on(d,function(){if(this._lastPlayheadPosition>=0&&this.data.player_playhead_time>=0&&this._lastPlayerWidth>=0&&this._lastSourceWidth>0&&this._lastPlayerHeight>=0&&this._lastSourceHeight>0){var g=this.data.player_playhead_time-this._lastPlayheadPosition;if(g<0)return void(this._lastPlayheadPosition=-1);var T=Math.min(this._lastPlayerWidth/this._lastSourceWidth,this._lastPlayerHeight/this._lastSourceHeight),m=Math.max(0,T-1),E=Math.max(0,1-T);this.data.view_max_upscale_percentage=Math.max(this.data.view_max_upscale_percentage||0,m),this.data.view_max_downscale_percentage=Math.max(this.data.view_max_downscale_percentage||0,E),(0,k.default)(this.data,"view_total_content_playback_time",g),(0,k.default)(this.data,"view_total_upscaling",m*g),(0,k.default)(this.data,"view_total_downscaling",E*g)}this._lastPlayheadPosition=-1})}),_.forEach(function(d){A.on(d,function(){this._lastPlayheadPosition=this.data.player_playhead_time,this._lastPlayerWidth=this.data.player_width,this._lastPlayerHeight=this.data.player_height,this._lastSourceWidth=this.data.video_source_width,this._lastSourceHeight=this.data.video_source_height})})}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S;var L=w(3),k=function(A){return A&&A.__esModule?A:{default:A}}(L)},function(x,p,w){"use strict";function S(T){return T&&T.__esModule?T:{default:T}}function L(){this.isSeeking=!1,this.on("seeking",function(T,m){(0,g.default)(this.data,m),this._lastSeekingTime=A.default.now(),this.isSeeking===!1&&(this.isSeeking=!0,this.send("seeking"))}),this.on("seeked",function(){this.isSeeking=!1;var T=this._lastSeekingTime||A.default.now(),m=A.default.now()-T;(0,_.default)(this.data,"view_seek_count",1),(0,_.default)(this.data,"view_seek_duration",m);var E=this.data.view_max_seek_time||0;this.data.view_max_seek_time=Math.max(E,m)}),this.on("viewend",function(){this.isSeeking=!1})}Object.defineProperty(p,"__esModule",{value:!0}),p.default=L;var k=w(1),A=S(k),D=w(3),_=S(D),d=w(2),g=S(d)},function(x,p,w){"use strict";function S(E){return E&&E.__esModule?E:{default:E}}Object.defineProperty(p,"__esModule",{value:!0});var L=function(){function E(l,t){var e=[],i=!0,c=!1,n=void 0;try{for(var h,v=l[Symbol.iterator]();!(i=(h=v.next()).done)&&(e.push(h.value),!t||e.length!==t);i=!0);}catch(y){c=!0,n=y}finally{try{!i&&v.return&&v.return()}finally{if(c)throw n}}return e}return function(l,t){if(Array.isArray(l))return l;if(Symbol.iterator in Object(l))return E(l,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),k=w(3),A=S(k),D=w(5),_=w(2),d=S(_),g=function(E,l){E.push(l),E.sort(function(t,e){return t.viewer_time-e.viewer_time})},T=["adbreakstart","adrequest","adresponse","adplay","adplaying","adpause","adended","adbreakend","aderror"],m=function(){var E=this;this.on("viewinit",function(){this.isAdBreak=!1,this._currentAdRequestNumber=0,this._currentAdResponseNumber=0,this._adRequests=[],this._adResponses=[],this._adHasPlayed=!1,this._wouldBeNewAdPlay=!0,this._prerollPlayTime=void 0}),T.forEach(function(t){return E.on(t,E._updateAdData)});var l=function(){E.isAdBreak=!1};this.on("adbreakstart",function(){this.isAdBreak=!0}),this.on("play",l),this.on("playing",l),this.on("viewend",l),this.on("adrequest",function(t,e){e=(0,d.default)({ad_request_id:"generatedAdRequestId"+this._currentAdRequestNumber++},e),g(this._adRequests,e),(0,A.default)(this.data,"view_ad_request_count"),this.inPrerollPosition()&&(this.data.view_preroll_requested=!0,this._adHasPlayed||(0,A.default)(this.data,"view_preroll_request_count"))}),this.on("adresponse",function(t,e){e=(0,d.default)({ad_request_id:"generatedAdRequestId"+this._currentAdResponseNumber++},e),g(this._adResponses,e);var i=this.findAdRequest(e.ad_request_id);i&&(0,A.default)(this.data,"view_ad_request_time",Math.max(0,e.viewer_time-i.viewer_time))}),this.on("adplay",function(t,e){this._adHasPlayed=!0,this._wouldBeNewAdPlay&&(this._wouldBeNewAdPlay=!1,(0,A.default)(this.data,"view_ad_played_count")),this.inPrerollPosition()&&!this.data.view_preroll_played&&(this.data.view_preroll_played=!0,this._adRequests.length>0&&(this.data.view_preroll_request_time=Math.max(0,e.viewer_time-this._adRequests[0].viewer_time)),this.data.view_start&&(this.data.view_startup_preroll_request_time=Math.max(0,e.viewer_time-this.data.view_start)),this._prerollPlayTime=e.viewer_time)}),this.on("adplaying",function(t,e){this.inPrerollPosition()&&this.data.view_preroll_load_time===void 0&&this._prerollPlayTime!==void 0&&(this.data.view_preroll_load_time=e.viewer_time-this._prerollPlayTime,this.data.view_startup_preroll_load_time=e.viewer_time-this._prerollPlayTime)}),this.on("adended",function(){this._wouldBeNewAdPlay=!0}),this.on("aderror",function(){this._wouldBeNewAdPlay=!0})};m.prototype.inPrerollPosition=function(){return this.data.view_content_playback_time===void 0||this.data.view_content_playback_time<=1e3},m.prototype.findAdRequest=function(E){for(var l=0;l<this._adRequests.length;l++)if(this._adRequests[l].ad_request_id===E)return this._adRequests[l]},m.prototype._updateAdData=function(E,l){if(this.inPrerollPosition()){if(!this.data.view_preroll_ad_tag_hostname&&l.ad_tag_url){var t=(0,D.extractHostnameAndDomain)(l.ad_tag_url),e=L(t,2),i=e[0],c=e[1];this.data.view_preroll_ad_tag_domain=c,this.data.view_preroll_ad_tag_hostname=i}if(!this.data.view_preroll_ad_asset_hostname&&l.ad_asset_url){var n=(0,D.extractHostnameAndDomain)(l.ad_asset_url),h=L(n,2),v=h[0],y=h[1];this.data.view_preroll_ad_asset_domain=y,this.data.view_preroll_ad_asset_hostname=v}}},p.default=m},function(x,p,w){"use strict";function S(d){return d&&d.__esModule?d:{default:d}}function L(){var d=this,g=void 0,T=void 0,m=function(){d.disableRebufferTracking||((0,_.default)(d.data,"view_waiting_rebuffer_count",1),g=A.default.now(),T=window.setInterval(function(){if(g){var i=A.default.now();(0,_.default)(d.data,"view_waiting_rebuffer_duration",i-g),g=i}},250))},E=function(){d.disableRebufferTracking||g&&((0,_.default)(d.data,"view_waiting_rebuffer_duration",A.default.now()-g),g=!1,window.clearInterval(T))},l=!1,t=function(){l=!0},e=function(){l=!1,E()};this.on("waiting",function(){l&&m()}),this.on("playing",function(){E(),t()}),this.on("pause",e),this.on("seeking",e)}Object.defineProperty(p,"__esModule",{value:!0}),p.default=L;var k=w(1),A=S(k),D=w(3),_=S(D)},function(x,p,w){"use strict";function S(T){return T&&T.__esModule?T:{default:T}}function L(){var T=this;this.one("playbackheartbeat",d),this.on("playbackheartbeatend",function(){T.off("before*",g),T.one("playbackheartbeat",d)})}Object.defineProperty(p,"__esModule",{value:!0}),p.default=L;var k=w(2),A=S(k),D=w(1),_=S(D),d=function(){this.lastWallClockTime=_.default.now(),this.on("before*",g)},g=function(T){var m=_.default.now(),E=this.lastWallClockTime;this.lastWallClockTime=m,m-E>3e4&&(this.emit("devicesleep",{viewer_time:E}),(0,A.default)(this.data,{viewer_time:E}),this.send("devicesleep"),this.emit("devicewake",{viewer_time:m}),(0,A.default)(this.data,{viewer_time:m}),this.send("devicewake"))}},function(x,p,w){"use strict";function S(u){return u&&u.__esModule?u:{default:u}}Object.defineProperty(p,"__esModule",{value:!0});var L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},k=w(0),A=S(k),D=w(36),_=w(4),d=S(_),g=w(40),T=S(g),m=w(9),E=S(m),l=w(41),t=S(l),e=w(14),i=S(e),c=w(42),n=S(c),h=w(2),v=S(h),y=["env_key","view_id","view_sequence_number","player_sequence_number","beacon_domain","player_playhead_time","viewer_time","mux_api_version","event","video_id","player_instance_id"],f=["viewstart","error","ended","viewend"],s=function(u,o){var b=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};this.mux=u,this.envKey=o,this.eventQueue=new n.default((0,T.default)(o,b.beaconDomain)),this.previousBeaconData=null,this.lastEventTime=null,this.sampleRate=b.sampleRate,this.disableCookies=b.disableCookies,this.respectDoNotTrack=b.respectDoNotTrack;var R=b.platform||{};this.pageLevelData={mux_api_version:this.mux.API_VERSION,mux_embed:this.mux.NAME,mux_embed_version:this.mux.VERSION,viewer_application_name:R.name,viewer_application_version:R.version,viewer_application_engine:R.layout,viewer_device_name:R.product,viewer_device_category:"",viewer_device_manufacturer:R.manufacturer,viewer_os_family:R.os&&R.os.family,viewer_os_architecture:R.os&&R.os.architecture,viewer_os_version:R.os&&R.os.version};var O=(0,t.default)();O&&(this.pageLevelData=(0,v.default)(this.pageLevelData,{viewer_connection_type:O})),A.default!==void 0&&A.default.location&&A.default.location.href&&(this.pageLevelData.page_url=A.default.location.href),this.viewerData=this.disableCookies?{}:(0,D.getAndUpdateViewerData)()};s.prototype.send=function(u,o){if(u){if(this.respectDoNotTrack&&(0,E.default)())return d.default.info("Not sending `"+u+"` because Do Not Track is enabled");if(!o||(o===void 0?"undefined":L(o))!=="object")return d.default.error("A data object was expected in send() but was not provided");var b=this.disableCookies?{}:(0,D.getAndUpdateSessionData)(),R={};(0,v.default)(R,this.pageLevelData),(0,v.default)(R,o),(0,v.default)(R,b),(0,v.default)(R,this.viewerData),R.event=u,R.env_key=this.envKey,R.user_id&&(R.viewer_user_id=R.user_id,delete R.user_id);var O=R.mux_sample_number>=this.sampleRate,C=this._deduplicateBeaconData(u,R),I=(0,i.default)(C);if(this.lastEventTime=this.mux.utils.now(),O)return d.default.info("Not sending event due to sample rate restriction",u,R,I);if(!this.envKey)return d.default.info("Not sending event due to missing environment key",u,R,I);if(!this.rateLimited){if(d.default.info("Sending event",u,R,I),this.rateLimited=!this.eventQueue.queueEvent(u,I),this.mux.WINDOW_UNLOADING&&u==="viewend")this.eventQueue.destroy(!0);else if(f.indexOf(u)>=0&&this.eventQueue.flushEvents(),this.rateLimited)return R.event="eventrateexceeded",I=(0,i.default)(R),this.eventQueue.queueEvent(R.event,I),d.default.error("Beaconing disabled due to rate limit.")}}},s.prototype.destroy=function(){this.eventQueue.destroy(!1)};var a=function(u,o,b,R){return!(!u||o.indexOf("request_")!==0)&&(o==="request_response_headers"||(b===void 0?"undefined":L(b))!=="object"||(R===void 0?"undefined":L(R))!=="object"||Object.keys(b||{}).length!==Object.keys(R||{}).length)},r=function(u,o){return u==="renditionchange"&&o.indexOf("video_source_")===0};s.prototype._deduplicateBeaconData=function(u,o){var b=this,R={},O=o.view_id;if(!O||u==="viewstart"||u==="viewend"||!this.previousBeaconData||this.mux.utils.now()-this.lastEventTime>=6e5)R=(0,v.default)({},o),O&&(this.previousBeaconData=R),O&&u==="viewend"&&(this.previousBeaconData=null);else{var C=u.indexOf("request")===0;Object.keys(o).forEach(function(I){var F=o[I];(F!==b.previousBeaconData[I]||y.indexOf(I)>-1||a(C,I,F,b.previousBeaconData[I])||r(u,I))&&(R[I]=F,b.previousBeaconData[I]=F)})}return R},p.default=s},function(x,p,w){"use strict";function S(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(p,"__esModule",{value:!0}),p.getAndUpdateSessionData=p.getAndUpdateViewerData=void 0;var L=w(11),k=S(L),A=w(39),D=S(A),_=w(6),d=w(1),g=S(d),T=function(){var t=void 0;try{t=k.default.parse(D.default.get("muxData")||"")}catch{t={}}return t},m=function(t){try{D.default.set("muxData",k.default.stringify(t),{expires:7300})}catch{}},E=function(){var t=T();return t.mux_viewer_id=t.mux_viewer_id||(0,_.generateUUID)(),t.msn=t.msn||Math.random(),m(t),{mux_viewer_id:t.mux_viewer_id,mux_sample_number:t.msn}},l=function(){var t=T(),e=g.default.now();return t.session_start&&(t.sst=t.session_start,delete t.session_start),t.session_id&&(t.sid=t.session_id,delete t.session_id),t.session_expires&&(t.sex=t.session_expires,delete t.session_expires),(!t.sex||t.sex<e)&&(t.sid=(0,_.generateUUID)(),t.sst=e),t.sex=e+15e5,m(t),{session_id:t.sid,session_start:t.sst,session_expires:t.sex}};p.getAndUpdateViewerData=E,p.getAndUpdateSessionData=l},function(x,p,w){"use strict";var S=w(12),L=w(13),k={brackets:function(d){return d+"[]"},indices:function(d,g){return d+"["+g+"]"},repeat:function(d){return d}},A=Date.prototype.toISOString,D={delimiter:"&",encode:!0,encoder:S.encode,encodeValuesOnly:!1,serializeDate:function(d){return A.call(d)},skipNulls:!1,strictNullHandling:!1},_=function d(g,T,m,E,l,t,e,i,c,n,h,v){var y=g;if(typeof e=="function")y=e(T,y);else if(y instanceof Date)y=n(y);else if(y===null){if(E)return t&&!v?t(T,D.encoder):T;y=""}if(typeof y=="string"||typeof y=="number"||typeof y=="boolean"||S.isBuffer(y))return t?[h(v?T:t(T,D.encoder))+"="+h(t(y,D.encoder))]:[h(T)+"="+h(String(y))];var f=[];if(y===void 0)return f;var s;if(Array.isArray(e))s=e;else{var a=Object.keys(y);s=i?a.sort(i):a}for(var r=0;r<s.length;++r){var u=s[r];l&&y[u]===null||(f=Array.isArray(y)?f.concat(d(y[u],m(T,u),m,E,l,t,e,i,c,n,h,v)):f.concat(d(y[u],T+(c?"."+u:"["+u+"]"),m,E,l,t,e,i,c,n,h,v)))}return f};x.exports=function(d,g){var T=d,m=g?S.assign({},g):{};if(m.encoder!==null&&m.encoder!==void 0&&typeof m.encoder!="function")throw new TypeError("Encoder has to be a function.");var E=m.delimiter===void 0?D.delimiter:m.delimiter,l=typeof m.strictNullHandling=="boolean"?m.strictNullHandling:D.strictNullHandling,t=typeof m.skipNulls=="boolean"?m.skipNulls:D.skipNulls,e=typeof m.encode=="boolean"?m.encode:D.encode,i=typeof m.encoder=="function"?m.encoder:D.encoder,c=typeof m.sort=="function"?m.sort:null,n=m.allowDots!==void 0&&m.allowDots,h=typeof m.serializeDate=="function"?m.serializeDate:D.serializeDate,v=typeof m.encodeValuesOnly=="boolean"?m.encodeValuesOnly:D.encodeValuesOnly;if(m.format===void 0)m.format=L.default;else if(!Object.prototype.hasOwnProperty.call(L.formatters,m.format))throw new TypeError("Unknown format option provided.");var y,f,s=L.formatters[m.format];typeof m.filter=="function"?(f=m.filter,T=f("",T)):Array.isArray(m.filter)&&(f=m.filter,y=f);var a=[];if(typeof T!="object"||T===null)return"";var r;r=m.arrayFormat in k?m.arrayFormat:"indices"in m?m.indices?"indices":"repeat":"indices";var u=k[r];y||(y=Object.keys(T)),c&&y.sort(c);for(var o=0;o<y.length;++o){var b=y[o];t&&T[b]===null||(a=a.concat(_(T[b],b,u,l,t,e?i:null,f,c,n,h,s,v)))}var R=a.join(E),O=m.addQueryPrefix===!0?"?":"";return R.length>0?O+R:""}},function(x,p,w){"use strict";var S=w(12),L=Object.prototype.hasOwnProperty,k={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:S.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},A=function(d,g){for(var T={},m=g.ignoreQueryPrefix?d.replace(/^\?/,""):d,E=g.parameterLimit===1/0?void 0:g.parameterLimit,l=m.split(g.delimiter,E),t=0;t<l.length;++t){var e,i,c=l[t],n=c.indexOf("]="),h=n===-1?c.indexOf("="):n+1;h===-1?(e=g.decoder(c,k.decoder),i=g.strictNullHandling?null:""):(e=g.decoder(c.slice(0,h),k.decoder),i=g.decoder(c.slice(h+1),k.decoder)),L.call(T,e)?T[e]=[].concat(T[e]).concat(i):T[e]=i}return T},D=function(d,g,T){for(var m=g,E=d.length-1;E>=0;--E){var l,t=d[E];if(t==="[]")l=[],l=l.concat(m);else{l=T.plainObjects?Object.create(null):{};var e=t.charAt(0)==="["&&t.charAt(t.length-1)==="]"?t.slice(1,-1):t,i=parseInt(e,10);!isNaN(i)&&t!==e&&String(i)===e&&i>=0&&T.parseArrays&&i<=T.arrayLimit?(l=[],l[i]=m):l[e]=m}m=l}return m},_=function(d,g,T){if(d){var m=T.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,E=/(\[[^[\]]*])/,l=/(\[[^[\]]*])/g,t=E.exec(m),e=t?m.slice(0,t.index):m,i=[];if(e){if(!T.plainObjects&&L.call(Object.prototype,e)&&!T.allowPrototypes)return;i.push(e)}for(var c=0;(t=l.exec(m))!==null&&c<T.depth;){if(c+=1,!T.plainObjects&&L.call(Object.prototype,t[1].slice(1,-1))&&!T.allowPrototypes)return;i.push(t[1])}return t&&i.push("["+m.slice(t.index)+"]"),D(i,g,T)}};x.exports=function(d,g){var T=g?S.assign({},g):{};if(T.decoder!==null&&T.decoder!==void 0&&typeof T.decoder!="function")throw new TypeError("Decoder has to be a function.");if(T.ignoreQueryPrefix=T.ignoreQueryPrefix===!0,T.delimiter=typeof T.delimiter=="string"||S.isRegExp(T.delimiter)?T.delimiter:k.delimiter,T.depth=typeof T.depth=="number"?T.depth:k.depth,T.arrayLimit=typeof T.arrayLimit=="number"?T.arrayLimit:k.arrayLimit,T.parseArrays=T.parseArrays!==!1,T.decoder=typeof T.decoder=="function"?T.decoder:k.decoder,T.allowDots=typeof T.allowDots=="boolean"?T.allowDots:k.allowDots,T.plainObjects=typeof T.plainObjects=="boolean"?T.plainObjects:k.plainObjects,T.allowPrototypes=typeof T.allowPrototypes=="boolean"?T.allowPrototypes:k.allowPrototypes,T.parameterLimit=typeof T.parameterLimit=="number"?T.parameterLimit:k.parameterLimit,T.strictNullHandling=typeof T.strictNullHandling=="boolean"?T.strictNullHandling:k.strictNullHandling,d===""||d===null||d===void 0)return T.plainObjects?Object.create(null):{};for(var m=typeof d=="string"?A(d,T):d,E=T.plainObjects?Object.create(null):{},l=Object.keys(m),t=0;t<l.length;++t){var e=l[t],i=_(e,m[e],T);E=S.merge(E,i,T)}return S.compact(E)}},function(x,p,w){"use strict";var S,L,k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(A){return typeof A}:function(A){return A&&typeof Symbol=="function"&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A};(function(A){var D=!1;if(S=A,(L=typeof S=="function"?S.call(p,w,p,x):S)!==void 0&&(x.exports=L),D=!0,k(p)==="object"&&(x.exports=A(),D=!0),!D){var _=window.Cookies,d=window.Cookies=A();d.noConflict=function(){return window.Cookies=_,d}}})(function(){function A(_){function d(g,T,m){var E;if(typeof document!="undefined"){if(arguments.length>1){if(m=D({path:"/"},d.defaults,m),typeof m.expires=="number"){var l=new Date;l.setMilliseconds(l.getMilliseconds()+864e5*m.expires),m.expires=l}try{E=JSON.stringify(T),/^[\{\[]/.test(E)&&(T=E)}catch{}return T=_.write?_.write(T,g):encodeURIComponent(String(T)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),g=encodeURIComponent(String(g)),g=g.replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent),g=g.replace(/[\(\)]/g,escape),document.cookie=[g,"=",T,m.expires?"; expires="+m.expires.toUTCString():"",m.path?"; path="+m.path:"",m.domain?"; domain="+m.domain:"",m.secure?"; secure":""].join("")}g||(E={});for(var t=document.cookie?document.cookie.split("; "):[],e=/(%[0-9A-Z]{2})+/g,i=0;i<t.length;i++){var c=t[i].split("="),n=c.slice(1).join("=");n.charAt(0)==='"'&&(n=n.slice(1,-1));try{var h=c[0].replace(e,decodeURIComponent);if(n=_.read?_.read(n,h):_(n,h)||n.replace(e,decodeURIComponent),this.json)try{n=JSON.parse(n)}catch{}if(g===h){E=n;break}g||(E[h]=n)}catch{}}return E}}return d.set=d,d.get=function(g){return d.call(d,g)},d.getJSON=function(){return d.apply({json:!0},[].slice.call(arguments))},d.defaults={},d.remove=function(g,T){d(g,"",D(T,{expires:-1}))},d.withConverter=A,d}var D=function(){for(var _=0,d={};_<arguments.length;_++){var g=arguments[_];for(var T in g)d[T]=g[T]}return d};return A(function(){})})},function(x,p,w){"use strict";function S(L,k){return L=L||"",k=k||"litix.io",L.match(/^[a-z0-9]+$/)?"https://"+L+"."+k:"https://img.litix.io/a.gif"}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S},function(x,p,w){"use strict";Object.defineProperty(p,"__esModule",{value:!0});var S=w(0),L=function(D){return D&&D.__esModule?D:{default:D}}(S),k=function(){var D=void 0;switch(A()){case"cellular":D="cellular";break;case"ethernet":D="wired";break;case"wifi":D="wifi";break;case void 0:break;default:D="other"}return D},A=function(){var D=L.default.navigator,_=D&&(D.connection||D.mozConnection||D.webkitConnection);return _&&_.type};p.default=k},function(x,p,w){"use strict";function S(n){return n&&n.__esModule?n:{default:n}}Object.defineProperty(p,"__esModule",{value:!0});var L=w(0),k=S(L),A=w(4),D=S(A),_=w(43),d=S(_),g=w(2),T=S(g),m=w(14),E=S(m),l=w(1),t=S(l),e=!!k.default.XMLHttpRequest&&"withCredentials"in new k.default.XMLHttpRequest,i={maxBeaconSize:300,maxQueueLength:3600,baseTimeBetweenBeacons:5e3},c=function(n,h){this._beaconUrl=n||"https://img.litix.io",this._eventQueue=[],this._postInFlight=!1,this._failureCount=0,this._sendTimeout=!1,this._options=(0,T.default)({},i,h)};c.prototype.queueEvent=function(n,h){var v=(0,T.default)({},h);return e?(this._eventQueue.length<=this._options.maxQueueLength||n==="eventrateexceeded")&&(this._eventQueue.push(v),this._sendTimeout||this._startBeaconSending(),this._eventQueue.length<=this._options.maxQueueLength):(d.default.send(this._beaconUrl,v),!0)},c.prototype.flushEvents=function(){e&&(this._eventQueue.length&&this._sendBeaconQueue(),this._startBeaconSending())},c.prototype.destroy=function(){var n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];this.destroyed=!0,n?this._clearBeaconQueue():this.flushEvents(),k.default.clearTimeout(this._sendTimeout)},c.prototype._clearBeaconQueue=function(){var n=k.default.navigator,h=this._eventQueue.length>this._options.maxBeaconSize?this._eventQueue.length-this._options.maxBeaconSize:0,v=this._eventQueue.slice(h);h>0&&(0,T.default)(v[v.length-1],(0,E.default)({mux_view_message:"event queue truncated"}));var y=this._createPayload(v);if(n.sendBeacon)n.sendBeacon(this._beaconUrl,y);else if(k.default.XMLHttpRequest){var f=new k.default.XMLHttpRequest;f.open("POST",this._beaconUrl),f.setRequestHeader("Content-Type","application/json"),f.send(y)}else d.default.send(this._beaconUrl,v[v.length-1])},c.prototype._sendBeaconQueue=function(){var n=this;if(k.default.XMLHttpRequest&&!this._postInFlight){var h=new k.default.XMLHttpRequest,v=this._eventQueue.slice(0,this._options.maxBeaconSize);this._eventQueue=this._eventQueue.slice(this._options.maxBeaconSize),this._postInFlight=!0,h.onreadystatechange=function(){h.readyState===4&&(h.status!==200?(n._eventQueue=v.concat(n._eventQueue),n._failureCount+=1,D.default.info("Error sending beacon: "+h.status),D.default.info(h.responseText)):n._failureCount=0,n._roundTripTime=t.default.now()-f,n._postInFlight=!1)},h.open("POST",this._beaconUrl),h.setRequestHeader("Content-Type","application/json");var y=this._createPayload(v),f=t.default.now();h.send(y)}},c.prototype._getNextBeaconTime=function(){if(!this._failureCount)return this._options.baseTimeBetweenBeacons;var n=Math.pow(2,this._failureCount-1);return(1+(n*=Math.random()))*this._options.baseTimeBetweenBeacons},c.prototype._startBeaconSending=function(){var n=this;k.default.clearTimeout(this._sendTimeout),this.destroyed||(this._sendTimeout=k.default.setTimeout(function(){n._eventQueue.length&&n._sendBeaconQueue(),n._startBeaconSending()},this._getNextBeaconTime()))},c.prototype._createPayload=function(n){var h={transmission_timestamp:Math.round(t.default.now())};return this._roundTripTime&&(h.rtt_ms=Math.round(this._roundTripTime)),JSON.stringify({metadata:h,events:n})},p.default=c},function(x,p,w){"use strict";function S(d){return d&&d.__esModule?d:{default:d}}Object.defineProperty(p,"__esModule",{value:!0});var L=w(11),k=S(L),A=w(0),D=S(A),_={};_.send=function(d,g){function T(){m.src=l+(E?"&rc="+E:"")}var m=new Image,E=0,l=d+"?"+k.default.stringify(g);return m.addEventListener("error",function(){E>3||D.default.setTimeout(function(){E++,T()},5e3*E)}),T(),m},p.default=_},function(x,p,w){"use strict";function S(){function L(l,t){var e=t.request_start,i=t.request_response_start,c=t.request_response_end,n=t.request_bytes_loaded;g++;var h=void 0,v=void 0;if(i?(h=i-e,v=c-i):v=c-e,v>0&&n>0){var y=n/v*8e3;T++,_+=n,d+=v,this.data.view_min_request_throughput=Math.min(this.data.view_min_request_throughput||1/0,y),this.data.view_average_request_throughput=_/d*8e3,this.data.view_request_count=g,h>0&&(D+=h,this.data.view_max_request_latency=Math.max(this.data.view_max_request_latency||0,h),this.data.view_average_request_latency=D/T)}}function k(l,t){g++,m++,this.data.view_request_count=g,this.data.view_request_failed_count=m}function A(l,t){g++,E++,this.data.view_request_count=g,this.data.view_request_canceled_count=E}var D=0,_=0,d=0,g=0,T=0,m=0,E=0;this.on("requestcompleted",L),this.on("requestfailed",k),this.on("requestcanceled",A)}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S},function(x,p,w){"use strict";function S(T,m,E){var l=(0,_.findMediaElement)(m),t=k(l,3),e=t[0],i=t[1],c=t[2],n=T.log,h=T.utils.getComputedStyle,v=T.utils.secondsToMs,y={automaticErrorTracking:!0};if(!e)return n.error("No element was found with the `"+i+"` query selector.");if(c!=="video"&&c!=="audio")return n.error("The element of `"+i+"` was not a media element.");E=(0,D.default)(y,E),E.data=(0,D.default)({player_software:"HTML5 Video Element",player_software_version:"No Versions",player_mux_plugin_name:"VideoElementMonitor",player_mux_plugin_version:"4.3.0"},E.data),E.getPlayheadTime=function(){return v(e.currentTime)},E.getStateData=function(){var s=this.hlsjs&&this.hlsjs.url,a=this.dashjs&&L(this.dashjs.getSource==="function")&&this.dashjs.getSource();return{player_is_paused:e.paused,player_playhead_time:v(e.currentTime),player_width:parseInt(h(e,"width")),player_height:parseInt(h(e,"height")),player_autoplay_on:e.autoplay,player_preload_on:e.preload,video_poster_url:e.poster,video_source_url:s||a||e.currentSrc,video_source_duration:v(e.duration),video_source_height:e.videoHeight,video_source_width:e.videoWidth}},e.mux=e.mux||{},e.mux.deleted=!1,e.mux.emit=function(s,a){T.emit(i,s,a)};var f=function(){n.error("The monitor for this video element has already been destroyed.")};e.mux.destroy=function(){Object.keys(e.mux.listeners).forEach(function(s){e.removeEventListener(s,e.mux.listeners[s],!1)}),delete e.mux.listeners,e.mux.destroy=f,e.mux.swapElement=f,e.mux.emit=f,e.mux.addHLSJS=f,e.mux.addDashJS=f,e.mux.removeHLSJS=f,e.mux.removeDashJS=f,e.mux.deleted=!0,T.emit(i,"destroy")},e.mux.swapElement=function(s){var a=(0,_.findMediaElement)(s),r=k(a,3),u=r[0],o=r[1],b=r[2];return u?b!=="video"&&b!=="audio"?T.log.error("The element of `"+o+"` was not a media element."):(u.muxId=e.muxId,delete e.muxId,u.mux=u.mux||{},u.mux.listeners=(0,D.default)({},e.mux.listeners),delete e.mux.listeners,Object.keys(u.mux.listeners).forEach(function(R){e.removeEventListener(R,u.mux.listeners[R],!1),u.addEventListener(R,u.mux.listeners[R],!1)}),u.mux.swapElement=e.mux.swapElement,u.mux.destroy=e.mux.destroy,delete e.mux,void(e=u)):T.log.error("No element was found with the `"+o+"` query selector.")},e.mux.addHLSJS=function(s){T.addHLSJS(i,s)},e.mux.addDashJS=function(s){T.addDashJS(i,s)},e.mux.removeHLSJS=function(){T.removeHLSJS(i)},e.mux.removeDashJS=function(){T.removeDashJS(i)},T.init(i,E),T.emit(i,"playerready"),e.paused||(T.emit(i,"play"),e.readyState>2&&T.emit(i,"playing")),e.mux.listeners={},d.forEach(function(s){(s!=="error"||E.automaticErrorTracking)&&(e.mux.listeners[s]=function(){var a={};if(s==="error"){if(!e.error)return;a.player_error_code=e.error.code,a.player_error_message=g[e.error.code]||e.error.message}T.emit(i,s,a)},e.addEventListener(s,e.mux.listeners[s],!1))})}Object.defineProperty(p,"__esModule",{value:!0});var L=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},k=function(){function T(m,E){var l=[],t=!0,e=!1,i=void 0;try{for(var c,n=m[Symbol.iterator]();!(t=(c=n.next()).done)&&(l.push(c.value),!E||l.length!==E);t=!0);}catch(h){e=!0,i=h}finally{try{!t&&n.return&&n.return()}finally{if(e)throw i}}return l}return function(m,E){if(Array.isArray(m))return m;if(Symbol.iterator in Object(m))return T(m,E);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();p.default=S;var A=w(2),D=function(T){return T&&T.__esModule?T:{default:T}}(A),_=w(8),d=["loadstart","pause","play","playing","seeking","seeked","timeupdate","ratechange","stalled","waiting","error","ended"],g={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"}},function(x,p,w){"use strict";function S(h){return h&&h.__esModule?h:{default:h}}Object.defineProperty(p,"__esModule",{value:!0});var L=w(47),k=S(L),A=w(3),D=S(A),_=w(48),d=S(_),g=w(49),T=S(g),m=w(2),E=S(m),l=w(7),t=S(l),e=w(5),i=w(1),c=S(i),n={};n.safeCall=k.default,n.safeIncrement=D.default,n.getComputedStyle=d.default,n.secondsToMs=T.default,n.assign=E.default,n.headersStringToObject=t.default,n.extractHostnameAndDomain=e.extractHostnameAndDomain,n.extractHostname=e.extractHostname,n.now=c.default.now,p.default=n},function(x,p,w){"use strict";function S(A,D,_,d){var g=d;if(A&&typeof A[D]=="function")try{g=A[D].apply(A,_)}catch(T){k.default.info("safeCall error",T)}return g}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S;var L=w(4),k=function(A){return A&&A.__esModule?A:{default:A}}(L)},function(x,p,w){"use strict";function S(D,_){if(D&&_&&k.default&&typeof k.default.getComputedStyle=="function"){var d=void 0;return A&&A.has(D)&&(d=A.get(D)),d||(d=k.default.getComputedStyle(D,null),A&&A.set(D,d)),d.getPropertyValue(_)}}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S;var L=w(0),k=function(D){return D&&D.__esModule?D:{default:D}}(L),A=void 0;k.default&&k.default.WeakMap&&(A=new WeakMap)},function(x,p,w){"use strict";function S(L){return Math.floor(1e3*L)}Object.defineProperty(p,"__esModule",{value:!0}),p.default=S}])})})()}),Qt=It((H,Z)=>{typeof window!="undefined"&&function(j,x){typeof H=="object"&&typeof Z=="object"?Z.exports=x():typeof define=="function"&&define.amd?define([],x):typeof H=="object"?H.Hls=x():j.Hls=x()}(H,function(){return function(j){var x={};function p(w){if(x[w])return x[w].exports;var S=x[w]={i:w,l:!1,exports:{}};return j[w].call(S.exports,S,S.exports,p),S.l=!0,S.exports}return p.m=j,p.c=x,p.d=function(w,S,L){p.o(w,S)||Object.defineProperty(w,S,{enumerable:!0,get:L})},p.r=function(w){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(w,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(w,"__esModule",{value:!0})},p.t=function(w,S){if(S&1&&(w=p(w)),S&8||S&4&&typeof w=="object"&&w&&w.__esModule)return w;var L=Object.create(null);if(p.r(L),Object.defineProperty(L,"default",{enumerable:!0,value:w}),S&2&&typeof w!="string")for(var k in w)p.d(L,k,function(A){return w[A]}.bind(null,k));return L},p.n=function(w){var S=w&&w.__esModule?function(){return w.default}:function(){return w};return p.d(S,"a",S),S},p.o=function(w,S){return Object.prototype.hasOwnProperty.call(w,S)},p.p="/dist/",p(p.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(j,x,p){"use strict";var w=Object.prototype.hasOwnProperty,S="~";function L(){}Object.create&&(L.prototype=Object.create(null),new L().__proto__||(S=!1));function k(d,g,T){this.fn=d,this.context=g,this.once=T||!1}function A(d,g,T,m,E){if(typeof T!="function")throw new TypeError("The listener must be a function");var l=new k(T,m||d,E),t=S?S+g:g;return d._events[t]?d._events[t].fn?d._events[t]=[d._events[t],l]:d._events[t].push(l):(d._events[t]=l,d._eventsCount++),d}function D(d,g){--d._eventsCount==0?d._events=new L:delete d._events[g]}function _(){this._events=new L,this._eventsCount=0}_.prototype.eventNames=function(){var d=[],g,T;if(this._eventsCount===0)return d;for(T in g=this._events)w.call(g,T)&&d.push(S?T.slice(1):T);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(g)):d},_.prototype.listeners=function(d){var g=S?S+d:d,T=this._events[g];if(!T)return[];if(T.fn)return[T.fn];for(var m=0,E=T.length,l=new Array(E);m<E;m++)l[m]=T[m].fn;return l},_.prototype.listenerCount=function(d){var g=S?S+d:d,T=this._events[g];return T?T.fn?1:T.length:0},_.prototype.emit=function(d,g,T,m,E,l){var t=S?S+d:d;if(!this._events[t])return!1;var e=this._events[t],i=arguments.length,c,n;if(e.fn){switch(e.once&&this.removeListener(d,e.fn,void 0,!0),i){case 1:return e.fn.call(e.context),!0;case 2:return e.fn.call(e.context,g),!0;case 3:return e.fn.call(e.context,g,T),!0;case 4:return e.fn.call(e.context,g,T,m),!0;case 5:return e.fn.call(e.context,g,T,m,E),!0;case 6:return e.fn.call(e.context,g,T,m,E,l),!0}for(n=1,c=new Array(i-1);n<i;n++)c[n-1]=arguments[n];e.fn.apply(e.context,c)}else{var h=e.length,v;for(n=0;n<h;n++)switch(e[n].once&&this.removeListener(d,e[n].fn,void 0,!0),i){case 1:e[n].fn.call(e[n].context);break;case 2:e[n].fn.call(e[n].context,g);break;case 3:e[n].fn.call(e[n].context,g,T);break;case 4:e[n].fn.call(e[n].context,g,T,m);break;default:if(!c)for(v=1,c=new Array(i-1);v<i;v++)c[v-1]=arguments[v];e[n].fn.apply(e[n].context,c)}}return!0},_.prototype.on=function(d,g,T){return A(this,d,g,T,!1)},_.prototype.once=function(d,g,T){return A(this,d,g,T,!0)},_.prototype.removeListener=function(d,g,T,m){var E=S?S+d:d;if(!this._events[E])return this;if(!g)return D(this,E),this;var l=this._events[E];if(l.fn)l.fn===g&&(!m||l.once)&&(!T||l.context===T)&&D(this,E);else{for(var t=0,e=[],i=l.length;t<i;t++)(l[t].fn!==g||m&&!l[t].once||T&&l[t].context!==T)&&e.push(l[t]);e.length?this._events[E]=e.length===1?e[0]:e:D(this,E)}return this},_.prototype.removeAllListeners=function(d){var g;return d?(g=S?S+d:d,this._events[g]&&D(this,g)):(this._events=new L,this._eventsCount=0),this},_.prototype.off=_.prototype.removeListener,_.prototype.addListener=_.prototype.on,_.prefixed=S,_.EventEmitter=_,j.exports=_},"./node_modules/url-toolkit/src/url-toolkit.js":function(j,x,p){(function(w){var S=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,L=/^([^\/?#]*)([^]*)$/,k=/(?:\/|^)\.(?=\/)/g,A=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,D={buildAbsoluteURL:function(_,d,g){if(g=g||{},_=_.trim(),d=d.trim(),!d){if(!g.alwaysNormalize)return _;var T=D.parseURL(_);if(!T)throw new Error("Error trying to parse base URL.");return T.path=D.normalizePath(T.path),D.buildURLFromParts(T)}var m=D.parseURL(d);if(!m)throw new Error("Error trying to parse relative URL.");if(m.scheme)return g.alwaysNormalize?(m.path=D.normalizePath(m.path),D.buildURLFromParts(m)):d;var E=D.parseURL(_);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var l=L.exec(E.path);E.netLoc=l[1],E.path=l[2]}E.netLoc&&!E.path&&(E.path="/");var t={scheme:E.scheme,netLoc:m.netLoc,path:null,params:m.params,query:m.query,fragment:m.fragment};if(!m.netLoc&&(t.netLoc=E.netLoc,m.path[0]!=="/"))if(!m.path)t.path=E.path,m.params||(t.params=E.params,m.query||(t.query=E.query));else{var e=E.path,i=e.substring(0,e.lastIndexOf("/")+1)+m.path;t.path=D.normalizePath(i)}return t.path===null&&(t.path=g.alwaysNormalize?D.normalizePath(m.path):m.path),D.buildURLFromParts(t)},parseURL:function(_){var d=S.exec(_);return d?{scheme:d[1]||"",netLoc:d[2]||"",path:d[3]||"",params:d[4]||"",query:d[5]||"",fragment:d[6]||""}:null},normalizePath:function(_){for(_=_.split("").reverse().join("").replace(k,"");_.length!==(_=_.replace(A,"")).length;);return _.split("").reverse().join("")},buildURLFromParts:function(_){return _.scheme+_.netLoc+_.path+_.params+_.query+_.fragment}};j.exports=D})(this)},"./node_modules/webworkify-webpack/index.js":function(j,x,p){function w(g){var T={};function m(l){if(T[l])return T[l].exports;var t=T[l]={i:l,l:!1,exports:{}};return g[l].call(t.exports,t,t.exports,m),t.l=!0,t.exports}m.m=g,m.c=T,m.i=function(l){return l},m.d=function(l,t,e){m.o(l,t)||Object.defineProperty(l,t,{configurable:!1,enumerable:!0,get:e})},m.r=function(l){Object.defineProperty(l,"__esModule",{value:!0})},m.n=function(l){var t=l&&l.__esModule?function(){return l.default}:function(){return l};return m.d(t,"a",t),t},m.o=function(l,t){return Object.prototype.hasOwnProperty.call(l,t)},m.p="/",m.oe=function(l){throw console.error(l),l};var E=m(m.s=ENTRY_MODULE);return E.default||E}var S="[\\.|\\-|\\+|\\w|/|@]+",L="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+S+").*?\\)";function k(g){return(g+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function A(g){return!isNaN(1*g)}function D(g,T,m){var E={};E[m]=[];var l=T.toString(),t=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!t)return E;for(var e=t[1],i=new RegExp("(\\\\n|\\W)"+k(e)+L,"g"),c;c=i.exec(l);)c[3]!=="dll-reference"&&E[m].push(c[3]);for(i=new RegExp("\\("+k(e)+'\\("(dll-reference\\s('+S+'))"\\)\\)'+L,"g");c=i.exec(l);)g[c[2]]||(E[m].push(c[1]),g[c[2]]=p(c[1]).m),E[c[2]]=E[c[2]]||[],E[c[2]].push(c[4]);for(var n=Object.keys(E),h=0;h<n.length;h++)for(var v=0;v<E[n[h]].length;v++)A(E[n[h]][v])&&(E[n[h]][v]=1*E[n[h]][v]);return E}function _(g){var T=Object.keys(g);return T.reduce(function(m,E){return m||g[E].length>0},!1)}function d(g,T){for(var m={main:[T]},E={main:[]},l={main:{}};_(m);)for(var t=Object.keys(m),e=0;e<t.length;e++){var i=t[e],c=m[i],n=c.pop();if(l[i]=l[i]||{},!(l[i][n]||!g[i][n])){l[i][n]=!0,E[i]=E[i]||[],E[i].push(n);for(var h=D(g,g[i][n],i),v=Object.keys(h),y=0;y<v.length;y++)m[v[y]]=m[v[y]]||[],m[v[y]]=m[v[y]].concat(h[v[y]])}}return E}j.exports=function(g,T){T=T||{};var m={main:p.m},E=T.all?{main:Object.keys(m.main)}:d(m,g),l="";Object.keys(E).filter(function(n){return n!=="main"}).forEach(function(n){for(var h=0;E[n][h];)h++;E[n].push(h),m[n][h]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+n+" = ("+w.toString().replace("ENTRY_MODULE",JSON.stringify(h))+")({"+E[n].map(function(v){return""+JSON.stringify(v)+": "+m[n][v].toString()}).join(",")+`});
`}),l=l+"new (("+w.toString().replace("ENTRY_MODULE",JSON.stringify(g))+")({"+E.main.map(function(n){return""+JSON.stringify(n)+": "+m.main[n].toString()}).join(",")+"}))(self);";var t=new window.Blob([l],{type:"text/javascript"});if(T.bare)return t;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,i=e.createObjectURL(t),c=new window.Worker(i);return c.objectURL=i,c}},"./src/config.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"hlsDefaultConfig",function(){return v}),p.d(x,"mergeConfig",function(){return f}),p.d(x,"enableStreamingMode",function(){return s});var w=p("./src/controller/abr-controller.ts"),S=p("./src/controller/audio-stream-controller.ts"),L=p("./src/controller/audio-track-controller.ts"),k=p("./src/controller/subtitle-stream-controller.ts"),A=p("./src/controller/subtitle-track-controller.ts"),D=p("./src/controller/buffer-controller.ts"),_=p("./src/controller/timeline-controller.ts"),d=p("./src/controller/cap-level-controller.ts"),g=p("./src/controller/fps-controller.ts"),T=p("./src/controller/eme-controller.ts"),m=p("./src/utils/xhr-loader.ts"),E=p("./src/utils/fetch-loader.ts"),l=p("./src/utils/cues.ts"),t=p("./src/utils/mediakeys-helper.ts"),e=p("./src/utils/logger.ts");function i(){return i=Object.assign||function(a){for(var r=1;r<arguments.length;r++){var u=arguments[r];for(var o in u)Object.prototype.hasOwnProperty.call(u,o)&&(a[o]=u[o])}return a},i.apply(this,arguments)}function c(a,r){var u=Object.keys(a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(a);r&&(o=o.filter(function(b){return Object.getOwnPropertyDescriptor(a,b).enumerable})),u.push.apply(u,o)}return u}function n(a){for(var r=1;r<arguments.length;r++){var u=arguments[r]!=null?arguments[r]:{};r%2?c(Object(u),!0).forEach(function(o){h(a,o,u[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(u)):c(Object(u)).forEach(function(o){Object.defineProperty(a,o,Object.getOwnPropertyDescriptor(u,o))})}return a}function h(a,r,u){return r in a?Object.defineProperty(a,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):a[r]=u,a}var v=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:w.default,bufferController:D.default,capLevelController:d.default,fpsController:g.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},y()),{},{subtitleStreamController:k.SubtitleStreamController,subtitleTrackController:A.default,timelineController:_.TimelineController,audioStreamController:S.default,audioTrackController:L.default,emeController:T.default});function y(){return{cueHandler:l.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function f(a,r){if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(r.liveMaxLatencyDurationCount!==void 0&&(r.liveSyncDurationCount===void 0||r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(r.liveMaxLatencyDuration!==void 0&&(r.liveSyncDuration===void 0||r.liveMaxLatencyDuration<=r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return i({},a,r)}function s(a){var r=a.loader;if(r!==E.default&&r!==m.default)e.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),a.progressive=!1;else{var u=Object(E.fetchSupported)();u&&(a.loader=E.default,a.progressive=!0,a.enableSoftwareAES=!0,e.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/polyfills/number.ts"),S=p("./src/utils/ewma-bandwidth-estimator.ts"),L=p("./src/events.ts"),k=p("./src/utils/buffer-helper.ts"),A=p("./src/errors.ts"),D=p("./src/types/loader.ts"),_=p("./src/utils/logger.ts");function d(m,E){for(var l=0;l<E.length;l++){var t=E[l];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}function g(m,E,l){return E&&d(m.prototype,E),l&&d(m,l),m}var T=function(){function m(l){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=l;var t=l.config;this.bwEstimator=new S.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var E=m.prototype;return E.registerListeners=function(){var l=this.hls;l.on(L.Events.FRAG_LOADING,this.onFragLoading,this),l.on(L.Events.FRAG_LOADED,this.onFragLoaded,this),l.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(L.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var l=this.hls;l.off(L.Events.FRAG_LOADING,this.onFragLoading,this),l.off(L.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this),l.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(L.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},E.onFragLoading=function(l,t){var e=t.frag;if(e.type===D.PlaylistLevelType.MAIN&&!this.timer){var i;this.fragCurrent=e,this.partCurrent=(i=t.part)!=null?i:null,this.timer=self.setInterval(this.onCheck,100)}},E.onLevelLoaded=function(l,t){var e=this.hls.config;t.details.live?this.bwEstimator.update(e.abrEwmaSlowLive,e.abrEwmaFastLive):this.bwEstimator.update(e.abrEwmaSlowVoD,e.abrEwmaFastVoD)},E._abandonRulesCheck=function(){var l=this.fragCurrent,t=this.partCurrent,e=this.hls,i=e.autoLevelEnabled,c=e.config,n=e.media;if(!(!l||!n)){var h=t?t.stats:l.stats,v=t?t.duration:l.duration;if(h.aborted){_.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!i||n.paused||!n.playbackRate||!n.readyState)){var y=performance.now()-h.loading.start,f=Math.abs(n.playbackRate);if(!(y<=500*v/f)){var s=e.levels,a=e.minAutoLevel,r=s[l.level],u=h.total||Math.max(h.loaded,Math.round(v*r.maxBitrate/8)),o=Math.max(1,h.bwEstimate?h.bwEstimate/8:h.loaded*1e3/y),b=(u-h.loaded)/o,R=n.currentTime,O=(k.BufferHelper.bufferInfo(n,R,c.maxBufferHole).end-R)/f;if(!(O>=2*v/f||b<=O)){var C=Number.POSITIVE_INFINITY,I;for(I=l.level-1;I>a;I--){var F=s[I].maxBitrate;if(C=v*F/(8*.8*o),C<O)break}if(!(C>=b)){var M=this.bwEstimator.getEstimate();_.logger.warn("Fragment "+l.sn+(t?" part "+t.index:"")+" of level "+l.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+I+`
      Current BW estimate: `+(Object(w.isFiniteNumber)(M)?(M/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+b.toFixed(3)+` s
      Estimated load time for the next fragment: `+C.toFixed(3)+` s
      Time to underbuffer: `+O.toFixed(3)+" s"),e.nextLoadLevel=I,this.bwEstimator.sample(y,h.loaded),this.clearTimer(),l.loader&&(this.fragCurrent=this.partCurrent=null,l.loader.abort()),e.trigger(L.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:l,part:t,stats:h})}}}}}},E.onFragLoaded=function(l,t){var e=t.frag,i=t.part;if(e.type===D.PlaylistLevelType.MAIN&&Object(w.isFiniteNumber)(e.sn)){var c=i?i.stats:e.stats,n=i?i.duration:e.duration;if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var h=this.hls.levels[e.level],v=(h.loaded?h.loaded.bytes:0)+c.loaded,y=(h.loaded?h.loaded.duration:0)+n;h.loaded={bytes:v,duration:y},h.realBitrate=Math.round(8*v/y)}if(e.bitrateTest){var f={stats:c,frag:e,part:i,id:e.type};this.onFragBuffered(L.Events.FRAG_BUFFERED,f),e.bitrateTest=!1}}},E.onFragBuffered=function(l,t){var e=t.frag,i=t.part,c=i?i.stats:e.stats;if(!c.aborted&&!(e.type!==D.PlaylistLevelType.MAIN||e.sn==="initSegment")){var n=c.parsing.end-c.loading.start;this.bwEstimator.sample(n,c.loaded),c.bwEstimate=this.bwEstimator.getEstimate(),e.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},E.onError=function(l,t){switch(t.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break;default:break}},E.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},E.getNextABRAutoLevel=function(){var l=this.fragCurrent,t=this.partCurrent,e=this.hls,i=e.maxAutoLevel,c=e.config,n=e.minAutoLevel,h=e.media,v=t?t.duration:l?l.duration:0,y=h?h.currentTime:0,f=h&&h.playbackRate!==0?Math.abs(h.playbackRate):1,s=this.bwEstimator?this.bwEstimator.getEstimate():c.abrEwmaDefaultEstimate,a=(k.BufferHelper.bufferInfo(h,y,c.maxBufferHole).end-y)/f,r=this.findBestLevel(s,n,i,a,c.abrBandWidthFactor,c.abrBandWidthUpFactor);if(r>=0)return r;_.logger.trace((a?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var u=v?Math.min(v,c.maxStarvationDelay):c.maxStarvationDelay,o=c.abrBandWidthFactor,b=c.abrBandWidthUpFactor;if(!a){var R=this.bitrateTestDelay;if(R){var O=v?Math.min(v,c.maxLoadingDelay):c.maxLoadingDelay;u=O-R,_.logger.trace("bitrate test took "+Math.round(1e3*R)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*u)+" ms"),o=b=1}}return r=this.findBestLevel(s,n,i,a+u,o,b),Math.max(r,0)},E.findBestLevel=function(l,t,e,i,c,n){for(var h,v=this.fragCurrent,y=this.partCurrent,f=this.lastLoadedFragLevel,s=this.hls.levels,a=s[f],r=!!(a!=null&&(h=a.details)!==null&&h!==void 0&&h.live),u=a==null?void 0:a.codecSet,o=y?y.duration:v?v.duration:0,b=e;b>=t;b--){var R=s[b];if(!(!R||u&&R.codecSet!==u)){var O=R.details,C=(y?O==null?void 0:O.partTarget:O==null?void 0:O.averagetargetduration)||o,I=void 0;b<=f?I=c*l:I=n*l;var F=s[b].maxBitrate,M=F*C/I;if(_.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+b+"/"+Math.round(I)+"/"+F+"/"+C+"/"+i+"/"+M),I>F&&(!M||r&&!this.bitrateTestDelay||M<i))return b}}return-1},g(m,[{key:"nextAutoLevel",get:function(){var l=this._nextAutoLevel,t=this.bwEstimator;if(l!==-1&&(!t||!t.canEstimate()))return l;var e=this.getNextABRAutoLevel();return l!==-1&&(e=Math.min(l,e)),e},set:function(l){this._nextAutoLevel=l}}]),m}();x.default=T},"./src/controller/audio-stream-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/polyfills/number.ts"),S=p("./src/controller/base-stream-controller.ts"),L=p("./src/events.ts"),k=p("./src/utils/buffer-helper.ts"),A=p("./src/controller/fragment-tracker.ts"),D=p("./src/types/level.ts"),_=p("./src/types/loader.ts"),d=p("./src/loader/fragment.ts"),g=p("./src/demux/chunk-cache.ts"),T=p("./src/demux/transmuxer-interface.ts"),m=p("./src/types/transmuxer.ts"),E=p("./src/controller/fragment-finders.ts"),l=p("./src/utils/discontinuities.ts"),t=p("./src/errors.ts"),e=p("./src/utils/logger.ts");function i(){return i=Object.assign||function(y){for(var f=1;f<arguments.length;f++){var s=arguments[f];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(y[a]=s[a])}return y},i.apply(this,arguments)}function c(y,f){y.prototype=Object.create(f.prototype),y.prototype.constructor=y,n(y,f)}function n(y,f){return n=Object.setPrototypeOf||function(s,a){return s.__proto__=a,s},n(y,f)}var h=100,v=function(y){c(f,y);function f(a,r){var u;return u=y.call(this,a,r,"[audio-stream-controller]")||this,u.videoBuffer=null,u.videoTrackCC=-1,u.waitingVideoCC=-1,u.audioSwitch=!1,u.trackId=-1,u.waitingData=null,u.mainDetails=null,u.bufferFlushed=!1,u._registerListeners(),u}var s=f.prototype;return s.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},s._registerListeners=function(){var a=this.hls;a.on(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.on(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.on(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.on(L.Events.ERROR,this.onError,this),a.on(L.Events.BUFFER_RESET,this.onBufferReset,this),a.on(L.Events.BUFFER_CREATED,this.onBufferCreated,this),a.on(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.on(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.on(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s._unregisterListeners=function(){var a=this.hls;a.off(L.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(L.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(L.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(L.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(L.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),a.off(L.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),a.off(L.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),a.off(L.Events.ERROR,this.onError,this),a.off(L.Events.BUFFER_RESET,this.onBufferReset,this),a.off(L.Events.BUFFER_CREATED,this.onBufferCreated,this),a.off(L.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),a.off(L.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),a.off(L.Events.FRAG_BUFFERED,this.onFragBuffered,this)},s.onInitPtsFound=function(a,r){var u=r.frag,o=r.id,b=r.initPTS;if(o==="main"){var R=u.cc;this.initPTS[u.cc]=b,this.log("InitPTS for cc: "+R+" found from main: "+b),this.videoTrackCC=R,this.state===S.State.WAITING_INIT_PTS&&this.tick()}},s.startLoad=function(a){if(!this.levels){this.startPosition=a,this.state=S.State.STOPPED;return}var r=this.lastCurrentTime;this.stopLoad(),this.setInterval(h),this.fragLoadError=0,r>0&&a===-1?(this.log("Override startPosition with lastCurrentTime @"+r.toFixed(3)),this.state=S.State.IDLE):(this.loadedmetadata=!1,this.state=S.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=a,this.tick()},s.doTick=function(){switch(this.state){case S.State.IDLE:this.doTickIdle();break;case S.State.WAITING_TRACK:{var a,r=this.levels,u=this.trackId,o=r==null||(a=r[u])===null||a===void 0?void 0:a.details;if(o){if(this.waitForCdnTuneIn(o))break;this.state=S.State.WAITING_INIT_PTS}break}case S.State.FRAG_LOADING_WAITING_RETRY:{var b,R=performance.now(),O=this.retryDate;(!O||R>=O||(b=this.media)!==null&&b!==void 0&&b.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=S.State.IDLE);break}case S.State.WAITING_INIT_PTS:{var C=this.waitingData;if(C){var I=C.frag,F=C.part,M=C.cache,P=C.complete;if(this.initPTS[I.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=S.State.FRAG_LOADING;var N=M.flush(),U={frag:I,part:F,payload:N,networkDetails:null};this._handleFragmentLoadProgress(U),P&&y.prototype._handleFragmentLoadComplete.call(this,U)}else if(this.videoTrackCC!==this.waitingVideoCC)e.logger.log("Waiting fragment cc ("+I.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var B=this.getLoadPosition(),G=k.BufferHelper.bufferInfo(this.mediaBuffer,B,this.config.maxBufferHole),q=Object(E.fragmentWithinToleranceTest)(G.end,this.config.maxFragLookUpTolerance,I);q<0&&(e.logger.log("Waiting fragment cc ("+I.cc+") @ "+I.start+" cancelled because another fragment at "+G.end+" is needed"),this.clearWaitingFragment())}}else this.state=S.State.IDLE}}this.onTickEnd()},s.clearWaitingFragment=function(){var a=this.waitingData;a&&(this.fragmentTracker.removeFragment(a.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=S.State.IDLE)},s.onTickEnd=function(){var a=this.media;if(!(!a||!a.readyState)){var r=this.mediaBuffer?this.mediaBuffer:a,u=r.buffered;!this.loadedmetadata&&u.length&&(this.loadedmetadata=!0),this.lastCurrentTime=a.currentTime}},s.doTickIdle=function(){var a,r,u=this.hls,o=this.levels,b=this.media,R=this.trackId,O=u.config;if(!(!o||!o[R])&&!(!b&&(this.startFragRequested||!O.startFragPrefetch))){var C=o[R],I=C.details;if(!I||I.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(I)){this.state=S.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,d.ElementaryStreamTypes.AUDIO,_.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,_.PlaylistLevelType.AUDIO);if(F!==null){var M=F.len,P=this.getMaxBufferLength(),N=this.audioSwitch;if(!(M>=P&&!N)){if(!N&&this._streamEnded(F,I)){u.trigger(L.Events.BUFFER_EOS,{type:"audio"}),this.state=S.State.ENDED;return}var U=I.fragments,B=U[0].start,G=F.end;if(N){var q=this.getLoadPosition();G=q,I.PTSKnown&&q<B&&(F.end>B||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),b.currentTime=B+.05)}var K=this.getNextFragment(G,I);if(!K){this.bufferFlushed=!0;return}((a=K.decryptdata)===null||a===void 0?void 0:a.keyFormat)==="identity"&&!((r=K.decryptdata)!==null&&r!==void 0&&r.key)?this.loadKey(K,I):this.loadFragment(K,I,G)}}}},s.getMaxBufferLength=function(){var a=y.prototype.getMaxBufferLength.call(this),r=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,_.PlaylistLevelType.MAIN);return r===null?a:Math.max(a,r.len)},s.onMediaDetaching=function(){this.videoBuffer=null,y.prototype.onMediaDetaching.call(this)},s.onAudioTracksUpdated=function(a,r){var u=r.audioTracks;this.resetTransmuxer(),this.levels=u.map(function(o){return new D.Level(o)})},s.onAudioTrackSwitching=function(a,r){var u=!!r.url;this.trackId=r.id;var o=this.fragCurrent;o!=null&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),u?this.setInterval(h):this.resetTransmuxer(),u?(this.audioSwitch=!0,this.state=S.State.IDLE):this.state=S.State.STOPPED,this.tick()},s.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},s.onLevelLoaded=function(a,r){this.mainDetails=r.details},s.onAudioTrackLoaded=function(a,r){var u,o=this.levels,b=r.details,R=r.id;if(!o){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+b.startSN+","+b.endSN+"],duration:"+b.totalduration);var O=o[R],C=0;if(b.live||(u=O.details)!==null&&u!==void 0&&u.live){var I=this.mainDetails;if(b.fragments[0]||(b.deltaUpdateFailed=!0),b.deltaUpdateFailed||!I)return;!O.details&&b.hasProgramDateTime&&I.hasProgramDateTime?(Object(l.alignMediaPlaylistByPDT)(b,I),C=b.fragments[0].start):C=this.alignPlaylists(b,O.details)}O.details=b,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!b.live)&&this.setStartPosition(O.details,C),this.state===S.State.WAITING_TRACK&&!this.waitForCdnTuneIn(b)&&(this.state=S.State.IDLE),this.tick()},s._handleFragmentLoadProgress=function(a){var r,u=a.frag,o=a.part,b=a.payload,R=this.config,O=this.trackId,C=this.levels;if(!C){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+u.sn+" of level "+u.level+" will not be buffered");return}var I=C[O];console.assert(I,"Audio track is defined on fragment load progress");var F=I.details;console.assert(F,"Audio track details are defined on fragment load progress");var M=R.defaultAudioCodec||I.audioCodec||"mp4a.40.2",P=this.transmuxer;P||(P=this.transmuxer=new T.default(this.hls,_.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[u.cc],U=(r=u.initSegment)===null||r===void 0?void 0:r.data;if(N!==void 0){var B=!1,G=o?o.index:-1,q=G!==-1,K=new m.ChunkMetadata(u.level,u.sn,u.stats.chunkCount,b.byteLength,G,q);P.push(b,U,M,"",u,o,F.totalduration,B,K,N)}else{e.logger.log("Unknown video PTS for cc "+u.cc+", waiting for video PTS before demuxing audio frag "+u.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+O);var W=this.waitingData=this.waitingData||{frag:u,part:o,cache:new g.default,complete:!1},V=W.cache;V.push(new Uint8Array(b)),this.waitingVideoCC=this.videoTrackCC,this.state=S.State.WAITING_INIT_PTS}},s._handleFragmentLoadComplete=function(a){if(this.waitingData){this.waitingData.complete=!0;return}y.prototype._handleFragmentLoadComplete.call(this,a)},s.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},s.onBufferCreated=function(a,r){var u=r.tracks.audio;u&&(this.mediaBuffer=u.buffer),r.tracks.video&&(this.videoBuffer=r.tracks.video.buffer)},s.onFragBuffered=function(a,r){var u=r.frag,o=r.part;if(u.type===_.PlaylistLevelType.AUDIO){if(this.fragContextChanged(u)){this.warn("Fragment "+u.sn+(o?" p: "+o.index:"")+" of level "+u.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}u.sn!=="initSegment"&&(this.fragPrevious=u,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(u,o)}},s.onError=function(a,r){switch(r.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.AUDIO,r);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==S.State.ERROR&&this.state!==S.State.STOPPED&&(this.state=r.fatal?S.State.ERROR:S.State.IDLE,this.warn(r.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(r.parent==="audio"&&(this.state===S.State.PARSING||this.state===S.State.PARSED)){var u=!0,o=this.getFwdBufferInfo(this.mediaBuffer,_.PlaylistLevelType.AUDIO);o&&o.len>.5&&(u=!this.reduceMaxBufferLength(o.len)),u&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,y.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break;default:break}},s.onBufferFlushed=function(a,r){var u=r.type;u===d.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},s._handleTransmuxComplete=function(a){var r,u="audio",o=this.hls,b=a.remuxResult,R=a.chunkMeta,O=this.getCurrentContext(R);if(!O){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(R.level);return}var C=O.frag,I=O.part,F=b.audio,M=b.text,P=b.id3,N=b.initSegment;if(!this.fragContextChanged(C)){if(this.state=S.State.PARSING,this.audioSwitch&&F&&this.completeAudioSwitch(),N!=null&&N.tracks&&(this._bufferInitSegment(N.tracks,C,R),o.trigger(L.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:u,tracks:N.tracks})),F){var U=F.startPTS,B=F.endPTS,G=F.startDTS,q=F.endDTS;I&&(I.elementaryStreams[d.ElementaryStreamTypes.AUDIO]={startPTS:U,endPTS:B,startDTS:G,endDTS:q}),C.setElementaryStreamInfo(d.ElementaryStreamTypes.AUDIO,U,B,G,q),this.bufferFragmentData(F,C,I,R)}if(P!=null&&(r=P.samples)!==null&&r!==void 0&&r.length){var K=i({frag:C,id:u},P);o.trigger(L.Events.FRAG_PARSING_METADATA,K)}if(M){var W=i({frag:C,id:u},M);o.trigger(L.Events.FRAG_PARSING_USERDATA,W)}}},s._bufferInitSegment=function(a,r,u){if(this.state===S.State.PARSING){a.video&&delete a.video;var o=a.audio;if(o){o.levelCodec=o.codec,o.id="audio",this.log("Init audio buffer, container:"+o.container+", codecs[parsed]=["+o.codec+"]"),this.hls.trigger(L.Events.BUFFER_CODECS,a);var b=o.initSegment;if(b!=null&&b.byteLength){var R={type:"audio",frag:r,part:null,chunkMeta:u,parent:r.type,data:b};this.hls.trigger(L.Events.BUFFER_APPENDING,R)}this.tick()}}},s.loadFragment=function(a,r,u){var o=this.fragmentTracker.getState(a);this.fragCurrent=a,(this.audioSwitch||o===A.FragmentState.NOT_LOADED||o===A.FragmentState.PARTIAL)&&(a.sn==="initSegment"?this._loadInitSegment(a):r.live&&!Object(w.isFiniteNumber)(this.initPTS[a.cc])?(this.log("Waiting for video PTS in continuity counter "+a.cc+" of live stream before loading audio fragment "+a.sn+" of level "+this.trackId),this.state=S.State.WAITING_INIT_PTS):(this.startFragRequested=!0,y.prototype.loadFragment.call(this,a,r,u)))},s.completeAudioSwitch=function(){var a=this.hls,r=this.media,u=this.trackId;r&&(this.log("Switching audio track : flushing all audio"),y.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,a.trigger(L.Events.AUDIO_TRACK_SWITCHED,{id:u})},f}(S.default);x.default=v},"./src/controller/audio-track-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/events.ts"),S=p("./src/errors.ts"),L=p("./src/controller/base-playlist-controller.ts"),k=p("./src/types/loader.ts");function A(T,m){for(var E=0;E<m.length;E++){var l=m[E];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(T,l.key,l)}}function D(T,m,E){return m&&A(T.prototype,m),E&&A(T,E),T}function _(T,m){T.prototype=Object.create(m.prototype),T.prototype.constructor=T,d(T,m)}function d(T,m){return d=Object.setPrototypeOf||function(E,l){return E.__proto__=l,E},d(T,m)}var g=function(T){_(m,T);function m(l){var t;return t=T.call(this,l,"[audio-track-controller]")||this,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}var E=m.prototype;return E.registerListeners=function(){var l=this.hls;l.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.on(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.on(w.Events.ERROR,this.onError,this)},E.unregisterListeners=function(){var l=this.hls;l.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(w.Events.LEVEL_LOADING,this.onLevelLoading,this),l.off(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),l.off(w.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),l.off(w.Events.ERROR,this.onError,this)},E.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,T.prototype.destroy.call(this)},E.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},E.onManifestParsed=function(l,t){this.tracks=t.audioTracks||[]},E.onAudioTrackLoaded=function(l,t){var e=t.id,i=t.details,c=this.tracksInGroup[e];if(!c){this.warn("Invalid audio track id "+e);return}var n=c.details;c.details=t.details,this.log("audioTrack "+e+" loaded ["+i.startSN+"-"+i.endSN+"]"),e===this.trackId&&(this.retryCount=0,this.playlistLoaded(e,t,n))},E.onLevelLoading=function(l,t){this.switchLevel(t.level)},E.onLevelSwitching=function(l,t){this.switchLevel(t.level)},E.switchLevel=function(l){var t=this.hls.levels[l];if(t!=null&&t.audioGroupIds){var e=t.audioGroupIds[t.urlId];if(this.groupId!==e){this.groupId=e;var i=this.tracks.filter(function(n){return!e||n.groupId===e});this.selectDefaultTrack&&!i.some(function(n){return n.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var c={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+e+'" group-id'),this.hls.trigger(w.Events.AUDIO_TRACKS_UPDATED,c),this.selectInitialTrack()}}},E.onError=function(l,t){T.prototype.onError.call(this,l,t),!(t.fatal||!t.context)&&t.context.type===k.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},E.setAudioTrack=function(l){var t=this.tracksInGroup;if(l<0||l>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var e=t[this.trackId];this.log("Now switching to audio-track index "+l);var i=t[l],c=i.id,n=i.groupId,h=n===void 0?"":n,v=i.name,y=i.type,f=i.url;if(this.trackId=l,this.trackName=v,this.selectDefaultTrack=!1,this.hls.trigger(w.Events.AUDIO_TRACK_SWITCHING,{id:c,groupId:h,name:v,type:y,url:f}),!(i.details&&!i.details.live)){var s=this.switchParams(i.url,e==null?void 0:e.details);this.loadPlaylist(s)}},E.selectInitialTrack=function(){var l=this.tracksInGroup;console.assert(l.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,e=this.findTrackId(t)||this.findTrackId();e!==-1?this.setAudioTrack(e):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},E.findTrackId=function(l){for(var t=this.tracksInGroup,e=0;e<t.length;e++){var i=t[e];if((!this.selectDefaultTrack||i.default)&&(!l||l===i.name))return i.id}return-1},E.loadPlaylist=function(l){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var e=t.id,i=t.groupId,c=t.url;if(l)try{c=l.addDirectives(c)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("loading audio-track playlist for id: "+e),this.clearTimer(),this.hls.trigger(w.Events.AUDIO_TRACK_LOADING,{url:c,id:e,groupId:i,deliveryDirectives:l||null})}},D(m,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(l){this.selectDefaultTrack=!1,this.setAudioTrack(l)}}]),m}(L.default);x.default=g},"./src/controller/base-playlist-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return D});var w=p("./src/polyfills/number.ts"),S=p("./src/types/level.ts"),L=p("./src/controller/level-helper.ts"),k=p("./src/utils/logger.ts"),A=p("./src/errors.ts"),D=function(){function _(g,T){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,T+":"),this.warn=k.logger.warn.bind(k.logger,T+":"),this.hls=g}var d=_.prototype;return d.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},d.onError=function(g,T){T.fatal&&T.type===A.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},d.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},d.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},d.stopLoad=function(){this.canLoad=!1,this.clearTimer()},d.switchParams=function(g,T){var m=T==null?void 0:T.renditionReports;if(m)for(var E=0;E<m.length;E++){var l=m[E],t=""+l.URI;if(t===g.substr(-t.length)){var e=parseInt(l["LAST-MSN"]),i=parseInt(l["LAST-PART"]);if(T&&this.hls.config.lowLatencyMode){var c=Math.min(T.age-T.partTarget,T.targetduration);i!==void 0&&c>T.partTarget&&(i+=1)}if(Object(w.isFiniteNumber)(e))return new S.HlsUrlParameters(e,Object(w.isFiniteNumber)(i)?i:void 0,S.HlsSkip.No)}}},d.loadPlaylist=function(g){},d.shouldLoadTrack=function(g){return this.canLoad&&g&&!!g.url&&(!g.details||g.details.live)},d.playlistLoaded=function(g,T,m){var E=this,l=T.details,t=T.stats,e=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(l.advancedDateTime=Date.now()-e,l.live||m!=null&&m.live){if(l.reloaded(m),m&&this.log("live playlist "+g+" "+(l.advanced?"REFRESHED "+l.lastPartSn+"-"+l.lastPartIndex:"MISSED")),m&&l.fragments.length>0&&Object(L.mergeDetails)(m,l),!this.canLoad||!l.live)return;var i,c=void 0,n=void 0;if(l.canBlockReload&&l.endSN&&l.advanced){var h=this.hls.config.lowLatencyMode,v=l.lastPartSn,y=l.endSN,f=l.lastPartIndex,s=f!==-1,a=v===y,r=h?0:f;s?(c=a?y+1:v,n=a?r:f+1):c=y+1;var u=l.age,o=u+l.ageHeader,b=Math.min(o-l.partTarget,l.targetduration*1.5);if(b>0){if(m&&b>m.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+m.tuneInGoal+" to: "+b+" with playlist age: "+l.age),b=0;else{var R=Math.floor(b/l.targetduration);if(c+=R,n!==void 0){var O=Math.round(b%l.targetduration/l.partTarget);n+=O}this.log("CDN Tune-in age: "+l.ageHeader+"s last advanced "+u.toFixed(2)+"s goal: "+b+" skip sn "+R+" to part "+n)}l.tuneInGoal=b}if(i=this.getDeliveryDirectives(l,T.deliveryDirectives,c,n),h||!a){this.loadPlaylist(i);return}}else i=this.getDeliveryDirectives(l,T.deliveryDirectives,c,n);var C=Object(L.computeReloadInterval)(l,t);c!==void 0&&l.canBlockReload&&(C-=l.partTarget||1),this.log("reload live playlist "+g+" in "+Math.round(C)+" ms"),this.timer=self.setTimeout(function(){return E.loadPlaylist(i)},C)}else this.clearTimer()},d.getDeliveryDirectives=function(g,T,m,E){var l=Object(S.getSkipValue)(g,m);return T!=null&&T.skip&&g.deltaUpdateFailed&&(m=T.msn,E=T.part,l=S.HlsSkip.No),new S.HlsUrlParameters(m,E,l)},d.retryLoadingOrFail=function(g){var T=this,m=this.hls.config,E=this.retryCount<m.levelLoadingMaxRetry;if(E){var l;if(this.retryCount++,g.details.indexOf("LoadTimeOut")>-1&&(l=g.context)!==null&&l!==void 0&&l.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+g.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*m.levelLoadingRetryDelay,m.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+g.details+'"')}}else this.warn('cannot recover from error "'+g.details+'"'),this.clearTimer(),g.fatal=!0;return E},_}()},"./src/controller/base-stream-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"State",function(){return f}),p.d(x,"default",function(){return s});var w=p("./src/polyfills/number.ts"),S=p("./src/task-loop.ts"),L=p("./src/controller/fragment-tracker.ts"),k=p("./src/utils/buffer-helper.ts"),A=p("./src/utils/logger.ts"),D=p("./src/events.ts"),_=p("./src/errors.ts"),d=p("./src/types/transmuxer.ts"),g=p("./src/utils/mp4-tools.ts"),T=p("./src/utils/discontinuities.ts"),m=p("./src/controller/fragment-finders.ts"),E=p("./src/controller/level-helper.ts"),l=p("./src/loader/fragment-loader.ts"),t=p("./src/crypt/decrypter.ts"),e=p("./src/utils/time-ranges.ts"),i=p("./src/types/loader.ts");function c(a,r){for(var u=0;u<r.length;u++){var o=r[u];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(a,o.key,o)}}function n(a,r,u){return r&&c(a.prototype,r),u&&c(a,u),a}function h(a){if(a===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function v(a,r){a.prototype=Object.create(r.prototype),a.prototype.constructor=a,y(a,r)}function y(a,r){return y=Object.setPrototypeOf||function(u,o){return u.__proto__=o,u},y(a,r)}var f={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},s=function(a){v(r,a);function r(o,b,R){var O;return O=a.call(this)||this,O.hls=void 0,O.fragPrevious=null,O.fragCurrent=null,O.fragmentTracker=void 0,O.transmuxer=null,O._state=f.STOPPED,O.media=void 0,O.mediaBuffer=void 0,O.config=void 0,O.bitrateTest=!1,O.lastCurrentTime=0,O.nextLoadPosition=0,O.startPosition=0,O.loadedmetadata=!1,O.fragLoadError=0,O.retryDate=0,O.levels=null,O.fragmentLoader=void 0,O.levelLastLoaded=null,O.startFragRequested=!1,O.decrypter=void 0,O.initPTS=[],O.onvseeking=null,O.onvended=null,O.logPrefix="",O.log=void 0,O.warn=void 0,O.logPrefix=R,O.log=A.logger.log.bind(A.logger,R+":"),O.warn=A.logger.warn.bind(A.logger,R+":"),O.hls=o,O.fragmentLoader=new l.default(o.config),O.fragmentTracker=b,O.config=o.config,O.decrypter=new t.default(o,o.config),o.on(D.Events.KEY_LOADED,O.onKeyLoaded,h(O)),O}var u=r.prototype;return u.doTick=function(){this.onTickEnd()},u.onTickEnd=function(){},u.startLoad=function(o){},u.stopLoad=function(){this.fragmentLoader.abort();var o=this.fragCurrent;o&&this.fragmentTracker.removeFragment(o),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=f.STOPPED},u._streamEnded=function(o,b){var R=this.fragCurrent,O=this.fragmentTracker;if(!b.live&&R&&R.sn===b.endSN&&!o.nextStart){var C=O.getState(R);return C===L.FragmentState.PARTIAL||C===L.FragmentState.OK}return!1},u.onMediaAttached=function(o,b){var R=this.media=this.mediaBuffer=b.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),R.addEventListener("seeking",this.onvseeking),R.addEventListener("ended",this.onvended);var O=this.config;this.levels&&O.autoStartLoad&&this.state===f.STOPPED&&this.startLoad(O.startPosition)},u.onMediaDetaching=function(){var o=this.media;o!=null&&o.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),o&&(o.removeEventListener("seeking",this.onvseeking),o.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},u.onMediaSeeking=function(){var o=this.config,b=this.fragCurrent,R=this.media,O=this.mediaBuffer,C=this.state,I=R?R.currentTime:0,F=k.BufferHelper.bufferInfo(O||R,I,o.maxBufferHole);if(this.log("media seeking to "+(Object(w.isFiniteNumber)(I)?I.toFixed(3):I)+", state: "+C),C===f.ENDED)this.resetLoadingState();else if(b&&!F.len){var M=o.maxFragLookUpTolerance,P=b.start-M,N=b.start+b.duration+M,U=I>N;(I<P||U)&&(U&&b.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),b.loader.abort()),this.resetLoadingState())}R&&(this.lastCurrentTime=I),!this.loadedmetadata&&!F.len&&(this.nextLoadPosition=this.startPosition=I),this.tickImmediate()},u.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},u.onKeyLoaded=function(o,b){if(!(this.state!==f.KEY_LOADING||b.frag!==this.fragCurrent||!this.levels)){this.state=f.IDLE;var R=this.levels[b.frag.level].details;R&&this.loadFragment(b.frag,R,b.frag.start)}},u.onHandlerDestroying=function(){this.stopLoad(),a.prototype.onHandlerDestroying.call(this)},u.onHandlerDestroyed=function(){this.state=f.STOPPED,this.hls.off(D.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,a.prototype.onHandlerDestroyed.call(this)},u.loadKey=function(o,b){this.log("Loading key for "+o.sn+" of ["+b.startSN+"-"+b.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+o.level),this.state=f.KEY_LOADING,this.fragCurrent=o,this.hls.trigger(D.Events.KEY_LOADING,{frag:o})},u.loadFragment=function(o,b,R){this._loadFragForPlayback(o,b,R)},u._loadFragForPlayback=function(o,b,R){var O=this,C=function(I){if(O.fragContextChanged(o)){O.warn("Fragment "+o.sn+(I.part?" p: "+I.part.index:"")+" of level "+o.level+" was dropped during download."),O.fragmentTracker.removeFragment(o);return}o.stats.chunkCount++,O._handleFragmentLoadProgress(I)};this._doFragLoad(o,b,R,C).then(function(I){if(I){O.fragLoadError=0;var F=O.state;if(O.fragContextChanged(o)){(F===f.FRAG_LOADING||F===f.BACKTRACKING||!O.fragCurrent&&F===f.PARSING)&&(O.fragmentTracker.removeFragment(o),O.state=f.IDLE);return}if("payload"in I&&(O.log("Loaded fragment "+o.sn+" of level "+o.level),O.hls.trigger(D.Events.FRAG_LOADED,I),O.state===f.BACKTRACKING)){O.fragmentTracker.backtrack(o,I),O.resetFragmentLoading(o);return}O._handleFragmentLoadComplete(I)}}).catch(function(I){O.warn(I),O.resetFragmentLoading(o)})},u.flushMainBuffer=function(o,b,R){if(R===void 0&&(R=null),!!(o-b)){var O={startOffset:o,endOffset:b,type:R};this.fragLoadError=0,this.hls.trigger(D.Events.BUFFER_FLUSHING,O)}},u._loadInitSegment=function(o){var b=this;this._doFragLoad(o).then(function(R){if(!R||b.fragContextChanged(o)||!b.levels)throw new Error("init load aborted");return R}).then(function(R){var O=b.hls,C=R.payload,I=o.decryptdata;if(C&&C.byteLength>0&&I&&I.key&&I.iv&&I.method==="AES-128"){var F=self.performance.now();return b.decrypter.webCryptoDecrypt(new Uint8Array(C),I.key.buffer,I.iv.buffer).then(function(M){var P=self.performance.now();return O.trigger(D.Events.FRAG_DECRYPTED,{frag:o,payload:M,stats:{tstart:F,tdecrypt:P}}),R.payload=M,R})}return R}).then(function(R){var O=b.fragCurrent,C=b.hls,I=b.levels;if(!I)throw new Error("init load aborted, missing levels");var F=I[o.level].details;console.assert(F,"Level details are defined when init segment is loaded");var M=o.stats;b.state=f.IDLE,b.fragLoadError=0,o.data=new Uint8Array(R.payload),M.parsing.start=M.buffering.start=self.performance.now(),M.parsing.end=M.buffering.end=self.performance.now(),R.frag===O&&C.trigger(D.Events.FRAG_BUFFERED,{stats:M,frag:O,part:null,id:o.type}),b.tick()}).catch(function(R){b.warn(R),b.resetFragmentLoading(o)})},u.fragContextChanged=function(o){var b=this.fragCurrent;return!o||!b||o.level!==b.level||o.sn!==b.sn||o.urlId!==b.urlId},u.fragBufferedComplete=function(o,b){var R=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+o.type+" sn: "+o.sn+(b?" part: "+b.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+o.level+" "+e.default.toString(k.BufferHelper.getBuffered(R))),this.state=f.IDLE,this.tick()},u._handleFragmentLoadComplete=function(o){var b=this.transmuxer;if(b){var R=o.frag,O=o.part,C=o.partsLoaded,I=!C||C.length===0||C.some(function(M){return!M}),F=new d.ChunkMetadata(R.level,R.sn,R.stats.chunkCount+1,0,O?O.index:-1,!I);b.flush(F)}},u._handleFragmentLoadProgress=function(o){},u._doFragLoad=function(o,b,R,O){var C=this;if(R===void 0&&(R=null),!this.levels)throw new Error("frag load aborted, missing levels");if(R=Math.max(o.start,R||0),this.config.lowLatencyMode&&b){var I=b.partList;if(I&&O){R>o.end&&b.fragmentHint&&(o=b.fragmentHint);var F=this.getNextPart(I,o,R);if(F>-1){var M=I[F];return this.log("Loading part sn: "+o.sn+" p: "+M.index+" cc: "+o.cc+" of playlist ["+b.startSN+"-"+b.endSN+"] parts [0-"+F+"-"+(I.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+o.level+", target: "+parseFloat(R.toFixed(3))),this.nextLoadPosition=M.start+M.duration,this.state=f.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:o,part:I[F],targetBufferTime:R}),this.doFragPartsLoad(o,I,F,O).catch(function(P){return C.handleFragLoadError(P)})}else if(!o.url||this.loadedEndOfParts(I,R))return Promise.resolve(null)}}return this.log("Loading fragment "+o.sn+" cc: "+o.cc+" "+(b?"of ["+b.startSN+"-"+b.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+o.level+", target: "+parseFloat(R.toFixed(3))),Object(w.isFiniteNumber)(o.sn)&&!this.bitrateTest&&(this.nextLoadPosition=o.start+o.duration),this.state=f.FRAG_LOADING,this.hls.trigger(D.Events.FRAG_LOADING,{frag:o,targetBufferTime:R}),this.fragmentLoader.load(o,O).catch(function(P){return C.handleFragLoadError(P)})},u.doFragPartsLoad=function(o,b,R,O){var C=this;return new Promise(function(I,F){var M=[],P=function N(U){var B=b[U];C.fragmentLoader.loadPart(o,B,O).then(function(G){M[B.index]=G;var q=G.part;C.hls.trigger(D.Events.FRAG_LOADED,G);var K=b[U+1];if(K&&K.fragment===o)N(U+1);else return I({frag:o,part:q,partsLoaded:M})}).catch(F)};P(R)})},u.handleFragLoadError=function(o){var b=o.data;return b&&b.details===_.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(b.frag,b.part):this.hls.trigger(D.Events.ERROR,b),null},u._handleTransmuxerFlush=function(o){var b=this.getCurrentContext(o);if(!b||this.state!==f.PARSING){this.fragCurrent||(this.state=f.IDLE);return}var R=b.frag,O=b.part,C=b.level,I=self.performance.now();R.stats.parsing.end=I,O&&(O.stats.parsing.end=I),this.updateLevelTiming(R,O,C,o.partial)},u.getCurrentContext=function(o){var b=this.levels,R=o.level,O=o.sn,C=o.part;if(!b||!b[R])return this.warn("Levels object was unset while buffering fragment "+O+" of level "+R+". The current chunk will not be buffered."),null;var I=b[R],F=C>-1?Object(E.getPartWith)(I,O,C):null,M=F?F.fragment:Object(E.getFragmentWithSN)(I,O,this.fragCurrent);return M?{frag:M,part:F,level:I}:null},u.bufferFragmentData=function(o,b,R,O){if(!(!o||this.state!==f.PARSING)){var C=o.data1,I=o.data2,F=C;if(C&&I&&(F=Object(g.appendUint8Array)(C,I)),!(!F||!F.length)){var M={type:o.type,frag:b,part:R,chunkMeta:O,parent:b.type,data:F};this.hls.trigger(D.Events.BUFFER_APPENDING,M),o.dropped&&o.independent&&!R&&this.flushBufferGap(b)}}},u.flushBufferGap=function(o){var b=this.media;if(b){if(!k.BufferHelper.isBuffered(b,b.currentTime)){this.flushMainBuffer(0,o.start);return}var R=b.currentTime,O=k.BufferHelper.bufferInfo(b,R,0),C=o.duration,I=Math.min(this.config.maxFragLookUpTolerance*2,C*.25),F=Math.max(Math.min(o.start-I,O.end-I),R+I);o.start-F>I&&this.flushMainBuffer(F,o.start)}},u.getFwdBufferInfo=function(o,b){var R=this.config,O=this.getLoadPosition();if(!Object(w.isFiniteNumber)(O))return null;var C=k.BufferHelper.bufferInfo(o,O,R.maxBufferHole);if(C.len===0&&C.nextStart!==void 0){var I=this.fragmentTracker.getBufferedFrag(O,b);if(I&&C.nextStart<I.end)return k.BufferHelper.bufferInfo(o,O,Math.max(C.nextStart,R.maxBufferHole))}return C},u.getMaxBufferLength=function(o){var b=this.config,R;return o?R=Math.max(8*b.maxBufferSize/o,b.maxBufferLength):R=b.maxBufferLength,Math.min(R,b.maxMaxBufferLength)},u.reduceMaxBufferLength=function(o){var b=this.config,R=o||b.maxBufferLength;return b.maxMaxBufferLength>=R?(b.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+b.maxMaxBufferLength+"s"),!0):!1},u.getNextFragment=function(o,b){var R,O,C=b.fragments,I=C.length;if(!I)return null;var F=this.config,M=C[0].start,P;if(b.live){var N=F.initialLiveManifestSize;if(I<N)return this.warn("Not enough fragments to start playback (have: "+I+", need: "+N+")"),null;!b.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(P=this.getInitialLiveFragment(b,C),this.startPosition=P?this.hls.liveSyncPosition||P.start:o)}else o<=M&&(P=C[0]);if(!P){var U=F.lowLatencyMode?b.partEnd:b.fragmentEnd;P=this.getFragmentAtPosition(o,U,b)}return(R=P)!==null&&R!==void 0&&R.initSegment&&!((O=P)!==null&&O!==void 0&&O.initSegment.data)&&!this.bitrateTest&&(P=P.initSegment),P},u.getNextPart=function(o,b,R){for(var O=-1,C=!1,I=!0,F=0,M=o.length;F<M;F++){var P=o[F];if(I=I&&!P.independent,O>-1&&R<P.start)break;var N=P.loaded;!N&&(C||P.independent||I)&&P.fragment===b&&(O=F),C=N}return O},u.loadedEndOfParts=function(o,b){var R=o[o.length-1];return R&&b>R.start&&R.loaded},u.getInitialLiveFragment=function(o,b){var R=this.fragPrevious,O=null;if(R){if(o.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+R.programDateTime),O=Object(m.findFragmentByPDT)(b,R.endProgramDateTime,this.config.maxFragLookUpTolerance)),!O){var C=R.sn+1;if(C>=o.startSN&&C<=o.endSN){var I=b[C-o.startSN];R.cc===I.cc&&(O=I,this.log("Live playlist, switching playlist, load frag with next SN: "+O.sn))}O||(O=Object(m.findFragWithCC)(b,R.cc),O&&this.log("Live playlist, switching playlist, load frag with same CC: "+O.sn))}}else{var F=this.hls.liveSyncPosition;F!==null&&(O=this.getFragmentAtPosition(F,this.bitrateTest?o.fragmentEnd:o.edge,o))}return O},u.getFragmentAtPosition=function(o,b,R){var O=this.config,C=this.fragPrevious,I=R.fragments,F=R.endSN,M=R.fragmentHint,P=O.maxFragLookUpTolerance,N=!!(O.lowLatencyMode&&R.partList&&M);N&&M&&!this.bitrateTest&&(I=I.concat(M),F=M.sn);var U;if(o<b){var B=o>b-P?0:P;U=Object(m.findFragmentByPTS)(C,I,o,B)}else U=I[I.length-1];if(U){var G=U.sn-R.startSN,q=C&&U.level===C.level,K=I[G+1],W=this.fragmentTracker.getState(U);if(W===L.FragmentState.BACKTRACKED){U=null;for(var V=G;I[V]&&this.fragmentTracker.getState(I[V])===L.FragmentState.BACKTRACKED;)C?U=I[V--]:U=I[--V];U||(U=K)}else C&&U.sn===C.sn&&!N&&q&&(U.sn<F&&this.fragmentTracker.getState(K)!==L.FragmentState.OK?(this.log("SN "+U.sn+" just loaded, load next one: "+K.sn),U=K):U=null)}return U},u.synchronizeToLiveEdge=function(o){var b=this.config,R=this.media;if(R){var O=this.hls.liveSyncPosition,C=R.currentTime,I=o.fragments[0].start,F=o.edge,M=C>=I-b.maxFragLookUpTolerance&&C<=F;if(O!==null&&R.duration>O&&(C<O||!M)){var P=b.liveMaxLatencyDuration!==void 0?b.liveMaxLatencyDuration:b.liveMaxLatencyDurationCount*o.targetduration;(!M&&R.readyState<4||C<F-P)&&(this.loadedmetadata||(this.nextLoadPosition=O),R.readyState&&(this.warn("Playback: "+C.toFixed(3)+" is located too far from the end of live sliding playlist: "+F+", reset currentTime to : "+O.toFixed(3)),R.currentTime=O))}}},u.alignPlaylists=function(o,b){var R=this.levels,O=this.levelLastLoaded,C=this.fragPrevious,I=O!==null?R[O]:null,F=o.fragments.length;if(!F)return this.warn("No fragments in live playlist"),0;var M=o.fragments[0].start,P=!b,N=o.alignedSliding&&Object(w.isFiniteNumber)(M);if(P||!N&&!M){Object(T.alignStream)(C,I,o);var U=o.fragments[0].start;return this.log("Live playlist sliding: "+U.toFixed(2)+" start-sn: "+(b?b.startSN:"na")+"->"+o.startSN+" prev-sn: "+(C?C.sn:"na")+" fragments: "+F),U}return M},u.waitForCdnTuneIn=function(o){var b=3;return o.live&&o.canBlockReload&&o.tuneInGoal>Math.max(o.partHoldBack,o.partTarget*b)},u.setStartPosition=function(o,b){var R=this.startPosition;if(R<b&&(R=-1),R===-1||this.lastCurrentTime===-1){var O=o.startTimeOffset;Object(w.isFiniteNumber)(O)?(R=b+O,O<0&&(R+=o.totalduration),R=Math.min(Math.max(b,R),b+o.totalduration),this.log("Start time offset "+O+" found in playlist, adjust startPosition to "+R),this.startPosition=R):o.live?R=this.hls.liveSyncPosition||b:this.startPosition=R=0,this.lastCurrentTime=R}this.nextLoadPosition=R},u.getLoadPosition=function(){var o=this.media,b=0;return this.loadedmetadata&&o?b=o.currentTime:this.nextLoadPosition&&(b=this.nextLoadPosition),b},u.handleFragLoadAborted=function(o,b){this.transmuxer&&o.sn!=="initSegment"&&o.stats.aborted&&(this.warn("Fragment "+o.sn+(b?" part"+b.index:"")+" of level "+o.level+" was aborted"),this.resetFragmentLoading(o))},u.resetFragmentLoading=function(o){(!this.fragCurrent||!this.fragContextChanged(o))&&(this.state=f.IDLE)},u.onFragmentOrKeyLoadError=function(o,b){if(!b.fatal){var R=b.frag;if(!(!R||R.type!==o)){var O=this.fragCurrent;console.assert(O&&R.sn===O.sn&&R.level===O.level&&R.urlId===O.urlId,"Frag load error must match current frag to retry");var C=this.config;if(this.fragLoadError+1<=C.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(R.level))return;var I=Math.min(Math.pow(2,this.fragLoadError)*C.fragLoadingRetryDelay,C.fragLoadingMaxRetryTimeout);this.warn("Fragment "+R.sn+" of "+o+" "+R.level+" failed to load, retrying in "+I+"ms"),this.retryDate=self.performance.now()+I,this.fragLoadError++,this.state=f.FRAG_LOADING_WAITING_RETRY}else b.levelRetry?(o===i.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=f.IDLE):(A.logger.error(b.details+" reaches max retry, redispatch as fatal ..."),b.fatal=!0,this.hls.stopLoad(),this.state=f.ERROR)}}},u.afterBufferFlushed=function(o,b,R){if(o){var O=k.BufferHelper.getBuffered(o);this.fragmentTracker.detectEvictedFragments(b,O,R),this.state===f.ENDED&&this.resetLoadingState()}},u.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=f.IDLE},u.resetLiveStartWhenNotLoaded=function(o){if(!this.loadedmetadata){this.startFragRequested=!1;var b=this.levels?this.levels[o].details:null;if(b!=null&&b.live)return this.startPosition=-1,this.setStartPosition(b,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},u.updateLevelTiming=function(o,b,R,O){var C=this,I=R.details;console.assert(!!I,"level.details must be defined");var F=Object.keys(o.elementaryStreams).reduce(function(M,P){var N=o.elementaryStreams[P];if(N){var U=N.endPTS-N.startPTS;if(U<=0)return C.warn("Could not parse fragment "+o.sn+" "+P+" duration reliably ("+U+") resetting transmuxer to fallback to playlist timing"),C.resetTransmuxer(),M||!1;var B=O?0:Object(E.updateFragPTSDTS)(I,o,N.startPTS,N.endPTS,N.startDTS,N.endDTS);return C.hls.trigger(D.Events.LEVEL_PTS_UPDATED,{details:I,level:R,drift:B,type:P,frag:o,start:N.startPTS,end:N.endPTS}),!0}return M},!1);F?(this.state=f.PARSED,this.hls.trigger(D.Events.FRAG_PARSED,{frag:o,part:b})):this.resetLoadingState()},u.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},n(r,[{key:"state",get:function(){return this._state},set:function(o){var b=this._state;b!==o&&(this._state=o,this.log(b+"->"+o))}}]),r}(S.default)},"./src/controller/buffer-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return m});var w=p("./src/polyfills/number.ts"),S=p("./src/events.ts"),L=p("./src/utils/logger.ts"),k=p("./src/errors.ts"),A=p("./src/utils/buffer-helper.ts"),D=p("./src/utils/mediasource-helper.ts"),_=p("./src/loader/fragment.ts"),d=p("./src/controller/buffer-operation-queue.ts"),g=Object(D.getMediaSource)(),T=/([ha]vc.)(?:\.[^.,]+)+/,m=function(){function E(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var i=e.hls,c=e.media,n=e.mediaSource;L.logger.log("[buffer-controller]: Media source opened"),c&&(e.updateMediaElementDuration(),i.trigger(S.Events.MEDIA_ATTACHED,{media:c})),n&&n.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){L.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){L.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var l=E.prototype;return l.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},l.destroy=function(){this.unregisterListeners(),this.details=null},l.registerListeners=function(){var t=this.hls;t.on(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(S.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(S.Events.BUFFER_RESET,this.onBufferReset,this),t.on(S.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(S.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(S.Events.BUFFER_EOS,this.onBufferEos,this),t.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(S.Events.FRAG_PARSED,this.onFragParsed,this),t.on(S.Events.FRAG_CHANGED,this.onFragChanged,this)},l.unregisterListeners=function(){var t=this.hls;t.off(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(S.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(S.Events.BUFFER_RESET,this.onBufferReset,this),t.off(S.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(S.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(S.Events.BUFFER_EOS,this.onBufferEos,this),t.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(S.Events.FRAG_PARSED,this.onFragParsed,this),t.off(S.Events.FRAG_CHANGED,this.onFragChanged,this)},l._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new d.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},l.onManifestParsed=function(t,e){var i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,L.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},l.onMediaAttaching=function(t,e){var i=this.media=e.media;if(i&&g){var c=this.mediaSource=new g;c.addEventListener("sourceopen",this._onMediaSourceOpen),c.addEventListener("sourceended",this._onMediaSourceEnded),c.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(c),this._objectUrl=i.src}},l.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,i=this._objectUrl;if(e){if(L.logger.log("[buffer-controller]: media source detaching"),e.readyState==="open")try{e.endOfStream()}catch(c){L.logger.warn("[buffer-controller]: onMediaDetaching: "+c.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):L.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(S.Events.MEDIA_DETACHED,void 0)},l.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(e){var i=t.sourceBuffer[e];try{i&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(i),t.sourceBuffer[e]=void 0)}catch(c){L.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",c)}}),this._initSourceBuffer()},l.onBufferCodecs=function(t,e){var i=this,c=this.getSourceBufferTypes().length;Object.keys(e).forEach(function(n){if(c){var h=i.tracks[n];if(h&&typeof h.buffer.changeType=="function"){var v=e[n],y=v.codec,f=v.levelCodec,s=v.container,a=(h.levelCodec||h.codec).replace(T,"$1"),r=(f||y).replace(T,"$1");if(a!==r){var u=s+";codecs="+(f||y);i.appendChangeType(n,u)}}}else i.pendingTracks[n]=e[n]}),!c&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},l.appendChangeType=function(t,e){var i=this,c=this.operationQueue,n={execute:function(){var h=i.sourceBuffer[t];h&&(L.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),h.changeType(e)),c.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(h){L.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",h)}};c.append(n,t)},l.onBufferAppending=function(t,e){var i=this,c=this.hls,n=this.operationQueue,h=this.tracks,v=e.data,y=e.type,f=e.frag,s=e.part,a=e.chunkMeta,r=a.buffering[y],u=self.performance.now();r.start=u;var o=f.stats.buffering,b=s?s.stats.buffering:null;o.start===0&&(o.start=u),b&&b.start===0&&(b.start=u);var R=h.audio,O=y==="audio"&&a.id===1&&(R==null?void 0:R.container)==="audio/mpeg",C={execute:function(){if(r.executeStart=self.performance.now(),O){var I=i.sourceBuffer[y];if(I){var F=f.start-I.timestampOffset;Math.abs(F)>=.1&&(L.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+f.start+" (delta: "+F+") sn: "+f.sn+")"),I.timestampOffset=f.start)}}i.appendExecutor(v,y)},onStart:function(){},onComplete:function(){var I=self.performance.now();r.executeEnd=r.end=I,o.first===0&&(o.first=I),b&&b.first===0&&(b.first=I);var F=i.sourceBuffer,M={};for(var P in F)M[P]=A.BufferHelper.getBuffered(F[P]);i.appendError=0,i.hls.trigger(S.Events.BUFFER_APPENDED,{type:y,frag:f,part:s,chunkMeta:a,parent:f.type,timeRanges:M})},onError:function(I){L.logger.error("[buffer-controller]: Error encountered while trying to append to the "+y+" SourceBuffer",I);var F={type:k.ErrorTypes.MEDIA_ERROR,parent:f.type,details:k.ErrorDetails.BUFFER_APPEND_ERROR,err:I,fatal:!1};I.code===DOMException.QUOTA_EXCEEDED_ERR?F.details=k.ErrorDetails.BUFFER_FULL_ERROR:(i.appendError++,F.details=k.ErrorDetails.BUFFER_APPEND_ERROR,i.appendError>c.config.appendErrorMaxRetry&&(L.logger.error("[buffer-controller]: Failed "+c.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),F.fatal=!0)),c.trigger(S.Events.ERROR,F)}};n.append(C,y)},l.onBufferFlushing=function(t,e){var i=this,c=this.operationQueue,n=function(h){return{execute:i.removeExecutor.bind(i,h,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(S.Events.BUFFER_FLUSHED,{type:h})},onError:function(v){L.logger.warn("[buffer-controller]: Failed to remove from "+h+" SourceBuffer",v)}}};e.type?c.append(n(e.type),e.type):this.getSourceBufferTypes().forEach(function(h){c.append(n(h),h)})},l.onFragParsed=function(t,e){var i=this,c=e.frag,n=e.part,h=[],v=n?n.elementaryStreams:c.elementaryStreams;v[_.ElementaryStreamTypes.AUDIOVIDEO]?h.push("audiovideo"):(v[_.ElementaryStreamTypes.AUDIO]&&h.push("audio"),v[_.ElementaryStreamTypes.VIDEO]&&h.push("video"));var y=function(){var f=self.performance.now();c.stats.buffering.end=f,n&&(n.stats.buffering.end=f);var s=n?n.stats:c.stats;i.hls.trigger(S.Events.FRAG_BUFFERED,{frag:c,part:n,stats:s,id:c.type})};h.length===0&&L.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+c.type+" level: "+c.level+" sn: "+c.sn),this.blockBuffers(y,h)},l.onFragChanged=function(t,e){this.flushBackBuffer()},l.onBufferEos=function(t,e){var i=this,c=this.getSourceBufferTypes().reduce(function(n,h){var v=i.sourceBuffer[h];return(!e.type||e.type===h)&&v&&!v.ended&&(v.ended=!0,L.logger.log("[buffer-controller]: "+h+" sourceBuffer now EOS")),n&&!!(!v||v.ended)},!0);c&&this.blockBuffers(function(){var n=i.mediaSource;!n||n.readyState!=="open"||n.endOfStream()})},l.onLevelUpdated=function(t,e){var i=e.details;!i.fragments.length||(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},l.flushBackBuffer=function(){var t=this.hls,e=this.details,i=this.media,c=this.sourceBuffer;if(!(!i||e===null)){var n=this.getSourceBufferTypes();if(n.length){var h=e.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!(!Object(w.isFiniteNumber)(h)||h<0)){var v=i.currentTime,y=e.levelTargetDuration,f=Math.max(h,y),s=Math.floor(v/y)*y-f;n.forEach(function(a){var r=c[a];if(r){var u=A.BufferHelper.getBuffered(r);u.length>0&&s>u.start(0)&&(t.trigger(S.Events.BACK_BUFFER_REACHED,{bufferEnd:s}),e.live&&t.trigger(S.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s}),t.trigger(S.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:a}))}})}}}},l.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var t=this.details,e=this.hls,i=this.media,c=this.mediaSource,n=t.fragments[0].start+t.totalduration,h=i.duration,v=Object(w.isFiniteNumber)(c.duration)?c.duration:0;t.live&&e.config.liveDurationInfinity?(L.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),c.duration=1/0,this.updateSeekableRange(t)):(n>v&&n>h||!Object(w.isFiniteNumber)(h))&&(L.logger.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),c.duration=n)}},l.updateSeekableRange=function(t){var e=this.mediaSource,i=t.fragments,c=i.length;if(c&&t.live&&e!==null&&e!==void 0&&e.setLiveSeekableRange){var n=Math.max(0,i[0].start),h=Math.max(n,n+t.totalduration);e.setLiveSeekableRange(n,h)}},l.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,i=this.pendingTracks,c=Object.keys(i).length;if(c&&!t||c===2){this.createSourceBuffers(i),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length===0){this.hls.trigger(S.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}n.forEach(function(h){e.executeNext(h)})}},l.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var c=0;for(var n in t)if(!e[n]){var h=t[n];if(!h)throw Error("source buffer exists for track "+n+", however track does not");var v=h.levelCodec||h.codec,y=h.container+";codecs="+v;L.logger.log("[buffer-controller]: creating sourceBuffer("+y+")");try{var f=e[n]=i.addSourceBuffer(y),s=n;this.addBufferListener(s,"updatestart",this._onSBUpdateStart),this.addBufferListener(s,"updateend",this._onSBUpdateEnd),this.addBufferListener(s,"error",this._onSBUpdateError),this.tracks[n]={buffer:f,codec:v,container:h.container,levelCodec:h.levelCodec,id:h.id},c++}catch(a){L.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+a.message),this.hls.trigger(S.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:a,mimeType:y})}}c&&this.hls.trigger(S.Events.BUFFER_CREATED,{tracks:this.tracks})},l._onSBUpdateStart=function(t){var e=this.operationQueue,i=e.current(t);i.onStart()},l._onSBUpdateEnd=function(t){var e=this.operationQueue,i=e.current(t);i.onComplete(),e.shiftAndExecuteNext(t)},l._onSBUpdateError=function(t,e){L.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(S.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(t);i&&i.onError(e)},l.removeExecutor=function(t,e,i){var c=this.media,n=this.mediaSource,h=this.operationQueue,v=this.sourceBuffer,y=v[t];if(!c||!n||!y){L.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),h.shiftAndExecuteNext(t);return}var f=Object(w.isFiniteNumber)(c.duration)?c.duration:1/0,s=Object(w.isFiniteNumber)(n.duration)?n.duration:1/0,a=Math.max(0,e),r=Math.min(i,f,s);r>a?(L.logger.log("[buffer-controller]: Removing ["+a+","+r+"] from the "+t+" SourceBuffer"),console.assert(!y.updating,t+" sourceBuffer must not be updating"),y.remove(a,r)):h.shiftAndExecuteNext(t)},l.appendExecutor=function(t,e){var i=this.operationQueue,c=this.sourceBuffer,n=c[e];if(!n){L.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(e);return}n.ended=!1,console.assert(!n.updating,e+" sourceBuffer must not be updating"),n.appendBuffer(t)},l.blockBuffers=function(t,e){var i=this;if(e===void 0&&(e=this.getSourceBufferTypes()),!e.length){L.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve(t);return}var c=this.operationQueue,n=e.map(function(h){return c.appendBlocker(h)});Promise.all(n).then(function(){t(),e.forEach(function(h){var v=i.sourceBuffer[h];(!v||!v.updating)&&c.shiftAndExecuteNext(h)})})},l.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},l.addBufferListener=function(t,e,i){var c=this.sourceBuffer[t];if(c){var n=i.bind(this,t);this.listeners[t].push({event:e,listener:n}),c.addEventListener(e,n)}},l.removeBufferListeners=function(t){var e=this.sourceBuffer[t];!e||this.listeners[t].forEach(function(i){e.removeEventListener(i.event,i.listener)})},E}()},"./src/controller/buffer-operation-queue.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return S});var w=p("./src/utils/logger.ts"),S=function(){function L(A){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=A}var k=L.prototype;return k.append=function(A,D){var _=this.queues[D];_.push(A),_.length===1&&this.buffers[D]&&this.executeNext(D)},k.insertAbort=function(A,D){var _=this.queues[D];_.unshift(A),this.executeNext(D)},k.appendBlocker=function(A){var D,_=new Promise(function(g){D=g}),d={execute:D,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(d,A),_},k.executeNext=function(A){var D=this.buffers,_=this.queues,d=D[A],g=_[A];if(g.length){var T=g[0];try{T.execute()}catch(m){w.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),T.onError(m),(!d||!d.updating)&&(g.shift(),this.executeNext(A))}}},k.shiftAndExecuteNext=function(A){this.queues[A].shift(),this.executeNext(A)},k.current=function(A){return this.queues[A][0]},L}()},"./src/controller/cap-level-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/events.ts");function S(A,D){for(var _=0;_<D.length;_++){var d=D[_];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(A,d.key,d)}}function L(A,D,_){return D&&S(A.prototype,D),_&&S(A,_),A}var k=function(){function A(_){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=_,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var D=A.prototype;return D.setStreamController=function(_){this.streamController=_},D.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},D.registerListeners=function(){var _=this.hls;_.on(w.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),_.on(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.on(w.Events.BUFFER_CODECS,this.onBufferCodecs,this),_.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},D.unregisterListener=function(){var _=this.hls;_.off(w.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),_.off(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),_.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.off(w.Events.BUFFER_CODECS,this.onBufferCodecs,this),_.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},D.onFpsDropLevelCapping=function(_,d){A.isLevelAllowed(d.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(d.droppedLevel)},D.onMediaAttaching=function(_,d){this.media=d.media instanceof HTMLVideoElement?d.media:null},D.onManifestParsed=function(_,d){var g=this.hls;this.restrictedLevels=[],this.firstLevel=d.firstLevel,g.config.capLevelToPlayerSize&&d.video&&this.startCapping()},D.onBufferCodecs=function(_,d){var g=this.hls;g.config.capLevelToPlayerSize&&d.video&&this.startCapping()},D.onMediaDetaching=function(){this.stopCapping()},D.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var _=this.hls.levels;if(_.length){var d=this.hls;d.autoLevelCapping=this.getMaxLevel(_.length-1),d.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=d.autoLevelCapping}}},D.getMaxLevel=function(_){var d=this,g=this.hls.levels;if(!g.length)return-1;var T=g.filter(function(m,E){return A.isLevelAllowed(E,d.restrictedLevels)&&E<=_});return this.clientRect=null,A.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},D.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},D.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},D.getDimensions=function(){if(this.clientRect)return this.clientRect;var _=this.media,d={width:0,height:0};if(_){var g=_.getBoundingClientRect();d.width=g.width,d.height=g.height,!d.width&&!d.height&&(d.width=g.right-g.left||_.width||0,d.height=g.bottom-g.top||_.height||0)}return this.clientRect=d,d},A.isLevelAllowed=function(_,d){return d===void 0&&(d=[]),d.indexOf(_)===-1},A.getMaxLevelByMediaSize=function(_,d,g){if(!_||!_.length)return-1;for(var T=function(t,e){return e?t.width!==e.width||t.height!==e.height:!0},m=_.length-1,E=0;E<_.length;E+=1){var l=_[E];if((l.width>=d||l.height>=g)&&T(l,_[E+1])){m=E;break}}return m},L(A,[{key:"mediaWidth",get:function(){return this.getDimensions().width*A.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*A.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var _=1;try{_=self.devicePixelRatio}catch{}return _}}]),A}();x.default=k},"./src/controller/eme-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/events.ts"),S=p("./src/errors.ts"),L=p("./src/utils/logger.ts"),k=p("./src/utils/mediakeys-helper.ts");function A(m,E){for(var l=0;l<E.length;l++){var t=E[l];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}function D(m,E,l){return E&&A(m.prototype,E),l&&A(m,l),m}var _=3,d=function(m,E,l){var t={audioCapabilities:[],videoCapabilities:[]};return m.forEach(function(e){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:l.audioRobustness||""})}),E.forEach(function(e){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:l.videoRobustness||""})}),[t]},g=function(m,E,l,t){switch(m){case k.KeySystems.WIDEVINE:return d(E,l,t);default:throw new Error("Unknown key-system: "+m)}},T=function(){function m(l){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=l,this._config=l.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var E=m.prototype;return E.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},E._registerListeners=function(){this.hls.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(w.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E._unregisterListeners=function(){this.hls.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(w.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this)},E.getLicenseServerUrl=function(l){switch(l){case k.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+l+'"')},E._attemptKeySystemAccess=function(l,t,e){var i=this,c=g(l,t,e,this._drmSystemOptions);L.logger.log("Requesting encrypted media key-system access");var n=this.requestMediaKeySystemAccess(l,c);this.mediaKeysPromise=n.then(function(h){return i._onMediaKeySystemAccessObtained(l,h)}),n.catch(function(h){L.logger.error('Failed to obtain key-system "'+l+'" access:',h)})},E._onMediaKeySystemAccessObtained=function(l,t){var e=this;L.logger.log('Access for key-system "'+l+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:l};this._mediaKeysList.push(i);var c=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(n){return i.mediaKeys=n,L.logger.log('Media-keys created for key-system "'+l+'"'),e._onMediaKeysCreated(),n});return c.catch(function(n){L.logger.error("Failed to create media-keys:",n)}),c},E._onMediaKeysCreated=function(){var l=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),l._onNewMediaKeySession(t.mediaKeysSession))})},E._onNewMediaKeySession=function(l){var t=this;L.logger.log("New key-system session "+l.sessionId),l.addEventListener("message",function(e){t._onKeySessionMessage(l,e.message)},!1)},E._onKeySessionMessage=function(l,t){L.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(e){L.logger.log("Received license data (length: "+(e&&e.byteLength)+"), updating key-session"),l.update(e)})},E.onMediaEncrypted=function(l){var t=this;if(L.logger.log('Media is encrypted using "'+l.initDataType+'" init data type'),!this.mediaKeysPromise){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var e=function(i){!t._media||(t._attemptSetMediaKeys(i),t._generateRequestWithPreferredKeySession(l.initDataType,l.initData))};this.mediaKeysPromise.then(e).catch(e)},E._attemptSetMediaKeys=function(l){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){L.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}L.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},E._generateRequestWithPreferredKeySession=function(l,t){var e=this,i=this._mediaKeysList[0];if(!i){L.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(i.mediaKeysSessionInitialized){L.logger.warn("Key-Session already initialized but requested again");return}var c=i.mediaKeysSession;if(!c){L.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){L.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}L.logger.log('Generating key-session request for "'+l+'" init data type'),i.mediaKeysSessionInitialized=!0,c.generateRequest(l,t).then(function(){L.logger.debug("Key-session generation succeeded")}).catch(function(n){L.logger.error("Error generating key-session request:",n),e.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},E._createLicenseXhr=function(l,t,e){var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,l,t,e);var c=this._licenseXhrSetup;if(c)try{c.call(this.hls,i,l),c=void 0}catch(n){L.logger.error(n)}try{i.readyState||i.open("POST",l,!0),c&&c.call(this.hls,i,l)}catch(n){throw new Error("issue setting up KeySystem license XHR "+n)}return i},E._onLicenseRequestReadyStageChange=function(l,t,e,i){switch(l.readyState){case 4:if(l.status===200){this._requestLicenseFailureCount=0,L.logger.log("License request succeeded");var c=l.response,n=this._licenseResponseCallback;if(n)try{c=n.call(this.hls,l,t)}catch(v){L.logger.error(v)}i(c)}else{if(L.logger.error("License Request XHR failed ("+t+"). Status: "+l.status+" ("+l.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>_){this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var h=_-this._requestLicenseFailureCount+1;L.logger.warn("Retrying license request, "+h+" attempts left"),this._requestLicense(e,i)}break}},E._generateLicenseRequestChallenge=function(l,t){switch(l.mediaKeySystemDomain){case k.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+l.mediaKeySystemDomain)},E._requestLicense=function(l,t){L.logger.log("Requesting content license for key-system");var e=this._mediaKeysList[0];if(!e){L.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var i=this.getLicenseServerUrl(e.mediaKeySystemDomain),c=this._createLicenseXhr(i,l,t);L.logger.log("Sending license request to URL: "+i);var n=this._generateLicenseRequestChallenge(e,l);c.send(n)}catch(h){L.logger.error("Failure requesting DRM license: "+h),this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.KEY_SYSTEM_ERROR,details:S.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},E.onMediaAttached=function(l,t){if(this._emeEnabled){var e=t.media;this._media=e,e.addEventListener("encrypted",this._onMediaEncrypted)}},E.onMediaDetached=function(){var l=this._media,t=this._mediaKeysList;!l||(l.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch(function(){})})).then(function(){return l.setMediaKeys(null)}).catch(function(){}))},E.onManifestParsed=function(l,t){if(this._emeEnabled){var e=t.levels.map(function(c){return c.audioCodec}).filter(function(c){return!!c}),i=t.levels.map(function(c){return c.videoCodec}).filter(function(c){return!!c});this._attemptKeySystemAccess(k.KeySystems.WIDEVINE,e,i)}},D(m,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),m}();x.default=T},"./src/controller/fps-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/events.ts"),S=p("./src/utils/logger.ts"),L=function(){function k(D){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=D,this.registerListeners()}var A=k.prototype;return A.setStreamController=function(D){this.streamController=D},A.registerListeners=function(){this.hls.on(w.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},A.unregisterListeners=function(){this.hls.off(w.Events.MEDIA_ATTACHING,this.onMediaAttaching)},A.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},A.onMediaAttaching=function(D,_){var d=this.hls.config;if(d.capLevelOnFPSDrop){var g=_.media instanceof self.HTMLVideoElement?_.media:null;this.media=g,g&&typeof g.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),d.fpsDroppedMonitoringPeriod)}},A.checkFPS=function(D,_,d){var g=performance.now();if(_){if(this.lastTime){var T=g-this.lastTime,m=d-this.lastDroppedFrames,E=_-this.lastDecodedFrames,l=1e3*m/T,t=this.hls;if(t.trigger(w.Events.FPS_DROP,{currentDropped:m,currentDecoded:E,totalDroppedFrames:d}),l>0&&m>t.config.fpsDroppedMonitoringThreshold*E){var e=t.currentLevel;S.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+e),e>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=e)&&(e=e-1,t.trigger(w.Events.FPS_DROP_LEVEL_CAPPING,{level:e,droppedLevel:t.currentLevel}),t.autoLevelCapping=e,this.streamController.nextLevelSwitch())}}this.lastTime=g,this.lastDroppedFrames=d,this.lastDecodedFrames=_}},A.checkFPSInterval=function(){var D=this.media;if(D)if(this.isVideoPlaybackQualityAvailable){var _=D.getVideoPlaybackQuality();this.checkFPS(D,_.totalVideoFrames,_.droppedVideoFrames)}else this.checkFPS(D,D.webkitDecodedFrameCount,D.webkitDroppedFrameCount)},k}();x.default=L},"./src/controller/fragment-finders.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"findFragmentByPDT",function(){return L}),p.d(x,"findFragmentByPTS",function(){return k}),p.d(x,"fragmentWithinToleranceTest",function(){return A}),p.d(x,"pdtWithinToleranceTest",function(){return D}),p.d(x,"findFragWithCC",function(){return _});var w=p("./src/polyfills/number.ts"),S=p("./src/utils/binary-search.ts");function L(d,g,T){if(g===null||!Array.isArray(d)||!d.length||!Object(w.isFiniteNumber)(g))return null;var m=d[0].programDateTime;if(g<(m||0))return null;var E=d[d.length-1].endProgramDateTime;if(g>=(E||0))return null;T=T||0;for(var l=0;l<d.length;++l){var t=d[l];if(D(g,T,t))return t}return null}function k(d,g,T,m){T===void 0&&(T=0),m===void 0&&(m=0);var E=null;if(d?E=g[d.sn-g[0].sn+1]||null:T===0&&g[0].start===0&&(E=g[0]),E&&A(T,m,E)===0)return E;var l=S.default.search(g,A.bind(null,T,m));return l||E}function A(d,g,T){d===void 0&&(d=0),g===void 0&&(g=0);var m=Math.min(g,T.duration+(T.deltaPTS?T.deltaPTS:0));return T.start+T.duration-m<=d?1:T.start-m>d&&T.start?-1:0}function D(d,g,T){var m=Math.min(g,T.duration+(T.deltaPTS?T.deltaPTS:0))*1e3,E=T.endProgramDateTime||0;return E-m>d}function _(d,g){return S.default.search(d,function(T){return T.cc<g?1:T.cc>g?-1:0})}},"./src/controller/fragment-tracker.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"FragmentState",function(){return L}),p.d(x,"FragmentTracker",function(){return k});var w=p("./src/events.ts"),S=p("./src/types/loader.ts"),L;(function(_){_.NOT_LOADED="NOT_LOADED",_.BACKTRACKED="BACKTRACKED",_.APPENDING="APPENDING",_.PARTIAL="PARTIAL",_.OK="OK"})(L||(L={}));var k=function(){function _(g){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=g,this._registerListeners()}var d=_.prototype;return d._registerListeners=function(){var g=this.hls;g.on(w.Events.BUFFER_APPENDED,this.onBufferAppended,this),g.on(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.on(w.Events.FRAG_LOADED,this.onFragLoaded,this)},d._unregisterListeners=function(){var g=this.hls;g.off(w.Events.BUFFER_APPENDED,this.onBufferAppended,this),g.off(w.Events.FRAG_BUFFERED,this.onFragBuffered,this),g.off(w.Events.FRAG_LOADED,this.onFragLoaded,this)},d.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},d.getAppendedFrag=function(g,T){if(T===S.PlaylistLevelType.MAIN){var m=this.activeFragment,E=this.activeParts;if(!m)return null;if(E)for(var l=E.length;l--;){var t=E[l],e=t?t.end:m.appendedPTS;if(t.start<=g&&e!==void 0&&g<=e)return l>9&&(this.activeParts=E.slice(l-9)),t}else if(m.start<=g&&m.appendedPTS!==void 0&&g<=m.appendedPTS)return m}return this.getBufferedFrag(g,T)},d.getBufferedFrag=function(g,T){for(var m=this.fragments,E=Object.keys(m),l=E.length;l--;){var t=m[E[l]];if((t==null?void 0:t.body.type)===T&&t.buffered){var e=t.body;if(e.start<=g&&g<=e.end)return e}}return null},d.detectEvictedFragments=function(g,T,m){var E=this;Object.keys(this.fragments).forEach(function(l){var t=E.fragments[l];if(t){if(!t.buffered){t.body.type===m&&E.removeFragment(t.body);return}var e=t.range[g];!e||e.time.some(function(i){var c=!E.isTimeBuffered(i.startPTS,i.endPTS,T);return c&&E.removeFragment(t.body),c})}})},d.detectPartialFragments=function(g){var T=this,m=this.timeRanges,E=g.frag,l=g.part;if(!(!m||E.sn==="initSegment")){var t=D(E),e=this.fragments[t];!e||(Object.keys(m).forEach(function(i){var c=E.elementaryStreams[i];if(c){var n=m[i],h=l!==null||c.partial===!0;e.range[i]=T.getBufferedTimes(E,l,h,n)}}),e.backtrack=e.loaded=null,Object.keys(e.range).length?e.buffered=!0:this.removeFragment(e.body))}},d.fragBuffered=function(g){var T=D(g),m=this.fragments[T];m&&(m.backtrack=m.loaded=null,m.buffered=!0)},d.getBufferedTimes=function(g,T,m,E){for(var l={time:[],partial:m},t=T?T.start:g.start,e=T?T.end:g.end,i=g.minEndPTS||e,c=g.maxStartPTS||t,n=0;n<E.length;n++){var h=E.start(n)-this.bufferPadding,v=E.end(n)+this.bufferPadding;if(c>=h&&i<=v){l.time.push({startPTS:Math.max(t,E.start(n)),endPTS:Math.min(e,E.end(n))});break}else if(t<v&&e>h)l.partial=!0,l.time.push({startPTS:Math.max(t,E.start(n)),endPTS:Math.min(e,E.end(n))});else if(e<=h)break}return l},d.getPartialFragment=function(g){var T=null,m,E,l,t=0,e=this.bufferPadding,i=this.fragments;return Object.keys(i).forEach(function(c){var n=i[c];!n||A(n)&&(E=n.body.start-e,l=n.body.end+e,g>=E&&g<=l&&(m=Math.min(g-E,l-g),t<=m&&(T=n.body,t=m)))}),T},d.getState=function(g){var T=D(g),m=this.fragments[T];return m?m.buffered?A(m)?L.PARTIAL:L.OK:m.backtrack?L.BACKTRACKED:L.APPENDING:L.NOT_LOADED},d.backtrack=function(g,T){var m=D(g),E=this.fragments[m];if(!E||E.backtrack)return null;var l=E.backtrack=T||E.loaded;return E.loaded=null,l},d.getBacktrackData=function(g){var T=D(g),m=this.fragments[T];if(m){var E,l=m.backtrack;if(l!=null&&(E=l.payload)!==null&&E!==void 0&&E.byteLength)return l;this.removeFragment(g)}return null},d.isTimeBuffered=function(g,T,m){for(var E,l,t=0;t<m.length;t++){if(E=m.start(t)-this.bufferPadding,l=m.end(t)+this.bufferPadding,g>=E&&T<=l)return!0;if(T<=E)return!1}return!1},d.onFragLoaded=function(g,T){var m=T.frag,E=T.part;if(!(m.sn==="initSegment"||m.bitrateTest||E)){var l=D(m);this.fragments[l]={body:m,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},d.onBufferAppended=function(g,T){var m=this,E=T.frag,l=T.part,t=T.timeRanges;if(E.type===S.PlaylistLevelType.MAIN)if(this.activeFragment=E,l){var e=this.activeParts;e||(this.activeParts=e=[]),e.push(l)}else this.activeParts=null;this.timeRanges=t,Object.keys(t).forEach(function(i){var c=t[i];if(m.detectEvictedFragments(i,c),!l)for(var n=0;n<c.length;n++)E.appendedPTS=Math.max(c.end(n),E.appendedPTS||0)})},d.onFragBuffered=function(g,T){this.detectPartialFragments(T)},d.hasFragment=function(g){var T=D(g);return!!this.fragments[T]},d.removeFragmentsInRange=function(g,T,m){var E=this;Object.keys(this.fragments).forEach(function(l){var t=E.fragments[l];if(!!t&&t.buffered){var e=t.body;e.type===m&&e.start<T&&e.end>g&&E.removeFragment(e)}})},d.removeFragment=function(g){var T=D(g);g.stats.loaded=0,g.clearElementaryStreamInfo(),delete this.fragments[T]},d.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},_}();function A(_){var d,g;return _.buffered&&(((d=_.range.video)===null||d===void 0?void 0:d.partial)||((g=_.range.audio)===null||g===void 0?void 0:g.partial))}function D(_){return _.type+"_"+_.level+"_"+_.urlId+"_"+_.sn}},"./src/controller/gap-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"STALL_MINIMUM_DURATION_MS",function(){return A}),p.d(x,"MAX_START_GAP_JUMP",function(){return D}),p.d(x,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return _}),p.d(x,"SKIP_BUFFER_RANGE_START",function(){return d}),p.d(x,"default",function(){return g});var w=p("./src/utils/buffer-helper.ts"),S=p("./src/errors.ts"),L=p("./src/events.ts"),k=p("./src/utils/logger.ts"),A=250,D=2,_=.1,d=.05,g=function(){function T(E,l,t,e){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=E,this.media=l,this.fragmentTracker=t,this.hls=e}var m=T.prototype;return m.destroy=function(){this.hls=this.fragmentTracker=this.media=null},m.poll=function(E){var l=this.config,t=this.media,e=this.stalled,i=t.currentTime,c=t.seeking,n=this.seeking&&!c,h=!this.seeking&&c;if(this.seeking=c,i!==E){if(this.moved=!0,e!==null){if(this.stallReported){var v=self.performance.now()-e;k.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((h||n)&&(this.stalled=null),!(t.paused||t.ended||t.playbackRate===0||!w.BufferHelper.getBuffered(t).length)){var y=w.BufferHelper.bufferInfo(t,i,0),f=y.len>0,s=y.nextStart||0;if(!(!f&&!s)){if(c){var a=y.len>D,r=!s||s-i>D&&!this.fragmentTracker.getPartialFragment(i);if(a||r)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var u,o=Math.max(s,y.start||0)-i,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,R=b==null||(u=b.details)===null||u===void 0?void 0:u.live,O=R?b.details.targetduration*2:D;if(o>0&&o<=O){this._trySkipBufferHole(null);return}}var C=self.performance.now();if(e===null){this.stalled=C;return}var I=C-e;!c&&I>=A&&this._reportStall(y.len);var F=w.BufferHelper.bufferInfo(t,i,l.maxBufferHole);this._tryFixBufferStall(F,I)}}},m._tryFixBufferStall=function(E,l){var t=this.config,e=this.fragmentTracker,i=this.media,c=i.currentTime,n=e.getPartialFragment(c);if(n){var h=this._trySkipBufferHole(n);if(h)return}E.len>t.maxBufferHole&&l>t.highBufferWatchdogPeriod*1e3&&(k.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},m._reportStall=function(E){var l=this.hls,t=this.media,e=this.stallReported;e||(this.stallReported=!0,k.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer (buffer="+E+")"),l.trigger(L.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:E}))},m._trySkipBufferHole=function(E){for(var l=this.config,t=this.hls,e=this.media,i=e.currentTime,c=0,n=w.BufferHelper.getBuffered(e),h=0;h<n.length;h++){var v=n.start(h);if(i+l.maxBufferHole>=c&&i<v){var y=Math.max(v+d,e.currentTime+_);return k.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+y),this.moved=!0,this.stalled=null,e.currentTime=y,E&&t.trigger(L.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+y,frag:E}),y}c=n.end(h)}return 0},m._tryNudgeBuffer=function(){var E=this.config,l=this.hls,t=this.media,e=t.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<E.nudgeMaxRetry){var c=e+i*E.nudgeOffset;k.logger.warn("Nudging 'currentTime' from "+e+" to "+c),t.currentTime=c,l.trigger(L.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else k.logger.error("Playhead still not moving while enough data buffered @"+e+" after "+E.nudgeMaxRetry+" nudges"),l.trigger(L.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},T}()},"./src/controller/id3-track-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/events.ts"),S=p("./src/utils/texttrack-utils.ts"),L=p("./src/demux/id3.ts"),k=.25,A=function(){function D(d){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=d,this._registerListeners()}var _=D.prototype;return _.destroy=function(){this._unregisterListeners()},_._registerListeners=function(){var d=this.hls;d.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.on(w.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),d.on(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_._unregisterListeners=function(){var d=this.hls;d.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),d.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(w.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),d.off(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},_.onMediaAttached=function(d,g){this.media=g.media},_.onMediaDetaching=function(){!this.id3Track||(Object(S.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},_.getID3Track=function(d){if(this.media){for(var g=0;g<d.length;g++){var T=d[g];if(T.kind==="metadata"&&T.label==="id3")return Object(S.sendAddTrackEvent)(T,this.media),T}return this.media.addTextTrack("metadata","id3")}},_.onFragParsingMetadata=function(d,g){if(this.media){var T=g.frag,m=g.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var E=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,l=0;l<m.length;l++){var t=L.getID3Frames(m[l].data);if(t){var e=m[l].pts,i=l<m.length-1?m[l+1].pts:T.end,c=i-e;c<=0&&(i=e+k);for(var n=0;n<t.length;n++){var h=t[n];if(!L.isTimeStampFrame(h)){var v=new E(e,i,"");v.value=h,this.id3Track.addCue(v)}}}}}},_.onBufferFlushing=function(d,g){var T=g.startOffset,m=g.endOffset,E=g.type;if(!E||E==="audio"){var l=this.id3Track;l&&Object(S.removeCuesInRange)(l,T,m)}},D}();x.default=A},"./src/controller/latency-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return D});var w=p("./src/errors.ts"),S=p("./src/events.ts"),L=p("./src/utils/logger.ts");function k(_,d){for(var g=0;g<d.length;g++){var T=d[g];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}function A(_,d,g){return d&&k(_.prototype,d),g&&k(_,g),_}var D=function(){function _(g){var T=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return T.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var d=_.prototype;return d.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},d.registerListeners=function(){this.hls.on(S.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(S.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(S.Events.ERROR,this.onError,this)},d.unregisterListeners=function(){this.hls.off(S.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(S.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(S.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(S.Events.ERROR,this.onError)},d.onMediaAttached=function(g,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},d.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},d.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},d.onLevelUpdated=function(g,T){var m=T.details;this.levelDetails=m,m.advanced&&this.timeupdate(),!m.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},d.onError=function(g,T){T.details===w.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,L.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},d.timeupdate=function(){var g=this.media,T=this.levelDetails;if(!(!g||!T)){this.currentTime=g.currentTime;var m=this.computeLatency();if(m!==null){this._latency=m;var E=this.config,l=E.lowLatencyMode,t=E.maxLiveSyncPlaybackRate;if(!(!l||t===1)){var e=this.targetLatency;if(e!==null){var i=m-e,c=Math.min(this.maxLatency,e+T.targetduration),n=i<c;if(T.live&&n&&i>.05&&this.forwardBufferLength>1){var h=Math.min(2,Math.max(1,t)),v=Math.round(2/(1+Math.exp(-.75*i-this.edgeStalled))*20)/20;g.playbackRate=Math.min(h,Math.max(1,v))}else g.playbackRate!==1&&g.playbackRate!==0&&(g.playbackRate=1)}}}}},d.estimateLiveEdge=function(){var g=this.levelDetails;return g===null?null:g.edge+g.age},d.computeLatency=function(){var g=this.estimateLiveEdge();return g===null?null:g-this.currentTime},A(_,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var g=this.config,T=this.levelDetails;return g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:T?g.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var g=this.levelDetails;if(g===null)return null;var T=g.holdBack,m=g.partHoldBack,E=g.targetduration,l=this.config,t=l.liveSyncDuration,e=l.liveSyncDurationCount,i=l.lowLatencyMode,c=this.hls.userConfig,n=i&&m||T;(c.liveSyncDuration||c.liveSyncDurationCount||n===0)&&(n=t!==void 0?t:e*E);var h=E,v=1;return n+Math.min(this.stallCount*v,h)}},{key:"liveSyncPosition",get:function(){var g=this.estimateLiveEdge(),T=this.targetLatency,m=this.levelDetails;if(g===null||T===null||m===null)return null;var E=m.edge,l=g-T-this.edgeStalled,t=E-m.totalduration,e=E-(this.config.lowLatencyMode&&m.partTarget||m.targetduration);return Math.min(Math.max(t,l),e)}},{key:"drift",get:function(){var g=this.levelDetails;return g===null?1:g.drift}},{key:"edgeStalled",get:function(){var g=this.levelDetails;if(g===null)return 0;var T=(this.config.lowLatencyMode&&g.partTarget||g.targetduration)*3;return Math.max(g.age-T,0)}},{key:"forwardBufferLength",get:function(){var g=this.media,T=this.levelDetails;if(!g||!T)return 0;var m=g.buffered.length;return m?g.buffered.end(m-1):T.edge-this.currentTime}}]),_}()},"./src/controller/level-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return t});var w=p("./src/types/level.ts"),S=p("./src/events.ts"),L=p("./src/errors.ts"),k=p("./src/utils/codecs.ts"),A=p("./src/controller/level-helper.ts"),D=p("./src/controller/base-playlist-controller.ts"),_=p("./src/types/loader.ts");function d(){return d=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var c=arguments[i];for(var n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n])}return e},d.apply(this,arguments)}function g(e,i){for(var c=0;c<i.length;c++){var n=i[c];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,i,c){return i&&g(e.prototype,i),c&&g(e,c),e}function m(e,i){e.prototype=Object.create(i.prototype),e.prototype.constructor=e,E(e,i)}function E(e,i){return E=Object.setPrototypeOf||function(c,n){return c.__proto__=n,c},E(e,i)}var l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t=function(e){m(i,e);function i(n){var h;return h=e.call(this,n,"[level-controller]")||this,h._levels=[],h._firstLevel=-1,h._startLevel=void 0,h.currentLevelIndex=-1,h.manualLevelIndex=-1,h.onParsedComplete=void 0,h._registerListeners(),h}var c=i.prototype;return c._registerListeners=function(){var n=this.hls;n.on(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(S.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(S.Events.ERROR,this.onError,this)},c._unregisterListeners=function(){var n=this.hls;n.off(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(S.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(S.Events.ERROR,this.onError,this)},c.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},c.startLoad=function(){var n=this._levels;n.forEach(function(h){h.loadError=0}),e.prototype.startLoad.call(this)},c.onManifestLoaded=function(n,h){var v=[],y=[],f=[],s,a={},r,u=!1,o=!1,b=!1;if(h.levels.forEach(function(I){var F=I.attrs;u=u||!!(I.width&&I.height),o=o||!!I.videoCodec,b=b||!!I.audioCodec,l&&I.audioCodec&&I.audioCodec.indexOf("mp4a.40.34")!==-1&&(I.audioCodec=void 0);var M=I.bitrate+"-"+I.attrs.RESOLUTION+"-"+I.attrs.CODECS;r=a[M],r?r.url.push(I.url):(r=new w.Level(I),a[M]=r,v.push(r)),F&&(F.AUDIO&&Object(A.addGroupId)(r,"audio",F.AUDIO),F.SUBTITLES&&Object(A.addGroupId)(r,"text",F.SUBTITLES))}),(u||o)&&b&&(v=v.filter(function(I){var F=I.videoCodec,M=I.width,P=I.height;return!!F||!!(M&&P)})),v=v.filter(function(I){var F=I.audioCodec,M=I.videoCodec;return(!F||Object(k.isCodecSupportedInMp4)(F,"audio"))&&(!M||Object(k.isCodecSupportedInMp4)(M,"video"))}),h.audioTracks&&(y=h.audioTracks.filter(function(I){return!I.audioCodec||Object(k.isCodecSupportedInMp4)(I.audioCodec,"audio")}),Object(A.assignTrackIdsByGroup)(y)),h.subtitles&&(f=h.subtitles,Object(A.assignTrackIdsByGroup)(f)),v.length>0){s=v[0].bitrate,v.sort(function(I,F){return I.bitrate-F.bitrate}),this._levels=v;for(var R=0;R<v.length;R++)if(v[R].bitrate===s){this._firstLevel=R,this.log("manifest loaded, "+v.length+" level(s) found, first bitrate: "+s);break}var O=b&&!o,C={levels:v,audioTracks:y,subtitleTracks:f,firstLevel:this._firstLevel,stats:h.stats,audio:b,video:o,altAudio:!O&&y.some(function(I){return!!I.url})};this.hls.trigger(S.Events.MANIFEST_PARSED,C),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(S.Events.ERROR,{type:L.ErrorTypes.MEDIA_ERROR,details:L.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:h.url,reason:"no level with compatible codecs found in manifest"})},c.onError=function(n,h){if(e.prototype.onError.call(this,n,h),!h.fatal){var v=h.context,y=this._levels[this.currentLevelIndex];if(v&&(v.type===_.PlaylistContextType.AUDIO_TRACK&&y.audioGroupIds&&v.groupId===y.audioGroupIds[y.urlId]||v.type===_.PlaylistContextType.SUBTITLE_TRACK&&y.textGroupIds&&v.groupId===y.textGroupIds[y.urlId])){this.redundantFailover(this.currentLevelIndex);return}var f=!1,s=!0,a;switch(h.details){case L.ErrorDetails.FRAG_LOAD_ERROR:case L.ErrorDetails.FRAG_LOAD_TIMEOUT:case L.ErrorDetails.KEY_LOAD_ERROR:case L.ErrorDetails.KEY_LOAD_TIMEOUT:if(h.frag){var r=this._levels[h.frag.level];r?(r.fragmentError++,r.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=h.frag.level)):a=h.frag.level}break;case L.ErrorDetails.LEVEL_LOAD_ERROR:case L.ErrorDetails.LEVEL_LOAD_TIMEOUT:v&&(v.deliveryDirectives&&(s=!1),a=v.level),f=!0;break;case L.ErrorDetails.REMUX_ALLOC_ERROR:a=h.level,f=!0;break}a!==void 0&&this.recoverLevel(h,a,f,s)}},c.recoverLevel=function(n,h,v,y){var f=n.details,s=this._levels[h];if(s.loadError++,v){var a=this.retryLoadingOrFail(n);if(a)n.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(y){var r=s.url.length;if(r>1&&s.loadError<r)n.levelRetry=!0,this.redundantFailover(h);else if(this.manualLevelIndex===-1){var u=h===0?this._levels.length-1:h-1;this.currentLevelIndex!==u&&this._levels[u].loadError===0&&(this.warn(f+": switch to "+u),n.levelRetry=!0,this.hls.nextAutoLevel=u)}}},c.redundantFailover=function(n){var h=this._levels[n],v=h.url.length;if(v>1){var y=(h.urlId+1)%v;this.warn("Switching to redundant URL-id "+y),this._levels.forEach(function(f){f.urlId=y}),this.level=n}},c.onFragLoaded=function(n,h){var v=h.frag;if(v!==void 0&&v.type===_.PlaylistLevelType.MAIN){var y=this._levels[v.level];y!==void 0&&(y.fragmentError=0,y.loadError=0)}},c.onLevelLoaded=function(n,h){var v,y=h.level,f=h.details,s=this._levels[y];if(!s){var a;this.warn("Invalid level index "+y),(a=h.deliveryDirectives)!==null&&a!==void 0&&a.skip&&(f.deltaUpdateFailed=!0);return}y===this.currentLevelIndex?(s.fragmentError===0&&(s.loadError=0,this.retryCount=0),this.playlistLoaded(y,h,s.details)):(v=h.deliveryDirectives)!==null&&v!==void 0&&v.skip&&(f.deltaUpdateFailed=!0)},c.onAudioTrackSwitched=function(n,h){var v=this.hls.levels[this.currentLevelIndex];if(!!v&&v.audioGroupIds){for(var y=-1,f=this.hls.audioTracks[h.id].groupId,s=0;s<v.audioGroupIds.length;s++)if(v.audioGroupIds[s]===f){y=s;break}y!==v.urlId&&(v.urlId=y,this.startLoad())}},c.loadPlaylist=function(n){var h=this.currentLevelIndex,v=this._levels[h];if(this.canLoad&&v&&v.url.length>0){var y=v.urlId,f=v.url[y];if(n)try{f=n.addDirectives(f)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("Attempt loading level index "+h+(n?" at sn "+n.msn+" part "+n.part:"")+" with URL-id "+y+" "+f),this.clearTimer(),this.hls.trigger(S.Events.LEVEL_LOADING,{url:f,level:h,id:y,deliveryDirectives:n||null})}},c.removeLevel=function(n,h){var v=function(f,s){return s!==h},y=this._levels.filter(function(f,s){return s!==n?!0:f.url.length>1&&h!==void 0?(f.url=f.url.filter(v),f.audioGroupIds&&(f.audioGroupIds=f.audioGroupIds.filter(v)),f.textGroupIds&&(f.textGroupIds=f.textGroupIds.filter(v)),f.urlId=0,!0):!1}).map(function(f,s){var a=f.details;return a!=null&&a.fragments&&a.fragments.forEach(function(r){r.level=s}),f});this._levels=y,this.hls.trigger(S.Events.LEVELS_UPDATED,{levels:y})},T(i,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(n){var h,v=this._levels;if(v.length!==0&&!(this.currentLevelIndex===n&&(h=v[n])!==null&&h!==void 0&&h.details)){if(n<0||n>=v.length){var y=n<0;if(this.hls.trigger(S.Events.ERROR,{type:L.ErrorTypes.OTHER_ERROR,details:L.ErrorDetails.LEVEL_SWITCH_ERROR,level:n,fatal:y,reason:"invalid level idx"}),y)return;n=Math.min(n,v.length-1)}this.clearTimer();var f=this.currentLevelIndex,s=v[f],a=v[n];this.log("switching to level "+n+" from "+f),this.currentLevelIndex=n;var r=d({},a,{level:n,maxBitrate:a.maxBitrate,uri:a.uri,urlId:a.urlId});delete r._urlId,this.hls.trigger(S.Events.LEVEL_SWITCHING,r);var u=a.details;if(!u||u.live){var o=this.switchParams(a.uri,s==null?void 0:s.details);this.loadPlaylist(o)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(n){this.manualLevelIndex=n,this._startLevel===void 0&&(this._startLevel=n),n!==-1&&(this.level=n)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(n){this._firstLevel=n}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var n=this.hls.config.startLevel;return n!==void 0?n:this._firstLevel}else return this._startLevel},set:function(n){this._startLevel=n}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(n){this.level=n,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=n)}}]),i}(D.default)},"./src/controller/level-helper.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"addGroupId",function(){return L}),p.d(x,"assignTrackIdsByGroup",function(){return k}),p.d(x,"updatePTS",function(){return A}),p.d(x,"updateFragPTSDTS",function(){return _}),p.d(x,"mergeDetails",function(){return d}),p.d(x,"mapPartIntersection",function(){return g}),p.d(x,"mapFragmentIntersection",function(){return T}),p.d(x,"adjustSliding",function(){return m}),p.d(x,"addSliding",function(){return E}),p.d(x,"computeReloadInterval",function(){return l}),p.d(x,"getFragmentWithSN",function(){return t}),p.d(x,"getPartWith",function(){return e});var w=p("./src/polyfills/number.ts"),S=p("./src/utils/logger.ts");function L(i,c,n){switch(c){case"audio":i.audioGroupIds||(i.audioGroupIds=[]),i.audioGroupIds.push(n);break;case"text":i.textGroupIds||(i.textGroupIds=[]),i.textGroupIds.push(n);break}}function k(i){var c={};i.forEach(function(n){var h=n.groupId||"";n.id=c[h]=c[h]||0,c[h]++})}function A(i,c,n){var h=i[c],v=i[n];D(h,v)}function D(i,c){var n=c.startPTS;if(Object(w.isFiniteNumber)(n)){var h=0,v;c.sn>i.sn?(h=n-i.start,v=i):(h=i.start-n,v=c),v.duration!==h&&(v.duration=h)}else if(c.sn>i.sn){var y=i.cc===c.cc;y&&i.minEndPTS?c.start=i.start+(i.minEndPTS-i.start):c.start=i.start+i.duration}else c.start=Math.max(i.start-c.duration,0)}function _(i,c,n,h,v,y){var f=h-n;f<=0&&(S.logger.warn("Fragment should have a positive duration",c),h=n+c.duration,y=v+c.duration);var s=n,a=h,r=c.startPTS,u=c.endPTS;if(Object(w.isFiniteNumber)(r)){var o=Math.abs(r-n);Object(w.isFiniteNumber)(c.deltaPTS)?c.deltaPTS=Math.max(o,c.deltaPTS):c.deltaPTS=o,s=Math.max(n,r),n=Math.min(n,r),v=Math.min(v,c.startDTS),a=Math.min(h,u),h=Math.max(h,u),y=Math.max(y,c.endDTS)}c.duration=h-n;var b=n-c.start;c.appendedPTS=h,c.start=c.startPTS=n,c.maxStartPTS=s,c.startDTS=v,c.endPTS=h,c.minEndPTS=a,c.endDTS=y;var R=c.sn;if(!i||R<i.startSN||R>i.endSN)return 0;var O,C=R-i.startSN,I=i.fragments;for(I[C]=c,O=C;O>0;O--)D(I[O],I[O-1]);for(O=C;O<I.length-1;O++)D(I[O],I[O+1]);return i.fragmentHint&&D(I[I.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,b}function d(i,c){for(var n=null,h=i.fragments,v=h.length-1;v>=0;v--){var y=h[v].initSegment;if(y){n=y;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;var f=0,s;if(T(i,c,function(R,O){var C;R.relurl&&(f=R.cc-O.cc),Object(w.isFiniteNumber)(R.startPTS)&&Object(w.isFiniteNumber)(R.endPTS)&&(O.start=O.startPTS=R.startPTS,O.startDTS=R.startDTS,O.appendedPTS=R.appendedPTS,O.maxStartPTS=R.maxStartPTS,O.endPTS=R.endPTS,O.endDTS=R.endDTS,O.minEndPTS=R.minEndPTS,O.duration=R.endPTS-R.startPTS,O.duration&&(s=O),c.PTSKnown=c.alignedSliding=!0),O.elementaryStreams=R.elementaryStreams,O.loader=R.loader,O.stats=R.stats,O.urlId=R.urlId,R.initSegment?(O.initSegment=R.initSegment,n=R.initSegment):(!O.initSegment||O.initSegment.relurl==((C=n)===null||C===void 0?void 0:C.relurl))&&(O.initSegment=n)}),c.skippedSegments&&(c.deltaUpdateFailed=c.fragments.some(function(R){return!R}),c.deltaUpdateFailed)){S.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var a=c.skippedSegments;a--;)c.fragments.shift();c.startSN=c.fragments[0].sn,c.startCC=c.fragments[0].cc}var r=c.fragments;if(f){S.logger.warn("discontinuity sliding from playlist, take drift into account");for(var u=0;u<r.length;u++)r[u].cc+=f}c.skippedSegments&&(c.startCC=c.fragments[0].cc),g(i.partList,c.partList,function(R,O){O.elementaryStreams=R.elementaryStreams,O.stats=R.stats}),s?_(c,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):m(i,c),r.length&&(c.totalduration=c.edge-r[0].start),c.driftStartTime=i.driftStartTime,c.driftStart=i.driftStart;var o=c.advancedDateTime;if(c.advanced&&o){var b=c.edge;c.driftStart||(c.driftStartTime=o,c.driftStart=b),c.driftEndTime=o,c.driftEnd=b}else c.driftEndTime=i.driftEndTime,c.driftEnd=i.driftEnd,c.advancedDateTime=i.advancedDateTime}function g(i,c,n){if(i&&c)for(var h=0,v=0,y=i.length;v<=y;v++){var f=i[v],s=c[v+h];f&&s&&f.index===s.index&&f.fragment.sn===s.fragment.sn?n(f,s):h--}}function T(i,c,n){for(var h=c.skippedSegments,v=Math.max(i.startSN,c.startSN)-c.startSN,y=(i.fragmentHint?1:0)+(h?c.endSN:Math.min(i.endSN,c.endSN))-c.startSN,f=c.startSN-i.startSN,s=c.fragmentHint?c.fragments.concat(c.fragmentHint):c.fragments,a=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,r=v;r<=y;r++){var u=a[f+r],o=s[r];h&&!o&&r<h&&(o=c.fragments[r]=u),u&&o&&n(u,o)}}function m(i,c){var n=c.startSN+c.skippedSegments-i.startSN,h=i.fragments;n<0||n>=h.length||E(c,h[n].start)}function E(i,c){if(c){for(var n=i.fragments,h=i.skippedSegments;h<n.length;h++)n[h].start+=c;i.fragmentHint&&(i.fragmentHint.start+=c)}}function l(i,c){var n=1e3*i.levelTargetDuration,h=n/2,v=i.age,y=v>0&&v<n*3,f=c.loading.end-c.loading.start,s,a=i.availabilityDelay;if(i.updated===!1)if(y){var r=333*i.misses;s=Math.max(Math.min(h,f*2),r),i.availabilityDelay=(i.availabilityDelay||0)+s}else s=h;else y?(a=Math.min(a||n/2,v),i.availabilityDelay=a,s=a+n-v):s=n-f;return Math.round(s)}function t(i,c,n){if(!i||!i.details)return null;var h=i.details,v=h.fragments[c-h.startSN];return v||(v=h.fragmentHint,v&&v.sn===c)?v:c<h.startSN&&n&&n.sn===c?n:null}function e(i,c,n){if(!i||!i.details)return null;var h=i.details.partList;if(h)for(var v=h.length;v--;){var y=h[v];if(y.index===n&&y.fragment.sn===c)return y}return null}},"./src/controller/stream-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return h});var w=p("./src/polyfills/number.ts"),S=p("./src/controller/base-stream-controller.ts"),L=p("./src/is-supported.ts"),k=p("./src/events.ts"),A=p("./src/utils/buffer-helper.ts"),D=p("./src/controller/fragment-tracker.ts"),_=p("./src/types/loader.ts"),d=p("./src/loader/fragment.ts"),g=p("./src/demux/transmuxer-interface.ts"),T=p("./src/types/transmuxer.ts"),m=p("./src/controller/gap-controller.ts"),E=p("./src/errors.ts"),l=p("./src/utils/logger.ts");function t(v,y){for(var f=0;f<y.length;f++){var s=y[f];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(v,s.key,s)}}function e(v,y,f){return y&&t(v.prototype,y),f&&t(v,f),v}function i(v,y){v.prototype=Object.create(y.prototype),v.prototype.constructor=v,c(v,y)}function c(v,y){return c=Object.setPrototypeOf||function(f,s){return f.__proto__=s,f},c(v,y)}var n=100,h=function(v){i(y,v);function y(s,a){var r;return r=v.call(this,s,a,"[stream-controller]")||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.stalled=!1,r.couldBacktrack=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}var f=y.prototype;return f._registerListeners=function(){var s=this.hls;s.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(k.Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.on(k.Events.ERROR,this.onError,this),s.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.on(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),s.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.on(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f._unregisterListeners=function(){var s=this.hls;s.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(k.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),s.off(k.Events.ERROR,this.onError,this),s.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),s.off(k.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),s.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),s.off(k.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),s.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},f.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},f.startLoad=function(s){if(this.levels){var a=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(n),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var u=r.startLevel;u===-1&&(r.config.testBandwidth?(u=0,this.bitrateTest=!0):u=r.nextAutoLevel),this.level=r.nextLoadLevel=u,this.loadedmetadata=!1}a>0&&s===-1&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),s=a),this.state=S.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=s,this.tick()}else this._forceStartLoad=!0,this.state=S.State.STOPPED},f.stopLoad=function(){this._forceStartLoad=!1,v.prototype.stopLoad.call(this)},f.doTick=function(){switch(this.state){case S.State.IDLE:this.doTickIdle();break;case S.State.WAITING_LEVEL:{var s,a=this.levels,r=this.level,u=a==null||(s=a[r])===null||s===void 0?void 0:s.details;if(u&&(!u.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(u))break;this.state=S.State.IDLE;break}break}case S.State.FRAG_LOADING_WAITING_RETRY:{var o,b=self.performance.now(),R=this.retryDate;(!R||b>=R||(o=this.media)!==null&&o!==void 0&&o.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=S.State.IDLE)}break;default:break}this.onTickEnd()},f.onTickEnd=function(){v.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},f.doTickIdle=function(){var s,a,r=this.hls,u=this.levelLastLoaded,o=this.levels,b=this.media,R=r.config,O=r.nextLoadLevel;if(!(u===null||!b&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!o||!o[O])){var C=o[O];this.level=r.nextLoadLevel=O;var I=C.details;if(!I||this.state===S.State.WAITING_LEVEL||I.live&&this.levelLastLoaded!==O){this.state=S.State.WAITING_LEVEL;return}var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:b,_.PlaylistLevelType.MAIN);if(F!==null){var M=F.len,P=this.getMaxBufferLength(C.maxBitrate);if(!(M>=P)){if(this._streamEnded(F,I)){var N={};this.altAudio&&(N.type="video"),this.hls.trigger(k.Events.BUFFER_EOS,N),this.state=S.State.ENDED;return}var U=F.end,B=this.getNextFragment(U,I);if(this.couldBacktrack&&!this.fragPrevious&&B&&B.sn!=="initSegment"){var G=B.sn-I.startSN;G>1&&(B=I.fragments[G-1],this.fragmentTracker.removeFragment(B))}if(B&&this.fragmentTracker.getState(B)===D.FragmentState.OK&&this.nextLoadPosition>U){var q=this.audioOnly&&!this.altAudio?d.ElementaryStreamTypes.AUDIO:d.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(b,q,_.PlaylistLevelType.MAIN),B=this.getNextFragment(this.nextLoadPosition,I)}!B||(B.initSegment&&!B.initSegment.data&&!this.bitrateTest&&(B=B.initSegment),((s=B.decryptdata)===null||s===void 0?void 0:s.keyFormat)==="identity"&&!((a=B.decryptdata)!==null&&a!==void 0&&a.key)?this.loadKey(B,I):this.loadFragment(B,I,U))}}}},f.loadFragment=function(s,a,r){var u,o=this.fragmentTracker.getState(s);if(this.fragCurrent=s,o===D.FragmentState.BACKTRACKED){var b=this.fragmentTracker.getBacktrackData(s);if(b){this._handleFragmentLoadProgress(b),this._handleFragmentLoadComplete(b);return}else o=D.FragmentState.NOT_LOADED}o===D.FragmentState.NOT_LOADED||o===D.FragmentState.PARTIAL?s.sn==="initSegment"?this._loadInitSegment(s):this.bitrateTest?(s.bitrateTest=!0,this.log("Fragment "+s.sn+" of level "+s.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(s)):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,s,a,r)):o===D.FragmentState.APPENDING?this.reduceMaxBufferLength(s.duration)&&this.fragmentTracker.removeFragment(s):((u=this.media)===null||u===void 0?void 0:u.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},f.getAppendedFrag=function(s){var a=this.fragmentTracker.getAppendedFrag(s,_.PlaylistLevelType.MAIN);return a&&"fragment"in a?a.fragment:a},f.getBufferedFrag=function(s){return this.fragmentTracker.getBufferedFrag(s,_.PlaylistLevelType.MAIN)},f.followingBufferedFrag=function(s){return s?this.getBufferedFrag(s.end+.5):null},f.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},f.nextLevelSwitch=function(){var s=this.levels,a=this.media;if(a!=null&&a.readyState){var r,u=this.getAppendedFrag(a.currentTime);if(u&&u.start>1&&this.flushMainBuffer(0,u.start-1),!a.paused&&s){var o=this.hls.nextLoadLevel,b=s[o],R=this.fragLastKbps;R&&this.fragCurrent?r=this.fragCurrent.duration*b.maxBitrate/(1e3*R)+1:r=0}else r=0;var O=this.getBufferedFrag(a.currentTime+r);if(O){var C=this.followingBufferedFrag(O);if(C){this.abortCurrentFrag();var I=C.maxStartPTS?C.maxStartPTS:C.start,F=C.duration,M=Math.max(O.end,I+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(M,Number.POSITIVE_INFINITY)}}}},f.abortCurrentFrag=function(){var s=this.fragCurrent;this.fragCurrent=null,s!=null&&s.loader&&s.loader.abort(),this.state===S.State.KEY_LOADING&&(this.state=S.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},f.flushMainBuffer=function(s,a){v.prototype.flushMainBuffer.call(this,s,a,this.altAudio?"video":null)},f.onMediaAttached=function(s,a){v.prototype.onMediaAttached.call(this,s,a);var r=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new m.default(this.config,r,this.fragmentTracker,this.hls)},f.onMediaDetaching=function(){var s=this.media;s&&(s.removeEventListener("playing",this.onvplaying),s.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),v.prototype.onMediaDetaching.call(this)},f.onMediaPlaying=function(){this.tick()},f.onMediaSeeked=function(){var s=this.media,a=s?s.currentTime:null;Object(w.isFiniteNumber)(a)&&this.log("Media seeked to "+a.toFixed(3)),this.tick()},f.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(k.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},f.onManifestParsed=function(s,a){var r=!1,u=!1,o;a.levels.forEach(function(b){o=b.audioCodec,o&&(o.indexOf("mp4a.40.2")!==-1&&(r=!0),o.indexOf("mp4a.40.5")!==-1&&(u=!0))}),this.audioCodecSwitch=r&&u&&!Object(L.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=a.levels,this.startFragRequested=!1},f.onLevelLoading=function(s,a){var r=this.levels;if(!(!r||this.state!==S.State.IDLE)){var u=r[a.level];(!u.details||u.details.live&&this.levelLastLoaded!==a.level||this.waitForCdnTuneIn(u.details))&&(this.state=S.State.WAITING_LEVEL)}},f.onLevelLoaded=function(s,a){var r,u=this.levels,o=a.level,b=a.details,R=b.totalduration;if(!u){this.warn("Levels were reset while loading level "+o);return}this.log("Level "+o+" loaded ["+b.startSN+","+b.endSN+"], cc ["+b.startCC+", "+b.endCC+"] duration:"+R);var O=this.fragCurrent;O&&(this.state===S.State.FRAG_LOADING||this.state===S.State.FRAG_LOADING_WAITING_RETRY)&&O.level!==a.level&&O.loader&&(this.state=S.State.IDLE,O.loader.abort());var C=u[o],I=0;if(b.live||(r=C.details)!==null&&r!==void 0&&r.live){if(b.fragments[0]||(b.deltaUpdateFailed=!0),b.deltaUpdateFailed)return;I=this.alignPlaylists(b,C.details)}if(C.details=b,this.levelLastLoaded=o,this.hls.trigger(k.Events.LEVEL_UPDATED,{details:b,level:o}),this.state===S.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(b))return;this.state=S.State.IDLE}this.startFragRequested?b.live&&this.synchronizeToLiveEdge(b):this.setStartPosition(b,I),this.tick()},f._handleFragmentLoadProgress=function(s){var a,r=s.frag,u=s.part,o=s.payload,b=this.levels;if(!b){this.warn("Levels were reset while fragment load was in progress. Fragment "+r.sn+" of level "+r.level+" will not be buffered");return}var R=b[r.level],O=R.details;if(!O){this.warn("Dropping fragment "+r.sn+" of level "+r.level+" after level details were reset");return}var C=R.videoCodec,I=O.PTSKnown||!O.live,F=(a=r.initSegment)===null||a===void 0?void 0:a.data,M=this._getAudioCodec(R),P=this.transmuxer=this.transmuxer||new g.default(this.hls,_.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=u?u.index:-1,U=N!==-1,B=new T.ChunkMetadata(r.level,r.sn,r.stats.chunkCount,o.byteLength,N,U),G=this.initPTS[r.cc];P.push(o,F,M,C,r,u,O.totalduration,I,B,G)},f.onAudioTrackSwitching=function(s,a){var r=this.altAudio,u=!!a.url,o=a.id;if(!u){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var b=this.fragCurrent;b!=null&&b.loader&&(this.log("Switching to main audio track, cancel main fragment load"),b.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;r&&R.trigger(k.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:o})}},f.onAudioTrackSwitched=function(s,a){var r=a.id,u=!!this.hls.audioTracks[r].url;if(u){var o=this.videoBuffer;o&&this.mediaBuffer!==o&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=o)}this.altAudio=u,this.tick()},f.onBufferCreated=function(s,a){var r=a.tracks,u,o,b=!1;for(var R in r){var O=r[R];if(O.id==="main"){if(o=R,u=O,R==="video"){var C=r[R];C&&(this.videoBuffer=C.buffer)}}else b=!0}b&&u?(this.log("Alternate track found, use "+o+".buffered to schedule main fragment loading"),this.mediaBuffer=u.buffer):this.mediaBuffer=this.media},f.onFragBuffered=function(s,a){var r=a.frag,u=a.part;if(!(r&&r.type!==_.PlaylistLevelType.MAIN)){if(this.fragContextChanged(r)){this.warn("Fragment "+r.sn+(u?" p: "+u.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),this.state===S.State.PARSED&&(this.state=S.State.IDLE);return}var o=u?u.stats:r.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,u)}},f.onError=function(s,a){switch(a.details){case E.ErrorDetails.FRAG_LOAD_ERROR:case E.ErrorDetails.FRAG_LOAD_TIMEOUT:case E.ErrorDetails.KEY_LOAD_ERROR:case E.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(_.PlaylistLevelType.MAIN,a);break;case E.ErrorDetails.LEVEL_LOAD_ERROR:case E.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==S.State.ERROR&&(a.fatal?(this.warn(""+a.details),this.state=S.State.ERROR):!a.levelRetry&&this.state===S.State.WAITING_LEVEL&&(this.state=S.State.IDLE));break;case E.ErrorDetails.BUFFER_FULL_ERROR:if(a.parent==="main"&&(this.state===S.State.PARSING||this.state===S.State.PARSED)){var r=!0,u=this.getFwdBufferInfo(this.media,_.PlaylistLevelType.MAIN);u&&u.len>.5&&(r=!this.reduceMaxBufferLength(u.len)),r&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break;default:break}},f.checkBuffer=function(){var s=this.media,a=this.gapController;if(!(!s||!a||!s.readyState)){var r=A.BufferHelper.getBuffered(s);!this.loadedmetadata&&r.length?(this.loadedmetadata=!0,this.seekToStartPos()):a.poll(this.lastCurrentTime),this.lastCurrentTime=s.currentTime}},f.onFragLoadEmergencyAborted=function(){this.state=S.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},f.onBufferFlushed=function(s,a){var r=a.type;if(r!==d.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var u=(r===d.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(u,r,_.PlaylistLevelType.MAIN)}},f.onLevelsUpdated=function(s,a){this.levels=a.levels},f.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},f.seekToStartPos=function(){var s=this.media,a=s.currentTime,r=this.startPosition;if(r>=0&&a<r){if(s.seeking){l.logger.log("could not seek to "+r+", already seeking at "+a);return}var u=A.BufferHelper.getBuffered(s),o=u.length?u.start(0):0,b=o-r;b>0&&(b<this.config.maxBufferHole||b<this.config.maxFragLookUpTolerance)&&(l.logger.log("adjusting start position by "+b+" to match buffer start"),r+=b,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+a),s.currentTime=r}},f._getAudioCodec=function(s){var a=this.config.defaultAudioCodec||s.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a.indexOf("mp4a.40.5")!==-1?a="mp4a.40.2":a="mp4a.40.5"),a},f._loadBitrateTestFrag=function(s){var a=this;this._doFragLoad(s).then(function(r){var u=a.hls;if(!(!r||u.nextLoadLevel||a.fragContextChanged(s))){a.fragLoadError=0,a.state=S.State.IDLE,a.startFragRequested=!1,a.bitrateTest=!1;var o=s.stats;o.parsing.start=o.parsing.end=o.buffering.start=o.buffering.end=self.performance.now(),u.trigger(k.Events.FRAG_LOADED,r)}})},f._handleTransmuxComplete=function(s){var a,r="main",u=this.hls,o=s.remuxResult,b=s.chunkMeta,R=this.getCurrentContext(b);if(!R){this.warn("The loading context changed while buffering fragment "+b.sn+" of level "+b.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(b.level);return}var O=R.frag,C=R.part,I=R.level,F=o.video,M=o.text,P=o.id3,N=o.initSegment,U=this.altAudio?void 0:o.audio;if(!this.fragContextChanged(O)){if(this.state=S.State.PARSING,N){N.tracks&&(this._bufferInitSegment(I,N.tracks,O,b),u.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:O,id:r,tracks:N.tracks}));var B=N.initPTS,G=N.timescale;Object(w.isFiniteNumber)(B)&&(this.initPTS[O.cc]=B,u.trigger(k.Events.INIT_PTS_FOUND,{frag:O,id:r,initPTS:B,timescale:G}))}if(F&&o.independent!==!1){if(I.details){var q=F.startPTS,K=F.endPTS,W=F.startDTS,V=F.endDTS;if(C)C.elementaryStreams[F.type]={startPTS:q,endPTS:K,startDTS:W,endDTS:V};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var J=this.getLoadPosition()+this.config.maxBufferHole;if(J<q){this.backtrack(O);return}O.setElementaryStreamInfo(F.type,O.start,K,O.start,V,!0)}O.setElementaryStreamInfo(F.type,q,K,W,V),this.bufferFragmentData(F,O,C,b)}}else if(o.independent===!1){this.backtrack(O);return}if(U){var Q=U.startPTS,tt=U.endPTS,lt=U.startDTS,et=U.endDTS;C&&(C.elementaryStreams[d.ElementaryStreamTypes.AUDIO]={startPTS:Q,endPTS:tt,startDTS:lt,endDTS:et}),O.setElementaryStreamInfo(d.ElementaryStreamTypes.AUDIO,Q,tt,lt,et),this.bufferFragmentData(U,O,C,b)}if(P!=null&&(a=P.samples)!==null&&a!==void 0&&a.length){var $={frag:O,id:r,samples:P.samples};u.trigger(k.Events.FRAG_PARSING_METADATA,$)}if(M){var z={frag:O,id:r,samples:M.samples};u.trigger(k.Events.FRAG_PARSING_USERDATA,z)}}},f._bufferInitSegment=function(s,a,r,u){var o=this;if(this.state===S.State.PARSING){this.audioOnly=!!a.audio&&!a.video,this.altAudio&&!this.audioOnly&&delete a.audio;var b=a.audio,R=a.video,O=a.audiovideo;if(b){var C=s.audioCodec,I=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(C&&(C.indexOf("mp4a.40.5")!==-1?C="mp4a.40.2":C="mp4a.40.5"),b.metadata.channelCount!==1&&I.indexOf("firefox")===-1&&(C="mp4a.40.5")),I.indexOf("android")!==-1&&b.container!=="audio/mpeg"&&(C="mp4a.40.2",this.log("Android: force audio codec to "+C)),s.audioCodec&&s.audioCodec!==C&&this.log('Swapping manifest audio codec "'+s.audioCodec+'" for "'+C+'"'),b.levelCodec=C,b.id="main",this.log("Init audio buffer, container:"+b.container+", codecs[selected/level/parsed]=["+(C||"")+"/"+(s.audioCodec||"")+"/"+b.codec+"]")}R&&(R.levelCodec=s.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(s.videoCodec||"")+"/"+R.codec+"]")),O&&this.log("Init audiovideo buffer, container:"+O.container+", codecs[level/parsed]=["+(s.attrs.CODECS||"")+"/"+O.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,a),Object.keys(a).forEach(function(F){var M=a[F],P=M.initSegment;P!=null&&P.byteLength&&o.hls.trigger(k.Events.BUFFER_APPENDING,{type:F,data:P,frag:r,part:null,chunkMeta:u,parent:r.type})}),this.tick()}},f.backtrack=function(s){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(s);var a=this.fragmentTracker.backtrack(s);this.fragPrevious=null,this.nextLoadPosition=s.start,a?this.resetFragmentLoading(s):this.state=S.State.BACKTRACKING},f.checkFragmentChanged=function(){var s=this.media,a=null;if(s&&s.readyState>1&&s.seeking===!1){var r=s.currentTime;if(A.BufferHelper.isBuffered(s,r)?a=this.getAppendedFrag(r):A.BufferHelper.isBuffered(s,r+.1)&&(a=this.getAppendedFrag(r+.1)),a){var u=this.fragPlaying,o=a.level;(!u||a.sn!==u.sn||u.level!==o||a.urlId!==u.urlId)&&(this.hls.trigger(k.Events.FRAG_CHANGED,{frag:a}),(!u||u.level!==o)&&this.hls.trigger(k.Events.LEVEL_SWITCHED,{level:o}),this.fragPlaying=a)}}},e(y,[{key:"nextLevel",get:function(){var s=this.nextBufferedFrag;return s?s.level:-1}},{key:"currentLevel",get:function(){var s=this.media;if(s){var a=this.getAppendedFrag(s.currentTime);if(a)return a.level}return-1}},{key:"nextBufferedFrag",get:function(){var s=this.media;if(s){var a=this.getAppendedFrag(s.currentTime);return this.followingBufferedFrag(a)}else return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),y}(S.default)},"./src/controller/subtitle-stream-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"SubtitleStreamController",function(){return i});var w=p("./src/events.ts"),S=p("./src/utils/logger.ts"),L=p("./src/utils/buffer-helper.ts"),k=p("./src/controller/fragment-finders.ts"),A=p("./src/utils/discontinuities.ts"),D=p("./src/controller/level-helper.ts"),_=p("./src/controller/fragment-tracker.ts"),d=p("./src/controller/base-stream-controller.ts"),g=p("./src/types/loader.ts"),T=p("./src/types/level.ts");function m(c,n){for(var h=0;h<n.length;h++){var v=n[h];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(c,v.key,v)}}function E(c,n,h){return n&&m(c.prototype,n),h&&m(c,h),c}function l(c,n){c.prototype=Object.create(n.prototype),c.prototype.constructor=c,t(c,n)}function t(c,n){return t=Object.setPrototypeOf||function(h,v){return h.__proto__=v,h},t(c,n)}var e=500,i=function(c){l(n,c);function n(v,y){var f;return f=c.call(this,v,y,"[subtitle-stream-controller]")||this,f.levels=[],f.currentTrackId=-1,f.tracksBuffered=[],f.mainDetails=null,f._registerListeners(),f}var h=n.prototype;return h.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},h._registerListeners=function(){var v=this.hls;v.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.on(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(w.Events.ERROR,this.onError,this),v.on(w.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.on(w.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.on(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.on(w.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.on(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},h._unregisterListeners=function(){var v=this.hls;v.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),v.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),v.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),v.off(w.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(w.Events.ERROR,this.onError,this),v.off(w.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),v.off(w.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),v.off(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),v.off(w.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),v.off(w.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},h.startLoad=function(){this.stopLoad(),this.state=d.State.IDLE,this.setInterval(e),this.tick()},h.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},h.onLevelLoaded=function(v,y){this.mainDetails=y.details},h.onSubtitleFragProcessed=function(v,y){var f=y.frag,s=y.success;if(this.fragPrevious=f,this.state=d.State.IDLE,!!s){var a=this.tracksBuffered[this.currentTrackId];if(a){for(var r,u=f.start,o=0;o<a.length;o++)if(u>=a[o].start&&u<=a[o].end){r=a[o];break}var b=f.start+f.duration;r?r.end=b:(r={start:u,end:b},a.push(r)),this.fragmentTracker.fragBuffered(f)}}},h.onBufferFlushing=function(v,y){var f=y.startOffset,s=y.endOffset;if(f===0&&s!==Number.POSITIVE_INFINITY){var a=this.currentTrackId,r=this.levels;if(!r.length||!r[a]||!r[a].details)return;var u=r[a].details,o=u.targetduration,b=s-o;if(b<=0)return;y.endOffsetSubtitles=Math.max(0,b),this.tracksBuffered.forEach(function(R){for(var O=0;O<R.length;){if(R[O].end<=b){R.shift();continue}else if(R[O].start<b)R[O].start=b;else break;O++}}),this.fragmentTracker.removeFragmentsInRange(f,b,g.PlaylistLevelType.SUBTITLE)}},h.onError=function(v,y){var f,s=y.frag;!s||s.type!==g.PlaylistLevelType.SUBTITLE||((f=this.fragCurrent)!==null&&f!==void 0&&f.loader&&this.fragCurrent.loader.abort(),this.state=d.State.IDLE)},h.onSubtitleTracksUpdated=function(v,y){var f=this,s=y.subtitleTracks;this.tracksBuffered=[],this.levels=s.map(function(a){return new T.Level(a)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(a){f.tracksBuffered[a.id]=[]}),this.mediaBuffer=null},h.onSubtitleTrackSwitch=function(v,y){if(this.currentTrackId=y.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var f=this.levels[this.currentTrackId];f!=null&&f.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(e)):this.mediaBuffer=null},h.onSubtitleTrackLoaded=function(v,y){var f,s=y.details,a=y.id,r=this.currentTrackId,u=this.levels;if(u.length){var o=u[r];if(!(a>=u.length||a!==r||!o)){if(this.mediaBuffer=this.mediaBufferTimeRanges,s.live||(f=o.details)!==null&&f!==void 0&&f.live){var b=this.mainDetails;if(s.deltaUpdateFailed||!b)return;var R=b.fragments[0];if(!o.details)s.hasProgramDateTime&&b.hasProgramDateTime?Object(A.alignMediaPlaylistByPDT)(s,b):R&&Object(D.addSliding)(s,R.start);else{var O=this.alignPlaylists(s,o.details);O===0&&R&&Object(D.addSliding)(s,R.start)}}if(o.details=s,this.levelLastLoaded=a,this.tick(),s.live&&!this.fragCurrent&&this.media&&this.state===d.State.IDLE){var C=Object(k.findFragmentByPTS)(null,s.fragments,this.media.currentTime,0);C||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0)}}}},h._handleFragmentLoadComplete=function(v){var y=v.frag,f=v.payload,s=y.decryptdata,a=this.hls;if(!this.fragContextChanged(y)&&f&&f.byteLength>0&&s&&s.key&&s.iv&&s.method==="AES-128"){var r=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(f),s.key.buffer,s.iv.buffer).then(function(u){var o=performance.now();a.trigger(w.Events.FRAG_DECRYPTED,{frag:y,payload:u,stats:{tstart:r,tdecrypt:o}})})}},h.doTick=function(){if(!this.media){this.state=d.State.IDLE;return}if(this.state===d.State.IDLE){var v,y=this.currentTrackId,f=this.levels;if(!f.length||!f[y]||!f[y].details)return;var s=f[y].details,a=s.targetduration,r=this.config,u=this.media,o=L.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,u.currentTime-a,r.maxBufferHole),b=o.end,R=o.len,O=this.getMaxBufferLength()+a;if(R>O)return;console.assert(s,"Subtitle track details are defined on idle subtitle stream controller tick");var C=s.fragments,I=C.length,F=s.edge,M,P=this.fragPrevious;if(b<F){var N=r.maxFragLookUpTolerance;P&&s.hasProgramDateTime&&(M=Object(k.findFragmentByPDT)(C,P.endProgramDateTime,N)),M||(M=Object(k.findFragmentByPTS)(P,C,b,N),!M&&P&&P.start<C[0].start&&(M=C[0]))}else M=C[I-1];(v=M)!==null&&v!==void 0&&v.encrypted?(S.logger.log("Loading key for "+M.sn),this.state=d.State.KEY_LOADING,this.hls.trigger(w.Events.KEY_LOADING,{frag:M})):M&&this.fragmentTracker.getState(M)===_.FragmentState.NOT_LOADED&&this.loadFragment(M,s,b)}},h.loadFragment=function(v,y,f){this.fragCurrent=v,c.prototype.loadFragment.call(this,v,y,f)},E(n,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),n}(d.default)},"./src/controller/subtitle-track-controller.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/events.ts"),S=p("./src/utils/texttrack-utils.ts"),L=p("./src/controller/base-playlist-controller.ts"),k=p("./src/types/loader.ts");function A(m,E){for(var l=0;l<E.length;l++){var t=E[l];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(m,t.key,t)}}function D(m,E,l){return E&&A(m.prototype,E),l&&A(m,l),m}function _(m,E){m.prototype=Object.create(E.prototype),m.prototype.constructor=m,d(m,E)}function d(m,E){return d=Object.setPrototypeOf||function(l,t){return l.__proto__=t,l},d(m,E)}var g=function(m){_(E,m);function E(t){var e;return e=m.call(this,t,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e.subtitleDisplay=!0,e.registerListeners(),e}var l=E.prototype;return l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,m.prototype.destroy.call(this)},l.registerListeners=function(){var t=this.hls;t.on(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(w.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(w.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var t=this.hls;t.off(w.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(w.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(w.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(w.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(w.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(w.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(w.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(w.Events.ERROR,this.onError,this)},l.onMediaAttached=function(t,e){this.media=e.media,!!this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},l.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},l.onMediaDetaching=function(){if(this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=T(this.media.textTracks);t.forEach(function(e){Object(S.clearCurrentCues)(e)}),this.subtitleTrack=-1,this.media=null}},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},l.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},l.onSubtitleTrackLoaded=function(t,e){var i=e.id,c=e.details,n=this.trackId,h=this.tracksInGroup[n];if(!h){this.warn("Invalid subtitle track id "+i);return}var v=h.details;h.details=e.details,this.log("subtitle track "+i+" loaded ["+c.startSN+"-"+c.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,e,v))},l.onLevelLoading=function(t,e){this.switchLevel(e.level)},l.onLevelSwitching=function(t,e){this.switchLevel(e.level)},l.switchLevel=function(t){var e=this.hls.levels[t];if(e!=null&&e.textGroupIds){var i=e.textGroupIds[e.urlId];if(this.groupId!==i){var c=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,n=this.tracks.filter(function(y){return!i||y.groupId===i});this.tracksInGroup=n;var h=this.findTrackId(c==null?void 0:c.name)||this.findTrackId();this.groupId=i;var v={subtitleTracks:n};this.log("Updating subtitle tracks, "+n.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(w.Events.SUBTITLE_TRACKS_UPDATED,v),h!==-1&&this.setSubtitleTrack(h,c)}}},l.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var c=e[i];if((!this.selectDefaultTrack||c.default)&&(!t||t===c.name))return c.id}return-1},l.onError=function(t,e){m.prototype.onError.call(this,t,e),!(e.fatal||!e.context)&&e.context.type===k.PlaylistContextType.SUBTITLE_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},l.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var i=e.id,c=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(h){this.warn("Could not construct new URL with HLS Delivery Directives: "+h)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(w.Events.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:c,deliveryDirectives:t||null})}},l.toggleTrackModes=function(t){var e=this,i=this.media,c=this.subtitleDisplay,n=this.trackId;if(i){var h=T(i.textTracks),v=h.filter(function(s){return s.groupId===e.groupId});if(t===-1)[].slice.call(h).forEach(function(s){s.mode="disabled"});else{var y=v[n];y&&(y.mode="disabled")}var f=v[t];f&&(f.mode=c?"showing":"hidden")}},l.setSubtitleTrack=function(t,e){var i,c=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(i=c[t])!==null&&i!==void 0&&i.details)||t<-1||t>=c.length)){this.clearTimer();var n=c[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,n){var h=n.id,v=n.groupId,y=v===void 0?"":v,f=n.name,s=n.type,a=n.url;this.hls.trigger(w.Events.SUBTITLE_TRACK_SWITCH,{id:h,groupId:y,name:f,type:s,url:a});var r=this.switchParams(n.url,e==null?void 0:e.details);this.loadPlaylist(r)}else this.hls.trigger(w.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},l.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,e=T(this.media.textTracks),i=0;i<e.length;i++)if(e[i].mode==="hidden")t=i;else if(e[i].mode==="showing"){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},D(E,[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}]),E}(L.default);function T(m){for(var E=[],l=0;l<m.length;l++){var t=m[l];t.kind==="subtitles"&&t.label&&E.push(m[l])}return E}x.default=g},"./src/controller/timeline-controller.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"TimelineController",function(){return T});var w=p("./src/polyfills/number.ts"),S=p("./src/events.ts"),L=p("./src/utils/cea-608-parser.ts"),k=p("./src/utils/output-filter.ts"),A=p("./src/utils/webvtt-parser.ts"),D=p("./src/utils/texttrack-utils.ts"),_=p("./src/utils/imsc1-ttml-parser.ts"),d=p("./src/types/loader.ts"),g=p("./src/utils/logger.ts"),T=function(){function t(i){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=i,this.config=i.config,this.Cues=i.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var c=new k.default(this,"textTrack1"),n=new k.default(this,"textTrack2"),h=new k.default(this,"textTrack3"),v=new k.default(this,"textTrack4");this.cea608Parser1=new L.default(1,c,n),this.cea608Parser2=new L.default(3,h,v)}i.on(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(S.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(S.Events.FRAG_LOADING,this.onFragLoading,this),i.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(S.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.on(S.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.on(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(S.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.on(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var i=this.hls;i.off(S.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(S.Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(S.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(S.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(S.Events.FRAG_LOADING,this.onFragLoading,this),i.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(S.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.off(S.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.off(S.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.off(S.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.off(S.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(i,c,n,h,v){for(var y=!1,f=v.length;f--;){var s=v[f],a=E(s[0],s[1],c,n);if(a>=0&&(s[0]=Math.min(s[0],c),s[1]=Math.max(s[1],n),y=!0,a/(n-c)>.5))return}if(y||v.push([c,n]),this.config.renderTextTracksNatively){var r=this.captionsTracks[i];this.Cues.newCue(r,c,n,h)}else{var u=this.Cues.newCue(null,c,n,h);this.hls.trigger(S.Events.CUES_PARSED,{type:"captions",cues:u,track:i})}},e.onInitPtsFound=function(i,c){var n=this,h=c.frag,v=c.id,y=c.initPTS,f=c.timescale,s=this.unparsedVttFrags;v==="main"&&(this.initPTS[h.cc]=y,this.timescale[h.cc]=f),s.length&&(this.unparsedVttFrags=[],s.forEach(function(a){n.onFragLoaded(S.Events.FRAG_LOADED,a)}))},e.getExistingTrack=function(i){var c=this.media;if(c)for(var n=0;n<c.textTracks.length;n++){var h=c.textTracks[n];if(h[i])return h}return null},e.createCaptionsTrack=function(i){this.config.renderTextTracksNatively?this.createNativeTrack(i):this.createNonNativeTrack(i)},e.createNativeTrack=function(i){if(!this.captionsTracks[i]){var c=this.captionsProperties,n=this.captionsTracks,h=this.media,v=c[i],y=v.label,f=v.languageCode,s=this.getExistingTrack(i);if(s)n[i]=s,Object(D.clearCurrentCues)(n[i]),Object(D.sendAddTrackEvent)(n[i],h);else{var a=this.createTextTrack("captions",y,f);a&&(a[i]=!0,n[i]=a)}}},e.createNonNativeTrack=function(i){if(!this.nonNativeCaptionsTracks[i]){var c=this.captionsProperties[i];if(c){var n=c.label,h={_id:i,label:n,kind:"captions",default:c.media?!!c.media.default:!1,closedCaptions:c.media};this.nonNativeCaptionsTracks[i]=h,this.hls.trigger(S.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[h]})}}},e.createTextTrack=function(i,c,n){var h=this.media;if(h)return h.addTextTrack(i,c,n)},e.onMediaAttaching=function(i,c){this.media=c.media,this._cleanTracks()},e.onMediaDetaching=function(){var i=this.captionsTracks;Object.keys(i).forEach(function(c){Object(D.clearCurrentCues)(i[c]),delete i[c]}),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var i=this.media;if(i){var c=i.textTracks;if(c)for(var n=0;n<c.length;n++)Object(D.clearCurrentCues)(c[n])}},e.onSubtitleTracksUpdated=function(i,c){var n=this;this.textTracks=[];var h=c.subtitleTracks||[],v=h.some(function(a){return a.textCodec===_.IMSC1_CODEC});if(this.config.enableWebVTT||v&&this.config.enableIMSC1){var y=this.tracks&&h&&this.tracks.length===h.length;if(this.tracks=h||[],this.config.renderTextTracksNatively){var f=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,r){var u;if(r<f.length){for(var o=null,b=0;b<f.length;b++)if(m(f[b],a)){o=f[b];break}o&&(u=o)}u?Object(D.clearCurrentCues)(u):(u=n.createTextTrack("subtitles",a.name,a.lang),u&&(u.mode="disabled")),u&&(u.groupId=a.groupId,n.textTracks.push(u))})}else if(!y&&this.tracks&&this.tracks.length){var s=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(S.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}},e.onManifestLoaded=function(i,c){var n=this;this.config.enableCEA708Captions&&c.captions&&c.captions.forEach(function(h){var v=/(?:CC|SERVICE)([1-4])/.exec(h.instreamId);if(v){var y="textTrack"+v[1],f=n.captionsProperties[y];!f||(f.label=h.name,h.lang&&(f.languageCode=h.lang),f.media=h)}})},e.onFragLoading=function(i,c){var n=this.cea608Parser1,h=this.cea608Parser2,v=this.lastSn;if(!(!this.enabled||!(n&&h))&&c.frag.type===d.PlaylistLevelType.MAIN){var y=c.frag.sn;y!==v+1&&(n.reset(),h.reset()),this.lastSn=y}},e.onFragLoaded=function(i,c){var n=c.frag,h=c.payload,v=this.initPTS,y=this.unparsedVttFrags;if(n.type===d.PlaylistLevelType.SUBTITLE)if(h.byteLength){if(!Object(w.isFiniteNumber)(v[n.cc])){y.push(c),v.length&&this.hls.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")});return}var f=n.decryptdata;if(f==null||f.key==null||f.method!=="AES-128"){var s=this.tracks[n.level],a=this.vttCCs;a[n.cc]||(a[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),s&&s.textCodec===_.IMSC1_CODEC?this._parseIMSC1(n,h):this._parseVTTs(n,h,a)}}else this.hls.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(i,c){var n=this,h=this.hls;Object(_.parseIMSC1)(c,this.initPTS[i.cc],this.timescale[i.cc],function(v){n._appendCues(v,i.level),h.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(v){g.logger.log("Failed to parse IMSC1: "+v),h.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:v})})},e._parseVTTs=function(i,c,n){var h=this,v=this.hls;Object(A.parseWebVTT)(c,this.initPTS[i.cc],this.timescale[i.cc],n,i.cc,i.start,function(y){h._appendCues(y,i.level),v.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},function(y){h._fallbackToIMSC1(i,c),g.logger.log("Failed to parse VTT cue: "+y),v.trigger(S.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:y})})},e._fallbackToIMSC1=function(i,c){var n=this,h=this.tracks[i.level];h.textCodec||Object(_.parseIMSC1)(c,this.initPTS[i.cc],this.timescale[i.cc],function(){h.textCodec=_.IMSC1_CODEC,n._parseIMSC1(i,c)},function(){h.textCodec="wvtt"})},e._appendCues=function(i,c){var n=this.hls;if(this.config.renderTextTracksNatively){var h=this.textTracks[c];if(h.mode==="disabled")return;i.forEach(function(f){return Object(D.addCueToTrack)(h,f)})}else{var v=this.tracks[c],y=v.default?"default":"subtitles"+c;n.trigger(S.Events.CUES_PARSED,{type:"subtitles",cues:i,track:y})}},e.onFragDecrypted=function(i,c){var n=c.frag;if(n.type===d.PlaylistLevelType.SUBTITLE){if(!Object(w.isFiniteNumber)(this.initPTS[n.cc])){this.unparsedVttFrags.push(c);return}this.onFragLoaded(S.Events.FRAG_LOADED,c)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(i,c){var n=this.cea608Parser1,h=this.cea608Parser2;if(!(!this.enabled||!(n&&h)))for(var v=0;v<c.samples.length;v++){var y=c.samples[v].bytes;if(y){var f=this.extractCea608Data(y);n.addData(c.samples[v].pts,f[0]),h.addData(c.samples[v].pts,f[1])}}},e.onBufferFlushing=function(i,c){var n=c.startOffset,h=c.endOffset,v=c.endOffsetSubtitles,y=c.type,f=this.media;if(!(!f||f.currentTime<h)){if(!y||y==="video"){var s=this.captionsTracks;Object.keys(s).forEach(function(r){return Object(D.removeCuesInRange)(s[r],n,h)})}if(this.config.renderTextTracksNatively&&n===0&&v!==void 0){var a=this.textTracks;Object.keys(a).forEach(function(r){return Object(D.removeCuesInRange)(a[r],n,v)})}}},e.extractCea608Data=function(i){for(var c=i[0]&31,n=2,h=[[],[]],v=0;v<c;v++){var y=i[n++],f=127&i[n++],s=127&i[n++],a=(4&y)!=0,r=3&y;f===0&&s===0||a&&(r===0||r===1)&&(h[r].push(f),h[r].push(s))}return h},t}();function m(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function E(t,e,i,c){return Math.min(e,c)-Math.max(t,i)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return w});var w=function(){function S(k,A){this.subtle=void 0,this.aesIV=void 0,this.subtle=k,this.aesIV=A}var L=S.prototype;return L.decrypt=function(k,A){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},A,k)},S}()},"./src/crypt/aes-decryptor.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"removePadding",function(){return S}),p.d(x,"default",function(){return L});var w=p("./src/utils/typed-array.ts");function S(k){var A=k.byteLength,D=A&&new DataView(k.buffer).getUint8(A-1);return D?Object(w.sliceUint8)(k,0,A-D):k}var L=function(){function k(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var A=k.prototype;return A.uint8ArrayToUint32Array_=function(D){for(var _=new DataView(D),d=new Uint32Array(4),g=0;g<4;g++)d[g]=_.getUint32(g*4);return d},A.initTable=function(){var D=this.sBox,_=this.invSBox,d=this.subMix,g=d[0],T=d[1],m=d[2],E=d[3],l=this.invSubMix,t=l[0],e=l[1],i=l[2],c=l[3],n=new Uint32Array(256),h=0,v=0,y=0;for(y=0;y<256;y++)y<128?n[y]=y<<1:n[y]=y<<1^283;for(y=0;y<256;y++){var f=v^v<<1^v<<2^v<<3^v<<4;f=f>>>8^f&255^99,D[h]=f,_[f]=h;var s=n[h],a=n[s],r=n[a],u=n[f]*257^f*16843008;g[h]=u<<24|u>>>8,T[h]=u<<16|u>>>16,m[h]=u<<8|u>>>24,E[h]=u,u=r*16843009^a*65537^s*257^h*16843008,t[f]=u<<24|u>>>8,e[f]=u<<16|u>>>16,i[f]=u<<8|u>>>24,c[f]=u,h?(h=s^n[n[n[r^s]]],v^=n[n[v]]):h=v=1}},A.expandKey=function(D){for(var _=this.uint8ArrayToUint32Array_(D),d=!0,g=0;g<_.length&&d;)d=_[g]===this.key[g],g++;if(!d){this.key=_;var T=this.keySize=_.length;if(T!==4&&T!==6&&T!==8)throw new Error("Invalid aes key size="+T);var m=this.ksRows=(T+6+1)*4,E,l,t=this.keySchedule=new Uint32Array(m),e=this.invKeySchedule=new Uint32Array(m),i=this.sBox,c=this.rcon,n=this.invSubMix,h=n[0],v=n[1],y=n[2],f=n[3],s,a;for(E=0;E<m;E++){if(E<T){s=t[E]=_[E];continue}a=s,E%T==0?(a=a<<8|a>>>24,a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[a&255],a^=c[E/T|0]<<24):T>6&&E%T==4&&(a=i[a>>>24]<<24|i[a>>>16&255]<<16|i[a>>>8&255]<<8|i[a&255]),t[E]=s=(t[E-T]^a)>>>0}for(l=0;l<m;l++)E=m-l,l&3?a=t[E]:a=t[E-4],l<4||E<=4?e[l]=a:e[l]=h[i[a>>>24]]^v[i[a>>>16&255]]^y[i[a>>>8&255]]^f[i[a&255]],e[l]=e[l]>>>0}},A.networkToHostOrderSwap=function(D){return D<<24|(D&65280)<<8|(D&16711680)>>8|D>>>24},A.decrypt=function(D,_,d){for(var g=this.keySize+6,T=this.invKeySchedule,m=this.invSBox,E=this.invSubMix,l=E[0],t=E[1],e=E[2],i=E[3],c=this.uint8ArrayToUint32Array_(d),n=c[0],h=c[1],v=c[2],y=c[3],f=new Int32Array(D),s=new Int32Array(f.length),a,r,u,o,b,R,O,C,I,F,M,P,N,U,B=this.networkToHostOrderSwap;_<f.length;){for(I=B(f[_]),F=B(f[_+1]),M=B(f[_+2]),P=B(f[_+3]),b=I^T[0],R=P^T[1],O=M^T[2],C=F^T[3],N=4,U=1;U<g;U++)a=l[b>>>24]^t[R>>16&255]^e[O>>8&255]^i[C&255]^T[N],r=l[R>>>24]^t[O>>16&255]^e[C>>8&255]^i[b&255]^T[N+1],u=l[O>>>24]^t[C>>16&255]^e[b>>8&255]^i[R&255]^T[N+2],o=l[C>>>24]^t[b>>16&255]^e[R>>8&255]^i[O&255]^T[N+3],b=a,R=r,O=u,C=o,N=N+4;a=m[b>>>24]<<24^m[R>>16&255]<<16^m[O>>8&255]<<8^m[C&255]^T[N],r=m[R>>>24]<<24^m[O>>16&255]<<16^m[C>>8&255]<<8^m[b&255]^T[N+1],u=m[O>>>24]<<24^m[C>>16&255]<<16^m[b>>8&255]<<8^m[R&255]^T[N+2],o=m[C>>>24]<<24^m[b>>16&255]<<16^m[R>>8&255]<<8^m[O&255]^T[N+3],s[_]=B(a^n),s[_+1]=B(o^h),s[_+2]=B(u^v),s[_+3]=B(r^y),n=I,h=F,v=M,y=P,_=_+4}return s.buffer},k}()},"./src/crypt/decrypter.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return d});var w=p("./src/crypt/aes-crypto.ts"),S=p("./src/crypt/fast-aes-key.ts"),L=p("./src/crypt/aes-decryptor.ts"),k=p("./src/utils/logger.ts"),A=p("./src/utils/mp4-tools.ts"),D=p("./src/utils/typed-array.ts"),_=16,d=function(){function g(m,E,l){var t=l===void 0?{}:l,e=t.removePKCS7Padding,i=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=m,this.config=E,this.removePKCS7Padding=i,i)try{var c=self.crypto;c&&(this.subtle=c.subtle||c.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var T=g.prototype;return T.destroy=function(){this.observer=null},T.isSync=function(){return this.config.enableSoftwareAES},T.flush=function(){var m=this.currentResult;if(!m){this.reset();return}var E=new Uint8Array(m);return this.reset(),this.removePKCS7Padding?Object(L.removePadding)(E):E},T.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},T.decrypt=function(m,E,l,t){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(m),E,l);var e=this.flush();e&&t(e.buffer)}else this.webCryptoDecrypt(new Uint8Array(m),E,l).then(t)},T.softwareDecrypt=function(m,E,l){var t=this.currentIV,e=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(m=Object(A.appendUint8Array)(i,m),this.remainderData=null);var c=this.getValidChunk(m);if(!c.length)return null;t&&(l=t);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new L.default),n.expandKey(E);var h=e;return this.currentResult=n.decrypt(c.buffer,0,l),this.currentIV=Object(D.sliceUint8)(c,-16).buffer,h||null},T.webCryptoDecrypt=function(m,E,l){var t=this,e=this.subtle;return(this.key!==E||!this.fastAesKey)&&(this.key=E,this.fastAesKey=new S.default(e,E)),this.fastAesKey.expandKey().then(function(i){if(!e)return Promise.reject(new Error("web crypto not initialized"));var c=new w.default(e,l);return c.decrypt(m.buffer,i)}).catch(function(i){return t.onWebCryptoError(i,m,E,l)})},T.onWebCryptoError=function(m,E,l,t){return k.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",m),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(E,l,t)},T.getValidChunk=function(m){var E=m,l=m.length-m.length%_;return l!==m.length&&(E=Object(D.sliceUint8)(m,0,l),this.remainderData=Object(D.sliceUint8)(m,l)),E},T.logOnce=function(m){!this.logEnabled||(k.logger.log("[decrypter.ts]: "+m),this.logEnabled=!1)},g}()},"./src/crypt/fast-aes-key.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return w});var w=function(){function S(k,A){this.subtle=void 0,this.key=void 0,this.subtle=k,this.key=A}var L=S.prototype;return L.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},S}()},"./src/demux/aacdemuxer.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/demux/base-audio-demuxer.ts"),S=p("./src/demux/adts.ts"),L=p("./src/utils/logger.ts"),k=p("./src/demux/id3.ts");function A(d,g){d.prototype=Object.create(g.prototype),d.prototype.constructor=d,D(d,g)}function D(d,g){return D=Object.setPrototypeOf||function(T,m){return T.__proto__=m,T},D(d,g)}var _=function(d){A(g,d);function g(m,E){var l;return l=d.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=m,l.config=E,l}var T=g.prototype;return T.resetInitSegment=function(m,E,l){d.prototype.resetInitSegment.call(this,m,E,l),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:m,duration:l,inputTimeScale:9e4,dropped:0}},g.probe=function(m){if(!m)return!1;for(var E=k.getID3Data(m,0)||[],l=E.length,t=m.length;l<t;l++)if(S.probe(m,l))return L.logger.log("ADTS sync word found !"),!0;return!1},T.canParse=function(m,E){return S.canParse(m,E)},T.appendFrame=function(m,E,l){S.initTrackConfig(m,this.observer,E,l,m.manifestCodec);var t=S.appendFrame(m,E,l,this.initPTS,this.frameIndex);if(t&&t.missing===0)return t},g}(w.default);_.minProbeByteLength=9,x.default=_},"./src/demux/adts.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"getAudioConfig",function(){return k}),p.d(x,"isHeaderPattern",function(){return A}),p.d(x,"getHeaderLength",function(){return D}),p.d(x,"getFullFrameLength",function(){return _}),p.d(x,"canGetFrameLength",function(){return d}),p.d(x,"isHeader",function(){return g}),p.d(x,"canParse",function(){return T}),p.d(x,"probe",function(){return m}),p.d(x,"initTrackConfig",function(){return E}),p.d(x,"getFrameDuration",function(){return l}),p.d(x,"parseFrameHeader",function(){return t}),p.d(x,"appendFrame",function(){return e});var w=p("./src/utils/logger.ts"),S=p("./src/errors.ts"),L=p("./src/events.ts");function k(i,c,n,h){var v,y,f,s,a=navigator.userAgent.toLowerCase(),r=h,u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];v=((c[n+2]&192)>>>6)+1;var o=(c[n+2]&60)>>>2;if(o>u.length-1){i.trigger(L.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o});return}return f=(c[n+2]&1)<<2,f|=(c[n+3]&192)>>>6,w.logger.log("manifest codec:"+h+", ADTS type:"+v+", samplingIndex:"+o),/firefox/i.test(a)?o>=6?(v=5,s=new Array(4),y=o-3):(v=2,s=new Array(2),y=o):a.indexOf("android")!==-1?(v=2,s=new Array(2),y=o):(v=5,s=new Array(4),h&&(h.indexOf("mp4a.40.29")!==-1||h.indexOf("mp4a.40.5")!==-1)||!h&&o>=6?y=o-3:((h&&h.indexOf("mp4a.40.2")!==-1&&(o>=6&&f===1||/vivaldi/i.test(a))||!h&&f===1)&&(v=2,s=new Array(2)),y=o)),s[0]=v<<3,s[0]|=(o&14)>>1,s[1]|=(o&1)<<7,s[1]|=f<<3,v===5&&(s[1]|=(y&14)>>1,s[2]=(y&1)<<7,s[2]|=2<<2,s[3]=0),{config:s,samplerate:u[o],channelCount:f,codec:"mp4a.40."+v,manifestCodec:r}}function A(i,c){return i[c]===255&&(i[c+1]&246)==240}function D(i,c){return i[c+1]&1?7:9}function _(i,c){return(i[c+3]&3)<<11|i[c+4]<<3|(i[c+5]&224)>>>5}function d(i,c){return c+5<i.length}function g(i,c){return c+1<i.length&&A(i,c)}function T(i,c){return d(i,c)&&A(i,c)&&_(i,c)<=i.length-c}function m(i,c){if(g(i,c)){var n=D(i,c);if(c+n>=i.length)return!1;var h=_(i,c);if(h<=n)return!1;var v=c+h;return v===i.length||g(i,v)}return!1}function E(i,c,n,h,v){if(!i.samplerate){var y=k(c,n,h,v);if(!y)return;i.config=y.config,i.samplerate=y.samplerate,i.channelCount=y.channelCount,i.codec=y.codec,i.manifestCodec=y.manifestCodec,w.logger.log("parsed codec:"+i.codec+", rate:"+y.samplerate+", channels:"+y.channelCount)}}function l(i){return 1024*9e4/i}function t(i,c,n,h,v){var y=D(i,c),f=_(i,c);if(f-=y,f>0){var s=n+h*v;return{headerLength:y,frameLength:f,stamp:s}}}function e(i,c,n,h,v){var y=l(i.samplerate),f=t(c,n,h,v,y);if(f){var s=f.frameLength,a=f.headerLength,r=f.stamp,u=a+s,o=Math.max(0,n+u-c.length),b;o?(b=new Uint8Array(u-a),b.set(c.subarray(n+a,c.length),0)):b=c.subarray(n+a,n+u);var R={unit:b,pts:r};return o||i.samples.push(R),{sample:R,length:u,missing:o}}}},"./src/demux/base-audio-demuxer.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"initPTSFn",function(){return _});var w=p("./src/polyfills/number.ts"),S=p("./src/demux/id3.ts"),L=p("./src/demux/dummy-demuxed-track.ts"),k=p("./src/utils/mp4-tools.ts"),A=p("./src/utils/typed-array.ts"),D=function(){function d(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var g=d.prototype;return g.resetInitSegment=function(T,m,E){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},g.resetTimeStamp=function(){},g.resetContiguity=function(){},g.canParse=function(T,m){return!1},g.appendFrame=function(T,m,E){},g.demux=function(T,m){this.cachedData&&(T=Object(k.appendUint8Array)(this.cachedData,T),this.cachedData=null);var E=S.getID3Data(T,0),l=E?E.length:0,t,e,i=this._audioTrack,c=this._id3Track,n=E?S.getTimeStamp(E):void 0,h=T.length;for((this.frameIndex===0||this.initPTS===null)&&(this.initPTS=_(n,m)),E&&E.length>0&&c.samples.push({pts:this.initPTS,dts:this.initPTS,data:E}),e=this.initPTS;l<h;){if(this.canParse(T,l)){var v=this.appendFrame(i,T,l);v?(this.frameIndex++,e=v.sample.pts,l+=v.length,t=l):l=h}else S.canParse(T,l)?(E=S.getID3Data(T,l),c.samples.push({pts:e,dts:e,data:E}),l+=E.length,t=l):l++;if(l===h&&t!==h){var y=Object(A.sliceUint8)(T,t);this.cachedData?this.cachedData=Object(k.appendUint8Array)(this.cachedData,y):this.cachedData=y}}return{audioTrack:i,avcTrack:Object(L.dummyTrack)(),id3Track:c,textTrack:Object(L.dummyTrack)()}},g.demuxSampleAes=function(T,m,E){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},g.flush=function(T){var m=this.cachedData;return m&&(this.cachedData=null,this.demux(m,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(L.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(L.dummyTrack)()}},g.destroy=function(){},d}(),_=function(d,g){return Object(w.isFiniteNumber)(d)?d*90:g*9e4};x.default=D},"./src/demux/chunk-cache.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return w});var w=function(){function L(){this.chunks=[],this.dataLength=0}var k=L.prototype;return k.push=function(A){this.chunks.push(A),this.dataLength+=A.length},k.flush=function(){var A=this.chunks,D=this.dataLength,_;if(A.length)A.length===1?_=A[0]:_=S(A,D);else return new Uint8Array(0);return this.reset(),_},k.reset=function(){this.chunks.length=0,this.dataLength=0},L}();function S(L,k){for(var A=new Uint8Array(k),D=0,_=0;_<L.length;_++){var d=L[_];A.set(d,D),D+=d.length}return A}},"./src/demux/dummy-demuxed-track.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"dummyTrack",function(){return w});function w(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/utils/logger.ts"),S=function(){function L(A){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=A,this.bytesAvailable=A.byteLength,this.word=0,this.bitsAvailable=0}var k=L.prototype;return k.loadWord=function(){var A=this.data,D=this.bytesAvailable,_=A.byteLength-D,d=new Uint8Array(4),g=Math.min(4,D);if(g===0)throw new Error("no bytes available");d.set(A.subarray(_,_+g)),this.word=new DataView(d.buffer).getUint32(0),this.bitsAvailable=g*8,this.bytesAvailable-=g},k.skipBits=function(A){var D;this.bitsAvailable>A?(this.word<<=A,this.bitsAvailable-=A):(A-=this.bitsAvailable,D=A>>3,A-=D>>3,this.bytesAvailable-=D,this.loadWord(),this.word<<=A,this.bitsAvailable-=A)},k.readBits=function(A){var D=Math.min(this.bitsAvailable,A),_=this.word>>>32-D;return A>32&&w.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=D,this.bitsAvailable>0?this.word<<=D:this.bytesAvailable>0&&this.loadWord(),D=A-D,D>0&&this.bitsAvailable?_<<D|this.readBits(D):_},k.skipLZ=function(){var A;for(A=0;A<this.bitsAvailable;++A)if((this.word&2147483648>>>A)!=0)return this.word<<=A,this.bitsAvailable-=A,A;return this.loadWord(),A+this.skipLZ()},k.skipUEG=function(){this.skipBits(1+this.skipLZ())},k.skipEG=function(){this.skipBits(1+this.skipLZ())},k.readUEG=function(){var A=this.skipLZ();return this.readBits(A+1)-1},k.readEG=function(){var A=this.readUEG();return 1&A?1+A>>>1:-1*(A>>>1)},k.readBoolean=function(){return this.readBits(1)===1},k.readUByte=function(){return this.readBits(8)},k.readUShort=function(){return this.readBits(16)},k.readUInt=function(){return this.readBits(32)},k.skipScalingList=function(A){for(var D=8,_=8,d,g=0;g<A;g++)_!==0&&(d=this.readEG(),_=(D+d+256)%256),D=_===0?D:_},k.readSPS=function(){var A=0,D=0,_=0,d=0,g,T,m,E=this.readUByte.bind(this),l=this.readBits.bind(this),t=this.readUEG.bind(this),e=this.readBoolean.bind(this),i=this.skipBits.bind(this),c=this.skipEG.bind(this),n=this.skipUEG.bind(this),h=this.skipScalingList.bind(this);E();var v=E();if(l(5),i(3),E(),n(),v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128){var y=t();if(y===3&&i(1),n(),n(),i(1),e())for(T=y!==3?8:12,m=0;m<T;m++)e()&&(m<6?h(16):h(64))}n();var f=t();if(f===0)t();else if(f===1)for(i(1),c(),c(),g=t(),m=0;m<g;m++)c();n(),i(1);var s=t(),a=t(),r=l(1);r===0&&i(1),i(1),e()&&(A=t(),D=t(),_=t(),d=t());var u=[1,1];if(e()&&e()){var o=E();switch(o){case 1:u=[1,1];break;case 2:u=[12,11];break;case 3:u=[10,11];break;case 4:u=[16,11];break;case 5:u=[40,33];break;case 6:u=[24,11];break;case 7:u=[20,11];break;case 8:u=[32,11];break;case 9:u=[80,33];break;case 10:u=[18,11];break;case 11:u=[15,11];break;case 12:u=[64,33];break;case 13:u=[160,99];break;case 14:u=[4,3];break;case 15:u=[3,2];break;case 16:u=[2,1];break;case 255:{u=[E()<<8|E(),E()<<8|E()];break}}}return{width:Math.ceil((s+1)*16-A*2-D*2),height:(2-r)*(a+1)*16-(r?2:4)*(_+d),pixelRatio:u}},k.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},L}();x.default=S},"./src/demux/id3.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"isHeader",function(){return w}),p.d(x,"isFooter",function(){return S}),p.d(x,"getID3Data",function(){return L}),p.d(x,"canParse",function(){return A}),p.d(x,"getTimeStamp",function(){return D}),p.d(x,"isTimeStampFrame",function(){return _}),p.d(x,"getID3Frames",function(){return g}),p.d(x,"decodeFrame",function(){return T}),p.d(x,"utf8ArrayToStr",function(){return e}),p.d(x,"testables",function(){return i});var w=function(h,v){return v+10<=h.length&&h[v]===73&&h[v+1]===68&&h[v+2]===51&&h[v+3]<255&&h[v+4]<255&&h[v+6]<128&&h[v+7]<128&&h[v+8]<128&&h[v+9]<128},S=function(h,v){return v+10<=h.length&&h[v]===51&&h[v+1]===68&&h[v+2]===73&&h[v+3]<255&&h[v+4]<255&&h[v+6]<128&&h[v+7]<128&&h[v+8]<128&&h[v+9]<128},L=function(h,v){for(var y=v,f=0;w(h,v);){f+=10;var s=k(h,v+6);f+=s,S(h,v+10)&&(f+=10),v+=f}if(f>0)return h.subarray(y,y+f)},k=function(h,v){var y=0;return y=(h[v]&127)<<21,y|=(h[v+1]&127)<<14,y|=(h[v+2]&127)<<7,y|=h[v+3]&127,y},A=function(h,v){return w(h,v)&&k(h,v+6)+10<=h.length-v},D=function(h){for(var v=g(h),y=0;y<v.length;y++){var f=v[y];if(_(f))return t(f)}},_=function(h){return h&&h.key==="PRIV"&&h.info==="com.apple.streaming.transportStreamTimestamp"},d=function(h){var v=String.fromCharCode(h[0],h[1],h[2],h[3]),y=k(h,4),f=10;return{type:v,size:y,data:h.subarray(f,f+y)}},g=function(h){for(var v=0,y=[];w(h,v);){var f=k(h,v+6);v+=10;for(var s=v+f;v+8<s;){var a=d(h.subarray(v)),r=T(a);r&&y.push(r),v+=a.size+10}S(h,v)&&(v+=10)}return y},T=function(h){return h.type==="PRIV"?m(h):h.type[0]==="W"?l(h):E(h)},m=function(h){if(!(h.size<2)){var v=e(h.data,!0),y=new Uint8Array(h.data.subarray(v.length+1));return{key:h.type,info:v,data:y.buffer}}},E=function(h){if(!(h.size<2)){if(h.type==="TXXX"){var v=1,y=e(h.data.subarray(v),!0);v+=y.length+1;var f=e(h.data.subarray(v));return{key:h.type,info:y,data:f}}var s=e(h.data.subarray(1));return{key:h.type,data:s}}},l=function(h){if(h.type==="WXXX"){if(h.size<2)return;var v=1,y=e(h.data.subarray(v),!0);v+=y.length+1;var f=e(h.data.subarray(v));return{key:h.type,info:y,data:f}}var s=e(h.data);return{key:h.type,data:s}},t=function(h){if(h.data.byteLength===8){var v=new Uint8Array(h.data),y=v[3]&1,f=(v[4]<<23)+(v[5]<<15)+(v[6]<<7)+v[7];return f/=45,y&&(f+=4772185884e-2),Math.round(f)}},e=function(h,v){v===void 0&&(v=!1);var y=n();if(y){var f=y.decode(h);if(v){var s=f.indexOf("\0");return s!==-1?f.substring(0,s):f}return f.replace(/\0/g,"")}for(var a=h.length,r,u,o,b="",R=0;R<a;){if(r=h[R++],r===0&&v)return b;if(!(r===0||r===3))switch(r>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(r);break;case 12:case 13:u=h[R++],b+=String.fromCharCode((r&31)<<6|u&63);break;case 14:u=h[R++],o=h[R++],b+=String.fromCharCode((r&15)<<12|(u&63)<<6|(o&63)<<0);break;default:}}return b},i={decodeTextFrame:E},c;function n(){return!c&&typeof self.TextDecoder!="undefined"&&(c=new self.TextDecoder("utf-8")),c}},"./src/demux/mp3demuxer.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/demux/base-audio-demuxer.ts"),S=p("./src/demux/id3.ts"),L=p("./src/utils/logger.ts"),k=p("./src/demux/mpegaudio.ts");function A(d,g){d.prototype=Object.create(g.prototype),d.prototype.constructor=d,D(d,g)}function D(d,g){return D=Object.setPrototypeOf||function(T,m){return T.__proto__=m,T},D(d,g)}var _=function(d){A(g,d);function g(){return d.apply(this,arguments)||this}var T=g.prototype;return T.resetInitSegment=function(m,E,l){d.prototype.resetInitSegment.call(this,m,E,l),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:m,duration:l,inputTimeScale:9e4,dropped:0}},g.probe=function(m){if(!m)return!1;for(var E=S.getID3Data(m,0)||[],l=E.length,t=m.length;l<t;l++)if(k.probe(m,l))return L.logger.log("MPEG Audio sync word found !"),!0;return!1},T.canParse=function(m,E){return k.canParse(m,E)},T.appendFrame=function(m,E,l){if(this.initPTS!==null)return k.appendFrame(m,E,l,this.initPTS,this.frameIndex)},g}(w.default);_.minProbeByteLength=4,x.default=_},"./src/demux/mp4demuxer.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/utils/mp4-tools.ts"),S=p("./src/demux/dummy-demuxed-track.ts"),L=function(){function k(D,_){this.remainderData=null,this.config=void 0,this.config=_}var A=k.prototype;return A.resetTimeStamp=function(){},A.resetInitSegment=function(){},A.resetContiguity=function(){},k.probe=function(D){return Object(w.findBox)({data:D,start:0,end:Math.min(D.length,16384)},["moof"]).length>0},A.demux=function(D){var _=D,d=Object(S.dummyTrack)();if(this.config.progressive){this.remainderData&&(_=Object(w.appendUint8Array)(this.remainderData,D));var g=Object(w.segmentValidRange)(_);this.remainderData=g.remainder,d.samples=g.valid||new Uint8Array}else d.samples=_;return{audioTrack:Object(S.dummyTrack)(),avcTrack:d,id3Track:Object(S.dummyTrack)(),textTrack:Object(S.dummyTrack)()}},A.flush=function(){var D=Object(S.dummyTrack)();return D.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(S.dummyTrack)(),avcTrack:D,id3Track:Object(S.dummyTrack)(),textTrack:Object(S.dummyTrack)()}},A.demuxSampleAes=function(D,_,d){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},A.destroy=function(){},k}();L.minProbeByteLength=1024,x.default=L},"./src/demux/mpegaudio.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"appendFrame",function(){return D}),p.d(x,"parseHeader",function(){return _}),p.d(x,"isHeaderPattern",function(){return d}),p.d(x,"isHeader",function(){return g}),p.d(x,"canParse",function(){return T}),p.d(x,"probe",function(){return m});var w=null,S=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],L=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],k=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],A=[0,1,1,4];function D(E,l,t,e,i){if(!(t+24>l.length)){var c=_(l,t);if(c&&t+c.frameLength<=l.length){var n=c.samplesPerFrame*9e4/c.sampleRate,h=e+i*n,v={unit:l.subarray(t,t+c.frameLength),pts:h,dts:h};return E.config=[],E.channelCount=c.channelCount,E.samplerate=c.sampleRate,E.samples.push(v),{sample:v,length:c.frameLength,missing:0}}}}function _(E,l){var t=E[l+1]>>3&3,e=E[l+1]>>1&3,i=E[l+2]>>4&15,c=E[l+2]>>2&3;if(t!==1&&i!==0&&i!==15&&c!==3){var n=E[l+2]>>1&1,h=E[l+3]>>6,v=t===3?3-e:e===3?3:4,y=S[v*14+i-1]*1e3,f=t===3?0:t===2?1:2,s=L[f*3+c],a=h===3?1:2,r=k[t][e],u=A[e],o=r*8*u,b=Math.floor(r*y/s+n)*u;if(w===null){var R=navigator.userAgent||"",O=R.match(/Chrome\/(\d+)/i);w=O?parseInt(O[1]):0}var C=!!w&&w<=87;return C&&e===2&&y>=224e3&&h===0&&(E[l+3]=E[l+3]|128),{sampleRate:s,channelCount:a,frameLength:b,samplesPerFrame:o}}}function d(E,l){return E[l]===255&&(E[l+1]&224)==224&&(E[l+1]&6)!=0}function g(E,l){return l+1<E.length&&d(E,l)}function T(E,l){var t=4;return d(E,l)&&t<=E.length-l}function m(E,l){if(l+1<E.length&&d(E,l)){var t=4,e=_(E,l),i=t;e!=null&&e.frameLength&&(i=e.frameLength);var c=l+i;return c===E.length||g(E,c)}return!1}},"./src/demux/sample-aes.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/crypt/decrypter.ts"),S=p("./src/demux/tsdemuxer.ts"),L=function(){function k(D,_,d){this.keyData=void 0,this.decrypter=void 0,this.keyData=d,this.decrypter=new w.default(D,_,{removePKCS7Padding:!1})}var A=k.prototype;return A.decryptBuffer=function(D,_){this.decrypter.decrypt(D,this.keyData.key.buffer,this.keyData.iv.buffer,_)},A.decryptAacSample=function(D,_,d,g){var T=D[_].unit,m=T.subarray(16,T.length-T.length%16),E=m.buffer.slice(m.byteOffset,m.byteOffset+m.length),l=this;this.decryptBuffer(E,function(t){var e=new Uint8Array(t);T.set(e,16),g||l.decryptAacSamples(D,_+1,d)})},A.decryptAacSamples=function(D,_,d){for(;;_++){if(_>=D.length){d();return}if(!(D[_].unit.length<32)){var g=this.decrypter.isSync();if(this.decryptAacSample(D,_,d,g),!g)return}}},A.getAvcEncryptedData=function(D){for(var _=Math.floor((D.length-48)/160)*16+16,d=new Int8Array(_),g=0,T=32;T<=D.length-16;T+=160,g+=16)d.set(D.subarray(T,T+16),g);return d},A.getAvcDecryptedUnit=function(D,_){for(var d=new Uint8Array(_),g=0,T=32;T<=D.length-16;T+=160,g+=16)D.set(d.subarray(g,g+16),T);return D},A.decryptAvcSample=function(D,_,d,g,T,m){var E=Object(S.discardEPB)(T.data),l=this.getAvcEncryptedData(E),t=this;this.decryptBuffer(l.buffer,function(e){T.data=t.getAvcDecryptedUnit(E,e),m||t.decryptAvcSamples(D,_,d+1,g)})},A.decryptAvcSamples=function(D,_,d,g){if(D instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;_++,d=0){if(_>=D.length){g();return}for(var T=D[_].units;!(d>=T.length);d++){var m=T[d];if(!(m.data.length<=48||m.type!==1&&m.type!==5)){var E=this.decrypter.isSync();if(this.decryptAvcSample(D,_,d,g,m,E),!E)return}}}},k}();x.default=L},"./src/demux/transmuxer-interface.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return m});var w=p("./node_modules/webworkify-webpack/index.js"),S=p.n(w),L=p("./src/events.ts"),k=p("./src/demux/transmuxer.ts"),A=p("./src/utils/logger.ts"),D=p("./src/errors.ts"),_=p("./src/utils/mediasource-helper.ts"),d=p("./node_modules/eventemitter3/index.js"),g=p.n(d),T=Object(_.getMediaSource)()||{isTypeSupported:function(){return!1}},m=function(){function E(t,e,i,c){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=i,this.onFlush=c;var h=t.config,v=function(a,r){r=r||{},r.frag=n.frag,r.id=n.id,t.trigger(a,r)};this.observer=new d.EventEmitter,this.observer.on(L.Events.FRAG_DECRYPTED,v),this.observer.on(L.Events.ERROR,v);var y={mp4:T.isTypeSupported("video/mp4"),mpeg:T.isTypeSupported("audio/mpeg"),mp3:T.isTypeSupported('audio/mp4; codecs="mp3"')},f=navigator.vendor;if(h.enableWorker&&typeof Worker!="undefined"){A.logger.log("demuxing in webworker");var s;try{s=this.worker=w("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),s.addEventListener("message",this.onwmsg),s.onerror=function(a){t.trigger(L.Events.ERROR,{type:D.ErrorTypes.OTHER_ERROR,details:D.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(a.message+"  ("+a.filename+":"+a.lineno+")")})},s.postMessage({cmd:"init",typeSupported:y,vendor:f,id:e,config:JSON.stringify(h)})}catch(a){A.logger.warn("Error in worker:",a),A.logger.error("Error while initializing DemuxerWorker, fallback to inline"),s&&self.URL.revokeObjectURL(s.objectURL),this.transmuxer=new k.default(this.observer,y,h,f,e),this.worker=null}}else this.transmuxer=new k.default(this.observer,y,h,f,e)}var l=E.prototype;return l.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.observer=null},l.push=function(t,e,i,c,n,h,v,y,f,s){var a=this;f.transmuxing.start=self.performance.now();var r=this.transmuxer,u=this.worker,o=h?h.start:n.start,b=n.decryptdata,R=this.frag,O=!(R&&n.cc===R.cc),C=!(R&&f.level===R.level),I=R?f.sn-R.sn:-1,F=this.part?f.part-this.part.index:1,M=!C&&(I===1||I===0&&F===1),P=self.performance.now();(C||I||n.stats.parsing.start===0)&&(n.stats.parsing.start=P),h&&(F||!M)&&(h.stats.parsing.start=P);var N=new k.TransmuxState(O,M,y,C,o);if(!M||O){A.logger.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+f.sn+" p: "+f.part+" level: "+f.level+" id: "+f.id+`
        discontinuity: `+O+`
        trackSwitch: `+C+`
        contiguous: `+M+`
        accurateTimeOffset: `+y+`
        timeOffset: `+o);var U=new k.TransmuxConfig(i,c,e,v,s);this.configureTransmuxer(U)}if(this.frag=n,this.part=h,u)u.postMessage({cmd:"demux",data:t,decryptdata:b,chunkMeta:f,state:N},t instanceof ArrayBuffer?[t]:[]);else if(r){var B=r.push(t,b,f,N);Object(k.isPromise)(B)?B.then(function(G){a.handleTransmuxComplete(G)}):this.handleTransmuxComplete(B)}},l.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var i=this.transmuxer,c=this.worker;if(c)c.postMessage({cmd:"flush",chunkMeta:t});else if(i){var n=i.flush(t);Object(k.isPromise)(n)?n.then(function(h){e.handleFlushResult(h,t)}):this.handleFlushResult(n,t)}},l.handleFlushResult=function(t,e){var i=this;t.forEach(function(c){i.handleTransmuxComplete(c)}),this.onFlush(e)},l.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(e.data);break}case"flush":{this.onFlush(e.data);break}default:{e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data);break}}},l.configureTransmuxer=function(t){var e=this.worker,i=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):i&&i.configure(t)},l.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},E}()},"./src/demux/transmuxer-worker.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return D});var w=p("./src/demux/transmuxer.ts"),S=p("./src/events.ts"),L=p("./src/utils/logger.ts"),k=p("./node_modules/eventemitter3/index.js"),A=p.n(k);function D(m){var E=new k.EventEmitter,l=function(t,e){m.postMessage({event:t,data:e})};E.on(S.Events.FRAG_DECRYPTED,l),E.on(S.Events.ERROR,l),m.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":{var i=JSON.parse(e.config);m.transmuxer=new w.default(E,e.typeSupported,i,e.vendor,e.id),Object(L.enableLogs)(i.debug),l("init",null);break}case"configure":{m.transmuxer.configure(e.config);break}case"demux":{var c=m.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(w.isPromise)(c)?c.then(function(v){_(m,v)}):_(m,c);break}case"flush":{var n=e.chunkMeta,h=m.transmuxer.flush(n);Object(w.isPromise)(h)?h.then(function(v){g(m,v,n)}):g(m,h,n);break}default:break}})}function _(m,E){if(!T(E.remuxResult)){var l=[],t=E.remuxResult,e=t.audio,i=t.video;e&&d(l,e),i&&d(l,i),m.postMessage({event:"transmuxComplete",data:E},l)}}function d(m,E){E.data1&&m.push(E.data1.buffer),E.data2&&m.push(E.data2.buffer)}function g(m,E,l){E.forEach(function(t){_(m,t)}),m.postMessage({event:"flush",data:l})}function T(m){return!m.audio&&!m.video&&!m.text&&!m.id3&&!m.initSegment}},"./src/demux/transmuxer.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return i}),p.d(x,"isPromise",function(){return h}),p.d(x,"TransmuxConfig",function(){return v}),p.d(x,"TransmuxState",function(){return y});var w=p("./src/events.ts"),S=p("./src/errors.ts"),L=p("./src/crypt/decrypter.ts"),k=p("./src/demux/aacdemuxer.ts"),A=p("./src/demux/mp4demuxer.ts"),D=p("./src/demux/tsdemuxer.ts"),_=p("./src/demux/mp3demuxer.ts"),d=p("./src/remux/mp4-remuxer.ts"),g=p("./src/remux/passthrough-remuxer.ts"),T=p("./src/demux/chunk-cache.ts"),m=p("./src/utils/mp4-tools.ts"),E=p("./src/utils/logger.ts"),l;try{l=self.performance.now.bind(self.performance)}catch{E.logger.debug("Unable to use Performance API on this environment"),l=self.Date.now}var t=[{demux:D.default,remux:d.default},{demux:A.default,remux:g.default},{demux:k.default,remux:d.default},{demux:_.default,remux:d.default}],e=1024;t.forEach(function(f){var s=f.demux;e=Math.max(e,s.minProbeByteLength)});var i=function(){function f(a,r,u,o,b){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new T.default,this.observer=a,this.typeSupported=r,this.config=u,this.vendor=o,this.id=b}var s=f.prototype;return s.configure=function(a){this.transmuxConfig=a,this.decrypter&&this.decrypter.reset()},s.push=function(a,r,u,o){var b=this,R=u.transmuxing;R.executeStart=l();var O=new Uint8Array(a),C=this.cache,I=this.config,F=this.currentTransmuxState,M=this.transmuxConfig;o&&(this.currentTransmuxState=o);var P=c(O,r);if(P&&P.method==="AES-128"){var N=this.getDecrypter();if(I.enableSoftwareAES){var U=N.softwareDecrypt(O,P.key.buffer,P.iv.buffer);if(!U)return R.executeEnd=l(),n(u);O=new Uint8Array(U)}else return this.decryptionPromise=N.webCryptoDecrypt(O,P.key.buffer,P.iv.buffer).then(function(Y){var it=b.push(Y,null,u);return b.decryptionPromise=null,it}),this.decryptionPromise}var B=o||F,G=B.contiguous,q=B.discontinuity,K=B.trackSwitch,W=B.accurateTimeOffset,V=B.timeOffset,J=M.audioCodec,Q=M.videoCodec,tt=M.defaultInitPts,lt=M.duration,et=M.initSegmentData;if((q||K)&&this.resetInitSegment(et,J,Q,lt),q&&this.resetInitialTimestamp(tt),G||this.resetContiguity(),this.needsProbing(O,q,K)){if(C.dataLength){var $=C.flush();O=Object(m.appendUint8Array)($,O)}this.configureTransmuxer(O,M)}var z=this.transmux(O,P,V,W,u),X=this.currentTransmuxState;return X.contiguous=!0,X.discontinuity=!1,X.trackSwitch=!1,R.executeEnd=l(),z},s.flush=function(a){var r=this,u=a.transmuxing;u.executeStart=l();var o=this.decrypter,b=this.cache,R=this.currentTransmuxState,O=this.decryptionPromise;if(O)return O.then(function(){return r.flush(a)});var C=[],I=R.timeOffset;if(o){var F=o.flush();F&&C.push(this.push(F,null,a))}var M=b.dataLength;b.reset();var P=this.demuxer,N=this.remuxer;if(!P||!N)return M>=e&&this.observer.emit(w.Events.ERROR,w.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),u.executeEnd=l(),[n(a)];var U=P.flush(I);return h(U)?U.then(function(B){return r.flushRemux(C,B,a),C}):(this.flushRemux(C,U,a),C)},s.flushRemux=function(a,r,u){var o=r.audioTrack,b=r.avcTrack,R=r.id3Track,O=r.textTrack,C=this.currentTransmuxState,I=C.accurateTimeOffset,F=C.timeOffset;E.logger.log("[transmuxer.ts]: Flushed fragment "+u.sn+(u.part>-1?" p: "+u.part:"")+" of level "+u.level);var M=this.remuxer.remux(o,b,R,O,F,I,!0,this.id);a.push({remuxResult:M,chunkMeta:u}),u.transmuxing.executeEnd=l()},s.resetInitialTimestamp=function(a){var r=this.demuxer,u=this.remuxer;!r||!u||(r.resetTimeStamp(a),u.resetTimeStamp(a))},s.resetContiguity=function(){var a=this.demuxer,r=this.remuxer;!a||!r||(a.resetContiguity(),r.resetNextTimestamp())},s.resetInitSegment=function(a,r,u,o){var b=this.demuxer,R=this.remuxer;!b||!R||(b.resetInitSegment(r,u,o),R.resetInitSegment(a,r,u))},s.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},s.transmux=function(a,r,u,o,b){var R;return r&&r.method==="SAMPLE-AES"?R=this.transmuxSampleAes(a,r,u,o,b):R=this.transmuxUnencrypted(a,u,o,b),R},s.transmuxUnencrypted=function(a,r,u,o){var b=this.demuxer.demux(a,r,!1,!this.config.progressive),R=b.audioTrack,O=b.avcTrack,C=b.id3Track,I=b.textTrack,F=this.remuxer.remux(R,O,C,I,r,u,!1,this.id);return{remuxResult:F,chunkMeta:o}},s.transmuxSampleAes=function(a,r,u,o,b){var R=this;return this.demuxer.demuxSampleAes(a,r,u).then(function(O){var C=R.remuxer.remux(O.audioTrack,O.avcTrack,O.id3Track,O.textTrack,u,o,!1,R.id);return{remuxResult:C,chunkMeta:b}})},s.configureTransmuxer=function(a,r){for(var u=this.config,o=this.observer,b=this.typeSupported,R=this.vendor,O=r.audioCodec,C=r.defaultInitPts,I=r.duration,F=r.initSegmentData,M=r.videoCodec,P,N=0,U=t.length;N<U;N++)if(t[N].demux.probe(a)){P=t[N];break}P||(E.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),P={demux:A.default,remux:g.default});var B=this.demuxer,G=this.remuxer,q=P.remux,K=P.demux;(!G||!(G instanceof q))&&(this.remuxer=new q(o,u,b,R)),(!B||!(B instanceof K))&&(this.demuxer=new K(o,u,b),this.probe=K.probe),this.resetInitSegment(F,O,M,I),this.resetInitialTimestamp(C)},s.needsProbing=function(a,r,u){return!this.demuxer||!this.remuxer||r||u},s.getDecrypter=function(){var a=this.decrypter;return a||(a=this.decrypter=new L.default(this.observer,this.config)),a},f}();function c(f,s){var a=null;return f.byteLength>0&&s!=null&&s.key!=null&&s.iv!==null&&s.method!=null&&(a=s),a}var n=function(f){return{remuxResult:{},chunkMeta:f}};function h(f){return"then"in f&&f.then instanceof Function}var v=function(f,s,a,r,u){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=f,this.videoCodec=s,this.initSegmentData=a,this.duration=r,this.defaultInitPts=u},y=function(f,s,a,r,u){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=f,this.contiguous=s,this.accurateTimeOffset=a,this.trackSwitch=r,this.timeOffset=u}},"./src/demux/tsdemuxer.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"discardEPB",function(){return n});var w=p("./src/demux/adts.ts"),S=p("./src/demux/mpegaudio.ts"),L=p("./src/demux/exp-golomb.ts"),k=p("./src/demux/id3.ts"),A=p("./src/demux/sample-aes.ts"),D=p("./src/events.ts"),_=p("./src/utils/mp4-tools.ts"),d=p("./src/utils/logger.ts"),g=p("./src/errors.ts"),T={video:1,audio:2,id3:3,text:4},m=function(){function h(y,f,s){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=y,this.config=f,this.typeSupported=s}h.probe=function(y){var f=h.syncOffset(y);return f<0?!1:(f&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+f+", junk ahead ?"),!0)},h.syncOffset=function(y){for(var f=Math.min(1e3,y.length-3*188),s=0;s<f;){if(y[s]===71&&y[s+188]===71&&y[s+2*188]===71)return s;s++}return-1},h.createTrack=function(y,f){return{container:y==="video"||y==="audio"?"video/mp2t":void 0,type:y,id:T[y],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:y==="audio"?f:void 0}};var v=h.prototype;return v.resetInitSegment=function(y,f,s){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=h.createTrack("video",s),this._audioTrack=h.createTrack("audio",s),this._id3Track=h.createTrack("id3",s),this._txtTrack=h.createTrack("text",s),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=y,this.videoCodec=f,this._duration=s},v.resetTimeStamp=function(){},v.resetContiguity=function(){var y=this._audioTrack,f=this._avcTrack,s=this._id3Track;y&&(y.pesData=null),f&&(f.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},v.demux=function(y,f,s,a){s===void 0&&(s=!1),a===void 0&&(a=!1),s||(this.sampleAes=null);var r,u=this._avcTrack,o=this._audioTrack,b=this._id3Track,R=u.pid,O=u.pesData,C=o.pid,I=b.pid,F=o.pesData,M=b.pesData,P=!1,N=this.pmtParsed,U=this._pmtId,B=y.length;if(this.remainderData&&(y=Object(_.appendUint8Array)(this.remainderData,y),B=y.length,this.remainderData=null),B<188&&!a)return this.remainderData=y,{audioTrack:o,avcTrack:u,id3Track:b,textTrack:this._txtTrack};var G=Math.max(0,h.syncOffset(y));B-=(B+G)%188,B<y.byteLength&&!a&&(this.remainderData=new Uint8Array(y.buffer,B,y.buffer.byteLength-B));for(var q=G;q<B;q+=188)if(y[q]===71){var K=!!(y[q+1]&64),W=((y[q+1]&31)<<8)+y[q+2],V=(y[q+3]&48)>>4,J=void 0;if(V>1){if(J=q+5+y[q+4],J===q+188)continue}else J=q+4;switch(W){case R:K&&(O&&(r=e(O))&&this.parseAVCPES(r,!1),O={data:[],size:0}),O&&(O.data.push(y.subarray(J,q+188)),O.size+=q+188-J);break;case C:K&&(F&&(r=e(F))&&(o.isAAC?this.parseAACPES(r):this.parseMPEGPES(r)),F={data:[],size:0}),F&&(F.data.push(y.subarray(J,q+188)),F.size+=q+188-J);break;case I:K&&(M&&(r=e(M))&&this.parseID3PES(r),M={data:[],size:0}),M&&(M.data.push(y.subarray(J,q+188)),M.size+=q+188-J);break;case 0:K&&(J+=y[J]+1),U=this._pmtId=l(y,J);break;case U:{K&&(J+=y[J]+1);var Q=t(y,J,this.typeSupported.mpeg===!0||this.typeSupported.mp3===!0,s);R=Q.avc,R>0&&(u.pid=R),C=Q.audio,C>0&&(o.pid=C,o.isAAC=Q.isAAC),I=Q.id3,I>0&&(b.pid=I),P&&!N&&(d.logger.log("reparse from beginning"),P=!1,q=G-188),N=this.pmtParsed=!0;break}case 17:case 8191:break;default:P=!0;break}}else this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});u.pesData=O,o.pesData=F,b.pesData=M;var tt={audioTrack:o,avcTrack:u,id3Track:b,textTrack:this._txtTrack};return a&&this.extractRemainingSamples(tt),tt},v.flush=function(){var y=this.remainderData;this.remainderData=null;var f;return y?f=this.demux(y,-1,!1,!0):f={audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(f),this.sampleAes?this.decrypt(f,this.sampleAes):f},v.extractRemainingSamples=function(y){var f=y.audioTrack,s=y.avcTrack,a=y.id3Track,r=s.pesData,u=f.pesData,o=a.pesData,b;r&&(b=e(r))?(this.parseAVCPES(b,!0),s.pesData=null):s.pesData=r,u&&(b=e(u))?(f.isAAC?this.parseAACPES(b):this.parseMPEGPES(b),f.pesData=null):(u!=null&&u.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),f.pesData=u),o&&(b=e(o))?(this.parseID3PES(b),a.pesData=null):a.pesData=o},v.demuxSampleAes=function(y,f,s){var a=this.demux(y,s,!0,!this.config.progressive),r=this.sampleAes=new A.default(this.observer,this.config,f);return this.decrypt(a,r)},v.decrypt=function(y,f){return new Promise(function(s){var a=y.audioTrack,r=y.avcTrack;a.samples&&a.isAAC?f.decryptAacSamples(a.samples,0,function(){r.samples?f.decryptAvcSamples(r.samples,0,0,function(){s(y)}):s(y)}):r.samples&&f.decryptAvcSamples(r.samples,0,0,function(){s(y)})})},v.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},v.parseAVCPES=function(y,f){var s=this,a=this._avcTrack,r=this.parseAVCNALu(y.data),u=!1,o=this.avcSample,b,R=!1;y.data=null,o&&r.length&&!a.audFound&&(i(o,a),o=this.avcSample=E(!1,y.pts,y.dts,"")),r.forEach(function(O){switch(O.type){case 1:{b=!0,o||(o=s.avcSample=E(!0,y.pts,y.dts,"")),u&&(o.debug+="NDR "),o.frame=!0;var C=O.data;if(R&&C.length>4){var I=new L.default(C).readSliceType();(I===2||I===4||I===7||I===9)&&(o.key=!0)}break}case 5:b=!0,o||(o=s.avcSample=E(!0,y.pts,y.dts,"")),u&&(o.debug+="IDR "),o.key=!0,o.frame=!0;break;case 6:{b=!0,u&&o&&(o.debug+="SEI ");var F=new L.default(n(O.data));F.readUByte();for(var M=0,P=0,N=!1,U=0;!N&&F.bytesAvailable>1;){M=0;do U=F.readUByte(),M+=U;while(U===255);P=0;do U=F.readUByte(),P+=U;while(U===255);if(M===4&&F.bytesAvailable!==0){N=!0;var B=F.readUByte();if(B===181){var G=F.readUShort();if(G===49){var q=F.readUInt();if(q===1195456820){var K=F.readUByte();if(K===3){for(var W=F.readUByte(),V=F.readUByte(),J=31&W,Q=[W,V],tt=0;tt<J;tt++)Q.push(F.readUByte()),Q.push(F.readUByte()),Q.push(F.readUByte());c(s._txtTrack.samples,{type:3,pts:y.pts,bytes:Q})}}}}}else if(M===5&&F.bytesAvailable!==0){if(N=!0,P>16){for(var lt=[],et=0;et<16;et++)lt.push(F.readUByte().toString(16)),(et===3||et===5||et===7||et===9)&&lt.push("-");for(var $=P-16,z=new Uint8Array($),X=0;X<$;X++)z[X]=F.readUByte();c(s._txtTrack.samples,{pts:y.pts,payloadType:M,uuid:lt.join(""),userData:Object(k.utf8ArrayToStr)(z),userDataBytes:z})}}else if(P<F.bytesAvailable)for(var Y=0;Y<P;Y++)F.readUByte()}break}case 7:if(b=!0,R=!0,u&&o&&(o.debug+="SPS "),!a.sps){var it=new L.default(O.data),st=it.readSPS();a.width=st.width,a.height=st.height,a.pixelRatio=st.pixelRatio,a.sps=[O.data],a.duration=s._duration;for(var ot=O.data.subarray(1,4),ht="avc1.",at=0;at<3;at++){var ut=ot[at].toString(16);ut.length<2&&(ut="0"+ut),ht+=ut}a.codec=ht}break;case 8:b=!0,u&&o&&(o.debug+="PPS "),a.pps||(a.pps=[O.data]);break;case 9:b=!1,a.audFound=!0,o&&i(o,a),o=s.avcSample=E(!1,y.pts,y.dts,u?"AUD ":"");break;case 12:b=!1;break;default:b=!1,o&&(o.debug+="unknown NAL "+O.type+" ");break}if(o&&b){var rt=o.units;rt.push(O)}}),f&&o&&(i(o,a),this.avcSample=null)},v.getLastNalUnit=function(){var y,f=this.avcSample,s;if(!f||f.units.length===0){var a=this._avcTrack.samples;f=a[a.length-1]}if((y=f)!==null&&y!==void 0&&y.units){var r=f.units;s=r[r.length-1]}return s},v.parseAVCNALu=function(y){var f=y.byteLength,s=this._avcTrack,a=s.naluState||0,r=a,u=[],o=0,b,R,O,C=-1,I=0;for(a===-1&&(C=0,I=y[0]&31,a=0,o=1);o<f;){if(b=y[o++],!a){a=b?0:1;continue}if(a===1){a=b?0:2;continue}if(!b)a=3;else if(b===1){if(C>=0){var F={data:y.subarray(C,o-a-1),type:I};u.push(F)}else{var M=this.getLastNalUnit();if(M&&(r&&o<=4-r&&M.state&&(M.data=M.data.subarray(0,M.data.byteLength-r)),R=o-a-1,R>0)){var P=new Uint8Array(M.data.byteLength+R);P.set(M.data,0),P.set(y.subarray(0,R),M.data.byteLength),M.data=P}}o<f?(O=y[o]&31,C=o,I=O,a=0):a=-1}else a=0}if(C>=0&&a>=0){var N={data:y.subarray(C,f),type:I,state:a};u.push(N)}if(u.length===0){var U=this.getLastNalUnit();if(U){var B=new Uint8Array(U.data.byteLength+y.byteLength);B.set(U.data,0),B.set(y,U.data.byteLength),U.data=B}}return s.naluState=a,u},v.parseAACPES=function(y){var f=0,s=this._audioTrack,a=this.aacOverFlow,r=y.data;if(a){this.aacOverFlow=null;var u=a.sample.unit.byteLength,o=Math.min(a.missing,u),b=u-o;a.sample.unit.set(r.subarray(0,o),b),s.samples.push(a.sample),f=a.missing}var R,O;for(R=f,O=r.length;R<O-1&&!w.isHeader(r,R);R++);if(R!==f){var C,I;if(R<O-1?(C="AAC PES did not start with ADTS header,offset:"+R,I=!1):(C="no ADTS header found in AAC PES",I=!0),d.logger.warn("parsing error:"+C),this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:I,reason:C}),I)return}w.initTrackConfig(s,this.observer,r,R,this.audioCodec);var F;if(y.pts!==void 0)F=y.pts;else if(a){var M=w.getFrameDuration(s.samplerate);F=a.sample.pts+M}else{d.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var P=0;R<O;)if(w.isHeader(r,R)){if(R+5<O){var N=w.appendFrame(s,r,R,F,P);if(N)if(N.missing)this.aacOverFlow=N;else{R+=N.length,P++;continue}}break}else R++},v.parseMPEGPES=function(y){var f=y.data,s=f.length,a=0,r=0,u=y.pts;if(u===void 0){d.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;r<s;)if(S.isHeader(f,r)){var o=S.appendFrame(this._audioTrack,f,r,u,a);if(o)r+=o.length,a++;else break}else r++},v.parseID3PES=function(y){if(y.pts===void 0){d.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}this._id3Track.samples.push(y)},h}();m.minProbeByteLength=188;function E(h,v,y,f){return{key:h,frame:!1,pts:v,dts:y,units:[],debug:f,length:0}}function l(h,v){return(h[v+10]&31)<<8|h[v+11]}function t(h,v,y,f){var s={audio:-1,avc:-1,id3:-1,isAAC:!0},a=(h[v+1]&15)<<8|h[v+2],r=v+3+a-4,u=(h[v+10]&15)<<8|h[v+11];for(v+=12+u;v<r;){var o=(h[v+1]&31)<<8|h[v+2];switch(h[v]){case 207:if(!f){d.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:s.audio===-1&&(s.audio=o);break;case 21:s.id3===-1&&(s.id3=o);break;case 219:if(!f){d.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:s.avc===-1&&(s.avc=o);break;case 3:case 4:y?s.audio===-1&&(s.audio=o,s.isAAC=!1):d.logger.log("MPEG audio found, not supported in this browser");break;case 36:d.logger.warn("Unsupported HEVC stream type found");break;default:break}v+=((h[v+3]&15)<<8|h[v+4])+5}return s}function e(h){var v=0,y,f,s,a,r,u=h.data;if(!h||h.size===0)return null;for(;u[0].length<19&&u.length>1;){var o=new Uint8Array(u[0].length+u[1].length);o.set(u[0]),o.set(u[1],u[0].length),u[0]=o,u.splice(1,1)}y=u[0];var b=(y[0]<<16)+(y[1]<<8)+y[2];if(b===1){if(f=(y[4]<<8)+y[5],f&&f>h.size-6)return null;var R=y[7];R&192&&(a=(y[9]&14)*536870912+(y[10]&255)*4194304+(y[11]&254)*16384+(y[12]&255)*128+(y[13]&254)/2,R&64?(r=(y[14]&14)*536870912+(y[15]&255)*4194304+(y[16]&254)*16384+(y[17]&255)*128+(y[18]&254)/2,a-r>60*9e4&&(d.logger.warn(Math.round((a-r)/9e4)+"s delta between PTS and DTS, align them"),a=r)):r=a),s=y[8];var O=s+9;if(h.size<=O)return null;h.size-=O;for(var C=new Uint8Array(h.size),I=0,F=u.length;I<F;I++){y=u[I];var M=y.byteLength;if(O)if(O>M){O-=M;continue}else y=y.subarray(O),M-=O,O=0;C.set(y,v),v+=M}return f&&(f-=s+3),{data:C,pts:a,dts:r,len:f}}return null}function i(h,v){if(h.units.length&&h.frame){if(h.pts===void 0){var y=v.samples,f=y.length;if(f){var s=y[f-1];h.pts=s.pts,h.dts=s.dts}else{v.dropped++;return}}v.samples.push(h)}h.debug.length&&d.logger.log(h.pts+"/"+h.dts+":"+h.debug)}function c(h,v){var y=h.length;if(y>0){if(v.pts>=h[y-1].pts)h.push(v);else for(var f=y-1;f>=0;f--)if(v.pts<h[f].pts){h.splice(f,0,v);break}}else h.push(v)}function n(h){for(var v=h.byteLength,y=[],f=1;f<v-2;)h[f]===0&&h[f+1]===0&&h[f+2]===3?(y.push(f+2),f+=2):f++;if(y.length===0)return h;var s=v-y.length,a=new Uint8Array(s),r=0;for(f=0;f<s;r++,f++)r===y[0]&&(r++,y.shift()),a[f]=h[r];return a}x.default=m},"./src/errors.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"ErrorTypes",function(){return w}),p.d(x,"ErrorDetails",function(){return S});var w;(function(L){L.NETWORK_ERROR="networkError",L.MEDIA_ERROR="mediaError",L.KEY_SYSTEM_ERROR="keySystemError",L.MUX_ERROR="muxError",L.OTHER_ERROR="otherError"})(w||(w={}));var S;(function(L){L.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",L.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",L.KEY_SYSTEM_NO_SESSION="keySystemNoSession",L.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",L.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",L.MANIFEST_LOAD_ERROR="manifestLoadError",L.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",L.MANIFEST_PARSING_ERROR="manifestParsingError",L.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",L.LEVEL_EMPTY_ERROR="levelEmptyError",L.LEVEL_LOAD_ERROR="levelLoadError",L.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",L.LEVEL_SWITCH_ERROR="levelSwitchError",L.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",L.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",L.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",L.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",L.FRAG_LOAD_ERROR="fragLoadError",L.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",L.FRAG_DECRYPT_ERROR="fragDecryptError",L.FRAG_PARSING_ERROR="fragParsingError",L.REMUX_ALLOC_ERROR="remuxAllocError",L.KEY_LOAD_ERROR="keyLoadError",L.KEY_LOAD_TIMEOUT="keyLoadTimeOut",L.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",L.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",L.BUFFER_APPEND_ERROR="bufferAppendError",L.BUFFER_APPENDING_ERROR="bufferAppendingError",L.BUFFER_STALLED_ERROR="bufferStalledError",L.BUFFER_FULL_ERROR="bufferFullError",L.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",L.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",L.INTERNAL_EXCEPTION="internalException",L.INTERNAL_ABORTED="aborted",L.UNKNOWN="unknown"})(S||(S={}))},"./src/events.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"Events",function(){return w});var w;(function(S){S.MEDIA_ATTACHING="hlsMediaAttaching",S.MEDIA_ATTACHED="hlsMediaAttached",S.MEDIA_DETACHING="hlsMediaDetaching",S.MEDIA_DETACHED="hlsMediaDetached",S.BUFFER_RESET="hlsBufferReset",S.BUFFER_CODECS="hlsBufferCodecs",S.BUFFER_CREATED="hlsBufferCreated",S.BUFFER_APPENDING="hlsBufferAppending",S.BUFFER_APPENDED="hlsBufferAppended",S.BUFFER_EOS="hlsBufferEos",S.BUFFER_FLUSHING="hlsBufferFlushing",S.BUFFER_FLUSHED="hlsBufferFlushed",S.MANIFEST_LOADING="hlsManifestLoading",S.MANIFEST_LOADED="hlsManifestLoaded",S.MANIFEST_PARSED="hlsManifestParsed",S.LEVEL_SWITCHING="hlsLevelSwitching",S.LEVEL_SWITCHED="hlsLevelSwitched",S.LEVEL_LOADING="hlsLevelLoading",S.LEVEL_LOADED="hlsLevelLoaded",S.LEVEL_UPDATED="hlsLevelUpdated",S.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",S.LEVELS_UPDATED="hlsLevelsUpdated",S.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",S.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",S.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",S.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",S.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",S.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",S.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",S.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",S.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",S.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",S.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",S.CUES_PARSED="hlsCuesParsed",S.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",S.INIT_PTS_FOUND="hlsInitPtsFound",S.FRAG_LOADING="hlsFragLoading",S.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",S.FRAG_LOADED="hlsFragLoaded",S.FRAG_DECRYPTED="hlsFragDecrypted",S.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",S.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",S.FRAG_PARSING_METADATA="hlsFragParsingMetadata",S.FRAG_PARSED="hlsFragParsed",S.FRAG_BUFFERED="hlsFragBuffered",S.FRAG_CHANGED="hlsFragChanged",S.FPS_DROP="hlsFpsDrop",S.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",S.ERROR="hlsError",S.DESTROYING="hlsDestroying",S.KEY_LOADING="hlsKeyLoading",S.KEY_LOADED="hlsKeyLoaded",S.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",S.BACK_BUFFER_REACHED="hlsBackBufferReached"})(w||(w={}))},"./src/hls.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return h});var w=p("./node_modules/url-toolkit/src/url-toolkit.js"),S=p.n(w),L=p("./src/loader/playlist-loader.ts"),k=p("./src/loader/key-loader.ts"),A=p("./src/controller/id3-track-controller.ts"),D=p("./src/controller/latency-controller.ts"),_=p("./src/controller/level-controller.ts"),d=p("./src/controller/fragment-tracker.ts"),g=p("./src/controller/stream-controller.ts"),T=p("./src/is-supported.ts"),m=p("./src/utils/logger.ts"),E=p("./src/config.ts"),l=p("./node_modules/eventemitter3/index.js"),t=p.n(l),e=p("./src/events.ts"),i=p("./src/errors.ts");function c(v,y){for(var f=0;f<y.length;f++){var s=y[f];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(v,s.key,s)}}function n(v,y,f){return y&&c(v.prototype,y),f&&c(v,f),v}var h=function(){v.isSupported=function(){return Object(T.isSupported)()};function v(f){f===void 0&&(f={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new l.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var s=this.config=Object(E.mergeConfig)(v.DefaultConfig,f);this.userConfig=f,Object(m.enableLogs)(s.debug),this._autoLevelCapping=-1,s.progressive&&Object(E.enableStreamingMode)(s);var a=s.abrController,r=s.bufferController,u=s.capLevelController,o=s.fpsController,b=this.abrController=new a(this),R=this.bufferController=new r(this),O=this.capLevelController=new u(this),C=new o(this),I=new L.default(this),F=new k.default(this),M=new A.default(this),P=this.levelController=new _.default(this),N=new d.FragmentTracker(this),U=this.streamController=new g.default(this,N);O.setStreamController(U),C.setStreamController(U);var B=[P,U];this.networkControllers=B;var G=[I,F,b,R,O,C,M,N];this.audioTrackController=this.createController(s.audioTrackController,null,B),this.createController(s.audioStreamController,N,B),this.subtitleTrackController=this.createController(s.subtitleTrackController,null,B),this.createController(s.subtitleStreamController,N,B),this.createController(s.timelineController,null,G),this.emeController=this.createController(s.emeController,null,G),this.latencyController=this.createController(D.default,null,G),this.coreComponents=G}var y=v.prototype;return y.createController=function(f,s,a){if(f){var r=s?new f(this,s):new f(this);return a&&a.push(r),r}return null},y.on=function(f,s,a){a===void 0&&(a=this),this._emitter.on(f,s,a)},y.once=function(f,s,a){a===void 0&&(a=this),this._emitter.once(f,s,a)},y.removeAllListeners=function(f){this._emitter.removeAllListeners(f)},y.off=function(f,s,a,r){a===void 0&&(a=this),this._emitter.off(f,s,a,r)},y.listeners=function(f){return this._emitter.listeners(f)},y.emit=function(f,s,a){return this._emitter.emit(f,s,a)},y.trigger=function(f,s){if(this.config.debug)return this.emit(f,f,s);try{return this.emit(f,f,s)}catch(a){m.logger.error("An internal error happened while handling event "+f+'. Error message: "'+a.message+'". Here is a stacktrace:',a),this.trigger(e.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:f,error:a})}return!1},y.listenerCount=function(f){return this._emitter.listenerCount(f)},y.destroy=function(){m.logger.log("destroy"),this.trigger(e.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(f){return f.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(f){return f.destroy()}),this.coreComponents.length=0},y.attachMedia=function(f){m.logger.log("attachMedia"),this._media=f,this.trigger(e.Events.MEDIA_ATTACHING,{media:f})},y.detachMedia=function(){m.logger.log("detachMedia"),this.trigger(e.Events.MEDIA_DETACHING,void 0),this._media=null},y.loadSource=function(f){this.stopLoad();var s=this.media,a=this.url,r=this.url=w.buildAbsoluteURL(self.location.href,f,{alwaysNormalize:!0});m.logger.log("loadSource:"+r),s&&a&&a!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(s)),this.trigger(e.Events.MANIFEST_LOADING,{url:f})},y.startLoad=function(f){f===void 0&&(f=-1),m.logger.log("startLoad("+f+")"),this.networkControllers.forEach(function(s){s.startLoad(f)})},y.stopLoad=function(){m.logger.log("stopLoad"),this.networkControllers.forEach(function(f){f.stopLoad()})},y.swapAudioCodec=function(){m.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},y.recoverMediaError=function(){m.logger.log("recoverMediaError");var f=this._media;this.detachMedia(),f&&this.attachMedia(f)},y.removeLevel=function(f,s){s===void 0&&(s=0),this.levelController.removeLevel(f,s)},n(v,[{key:"levels",get:function(){var f=this.levelController.levels;return f||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(f){m.logger.log("set currentLevel:"+f),this.loadLevel=f,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(f){m.logger.log("set nextLevel:"+f),this.levelController.manualLevel=f,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(f){m.logger.log("set loadLevel:"+f),this.levelController.manualLevel=f}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(f){this.levelController.nextLoadLevel=f}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(f){m.logger.log("set firstLevel:"+f),this.levelController.firstLevel=f}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(f){m.logger.log("set startLevel:"+f),f!==-1&&(f=Math.max(f,this.minAutoLevel)),this.levelController.startLevel=f}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(f){var s=!!f;s!==this.config.capLevelToPlayerSize&&(s?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=s)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(f){this._autoLevelCapping!==f&&(m.logger.log("set autoLevelCapping:"+f),this._autoLevelCapping=f)}},{key:"bandwidthEstimate",get:function(){var f=this.abrController.bwEstimator;return f?f.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var f=this.levels,s=this.config.minAutoBitrate;if(!f)return 0;for(var a=f.length,r=0;r<a;r++)if(f[r].maxBitrate>s)return r;return 0}},{key:"maxAutoLevel",get:function(){var f=this.levels,s=this.autoLevelCapping,a;return s===-1&&f&&f.length?a=f.length-1:a=s,a}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(f){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,f)}},{key:"audioTracks",get:function(){var f=this.audioTrackController;return f?f.audioTracks:[]}},{key:"audioTrack",get:function(){var f=this.audioTrackController;return f?f.audioTrack:-1},set:function(f){var s=this.audioTrackController;s&&(s.audioTrack=f)}},{key:"subtitleTracks",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var f=this.subtitleTrackController;return f?f.subtitleTrack:-1},set:function(f){var s=this.subtitleTrackController;s&&(s.subtitleTrack=f)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var f=this.subtitleTrackController;return f?f.subtitleDisplay:!1},set:function(f){var s=this.subtitleTrackController;s&&(s.subtitleDisplay=f)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(f){this.config.lowLatencyMode=f}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.11"}},{key:"Events",get:function(){return e.Events}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return v.defaultConfig?v.defaultConfig:E.hlsDefaultConfig},set:function(f){v.defaultConfig=f}}]),v}();h.defaultConfig=void 0},"./src/is-supported.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"isSupported",function(){return L}),p.d(x,"changeTypeSupported",function(){return k});var w=p("./src/utils/mediasource-helper.ts");function S(){return self.SourceBuffer||self.WebKitSourceBuffer}function L(){var A=Object(w.getMediaSource)();if(!A)return!1;var D=S(),_=A&&typeof A.isTypeSupported=="function"&&A.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),d=!D||D.prototype&&typeof D.prototype.appendBuffer=="function"&&typeof D.prototype.remove=="function";return!!_&&!!d}function k(){var A,D=S();return typeof(D==null||(A=D.prototype)===null||A===void 0?void 0:A.changeType)=="function"}},"./src/loader/fragment-loader.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return m}),p.d(x,"LoadError",function(){return l});var w=p("./src/polyfills/number.ts"),S=p("./src/errors.ts");function L(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}function k(t){var e=typeof Map=="function"?new Map:void 0;return k=function(i){if(i===null||!_(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e!="undefined"){if(e.has(i))return e.get(i);e.set(i,c)}function c(){return A(i,arguments,g(this).constructor)}return c.prototype=Object.create(i.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}}),d(c,i)},k(t)}function A(t,e,i){return D()?A=Reflect.construct:A=function(c,n,h){var v=[null];v.push.apply(v,n);var y=Function.bind.apply(c,v),f=new y;return h&&d(f,h.prototype),f},A.apply(null,arguments)}function D(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function d(t,e){return d=Object.setPrototypeOf||function(i,c){return i.__proto__=c,i},d(t,e)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},g(t)}var T=Math.pow(2,17),m=function(){function t(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(i,c){var n=this,h=i.url;if(!h)return Promise.reject(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,networkDetails:null},"Fragment does not have a "+(h?"part list":"url")));this.abort();var v=this.config,y=v.fLoader,f=v.loader;return new Promise(function(s,a){n.loader&&n.loader.destroy();var r=n.loader=i.loader=y?new y(v):new f(v),u=E(i),o={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:T};i.stats=r.stats,r.load(u,o,{onSuccess:function(b,R,O,C){n.resetLoader(i,r),s({frag:i,part:null,payload:b.data,networkDetails:C})},onError:function(b,R,O){n.resetLoader(i,r),a(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,response:b,networkDetails:O}))},onAbort:function(b,R,O){n.resetLoader(i,r),a(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,networkDetails:O}))},onTimeout:function(b,R,O){n.resetLoader(i,r),a(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,networkDetails:O}))},onProgress:function(b,R,O,C){c&&c({frag:i,part:null,payload:O,networkDetails:C})}})})},e.loadPart=function(i,c,n){var h=this;this.abort();var v=this.config,y=v.fLoader,f=v.loader;return new Promise(function(s,a){h.loader&&h.loader.destroy();var r=h.loader=i.loader=y?new y(v):new f(v),u=E(i,c),o={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:T};c.stats=r.stats,r.load(u,o,{onSuccess:function(b,R,O,C){h.resetLoader(i,r),h.updateStatsFromPart(i,c);var I={frag:i,part:c,payload:b.data,networkDetails:C};n(I),s(I)},onError:function(b,R,O){h.resetLoader(i,r),a(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,part:c,response:b,networkDetails:O}))},onAbort:function(b,R,O){i.stats.aborted=c.stats.aborted,h.resetLoader(i,r),a(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,part:c,networkDetails:O}))},onTimeout:function(b,R,O){h.resetLoader(i,r),a(new l({type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,part:c,networkDetails:O}))}})})},e.updateStatsFromPart=function(i,c){var n=i.stats,h=c.stats,v=h.total;if(n.loaded+=h.loaded,v){var y=Math.round(i.duration/c.duration),f=Math.min(Math.round(n.loaded/v),y),s=y-f,a=s*Math.round(n.loaded/f);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);var r=n.loading,u=h.loading;r.start?r.first+=u.first-u.start:(r.start=u.start,r.first=u.first),r.end=u.end},e.resetLoader=function(i,c){i.loader=null,this.loader===c&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),c.destroy()},t}();function E(t,e){e===void 0&&(e=null);var i=e||t,c={frag:t,part:e,responseType:"arraybuffer",url:i.url,rangeStart:0,rangeEnd:0},n=i.byteRangeStartOffset,h=i.byteRangeEndOffset;return Object(w.isFiniteNumber)(n)&&Object(w.isFiniteNumber)(h)&&(c.rangeStart=n,c.rangeEnd=h),c}var l=function(t){L(e,t);function e(i){for(var c,n=arguments.length,h=new Array(n>1?n-1:0),v=1;v<n;v++)h[v-1]=arguments[v];return c=t.call.apply(t,[this].concat(h))||this,c.data=void 0,c.data=i,c}return e}(k(Error))},"./src/loader/fragment.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"ElementaryStreamTypes",function(){return m}),p.d(x,"BaseSegment",function(){return E}),p.d(x,"Fragment",function(){return l}),p.d(x,"Part",function(){return t});var w=p("./src/polyfills/number.ts"),S=p("./node_modules/url-toolkit/src/url-toolkit.js"),L=p.n(S),k=p("./src/utils/logger.ts"),A=p("./src/loader/level-key.ts"),D=p("./src/loader/load-stats.ts");function _(e,i){e.prototype=Object.create(i.prototype),e.prototype.constructor=e,d(e,i)}function d(e,i){return d=Object.setPrototypeOf||function(c,n){return c.__proto__=n,c},d(e,i)}function g(e,i){for(var c=0;c<i.length;c++){var n=i[c];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function T(e,i,c){return i&&g(e.prototype,i),c&&g(e,c),e}var m;(function(e){e.AUDIO="audio",e.VIDEO="video",e.AUDIOVIDEO="audiovideo"})(m||(m={}));var E=function(){function e(c){var n;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(n={},n[m.AUDIO]=null,n[m.VIDEO]=null,n[m.AUDIOVIDEO]=null,n),this.baseurl=c}var i=e.prototype;return i.setByteRange=function(c,n){var h=c.split("@",2),v=[];h.length===1?v[0]=n?n.byteRangeEndOffset:0:v[0]=parseInt(h[1]),v[1]=parseInt(h[0])+v[0],this._byteRange=v},T(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(S.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(c){this._url=c}}]),e}(),l=function(e){_(i,e);function i(n,h){var v;return v=e.call(this,h)||this,v._decryptdata=null,v.rawProgramDateTime=null,v.programDateTime=null,v.tagList=[],v.duration=0,v.sn=0,v.levelkey=void 0,v.type=void 0,v.loader=null,v.level=-1,v.cc=0,v.startPTS=void 0,v.endPTS=void 0,v.appendedPTS=void 0,v.startDTS=void 0,v.endDTS=void 0,v.start=0,v.deltaPTS=void 0,v.maxStartPTS=void 0,v.minEndPTS=void 0,v.stats=new D.LoadStats,v.urlId=0,v.data=void 0,v.bitrateTest=!1,v.title=null,v.initSegment=null,v.type=n,v}var c=i.prototype;return c.createInitializationVector=function(n){for(var h=new Uint8Array(16),v=12;v<16;v++)h[v]=n>>8*(15-v)&255;return h},c.setDecryptDataFromLevelKey=function(n,h){var v=n;return(n==null?void 0:n.method)==="AES-128"&&n.uri&&!n.iv&&(v=A.LevelKey.fromURI(n.uri),v.method=n.method,v.iv=this.createInitializationVector(h),v.keyFormat="identity"),v},c.setElementaryStreamInfo=function(n,h,v,y,f,s){s===void 0&&(s=!1);var a=this.elementaryStreams,r=a[n];if(!r){a[n]={startPTS:h,endPTS:v,startDTS:y,endDTS:f,partial:s};return}r.startPTS=Math.min(r.startPTS,h),r.endPTS=Math.max(r.endPTS,v),r.startDTS=Math.min(r.startDTS,y),r.endDTS=Math.max(r.endDTS,f)},c.clearElementaryStreamInfo=function(){var n=this.elementaryStreams;n[m.AUDIO]=null,n[m.VIDEO]=null,n[m.AUDIOVIDEO]=null},T(i,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var n=this.sn;typeof n!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&k.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),n=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,n)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(w.isFiniteNumber)(this.programDateTime))return null;var n=Object(w.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+n*1e3}},{key:"encrypted",get:function(){var n;return!!((n=this.decryptdata)!==null&&n!==void 0&&n.keyFormat&&this.decryptdata.uri)}}]),i}(E),t=function(e){_(i,e);function i(c,n,h,v,y){var f;f=e.call(this,h)||this,f.fragOffset=0,f.duration=0,f.gap=!1,f.independent=!1,f.relurl=void 0,f.fragment=void 0,f.index=void 0,f.stats=new D.LoadStats,f.duration=c.decimalFloatingPoint("DURATION"),f.gap=c.bool("GAP"),f.independent=c.bool("INDEPENDENT"),f.relurl=c.enumeratedString("URI"),f.fragment=n,f.index=v;var s=c.enumeratedString("BYTERANGE");return s&&f.setByteRange(s,y),y&&(f.fragOffset=y.fragOffset+y.duration),f}return T(i,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var c=this.elementaryStreams;return!!(c.audio||c.video||c.audiovideo)}}]),i}(E)},"./src/loader/key-loader.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return k});var w=p("./src/events.ts"),S=p("./src/errors.ts"),L=p("./src/utils/logger.ts"),k=function(){function A(_){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=_,this._registerListeners()}var D=A.prototype;return D._registerListeners=function(){this.hls.on(w.Events.KEY_LOADING,this.onKeyLoading,this)},D._unregisterListeners=function(){this.hls.off(w.Events.KEY_LOADING,this.onKeyLoading)},D.destroy=function(){this._unregisterListeners();for(var _ in this.loaders){var d=this.loaders[_];d&&d.destroy()}this.loaders={}},D.onKeyLoading=function(_,d){var g=d.frag,T=g.type,m=this.loaders[T];if(!g.decryptdata){L.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var E=g.decryptdata.uri;if(E!==this.decrypturl||this.decryptkey===null){var l=this.hls.config;if(m&&(L.logger.warn("abort previous key loader for type:"+T),m.abort()),!E){L.logger.warn("key uri is falsy");return}var t=l.loader,e=g.loader=this.loaders[T]=new t(l);this.decrypturl=E,this.decryptkey=null;var i={url:E,frag:g,responseType:"arraybuffer"},c={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.load(i,c,n)}else this.decryptkey&&(g.decryptdata.key=this.decryptkey,this.hls.trigger(w.Events.KEY_LOADED,{frag:g}))},D.loadsuccess=function(_,d,g){var T=g.frag;if(!T.decryptdata){L.logger.error("after key load, decryptdata unset");return}this.decryptkey=T.decryptdata.key=new Uint8Array(_.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(w.Events.KEY_LOADED,{frag:T})},D.loaderror=function(_,d){var g=d.frag,T=g.loader;T&&T.abort(),delete this.loaders[g.type],this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:g,response:_})},D.loadtimeout=function(_,d){var g=d.frag,T=g.loader;T&&T.abort(),delete this.loaders[g.type],this.hls.trigger(w.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:g})},A}()},"./src/loader/level-details.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"LevelDetails",function(){return A});var w=p("./src/polyfills/number.ts");function S(D,_){for(var d=0;d<_.length;d++){var g=_[d];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(D,g.key,g)}}function L(D,_,d){return _&&S(D.prototype,_),d&&S(D,d),D}var k=10,A=function(){function D(d){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=d}var _=D.prototype;return _.reloaded=function(d){if(!d){this.advanced=!0,this.updated=!0;return}var g=this.lastPartSn-d.lastPartSn,T=this.lastPartIndex-d.lastPartIndex;this.updated=this.endSN!==d.endSN||!!T||!!g,this.advanced=this.endSN>d.endSN||g>0||g===0&&T>0,this.updated||this.advanced?this.misses=Math.floor(d.misses*.6):this.misses=d.misses+1,this.availabilityDelay=d.availabilityDelay},L(D,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(w.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||k}},{key:"drift",get:function(){var d=this.driftEndTime-this.driftStartTime;if(d>0){var g=this.driftEnd-this.driftStart;return g*1e3/d}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var d;return(d=this.partList)!==null&&d!==void 0&&d.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var d;return(d=this.fragments)!==null&&d!==void 0&&d.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var d;return(d=this.partList)!==null&&d!==void 0&&d.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var d;return(d=this.partList)!==null&&d!==void 0&&d.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),D}()},"./src/loader/level-key.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"LevelKey",function(){return A});var w=p("./node_modules/url-toolkit/src/url-toolkit.js"),S=p.n(w);function L(D,_){for(var d=0;d<_.length;d++){var g=_[d];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(D,g.key,g)}}function k(D,_,d){return _&&L(D.prototype,_),d&&L(D,d),D}var A=function(){D.fromURL=function(_,d){return new D(_,d)},D.fromURI=function(_){return new D(_)};function D(_,d){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,d?this._uri=Object(w.buildAbsoluteURL)(_,d,{alwaysNormalize:!0}):this._uri=_}return k(D,[{key:"uri",get:function(){return this._uri}}]),D}()},"./src/loader/load-stats.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"LoadStats",function(){return w});var w=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return i});var w=p("./src/polyfills/number.ts"),S=p("./node_modules/url-toolkit/src/url-toolkit.js"),L=p.n(S),k=p("./src/loader/fragment.ts"),A=p("./src/loader/level-details.ts"),D=p("./src/loader/level-key.ts"),_=p("./src/utils/attr-list.ts"),d=p("./src/utils/logger.ts"),g=p("./src/utils/codecs.ts"),T=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,m=/#EXT-X-MEDIA:(.*)/g,E=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),l=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),t=/\.(mp4|m4s|m4v|m4a)$/i;function e(y){var f,s;return t.test((f=(s=S.parseURL(y))===null||s===void 0?void 0:s.path)!=null?f:"")}var i=function(){function y(){}return y.findGroup=function(f,s){for(var a=0;a<f.length;a++){var r=f[a];if(r.id===s)return r}},y.convertAVC1ToAVCOTI=function(f){var s=f.split(".");if(s.length>2){var a=s.shift()+".";return a+=parseInt(s.shift()).toString(16),a+=("000"+parseInt(s.shift()).toString(16)).substr(-4),a}return f},y.resolve=function(f,s){return S.buildAbsoluteURL(s,f,{alwaysNormalize:!0})},y.parseMasterPlaylist=function(f,s){var a=[],r={},u=!1;T.lastIndex=0;for(var o;(o=T.exec(f))!=null;)if(o[1]){var b=new _.AttrList(o[1]),R={attrs:b,bitrate:b.decimalInteger("AVERAGE-BANDWIDTH")||b.decimalInteger("BANDWIDTH"),name:b.NAME,url:y.resolve(o[2],s)},O=b.decimalResolution("RESOLUTION");O&&(R.width=O.width,R.height=O.height),c((b.CODECS||"").split(/[ ,]+/).filter(function(I){return I}),R),R.videoCodec&&R.videoCodec.indexOf("avc1")!==-1&&(R.videoCodec=y.convertAVC1ToAVCOTI(R.videoCodec)),a.push(R)}else if(o[3]){var C=new _.AttrList(o[3]);C["DATA-ID"]&&(u=!0,r[C["DATA-ID"]]=C)}return{levels:a,sessionData:u?r:null}},y.parseMasterPlaylistMedia=function(f,s,a,r){r===void 0&&(r=[]);var u,o=[],b=0;for(m.lastIndex=0;(u=m.exec(f))!==null;){var R=new _.AttrList(u[1]);if(R.TYPE===a){var O={attrs:R,bitrate:0,id:b++,groupId:R["GROUP-ID"],instreamId:R["INSTREAM-ID"],name:R.NAME||R.LANGUAGE||"",type:a,default:R.bool("DEFAULT"),autoselect:R.bool("AUTOSELECT"),forced:R.bool("FORCED"),lang:R.LANGUAGE,url:R.URI?y.resolve(R.URI,s):""};if(r.length){var C=y.findGroup(r,O.groupId)||r[0];n(O,C,"audioCodec"),n(O,C,"textCodec")}o.push(O)}}return o},y.parseLevelPlaylist=function(f,s,a,r,u){var o=new A.LevelDetails(s),b=o.fragments,R=null,O=0,C=0,I=0,F=0,M=null,P=new k.Fragment(r,s),N,U,B,G=-1,q=!1;for(E.lastIndex=0,o.m3u8=f;(N=E.exec(f))!==null;){q&&(q=!1,P=new k.Fragment(r,s),P.start=I,P.sn=O,P.cc=F,P.level=a,R&&(P.initSegment=R,P.rawProgramDateTime=R.rawProgramDateTime));var K=N[1];if(K){P.duration=parseFloat(K);var W=(" "+N[2]).slice(1);P.title=W||null,P.tagList.push(W?["INF",K,W]:["INF",K])}else if(N[3])Object(w.isFiniteNumber)(P.duration)&&(P.start=I,B&&(P.levelkey=B),P.sn=O,P.level=a,P.cc=F,P.urlId=u,b.push(P),P.relurl=(" "+N[3]).slice(1),v(P,M),M=P,I+=P.duration,O++,C=0,q=!0);else if(N[4]){var V=(" "+N[4]).slice(1);M?P.setByteRange(V,M):P.setByteRange(V)}else if(N[5])P.rawProgramDateTime=(" "+N[5]).slice(1),P.tagList.push(["PROGRAM-DATE-TIME",P.rawProgramDateTime]),G===-1&&(G=b.length);else{if(N=N[0].match(l),!N){d.logger.warn("No matches on slow regex match for level playlist!");continue}for(U=1;U<N.length&&typeof N[U]=="undefined";U++);var J=(" "+N[U]).slice(1),Q=(" "+N[U+1]).slice(1),tt=N[U+2]?(" "+N[U+2]).slice(1):"";switch(J){case"PLAYLIST-TYPE":o.type=Q.toUpperCase();break;case"MEDIA-SEQUENCE":O=o.startSN=parseInt(Q);break;case"SKIP":{var lt=new _.AttrList(Q),et=lt.decimalInteger("SKIPPED-SEGMENTS");if(Object(w.isFiniteNumber)(et)){o.skippedSegments=et;for(var $=et;$--;)b.unshift(null);O+=et}var z=lt.enumeratedString("RECENTLY-REMOVED-DATERANGES");z&&(o.recentlyRemovedDateranges=z.split("	"));break}case"TARGETDURATION":o.targetduration=parseFloat(Q);break;case"VERSION":o.version=parseInt(Q);break;case"EXTM3U":break;case"ENDLIST":o.live=!1;break;case"#":(Q||tt)&&P.tagList.push(tt?[Q,tt]:[Q]);break;case"DIS":F++;case"GAP":P.tagList.push([J]);break;case"BITRATE":P.tagList.push([J,Q]);break;case"DISCONTINUITY-SEQ":F=parseInt(Q);break;case"KEY":{var X,Y=new _.AttrList(Q),it=Y.enumeratedString("METHOD"),st=Y.URI,ot=Y.hexadecimalInteger("IV"),ht=Y.enumeratedString("KEYFORMATVERSIONS"),at=Y.enumeratedString("KEYID"),ut=(X=Y.enumeratedString("KEYFORMAT"))!=null?X:"identity",rt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(rt.indexOf(ut)>-1){d.logger.warn("Keyformat "+ut+" is not supported from the manifest");continue}else if(ut!=="identity")continue;it&&(B=D.LevelKey.fromURL(s,st),st&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(it)>=0&&(B.method=it,B.keyFormat=ut,at&&(B.keyID=at),ht&&(B.keyFormatVersions=ht),B.iv=ot));break}case"START":{var nt=new _.AttrList(Q),pt=nt.decimalFloatingPoint("TIME-OFFSET");Object(w.isFiniteNumber)(pt)&&(o.startTimeOffset=pt);break}case"MAP":{var _t=new _.AttrList(Q);P.relurl=_t.URI,_t.BYTERANGE&&P.setByteRange(_t.BYTERANGE),P.level=a,P.sn="initSegment",B&&(P.levelkey=B),P.initSegment=null,R=P,q=!0;break}case"SERVER-CONTROL":{var gt=new _.AttrList(Q);o.canBlockReload=gt.bool("CAN-BLOCK-RELOAD"),o.canSkipUntil=gt.optionalFloat("CAN-SKIP-UNTIL",0),o.canSkipDateRanges=o.canSkipUntil>0&&gt.bool("CAN-SKIP-DATERANGES"),o.partHoldBack=gt.optionalFloat("PART-HOLD-BACK",0),o.holdBack=gt.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Lt=new _.AttrList(Q);o.partTarget=Lt.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ft=o.partList;ft||(ft=o.partList=[]);var mt=C>0?ft[ft.length-1]:void 0,kt=C++,Et=new k.Part(new _.AttrList(Q),P,s,kt,mt);ft.push(Et),P.duration+=Et.duration;break}case"PRELOAD-HINT":{var Tt=new _.AttrList(Q);o.preloadHint=Tt;break}case"RENDITION-REPORT":{var wt=new _.AttrList(Q);o.renditionReports=o.renditionReports||[],o.renditionReports.push(wt);break}default:d.logger.warn("line parsed but not handled: "+N);break}}}M&&!M.relurl?(b.pop(),I-=M.duration,o.partList&&(o.fragmentHint=M)):o.partList&&(v(P,M),P.cc=F,o.fragmentHint=P);var bt=b.length,yt=b[0],At=b[bt-1];if(I+=o.skippedSegments*o.targetduration,I>0&&bt&&At){o.averagetargetduration=I/bt;var Ot=At.sn;o.endSN=Ot!=="initSegment"?Ot:0,yt&&(o.startCC=yt.cc,yt.initSegment||o.fragments.every(function(Dt){return Dt.relurl&&e(Dt.relurl)})&&(d.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),P=new k.Fragment(r,s),P.relurl=At.relurl,P.level=a,P.sn="initSegment",yt.initSegment=P,o.needSidxRanges=!0))}else o.endSN=0,o.startCC=0;return o.fragmentHint&&(I+=o.fragmentHint.duration),o.totalduration=I,o.endCC=F,G>0&&h(b,G),o},y}();function c(y,f){["video","audio","text"].forEach(function(s){var a=y.filter(function(u){return Object(g.isCodecType)(u,s)});if(a.length){var r=a.filter(function(u){return u.lastIndexOf("avc1",0)===0||u.lastIndexOf("mp4a",0)===0});f[s+"Codec"]=r.length>0?r[0]:a[0],y=y.filter(function(u){return a.indexOf(u)===-1})}}),f.unknownCodecs=y}function n(y,f,s){var a=f[s];a&&(y[s]=a)}function h(y,f){for(var s=y[f],a=f;a--;){var r=y[a];if(!r)return;r.programDateTime=s.programDateTime-r.duration*1e3,s=r}}function v(y,f){y.rawProgramDateTime?y.programDateTime=Date.parse(y.rawProgramDateTime):f!=null&&f.programDateTime&&(y.programDateTime=f.endProgramDateTime),Object(w.isFiniteNumber)(y.programDateTime)||(y.programDateTime=null,y.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/polyfills/number.ts"),S=p("./src/events.ts"),L=p("./src/errors.ts"),k=p("./src/utils/logger.ts"),A=p("./src/utils/mp4-tools.ts"),D=p("./src/loader/m3u8-parser.ts"),_=p("./src/types/loader.ts"),d=p("./src/utils/attr-list.ts");function g(E){var l=E.type;switch(l){case _.PlaylistContextType.AUDIO_TRACK:return _.PlaylistLevelType.AUDIO;case _.PlaylistContextType.SUBTITLE_TRACK:return _.PlaylistLevelType.SUBTITLE;default:return _.PlaylistLevelType.MAIN}}function T(E,l){var t=E.url;return(t===void 0||t.indexOf("data:")===0)&&(t=l.url),t}var m=function(){function E(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var l=E.prototype;return l.registerListeners=function(){var t=this.hls;t.on(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(S.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(S.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(S.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.unregisterListeners=function(){var t=this.hls;t.off(S.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(S.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(S.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(S.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},l.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,c=e.loader,n=i||c,h=new n(e);return t.loader=h,this.loaders[t.type]=h,h},l.getInternalLoader=function(t){return this.loaders[t.type]},l.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},l.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},l.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},l.onManifestLoading=function(t,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:_.PlaylistContextType.MANIFEST,url:i,deliveryDirectives:null})},l.onLevelLoading=function(t,e){var i=e.id,c=e.level,n=e.url,h=e.deliveryDirectives;this.load({id:i,groupId:null,level:c,responseType:"text",type:_.PlaylistContextType.LEVEL,url:n,deliveryDirectives:h})},l.onAudioTrackLoading=function(t,e){var i=e.id,c=e.groupId,n=e.url,h=e.deliveryDirectives;this.load({id:i,groupId:c,level:null,responseType:"text",type:_.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:h})},l.onSubtitleTrackLoading=function(t,e){var i=e.id,c=e.groupId,n=e.url,h=e.deliveryDirectives;this.load({id:i,groupId:c,level:null,responseType:"text",type:_.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:h})},l.load=function(t){var e,i=this.hls.config,c=this.getInternalLoader(t);if(c){var n=c.context;if(n&&n.url===t.url){k.logger.trace("[playlist-loader]: playlist request ongoing");return}k.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),c.abort()}var h,v,y,f;switch(t.type){case _.PlaylistContextType.MANIFEST:h=i.manifestLoadingMaxRetry,v=i.manifestLoadingTimeOut,y=i.manifestLoadingRetryDelay,f=i.manifestLoadingMaxRetryTimeout;break;case _.PlaylistContextType.LEVEL:case _.PlaylistContextType.AUDIO_TRACK:case _.PlaylistContextType.SUBTITLE_TRACK:h=0,v=i.levelLoadingTimeOut;break;default:h=i.levelLoadingMaxRetry,v=i.levelLoadingTimeOut,y=i.levelLoadingRetryDelay,f=i.levelLoadingMaxRetryTimeout;break}if(c=this.createInternalLoader(t),(e=t.deliveryDirectives)!==null&&e!==void 0&&e.part){var s;if(t.type===_.PlaylistContextType.LEVEL&&t.level!==null?s=this.hls.levels[t.level].details:t.type===_.PlaylistContextType.AUDIO_TRACK&&t.id!==null?s=this.hls.audioTracks[t.id].details:t.type===_.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(s=this.hls.subtitleTracks[t.id].details),s){var a=s.partTarget,r=s.targetduration;a&&r&&(v=Math.min(Math.max(a*3,r*.8)*1e3,v))}}var u={timeout:v,maxRetry:h,retryDelay:y,maxRetryDelay:f,highWaterMark:0},o={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(t,u,o)},l.loadsuccess=function(t,e,i,c){if(c===void 0&&(c=null),i.isSidxRequest){this.handleSidxRequest(t,i),this.handlePlaylistLoaded(t,e,i,c);return}this.resetInternalLoader(i.type);var n=t.data;if(n.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,i,"no EXTM3U delimiter",c);return}e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,i,c):this.handleMasterPlaylist(t,e,i,c)},l.loaderror=function(t,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!1,t)},l.loadtimeout=function(t,e,i){i===void 0&&(i=null),this.handleNetworkError(e,i,!0)},l.handleMasterPlaylist=function(t,e,i,c){var n=this.hls,h=t.data,v=T(t,i),y=D.default.parseMasterPlaylist(h,v),f=y.levels,s=y.sessionData;if(!f.length){this.handleManifestParsingError(t,i,"no level found in manifest",c);return}var a=f.map(function(O){return{id:O.attrs.AUDIO,audioCodec:O.audioCodec}}),r=f.map(function(O){return{id:O.attrs.SUBTITLES,textCodec:O.textCodec}}),u=D.default.parseMasterPlaylistMedia(h,v,"AUDIO",a),o=D.default.parseMasterPlaylistMedia(h,v,"SUBTITLES",r),b=D.default.parseMasterPlaylistMedia(h,v,"CLOSED-CAPTIONS");if(u.length){var R=u.some(function(O){return!O.url});!R&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(k.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),u.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new d.AttrList({}),bitrate:0,url:""}))}n.trigger(S.Events.MANIFEST_LOADED,{levels:f,audioTracks:u,subtitles:o,captions:b,url:v,stats:e,networkDetails:c,sessionData:s})},l.handleTrackOrLevelPlaylist=function(t,e,i,c){var n=this.hls,h=i.id,v=i.level,y=i.type,f=T(t,i),s=Object(w.isFiniteNumber)(h)?h:0,a=Object(w.isFiniteNumber)(v)?v:s,r=g(i),u=D.default.parseLevelPlaylist(t.data,f,a,r,s);if(!u.fragments.length){n.trigger(S.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:f,reason:"no fragments found in level",level:typeof i.level=="number"?i.level:void 0});return}if(y===_.PlaylistContextType.MANIFEST){var o={attrs:new d.AttrList({}),bitrate:0,details:u,name:"",url:f};n.trigger(S.Events.MANIFEST_LOADED,{levels:[o],audioTracks:[],url:f,stats:e,networkDetails:c,sessionData:null})}if(e.parsing.end=performance.now(),u.needSidxRanges){var b,R=(b=u.fragments[0].initSegment)===null||b===void 0?void 0:b.url;this.load({url:R,isSidxRequest:!0,type:y,level:v,levelDetails:u,id:h,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}i.levelDetails=u,this.handlePlaylistLoaded(t,e,i,c)},l.handleSidxRequest=function(t,e){var i=Object(A.parseSegmentIndex)(new Uint8Array(t.data));if(i){var c=i.references,n=e.levelDetails;c.forEach(function(h,v){var y=h.info,f=n.fragments[v];f.byteRange.length===0&&f.setByteRange(String(1+y.end-y.start)+"@"+String(y.start)),f.initSegment&&f.initSegment.setByteRange(String(i.moovEndOffset)+"@0")})}},l.handleManifestParsingError=function(t,e,i,c){this.hls.trigger(S.Events.ERROR,{type:L.ErrorTypes.NETWORK_ERROR,details:L.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===_.PlaylistContextType.MANIFEST,url:t.url,reason:i,response:t,context:e,networkDetails:c})},l.handleNetworkError=function(t,e,i,c){i===void 0&&(i=!1),k.logger.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var n=L.ErrorDetails.UNKNOWN,h=!1,v=this.getInternalLoader(t);switch(t.type){case _.PlaylistContextType.MANIFEST:n=i?L.ErrorDetails.MANIFEST_LOAD_TIMEOUT:L.ErrorDetails.MANIFEST_LOAD_ERROR,h=!0;break;case _.PlaylistContextType.LEVEL:n=i?L.ErrorDetails.LEVEL_LOAD_TIMEOUT:L.ErrorDetails.LEVEL_LOAD_ERROR,h=!1;break;case _.PlaylistContextType.AUDIO_TRACK:n=i?L.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:L.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,h=!1;break;case _.PlaylistContextType.SUBTITLE_TRACK:n=i?L.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:L.ErrorDetails.SUBTITLE_LOAD_ERROR,h=!1;break}v&&this.resetInternalLoader(t.type);var y={type:L.ErrorTypes.NETWORK_ERROR,details:n,fatal:h,url:t.url,loader:v,context:t,networkDetails:e};c&&(y.response=c),this.hls.trigger(S.Events.ERROR,y)},l.handlePlaylistLoaded=function(t,e,i,c){var n=i.type,h=i.level,v=i.id,y=i.groupId,f=i.loader,s=i.levelDetails,a=i.deliveryDirectives;if(!(s!=null&&s.targetduration)){this.handleManifestParsingError(t,i,"invalid target duration",c);return}if(f)switch(s.live&&(f.getCacheAge&&(s.ageHeader=f.getCacheAge()||0),(!f.getCacheAge||isNaN(s.ageHeader))&&(s.ageHeader=0)),n){case _.PlaylistContextType.MANIFEST:case _.PlaylistContextType.LEVEL:this.hls.trigger(S.Events.LEVEL_LOADED,{details:s,level:h||0,id:v||0,stats:e,networkDetails:c,deliveryDirectives:a});break;case _.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(S.Events.AUDIO_TRACK_LOADED,{details:s,id:v||0,groupId:y||"",stats:e,networkDetails:c,deliveryDirectives:a});break;case _.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(S.Events.SUBTITLE_TRACK_LOADED,{details:s,id:v||0,groupId:y||"",stats:e,networkDetails:c,deliveryDirectives:a});break}},E}();x.default=m},"./src/polyfills/number.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"isFiniteNumber",function(){return w}),p.d(x,"MAX_SAFE_INTEGER",function(){return S});var w=Number.isFinite||function(L){return typeof L=="number"&&isFinite(L)},S=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(j,x,p){"use strict";p.r(x);var w=function(){function S(){}return S.getSilentFrame=function(L,k){switch(L){case"mp4a.40.2":if(k===1)return new Uint8Array([0,200,0,128,35,128]);if(k===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(k===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(k===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(k===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(k===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(k===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(k===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},S}();x.default=w},"./src/remux/mp4-generator.ts":function(j,x,p){"use strict";p.r(x);var w=Math.pow(2,32)-1,S=function(){function L(){}return L.init=function(){L.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var k;for(k in L.types)L.types.hasOwnProperty(k)&&(L.types[k]=[k.charCodeAt(0),k.charCodeAt(1),k.charCodeAt(2),k.charCodeAt(3)]);var A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),D=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);L.HDLR_TYPES={video:A,audio:D};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),d=new Uint8Array([0,0,0,0,0,0,0,0]);L.STTS=L.STSC=L.STCO=d,L.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),L.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),L.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),L.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),m=new Uint8Array([0,0,0,1]);L.FTYP=L.box(L.types.ftyp,g,m,g,T),L.DINF=L.box(L.types.dinf,L.box(L.types.dref,_))},L.box=function(k){for(var A=8,D=arguments.length,_=new Array(D>1?D-1:0),d=1;d<D;d++)_[d-1]=arguments[d];for(var g=_.length,T=g;g--;)A+=_[g].byteLength;var m=new Uint8Array(A);for(m[0]=A>>24&255,m[1]=A>>16&255,m[2]=A>>8&255,m[3]=A&255,m.set(k,4),g=0,A=8;g<T;g++)m.set(_[g],A),A+=_[g].byteLength;return m},L.hdlr=function(k){return L.box(L.types.hdlr,L.HDLR_TYPES[k])},L.mdat=function(k){return L.box(L.types.mdat,k)},L.mdhd=function(k,A){A*=k;var D=Math.floor(A/(w+1)),_=Math.floor(A%(w+1));return L.box(L.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,D>>24,D>>16&255,D>>8&255,D&255,_>>24,_>>16&255,_>>8&255,_&255,85,196,0,0]))},L.mdia=function(k){return L.box(L.types.mdia,L.mdhd(k.timescale,k.duration),L.hdlr(k.type),L.minf(k))},L.mfhd=function(k){return L.box(L.types.mfhd,new Uint8Array([0,0,0,0,k>>24,k>>16&255,k>>8&255,k&255]))},L.minf=function(k){return k.type==="audio"?L.box(L.types.minf,L.box(L.types.smhd,L.SMHD),L.DINF,L.stbl(k)):L.box(L.types.minf,L.box(L.types.vmhd,L.VMHD),L.DINF,L.stbl(k))},L.moof=function(k,A,D){return L.box(L.types.moof,L.mfhd(k),L.traf(D,A))},L.moov=function(k){for(var A=k.length,D=[];A--;)D[A]=L.trak(k[A]);return L.box.apply(null,[L.types.moov,L.mvhd(k[0].timescale,k[0].duration)].concat(D).concat(L.mvex(k)))},L.mvex=function(k){for(var A=k.length,D=[];A--;)D[A]=L.trex(k[A]);return L.box.apply(null,[L.types.mvex].concat(D))},L.mvhd=function(k,A){A*=k;var D=Math.floor(A/(w+1)),_=Math.floor(A%(w+1)),d=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,k>>24&255,k>>16&255,k>>8&255,k&255,D>>24,D>>16&255,D>>8&255,D&255,_>>24,_>>16&255,_>>8&255,_&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return L.box(L.types.mvhd,d)},L.sdtp=function(k){var A=k.samples||[],D=new Uint8Array(4+A.length),_,d;for(_=0;_<A.length;_++)d=A[_].flags,D[_+4]=d.dependsOn<<4|d.isDependedOn<<2|d.hasRedundancy;return L.box(L.types.sdtp,D)},L.stbl=function(k){return L.box(L.types.stbl,L.stsd(k),L.box(L.types.stts,L.STTS),L.box(L.types.stsc,L.STSC),L.box(L.types.stsz,L.STSZ),L.box(L.types.stco,L.STCO))},L.avc1=function(k){var A=[],D=[],_,d,g;for(_=0;_<k.sps.length;_++)d=k.sps[_],g=d.byteLength,A.push(g>>>8&255),A.push(g&255),A=A.concat(Array.prototype.slice.call(d));for(_=0;_<k.pps.length;_++)d=k.pps[_],g=d.byteLength,D.push(g>>>8&255),D.push(g&255),D=D.concat(Array.prototype.slice.call(d));var T=L.box(L.types.avcC,new Uint8Array([1,A[3],A[4],A[5],252|3,224|k.sps.length].concat(A).concat([k.pps.length]).concat(D))),m=k.width,E=k.height,l=k.pixelRatio[0],t=k.pixelRatio[1];return L.box(L.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,m>>8&255,m&255,E>>8&255,E&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,L.box(L.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),L.box(L.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,l&255,t>>24,t>>16&255,t>>8&255,t&255])))},L.esds=function(k){var A=k.config.length;return new Uint8Array([0,0,0,0,3,23+A,0,1,0,4,15+A,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([A]).concat(k.config).concat([6,1,2]))},L.mp4a=function(k){var A=k.samplerate;return L.box(L.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]),L.box(L.types.esds,L.esds(k)))},L.mp3=function(k){var A=k.samplerate;return L.box(L.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,k.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]))},L.stsd=function(k){return k.type==="audio"?!k.isAAC&&k.codec==="mp3"?L.box(L.types.stsd,L.STSD,L.mp3(k)):L.box(L.types.stsd,L.STSD,L.mp4a(k)):L.box(L.types.stsd,L.STSD,L.avc1(k))},L.tkhd=function(k){var A=k.id,D=k.duration*k.timescale,_=k.width,d=k.height,g=Math.floor(D/(w+1)),T=Math.floor(D%(w+1));return L.box(L.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,T>>24,T>>16&255,T>>8&255,T&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_>>8&255,_&255,0,0,d>>8&255,d&255,0,0]))},L.traf=function(k,A){var D=L.sdtp(k),_=k.id,d=Math.floor(A/(w+1)),g=Math.floor(A%(w+1));return L.box(L.types.traf,L.box(L.types.tfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255])),L.box(L.types.tfdt,new Uint8Array([1,0,0,0,d>>24,d>>16&255,d>>8&255,d&255,g>>24,g>>16&255,g>>8&255,g&255])),L.trun(k,D.length+16+20+8+16+8+8),D)},L.trak=function(k){return k.duration=k.duration||4294967295,L.box(L.types.trak,L.tkhd(k),L.mdia(k))},L.trex=function(k){var A=k.id;return L.box(L.types.trex,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},L.trun=function(k,A){var D=k.samples||[],_=D.length,d=12+16*_,g=new Uint8Array(d),T,m,E,l,t,e;for(A+=8+d,g.set([0,0,15,1,_>>>24&255,_>>>16&255,_>>>8&255,_&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255],0),T=0;T<_;T++)m=D[T],E=m.duration,l=m.size,t=m.flags,e=m.cts,g.set([E>>>24&255,E>>>16&255,E>>>8&255,E&255,l>>>24&255,l>>>16&255,l>>>8&255,l&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,e>>>24&255,e>>>16&255,e>>>8&255,e&255],12+16*T);return L.box(L.types.trun,g)},L.initSegment=function(k){L.types||L.init();var A=L.moov(k),D=new Uint8Array(L.FTYP.byteLength+A.byteLength);return D.set(L.FTYP),D.set(A,L.FTYP.byteLength),D},L}();S.types=void 0,S.HDLR_TYPES=void 0,S.STTS=void 0,S.STSC=void 0,S.STCO=void 0,S.STSZ=void 0,S.VMHD=void 0,S.SMHD=void 0,S.STSD=void 0,S.FTYP=void 0,S.DINF=void 0,x.default=S},"./src/remux/mp4-remuxer.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return i}),p.d(x,"normalizePts",function(){return c});var w=p("./src/polyfills/number.ts"),S=p("./src/remux/aac-helper.ts"),L=p("./src/remux/mp4-generator.ts"),k=p("./src/events.ts"),A=p("./src/errors.ts"),D=p("./src/utils/logger.ts"),_=p("./src/types/loader.ts"),d=p("./src/utils/timescale-conversion.ts");function g(){return g=Object.assign||function(y){for(var f=1;f<arguments.length;f++){var s=arguments[f];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(y[a]=s[a])}return y},g.apply(this,arguments)}var T=10*1e3,m=1024,E=1152,l=null,t=null,e=!1,i=function(){function y(s,a,r,u){if(u===void 0&&(u=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=s,this.config=a,this.typeSupported=r,this.ISGenerated=!1,l===null){var o=navigator.userAgent||"",b=o.match(/Chrome\/(\d+)/i);l=b?parseInt(b[1]):0}if(t===null){var R=navigator.userAgent.match(/Safari\/(\d+)/i);t=R?parseInt(R[1]):0}e=!!l&&l<75||!!t&&t<600}var f=y.prototype;return f.destroy=function(){},f.resetTimeStamp=function(s){D.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=s},f.resetNextTimestamp=function(){D.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){D.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(s){var a=!1,r=s.reduce(function(u,o){var b=o.pts-u;return b<-4294967296?(a=!0,c(u,o.pts)):b>0?u:o.pts},s[0].pts);return a&&D.logger.debug("PTS rollover detected"),r},f.remux=function(s,a,r,u,o,b,R,O){var C,I,F,M,P,N,U=o,B=o,G=s.pid>-1,q=a.pid>-1,K=a.samples.length,W=s.samples.length>0,V=K>1,J=(!G||W)&&(!q||V)||this.ISGenerated||R;if(J){this.ISGenerated||(F=this.generateIS(s,a,o));var Q=this.isVideoContiguous,tt=-1;if(V&&(tt=n(a.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(N=!0,tt>0){D.logger.warn("[mp4-remuxer]: Dropped "+tt+" out of "+K+" video samples due to a missing keyframe");var lt=this.getVideoStartPts(a.samples);a.samples=a.samples.slice(tt),a.dropped+=tt,B+=(a.samples[0].pts-lt)/(a.timescale||9e4)}else tt===-1&&(D.logger.warn("[mp4-remuxer]: No keyframe found out of "+K+" video samples"),N=!1);if(this.ISGenerated){if(W&&V){var et=this.getVideoStartPts(a.samples),$=c(s.samples[0].pts,et)-et,z=$/a.inputTimeScale;U+=Math.max(0,z),B+=Math.max(0,-z)}if(W){if(s.samplerate||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),F=this.generateIS(s,a,o)),I=this.remuxAudio(s,U,this.isAudioContiguous,b,q||V||O===_.PlaylistLevelType.AUDIO?B:void 0),V){var X=I?I.endPTS-I.startPTS:0;a.inputTimeScale||(D.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),F=this.generateIS(s,a,o)),C=this.remuxVideo(a,B,Q,X)}}else V&&(C=this.remuxVideo(a,B,Q,0));C&&(C.firstKeyFrame=tt,C.independent=tt!==-1)}}return this.ISGenerated&&(r.samples.length&&(P=this.remuxID3(r,o)),u.samples.length&&(M=this.remuxText(u,o))),{audio:I,video:C,initSegment:F,independent:N,text:M,id3:P}},f.generateIS=function(s,a,r){var u=s.samples,o=a.samples,b=this.typeSupported,R={},O=!Object(w.isFiniteNumber)(this._initPTS),C="audio/mp4",I,F,M;if(O&&(I=F=1/0),s.config&&u.length&&(s.timescale=s.samplerate,s.isAAC||(b.mpeg?(C="audio/mpeg",s.codec=""):b.mp3&&(s.codec="mp3")),R.audio={id:"audio",container:C,codec:s.codec,initSegment:!s.isAAC&&b.mpeg?new Uint8Array(0):L.default.initSegment([s]),metadata:{channelCount:s.channelCount}},O&&(M=s.inputTimeScale,I=F=u[0].pts-Math.round(M*r))),a.sps&&a.pps&&o.length&&(a.timescale=a.inputTimeScale,R.video={id:"main",container:"video/mp4",codec:a.codec,initSegment:L.default.initSegment([a]),metadata:{width:a.width,height:a.height}},O)){M=a.inputTimeScale;var P=this.getVideoStartPts(o),N=Math.round(M*r);F=Math.min(F,c(o[0].dts,P)-N),I=Math.min(I,P-N)}if(Object.keys(R).length)return this.ISGenerated=!0,O&&(this._initPTS=I,this._initDTS=F),{tracks:R,initPTS:I,timescale:M}},f.remuxVideo=function(s,a,r,u){var o=s.inputTimeScale,b=s.samples,R=[],O=b.length,C=this._initPTS,I=this.nextAvcDts,F=8,M,P,N,U=Number.POSITIVE_INFINITY,B=Number.NEGATIVE_INFINITY,G=0,q=!1;if(!r||I===null){var K=a*o,W=b[0].pts-c(b[0].dts,b[0].pts);I=K-W}for(var V=0;V<O;V++){var J=b[V];if(J.pts=c(J.pts-C,I),J.dts=c(J.dts-C,I),J.dts>J.pts){var Q=9e4*.2;G=Math.max(Math.min(G,J.pts-J.dts),-1*Q)}J.dts<b[V>0?V-1:V].dts&&(q=!0)}q&&b.sort(function(Ht,qt){var he=Ht.dts-qt.dts,fe=Ht.pts-qt.pts;return he||fe}),P=b[0].dts,N=b[b.length-1].dts;var tt=Math.round((N-P)/(O-1));if(G<0){if(G<tt*-2){D.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(d.toMsFromMpegTsClock)(-tt,!0)+" ms");for(var lt=G,et=0;et<O;et++)b[et].dts=lt=Math.max(lt,b[et].pts-tt),b[et].pts=Math.max(lt,b[et].pts)}else{D.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(d.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var $=0;$<O;$++)b[$].dts=b[$].dts+G}P=b[0].dts}if(r){var z=P-I,X=z>tt,Y=z<-1;if(X||Y){X?D.logger.warn("AVC: "+Object(d.toMsFromMpegTsClock)(z,!0)+" ms ("+z+"dts) hole between fragments detected, filling it"):D.logger.warn("AVC: "+Object(d.toMsFromMpegTsClock)(-z,!0)+" ms ("+z+"dts) overlapping between fragments detected"),P=I;var it=b[0].pts-z;b[0].dts=P,b[0].pts=it,D.logger.log("Video: First PTS/DTS adjusted: "+Object(d.toMsFromMpegTsClock)(it,!0)+"/"+Object(d.toMsFromMpegTsClock)(P,!0)+", delta: "+Object(d.toMsFromMpegTsClock)(z,!0)+" ms")}}e&&(P=Math.max(0,P));for(var st=0,ot=0,ht=0;ht<O;ht++){for(var at=b[ht],ut=at.units,rt=ut.length,nt=0,pt=0;pt<rt;pt++)nt+=ut[pt].data.length;ot+=nt,st+=rt,at.length=nt,at.dts=Math.max(at.dts,P),at.pts=Math.max(at.pts,at.dts,0),U=Math.min(at.pts,U),B=Math.max(at.pts,B)}N=b[O-1].dts;var _t=ot+4*st+8,gt;try{gt=new Uint8Array(_t)}catch{this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:A.ErrorTypes.MUX_ERROR,details:A.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:_t,reason:"fail allocating video mdat "+_t});return}var Lt=new DataView(gt.buffer);Lt.setUint32(0,_t),gt.set(L.default.types.mdat,4);for(var ft=0;ft<O;ft++){for(var mt=b[ft],kt=mt.units,Et=0,Tt=0,wt=kt.length;Tt<wt;Tt++){var bt=kt[Tt],yt=bt.data,At=bt.data.byteLength;Lt.setUint32(F,At),F+=4,gt.set(yt,F),F+=At,Et+=4+At}if(ft<O-1)M=b[ft+1].dts-mt.dts;else{var Ot=this.config,Dt=mt.dts-b[ft>0?ft-1:ft].dts;if(Ot.stretchShortVideoTrack&&this.nextAudioPts!==null){var oe=Math.floor(Ot.maxBufferHole*o),Ft=(u?U+u*o:this.nextAudioPts)-mt.pts;Ft>oe?(M=Ft-Dt,M<0&&(M=Dt),D.logger.log("[mp4-remuxer]: It is approximately "+Ft/90+" ms to the next segment; using duration "+M/90+" ms for the last video frame.")):M=Dt}else M=Dt}var le=Math.round(mt.pts-mt.dts);R.push(new h(mt.key,M,Et,le))}if(R.length&&l&&l<70){var Gt=R[0].flags;Gt.dependsOn=2,Gt.isNonSync=0}console.assert(M!==void 0,"mp4SampleDuration must be computed"),this.nextAvcDts=I=N+M,this.isVideoContiguous=!0;var ue=L.default.moof(s.sequenceNumber++,P,g({},s,{samples:R})),de="video",ce={data1:ue,data2:gt,startPTS:U/o,endPTS:(B+M)/o,startDTS:P/o,endDTS:I/o,type:de,hasAudio:!1,hasVideo:!0,nb:R.length,dropped:s.dropped};return s.samples=[],s.dropped=0,console.assert(gt.length,"MDAT length must not be zero"),ce},f.remuxAudio=function(s,a,r,u,o){var b=s.inputTimeScale,R=s.samplerate?s.samplerate:b,O=b/R,C=s.isAAC?m:E,I=C*O,F=this._initPTS,M=!s.isAAC&&this.typeSupported.mpeg,P=[],N=s.samples,U=M?0:8,B=this.nextAudioPts||-1,G=a*b;if(this.isAudioContiguous=r=r||N.length&&B>0&&(u&&Math.abs(G-B)<9e3||Math.abs(c(N[0].pts-F,G)-B)<20*I),N.forEach(function(yt){yt.pts=c(yt.pts-F,G)}),!r||B<0){if(N=N.filter(function(yt){return yt.pts>=0}),!N.length)return;o===0?B=0:u?B=Math.max(0,G):B=N[0].pts}if(s.isAAC)for(var q=o!==void 0,K=this.config.maxAudioFramesDrift,W=0,V=B;W<N.length;W++){var J=N[W],Q=J.pts,tt=Q-V,lt=Math.abs(1e3*tt/b);if(tt<=-K*I&&q)W===0&&(D.logger.warn("Audio frame @ "+(Q/b).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*tt/b)+" ms."),this.nextAudioPts=B=V=Q);else if(tt>=K*I&&lt<T&&q){var et=Math.round(tt/I);V=Q-et*I,V<0&&(et--,V+=I),W===0&&(this.nextAudioPts=B=V),D.logger.warn("[mp4-remuxer]: Injecting "+et+" audio frame @ "+(V/b).toFixed(3)+"s due to "+Math.round(1e3*tt/b)+" ms gap.");for(var $=0;$<et;$++){var z=Math.max(V,0),X=S.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);X||(D.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),X=J.unit.subarray()),N.splice(W,0,{unit:X,pts:z}),V+=I,W++}}J.pts=V,V+=I}for(var Y=null,it=null,st,ot=0,ht=N.length;ht--;)ot+=N[ht].unit.byteLength;for(var at=0,ut=N.length;at<ut;at++){var rt=N[at],nt=rt.unit,pt=rt.pts;if(it!==null){var _t=P[at-1];_t.duration=Math.round((pt-it)/O)}else if(r&&s.isAAC&&(pt=B),Y=pt,ot>0){ot+=U;try{st=new Uint8Array(ot)}catch{this.observer.emit(k.Events.ERROR,k.Events.ERROR,{type:A.ErrorTypes.MUX_ERROR,details:A.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ot,reason:"fail allocating audio mdat "+ot});return}if(!M){var gt=new DataView(st.buffer);gt.setUint32(0,ot),st.set(L.default.types.mdat,4)}}else return;st.set(nt,U);var Lt=nt.byteLength;U+=Lt,P.push(new h(!0,C,Lt,0)),it=pt}var ft=P.length;if(ft){var mt=P[P.length-1];this.nextAudioPts=B=it+O*mt.duration;var kt=M?new Uint8Array(0):L.default.moof(s.sequenceNumber++,Y/O,g({},s,{samples:P}));s.samples=[];var Et=Y/b,Tt=B/b,wt="audio",bt={data1:kt,data2:st,startPTS:Et,endPTS:Tt,startDTS:Et,endDTS:Tt,type:wt,hasAudio:!0,hasVideo:!1,nb:ft};return this.isAudioContiguous=!0,console.assert(st.length,"MDAT length must not be zero"),bt}},f.remuxEmptyAudio=function(s,a,r,u){var o=s.inputTimeScale,b=s.samplerate?s.samplerate:o,R=o/b,O=this.nextAudioPts,C=(O!==null?O:u.startDTS*o)+this._initDTS,I=u.endDTS*o+this._initDTS,F=R*m,M=Math.ceil((I-C)/F),P=S.default.getSilentFrame(s.manifestCodec||s.codec,s.channelCount);if(D.logger.warn("[mp4-remuxer]: remux empty Audio"),!P){D.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var N=[],U=0;U<M;U++){var B=C+U*F;N.push({unit:P,pts:B,dts:B})}return s.samples=N,this.remuxAudio(s,a,r,!1)},f.remuxID3=function(s,a){var r=s.samples.length;if(r){for(var u=s.inputTimeScale,o=this._initPTS,b=this._initDTS,R=0;R<r;R++){var O=s.samples[R];O.pts=c(O.pts-o,a*u)/u,O.dts=c(O.dts-b,a*u)/u}var C=s.samples;return s.samples=[],{samples:C}}},f.remuxText=function(s,a){var r=s.samples.length;if(r){for(var u=s.inputTimeScale,o=this._initPTS,b=0;b<r;b++){var R=s.samples[b];R.pts=c(R.pts-o,a*u)/u}s.samples.sort(function(C,I){return C.pts-I.pts});var O=s.samples;return s.samples=[],{samples:O}}},y}();function c(y,f){var s;if(f===null)return y;for(f<y?s=-8589934592:s=8589934592;Math.abs(y-f)>4294967296;)y+=s;return y}function n(y){for(var f=0;f<y.length;f++)if(y[f].key)return f;return-1}var h=function(y,f,s,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=f,this.size=s,this.cts=a,this.flags=new v(y)},v=function(y){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=y?2:1,this.isNonSync=y?0:1}},"./src/remux/passthrough-remuxer.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/polyfills/number.ts"),S=p("./src/utils/mp4-tools.ts"),L=p("./src/loader/fragment.ts"),k=p("./src/utils/logger.ts"),A=function(){function d(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var g=d.prototype;return g.destroy=function(){},g.resetTimeStamp=function(T){this.initPTS=T,this.lastEndDTS=null},g.resetNextTimestamp=function(){this.lastEndDTS=null},g.resetInitSegment=function(T,m,E){this.audioCodec=m,this.videoCodec=E,this.generateInitSegment(T),this.emitInitSegment=!0},g.generateInitSegment=function(T){var m=this.audioCodec,E=this.videoCodec;if(!T||!T.byteLength){this.initTracks=void 0,this.initData=void 0;return}var l=this.initData=Object(S.parseInitSegment)(T);m||(m=_(l.audio,L.ElementaryStreamTypes.AUDIO)),E||(E=_(l.video,L.ElementaryStreamTypes.VIDEO));var t={};l.audio&&l.video?t.audiovideo={container:"video/mp4",codec:m+","+E,initSegment:T,id:"main"}:l.audio?t.audio={container:"audio/mp4",codec:m,initSegment:T,id:"audio"}:l.video?t.video={container:"video/mp4",codec:E,initSegment:T,id:"main"}:k.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=t},g.remux=function(T,m,E,l,t){var e=this.initPTS,i=this.lastEndDTS,c={audio:void 0,video:void 0,text:l,id3:E,initSegment:void 0};Object(w.isFiniteNumber)(i)||(i=this.lastEndDTS=t||0);var n=m.samples;if(!n||!n.length)return c;var h={initPTS:void 0,timescale:1},v=this.initData;if((!v||!v.length)&&(this.generateInitSegment(n),v=this.initData),!v||!v.length)return k.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1),Object(w.isFiniteNumber)(e)||(this.initPTS=h.initPTS=e=D(v,n,i));var y=Object(S.getDuration)(n,v),f=i,s=y+f;Object(S.offsetStartDTS)(v,n,e),y>0?this.lastEndDTS=s:(k.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var a=!!v.audio,r=!!v.video,u="";a&&(u+="audio"),r&&(u+="video");var o={data1:n,startPTS:f,startDTS:f,endPTS:s,endDTS:s,type:u,hasAudio:a,hasVideo:r,nb:1,dropped:0};return c.audio=o.type==="audio"?o:void 0,c.video=o.type!=="audio"?o:void 0,c.text=l,c.id3=E,c.initSegment=h,c},d}(),D=function(d,g,T){return Object(S.getStartDTS)(d,g)-T};function _(d,g){var T=d==null?void 0:d.codec;return T&&T.length>4?T:T==="hvc1"?"hvc1.1.c.L120.90":T==="av01"?"av01.0.04M.08":T==="avc1"||g===L.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}x.default=A},"./src/task-loop.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return w});var w=function(){function S(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var L=S.prototype;return L.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},L.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},L.onHandlerDestroyed=function(){},L.hasInterval=function(){return!!this._tickInterval},L.hasNextTick=function(){return!!this._tickTimer},L.setInterval=function(k){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,k),!0)},L.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},L.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},L.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},L.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},L.doTick=function(){},S}()},"./src/types/level.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"HlsSkip",function(){return L}),p.d(x,"getSkipValue",function(){return k}),p.d(x,"HlsUrlParameters",function(){return A}),p.d(x,"Level",function(){return D});function w(_,d){for(var g=0;g<d.length;g++){var T=d[g];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(_,T.key,T)}}function S(_,d,g){return d&&w(_.prototype,d),g&&w(_,g),_}var L;(function(_){_.No="",_.Yes="YES",_.v2="v2"})(L||(L={}));function k(_,d){var g=_.canSkipUntil,T=_.canSkipDateRanges,m=_.endSN,E=d!==void 0?d-m:0;return g&&E<g?T?L.v2:L.Yes:L.No}var A=function(){function _(g,T,m){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=g,this.part=T,this.skip=m}var d=_.prototype;return d.addDirectives=function(g){var T=new self.URL(g);return this.msn!==void 0&&T.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},_}(),D=function(){function _(d){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[d.url],this.attrs=d.attrs,this.bitrate=d.bitrate,d.details&&(this.details=d.details),this.id=d.id||0,this.name=d.name,this.width=d.width||0,this.height=d.height||0,this.audioCodec=d.audioCodec,this.videoCodec=d.videoCodec,this.unknownCodecs=d.unknownCodecs,this.codecSet=[d.videoCodec,d.audioCodec].filter(function(g){return g}).join(",").replace(/\.[^.,]+/g,"")}return S(_,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(d){var g=d%this.url.length;this._urlId!==g&&(this.details=void 0,this._urlId=g)}}]),_}()},"./src/types/loader.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"PlaylistContextType",function(){return w}),p.d(x,"PlaylistLevelType",function(){return S});var w;(function(L){L.MANIFEST="manifest",L.LEVEL="level",L.AUDIO_TRACK="audioTrack",L.SUBTITLE_TRACK="subtitleTrack"})(w||(w={}));var S;(function(L){L.MAIN="main",L.AUDIO="audio",L.SUBTITLE="subtitle"})(S||(S={}))},"./src/types/transmuxer.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"ChunkMetadata",function(){return w});var w=function(L,k,A,D,_,d){D===void 0&&(D=0),_===void 0&&(_=-1),d===void 0&&(d=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=S(),this.buffering={audio:S(),video:S(),audiovideo:S()},this.level=L,this.sn=k,this.id=A,this.size=D,this.part=_,this.partial=d};function S(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"AttrList",function(){return L});var w=/^(\d+)x(\d+)$/,S=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,L=function(){function k(D){typeof D=="string"&&(D=k.parseAttrList(D));for(var _ in D)D.hasOwnProperty(_)&&(this[_]=D[_])}var A=k.prototype;return A.decimalInteger=function(D){var _=parseInt(this[D],10);return _>Number.MAX_SAFE_INTEGER?1/0:_},A.hexadecimalInteger=function(D){if(this[D]){var _=(this[D]||"0x").slice(2);_=(_.length&1?"0":"")+_;for(var d=new Uint8Array(_.length/2),g=0;g<_.length/2;g++)d[g]=parseInt(_.slice(g*2,g*2+2),16);return d}else return null},A.hexadecimalIntegerAsNumber=function(D){var _=parseInt(this[D],16);return _>Number.MAX_SAFE_INTEGER?1/0:_},A.decimalFloatingPoint=function(D){return parseFloat(this[D])},A.optionalFloat=function(D,_){var d=this[D];return d?parseFloat(d):_},A.enumeratedString=function(D){return this[D]},A.bool=function(D){return this[D]==="YES"},A.decimalResolution=function(D){var _=w.exec(this[D]);if(_!==null)return{width:parseInt(_[1],10),height:parseInt(_[2],10)}},k.parseAttrList=function(D){var _,d={},g='"';for(S.lastIndex=0;(_=S.exec(D))!==null;){var T=_[2];T.indexOf(g)===0&&T.lastIndexOf(g)===T.length-1&&(T=T.slice(1,-1)),d[_[1]]=T}return d},k}()},"./src/utils/binary-search.ts":function(j,x,p){"use strict";p.r(x);var w={search:function(S,L){for(var k=0,A=S.length-1,D=null,_=null;k<=A;){D=(k+A)/2|0,_=S[D];var d=L(_);if(d>0)k=D+1;else if(d<0)A=D-1;else return _}return null}};x.default=w},"./src/utils/buffer-helper.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"BufferHelper",function(){return L});var w=p("./src/utils/logger.ts"),S={length:0,start:function(){return 0},end:function(){return 0}},L=function(){function k(){}return k.isBuffered=function(A,D){try{if(A){for(var _=k.getBuffered(A),d=0;d<_.length;d++)if(D>=_.start(d)&&D<=_.end(d))return!0}}catch{}return!1},k.bufferInfo=function(A,D,_){try{if(A){var d=k.getBuffered(A),g=[],T;for(T=0;T<d.length;T++)g.push({start:d.start(T),end:d.end(T)});return this.bufferedInfo(g,D,_)}}catch{}return{len:0,start:D,end:D,nextStart:void 0}},k.bufferedInfo=function(A,D,_){D=Math.max(0,D),A.sort(function(h,v){var y=h.start-v.start;return y||v.end-h.end});var d=[];if(_)for(var g=0;g<A.length;g++){var T=d.length;if(T){var m=d[T-1].end;A[g].start-m<_?A[g].end>m&&(d[T-1].end=A[g].end):d.push(A[g])}else d.push(A[g])}else d=A;for(var E=0,l,t=D,e=D,i=0;i<d.length;i++){var c=d[i].start,n=d[i].end;if(D+_>=c&&D<n)t=c,e=n,E=e-D;else if(D+_<c){l=c;break}}return{len:E,start:t||0,end:e||0,nextStart:l}},k.getBuffered=function(A){try{return A.buffered}catch(D){return w.logger.log("failed to get media.buffered",D),S}},k}()},"./src/utils/cea-608-parser.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"Row",function(){return i}),p.d(x,"CaptionScreen",function(){return c});var w=p("./src/utils/logger.ts"),S={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},L=function(s){var a=s;return S.hasOwnProperty(s)&&(a=S[s]),String.fromCharCode(a)},k=15,A=100,D={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},_={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},g={25:2,26:4,29:6,30:8,31:10,27:13,28:15},T=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],m;(function(s){s[s.ERROR=0]="ERROR",s[s.TEXT=1]="TEXT",s[s.WARNING=2]="WARNING",s[s.INFO=2]="INFO",s[s.DEBUG=3]="DEBUG",s[s.DATA=3]="DATA"})(m||(m={}));var E=function(){function s(){this.time=null,this.verboseLevel=m.ERROR}var a=s.prototype;return a.log=function(r,u){this.verboseLevel>=r&&w.logger.log(this.time+" ["+r+"] "+u)},s}(),l=function(s){for(var a=[],r=0;r<s.length;r++)a.push(s[r].toString(16));return a},t=function(){function s(r,u,o,b,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=r||"white",this.underline=u||!1,this.italics=o||!1,this.background=b||"black",this.flash=R||!1}var a=s.prototype;return a.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},a.setStyles=function(r){for(var u=["foreground","underline","italics","background","flash"],o=0;o<u.length;o++){var b=u[o];r.hasOwnProperty(b)&&(this[b]=r[b])}},a.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},a.equals=function(r){return this.foreground===r.foreground&&this.underline===r.underline&&this.italics===r.italics&&this.background===r.background&&this.flash===r.flash},a.copy=function(r){this.foreground=r.foreground,this.underline=r.underline,this.italics=r.italics,this.background=r.background,this.flash=r.flash},a.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},s}(),e=function(){function s(r,u,o,b,R,O){this.uchar=void 0,this.penState=void 0,this.uchar=r||" ",this.penState=new t(u,o,b,R,O)}var a=s.prototype;return a.reset=function(){this.uchar=" ",this.penState.reset()},a.setChar=function(r,u){this.uchar=r,this.penState.copy(u)},a.setPenState=function(r){this.penState.copy(r)},a.equals=function(r){return this.uchar===r.uchar&&this.penState.equals(r.penState)},a.copy=function(r){this.uchar=r.uchar,this.penState.copy(r.penState)},a.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},s}(),i=function(){function s(r){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var u=0;u<A;u++)this.chars.push(new e);this.logger=r,this.pos=0,this.currPenState=new t}var a=s.prototype;return a.equals=function(r){for(var u=!0,o=0;o<A;o++)if(!this.chars[o].equals(r.chars[o])){u=!1;break}return u},a.copy=function(r){for(var u=0;u<A;u++)this.chars[u].copy(r.chars[u])},a.isEmpty=function(){for(var r=!0,u=0;u<A;u++)if(!this.chars[u].isEmpty()){r=!1;break}return r},a.setCursor=function(r){this.pos!==r&&(this.pos=r),this.pos<0?(this.logger.log(m.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>A&&(this.logger.log(m.DEBUG,"Too large cursor position "+this.pos),this.pos=A)},a.moveCursor=function(r){var u=this.pos+r;if(r>1)for(var o=this.pos+1;o<u+1;o++)this.chars[o].setPenState(this.currPenState);this.setCursor(u)},a.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},a.insertChar=function(r){r>=144&&this.backSpace();var u=L(r);if(this.pos>=A){this.logger.log(m.ERROR,"Cannot insert "+r.toString(16)+" ("+u+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(u,this.currPenState),this.moveCursor(1)},a.clearFromPos=function(r){var u;for(u=r;u<A;u++)this.chars[u].reset()},a.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},a.clearToEndOfRow=function(){this.clearFromPos(this.pos)},a.getTextString=function(){for(var r=[],u=!0,o=0;o<A;o++){var b=this.chars[o].uchar;b!==" "&&(u=!1),r.push(b)}return u?"":r.join("")},a.setPenStyles=function(r){this.currPenState.setStyles(r);var u=this.chars[this.pos];u.setPenState(this.currPenState)},s}(),c=function(){function s(r){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var u=0;u<k;u++)this.rows.push(new i(r));this.logger=r,this.currRow=k-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var a=s.prototype;return a.reset=function(){for(var r=0;r<k;r++)this.rows[r].clear();this.currRow=k-1},a.equals=function(r){for(var u=!0,o=0;o<k;o++)if(!this.rows[o].equals(r.rows[o])){u=!1;break}return u},a.copy=function(r){for(var u=0;u<k;u++)this.rows[u].copy(r.rows[u])},a.isEmpty=function(){for(var r=!0,u=0;u<k;u++)if(!this.rows[u].isEmpty()){r=!1;break}return r},a.backSpace=function(){var r=this.rows[this.currRow];r.backSpace()},a.clearToEndOfRow=function(){var r=this.rows[this.currRow];r.clearToEndOfRow()},a.insertChar=function(r){var u=this.rows[this.currRow];u.insertChar(r)},a.setPen=function(r){var u=this.rows[this.currRow];u.setPenStyles(r)},a.moveCursor=function(r){var u=this.rows[this.currRow];u.moveCursor(r)},a.setCursor=function(r){this.logger.log(m.INFO,"setCursor: "+r);var u=this.rows[this.currRow];u.setCursor(r)},a.setPAC=function(r){this.logger.log(m.INFO,"pacData = "+JSON.stringify(r));var u=r.row-1;if(this.nrRollUpRows&&u<this.nrRollUpRows-1&&(u=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==u){for(var o=0;o<k;o++)this.rows[o].clear();var b=this.currRow+1-this.nrRollUpRows,R=this.lastOutputScreen;if(R){var O=R.rows[b].cueStartTime,C=this.logger.time;if(O&&C!==null&&O<C)for(var I=0;I<this.nrRollUpRows;I++)this.rows[u-this.nrRollUpRows+I+1].copy(R.rows[b+I])}}this.currRow=u;var F=this.rows[this.currRow];if(r.indent!==null){var M=r.indent,P=Math.max(M-1,0);F.setCursor(r.indent),r.color=F.chars[P].penState.foreground}var N={foreground:r.color,underline:r.underline,italics:r.italics,background:"black",flash:!1};this.setPen(N)},a.setBkgData=function(r){this.logger.log(m.INFO,"bkgData = "+JSON.stringify(r)),this.backSpace(),this.setPen(r),this.insertChar(32)},a.setRollUpRows=function(r){this.nrRollUpRows=r},a.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(m.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(m.TEXT,this.getDisplayText());var r=this.currRow+1-this.nrRollUpRows,u=this.rows.splice(r,1)[0];u.clear(),this.rows.splice(this.currRow,0,u),this.logger.log(m.INFO,"Rolling up")},a.getDisplayText=function(r){r=r||!1;for(var u=[],o="",b=-1,R=0;R<k;R++){var O=this.rows[R].getTextString();O&&(b=R+1,r?u.push("Row "+b+": '"+O+"'"):u.push(O.trim()))}return u.length>0&&(r?o="["+u.join(" | ")+"]":o=u.join(`
`)),o},a.getTextAndFormat=function(){return this.rows},s}(),n=function(){function s(r,u,o){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=r,this.outputFilter=u,this.mode=null,this.verbose=0,this.displayedMemory=new c(o),this.nonDisplayedMemory=new c(o),this.lastOutputScreen=new c(o),this.currRollUpRow=this.displayedMemory.rows[k-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=o}var a=s.prototype;return a.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[k-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},a.getHandler=function(){return this.outputFilter},a.setHandler=function(r){this.outputFilter=r},a.setPAC=function(r){this.writeScreen.setPAC(r)},a.setBkgData=function(r){this.writeScreen.setBkgData(r)},a.setMode=function(r){r!==this.mode&&(this.mode=r,this.logger.log(m.INFO,"MODE="+r),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=r)},a.insertChars=function(r){for(var u=0;u<r.length;u++)this.writeScreen.insertChar(r[u]);var o=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(m.INFO,o+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(m.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},a.ccRCL=function(){this.logger.log(m.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},a.ccBS=function(){this.logger.log(m.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},a.ccAOF=function(){},a.ccAON=function(){},a.ccDER=function(){this.logger.log(m.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},a.ccRU=function(r){this.logger.log(m.INFO,"RU("+r+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(r)},a.ccFON=function(){this.logger.log(m.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},a.ccRDC=function(){this.logger.log(m.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},a.ccTR=function(){this.logger.log(m.INFO,"TR"),this.setMode("MODE_TEXT")},a.ccRTD=function(){this.logger.log(m.INFO,"RTD"),this.setMode("MODE_TEXT")},a.ccEDM=function(){this.logger.log(m.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},a.ccCR=function(){this.logger.log(m.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},a.ccENM=function(){this.logger.log(m.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},a.ccEOC=function(){if(this.logger.log(m.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var r=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=r,this.writeScreen=this.nonDisplayedMemory,this.logger.log(m.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},a.ccTO=function(r){this.logger.log(m.INFO,"TO("+r+") - Tab Offset"),this.writeScreen.moveCursor(r)},a.ccMIDROW=function(r){var u={flash:!1};if(u.underline=r%2==1,u.italics=r>=46,u.italics)u.foreground="white";else{var o=Math.floor(r/2)-16,b=["white","green","blue","cyan","red","yellow","magenta"];u.foreground=b[o]}this.logger.log(m.INFO,"MIDROW: "+JSON.stringify(u)),this.writeScreen.setPen(u)},a.outputDataUpdate=function(r){r===void 0&&(r=!1);var u=this.logger.time;u!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=u:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,u,this.lastOutputScreen),r&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:u),this.lastOutputScreen.copy(this.displayedMemory))},a.cueSplitAtTime=function(r){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,r,this.displayedMemory),this.cueStartTime=r))},s}(),h=function(){function s(r,u,o){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var b=new E;this.channels=[null,new n(r,u,b),new n(r+1,o,b)],this.cmdHistory=f(),this.logger=b}var a=s.prototype;return a.getHandler=function(r){return this.channels[r].getHandler()},a.setHandler=function(r,u){this.channels[r].setHandler(u)},a.addData=function(r,u){var o,b,R,O=!1;this.logger.time=r;for(var C=0;C<u.length;C+=2)if(b=u[C]&127,R=u[C+1]&127,!(b===0&&R===0)){if(this.logger.log(m.DATA,"["+l([u[C],u[C+1]])+"] -> ("+l([b,R])+")"),o=this.parseCmd(b,R),o||(o=this.parseMidrow(b,R)),o||(o=this.parsePAC(b,R)),o||(o=this.parseBackgroundAttributes(b,R)),!o&&(O=this.parseChars(b,R),O)){var I=this.currentChannel;if(I&&I>0){var F=this.channels[I];F.insertChars(O)}else this.logger.log(m.WARNING,"No channel found yet. TEXT-MODE?")}!o&&!O&&this.logger.log(m.WARNING,"Couldn't parse cleaned data "+l([b,R])+" orig: "+l([u[C],u[C+1]]))}},a.parseCmd=function(r,u){var o=this.cmdHistory,b=(r===20||r===28||r===21||r===29)&&u>=32&&u<=47,R=(r===23||r===31)&&u>=33&&u<=35;if(!(b||R))return!1;if(y(r,u,o))return v(null,null,o),this.logger.log(m.DEBUG,"Repeated command ("+l([r,u])+") is dropped"),!0;var O=r===20||r===21||r===23?1:2,C=this.channels[O];return r===20||r===21||r===28||r===29?u===32?C.ccRCL():u===33?C.ccBS():u===34?C.ccAOF():u===35?C.ccAON():u===36?C.ccDER():u===37?C.ccRU(2):u===38?C.ccRU(3):u===39?C.ccRU(4):u===40?C.ccFON():u===41?C.ccRDC():u===42?C.ccTR():u===43?C.ccRTD():u===44?C.ccEDM():u===45?C.ccCR():u===46?C.ccENM():u===47&&C.ccEOC():C.ccTO(u-32),v(r,u,o),this.currentChannel=O,!0},a.parseMidrow=function(r,u){var o=0;if((r===17||r===25)&&u>=32&&u<=47){if(r===17?o=1:o=2,o!==this.currentChannel)return this.logger.log(m.ERROR,"Mismatch channel in midrow parsing"),!1;var b=this.channels[o];return b?(b.ccMIDROW(u),this.logger.log(m.DEBUG,"MIDROW ("+l([r,u])+")"),!0):!1}return!1},a.parsePAC=function(r,u){var o,b=this.cmdHistory,R=(r>=17&&r<=23||r>=25&&r<=31)&&u>=64&&u<=127,O=(r===16||r===24)&&u>=64&&u<=95;if(!(R||O))return!1;if(y(r,u,b))return v(null,null,b),!0;var C=r<=23?1:2;u>=64&&u<=95?o=C===1?D[r]:d[r]:o=C===1?_[r]:g[r];var I=this.channels[C];return I?(I.setPAC(this.interpretPAC(o,u)),v(r,u,b),this.currentChannel=C,!0):!1},a.interpretPAC=function(r,u){var o,b={color:null,italics:!1,indent:null,underline:!1,row:r};return u>95?o=u-96:o=u-64,b.underline=(o&1)==1,o<=13?b.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(o/2)]:o<=15?(b.italics=!0,b.color="white"):b.indent=Math.floor((o-16)/2)*4,b},a.parseChars=function(r,u){var o,b=null,R=null;if(r>=25?(o=2,R=r-8):(o=1,R=r),R>=17&&R<=19){var O;R===17?O=u+80:R===18?O=u+112:O=u+144,this.logger.log(m.INFO,"Special char '"+L(O)+"' in channel "+o),b=[O]}else r>=32&&r<=127&&(b=u===0?[r]:[r,u]);if(b){var C=l(b);this.logger.log(m.DEBUG,"Char codes =  "+C.join(",")),v(r,u,this.cmdHistory)}return b},a.parseBackgroundAttributes=function(r,u){var o=(r===16||r===24)&&u>=32&&u<=47,b=(r===23||r===31)&&u>=45&&u<=47;if(!(o||b))return!1;var R,O={};r===16||r===24?(R=Math.floor((u-32)/2),O.background=T[R],u%2==1&&(O.background=O.background+"_semi")):u===45?O.background="transparent":(O.foreground="black",u===47&&(O.underline=!0));var C=r<=23?1:2,I=this.channels[C];return I.setBkgData(O),v(r,u,this.cmdHistory),!0},a.reset=function(){for(var r=0;r<Object.keys(this.channels).length;r++){var u=this.channels[r];u&&u.reset()}this.cmdHistory=f()},a.cueSplitAtTime=function(r){for(var u=0;u<this.channels.length;u++){var o=this.channels[u];o&&o.cueSplitAtTime(r)}},s}();function v(s,a,r){r.a=s,r.b=a}function y(s,a,r){return r.a===s&&r.b===a}function f(){return{a:null,b:null}}x.default=h},"./src/utils/codecs.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"isCodecType",function(){return S}),p.d(x,"isCodecSupportedInMp4",function(){return L});var w={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function S(k,A){var D=w[A];return!!D&&D[k.slice(0,4)]===!0}function L(k,A){return MediaSource.isTypeSupported((A||"video")+'/mp4;codecs="'+k+'"')}},"./src/utils/cues.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/utils/vttparser.ts"),S=p("./src/utils/webvtt-parser.ts"),L=p("./src/utils/texttrack-utils.ts"),k=/\s/,A={newCue:function(D,_,d,g){for(var T=[],m,E,l,t,e,i=self.VTTCue||self.TextTrackCue,c=0;c<g.rows.length;c++)if(m=g.rows[c],l=!0,t=0,e="",!m.isEmpty()){for(var n=0;n<m.chars.length;n++)k.test(m.chars[n].uchar)&&l?t++:(e+=m.chars[n].uchar,l=!1);m.cueStartTime=_,_===d&&(d+=1e-4),t>=16?t--:t++;var h=Object(w.fixLineBreaks)(e.trim()),v=Object(S.generateCueId)(_,d,h);(!D||!D.cues||!D.cues.getCueById(v))&&(E=new i(_,d,h),E.id=v,E.line=c+1,E.align="left",E.position=10+Math.min(80,Math.floor(t*8/32)*10),T.push(E))}return D&&T.length&&(T.sort(function(y,f){return y.line==="auto"||f.line==="auto"?0:y.line>8&&f.line>8?f.line-y.line:y.line-f.line}),T.forEach(function(y){return Object(L.addCueToTrack)(D,y)})),T}};x.default=A},"./src/utils/discontinuities.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"findFirstFragWithCC",function(){return k}),p.d(x,"shouldAlignOnDiscontinuities",function(){return A}),p.d(x,"findDiscontinuousReferenceFrag",function(){return D}),p.d(x,"adjustSlidingStart",function(){return d}),p.d(x,"alignStream",function(){return g}),p.d(x,"alignPDT",function(){return m}),p.d(x,"alignFragmentByPDTDelta",function(){return E}),p.d(x,"alignMediaPlaylistByPDT",function(){return l});var w=p("./src/polyfills/number.ts"),S=p("./src/utils/logger.ts"),L=p("./src/controller/level-helper.ts");function k(t,e){for(var i=null,c=0,n=t.length;c<n;c++){var h=t[c];if(h&&h.cc===e){i=h;break}}return i}function A(t,e,i){return!!(e.details&&(i.endCC>i.startCC||t&&t.cc<i.startCC))}function D(t,e){var i=t.fragments,c=e.fragments;if(!c.length||!i.length){S.logger.log("No fragments to align");return}var n=k(i,c[0].cc);if(!n||n&&!n.startPTS){S.logger.log("No frag in previous level to align on");return}return n}function _(t,e){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function d(t,e){for(var i=e.fragments,c=0,n=i.length;c<n;c++)_(i[c],t);e.fragmentHint&&_(e.fragmentHint,t),e.alignedSliding=!0}function g(t,e,i){!e||(T(t,i,e),!i.alignedSliding&&e.details&&m(i,e.details),!i.alignedSliding&&e.details&&!i.skippedSegments&&Object(L.adjustSliding)(e.details,i))}function T(t,e,i){if(A(t,i,e)){var c=D(i.details,e);c&&Object(w.isFiniteNumber)(c.start)&&(S.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),d(c.start,e))}}function m(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var i=e.fragments[0].programDateTime,c=t.fragments[0].programDateTime,n=(c-i)/1e3+e.fragments[0].start;n&&Object(w.isFiniteNumber)(n)&&(S.logger.log("Adjusting PTS using programDateTime delta "+(c-i)+"ms, sliding:"+n.toFixed(3)+" "+t.url+" "),d(n,t))}}function E(t,e){var i=t.programDateTime;if(i){var c=(i-e)/1e3;t.start=t.startPTS=c,t.endPTS=c+t.duration}}function l(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var i=e.fragments[0].programDateTime,c=e.fragments[0].start,n=i-c*1e3;t.fragments.forEach(function(h){E(h,n)}),t.fragmentHint&&E(t.fragmentHint,n),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/utils/ewma.ts"),S=function(){function L(A,D,_){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=_,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new w.default(A),this.fast_=new w.default(D)}var k=L.prototype;return k.update=function(A,D){var _=this.slow_,d=this.fast_;this.slow_.halfLife!==A&&(this.slow_=new w.default(A,_.getEstimate(),_.getTotalWeight())),this.fast_.halfLife!==D&&(this.fast_=new w.default(D,d.getEstimate(),d.getTotalWeight()))},k.sample=function(A,D){A=Math.max(A,this.minDelayMs_);var _=8*D,d=A/1e3,g=_/d;this.fast_.sample(d,g),this.slow_.sample(d,g)},k.canEstimate=function(){var A=this.fast_;return A&&A.getTotalWeight()>=this.minWeight_},k.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},k.destroy=function(){},L}();x.default=S},"./src/utils/ewma.ts":function(j,x,p){"use strict";p.r(x);var w=function(){function S(k,A,D){A===void 0&&(A=0),D===void 0&&(D=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=k,this.alpha_=k?Math.exp(Math.log(.5)/k):0,this.estimate_=A,this.totalWeight_=D}var L=S.prototype;return L.sample=function(k,A){var D=Math.pow(this.alpha_,k);this.estimate_=A*(1-D)+D*this.estimate_,this.totalWeight_+=k},L.getTotalWeight=function(){return this.totalWeight_},L.getEstimate=function(){if(this.alpha_){var k=1-Math.pow(this.alpha_,this.totalWeight_);if(k)return this.estimate_/k}return this.estimate_},S}();x.default=w},"./src/utils/fetch-loader.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"fetchSupported",function(){return m});var w=p("./src/polyfills/number.ts"),S=p("./src/loader/load-stats.ts"),L=p("./src/demux/chunk-cache.ts");function k(i,c){i.prototype=Object.create(c.prototype),i.prototype.constructor=i,g(i,c)}function A(i){var c=typeof Map=="function"?new Map:void 0;return A=function(n){if(n===null||!d(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof c!="undefined"){if(c.has(n))return c.get(n);c.set(n,h)}function h(){return D(n,arguments,T(this).constructor)}return h.prototype=Object.create(n.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),g(h,n)},A(i)}function D(i,c,n){return _()?D=Reflect.construct:D=function(h,v,y){var f=[null];f.push.apply(f,v);var s=Function.bind.apply(h,f),a=new s;return y&&g(a,y.prototype),a},D.apply(null,arguments)}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(i){return Function.toString.call(i).indexOf("[native code]")!==-1}function g(i,c){return g=Object.setPrototypeOf||function(n,h){return n.__proto__=h,n},g(i,c)}function T(i){return T=Object.setPrototypeOf?Object.getPrototypeOf:function(c){return c.__proto__||Object.getPrototypeOf(c)},T(i)}function m(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var E=function(){function i(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||t,this.controller=new self.AbortController,this.stats=new S.LoadStats}var c=i.prototype;return c.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},c.abortInternal=function(){var n=this.response;(!n||!n.ok)&&(this.stats.aborted=!0,this.controller.abort())},c.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},c.load=function(n,h,v){var y=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var s=l(n,this.controller.signal),a=v.onProgress,r=n.responseType==="arraybuffer",u=r?"byteLength":"length";this.context=n,this.config=h,this.callbacks=v,this.request=this.fetchSetup(n,s),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){y.abortInternal(),v.onTimeout(f,n,y.response)},h.timeout),self.fetch(this.request).then(function(o){if(y.response=y.loader=o,!o.ok){var b=o.status,R=o.statusText;throw new e(R||"fetch, bad network response",b,o)}return f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(o.headers.get("Content-Length")||"0"),a&&Object(w.isFiniteNumber)(h.highWaterMark)?y.loadProgressively(o,f,n,h.highWaterMark,a):r?o.arrayBuffer():o.text()}).then(function(o){var b=y.response;self.clearTimeout(y.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=o[u];var R={url:b.url,data:o};a&&!Object(w.isFiniteNumber)(h.highWaterMark)&&a(f,n,o,b),v.onSuccess(R,f,n,b)}).catch(function(o){if(self.clearTimeout(y.requestTimeout),!f.aborted){var b=o.code||0;v.onError({code:b,text:o.message},n,o.details)}})},c.getCacheAge=function(){var n=null;if(this.response){var h=this.response.headers.get("age");n=h?parseFloat(h):null}return n},c.loadProgressively=function(n,h,v,y,f){y===void 0&&(y=0);var s=new L.default,a=n.body.getReader(),r=function u(){return a.read().then(function(o){if(o.done)return s.dataLength&&f(h,v,s.flush(),n),Promise.resolve(new ArrayBuffer(0));var b=o.value,R=b.length;return h.loaded+=R,R<y||s.dataLength?(s.push(b),s.dataLength>=y&&f(h,v,s.flush(),n)):f(h,v,b,n),u()}).catch(function(){return Promise.reject()})};return r()},i}();function l(i,c){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:c};return i.rangeEnd&&(n.headers=new self.Headers({Range:"bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)})),n}function t(i,c){return new self.Request(i.url,c)}var e=function(i){k(c,i);function c(n,h,v){var y;return y=i.call(this,n)||this,y.code=void 0,y.details=void 0,y.code=h,y.details=v,y}return c}(A(Error));x.default=E},"./src/utils/imsc1-ttml-parser.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"IMSC1_CODEC",function(){return d}),p.d(x,"parseIMSC1",function(){return E});var w=p("./src/utils/mp4-tools.ts"),S=p("./src/utils/vttparser.ts"),L=p("./src/utils/vttcue.ts"),k=p("./src/demux/id3.ts"),A=p("./src/utils/timescale-conversion.ts"),D=p("./src/utils/webvtt-parser.ts");function _(){return _=Object.assign||function(s){for(var a=1;a<arguments.length;a++){var r=arguments[a];for(var u in r)Object.prototype.hasOwnProperty.call(r,u)&&(s[u]=r[u])}return s},_.apply(this,arguments)}var d="stpp.ttml.im1t",g=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,T=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,m={left:"start",center:"center",right:"end",start:"start",end:"end"};function E(s,a,r,u,o){var b=Object(w.findBox)(new Uint8Array(s),["mdat"]);if(b.length===0){o(new Error("Could not parse IMSC1 mdat"));return}var R=b[0],O=Object(k.utf8ArrayToStr)(new Uint8Array(s,R.start,R.end-R.start)),C=Object(A.toTimescaleFromScale)(a,1,r);try{u(l(O,C))}catch(I){o(I)}}function l(s,a){var r=new DOMParser,u=r.parseFromString(s,"text/xml"),o=u.getElementsByTagName("tt")[0];if(!o)throw new Error("Invalid ttml");var b={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},R=Object.keys(b).reduce(function(M,P){return M[P]=o.getAttribute("ttp:"+P)||b[P],M},{}),O=o.getAttribute("xml:space")!=="preserve",C=e(t(o,"styling","style")),I=e(t(o,"layout","region")),F=t(o,"body","[begin]");return[].map.call(F,function(M){var P=i(M,O);if(!P||!M.hasAttribute("begin"))return null;var N=v(M.getAttribute("begin"),R),U=v(M.getAttribute("dur"),R),B=v(M.getAttribute("end"),R);if(N===null)throw h(M);if(B===null){if(U===null)throw h(M);B=N+U}var G=new L.default(N-a,B-a,P);G.id=Object(D.generateCueId)(G.startTime,G.endTime,G.text);var q=I[M.getAttribute("region")],K=C[M.getAttribute("style")];G.position=10,G.size=80;var W=c(q,K),V=W.textAlign;if(V){var J=m[V];J&&(G.lineAlign=J),G.align=V}return _(G,W),G}).filter(function(M){return M!==null})}function t(s,a,r){var u=s.getElementsByTagName(a)[0];return u?[].slice.call(u.querySelectorAll(r)):[]}function e(s){return s.reduce(function(a,r){var u=r.getAttribute("xml:id");return u&&(a[u]=r),a},{})}function i(s,a){return[].slice.call(s.childNodes).reduce(function(r,u,o){var b;return u.nodeName==="br"&&o?r+`
`:(b=u.childNodes)!==null&&b!==void 0&&b.length?i(u,a):a?r+u.textContent.trim().replace(/\s+/g," "):r+u.textContent},"")}function c(s,a){var r="http://www.w3.org/ns/ttml#styling",u=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"];return u.reduce(function(o,b){var R=n(a,r,b)||n(s,r,b);return R&&(o[b]=R),o},{})}function n(s,a,r){return s.hasAttributeNS(a,r)?s.getAttributeNS(a,r):null}function h(s){return new Error("Could not parse ttml timestamp "+s)}function v(s,a){if(!s)return null;var r=Object(S.parseTimeStamp)(s);return r===null&&(g.test(s)?r=y(s,a):T.test(s)&&(r=f(s,a))),r}function y(s,a){var r=g.exec(s),u=(r[4]|0)+(r[5]|0)/a.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+u/a.frameRate}function f(s,a){var r=T.exec(s),u=Number(r[1]),o=r[2];switch(o){case"h":return u*3600;case"m":return u*60;case"ms":return u*1e3;case"f":return u/a.frameRate;case"t":return u/a.tickRate}return u}},"./src/utils/logger.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"enableLogs",function(){return D}),p.d(x,"logger",function(){return _});var w=function(){},S={trace:w,debug:w,log:w,warn:w,info:w,error:w},L=S;function k(d){var g=self.console[d];return g?g.bind(self.console,"["+d+"] >"):w}function A(d){for(var g=arguments.length,T=new Array(g>1?g-1:0),m=1;m<g;m++)T[m-1]=arguments[m];T.forEach(function(E){L[E]=d[E]?d[E].bind(d):k(E)})}function D(d){if(self.console&&d===!0||typeof d=="object"){A(d,"debug","log","info","warn","error");try{L.log()}catch{L=S}}else L=S}var _=L},"./src/utils/mediakeys-helper.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"KeySystems",function(){return w}),p.d(x,"requestMediaKeySystemAccess",function(){return S});var w;(function(L){L.WIDEVINE="com.widevine.alpha",L.PLAYREADY="com.microsoft.playready"})(w||(w={}));var S=function(){return typeof self!="undefined"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"getMediaSource",function(){return w});function w(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"bin2str",function(){return A}),p.d(x,"readUint16",function(){return D}),p.d(x,"readUint32",function(){return _}),p.d(x,"writeUint32",function(){return d}),p.d(x,"findBox",function(){return g}),p.d(x,"parseSegmentIndex",function(){return T}),p.d(x,"parseInitSegment",function(){return m}),p.d(x,"getStartDTS",function(){return E}),p.d(x,"getDuration",function(){return l}),p.d(x,"computeRawDurationFromSamples",function(){return t}),p.d(x,"offsetStartDTS",function(){return e}),p.d(x,"segmentValidRange",function(){return i}),p.d(x,"appendUint8Array",function(){return c});var w=p("./src/utils/typed-array.ts"),S=p("./src/loader/fragment.ts"),L=Math.pow(2,32)-1,k=[].push;function A(n){return String.fromCharCode.apply(null,n)}function D(n,h){"data"in n&&(h+=n.start,n=n.data);var v=n[h]<<8|n[h+1];return v<0?65536+v:v}function _(n,h){"data"in n&&(h+=n.start,n=n.data);var v=n[h]<<24|n[h+1]<<16|n[h+2]<<8|n[h+3];return v<0?4294967296+v:v}function d(n,h,v){"data"in n&&(h+=n.start,n=n.data),n[h]=v>>24,n[h+1]=v>>16&255,n[h+2]=v>>8&255,n[h+3]=v&255}function g(n,h){var v=[];if(!h.length)return v;var y,f,s;"data"in n?(y=n.data,f=n.start,s=n.end):(y=n,f=0,s=y.byteLength);for(var a=f;a<s;){var r=_(y,a),u=A(y.subarray(a+4,a+8)),o=r>1?a+r:s;if(u===h[0])if(h.length===1)v.push({data:y,start:a+8,end:o});else{var b=g({data:y,start:a+8,end:o},h.slice(1));b.length&&k.apply(v,b)}a=o}return v}function T(n){var h=g(n,["moov"]),v=h[0],y=v?v.end:null,f=g(n,["sidx"]);if(!f||!f[0])return null;var s=[],a=f[0],r=a.data[0],u=r===0?8:16,o=_(a,u);u+=4;var b=0,R=0;r===0?u+=8:u+=16,u+=2;var O=a.end+R,C=D(a,u);u+=2;for(var I=0;I<C;I++){var F=u,M=_(a,F);F+=4;var P=M&2147483647,N=(M&2147483648)>>>31;if(N===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var U=_(a,F);F+=4,s.push({referenceSize:P,subsegmentDuration:U,info:{duration:U/o,start:O,end:O+P-1}}),O+=P,F+=4,u=F}return{earliestPresentationTime:b,timescale:o,version:r,referencesCount:C,references:s,moovEndOffset:y}}function m(n){for(var h=[],v=g(n,["moov","trak"]),y=0;y<v.length;y++){var f=v[y],s=g(f,["tkhd"])[0];if(s){var a=s.data[s.start],r=a===0?12:20,u=_(s,r),o=g(f,["mdia","mdhd"])[0];if(o){a=o.data[o.start],r=a===0?12:20;var b=_(o,r),R=g(f,["mdia","hdlr"])[0];if(R){var O=A(R.data.subarray(R.start+8,R.start+12)),C={soun:S.ElementaryStreamTypes.AUDIO,vide:S.ElementaryStreamTypes.VIDEO}[O];if(C){var I=g(f,["mdia","minf","stbl","stsd"])[0],F=void 0;I&&(F=A(I.data.subarray(I.start+12,I.start+16))),h[u]={timescale:b,type:C},h[C]={timescale:b,id:u,codec:F}}}}}}var M=g(n,["moov","mvex","trex"]);return M.forEach(function(P){var N=_(P,4),U=h[N];U&&(U.default={duration:_(P,12),flags:_(P,20)})}),h}function E(n,h){return g(h,["moof","traf"]).reduce(function(v,y){var f=g(y,["tfdt"])[0],s=f.data[f.start],a=g(y,["tfhd"]).reduce(function(r,u){var o=_(u,4),b=n[o];if(b){var R=_(f,4);s===1&&(R*=Math.pow(2,32),R+=_(f,8));var O=b.timescale||9e4,C=R/O;if(isFinite(C)&&(r===null||C<r))return C}return r},null);return a!==null&&isFinite(a)&&(v===null||a<v)?a:v},null)||0}function l(n,h){for(var v=0,y=0,f=0,s=g(n,["moof","traf"]),a=0;a<s.length;a++){var r=s[a],u=g(r,["tfhd"])[0],o=_(u,4),b=h[o];if(b){var R=b.default,O=_(u,0)|(R==null?void 0:R.flags),C=R==null?void 0:R.duration;O&8&&(O&2?C=_(u,12):C=_(u,8));for(var I=b.timescale||9e4,F=g(r,["trun"]),M=0;M<F.length;M++){if(C){var P=_(F[M],4);v=C*P}else v=t(F[M]);b.type===S.ElementaryStreamTypes.VIDEO?y+=v/I:b.type===S.ElementaryStreamTypes.AUDIO&&(f+=v/I)}}}if(y===0&&f===0){var N=T(n);if(N!=null&&N.references)return N.references.reduce(function(U,B){return U+B.info.duration||0},0)}return y||f}function t(n){var h=_(n,0),v=8;h&1&&(v+=4),h&4&&(v+=4);for(var y=0,f=_(n,4),s=0;s<f;s++){if(h&256){var a=_(n,v);y+=a,v+=4}h&512&&(v+=4),h&1024&&(v+=4),h&2048&&(v+=4)}return y}function e(n,h,v){g(h,["moof","traf"]).forEach(function(y){g(y,["tfhd"]).forEach(function(f){var s=_(f,4),a=n[s];if(a){var r=a.timescale||9e4;g(y,["tfdt"]).forEach(function(u){var o=u.data[u.start],b=_(u,4);if(o===0)d(u,4,b-v*r);else{b*=Math.pow(2,32),b+=_(u,8),b-=v*r,b=Math.max(b,0);var R=Math.floor(b/(L+1)),O=Math.floor(b%(L+1));d(u,4,R),d(u,8,O)}})}})})}function i(n){var h={valid:null,remainder:null},v=g(n,["moof"]);if(v){if(v.length<2)return h.remainder=n,h}else return h;var y=v[v.length-1];return h.valid=Object(w.sliceUint8)(n,0,y.start-8),h.remainder=Object(w.sliceUint8)(n,y.start-8),h}function c(n,h){var v=new Uint8Array(n.length+h.length);return v.set(n),v.set(h,n.length),v}},"./src/utils/output-filter.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"default",function(){return w});var w=function(){function S(k,A){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=k,this.trackName=A}var L=S.prototype;return L.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},L.newCue=function(k,A,D){(this.startTime===null||this.startTime>k)&&(this.startTime=k),this.endTime=A,this.screen=D,this.timelineController.createCaptionsTrack(this.trackName)},L.reset=function(){this.cueRanges=[]},S}()},"./src/utils/texttrack-utils.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"sendAddTrackEvent",function(){return S}),p.d(x,"addCueToTrack",function(){return L}),p.d(x,"clearCurrentCues",function(){return k}),p.d(x,"removeCuesInRange",function(){return A}),p.d(x,"getCuesInRange",function(){return _});var w=p("./src/utils/logger.ts");function S(d,g){var T;try{T=new Event("addtrack")}catch{T=document.createEvent("Event"),T.initEvent("addtrack",!1,!1)}T.track=d,g.dispatchEvent(T)}function L(d,g){var T=d.mode;if(T==="disabled"&&(d.mode="hidden"),d.cues&&!d.cues.getCueById(g.id))try{if(d.addCue(g),!d.cues.getCueById(g.id))throw new Error("addCue is failed for: "+g)}catch(E){w.logger.debug("[texttrack-utils]: "+E);var m=new self.TextTrackCue(g.startTime,g.endTime,g.text);m.id=g.id,d.addCue(m)}T==="disabled"&&(d.mode=T)}function k(d){var g=d.mode;if(g==="disabled"&&(d.mode="hidden"),d.cues)for(var T=d.cues.length;T--;)d.removeCue(d.cues[T]);g==="disabled"&&(d.mode=g)}function A(d,g,T){var m=d.mode;if(m==="disabled"&&(d.mode="hidden"),d.cues&&d.cues.length>0)for(var E=_(d.cues,g,T),l=0;l<E.length;l++)d.removeCue(E[l]);m==="disabled"&&(d.mode=m)}function D(d,g){if(g<d[0].startTime)return 0;var T=d.length-1;if(g>d[T].endTime)return-1;for(var m=0,E=T;m<=E;){var l=Math.floor((E+m)/2);if(g<d[l].startTime)E=l-1;else if(g>d[l].startTime&&m<T)m=l+1;else return l}return d[m].startTime-g<g-d[E].startTime?m:E}function _(d,g,T){var m=[],E=D(d,g);if(E>-1)for(var l=E,t=d.length;l<t;l++){var e=d[l];if(e.startTime>=g&&e.endTime<=T)m.push(e);else if(e.startTime>T)return m}return m}},"./src/utils/time-ranges.ts":function(j,x,p){"use strict";p.r(x);var w={toString:function(S){for(var L="",k=S.length,A=0;A<k;A++)L+="["+S.start(A).toFixed(3)+","+S.end(A).toFixed(3)+"]";return L}};x.default=w},"./src/utils/timescale-conversion.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"toTimescaleFromBase",function(){return S}),p.d(x,"toTimescaleFromScale",function(){return L}),p.d(x,"toMsFromMpegTsClock",function(){return k}),p.d(x,"toMpegTsClockFromTimescale",function(){return A});var w=9e4;function S(D,_,d,g){d===void 0&&(d=1),g===void 0&&(g=!1);var T=D*_*d;return g?Math.round(T):T}function L(D,_,d,g){return d===void 0&&(d=1),g===void 0&&(g=!1),S(D,_,1/d,g)}function k(D,_){return _===void 0&&(_=!1),S(D,1e3,1/w,_)}function A(D,_){return _===void 0&&(_=1),S(D,w,1/_)}},"./src/utils/typed-array.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"sliceUint8",function(){return w});function w(S,L,k){return Uint8Array.prototype.slice?S.slice(L,k):new Uint8Array(Array.prototype.slice.call(S,L,k))}},"./src/utils/vttcue.ts":function(j,x,p){"use strict";p.r(x),x.default=function(){if(typeof self!="undefined"&&self.VTTCue)return self.VTTCue;var w=["","lr","rl"],S=["start","middle","end","left","right"];function L(d,g){if(typeof g!="string"||!Array.isArray(d))return!1;var T=g.toLowerCase();return~d.indexOf(T)?T:!1}function k(d){return L(w,d)}function A(d){return L(S,d)}function D(d){for(var g=arguments.length,T=new Array(g>1?g-1:0),m=1;m<g;m++)T[m-1]=arguments[m];for(var E=1;E<arguments.length;E++){var l=arguments[E];for(var t in l)d[t]=l[t]}return d}function _(d,g,T){var m=this,E={enumerable:!0};m.hasBeenReset=!1;var l="",t=!1,e=d,i=g,c=T,n=null,h="",v=!0,y="auto",f="start",s=50,a="middle",r=50,u="middle";Object.defineProperty(m,"id",D({},E,{get:function(){return l},set:function(o){l=""+o}})),Object.defineProperty(m,"pauseOnExit",D({},E,{get:function(){return t},set:function(o){t=!!o}})),Object.defineProperty(m,"startTime",D({},E,{get:function(){return e},set:function(o){if(typeof o!="number")throw new TypeError("Start time must be set to a number.");e=o,this.hasBeenReset=!0}})),Object.defineProperty(m,"endTime",D({},E,{get:function(){return i},set:function(o){if(typeof o!="number")throw new TypeError("End time must be set to a number.");i=o,this.hasBeenReset=!0}})),Object.defineProperty(m,"text",D({},E,{get:function(){return c},set:function(o){c=""+o,this.hasBeenReset=!0}})),Object.defineProperty(m,"region",D({},E,{get:function(){return n},set:function(o){n=o,this.hasBeenReset=!0}})),Object.defineProperty(m,"vertical",D({},E,{get:function(){return h},set:function(o){var b=k(o);if(b===!1)throw new SyntaxError("An invalid or illegal string was specified.");h=b,this.hasBeenReset=!0}})),Object.defineProperty(m,"snapToLines",D({},E,{get:function(){return v},set:function(o){v=!!o,this.hasBeenReset=!0}})),Object.defineProperty(m,"line",D({},E,{get:function(){return y},set:function(o){if(typeof o!="number"&&o!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");y=o,this.hasBeenReset=!0}})),Object.defineProperty(m,"lineAlign",D({},E,{get:function(){return f},set:function(o){var b=A(o);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");f=b,this.hasBeenReset=!0}})),Object.defineProperty(m,"position",D({},E,{get:function(){return s},set:function(o){if(o<0||o>100)throw new Error("Position must be between 0 and 100.");s=o,this.hasBeenReset=!0}})),Object.defineProperty(m,"positionAlign",D({},E,{get:function(){return a},set:function(o){var b=A(o);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");a=b,this.hasBeenReset=!0}})),Object.defineProperty(m,"size",D({},E,{get:function(){return r},set:function(o){if(o<0||o>100)throw new Error("Size must be between 0 and 100.");r=o,this.hasBeenReset=!0}})),Object.defineProperty(m,"align",D({},E,{get:function(){return u},set:function(o){var b=A(o);if(!b)throw new SyntaxError("An invalid or illegal string was specified.");u=b,this.hasBeenReset=!0}})),m.displayState=void 0}return _.prototype.getCueAsHTML=function(){var d=self.WebVTT;return d.convertCueToDOMTree(self,this.text)},_}()},"./src/utils/vttparser.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"parseTimeStamp",function(){return L}),p.d(x,"fixLineBreaks",function(){return g}),p.d(x,"VTTParser",function(){return T});var w=p("./src/utils/vttcue.ts"),S=function(){function m(){}var E=m.prototype;return E.decode=function(l,t){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},m}();function L(m){function E(t,e,i,c){return(t|0)*3600+(e|0)*60+(i|0)+parseFloat(c||0)}var l=m.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return l?parseFloat(l[2])>59?E(l[2],l[3],0,l[4]):E(l[1],l[2],l[3],l[4]):null}var k=function(){function m(){this.values=Object.create(null)}var E=m.prototype;return E.set=function(l,t){!this.get(l)&&t!==""&&(this.values[l]=t)},E.get=function(l,t,e){return e?this.has(l)?this.values[l]:t[e]:this.has(l)?this.values[l]:t},E.has=function(l){return l in this.values},E.alt=function(l,t,e){for(var i=0;i<e.length;++i)if(t===e[i]){this.set(l,t);break}},E.integer=function(l,t){/^-?\d+$/.test(t)&&this.set(l,parseInt(t,10))},E.percent=function(l,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var e=parseFloat(t);if(e>=0&&e<=100)return this.set(l,e),!0}return!1},m}();function A(m,E,l,t){var e=t?m.split(t):[m];for(var i in e)if(typeof e[i]=="string"){var c=e[i].split(l);if(c.length===2){var n=c[0],h=c[1];E(n,h)}}}var D=new w.default(0,0,""),_=D.align==="middle"?"middle":"center";function d(m,E,l){var t=m;function e(){var n=L(m);if(n===null)throw new Error("Malformed timestamp: "+t);return m=m.replace(/^[^\sa-zA-Z-]+/,""),n}function i(n,h){var v=new k;A(n,function(s,a){var r;switch(s){case"region":for(var u=l.length-1;u>=0;u--)if(l[u].id===a){v.set(s,l[u].region);break}break;case"vertical":v.alt(s,a,["rl","lr"]);break;case"line":r=a.split(","),v.integer(s,r[0]),v.percent(s,r[0])&&v.set("snapToLines",!1),v.alt(s,r[0],["auto"]),r.length===2&&v.alt("lineAlign",r[1],["start",_,"end"]);break;case"position":r=a.split(","),v.percent(s,r[0]),r.length===2&&v.alt("positionAlign",r[1],["start",_,"end","line-left","line-right","auto"]);break;case"size":v.percent(s,a);break;case"align":v.alt(s,a,["start",_,"end","left","right"]);break}},/:/,/\s/),h.region=v.get("region",null),h.vertical=v.get("vertical","");var y=v.get("line","auto");y==="auto"&&D.line===-1&&(y=-1),h.line=y,h.lineAlign=v.get("lineAlign","start"),h.snapToLines=v.get("snapToLines",!0),h.size=v.get("size",100),h.align=v.get("align",_);var f=v.get("position","auto");f==="auto"&&D.position===50&&(f=h.align==="start"||h.align==="left"?0:h.align==="end"||h.align==="right"?100:50),h.position=f}function c(){m=m.replace(/^\s+/,"")}if(c(),E.startTime=e(),c(),m.substr(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);m=m.substr(3),c(),E.endTime=e(),c(),i(m,E)}function g(m){return m.replace(/<br(?: \/)?>/gi,`
`)}var T=function(){function m(){this.state="INITIAL",this.buffer="",this.decoder=new S,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var E=m.prototype;return E.parse=function(l){var t=this;l&&(t.buffer+=t.decoder.decode(l,{stream:!0}));function e(){var y=t.buffer,f=0;for(y=g(y);f<y.length&&y[f]!=="\r"&&y[f]!==`
`;)++f;var s=y.substr(0,f);return y[f]==="\r"&&++f,y[f]===`
`&&++f,t.buffer=y.substr(f),s}function i(y){A(y,function(f,s){},/:/)}try{var c="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;c=e();var n=c.match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var h=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(h?h=!1:c=e(),t.state){case"HEADER":/:/.test(c)?i(c):c||(t.state="ID");continue;case"NOTE":c||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(c)){t.state="NOTE";break}if(!c)continue;if(t.cue=new w.default(0,0,""),t.state="CUE",c.indexOf("-->")===-1){t.cue.id=c;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{d(c,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{var v=c.indexOf("-->")!==-1;if(!c||v&&(h=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=c}continue;case"BADCUE":c||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},E.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){l.onparsingerror&&l.onparsingerror(t)}return l.onflush&&l.onflush(),this},m}()},"./src/utils/webvtt-parser.ts":function(j,x,p){"use strict";p.r(x),p.d(x,"generateCueId",function(){return T}),p.d(x,"parseWebVTT",function(){return E});var w=p("./src/polyfills/number.ts"),S=p("./src/utils/vttparser.ts"),L=p("./src/demux/id3.ts"),k=p("./src/utils/timescale-conversion.ts"),A=p("./src/remux/mp4-remuxer.ts"),D=/\r\n|\n\r|\n|\r/g,_=function(l,t,e){return e===void 0&&(e=0),l.substr(e,t.length)===t},d=function(l){var t=parseInt(l.substr(-3)),e=parseInt(l.substr(-6,2)),i=parseInt(l.substr(-9,2)),c=l.length>9?parseInt(l.substr(0,l.indexOf(":"))):0;if(!Object(w.isFiniteNumber)(t)||!Object(w.isFiniteNumber)(e)||!Object(w.isFiniteNumber)(i)||!Object(w.isFiniteNumber)(c))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return t+=1e3*e,t+=60*1e3*i,t+=60*60*1e3*c,t},g=function(l){for(var t=5381,e=l.length;e;)t=t*33^l.charCodeAt(--e);return(t>>>0).toString()};function T(l,t,e){return g(l.toString())+g(t.toString())+g(e)}var m=function(l,t,e){var i=l[t],c=l[i.prevCC];if(!c||!c.new&&i.new){l.ccOffset=l.presentationOffset=i.start,i.new=!1;return}for(;(n=c)!==null&&n!==void 0&&n.new;){var n;l.ccOffset+=i.start-c.start,i.new=!1,i=c,c=l[i.prevCC]}l.presentationOffset=e};function E(l,t,e,i,c,n,h,v){var y=new S.VTTParser,f=Object(L.utf8ArrayToStr)(new Uint8Array(l)).trim().replace(D,`
`).split(`
`),s=[],a=Object(k.toMpegTsClockFromTimescale)(t,e),r="00:00.000",u=0,o=0,b,R=!0,O=!1;y.oncue=function(C){var I=i[c],F=i.ccOffset,M=(u-a)/9e4;if(I!=null&&I.new&&(o!==void 0?F=i.ccOffset=I.start:m(i,c,M)),M&&(F=M-i.presentationOffset),O){var P=C.endTime-C.startTime,N=Object(A.normalizePts)((C.startTime+F-o)*9e4,n*9e4)/9e4;C.startTime=N,C.endTime=N+P}var U=C.text.trim();C.text=decodeURIComponent(encodeURIComponent(U)),C.id||(C.id=T(C.startTime,C.endTime,U)),C.endTime>0&&s.push(C)},y.onparsingerror=function(C){b=C},y.onflush=function(){if(b){v(b);return}h(s)},f.forEach(function(C){if(R)if(_(C,"X-TIMESTAMP-MAP=")){R=!1,O=!0,C.substr(16).split(",").forEach(function(I){_(I,"LOCAL:")?r=I.substr(6):_(I,"MPEGTS:")&&(u=parseInt(I.substr(7)))});try{o=d(r)/1e3}catch(I){O=!1,b=I}return}else C===""&&(R=!1);y.parse(C+`
`)}),y.flush()}},"./src/utils/xhr-loader.ts":function(j,x,p){"use strict";p.r(x);var w=p("./src/utils/logger.ts"),S=p("./src/loader/load-stats.ts"),L=/^age:\s*[\d.]+\s*$/m,k=function(){function A(_){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=_?_.xhrSetup:null,this.stats=new S.LoadStats,this.retryDelay=0}var D=A.prototype;return D.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},D.abortInternal=function(){var _=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),_&&(_.onreadystatechange=null,_.onprogress=null,_.readyState!==4&&(this.stats.aborted=!0,_.abort()))},D.abort=function(){var _;this.abortInternal(),(_=this.callbacks)!==null&&_!==void 0&&_.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},D.load=function(_,d,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=_,this.config=d,this.callbacks=g,this.retryDelay=d.retryDelay,this.loadInternal()},D.loadInternal=function(){var _=this.config,d=this.context;if(_){var g=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var m=this.xhrSetup;try{if(m)try{m(g,d.url)}catch{g.open("GET",d.url,!0),m(g,d.url)}g.readyState||g.open("GET",d.url,!0)}catch(E){this.callbacks.onError({code:g.status,text:E.message},d,g);return}d.rangeEnd&&g.setRequestHeader("Range","bytes="+d.rangeStart+"-"+(d.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=d.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout),g.send()}},D.readystatechange=function(){var _=this.context,d=this.loader,g=this.stats;if(!(!_||!d)){var T=d.readyState,m=this.config;if(!g.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),T===4){d.onreadystatechange=null,d.onprogress=null;var E=d.status;if(E>=200&&E<300){g.loading.end=Math.max(self.performance.now(),g.loading.first);var l,t;if(_.responseType==="arraybuffer"?(l=d.response,t=l.byteLength):(l=d.responseText,t=l.length),g.loaded=g.total=t,!this.callbacks)return;var e=this.callbacks.onProgress;if(e&&e(g,_,l,d),!this.callbacks)return;var i={url:d.responseURL,data:l};this.callbacks.onSuccess(i,g,_,d)}else g.retry>=m.maxRetry||E>=400&&E<499?(w.logger.error(E+" while loading "+_.url),this.callbacks.onError({code:E,text:d.statusText},_,d)):(w.logger.warn(E+" while loading "+_.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,m.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),m.timeout)}},D.loadtimeout=function(){w.logger.warn("timeout while loading "+this.context.url);var _=this.callbacks;_&&(this.abortInternal(),_.onTimeout(this.stats,this.context,this.loader))},D.loadprogress=function(_){var d=this.stats;d.loaded=_.loaded,_.lengthComputable&&(d.total=_.total)},D.getCacheAge=function(){var _=null;if(this.loader&&L.test(this.loader.getAllResponseHeaders())){var d=this.loader.getResponseHeader("age");_=d?parseFloat(d):null}return _},A}();x.default=k}}).default})}),$t=It(H=>{var Z=Object.create,j=Object.defineProperty,x=Object.getOwnPropertyDescriptor,p=Object.getOwnPropertyNames,w=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty,L=r=>j(r,"__esModule",{value:!0}),k=(r,u)=>{L(r);for(var o in u)j(r,o,{get:u[o],enumerable:!0})},A=(r,u,o)=>{if(u&&typeof u=="object"||typeof u=="function")for(let b of p(u))!S.call(r,b)&&b!=="default"&&j(r,b,{get:()=>u[b],enumerable:!(o=x(u,b))||o.enumerable});return r},D=r=>A(L(j(r!=null?Z(w(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);k(H,{ExtensionMimeTypeMap:()=>m,Hls:()=>d.default,MimeTypeShorthandMap:()=>E,StreamTypes:()=>T,allMediaTypes:()=>t,getStreamTypeConfig:()=>h,getType:()=>n,inferMimeTypeFromURL:()=>c,initialize:()=>a,loadMedia:()=>s,mux:()=>_.default,setupHls:()=>y,setupMux:()=>f,shorthandKeys:()=>l,teardown:()=>v,toMuxVideoURL:()=>i,toPlaybackIdParts:()=>e});var _=D(Jt()),d=D(Qt()),g=(r,u)=>r in u,T={VOD:"on-demand",LIVE:"live",LL_LIVE:"ll-live"},m={M3U8:"application/vnd.apple.mpegurl",MP4:"video/mp4"},E={HLS:m.M3U8},l=Object.keys(E),t=[...Object.values(m),...l,...l.map(r=>r.toUpperCase()),...l.map(r=>r.toLowerCase())],e=r=>{let u=r.indexOf("?");if(u<0)return[r];let o=r.slice(0,u),b=r.slice(u);return[o,b]},i=r=>{if(!r)return;let[u,o=""]=e(r);return`https://stream.mux.com/${u}.m3u8${o}`},c=r=>{let u="";try{u=new URL(r).pathname}catch{console.error("invalid url")}let o=u.lastIndexOf(".");if(o<0)return"";let b=u.slice(o+1).toUpperCase();return g(b,m)?m[b]:""},n=r=>{let u=r.type;if(u){let b=u.toUpperCase();return g(b,E)?E[b]:u}let{src:o}=r;return o?c(o):""},h=r=>r===T.LL_LIVE?{maxFragLookUpTolerance:.001}:{},v=(r,u)=>{u&&(u.detachMedia(),u.destroy()),(r==null?void 0:r.mux)&&(r.mux.destroy(),r.mux)},y=(r,u)=>{var o,b,R;let{debug:O,preferMse:C,streamType:I,startTime:F=-1}=r,M=n(r),P=M===m.M3U8,N=!M||((o=u==null?void 0:u.canPlayType(M))!=null?o:!0),U=d.default.isSupported(),B=((R=(b=window==null?void 0:window.navigator)==null?void 0:b.userAgent)!=null?R:"").toLowerCase().indexOf("android")!==-1&&I===T.LL_LIVE;if(P&&!(!P||N&&!((C||B)&&U))&&U){let G=h(I);return new d.default({debug:O,startPosition:F,...G})}},f=(r,u,o)=>{let{envKey:b}=r;if(b&&u){let{playerInitTime:R,playerSoftwareName:O,playerSoftwareVersion:C,beaconDomain:I,metadata:F,debug:M}=r;_.default.monitor(u,{debug:M,beaconDomain:I,hlsjs:o,Hls:o?d.default:void 0,data:{env_key:b,player_software_name:O,player_software_version:C,player_init_time:R,...F}})}},s=(r,u,o)=>{var b,R,O;if(!u){console.warn("attempting to load media before mediaEl exists");return}let{preferMse:C,streamType:I}=r,F=n(r),M=F===m.M3U8,P=!F||((b=u==null?void 0:u.canPlayType(F))!=null?b:!0),N=d.default.isSupported(),U=((O=(R=window==null?void 0:window.navigator)==null?void 0:R.userAgent)!=null?O:"").toLowerCase().indexOf("android")!==-1&&I===T.LL_LIVE,B=!M||P&&!((C||U)&&N),{src:G}=r;if(u&&P&&B)if(typeof G=="string"){let{startTime:q}=r;if(u.setAttribute("src",G),q){let K=({target:W})=>{W.currentTime=q,W.removeEventListener("loadedmetadata",K)};u.addEventListener("loadedmetadata",K)}}else u.removeAttribute("src");else if(o&&G){o.on(d.default.Events.ERROR,(K,W)=>{if(W.fatal)switch(W.type){case d.default.ErrorTypes.NETWORK_ERROR:console.error("fatal network error encountered, try to recover"),o.startLoad();break;case d.default.ErrorTypes.MEDIA_ERROR:console.error("fatal media error encountered, try to recover"),o.recoverMediaError();break;default:console.error("unrecoverable fatal error encountered, cannot recover (check logs for more info)"),o.destroy();break}});let q=()=>{Array.from(u.textTracks).forEach(K=>{var W,V;if(!["subtitles","caption"].includes(K.kind)&&K.label==="thumbnails"){if(!((W=K.cues)==null?void 0:W.length)){let J=u.querySelector('track[label="thumbnails"]'),Q=(V=J==null?void 0:J.getAttribute("src"))!=null?V:"";J==null||J.removeAttribute("src"),setTimeout(()=>{J==null||J.setAttribute("src",Q)},0)}K.mode!=="hidden"&&(K.mode="hidden")}})};o.on(d.default.Events.MANIFEST_LOADED,q),o.on(d.default.Events.MEDIA_ATTACHED,q),o.loadSource(G),o.attachMedia(u)}else console.error("It looks like the video you're trying to play will not work on this system! If possible, try upgrading to the newest versions of your browser or software.")},a=(r,u,o)=>{v(u,o);let b=y(r,u);return f(r,u,b),s(r,u,b),b}}),Ut=document.createElement("template");Ut.innerHTML=`
<style>
  :host {
    /* Supposed to reset styles. Need to understand the specific effects more */
    all: initial;

    /* display:inline (like the native el) makes it so you can't fill
      the container with the native el */
    display: inline-block;
    box-sizing: border-box;

    width: auto;
    height: auto;
  }

  audio {
    max-width: 100%;
    max-height: 100%;
    min-width: 100%;
    min-height: 100%;
  }

</style>

<audio crossorigin></audio>
`;var Rt=class extends HTMLElement{constructor(){super();var H=this.attachShadow({mode:"open"});this.shadowRoot.appendChild(Ut.content.cloneNode(!0));let Z=this.nativeEl=this.shadowRoot.querySelector("audio");Array.prototype.forEach.call(this.attributes,x=>{this.attributeChangedCallback(x.name,null,x.value)}),Z.defaultMuted&&(Z.muted=!0),this.shadowRoot.appendChild(Z),this.querySelectorAll(":scope > track").forEach(x=>{this.nativeEl.appendChild(x.cloneNode())});let j=(x,p)=>{for(let w of x)w.type==="childList"&&(w.removedNodes.forEach(S=>{this.nativeEl.removeChild(this.nativeEl.querySelector(`track[src="${S.src}"]`))}),w.addedNodes.forEach(S=>{this.nativeEl.appendChild(S.cloneNode())}))};new MutationObserver(j).observe(this,{childList:!0,subtree:!0})}static get observedAttributes(){let H=[];Object.getOwnPropertyNames(this.prototype).forEach(j=>{let x=!1;try{typeof this.prototype[j]=="function"&&(x=!0)}catch{}!x&&j!==j.toUpperCase()&&H.push(j.toLowerCase())});let Z=Object.getPrototypeOf(this).observedAttributes;return Z&&(H=H.concat(Z)),H}attributeChangedCallback(H,Z,j){let x=Object.getOwnPropertyNames(Object.getPrototypeOf(this)),p=te(x,H),w=Object.getPrototypeOf(this.constructor).toString().indexOf("function HTMLElement")===0;p&&!w?typeof this[p]=="boolean"?j===null?this[p]=!1:this[p]=!0:this[p]=j:j===null?this.nativeEl.removeAttribute(H):["id","class"].indexOf(H)===-1&&this.nativeEl.setAttribute(H,j)}connectedCallback(){}},Ct=[],Bt=document.createElement("audio"),Zt=["webkitDisplayingFullscreen","webkitSupportsFullscreen"];for(let H=Object.getPrototypeOf(Bt);H&&H!==HTMLElement.prototype;H=Object.getPrototypeOf(H))Object.keys(H).forEach(Z=>{Zt.indexOf(Z)===-1&&Ct.push(Z)});Ct=Ct.concat(Object.keys(EventTarget.prototype)),Ct.forEach(H=>{if(typeof Bt[H]=="function")Rt.prototype[H]=function(){return this.nativeEl[H].apply(this.nativeEl,arguments)};else{let Z={get(){return this.nativeEl[H]}};H!==H.toUpperCase()&&(Z.set=function(j){this.nativeEl[H]=j}),Object.defineProperty(Rt.prototype,H,Z)}});function te(H,Z){let j=null;return H.forEach(x=>{x.toLowerCase()==Z.toLowerCase()&&(j=x)}),j}globalThis.customElements.get("custom-audio")||(globalThis.customElements.define("custom-audio",Rt),globalThis.CustomAudioElement=Rt);var jt=Rt,Mt=Xt($t()),ee=()=>{try{return"0.2.2"}catch{}return"UNKNOWN"},re=ee(),ie=()=>re,dt={ENV_KEY:"env-key",DEBUG:"debug",PLAYBACK_ID:"playback-id",METADATA_URL:"metadata-url",PREFER_MSE:"prefer-mse",METADATA_VIDEO_ID:"metadata-video-id",METADATA_VIDEO_TITLE:"metadata-video-title",METADATA_VIEWER_USER_ID:"metadata-viewer-user-id",BEACON_DOMAIN:"beacon-domain",TYPE:"type",STREAM_TYPE:"stream-type",START_TIME:"start-time"},ne=Object.values(dt),ae=ie(),se="mux-audio",Pt=class extends jt{constructor(){super();this.__metadata={},this.__muxPlayerInitTime=Date.now()}static get observedAttributes(){var H;return[...ne,...(H=jt.observedAttributes)!=null?H:[]]}get playerSoftwareName(){return se}get playerSoftwareVersion(){return ae}get hls(){return this.__hls}get mux(){return this.nativeEl.mux}get src(){return this.getAttribute("src")}set src(H){H!==this.src&&(H==null?this.removeAttribute("src"):this.setAttribute("src",H))}get debug(){return this.getAttribute(dt.DEBUG)!=null}set debug(H){H!==this.debug&&(H?this.setAttribute(dt.DEBUG,""):this.removeAttribute(dt.DEBUG))}get startTime(){let H=this.getAttribute(dt.START_TIME);if(H==null)return;let Z=+H;return Number.isNaN(Z)?void 0:Z}set startTime(H){H!==this.startTime&&(H==null?this.removeAttribute(dt.START_TIME):this.setAttribute(dt.START_TIME,`${H}`))}get beaconDomain(){var H;return(H=this.getAttribute(dt.BEACON_DOMAIN))!=null?H:void 0}set beaconDomain(H){H!==this.beaconDomain&&(H?this.setAttribute(dt.BEACON_DOMAIN,H):this.removeAttribute(dt.BEACON_DOMAIN))}get streamType(){var H;return(H=this.getAttribute(dt.STREAM_TYPE))!=null?H:void 0}set streamType(H){H!==this.streamType&&(H?this.setAttribute(dt.STREAM_TYPE,H):this.removeAttribute(dt.STREAM_TYPE))}get preferMSE(){return this.getAttribute(dt.PREFER_MSE)!=null}set preferMSE(H){H?this.setAttribute(dt.PREFER_MSE,""):this.removeAttribute(dt.PREFER_MSE)}get metadata(){return this.__metadata}set metadata(H){this.__metadata=H!=null?H:{},this.mux&&(console.info("Some metadata values may not be overridable at this time. Make sure you set all metadata to override before setting the src."),this.mux.emit("hb",this.__metadata))}load(){let H=(0,Mt.initialize)(this,this.nativeEl,this.__hls);this.__hls=H}unload(){(0,Mt.teardown)(this.nativeEl,this.__hls),this.__hls=void 0}attributeChangedCallback(H,Z,j){switch(H){case"src":let x=!!Z,p=!!j;!x&&p?this.load():x&&!p?this.unload():x&&p&&(this.unload(),this.load());break;case dt.PLAYBACK_ID:this.src=(0,Mt.toMuxVideoURL)(j!=null?j:void 0);break;case dt.DEBUG:let w=this.debug;this.mux&&console.info("Cannot toggle debug mode of mux data after initialization. Make sure you set all metadata to override before setting the src."),this.hls&&(this.hls.config.debug=w);break;case dt.METADATA_URL:j&&fetch(j).then(S=>S.json()).then(S=>this.metadata=S).catch(S=>console.error(`Unable to load or parse metadata JSON from metadata-url ${j}!`));break;default:break}super.attributeChangedCallback(H,Z,j)}disconnectedCallback(){this.unload()}connectedCallback(){this.src&&this.load()}};globalThis.customElements.get("mux-audio")||(globalThis.customElements.define("mux-audio",Pt),globalThis.MuxAudioElement=Pt);var Le=Pt})()});var Se=be(Kt());export{Se as MuxAudio};
